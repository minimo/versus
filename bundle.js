/*
 *  main.js
 */

phina.globalize();

const FULL_WIDTH = 1334;
const FULL_HEIGHT = 750;
const FULL_WIDTH_HALF = FULL_WIDTH * 0.5;
const FULL_HEIGHT_HALF = FULL_HEIGHT * 0.5;

const LAYOUT_WIDTH = 1334;
const LAYOUT_HEIGHT = 750;

const SCREEN_WIDTH = LAYOUT_WIDTH;
const SCREEN_HEIGHT = LAYOUT_HEIGHT;
const SCREEN_WIDTH_HALF = SCREEN_WIDTH * 0.5;
const SCREEN_HEIGHT_HALF = SCREEN_HEIGHT * 0.5;

const SCREEN_OFFSET_X = 0;
const SCREEN_OFFSET_Y = 0;

let phina_app;

window.onload = function() {
  phina_app = Application();
  phina_app.run();
};

//スクロール禁止
// document.addEventListener('touchmove', function(e) {
//  e.preventDefault();
// }, { passive: false });

/* 
 * phina.js 0.2.3
 * phina.js is a game library in javascript
 * MIT Licensed
 * 
 * Copyright (C) 2015 phi, http://phinajs.com
 */


'use strict';

/*
 *
 */


;(function() {
  /**
   * @class global.Object
   * Objectの拡張
   */

  
  /**
   * @method property
   * 変数を追加
   * @param   {String} key name
   * @param   {Object} param
   */
  // Object.defineProperty(Object.prototype, "property", {
  //   value: function(name, val) {
  //     Object.defineProperty(this, name, {
  //       value: val,
  //       enumerable: true,
  //       writable: true
  //     });
  //   }
  // });

  /**
   * @method method
   * 関数を追加
   * @param   {String} key name
   * @param   {Function} function
   */
  Object.defineProperty(Object.prototype, "$method", {
    value: function(name, fn) {
      Object.defineProperty(this, name, {
        value: fn,
        enumerable: false,
        writable: true
      });
    }
  });



  /**
   * @method setter
   * セッターを定義する
   */
  Object.prototype.$method("setter", function(name, fn){
    Object.defineProperty(this, name, {
      set: fn,
      enumerable: false,
      configurable: true,
    });
  });

  /**
   * @method getter
   * ゲッターを定義する
   */
  Object.prototype.$method("getter", function(name, fn){
    Object.defineProperty(this, name, {
      get: fn,
      enumerable: false,
      configurable: true,
    });
  });

  /**
   * @method accessor
   * アクセッサ(セッター/ゲッター)を定義する
   */
  Object.prototype.$method("accessor", function(name, param) {
    Object.defineProperty(this, name, {
      set: param["set"],
      get: param["get"],
      enumerable: false,
      configurable: true,
    });
  });


  /**
   * @method forIn
   * オブジェクト用ループ処理
   */
  Object.prototype.$method("forIn", function(fn, self) {
    self = self || this;

    Object.keys(this).forEach(function(key, index) {
      var value = this[key];

      fn.call(self, key, value, index);
    }, this);

    return this;
  });

  /**
   * @method  $get
   * パス指定で値を取得
   */
  Object.prototype.$method('$get', function(key) {
    return key.split('.').reduce(function(t, v) {
      return t && t[v];
    }, this);
  });

  /**
   * @method  $set
   * パス指定で値を設定
   */
  Object.prototype.$method('$set', function(key, value) {
    key.split('.').reduce(function(t, v, i, arr) {
      if (i === (arr.length-1)) {
        t[v] = value;
      }
      else {
        if (!t[v]) t[v] = {};
        return t[v];
      }
    }, this);
  });

  /**
   * @method  $has
   * そのプロパティを持っているかを判定する
   */
  Object.prototype.$method("$has", function(key) {
    return this.hasOwnProperty(key);
  });

  /**
   * @method  $extend
   * 他のライブラリと競合しちゃうので extend -> $extend としました
   */
  Object.prototype.$method("$extend", function() {
    Array.prototype.forEach.call(arguments, function(source) {
      for (var property in source) {
        this[property] = source[property];
      }
    }, this);
    return this;
  });


  /**
   * @method  $safe
   * 安全拡張
   * 上書きしない
   */
  Object.prototype.$method("$safe", function(source) {
    Array.prototype.forEach.call(arguments, function(source) {
      for (var property in source) {
        if (this[property] === undefined) this[property] = source[property];
      }
    }, this);
    return this;
  });
  
  
  /**
   * @method  $strict
   * 厳格拡張
   * すでにあった場合は警告
   */
  Object.prototype.$method("$strict", function(source) {
    Array.prototype.forEach.call(arguments, function(source) {
      for (var property in source) {
        console.assert(!this[property], "tm error: {0} is Already".format(property));
        this[property] = source[property];
      }
    }, this);
    return this;
  });

  /**
   * @method  $pick
   * ピック
   */
  Object.prototype.$method("$pick", function() {
    var temp = {};

    Array.prototype.forEach.call(arguments, function(key) {
      if (key in this) temp[key] = this[key];
    }, this);

    return temp;
  });

  /**
   * @method  $omit
   * オミット
   */
  Object.prototype.$method("$omit", function() {
    var temp = {};

    for (var key in this) {
      if (Array.prototype.indexOf.call(arguments, key) == -1) {
        temp[key] = this[key];
      }
    }

    return temp;
  });

  /**
   * @method  $toArray
   * 配列化
   */
  Object.prototype.$method("$toArray", function() {
    return Array.prototype.slice.call(this);
  });

  Object.prototype.$method('$watch', function(key, callback) {
    var target = this;
    var descriptor = null;

    while(target) {
      descriptor = Object.getOwnPropertyDescriptor(target, key);
      if (descriptor) {
        break;
      }
      target = Object.getPrototypeOf(target);
    }

    // すでにアクセッサーとして存在する場合
    if (descriptor) {
      // データディスクリプタの場合
      if (descriptor.value !== undefined) {
        var tempKey = '__' + key;
        var tempValue = this[key];

        this[tempKey] = tempValue;

        this.accessor(key, {
          get: function() {
            return this[tempKey];
          },
          set: function(v) {
            var old = this[tempKey];
            this[tempKey] = v;
            callback.call(this, v, old);
          },
        });
      }
      // アクセサディスクリプタの場合
      else {
        this.accessor(key, {
          get: function() {
            return descriptor.get.call(this);
          },
          set: function(v) {
            var old = descriptor.get.call(this);
            descriptor.set.call(this, v);
            callback.call(this, v, old);
          },
        });
      }
    }
    else {
      var accesskey = '__' + key;

      this.accessor(key, {
        get: function() {
          return this[accesskey];
        },
        set: function(v) {
          var old = this[accesskey];
          this[accesskey] = v;
          callback.call(this, v, old);
        },
      });
    }
  });

  if (!Object.observe) {
    Object.$method('observe', function(obj, callback) {
      var keys = Object.keys(obj);
      keys.forEach(function(key) {
        var tempKey = '__' + key;
        var tempValue = obj[key];
        obj[tempKey] = tempValue;
        
        obj.accessor(key, {
          get: function() {
            return this[tempKey];
          },
          set: function(v) {
            this[tempKey] = v;
            callback();
          },
        });
      });
    });
  }

  if (!Object.unobserve) {
    Object.$method('unobserve', function(obj, callback) {
      console.assert(false);
    });
  }

})();



/*
 * number.js
 */


;(function() {
  /**
   * @class global.Number
   * # 拡張した Number クラス
   * 数値を扱う Number クラスを拡張しています。
   */

  /**
   * @method round
   * 指定した小数の位を四捨五入した値を返します。
   *
   * 負の値を指定すると整数部の位を四捨五入できます。
   *
   * ### Example
   *     (13.87).round(); // => 14
   *     (-1.87).round(); // => -2
   *     (-1.27).round(); // => -1
   *     
   *     (2.345).round(); // => 2
   *     (2.345).round(1); // => 2.3
   *     (2.345).round(2); // => 2.35
   *
   *     (12345.67).round(-3); // => 12000
   *
   * @param {Number} [figure=0] 四捨五入する位
   * @return {Number} 小数第 figure 位で四捨五入した値
   */
  Number.prototype.$method("round", function(figure) {
    figure = figure || 0;
    var base = Math.pow(10, figure);
    var temp = this * base;
    temp = Math.round(temp);
    return temp/base;
  });
  
  /**
   * @method ceil
   * 指定した小数の位を切り上げた値を返します。
   *
   * 負の値を指定すると整数部の位を切り上げられます。
   *
   * ### Example
   *     (-1.27).ceil(); // => -1
   *     (-1.87).ceil(); // => -1
   *     
   *     (2.345).ceil(); // => 3
   *     (2.345).ceil(1); // => 2.4
   *     (2.345).ceil(2); // => 2.35
   *
   *     (12345.67).ceil(-3); // => 13000
   *
   * @param {Number} [figure=0] 切り上げる位
   * @return {Number} 小数第 figure 位で切り上げた値
   */
  Number.prototype.$method("ceil",  function(figure) {
    figure = figure || 0;
    var base = Math.pow(10, figure);
    var temp = this * base;
    temp = Math.ceil(temp);
    return temp/base;
  });

  /**
   * @method floor
   * 指定した小数の位を切り下げた値を返します。
   *
   * 負の値を指定すると整数部の位を切り下げられます。
   *
   * ### Example
   *     (-1.27).floor(); // => -2
   *     (-1.87).floor(); // => -2
   *     
   *     (2.345).floor(); // => 2
   *     (2.345).floor(1); // => 2.3
   *     (2.345).floor(2); // => 2.34
   *
   *     (12345.67).floor(-3); // => 12000
   *
   * @param {Number} [figure=0] 切り下げる位
   * @return {Number} 小数第 figure 位で切り下げた値
   */
  Number.prototype.$method("floor",  function(figure) {
    figure = figure || 0;
    var base = Math.pow(10, figure);
    var temp = this * base;
    temp = Math.floor(temp);
    
    // ~~this
    // this|0
    
    return temp/base;
  });
  
  /**
   * @method toInt
   * 数値を整数に変換します。
   *
   * ### Example
   *     (42.195).toInt(); // => 42
   *
   * @return {Number} 整数値
   */
  Number.prototype.$method("toInt",  function() {
    return (this | 0);
  });
  
  /**
   * @method toHex
   * 数値を16進数表記にした文字列を返します。
   *
   * ### Example
   *     (26).toHex(); // => "1a"
   *     (-26).toHex(); // => "-1a"
   *     (26.25).toHex(); // => "1a.4"
   *
   * @return {String} 16進数表記の文字列
   */
  Number.prototype.$method("toHex",  function() {
    return this.toString(16);
  });
  
  /**
   * @method toBin
   * 数値を2進数表記にした文字列を返します。
   *
   * ### Example
   *     (6).toBin(); // => "110"
   *     (-6).toBin(); // => "-110"
   *     (0xA3).toBin(); // => "10100011"
   *     (6.25).toHex(); // => "110.01"
   *
   * @return {String} 2進数表記の文字列
   */
  Number.prototype.$method("toBin",  function() {
    return this.toString(2);
  });
  
  
  /**
   * @method toUnsigned
   * 数値を unsigned int 型に変換します。
   *
   * 数値を符号無し整数として評価した値を返します。  
   * Javascriptのビット演算では数値を符号付きの32bit整数として扱うため、RGBA を
   * 整数値で表現して演算する場合、期待通りの結果が得られない場合があります。
   * そこで本関数で unsigned int 型に変換することで期待通りの値を得ることができます。
   *
   * ### Example
   *     rgba = 0xfeffffff & 0xff000000; // => -33554432
   *     rgba.toHex(); // => "-2000000"
   *     rgba.toUnsigned().toHex(); // => "fe000000"
   *
   * @return {Number} unsigned int 型に変換した値
   */
  Number.prototype.$method("toUnsigned",  function() {
    return this >>> 0;
  });
  
  /**
   * @method padding
   * 指定した桁になるように文字を埋めます。
   *
   * ### Example
   *     (123).padding(5); // => "00123"
   *     (123).padding(5, "_"); // => "__123"
   *     (-12).padding(5); // => "-0012"
   *
   * @param {Number} n 桁数
   * @param {String} [ch="0"] 埋める文字
   * @return {String} 桁数を揃えた文字列
   */
  Number.prototype.$method("padding",  function(n, ch) {
    var str = this+'';
    n  = n-str.length;
    ch = (ch || '0')[0];
    
    while(n-- > 0) { str = ch + str; }
    
    if (str.indexOf("-") >= 0) {
      str = "-" + str.replace("-", "");
    }

    return str;
  });


  /**
   * @method times
   * 0 から自分自身の数-1まで、カウンタをインクリメントしながら関数を繰り返し実行します。
   *
   * ### Example
   *     arr = [];
   *     (5).times(function(i){
   *       arr.push(i);
   *     }); // => [0, 1, 2, 3, 4]
   *
   * @param {Function} fn コールバック関数
   * @param {Object} [self=this] 関数内で this として参照される値。デフォルトは自分自身。
   */
  Number.prototype.$method("times",  function(fn, self) {
    self = self || this;
    for (var i=0; i<this; ++i) {
      fn.call(self, i, this);
    }
    return this;
  });

  /**
   * @method upto
   * 自分自身の数から指定した数まで、カウンタをインクリメントしながら関数を繰り返し実行します。
   *
   * 指定した数が自分自身の数より小さい場合は関数は実行されません。
   *
   * ### Example
   *     arr = [];
   *     (6).upto(8, function(i){
   *       arr.push(i);
   *     });
   *     arr; // => [6, 7, 8]
   *
   *     (3).upto(0, function(i){
   *       arr.push(i);
   *     });
   *     arr; // => [6, 7, 8]
   *
   * @param {Function} fn コールバック関数。引数にカウンタが渡される。
   * @param {Object} [self=this] 関数内で this として参照される値。デフォルトは自分自身。
   */
  Number.prototype.$method("upto",  function(t, fn, self) {
    self = self || this;
    for (var i=+this; i<=t; ++i) {
      fn.call(self, i, this);
    }
    return this;
  });
  
  /**
   * @method downto
   * 自分自身の数から指定した数まで、カウンタをデクリメントしながら関数を繰り返し実行します。
   *
   * 指定した数が自分自身の数より大きい場合は関数は実行されません。
   *
   * ### Example
   *     arr = [];
   *     (7).downto(4, function(i){
   *       arr.push(i);
   *     }); // => [7, 6, 5, 4]
   *
   * @param {Function} fn コールバック関数。引数にカウンタが渡される。
   * @param {Object} [self=this] 関数内で this として参照される値。デフォルトは自分自身。
   */
  Number.prototype.$method("downto",  function(t, fn, self) {
    self = self || this;
    for (var i=+this; i>=t; --i) {
      fn.call(self, i, this);
    }
    return this;
  });

  /**
   * @method step
   * 自分自身の値から指定した数まで、カウンタを増分させながら関数を繰り返し実行します。
   *
   * 上限値や増分値は float 型を指定することができます。
   *
   * ### Example
   *     var arr = [];
   *     (2.4).step(5.3, 0.8, function(n) {
   *       arr.push(n);
   *      }); // => [2.4, 3.2, 4.0, 4.8]
   *
   * @param {Number} limit カウンタの上限値
   * @param {Number} step カウンタを増分する量
   * @param {Function} fn コールバック関数。引数にカウンタが渡される。
   * @param {Object} [self=this] 関数内で this として参照される値。デフォルトは自分自身。
   */
  Number.prototype.$method("step",  function(limit, step, fn, self) {
    self = self || this;
    for (var i=+this; i<=limit; i+=step) {
      fn.call(self, i, this);
    }
    return this;
  });

  /**
   * @method map
   * 0から自分自身の値-1までカウンタをインクリメントさせながらコールバック関数を繰り返し実行し、
   * その返り値を要素とする配列を生成します。
   *
   * ### Example
   *     (5).map(function(i) {
   *       return i*i;
   *     }); // => [0, 1, 4, 9, 16]
   *
   * @param {Function} fn コールバック関数。引数にカウンタが渡される。
   * @param {Object} [self=this] 関数内で this として参照される値。デフォルトは自分自身。
   * @return {Array} 生成した配列
   */
  Number.prototype.$method("map",  function(fn, self) {
    self = self || this;

    var results = [];
    for (var i=0; i<this; ++i) {
      var r = fn.call(self, i);
      results.push(r);
    }
    return results;
  });

  /**
   * @method abs
   * 絶対値を返します。
   *
   * ### Example
   *     (-5).abs(); // => 5
   *     (+5).abs(); // => 5
   *
   * @return {Number} 絶対値
   */
  Number.prototype.$method("abs", function() { return Math.abs(this) });

  /**
   * @method acos
   * アークコサイン（ラジアン単位）を返します。
   *
   * ### Example
   *     (0).asin(); // => 0
   *     (1).asin(); // => 1.5707963267948966
   *
   * @return {Number} アークコサイン
   */
  Number.prototype.$method("acos", function() { return Math.acos(this) });

  /**
   * @method asin
   * アークサイン（ラジアン単位）を返します。
   *
   * ### Example
   *     (1).acos(); // => 0
   *     (-1).acos(); // => 3.141592653589793
   *
   * @return {Number} アークサイン
   */
  Number.prototype.$method("asin", function() { return Math.asin(this) });

  /**
   * @method atan
   * アークタンジェント（ラジアン単位）を返します。
   *
   * ### Example
   *     (0).atan(); // => 0
   *     (1).atan(); // => 0.7853981633974483
   *
   * @return {Number} アークタンジェント
   */
  Number.prototype.$method("atan", function() { return Math.atan(this) });

  /**
   * @method cos
   * コサイン（ラジアン単位）を返します。
   *
   * ### Example
   *     (Math.PI/3).cos(); // => 0.5
   *
   * @return {Number} コサイン
   */
  Number.prototype.$method("cos", function() { return Math.cos(this) });

  /**
   * @method exp
   * e<sup>this</sup> を返します。ここで e は自然対数の底であるネイピア数（オイラー数）です。
   *
   * ### Example
   *     (2).exp(); // => e<sup>2</sup>
   *     (0).exp(); // => 1
   *
   * @return {Number} e<sup>x</sup>
   */
  Number.prototype.$method("exp", function() { return Math.exp(this) });

  /**
   * @method log
   * 自然対数を返します。
   *
   * ### Example
   *     (Math.E * Math.E * Math.E).log(); // => 3
   *     (1).log(); // => 0
   *     (0).log(); // => -Infinity
   *
   * @return {Number} 自然対数
   */
  Number.prototype.$method("log", function() { return Math.log(this) });

  /**
   * @method max
   * 自分自身と引数の値を比べ、大きい方の値を返します。
   *
   * ### Example
   *     (15).max(10); // => 15
   *     (15).max(90); // => 90
   *
   * @param {Number} value 比較する値
   * @return {Number} 最大値
   */
  Number.prototype.$method("max", function(value) { return Math.max(this, value) });

  /**
   * @method min
   * 自分自身と引数の値を比べ、小さい方の値を返します。
   *
   * ### Example
   *     (15).min(10); // => 10
   *     (15).min(90); // => 15
   *
   * @param {Number} value 比較する値
   * @return {Number} 最小値
   */
  Number.prototype.$method("min", function(value) { return Math.min(this, value) });

  /**
   * @method clamp
   * 指定した範囲に収めた値を返します。
   *
   * ### Example
   *     (200).clamp(0, 640); // => 200
   *     (-15).clamp(0, 640); // => 0
   *     (999).clamp(0, 640); // => 640
   *
   * @param {Number} min 範囲の下限
   * @param {Number} max 範囲の上限
   * @return {Number} 範囲内に収めた値
   */
  Number.prototype.$method("clamp", function(min, max) { return Math.clamp(this, min, max) });

  /**
   * @method pow
   * 自分自身を exponent 乗した値、つまり this<sup>exponent</sup> の値を返します。
   *
   * ### Example
   *     (3).pow(2); // => 9
   *
   * @param {Number} exponent 累乗する指数
   * @return {Number} 累乗した結果の値
   */
  Number.prototype.$method("pow", function(exponent) { return Math.pow(this, exponent) });

  /**
   * @method sin
   * サイン（ラジアン単位）を返します。
   *
   * ### Example
   *     (Math.PI/4).sin(); // => 0.7071067811865476
   *
   * @return {Number} サイン
   */
  Number.prototype.$method("sin", function() { return Math.sin(this) });

  /**
   * @method sqrt
   * 平方根を返します。
   *
   * ### Example
   *     (49).sqrt(); // => 7
   *
   * @return {Number} 平方根
   */
  Number.prototype.$method("sqrt", function() { return Math.sqrt(this) });

  /**
   * @method tan
   * タンジェント（ラジアン単位）を返します。
   *
   * ### Example
   *     (Math.PI/4).tan(); // => 1.0
   *
   * @return {Number} タンジェント
   */
  Number.prototype.$method("tan", function() { return Math.tan(this) });

  /**
   * @method toDegree
   * ラジアンを度に変換します。
   *
   * ### Example
   *     Math.radToDeg(Math.PI/4); // => 45
   *
   * @return {Number} 度
   */
  Number.prototype.$method("toDegree", function() { return (this*Math.RAD_TO_DEG); });

  /**
   * @method toRadian
   * 度をラジアンに変換します。
   *
   * ### Example
   *     (180).toRadian(); // => 3.141592653589793
   *
   * @return {Number} ラジアン
   */
  Number.prototype.$method("toRadian", function() { return this*Math.DEG_TO_RAD; });

})();


/*
 * string.js
 */


;(function() {
  /**
   * @class global.String
   * # 拡張した String クラス
   * 文字列を扱う String クラスを拡張しています。
   */

  /**
   * @method format
   * フォーマットに引数を適用した文字列を返します。
   *
   * 引数がオブジェクトの場合、"{プロパティ名}" がオブジェクトのプロパティの値に置き換わります。
   * 指定したプロパティがオブジェクトにない場合は空文字列になります。
   *
   * 第1引数がオブジェクトでなかった場合、"{整数}" が各引数に置き換わります。
   * 指定した値の引数がなかった場合は空文字列になります。
   *
   * ### Example
   *     obj = {r: 128, g: 0, b: 255};
   *     "color: rgb({r}, {g}, {b});".format(obj); // => "color: rgb(128, 0, 255);"
   *
   *     "{0} + {1} = {2}".format(5, 8, (5+8)); // => "5 + 8 = 13"
   *
   * @param {Object} obj パラメータとなるオブジェクト
   * @return {String} 生成した文字列
   */
  String.prototype.$method("format", function(arg) {
    // 置換ファンク
    var rep_fn = undefined;
    
    // オブジェクトの場合
    if (typeof arg == "object") {
      /** @ignore */
      rep_fn = function(m, k) {
        if (arg[k] === undefined) {
          return '';
        }
        else {
          return arg[k];
        }
      };
    }
    // 複数引数だった場合
    else {
      var args = arguments;
      /** @ignore */
      rep_fn = function(m, k) {
        var v = args[ parseInt(k) ];
        if (v !== undefined && v !== null) {
          return v;
        }
        else {
          return '';
        }
      };
    }
    
    return this.replace( /\{(\w+)\}/g, rep_fn );
  });


  /**
   * @method trim
   * 文字列先頭と末尾の空白文字を全て取り除いた文字列を返します。
   *
   * ###Reference
   * - [String Functions for Javascript – trim, to camel case, to dashed, and to underscore](http://jamesroberts.name/blog/2010/02/22/string-functions-for-javascript-trim-to-camel-case-to-dashed-and-to-underscore/)
   *
   * ### Example
   *     "  Hello, world!  ".trim(); // => "Hello, world!"
   *
   * @return {String} トリムした結果の文字列
   */
  String.prototype.$method("trim", function() {
    return this.replace(/^\s+|\s+$/g, "");
  });
  
  /**
   * @method capitalize
   * キャピタライズした文字列、すなわち、すべての単語の先頭を大文字にした文字列を返します。
   *
   * 単語の先頭以外は小文字化されます。
   *
   * ###Reference
   * - [キャピタライズ(単語の先頭の大文字化)を行う - oct inaodu](http://d.hatena.ne.jp/brazil/20051212/1134369083)  
   * - [デザインとプログラムの狭間で: javascriptでキャピタライズ（一文字目を大文字にする）](http://design-program.blogspot.com/2011/02/javascript.html)
   *
   * ### Example
   *     "i aM a pen.".capitalize(); // => "I Am A Pen."
   *
   * @return {String} キャピタライズした文字列
   */
  String.prototype.$method("capitalize", function() {
    return this.replace(/\w+/g, function(word){
      return word.capitalizeFirstLetter();
    });
  });
  
  /**
   * @method capitalizeFirstLetter
   * 先頭の文字を大文字にして、それ以外を小文字にした文字列を返します。
   *
   * ### Example
   *     "i aM a pen.".capitalizeFirstLetter(); // "I am a pen."
   *
   * @return {String} 先頭の文字を大文字にして、それ以外を小文字にした文字列
   */
  String.prototype.$method("capitalizeFirstLetter", function() {
    return this.charAt(0).toUpperCase() + this.substr(1).toLowerCase();
  });
  
  /**
   * @method toDash
   * 文字列内の大文字を「"-" + 小文字」に変換します。
   *
   * css2properties（element.style）の各プロパティ名を CSS のプロパティ名に変換する場合に便利です。
   *
   * ### Example
   *     "borderTopColor".toDash(); // => "border-top-color"
   *
   *  @return {String} 変換後の文字列
   */
  String.prototype.$method("toDash", function() {
    return this.replace(/([A-Z])/g, function(m){ return '-'+m.toLowerCase(); });
  });
  
  
  /**
   * @method toHash
   * ハッシュ値を生成して返します。
   *
   * ### Example
   *     "phina.js".toHash(); // => 2676327394
   *
   * @return {Number} CRC32ハッシュ値
   */
  String.prototype.$method("toHash", function() {
    return this.toCRC32();
  });
  
  /**
   * @method padding
   * 左に文字を埋めて指定した桁にします。this の文字列は右寄せされます。
   *
   * ### Example
   *     "1234".padding(10);      // => "      1234"
   *     "1234".padding(10, '0'); // => "0000001234"
   *
   * @param {Number} figure 桁数
   * @param {String} [ch=" "] 埋める文字
   * @return {String} 指定した桁の文字列
   */
  String.prototype.$method("padding", function(n, ch) {
    var str = this.toString();
    n  = n-str.length;
    ch = (ch || ' ')[0];
    
    while(n-- > 0) { str = ch + str; }
    
    return str;
  });
  
  /**
   * @method paddingLeft
   * 左に文字を埋めて指定した桁にします。this の文字列を右寄せされます。
   *
   * {@link #padding} と同じです。
   * @inheritdoc #padding
   */
  String.prototype.$method("paddingLeft", function(n, ch) {
    var str = this.toString();
    n  = n-str.length;
    ch = (ch || ' ')[0];
    
    while(n-- > 0) { str = ch + str; }
    
    return str;
  });
  
  /**
   * @method paddingRight
   * 右に文字を埋めて指定した桁にします。this の文字列は左寄せされます。
   *
   * ### Example
   *     "1234".paddingRight(10);      // => "1234      "
   *     "1234".paddingRight(10, '0'); // => "1234000000"
   *
   * @param {Number} figure 桁数
   * @param {String} [ch=" "] 埋める文字
   * @return {String} 指定した桁の文字列
   */
  String.prototype.$method("paddingRight", function(n, ch) {
    var str = this.toString();
    n  = n-str.length;
    ch = (ch || ' ')[0];
    
    while(n-- > 0) { str = str + ch; }
    
    return str;
  });
  
  /**
   * @method quotemeta
   * 正規表現のメタ文字をクォートします。
   *
   * ### Example
   *     "Hello world. (can you hear me?)".quotemeta(); // => "Hello\\ world\\.\\ \\(can\\ you\\ hear\\ me\\?\\)"
   *
   *  @return {String} クォートされた文字列
   */
  String.prototype.$method("quotemeta", function(n) {
    return this.replace(/([^0-9A-Za-z_])/g, '\\$1');
  });
  
  /**
   * @method repeat
   * 自分自身を指定した回数だけ繰り返した文字列を返します。
   *
   * ### Example
   *     "Abc".repeat(4); // => "AbcAbcAbcAbc"
   *
   * @param {Number} n 繰り返し回数
   * @return {String} 文字列
   */
  String.prototype.$method("repeat", function(n) {
    // TODO: 確認する
    var arr = Array(n);
    for (var i=0; i<n; ++i) arr[i] = this;
    return arr.join('');
  });
  
  /**
   * @method count
   * 指定した文字列が何個入っているかをカウントして返します。
   *
   * 大文字・小文字は区別されます。
   *
   * ### Example
   *     "This is a string. Isn't it?".count("is"); // => 2
   *
   * @param {String} str 調べる文字列
   * @return {Number} this に str が入っている個数
   */
  String.prototype.$method("count", function(str) {
    var re = new RegExp(str, 'gm');
    return this.match(re).length;
  });
  
  /**
   * @method include
   * 指定した文字列が含まれているかどうかを返します。
   *
   * 大文字・小文字は区別されます。
   *
   * ### Example
   *     "This is a string.".include("is"); // => true
   *     "This is a string.".include("was"); // => false
   *
   * @param {String} str 調べる文字列
   * @return {Boolean} 含まれているかどうか
   */
  String.prototype.$method("include", function(str) {
    return this.indexOf(str) != -1;
  });
  
  /**
   * @method each
   * 各文字を順番に渡しながら関数を繰り返し実行します。
   *
   * ### Example
   *     str = 'abc';
   *     str.each(function(ch) {
   *       console.log(ch);
   *     });
   *     // => 'a'
   *     //    'b'
   *     //    'c'
   *
   * @param {Function} callback 各要素に対して実行するコールバック関数
   * @param {Object} [self=this] callback 内で this として参照される値
   */
  String.prototype.$method("each", function() {
    Array.prototype.forEach.apply(this, arguments);
    return this;
  });
  
  /**
   * @method toArray
   * 1文字ずつ分解した配列を返します。
   *
   * ### Example
   *     "12345".toArray(); // => ["1", "2", "3", "4", "5"]
   *     "あいうえお".toArray(); // => "あ", "い", "う", "え", "お"]
   *
   * @return {String[]} 配列
   */
  String.prototype.$method("toArray", function() {
    var arr = [];
    for (var i=0,len=this.length; i<len; ++i) {
      arr.push(this[i]);
    }
    return arr;
  });
  
  /**
   * @method toObject
   * キーと値の組み合わせが連結された文字列からオブジェクトを生成します。
   *
   * 値は Number、Boolean、String のいずれかの型として評価されます。
   *
   * ### Example
   *     obj1 = "num=128.5&flag1=true&flag2=false&str=hoge";
   *     obj1.toObject(); // => {num: 128.5, flag1: true, flag2: false, str: "hoge" }
   *     
   *     obj2 = "num:-64.5|flag1:false|flag2:true|str:foo";
   *     obj2.toObject('|', ':'); // => {num: -64.5, flag1: false, flag2: true, str: "foo" }
   *
   * @param {String} [sep="&"] セパレータ文字
   * @param {String} [eq=""] キーと値の組み合わせを表す文字
   * @return {Object} オブジェクト
   */
  String.prototype.$method("toObject", function(sep, eq) {
    sep = sep || '&';
    eq  = eq || '=';

    var obj = {};
    var params = this.split(sep);
    params.each(function(str, i) {
      var pos = str.indexOf(eq);
      if (pos > 0) {
        var key = str.substring(0, pos);
        var val = str.substring(pos+1);
        var num = Number(val);

        if (!isNaN(num)) {
          val = num;
        }
        else if (val === 'true') {
          val = true;
        }
        else if (val === 'false') {
          val = false;
        }

        obj[key] = val;
      }
    });

    return obj;
  });
  
  var table = "00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".split(' ');
  
  /**
   * @method toCRC32
   * 文字列の CRC32 を計算します。
   *
   * ### Example
   *     "phina.js".toCRC32(); // => 2676327394
   *
   * @return {Number} CRC32 ハッシュ値
   */
  String.prototype.$method("toCRC32", function() {
    var crc = 0, x=0, y=0;
    
    crc = crc ^ (-1);
    for (var i=0, iTop=this.length; i<iTop; ++i) {
      y = (crc ^ this.charCodeAt(i)) & 0xff;
      x = "0x" + table[y];
      crc = (crc >>> 8) ^ x;
    }
    
    return (crc ^ (-1)) >>> 0;
  });

})();


/*
 * array.js
 */

;(function() {

  /**
   * @class global.Array
   * # 拡張した Array クラス
   * Array クラスを拡張しています。
   */


  /**
   * @property {Object} first
   * 最初の要素
   *
   * ### Example
   *     arr = [6, 5, 2, 3, 1, 4];
   *     arr.first; // => 6
   */
  Array.prototype.accessor("first", {
      "get": function()   { return this[0]; },
      "set": function(v)  { this[0] = v; }
  });
  
  /**
   * @property {Object} last
   * 最後の要素
   *
   * ### Example
   *     arr = [6, 5, 2, 3, 1, 4];
   *     arr.last; // => 4
   */
  Array.prototype.accessor("last", {
    "get": function()   { return this[this.length-1]; },
    "set": function(v)  { this[this.length-1] = v; }
  });

  /**
   * @method equals
   * 渡された配列と等しいかどうかをチェックします。
   *
   * 要素同士を === で比較します。要素に配列が含まれている場合は {@link #deepEquals} を使用してください。
   *
   * ### Example
   *     arr1 = [6, 5, 2, 3, 1, 4];
   *     arr1.equals([6, 5, 2, 3, 1, 4]);       // => true
   *     arr2 = [6, 5, 2, [3, 1], 4];
   *     arr2.equals([6, 5, 2, [3, 1], 4]);     // => false
   *     arr2.deepEquals([6, 5, 2, [3, 1], 4]); // => true
   *
   * @param {Array} arr 比較する対象の配列
   * @return {Boolean} チェックの結果
   */
  Array.prototype.$method("equals", function(arr) {
    // 長さチェック
    if (this.length !== arr.length) return false;
    
    for (var i=0,len=this.length; i<len; ++i) {
      if (this[i] !== arr[i]) {
        return false;
      }
    }

    return true;
  });

  /**
   * @method deepEquals
   * ネストされている配列を含め、渡された配列と等しいかどうかをチェックします。
   *
   * ※equalsDeep にするか検討. (Java では deepEquals なのでとりあえず合わせとく)
   *
   * ### Example
   *     arr = [6, 5, 2, [3, 1], 4];
   *     arr.equals([6, 5, 2, [3, 1], 4]);     // => false
   *     arr.deepEquals([6, 5, 2, [3, 1], 4]); // => true
   *
   * @param {Array} arr 比較する対象の配列
   * @return {Boolean} チェックの結果
   */
  Array.prototype.$method("deepEquals", function(arr) {
    // 長さチェック
    if (this.length !== arr.length) return false;
    
    for (var i=0,len=this.length; i<len; ++i) {
      var result = (this[i].deepEquals) ? this[i].deepEquals(arr[i]) : (this[i] === arr[i]);
      if (result === false) {
        return false;
      }
    }
    return true;
  });

  /**
   * @method contains
   * 指定した要素が配列に含まれているかをチェックします。
   *
   * 比較には厳密な同値（三重イコール演算子 === で使われるのと同じ方法）を用います。
   *
   * ### Example
   *     arr = [6, 5, 2, 3, 1, 4];
   *     arr.contains(3);     // => true
   *     arr.contains(3, 4);  // => false
   *     arr.contains(3, -4); // => true
   *     arr.contains("6");   // => false
   *
   * @param {Object} item チェックするオブジェクト
   * @param {Number} [fromIndex=0] 検索を始める位置。負数を指定した場合は末尾からのオフセットと見なします。
   * @return {Boolean} チェックの結果
   */
  Array.prototype.$method("contains", function(item, fromIndex) {
    return this.indexOf(item, fromIndex) != -1;
  });
  
  /**
   * @method at
   * 指定したインデックスの要素を返します（ループ・負数の指定可）。
   *
   * 添字が負数の場合は末尾からのオフセットとみなします。末尾の要素が -1 番目になります。  
   * 添字の絶対値が Array.length 以上の場合はループします。
   *
   * ### Example
   *     arr = ['a', 'b', 'c', 'd', 'e', 'f'];
   *     arr.at(0);  // => 'a'
   *     arr.at(6);  // => 'a'
   *     arr.at(13); // => 'b'
   *     arr.at(-1); // => 'f'
   *     arr.at(-8); // => 'e'
   *
   * @param {Number} index 添字
   * @return {Object} 添字で指定された要素
   */
  Array.prototype.$method("at", function(i) {
    i%=this.length;
    i+=this.length;
    i%=this.length;
    return this[i];
  });


  /**
   * @method find
   * 各要素を引数にして関数を実行し、その値が真となる（＝条件にマッチする）最初の要素を返します。
   *
   * どの要素もマッチしなければ undefined を返します。
   *
   * ### Example
   *     arr = ['foo', 'bar', 'hoge', 'fuga'];
   *     arr.find( function(elm) {
   *       return elm.indexOf('a') >= 0;
   *     });
   *     // => 'bar'
   *
   * @param {Function} callback 各要素に対して実行するコールバック関数
   * @param {Object} [self=this] callback 内で this として参照される値。デフォルトは呼び出し時の this。
   * @return {Object} 条件にマッチした最初の要素、または undefined
   */
  Array.prototype.$method("find", function(fn, self) {
    var target = null;

    this.some(function(elm, i) {
      if (fn.call(self, elm, i, this)) {
        target = elm;
        return true;
      }
    });

    return target;
  });

  /**
   * @method findIndex
   * 各要素を引数にして関数を実行し、その値が真となる（＝条件にマッチする）最初のインデックスを返します。
   *
   * どの要素もマッチしなければ -1 を返します。
   *
   * ### Example
   *     arr = ['foo', 'bar', 'hoge', 'fuga'];
   *     arr.findIndex( function(elm) {
   *       return elm.indexOf('a') >= 0;
   *     });
   *     // => 1
   *
   * @param {Function} callback 各要素に対して実行するコールバック関数
   * @param {Object} [self=this] callback 内で this として参照される値。デフォルトは呼び出し時の this。
   * @return {Object} 条件にマッチした最初のインデックス、または -1
   */
  Array.prototype.$method("findIndex", function(fn, self) {
    var target = -1;

    this.some(function(elm, i) {
      if (fn.call(self, elm, i, this)) {
        target = i;
        return true;
      }
    });

    return target;
  });
  
  /**
   * @method swap
   * @chainable
   * a 番目の要素 と b 番目の要素を入れ替えます。
   *
   * ### Example
   *     arr1 = ['a', 'b', 'c', 'd'];
   *     arr2 = arr1.swap(0, 3); // => ['d', 'b', 'c', 'a']
   *     arr1 === arr2;          // => true
   *
   * @param {Number} a  インデックス
   * @param {Number} b  インデックス
   */
  Array.prototype.$method("swap", function(a, b) {
    var temp = this[a];
    this[a] = this[b];
    this[b] = temp;
    
    return this;
  });

  /**
   * @method erase
   * @chainable
   * 指定したオブジェクトと一致した最初の要素を削除します。
   *
   * ### Example
   *     arr1 = ['a', 'b', 'b', 'c'];
   *     arr2 = arr1.erase('b'); // => ['a', 'b', 'c']
   *     arr1 === arr2;          // => true
   *
   * @param {Object} elm 削除したいオブジェクト
   */
  Array.prototype.$method("erase", function(elm) {
    var index  = this.indexOf(elm);
    if (index >= 0) {
      this.splice(index, 1);
    }
    return this;
  });
  
  /**
   * @method eraseAll
   * @chainable
   * 指定したオブジェクトと一致したすべての要素を削除します。
   *
   * ### Example
   *     arr1 = ['a', 'b', 'b', 'c'];
   *     arr2 = arr1.eraseAll('b'); // => ['a', 'c']
   *     arr1 === arr2;             // => true
   *
   * @param {Object} elm 削除したいオブジェクト
   */
  Array.prototype.$method("eraseAll", function(elm) {
    for (var i=0,len=this.length; i<len; ++i) {
      if (this[i] == elm) {
        this.splice(i--, 1);
      }
    }
    return this;
  });
  
  /**
   * @method eraseIf
   * @chainable
   * 各要素を引数にして関数を実行し、その値が真となる（＝条件にマッチする）最初の要素を削除します。
   *
   * どの要素もマッチしなければ何も起きません。
   *
   * ### Example
   *     arr = ['foo', 'bar', 'hoge', 'fuga'];
   *     arr.eraseIf( function(elm) {
   *       return elm.indexOf('o') >= 0;
   *     });
   *     // => ['bar', 'hoge', 'fuga']
   *
   * @param {Function} callback 各要素に対して実行するコールバック関数
   */
  Array.prototype.$method("eraseIf", function(fn) {
    for (var i=0,len=this.length; i<len; ++i) {
      if ( fn(this[i], i, this) ) {
        this.splice(i, 1);
        break;
      }
    }
    return this;
  });
  
  /**
   * @method eraseIfAll
   * @chainable
   * 各要素を引数にして関数を実行し、その値が真となる（＝条件にマッチする）すべての要素を削除します。
   *
   * どの要素もマッチしなければ何も起きません。
   *
   * ### Example
   *     arr = ['foo', 'bar', 'hoge', 'fuga'];
   *     arr.eraseIfAll( function(elm) {
   *       return elm.indexOf('o') >= 0;
   *     });
   *     // => ['bar', 'fuga']
   *
   * @param {Function} callback 各要素に対して実行するコールバック関数
   */
  Array.prototype.$method("eraseIfAll", function(fn) {
    for (var i=0,len=this.length; i<len; ++i) {
      if ( fn(this[i], i, this) ) {
        this.splice(i--, 1);
        len--;
      }
    }
    return this;
  });
  
  /**
   * @method random
   * 配列からランダムに1つ取り出した要素を返します。
   *
   * 取り出す範囲をインデックスで指定することもできます。  
   * {@link #pickup}、{@link #lot} と同じです。  
   *
   * ### Example
   *     arr = ['foo', 'bar', 'hoge', 'fuga'];
   *     arr.random(2, 3);  // => 'hoge' または 'fuga'
   *
   * @param {Number} [min=0] インデックスの下限
   * @param {Number} [max=配列の最大インデックス] インデックスの上限
   * @return {Object} ランダムに1つ取り出した要素
   */
  Array.prototype.$method("random", function(min, max) {
    min = min || 0;
    max = max || this.length-1;
    return this[ Math.randint(min, max) ];
  });
  
  /**
   * @method pickup
   * 配列からランダムで1つ取り出した要素を返します。
   *
   * {@link #random}、{@link #lot} と同じです。
   * @inheritdoc #random
   */
  Array.prototype.$method("pickup", function(min, max) {
    min = min || 0;
    max = max || this.length-1;
    return this[ Math.randint(min, max) ];
  });
  
  /**
   * @method lot
   * 配列からランダムで1つ取り出した要素を返します。
   *
   * {@link #random}、{@link #pickup} と同じです。
   * @inheritdoc #random
   */
  Array.prototype.$method("lot", function(min, max) {
    min = min || 0;
    max = max || this.length-1;
    return this[ Math.randint(min, max) ];
  });
  
  /**
   * @method uniq
   * 要素の重複を取り除いた配列を生成して返します。
   *
   * 自分自身は破壊されません。
   *
   * ### Example
   *     arr = [1, 2, 3, 4, 3, 2];
   *     arr.uniq(); // => [1, 2, 3, 4]
   *
   * @param {Number} [deep] ※未使用
   * @return {Object} 新しい配列
   */
  Array.prototype.$method("uniq", function(deep) {
    return this.filter(function(value, index, self) {
      return self.indexOf(value) === index;
    });
  });
  

  /**
   * @method flatten
   * 自身を再帰的に平滑化した配列を生成して返します。
   *
   * level を指定しなければ深さの際限なく完全に平滑化します。
   *
   * ### Example
   *     arr = [1, 2, [3, [4, 5]]];
   *     arr.flatten();  // => [1, 2, 3, 4, 5]
   *     arr.flatten(1); // => [1, 2, 3, [4, 5]]
   *
   * @param {Number} [level=0]  平滑化の再帰の深さ
   * @return {Object} 平滑化した配列
   */
  Array.prototype.$method("flatten", function(level) {
    var arr = null;

    if (level) {
      arr = this;
      for (var i=0; i<level; ++i) {
        arr = Array.prototype.concat.apply([], arr);
      }
    }
    else {
      // 完全フラット
      arr = this.reduce(function (previousValue, curentValue) {
        return Array.isArray(curentValue) ?
          previousValue.concat(curentValue.flatten()) : previousValue.concat(curentValue);
      }, []);
    }

    return arr;
  });

  /**
   * @method clone
   * 自身のコピーを生成して返します。
   *
   * ### Example
   *     arr1 = [1, 2, [3, 4]];
   *     arr2 = arr1.clone();      // => [1, 2, [3, 4]]
   *     arr1[2] === arr2[2];      // => true
   *     arr1[2][0] = 9;
   *     arr2;                     // => [1, 2, [9, 4]]
   *     arr1 = [1, 2, [3, 4]];
   *     arr2 = arr1.clone(true);  // => [1, 2, [3, 4]]
   *     arr1[2] === arr2[2];      // => false
   *     arr1[2][0] = 9;
   *     arr2;                     // => [1, 2, [3, 4]]
   *
   * @param {Boolean} [deep=false] 配列のネストをたどって複製するかどうか
   * @return {Object} 新しい配列
   */
  Array.prototype.$method("clone", function(deep) {
    if (deep === true) {
      var a = Array(this.length);
      for (var i=0,len=this.length; i<len; ++i) {
        a[i] = (this[i].clone) ? this[i].clone(deep) : this[i];
      }
      return a;
    }
    else {
      return Array.prototype.slice.apply(this);
    }
  });


  /**
   * @method clear
   * @chainable
   * 自身を空の配列にします。
   *
   * ### Example
   *     arr = [1, 2, [3, 4]];
   *     arr.clear(); // => []
   */
  Array.prototype.$method("clear", function() {
    this.length = 0;
    return this;
  });
  
  /**
   * @method fill
   * @chainable
   * 自身の一部の要素を特定の値で埋めます。
   *
   * ### Example
   *     arr = [1, 2, 3, 4, 5];
   *     arr.fill("x");       // => ["x", "x", "x", "x", "x"]
   *     arr.fill("x", 2, 4); // => [1, 2, "x", "x", 5]
   *
   * @param {Object} value 埋める値
   * @param {Number} [start=0] 値を埋める最初のインデックス
   * @param {Number} [end=自身の配列の長さ] 値を埋める最後のインデックス+1
   */
  Array.prototype.$method("fill", function(value, start, end) {
    start = start || 0;
    end   = end   || (this.length);
    
    for (var i=start; i<end; ++i) {
      this[i] = value;
    }
    
    return this;
  });
  

  /**
   * @method range
   * @chainable
   * 自身を等差数列（一定間隔の整数値の列）とします。
   *
   * - 引数が1つの場合、0～end（end含まず）の整数の配列です。  
   * - 引数が2つの場合、start～end（end含まず）の整数の配列です。  
   * - 引数が3つの場合、start～end（end含まず）かつ start + n * step (nは整数)を満たす整数の配列です。
   *
   * ### Example
   *     arr = [];
   *     arr.range(4);        // => [0, 1, 2, 3]
   *     arr.range(2, 5);     // => [2, 3, 4]
   *     arr.range(2, 14, 5); // => [2, 7, 12]
   *     arr.range(2, -3);    // => [2, 1, 0, -1, -2]
   *
   * @param {Number} start 最初の値（デフォルトは 0）
   * @param {Number} end 最後の値（省略不可）
   * @param {Number} [step=1または-1] 間隔
   */
  Array.prototype.$method("range", function(start, end, step) {
    this.clear();
    
    if (arguments.length == 1) {
      for (var i=0; i<start; ++i) this[i] = i;
    }
    else if (start < end) {
      step = step || 1;
      if (step > 0) {
        for (var i=start, index=0; i<end; i+=step, ++index) {
          this[index] = i;
        }
      }
    }
    else {
      step = step || -1;
      if (step < 0) {
        for (var i=start, index=0; i>end; i+=step, ++index) {
          this[index] = i;
        }
      }
    }
    
    return this;
  });
  
  /**
   * @method shuffle
   * @chainable
   * 自身の要素をランダムにシャッフルします。
   *
   * ### Example
   *     arr = [1, 2, 3, 4, 5];
   *     arr.shuffle(); // => [5, 1, 4, 2, 3] など
   */
  Array.prototype.$method("shuffle", function() {
    for (var i=0,len=this.length; i<len; ++i) {
      var j = Math.randint(0, len-1);
      
      if (i != j) {
        this.swap(i, j);
      }
    }
    
    return this;
  });

  /**
   * @method sum
   * 要素の合計値を返します。
   *
   * 要素に数値以外が含まれる場合の挙動は不定です。
   *
   * ### Example
   *     arr = [1, 2, 3, 4, 5, 6];
   *     arr.sum(); // => 21
   *
   * @return {Number} 合計
   */
  Array.prototype.$method("sum", function() {
    var sum = 0;
    for (var i=0,len=this.length; i<len; ++i) {
      sum += this[i];
    }
    return sum;
  });

  /**
   * @method average
   * 要素の平均値を返します。
   *
   * 要素に数値以外が含まれる場合の挙動は不定です。
   *
   * ### Example
   *     arr = [1, 2, 3, 4, 5, 6]
   *     arr.average(); // => 3.5
   *
   * @return {Number} 平均値
   */
  Array.prototype.$method("average", function() {
    var sum = 0;
    var len = this.length;
    for (var i=0; i<len; ++i) {
      sum += this[i];
    }
    return sum/len;
  });

  /**
   * @method each
   * @chainable
   * 要素を順番に渡しながら関数を繰り返し実行します。
   *
   * メソッドチェーンに対応していますが、このメソッドによって自分自身は変化しません。
   *
   * ###Reference
   * - [Array.prototype.forEach() - JavaScript | MDN](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach)
   *
   * ### Example
   *     arr = [1, 2, 3];
   *     arr.each( function(elm) {
   *       console.log(elm * elm)
   *     });
   *     // => 1
   *     //    4
   *     //    9
   *
   * @param {Function} callback 各要素に対して実行するコールバック関数
   * @param {Object} [self=this] callback 内で this として参照される値
   */
  Array.prototype.$method("each", function() {
    this.forEach.apply(this, arguments);
    return this;
  });

  
  /**
   * @method toULElement
   * ULElement に変換します（未実装）
   */
  Array.prototype.$method("toULElement", function(){
      // TODO: 
  });

  /**
   * @method toOLElement
   * OLElement に変換します（未実装）
   */
  Array.prototype.$method("toOLElement", function(){
      // TODO:
  });

  
  /**
   * @method range
   * @static
   * インスタンスメソッドの {@link #range} と同じです。
   *
   * ### Example
   *     Array.range(2, 14, 5); // => [2, 7, 12]
   */
  Array.$method("range", function(start, end, step) {
    return Array.prototype.range.apply([], arguments);
  });


  /**
   * @method of
   * @static
   * ES6 準拠の of 関数です。可変長引数をとって Array オブジェクトにして返します。
   *
   * ### Example
   *     Array.of();        // => []
   *     Array.of(1, 2, 3); // => [1, 2, 3]
   *
   * @param {Object} elementN 生成する配列の要素
   * @return {Array} 生成した配列
   */
  Array.$method("of", function() {
    return Array.prototype.slice.call(arguments);
  });

  /**
   * @method from
   * @static
   * ES6 準拠の from 関数です。array-like オブジェクトかiterable オブジェクトから新しい配列を生成します。
   *
   * array-like オブジェクトとは、length プロパティを持ち、数字の添字でアクセス可能なオブジェクトのことです。
   * 通常の配列のほか、String、arguments、NodeList なども array-like オブジェクトです。
   *
   * iterable オブジェクトとは、Symbol.iterator プロパティを持つオブジェクトのことです。
   * 通常の配列のほか、String、arguments、NodeList なども iterable オブジェクトです。
   *
   * ### Example
   *     Array.from([1, 2, 3], function(elm){ return elm * elm} ); // => [1, 4, 9]
   *     Array.from("foo");                                        // => ["f", "o", "o"]
   *     Array.from( document.querySelectorAll("span"))            // => [Element, Element, Element,...]
   *
   * @param {Object} arrayLike 配列に変換する array-like オブジェクト
   * @param {Function} [callback] arrayLike のすべての要素に対して実行するマップ関数
   * @param {Object} [context] callback 内で this として参照される値
   * @return {Array} 生成した配列
   */
  Array.$method("from", function(arrayLike, callback, context) {
    if (!Object(arrayLike).length) return [];

    var result = [];
    if (Symbol && Symbol.iterator && arrayLike[Symbol.iterator]) {
        var iterator = arrayLike[Symbol.iterator]();
        while (true) {
            var iteratorResult = iterator.next();
            if (iteratorResult.done) break;

            var value = typeof callback === 'function' ? callback.bind(context || this)(iteratorResult.value) : iteratorResult.value;
            result.push(value);
        }
        return result;
    }

    for (var i = 0, len = arrayLike.length; i < len; i++) {
        result.push(arrayLike[i]);
    }
    return result.map(typeof callback == 'function' ? callback : function(item) {
      return item;
    }, context);
  });
  
  /**
   * @method most
   * 指定した関数の返り値が最小となる要素と最大となる要素をまとめて返します。
   *
   * 空の配列に対して実行すると {max: Infinity, min: -Infinity} を返します。
   *
   * ### Example
   *     [5,1,4,1,9,2,-10].most(); // => {max:9, min: -10}
   *
   *     points = [ {x:0, y:0}, {x:640, y:960}, {x:-80, y:100} ];
   *     points.most(function(e){return e.x;}).min; // => [x:-80, y:100]
   *     points.most(function(e){return e.y;}).max; // => [x:640, y:960]
   *
   * @param {Function} [callback] 各要素に対して実行するコールバック関数
   * @param {Object} [self=this] 関数内で this として参照される値。デフォルトは自分自身。
   * @return {Object} max と min をキーに持つオブジェクト
   * @return {Object} return.min 関数の返り値が最小となる要素
   * @return {Object} return.max 関数の返り値が最大となる要素
   */
  Array.prototype.$method("most", function(func, self) {
    if(this.length < 1){
      return {
        max: -Infinity,
        min: Infinity,
      };
    }
    if(func){
      var maxValue = -Infinity;
      var minValue = Infinity;
      var maxIndex = 0;
      var minIndex = 0;
      
      if(typeof self === 'undefined'){self = this;}
      
      for (var i = 0, len = this.length; i < len; ++i) {
        var v = func.call(self, this[i], i, this);
        if(maxValue < v){
          maxValue = v;
          maxIndex = i;
        }
        if(minValue > v){
          minValue = v;
          minIndex = i;
        }
      }
      return {
        max: this[maxIndex],
        min: this[minIndex],
      };
    }
    else{
      var max = -Infinity;
      var min = Infinity;
      for (var i = 0, len = this.length;i < len; ++i) {
        if(max<this[i]){max=this[i];}
        if(min>this[i]){min=this[i];}
      }
      return {
        max: max,
        min: min,
      };
    }
    
  });  

})();

/*
 * date.js
 */

(function() {
  
  /**
   * @class global.Date
   * # 拡張した Date クラス
   * 日付を扱う Date クラスを拡張しています。
   */
  
  var MONTH = [
    'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'
  ];
  
  var WEEK = [
    'Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'
  ];
  
  /**
   * @method format
   * 指定したフォーマットに従って日付を文字列化します。
   *
   * <table border="1">
   *   <tr><td>変換指定文字列</td><td>意味</td></tr>
   *   <tr><td>yyyy</td><td>西暦年（4桁）</td></tr>
   *   <tr><td>yy</td><td>西暦年（2桁）</td></tr>
   *   <tr><td>y</td><td>西暦年</td></tr>
   *   <tr><td>MMMM</td><td>月（英語名）</td></tr>
   *   <tr><td>MMM</td><td>月（英語省略名）</td></tr>
   *   <tr><td>MM</td><td>月（2桁数字）</td></tr>
   *   <tr><td>M</td><td>月</td></tr>
   *   <tr><td>dd</td><td>日（2桁）</td></tr>
   *   <tr><td>d</td><td>日</td></tr>
   *   <tr><td>EEEE</td><td>曜日（英語名）</td></tr>
   *   <tr><td>EEE</td><td>曜日（英語省略名）</td></tr>
   *   <tr><td>HH</td><td>時（24時間表記・2桁）</td></tr>
   *   <tr><td>H</td><td>時（24時間表記）</td></tr>
   *   <tr><td>mm</td><td>分（2桁）</td></tr>
   *   <tr><td>m</td><td>分</td></tr>
   *   <tr><td>ss</td><td>秒（2桁）</td></tr>
   *   <tr><td>s</td><td>秒</td></tr>
   * </table>
   * 桁数が指定されているものは0パディングされます。
   *
   * ### Example
   *     (new Date()).format("yyyy-MM-dd(EEE)"); // => "2016-04-05(Tue)" など
   *
   * @param {String} pattern フォーマット文字列
   * @return {String} フォーマット文字列に従って生成された文字列
   */
  Date.prototype.$method('format', function(pattern) {
    var year    = this.getFullYear();
    var month   = this.getMonth();
    var date    = this.getDate();
    var day     = this.getDay();
    var hours   = this.getHours();
    var minutes = this.getMinutes();
    var seconds = this.getSeconds();
    var millseconds = this.getMilliseconds();
    
    var patterns = {
      'yyyy': String(year).padding(4, '0'),
      'yy': year.toString().substr(2, 2),
      'y': year,

      'MMMM': MONTH[month],
      'MMM': MONTH[month].substr(0, 3),
      'MM': String(month+1).padding(2, '0'),
      'M': (month+1),

      'dd': String(date).padding(2, '0'),
      'd': date,

      'EEEE': WEEK[day],
      'EEE': WEEK[day].substr(0, 3),

      'HH': String(hours).padding(2, '0'),
      'H': hours,

      'mm': String(minutes).padding(2, '0'),
      'm': minutes,

      'ss': String(seconds).padding(2, '0'),
      's': seconds,
      
      // // date
      // 'd': String('00' + date).slice(-2),
      // 'D': WEEK[day].substr(0, 3),
      // 'j': date,
      // 'l': WEEK[day],
      
      // // month
      // 'm': String('00' + (month+1)).slice(-2),
      // 'M': MONTH[month].substr(0, 3),
      // 'n': (month+1),
      // 'F': MONTH[month],
      
      // // year
      // 'y': year.toString().substr(2, 2),
      // 'Y': year,
      
      // // time
      // 'G': hours,
      // 'H': String('00' + hours).slice(-2),
      // 'i': String('00' + minutes).slice(-2),
      // 's': String('00' + seconds).slice(-2),
      // 'S': String('000' + millseconds).slice(-3),
    };

    var regstr = '(' + Object.keys(patterns).join('|') + ')';
    var re = new RegExp(regstr, 'g');

    return pattern.replace(re, function(str) {
      return patterns[str];
    });
  });


  /**
   * @method calculateAge
   * @static
   * 指定した誕生日から、現在または指定した日付における年齢を計算します。
   *
   * ###Reference
   * - [Javascriptで誕生日から現在の年齢を算出](http://qiita.com/n0bisuke/items/dd537bd4cbe9ab501ce8)
   *
   * ### Example
   *     Date.calculateAge("1990-01-17"); // => 26 など
   *
   * @param {String/Date} birthday 誕生日
   * @param {String/Date} [when=本日] 基準の日付
   * @return {Number} 年齢
   */
  Date.$method('calculateAge', function(birthday, when) {
    // birthday
    if (typeof birthday === 'string') {
      birthday = new Date(birthday);
    }
    // when
    if (!when) {
      when = new Date();
    }
    else if (typeof when === 'string') {
      when = new Date(when);
    }

    var bn = new Date(birthday.getTime()).setFullYear(256);
    var wn = new Date(when.getTime()).setFullYear(256);
    var step = (wn < bn) ? 1 : 0;

    return (when.getFullYear() - birthday.getFullYear()) - step;
  });
  
})();

/*
 * math.js
 */

;(function() {
    
  /**
   * @class global.Math
   * # 拡張した Math クラス
   * 数学的な処理を扱う Math クラスを拡張しています。
   */

  
  /**
   * @property DEG_TO_RAD
   * 度をラジアンに変換するための定数です。
   */
  Math.DEG_TO_RAD = Math.PI/180;
  
  /**
   * @property RAD_TO_DEG
   * ラジアンを度に変換するための定数です。
   */
  Math.RAD_TO_DEG = 180/Math.PI;
  
  /**
   * @property PHI
   * 黄金比です。
   */
  Math.PHI = (1 + Math.sqrt(5)) / 2;
  
  /**
   * @static
   * @method degToRad
   * 度をラジアンに変換します。
   *
   * ### Example
   *     Math.degToRad(180); // => 3.141592653589793
   *
   * @param {Number} deg 度
   * @return {Number} ラジアン
   */
  Math.degToRad = function(deg) {
    return deg * Math.DEG_TO_RAD;
  };
  
  /**
   * @static
   * @method radToDeg
   * ラジアンを度に変換します。
   *
   * ### Example
   *     Math.radToDeg(Math.PI/4); // => 45
   *
   * @param {Number} rad ラジアン
   * @return {Number} 度
   */
  Math.radToDeg = function(rad) {
    return rad * Math.RAD_TO_DEG;
  };
  

  
  /**
   * @static
   * @method clamp
   * 指定した値を指定した範囲に収めた結果を返します。
   *
   * ### Example
   *     Math.clamp(120, 0, 640); // => 120
   *     Math.clamp(980, 0, 640); // => 640
   *     Math.clamp(-80, 0, 640); // => 0
   *
   * @param {Number} value 値
   * @param {Number} min  範囲の下限
   * @param {Number} max  範囲の上限
   * @return {Number} 丸めた結果の値
   */
  Math.$method("clamp", function(value, min, max) {
    return (value < min) ? min : ( (value > max) ? max : value );
  });
  
  /**
   * @static
   * @method inside
   * 指定した値が指定した値の範囲にあるかどうかを返します。
   *
   * ### Example
   *     Math.inside(980, 0, 640); // => false
   *     Math.inside(120, 0, 640); // => true
   *
   * @param {Number} value チェックする値
   * @param {Number} min  範囲の下限
   * @param {Number} max  範囲の上限
   * @return {Boolean} 範囲内に値があるかないか
   */
  Math.$method("inside", function(value, min, max) {
    return (value >= min) && (value) <= max;
  });
  
  /**
   * @static
   * @method randint
   * 指定された範囲内でランダムな整数値を生成します。
   *
   * ### Example
   *     Math.randint(-4, 4); // => -4、0、3、4 など
   *
   * @param {Number} min  範囲の最小値
   * @param {Number} max  範囲の最大値
   * @return {Number} ランダムな整数値
   */
  Math.$method("randint", function(min, max) {
    return Math.floor( Math.random()*(max-min+1) ) + min;
  });
  
  /**
   * @static
   * @method randfloat
   * 指定された範囲内でランダムな数値を生成します。
   *
   * ### Example
   *     Math.randfloat(-4, 4); // => -2.7489193824000937 など
   *
   * @param {Number} min  範囲の最小値
   * @param {Number} max  範囲の最大値
   * @return {Number} ランダムな数値
   */
  Math.$method("randfloat", function(min, max) {
    return Math.random()*(max-min)+min;
  });

  /**
   * @static
   * @method randbool
   * ランダムに真偽値を生成します。
   * 引数で百分率を指定する事もできます。
   *
   * ### Example
   *     Math.randbool();   // => true または false
   *     Math.randbool(80); // => 80% の確率で true
   *
   * @param {Number} percent  真になる百分率
   * @return {Boolean} ランダムな真偽値
   */
  Math.$method("randbool", function(perecent) {
    return Math.randint(0, 100) < (perecent || 50);
  });
    
})();
/*
 *
 */



/*
 * phina.js namespace
 */
var phina = phina || {};

;(function() {

  /**
   * @class phina
   * phina.js namespace
   */

  /**
   * バージョン
   */
  phina.VERSION = '0.2.3';

  /**
   * @method isNode
   * @member phina
   * @static
   */
  phina.$method('isNode', function() {
    return (typeof module !== 'undefined');
  });

  /**
   * @method namespace
   * @member phina
   * @static
   */
  phina.$method('namespace', function(fn) {
    fn.call(this);
  });

  var ns = phina.isNode() ? global : window;

  /**
   * @method global
   * global
   */
  phina.accessor('global', {
    get: function() {
      return ns;
    },
  });

  
  /**
   * @method testUA
   * UAを正規表現テスト
   * @member phina
   * @static
   */
  phina.$method('testUA', function(regExp) {
    if (!phina.global.navigator) return false;
    var ua = phina.global.navigator.userAgent;
    return regExp.test(ua);
  });

  /**
   * @method isAndroid
   * Android かどうかをチェック
   * @member phina
   * @static
   */
  phina.$method('isAndroid', function() {
    return phina.testUA(/Android/);
  });
  
  /**
   * @method isIPhone
   * iPhone かどうかをチェック
   * @member phina
   * @static
   */
  phina.$method('isIPhone', function() {
    return phina.testUA(/iPhone/);
  });
  
  /**
   * @method isIPad
   * iPad かどうかをチェック
   * @member phina
   * @static
   */
  phina.$method('isIPad', function() {
    return phina.testUA(/iPad/);
  });
  
  /**
   * @method isIOS
   * iOS かどうかをチェック
   * @member phina
   * @static
   */
  phina.$method('isIOS', function() {
    return phina.testUA(/iPhone|iPad/);
  });

  /**
   * @method isMobile
   * mobile かどうかをチェック
   * @member phina
   * @static
   */
  phina.$method('isMobile', function() {
    return phina.testUA(/iPhone|iPad|Android/);
  });
  
  


  // support node.js
  if (phina.isNode()) {
    module.exports = phina;
  }

  ns.phina = phina;

})(this);


phina.namespace(function() {

  /**
   * @member phina
   * @static
   * @method createClass
   * クラスを生成
   */
  phina.$method('createClass', function(params) {
    var props = {};

    var _class = function() {
      var instance = new _class.prototype._creator();
      _class.prototype.init.apply(instance, arguments);
      return instance;
    };

    if (params.superClass) {
      _class.prototype = Object.create(params.superClass.prototype);
      params.init.owner = _class;
      _class.prototype.superInit = function() {
        this.__counter = this.__counter || 0;

        var superClass = this._hierarchies[this.__counter++];
        var superInit = superClass.prototype.init;
        superInit.apply(this, arguments);

        this.__counter = 0;
      };
      _class.prototype.superMethod = function() {
        var args = Array.prototype.slice.call(arguments, 0);
        var name = args.shift();
        this.__counters = this.__counters || {};
        this.__counters[name] = this.__counters[name] || 0;

        var superClass = this._hierarchies[ this.__counters[name]++ ];
        var superMethod = superClass.prototype[name];
        var rst = superMethod.apply(this, args);

        this.__counters[name] = 0;

        return rst;
      };
      _class.prototype.constructor = _class;
    }


    // // 
    // params.forIn(function(key, value) {
    //   if (typeof value === 'function') {
    //     _class.$method(key, value);
    //   }
    //   else {
    //     _class.prototype[key] = value;
    //   }
    // });
    // 継承
    _class.prototype.$extend(params);

    // 継承用
    _class.prototype._hierarchies = [];
    var _super = _class.prototype.superClass;
    while(_super) {
      _class.prototype._hierarchies.push(_super);
      _super = _super.prototype.superClass;
    }

    // accessor
    if (params._accessor) {
      params._accessor.forIn(function(key, value) {
        _class.prototype.accessor(key, value);
      });
      // _class.prototype = Object.create(_class.prototype, params._accessor);
    }

    _class.prototype._creator = function() { return this; };
    _class.prototype._creator.prototype = _class.prototype;

    // static property/method
    if (params._static) {
      _class.$extend(params._static);
    }

    if (params._defined) {
      params._defined.call(_class, _class);
    }

    return _class;
  });

  var chachedClasses = {};
  
  /**
   * @method using
   * @member phina
   * @static
   */
  phina.$method('using', function(path) {
    if (!path) {
      return phina.global;
    }
    
    var pathes = path.split(/[,.\/ ]|::/);
    var current = phina.global;

    pathes.forEach(function(p) {
      current = current[p] || (current[p]={});
    });

    return current;
  });
  
  /**
   * @method register
   * 
   * @member phina
   * @static
   */
  phina.$method('register', function(path, _class) {
    var pathes = path.split(/[,.\/ ]|::/);
    var className = pathes.last;
    var parentPath = path.substring(0, path.lastIndexOf('.'));
    var parent = phina.using(parentPath);

    parent[className] = _class;

    return _class;
  });
  
  var _classDefinedCallback = {};

  /**
   * @member phina
   * @static
   * @method define
   * クラスを定義
   */
  phina.$method('define', function(path, params) {
    if (params.superClass) {
      if (typeof params.superClass === 'string') {
        var _superClass = phina.using(params.superClass);
        if (typeof _superClass != 'function') {
          if (!_classDefinedCallback[params.superClass]) {
            _classDefinedCallback[params.superClass] = [];
          }
          _classDefinedCallback[params.superClass].push(function() {
            phina.define(path, params);
          });

          return ;
        }
        else {
          params.superClass = _superClass;
        }
      }
      else {
        params.superClass = params.superClass;
      }
    }

    var _class = phina.createClass(params);
    _class.prototype.accessor('className', {
      get: function() {
        return path;
      },
    });

    phina.register(path, _class);
    
    if (_classDefinedCallback[path]) {
      _classDefinedCallback[path].forEach(function(callback) {
        callback();
      });
      _classDefinedCallback[path] = null;
    }

    return _class;
  });

  /**
   * @method globalize
   * @member phina
   * @static
   */
  phina.$method('globalize', function() {
    phina.forIn(function(key, value) {
      var ns = key;

      if (typeof value !== 'object') return ;

      value.forIn(function(key, value) {
        // if (phina.global[key]) {
        //   console.log(ns, key);
        //   phina.global['_' + key] = value;
        // }
        // else {
        //   phina.global[key] = value;
        // }
        phina.global[key] = value;
      });
    });
  });

  phina._mainListeners = [];
  phina._mainLoaded = false;
  phina.$method('main', function(func) {
    if (phina._mainLoaded) {
      func();
    }
    else {
      phina._mainListeners.push(func);
    }
  });

  var doc = phina.global.document;
  if (phina.global.addEventListener && doc && doc.readyState !== 'complete') {
    phina.global.addEventListener('load', function() {
      var run = function() {
        var listeners = phina._mainListeners.clone();
        phina._mainListeners.clear();
        listeners.each(function(func) {
          func();
        });

        // main 内で main を追加している場合があるのでそのチェック
        if (phina._mainListeners.length > 0) {
          run(0);
        }
        else {
          phina._mainLoaded = true;
        }
      };
      // ちょっと遅延させる(画面サイズ問題)
      setTimeout(run);
    });
  }
  else {
    phina._mainLoaded = true;
  }



});









phina.namespace(function() {

  /**
   * @class phina.geom.Vector2
   * # 2次元ベクトルクラス
   * 2次元のベクトルや座標を表すクラスです。
   */
  phina.define('phina.geom.Vector2', {

    /** x座標 */
    x: 0,
    /** y座標 */
    y: 0,

    /**
     * @method init
     * 2次元ベクトルのコンストラクタです。
     *
     * ### Example
     *     v = phina.geom.Vector2(3, 4);
     *
     * @param {Number} x ベクトルの x 座標
     * @param {Number} y ベクトルの y 座標
     * @return {phina.geom.Vector2} 2次元ベクトルオブジェクト
     */
    init: function(x, y) {
      this.x = x;
      this.y = y;
    },

    /**
     * @method clone
     * this のコピーを生成して返します。
     *
     * ### Example
     *     v = phina.geom.Vector2(3, 4);
     *     v2 = v.clone();
     *     v2.x == v.x; // => true
     *
     * @return {Object} 生成したベクトル
     */
    clone: function() {
      return phina.geom.Vector2(this.x, this.y);
    },

    /**
     * @method equals
     * this の各要素がすべて other と等しいかどうかを返します。
     *
     * ### Example
     *     v1 = phina.geom.Vector2(3, 4);
     *     v2 = phina.geom.Vector2(5, 6);
     *     v1.equals(v2); // => false
     *
     * @param {phina.geom.Vector2} other 比較する対象のベクトル
     * @return {Boolean} 等しいかどうか
     */
    equals: function(v) {
      return (this.x === v.x && this.y === v.y);
    },

    /**
     * @method set
     * @chainable
     * this の各要素の値を再設定します。
     *
     * ### Example
     *     v = phina.geom.Vector2(3, 4);
     *     v.set(5, 6);
     *
     * @param {Number} x ベクトルの x 座標
     * @param {Number} y ベクトルの y 座標
     * @return {phina.geom.Vector2} 再設定後のベクトル
     */
    set: function(x, y) {
      this.x = x;
      this.y = y;
      return this;
    },

    /**
     * @method add
     * @chainable
     * this に other を加えます。
     *
     * ### Example
     *     v1 = phina.geom.Vector2(3, 4);
     *     v2 = phina.geom.Vector2(5, 6);
     *     v1.add(v2); // => phina.geom.Vector(8, 10)
     *
     * @param {phina.geom.Vector2} other ベクトル
     * @return {phina.geom.Vector2} 加算した結果のベクトル
     */
    add: function(v) {
      this.x += v.x;
      this.y += v.y;
      return this;
    },

    /**
     * @method sub
     * @chainable
     * this から other を減じます。
     *
     * ベクトルが座標を表す場合は、指定した座標から自分自身へと向かうベクトルが得られます。
     * 
     * ### Example
     *     v1 = phina.geom.Vector2(3, 4);
     *     v2 = phina.geom.Vector2(1, 5);
     *     v1.sub(v2); // => phina.geom.Vector(2, -1)
     *
     * @param {phina.geom.Vector2} other ベクトル
     * @return {phina.geom.Vector2} 減算した結果のベクトル
     */
    sub: function(v) {
      this.x -= v.x;
      this.y -= v.y;
      return this;
    },

    /**
     * @method mul
     * @chainable
     * this の各要素に数値 n を乗じます。
     *
     * ### Example
     *     v1 = phina.geom.Vector2(3, 4);
     *     v1.mul(3) // => phina.geom.Vector(9, 12)
     *
     * @param {Number} n 乗じる値
     * @return {phina.geom.Vector2} 乗算した結果のベクトル
     */
    mul: function(n) {
      this.x *= n;
      this.y *= n;
      return this;
    },

    /**
     * @method div
     * @chainable
     * this の各要素を数値 n で割ります。
     *
     * ### Example
     *     v1 = phina.geom.Vector2(8, 16);
     *     v1.div(2) // => phina.geom.Vector(4, 8)
     *
     * @param {Number} n 割る値
     * @return {phina.geom.Vector2} 除算した結果のベクトル
     */
    div: function(n) {
      //console.assert(n != 0, "0 division!!");
      n = n || 0.01;
      this.x /= n;
      this.y /= n;
      return this;
    },

    /**
     * @method negate
     * @chainable
     * this の各要素の正負を反転します。
     *
     * this と同じ大きさで方向が逆のベクトルが得られます。
     *
     * ### Example
     *     v1 = phina.geom.Vector2(3, -4);
     *     v1.negate() // => phina.geom.Vector(-3, 4)
     *
     * @return {phina.geom.Vector2} 反転後のベクトル
     */
    negate: function() {
      this.x = -this.x;
      this.y = -this.y;
      
      return this;
    },

    /**
     * @method dot
     * other との内積を返します。
     *
     * 投影ベクトルを求めたり、類似度の計算に利用することができます。
     *
     * ### Example
     *     v1 = phina.geom.Vector2(3, 4);
     *     v2 = phina.geom.Vector2(-2, 2);
     *     v1.dot(v2) // => 2
     *
     * @param {phina.geom.Vector2} other ベクトル
     * @return {Number} 内積
     */
    dot: function(v) {
      return this.x * v.x + this.y * v.y;
    },

    /**
     * @method cross
     * other との外積（クロス積）を返します。
     *
     * 2次元ベクトルでの外積はベクトルでなく数値を返すことに注意してください。
     * other より this 時計回りにあるときは正の値になり、反時計回りにあるときは負の値になります。
     *
     * ### Example
     *     v1 = phina.geom.Vector2(3, 4);
     *     v2 = phina.geom.Vector2(3, 1);
     *     v1.cross(v2) // => -8
     *
     * @param {phina.geom.Vector2} other ベクトル
     * @return {Number} 外積
     */
    cross: function(v) {
      return (this.x*v.y) - (this.y*v.x);
    },

    /**
     * @method length
     * this の大きさを返します。
     *
     * (memo) magnitude って名前の方が良いかも. 検討中.
     *
     * ### Example
     *     v1 = phina.geom.Vector2(3, 4);
     *     v1.length(); // => 5
     *
     * @return {Number} ベクトルの大きさ
     */
    length: function() {
      return Math.sqrt(this.x*this.x + this.y*this.y);
    },
    
    /**
     * @method lengthSquared
     * this の大きさの自乗を返します。
     *
     * C# の名前を引用（or lengthSquare or lengthSqrt）
     *
     * ### Example
     *     v1 = phina.geom.Vector2(3, 4);
     *     v1.lengthSquared(); // => 25
     *
     * @return {Number} ベクトルの大きさの自乗
     */
    lengthSquared: function() {
      return this.x*this.x + this.y*this.y;
    },
    
    /**
     * @method distance
     * this と other を座標とみなしたときの2点間の距離を返します。
     *
     * ### Example
     *     v1 = phina.geom.Vector2(1, 2);
     *     v2 = phina.geom.Vector2(4, 6);
     *     v1.distance(v2); // => 5
     *
     * @param {phina.geom.Vector2} other 座標を表すベクトル
     * @return {Number} 2点間の距離
     */
    distance: function(v) {
      return Math.sqrt( Math.pow(this.x-v.x, 2) + Math.pow(this.y-v.y, 2) );
    },
    
    /**
     * @method distanceSquared
     * this と other を座標とみなしたときの2点間の距離の自乗を返します。
     *
     * ### Example
     *     v1 = phina.geom.Vector2(1, 2);
     *     v2 = phina.geom.Vector2(4, 6);
     *     v1.distanceSquared(v2); // => 25
     *
     * @param {phina.geom.Vector2} other 座標を表すベクトル
     * @return {Number} 2点間の距離の自乗
     */
    distanceSquared: function(v) {
      return Math.pow(this.x-v.x, 2) + Math.pow(this.y-v.y, 2);
    },

    /**
     * @method random
     * @chainable
     * 角度が min から max の範囲（度単位）で大きさが len のランダムなベクトルを返します。
     *
     * ### Example
     *     phina.geom.Vector2().random(90, 180, 1); // => phina.geom.Vector2(-0.5, 0.866) など
     *
     * @param {Number} [min=0] 角度（度単位）の下限値
     * @param {Number} [max=360] 角度（度単位）の上限値
     * @param {Number} [len=1] 大きさ
     * @return {phina.geom.Vector2} ランダム化したベクトル
     */
    random: function(min, max, len) {
      var degree = phina.util.Random.randfloat(min || 0, max || 360);
      var rad = degree*Math.DEG_TO_RAD;
      var len = len || 1;

      this.x = Math.cos(rad)*len;
      this.y = Math.sin(rad)*len;

      return this;
    },
    
    /**
     * @method normalize
     * @chainable
     * this を正規化します。すなわち、this と同じ方向で大きさが1のベクトルを返します。
     *
     * ### Example
     *     v1 = phina.geom.Vector2(3, 4);
     *     v1.normalize(); // => phina.geom.Vector2(0.6, 0.8)
     *
     * @return {phina.geom.Vector2} 正規化したベクトル
     */
    normalize: function() {
      this.div(this.length());
      return this;
    },

    /**
     * @method toString
     * this を JSON 形式で表現した文字列を返します。
     *
     * ### Example
     *     v1 = phina.geom.Vector2(3, 4);
     *     v1.toString(); // => "{x:3, y:4}"
     *
     * @return {String} JSON 文字列
     */
    toString: function() {
      return "{x:{x}, y:{y}}".format(this);
    },

    /**
     * @method getDirection
     * this のおおよその方向を示した文字列を返します。
     *
     * ### Example
     *     v1 = phina.geom.Vector2(3, 4);
     *     v1.getDirection(); // => "up"
     *
     * @return {String} 方向を表す文字列（"up", "right", "down", "left"）
     */
    getDirection: function() {
      var angle = this.toDegree();
      if (angle < 45) {
        return "right";
      } else if (angle < 135) {
        return "down";
      } else if (angle < 225) {
        return "left"
      } else if (angle < 315) {
        return "up";
      } else {
        return "right";
      }
    },

    /**
     * @method toAngle
     * this と x 軸との角度（ラジアン単位）を返します。
     *
     * ### Example
     *     v1 = phina.geom.Vector2(-2, 0);
     *     v1.toAngle(); // => 3.14159
     *
     * @return {Number} ベクトルの角度（ラジアン単位）
     */
    toAngle: function() {
      var rad = Math.atan2(this.y, this.x);
      return (rad + Math.PI*2)%(Math.PI*2);
    },
    
    /**
     * @method fromAngle
     * @chainable
     * 角度（ラジアン単位）と大きさを指定してベクトルを設定します。
     *
     * ### Example
     *     phina.geom.Vector2().fromAngle(Math.PI/4, 2); // => phina.geom.Vector2(1.4142, 1.4142)
     *
     * @param {Number} rad 角度（ラジアン単位）
     * @param {Number} [len=1] 大きさ
     * @return {phina.geom.Vector2} ベクトル
     */
    fromAngle: function(rad, len) {
      len = len || 1;
      this.x = Math.cos(rad)*len;
      this.y = Math.sin(rad)*len;
      
      return this;
    },

    /**
     * @method toDegree
     * this と x 軸との角度（度単位）を返します。
     *
     * ### Example
     *     v1 = phina.geom.Vector2(-2, 2);
     *     v1.toAngle(); // => 135
     *
     * @return {Number} ベクトルの角度（度単位）
     */
    toDegree: function() {
      return this.toAngle().toDegree();
    },
    
    /**
     * @method fromDegree
     * @chainable
     * 角度（度単位）と大きさを指定してベクトルを設定します。
     *
     * ### Example
     *     phina.geom.Vector2().fromDegree(60, 2); // => phina.geom.Vector2(1, 1.732)
     *
     * @param {Number} deg 角度（度単位）
     * @param {Number} [len=1] 大きさ
     * @return {phina.geom.Vector2} ベクトル
     */
    fromDegree: function(deg, len) {
      return this.fromAngle(deg.toRadian(), len);
    },

    /**
     * @method rotate
     * @chainable
     * this を回転します。
     *
     * ### Example
     *     v1 = phina.geom.Vector2(3, 1);
     *     v1.rotate(Math.PI/2); // => phina.geom.Vector2(-1, 3);
     *
     * @param {Number} rad 角度（ラジアン単位）
     * @param {Number} [center=(0, 0)] 回転の中心座標
     * @return {Number} 回転後のベクトル
     */
    rotate: function(rad, center) {
      center = center || phina.geom.Vector2(0, 0);

      var x1 = this.x - center.x;
      var y1 = this.y - center.y;
      var x2 = x1 * Math.cos(rad) - y1 * Math.sin(rad);
      var y2 = x1 * Math.sin(rad) + y1 * Math.cos(rad);
      this.set( center.x + x2, center.y + y2 );

      return this;
    },

    _accessor: {
    },

    _static: {
      /**
       * @method min
       * @static
       * v1 と v2 の各要素に対し、より小さい方を要素とする新しいベクトルを生成して返します。
       *
       * ### Example
       *     v1 = phina.geom.Vector2(3, 1);
       *     v2 = phina.geom.Vector2(-3, 2);
       *     phina.geom.Vector2.min(v1, v2); // phina.geom.Vector2(-3, 1);
       *
       * @param {phina.geom.Vector2} v1 ベクトル
       * @param {phina.geom.Vector2} v2 ベクトル
       * @return {phina.geom.Vector2} 生成したベクトル
       */
      min: function(a, b) {
        return phina.geom.Vector2(
          (a.x < b.x) ? a.x : b.x,
          (a.y < b.y) ? a.y : b.y
          );
      },

      /**
       * @method max
       * @static
       * 2次元ベクトル v1 と v2 の各要素に対し、より大きい方を要素とする新しいベクトルを生成して返します。
       *
       * ### Example
       *     v1 = phina.geom.Vector2(3, 1);
       *     v2 = phina.geom.Vector2(-3, 2);
       *     phina.geom.Vector2.max(v1, v2); // phina.geom.Vector2(3, 2);
       *
       * @param {phina.geom.Vector2} v1 ベクトル
       * @param {phina.geom.Vector2} v2 ベクトル
       * @return {phina.geom.Vector2} 生成したベクトル
       */
      max: function(a, b) {
        return phina.geom.Vector2(
          (a.x > b.x) ? a.x : b.x,
          (a.y > b.y) ? a.y : b.y
          );
      },

      /**
       * @method add
       * @static
       * v1 に v2 を加算した新しいベクトルを生成して返します。
       *
       * ### Example
       *     v1 = phina.geom.Vector2(3, 1);
       *     v2 = phina.geom.Vector2(-3, 2);
       *     phina.geom.Vector2.add(v1, v2); // phina.geom.Vector2(0, 3);
       *
       * @param {phina.geom.Vector2} v1 ベクトル
       * @param {phina.geom.Vector2} v2 ベクトル
       * @return {phina.geom.Vector2} 加算した結果
       */
      add: function(lhs, rhs) {
        return phina.geom.Vector2(lhs.x+rhs.x, lhs.y+rhs.y);
      },
      
      /**
       * @method sub
       * @static
       * 2次元ベクトル v1 から v2 を減じた新しいベクトルを生成して返します。
       *
       * ベクトルが座標を表す場合、2つ目の座標から1つ目の座標へと向かうベクトルが得られます。
       *
       * ### Example
       *     v1 = phina.geom.Vector2(3, 1);
       *     v2 = phina.geom.Vector2(-3, 2);
       *     phina.geom.Vector2.sub(v1, v2); // phina.geom.Vector2(6, -1);
       *
       * @param {phina.geom.Vector2} v1 ベクトル
       * @param {phina.geom.Vector2} v2 ベクトル
       * @return {phina.geom.Vector2} 減算した結果
       */
      sub: function(lhs, rhs) {
        return phina.geom.Vector2(lhs.x-rhs.x, lhs.y-rhs.y);
      },
      
      /**
       * @method mul
       * @static
       * 2次元ベクトル v の各要素に n を乗じた新しいベクトルを生成して返します。
       *
       * ### Example
       *     v1 = phina.geom.Vector2(3, 1);
       *     phina.geom.Vector2.mul(v1, 2); // phina.geom.Vector2(6, 2)
       *
       * @param {phina.geom.Vector2} v ベクトル
       * @param {phina.geom.Vector2} n 乗じる値
       * @return {phina.geom.Vector2} 乗算した結果
       */
      mul: function(v, n) {
        return phina.geom.Vector2(v.x*n, v.y*n);
      },
      
      /**
       * @method div
       * @static
       * 2次元ベクトル v の各要素を n で割った新しいベクトルを生成して返します。
       *
       * ### Example
       *     v1 = phina.geom.Vector2(3, 1);
       *     phina.geom.Vector2.div(v1, 2); // phina.geom.Vector2(1.5, 0.5)
       *
       * @param {phina.geom.Vector2} v ベクトル
       * @param {phina.geom.Vector2} n 割る値
       * @return {phina.geom.Vector2} 除算した結果
       */
      div: function(v, n) {
        return phina.geom.Vector2(v.x/n, v.y/n);
      },
      
      /**
       * @method negate
       * @static
       * 2次元ベクトル v を反転した新しいベクトルを生成して返します。
       *
       * ### Example
       *     v1 = phina.geom.Vector2(3, 1);
       *     phina.geom.Vector2.negate(); // phina.geom.Vector2(-3, -1)
       *
       * @param {phina.geom.Vector2} v ベクトル
       * @return {phina.geom.Vector2} 反転したベクトル
       */
      negate: function(v) {
        return phina.geom.Vector2(-v.x, -v.y);
      },
      
      /**
       * @method dot
       * @static
       * 2次元ベクトル v1 と v2 の内積を返します。
       *
       * ### Example
       *     v1 = phina.geom.Vector2(3, 4);
       *     v2 = phina.geom.Vector2(-2, 2);
       *     phina.geom.Vector2.dot(v1, v2) // => 2
       *
       * @param {phina.geom.Vector2} v1 ベクトル
       * @param {phina.geom.Vector2} v2 ベクトル
       * @return {phina.geom.Vector2} 内積
       */
      dot: function(lhs, rhs) {
        return lhs.x * rhs.x + lhs.y * rhs.y;
      },
      
      /**
       * @method cross
       * @static
       * 2次元ベクトル v1 と v2 の外積（クロス積）を返します。
       *
       * 2次元ベクトルでの外積はベクトルでなく数値を返すことに注意してください。
       * 1つ目のベクトルが2つ目のベクトルより時計回りにあるときは正の値になり、反時計回りにあるときは負の値になります。
       *
       * ### Example
       *     v1 = phina.geom.Vector2(3, 4);
       *     v2 = phina.geom.Vector2(3, 1);
       *     phina.geom.Vector2.cross(v1, v2); // => -8
       *
       * @param {phina.geom.Vector2} v1 ベクトル
       * @param {phina.geom.Vector2} v2 ベクトル
       * @return {Number} 外積
       */
      cross: function(lhs, rhs) {
        return (lhs.x*rhs.y) - (lhs.y*rhs.x);
      },
      
      /**
       * @method distance
       * @static
       * v1 と v2 を座標とみなしたときの2点間の距離を返します。
       *
       * ### Example
       *     v1 = phina.geom.Vector2(1, 2);
       *     v2 = phina.geom.Vector2(4, 6);
       *     phina.geom.Vector2.distance(v1, v2); // => 5
       *
       * @param {phina.geom.Vector2} v1 座標を表すベクトル
       * @param {phina.geom.Vector2} v2 座標を表すベクトル
       * @return {Number} 2点間の距離
       */
      distance: function(lhs, rhs) {
        return Math.sqrt( Math.pow(lhs.x-rhs.x, 2) + Math.pow(lhs.y-rhs.y, 2) );
      },

      /**
       * @method distanceSquared
       * @static
       * v1 と v2 を座標とみなしたときの2点間の距離の自乗を返します。
       *
       * ### Example
       *     v1 = phina.geom.Vector2(1, 2);
       *     v2 = phina.geom.Vector2(4, 6);
       *     phina.geom.Vector2.distanceSquared(v1, v2); // => 25
       *
       * @param {phina.geom.Vector2} v1 座標を表すベクトル
       * @param {phina.geom.Vector2} v2 座標を表すベクトル
       * @return {Number} 2点間の距離の自乗
       */
      distanceSquared: function(lhs, rhs) {
        return Math.pow(lhs.x-rhs.x, 2) + Math.pow(lhs.y-rhs.y, 2);
      },

      /**
       * @method manhattanDistance
       * @static
       * v1 と v2 を座標とみなしたときの2点間のマンハッタン距離（軸に平行に進むときの最短距離）を返します。
       *
       * ### Example
       *     v1 = phina.geom.Vector2(1, 2);
       *     v2 = phina.geom.Vector2(4, 6);
       *     phina.geom.Vector2.manhattanDistance(v1, v2); // => 7
       *
       * @param {phina.geom.Vector2} v1 座標を表すベクトル
       * @param {phina.geom.Vector2} v2 座標を表すベクトル
       * @return {Number} 2点間のマンハッタン距離
       */
      manhattanDistance: function(lhs, rhs) {
        return Math.abs(lhs.x-rhs.x) + Math.abs(lhs.y-rhs.y);
      },
      
      /**
       * @method normal
       * @static
       * v1 と v2 を座標とみなしたときの、v2 から v1 に向かうベクトルに対する法線ベクトルを返します。
       *
       * ### Example
       *     v1 = phina.geom.Vector2(1, 2);
       *     v2 = phina.geom.Vector2(4, 6);
       *     phina.geom.Vector2.normal(v1, v2); // => phina.geom.Vector2(4, -3)
       *
       * @param {phina.geom.Vector2} v1 座標を表すベクトル
       * @param {phina.geom.Vector2} v2 座標を表すベクトル
       * @return {phina.geom.Vector2} 法線ベクトル
       */
      normal: function(a, b) {
        var temp = phina.geom.Vector2.sub(a, b);

        return phina.geom.Vector2(-temp.y, temp.x);
      },

      /**
       * @method reflect
       * @static
       * 2次元ベクトル v を壁への入射ベクトルとして、壁に反射した際のベクトル（反射ベクトル）を返します。
       *
       * 壁の向きは法線ベクトル normal によって表します。
       *
       * ### Example
       *     v1 = phina.geom.Vector2(4, 3);
       *     normal = phina.geom.Vector2(-1, 1);
       *     phina.geom.Vector2.reflect(v1, normal); // => phina.geom.Vector2(2, 5)
       *
       * @param {phina.geom.Vector2} v 入射ベクトル
       * @param {phina.geom.Vector2} normal 壁の法線ベクトル
       * @return {phina.geom.Vector2} 反射ベクトル
       */
      reflect: function(v, normal) {
        var len = phina.geom.Vector2.dot(v, normal);
        var temp= phina.geom.Vector2.mul(normal, 2*len);
        
        return phina.geom.Vector2.sub(v, temp);
      },
      
      /**
       * @method wall
       * @static
       * 2次元ベクトル v を壁への入射ベクトルとして、壁に沿ったベクトル（壁ずりクトル）を返します。
       *
       * 壁の向きは法線ベクトル normal によって表します。
       *
       * ### Example
       *     v1 = phina.geom.Vector2(4, 3);
       *     normal = phina.geom.Vector2(-1, 1);
       *     phina.geom.Vector2.wall(v1, normal); // => phina.geom.Vector2(3, 4)
       *
       * @param {phina.geom.Vector2} v 入射ベクトル
       * @param {phina.geom.Vector2} normal 壁の法線ベクトル
       * @return {phina.geom.Vector2} 壁ずりベクトル
       */
      wall: function(v, normal) {
        var len = phina.geom.Vector2.dot(v, normal);
        var temp= phina.geom.Vector2.mul(normal, len);
        
        return phina.geom.Vector2.sub(v, temp);
      },
      
      /**
       * @method lerp
       * @static
       * v1 と v2 を媒介変数 t で線形補間します。
       * t=0.5 で v1 と v2 の中間ベクトルを求めることができます。
       *
       * ### Example
       *     v1 = phina.geom.Vector2(1, 2);
       *     v2 = phina.geom.Vector2(4, 6);
       *     phina.geom.Vector2.lerp(v1, v2, 0.5); // => (2.5, 4)
       *     phina.geom.Vector2.lerp(v1, v2, 0); // => (1, 2)
       *     phina.geom.Vector2.lerp(v1, v2, 1); // => (4, 6)
       * 
       * @param {phina.geom.Vector2} v1 ベクトル
       * @param {phina.geom.Vector2} v2 ベクトル
       * @param {Number} t 媒介変数
       * @return {phina.geom.Vector2} 線形補間の結果
       */
      lerp: function(a, b, t) {
        return phina.geom.Vector2(
          a.x + (b.x-a.x)*t,
          a.y + (b.y-a.y)*t
        );
      },
      
      
      /**
       * @method slerp
       * @static
       * 補間（未実装）
       */
      slerp: function(lhs, rhs, t) {
          // TODO:
          // cos...
      },

      /**
       * @method random
       * @static
       * 角度が min から max の範囲（度単位）で大きさが len のランダムなベクトルを生成して返します。
       *
       * ### Example
       *     phina.geom.Vector2.random(90, 180, 1); // => phina.geom.Vector2(-0.5, 0.866) など
       *
       * @param {Number} [min=0] 角度（度単位）の下限値
       * @param {Number} [max=360] 角度（度単位）の上限値
       * @param {Number} [len=1] 大きさ
       * @return {phina.geom.Vector2} 生成したベクトル
       */
      random: function(min, max, len) {
        return phina.geom.Vector2().random(min, max).mul(len||1);
      },
    },

  });

  /**
   * @property {phina.geom.Vector2} ZERO ゼロベクトル
   * @readonly
   */
  phina.geom.Vector2.ZERO = phina.geom.Vector2(0, 0);
  /**
   * @property {phina.geom.Vector2} LEFT 左方向の単位ベクトル
   * @readonly
   */
  phina.geom.Vector2.LEFT = phina.geom.Vector2(-1, 0);
  /**
   * @property {phina.geom.Vector2} RIGHT 右方向の単位ベクトル
   * @readonly
   */
  phina.geom.Vector2.RIGHT= phina.geom.Vector2(1, 0);
  /**
   * @property {phina.geom.Vector2} UP 上方向の単位ベクトル
   * @readonly
   */
  phina.geom.Vector2.UP   = phina.geom.Vector2(0, -1);
  /**
   * @property {phina.geom.Vector2} DOWN 下方向の単位ベクトル
   * @readonly
   */
  phina.geom.Vector2.DOWN = phina.geom.Vector2(0, 1);

});


phina.namespace(function() {

  /**
   * @class phina.geom.Vector3
   * # 3次元ベクトルクラス（未実装）
   * 3次元のベクトルや座標を表すクラスです。
   */
  phina.define('phina.geom.Vector3', {

    /** x座標 */
    x: 0,
    /** y座標 */
    y: 0,
    /** z座標 */
    z: 0,

    /**
     * @constructor
     */
    init: function(x, y, z) {
      this.x = x;
      this.y = y;
      this.z = z;
    },

  });

});


phina.namespace(function() {

  /**
   * @class phina.geom.Matrix33
   * # 行列クラス
   * 3x3の行列を表すクラスです。
   * 
   * <pre>
   * | m00 m01 m02 |
   * | m10 m11 m12 |
   * | m20 m21 m22 |
   * </pre>
   */
  phina.define('phina.geom.Matrix33', {

    /**
     * @method init
     * マトリックスクラスのコンストラクタです。
     *
     * 引数は m00, m01, m02, m10, m11, m12, m20, m21, m22 の順に指定します。
     * 引数が9個に満たない場合は単位行列を生成します。
     *
     * ### Example
     *     mat1 = phina.geom.Matrix33(1, 2, 3, 4, 5, 6, 7, 8, 9);
     *     mat2 = phina.geom.Matrix33();
     *     mat1.m00 + mat2.m00; // => 2
     *     mat1.m01 - mat2.m01; // => 2
     *
     * @param {Number...} m00, m01,... 各要素の値
     * @return {phina.geom.Matrix33} 行列オブジェクト
     */
    init: function() {
      if (arguments.length >= 9) {
          this.set.apply(this, arguments);
      }
      else {
          this.identity();
      }
    },

    /**
     * @method set
     * @chainable
     * this の各要素の値を再設定します。
     *
     * ### Example
     *     mat1 = phina.geom.Matrix33(1, 2, 3, 4, 5, 6, 7, 8, 9);
     *     mat2 = phina.geom.Matrix33();
     *     mat2.set(1, 2, 3, 4, 5, 6, 7, 8, 9);
     *     mat1.toString() == mat2.toString(); // => true
     *
     * @param {Number...} m00, m01,... 各要素の値
     * @return {phina.geom.Matrix33} 行列オブジェクト
     */
    set: function(m00, m01, m02, m10, m11, m12, m20, m21, m22) {
      this.m00 = m00; this.m01 = m01; this.m02 = m02;
      this.m10 = m10; this.m11 = m11; this.m12 = m12;
      this.m20 = m20; this.m21 = m21; this.m22 = m22;

      return this;
    },

    /**
     * @method identity
     * @chainable
     * this を単位行列にします。
     *
     * ### Example
     *     mat1 = phina.geom.Matrix33(1, 2, 3, 4, 5, 6, 7, 8, 9);
     *     mat2 = phina.geom.Matrix33();
     *     mat1.identity().toString() == mat2.toString(); // => true
     *
     * @return {phina.geom.Matrix33} 単位行列
     */
    identity: function() {
      this.m00 = 1; this.m01 = 0; this.m02 = 0;
      this.m10 = 0; this.m11 = 1; this.m12 = 0;
      this.m20 = 0; this.m21 = 0; this.m22 = 1;
      return this;
    },

    /**
     * @method clone
     * this のコピーを生成して返します。
     *
     * ### Example
     *     mat1 = phina.geom.Matrix33(1, 2, 3, 4, 5, 6, 7, 8, 9);
     *     mat2 = mat1.clone();
     *     mat1.toString() == mat2.toString(); // => true
     *     mat1 == mat2; // => false
     *
     * @return {phina.geom.Matrix33} 行列オブジェクト
     */
    clone: function() {
      return phina.geom.Matrix33(
        this.m00, this.m01, this.m02,
        this.m10, this.m11, this.m12,
        this.m20, this.m21, this.m22
      );
    },

    /**
     * @method determinant
     * 行列式を返します
     *
     * ### Example
     *     mat1 = phina.geom.Matrix33(0, -2, 0, -1, 3, 1, 4, 2, 1);
     *     mat1.determinant(); // => -10
     *     mat1.identity().determinant(); // => 1
     *
     * @return {Number} 行列式
     */
    determinant: function() {
      var m00 = this.m00; var m01 = this.m01; var m02 = this.m02;
      var m10 = this.m10; var m11 = this.m11; var m12 = this.m12;
      var m20 = this.m20; var m21 = this.m21; var m22 = this.m22;
      
      return m00*m11*m22 + m10*m21*m02 + m01*m12*m20 - m02*m11*m20 - m01*m10*m22 - m12*m21*m00;
    },

    /**
     * @method transpose
     * @chainable
     * 転置行列を返します。
     *
     * ### Example
     *     mat1 = phina.geom.Matrix33(1, 2, 3, 4, 5, 6, 7, 8, 9);
     *     mat2 = phina.geom.Matrix33(1, 4, 7, 2, 5, 8, 3, 6, 9);
     *     mat1.transpose().toString() == mat2.toString(); // => true
     *
     * @return {phina.geom.Matrix33} 転置行列
     */
    transpose: function() {
      var swap = function(a, b) {
        var temp = this[a];
        this[a] = this[b];
        this[b] = temp;
      }.bind(this);

      swap('m01', 'm10');
      swap('m02', 'm20');
      swap('m12', 'm21');
      
      return this;
    },

    /**
     * @method invert
     * @chainable
     * 逆行列を返します。
     *
     * ### Example
     *     mat1 = phina.geom.Matrix33(0, -1, 1, -1, 4, -2, 1, 1, 1);
     *     mat2 = mat1.clone().invert();
     *     mat3 = mat1.clone().multiply(mat2);
     *     mat3.toString() == phina.geom.Matrix33.IDENTITY.toString(); // => true
     *
     * @return {phina.geom.Matrix33} 逆行列
     */
    invert: function() {
      var m00 = this.m00; var m01 = this.m01; var m02 = this.m02;
      var m10 = this.m10; var m11 = this.m11; var m12 = this.m12;
      var m20 = this.m20; var m21 = this.m21; var m22 = this.m22;

      var det = this.determinant();

      // |m00, m01, m02|
      // |m10, m11, m12|
      // |m20, m21, m22|
      this.m00 = (m11*m22-m12*m21)/det;
      this.m01 = (m10*m22-m12*m20)/det*-1;
      this.m02 = (m10*m21-m11*m20)/det;
      
      this.m10 = (m01*m22-m02*m21)/det*-1;
      this.m11 = (m00*m22-m02*m20)/det;
      this.m12 = (m00*m21-m01*m20)/det*-1;
      
      this.m20 = (m01*m12-m02*m11)/det;
      this.m21 = (m00*m12-m02*m10)/det*-1;
      this.m22 = (m00*m11-m01*m10)/det;
      
      this.transpose();
      
      return this;

    },

    /**
     * @method multiply
     * this に other を乗じます。
     *
     * ### Example
     *     mat1 = phina.geom.Matrix33(0, -1, 1, -1, 4, -2, 1, 1, 1);
     *     mat2 = mat1.clone().invert();
     *     mat3 = mat1.clone().multiply(mat2);
     *     mat3.toString() == phina.geom.Matrix33.IDENTITY.toString(); // => true
     *
     * @param {phina.geom.Matrix33} other 乗じる行列
     * @return {phina.geom.Matrix33} 乗算結果の行列
     */
    multiply: function(mat) {
        var tm = this.m;
        var om = mat.m;

        var a00 = this.m00, a01 = this.m01, a02 = this.m02;
        var a10 = this.m10, a11 = this.m11, a12 = this.m12;
        var a20 = this.m20, a21 = this.m21, a22 = this.m22;
        var b00 = mat.m00, b01 = mat.m01, b02 = mat.m02;
        var b10 = mat.m10, b11 = mat.m11, b12 = mat.m12;
        var b20 = mat.m20, b21 = mat.m21, b22 = mat.m22;

        this.m00 = a00*b00 + a01*b10 + a02*b20;
        this.m01 = a00*b01 + a01*b11 + a02*b21;
        this.m02 = a00*b02 + a01*b12 + a02*b22;

        this.m10 = a10*b00 + a11*b10 + a12*b20;
        this.m11 = a10*b01 + a11*b11 + a12*b21;
        this.m12 = a10*b02 + a11*b12 + a12*b22;

        this.m20 = a20*b00 + a21*b10 + a22*b20;
        this.m21 = a20*b01 + a21*b11 + a22*b21;
        this.m22 = a20*b02 + a21*b12 + a22*b22;
        
        return this;
    },

    /**
     * @method multiplyVector2
     * this に2次元ベクトル v を乗じます。
     * 2次元ベクトルは (x, y, 1) として乗算します。
     *
     * ### Example
     *     mat = phina.geom.Matrix33(0, -1, 1, -1, 4, -2, 1, 1, 1);
     *     v = phina.geom.Vector2(2, 4)
     *     mat.multiplyVector2(v) // => {x: -3, y: 12}
     *
     * @param {phina.geom.Vector2} v 乗じるベクトル
     * @return {phina.geom.Vector2} 乗算結果のベクトル
     */
    multiplyVector2: function(v) {
      var vx = this.m00*v.x + this.m01*v.y + this.m02;
      var vy = this.m10*v.x + this.m11*v.y + this.m12;
      
      return phina.geom.Vector2(vx, vy);
    },

    // 行
    /**
     * @method getRow
     * row 番目の行を配列で返します。row が 0、1、2 のいずれかでなければ null を返します。
     *
     * ### Example
     *     mat1 = phina.geom.Matrix33(1, 2, 3, 4, 5, 6, 7, 8, 9);
     *     mat1.getRow(0); // [1, 2, 3]
     *     mat1.getRow(1); // [4, 5, 6]
     *     mat1.getRow(9); // null
     *
     * @param {0/1/2} row 行番号
     * @return {Number[]} 行を表す配列
     */
    getRow: function(row) {
      if ( row === 0 ) {
        return [ this.m00, this.m01, this.m02 ];
      }
      else if ( row === 1 ) {
        return [ this.m10, this.m11, this.m12 ];
      }
      else if ( row === 2 ) {
        return [ this.m20, this.m21, this.m22 ];
      }
      else {
        return null;
      }
    },

    /**
     * @method getCol
     * col 番目の列を配列で返します。col が 0、1、2 のいずれかでなければ null を返します。
     *
     * ### Example
     *     mat1 = phina.geom.Matrix33(1, 2, 3, 4, 5, 6, 7, 8, 9);
     *     mat1.getCol(0); // [1, 4, 7]
     *     mat1.getCol(1); // [2, 5, 8]
     *     mat1.getRow(-1); // null
     *
     * @param {0/1/2} col 列番号
     * @return {Number[]} 列を表す配列
     */
    getCol: function(col) {
      if ( col === 0 ) {
        return [ this.m00, this.m10, this.m20 ];
      }
      else if ( col === 1 ) {
        return [ this.m01, this.m11, this.m21 ];
      }
      else if ( col === 2 ) {
        return [ this.m02, this.m12, this.m22 ];
      }
      else {
        return null;
      }
    },

    /**
     * @method toString
     * 行列を JSON 形式で表現した文字列を返します。
     *
     * ### Example
     *     v = phina.geom.Vector2(3, 4);
     *     v2 = v.clone();
     *     v2.x == v.x; // => true
     *
     * @return {String} JSON 文字列
     */
    toString: function() {
      return "|{m00}, {m01}, {m02}|\n|{m10}, {m11}, {m12}|\n|{m20}, {m21}, {m22}|".format(this);
    },

  });

  /**
   * @property {phina.geom.Matrix33} IDENTITY 単位行列
   * @readonly
   */
  phina.geom.Matrix33.IDENTITY = phina.geom.Matrix33().identity();

});


phina.namespace(function() {

  /**
   * @class phina.geom.Rect
   * # 矩形領域を表すクラス
   * キャンバス上の矩形領域を扱うクラスです。
   * 
   */
  phina.define('phina.geom.Rect', {

    /**
     * @property {Number} x
     * 矩形の左上頂点の x 座標
     */
    x: 0,
    /**
     * @property {Number} y
     * 矩形の左上頂点の y 座標
     */
    y: 0,
    /**
     * @property {Number} width
     * 矩形の幅
     */
    width: 32,
    /**
     * @property {Number} hight
     * 矩形の高さ
     */
    height: 32,

    /**
     * @method init
     * 矩形領域のコンストラクタです。
     *
     * ### Example
     *     rect = phina.geom.Rect(8, 16, 32, 64);
     *
     * @param {Number} x 矩形の左上頂点の x 座標
     * @param {Number} y 矩形の左上頂点の y 座標
     * @param {Number} width 幅
     * @param {Number} height 高さ
     * @return {phina.geom.Rect} 矩形領域オブジェクト
     */
    init: function(x, y, width, height) {
      this.set(x, y, width, height);
    },

    /**
     * @method set
     * @chainable
     * this の各値を再設定します。
     *
     * ### Example
     *     rect = phina.geom.Rect(8, 16, 32, 64);
     *     rect.set(0, 16, 32, 64);
     *
     * @param {Number} x 矩形の左上頂点の x 座標
     * @param {Number} y 矩形の左上頂点の y 座標
     * @param {Number} width 幅
     * @param {Number} height 高さ
     */
    set: function(x, y, width, height) {
      this.x = x;
      this.y = y;
      this.width = width;
      this.height = height;

      return this;
    },

    /**
     * @method moveTo
     * @chainable
     * 矩形領域を座標 (x, y) に移動します。
     *
     * ### Example
     *     rect = phina.geom.Rect(8, 16, 32, 64);
     *     rect.centerX; // => 24
     *     rect.moveTo(0, 0);
     *     rect.centerX; // => 16
     *
     * @param {Number} x 移動先の x 座標
     * @param {Number} y 移動先の y 座標
     */
    moveTo: function(x, y) {
      this.x = x;
      this.y = y;
      return this;
    },

    /**
     * @method moveBy
     * @chainable
     * 矩形領域を (x, y) だけ移動します。
     *
     * ### Example
     *     rect = phina.geom.Rect(8, 16, 32, 64);
     *     rect.moveBy(10, -10);
     *     rect.x; // => 18
     *     rect.y; // => 6
     *
     * @param {Number} x 移動量の x 座標
     * @param {Number} y 移動量の y 座標
     */
    moveBy: function(x, y) {
      this.x += x;
      this.y += y;
      return this;
    },

    /**
     * @method setSizse
     * @chainable
     * 矩形領域の幅と高さを変更します。
     *
     * ### Example
     *     rect = phina.geom.Rect(8, 16, 32, 64);
     *     rect.setSize(10, 20);
     *     rect.width; // => 10
     *     rect.height; // => 20
     *
     * @param {Number} width 幅
     * @param {Number} height 高さ
     */
    setSize: function(w, h) {
      this.width = w;
      this.height = h;
      return this;
    },

    /**
     * @method padding
     * @chainable
     * 矩形領域の中にパディング領域を設定します。
     *
     * 矩形領域自体のサイズはパディング領域の分だけ小さくなります。  
     * 幅の指定方法は CSS の padding 指定と同じように時計回りです。  
     * 引数が1つの場合は上下左右の値、引数が2つの場合は上下と左右の値、引数が３つの場合は上、左右、下の値と解釈します。
     *
     * ### Example
     *     rect = phina.geom.Rect(50, 100, 150, 200);
     *     rect.padding(10);
     *     rect.x; // => 60
     *     rect.y; // => 110
     *     rect.width; // => 130
     *     rect.height; // => 180
     *
     * @param {Number} top 上辺のパディング幅
     * @param {Number} right 右辺のパディング幅
     * @param {Number} bottom 下辺のパディング幅
     * @param {Number} left 左辺のパディング幅
     */
    padding: function(top, right, bottom, left) {
      // css の padding に合わせて時計回りにパラメータ調整
      switch (arguments.length) {
        case 1:
          top = right = bottom = left = arguments[0];
          break;
        case 2:
          top     = bottom = arguments[0];
          right   = left   = arguments[1];
          break;
        case 3:
          top     = arguments[0];
          right   = left = arguments[1];
          bottom  = arguments[2];
          break;
      }
      
      this.x += left;
      this.y += top;
      this.width -= left+right;
      this.height-= top +bottom;
      
      return this;
    },

    /**
     * @method contains
     * 座標 (x, y) が 矩形領域の中に含まれるかどうかを返します。
     *
     * ### Example
     *     rect = phina.geom.Rect(50, 100, 150, 200);
     *     rect.contains(35, 68); // =>  true
     *     rect.contains(200, 68); // => false
     *
     * @param {Number} x 判定する対象の x 座標
     * @param {Number} y 判定する対象の y 座標
     * @return {Boolean} 指定した座標が矩形領域の中に含まれるかどうか
     */
    contains: function(x, y) {
      return this.left <= x && x <= this.right && this.top <= y && y <= this.bottom;
    },

    /**
     * @method clone
     * this のコピーを生成して返します。
     *
     * ### Example
     *     rect = phina.geom.Rect(50, 100, 150, 200);
     *     rect2 = rect.clone();
     *     rect2.x == rect.x; // => true
     *
     * @return {Object} 生成した矩形領域
     */
    clone: function() {
      return phina.geom.Rect(this.x, this.y, this.width, this.height);
    },

    /**
     * @method toCircle
     * 矩形領域内に収まる最大の円領域を生成して返します。
     *
     * ### Example
     *     rect = phina.geom.Rect(32, 64, 100, 200);
     *     circle = rect.toCircle();
     *     circle.x; // => 82
     *     circle.y; // => 164
     *     circle.radius; // => 50
     *
     * @return {Object} 生成した円領域
     */
    toCircle: function() {
      var radius = ((this.width < this.height) ? this.width : this.height)/2;
      return phina.geom.Circle(this.centerX, this.centerY, radius);
    },

    /**
     * @method toArray
     * this の各値を要素とする配列を生成して返します。
     *
     * ### Example
     *     rect = phina.geom.Rect(32, 64, 100, 200);
     *     rect.toArray(); // => [32, 64, 100, 200]
     *
     * @return {Number[]} 生成した配列
     */
    toArray: function() {
      return [this.x, this.y, this.width, this.height];
    },

    _accessor: {
      
      /**
       * @property {Number} left
       * キャンバス左端から矩形領域の左辺までの距離
       *
       * left を変更すると矩形領域の幅（width）が自動的に調整されます。
       *
       * ### Example
       *     rect = phina.geom.Rect(32, 64, 100, 200);
       *     rect.left; // => 32
       *     rect.width; // => 100
       *     rect.right; // => 132
       *     
       *     rect.left = 42;
       *     rect.width; // => 90
       */
      left: {
        "get": function()   { return this.x; },
        "set": function(v)  { this.width -= v-this.x; this.x = v; }
      },
      /**
       * @property {Number} top
       * キャンバス上端から矩形領域の上辺までの位置
       *
       * top を変更すると矩形領域の高さ（height）が自動的に調整されます。
       */
      top: {
        "get": function()   { return this.y; },
        "set": function(v)  { this.height -= v-this.y; this.y = v; }
      },
      /**
       * @property {Number} right
       * キャンバス左端から矩形領域の右辺までの距離
       *
       * right を変更すると矩形領域の幅（width）が自動的に調整されます。
       */
      right: {
        "get": function()   { return this.x + this.width; },
        "set": function(v)  { this.width += v-this.right; },
      },
      /**
       * @property {Number} bottom
       * キャンバス上端から矩形領域の下辺までの位置
       *
       * bottom を変更すると矩形領域の高さ（height）が自動的に調整されます。
       */
      bottom: {
        "get": function()   { return this.y + this.height; },
        "set": function(v)  { this.height += v-this.bottom; },
      },
      
      /**
       * @property {Number} centerX
       * 矩形領域の x 座標
       *
       * 現時点では読み取り専用です。
       */
      centerX: {
        "get": function()   { return this.x + this.width/2; },
        "set": function(v)  {
          // TODO: 検討中
        },
      },
      /**
       * @property {Number} centerY
       * 矩形領域の y 座標
       *
       * 現時点では読み取り専用です。
       */
      centerY: {
        "get": function()   { return this.y + this.height/2; },
        "set": function(v)  {
          // TODO: 検討中
        },
      },
    }

  });

});


phina.namespace(function() {

  /**
   * @class phina.geom.Circle
   * # 円領域を表すクラス
   * キャンバス上の円領域を扱うクラスです。
   * 
   */
  phina.define('phina.geom.Circle', {

    /**
     * @property {Number} x
     * 円の中心の x 座標
     */
    x: 0,
    /**
     * @property {Number} y
     * 円の中心の y 座標
     */
    y: 0,
    /**
     * @property {Number} radius
     * 円の半径
     */
    radius: 32,

    /**
     * @method init
     * 円領域のコンストラクタです。
     *
     * ### Example
     *     circle = phina.geom.Circle(32, 64, 128);
     *
     * @param {Number} x 円の中心の x 座標
     * @param {Number} y 円の中心の y 座標
     * @param {Number} radius 半径
     * @return {phina.geom.Rect} 円領域オブジェクト
     */
    init: function(x, y, radius) {
      this.set(x, y, radius);
    },

    /**
     * @method set
     * @chainable
     * this の各値を再設定します。
     *
     * ### Example
     *     circle = phina.geom.Circle(32, 64, 128);
     *     circle.set(100, 200, 32);
     *
     * @param {Number} x 円を囲う矩形の左上頂点の x 座標
     * @param {Number} y 円を囲う矩形の左上頂点の x 座標
     * @param {Number} radius 半径
     * @return {phina.geom.Circle} 円領域オブジェクト
     */
    set: function(x, y, radius) {
      this.x = x;
      this.y = y;
      this.radius = radius;

      return this;
    },

    /**
     * @method moveTo
     * @chainable
     * 円領域を座標 (x, y) に移動します。(x, y) は円の中心を表します。
     *
     * ### Example
     *     circle = phina.geom.Circle(300, 300, 40);
     *     circle.left; // => 260
     *     circle.moveTo(100, 100);
     *     circle.left; // => 60
     *
     * @param {Number} x 移動先の x 座標
     * @param {Number} y 移動先の y 座標
     */
    moveTo: function(x, y) {
      this.x = x;
      this.y = y;
      return this;
    },

    /**
     * @method moveBy
     * @chainable
     * 円領域を (x, y) だけ移動します。
     *
     * ### Example
     *     circle = phina.geom.Circle(300, 300, 40);
     *     circle.left; // => 260
     *     circle.moveBy(100, 100);
     *     circle.left; // => 460
     *
     * @param {Number} x 移動量の x 座標
     * @param {Number} y 移動量の y 座標
     */
    moveBy: function(x, y) {
      this.x += x;
      this.y += y;
      return this;
    },

    /**
     * @method contains
     * 座標 (x, y) が円領域の中に含まれるかどうかを返します。
     *
     * ### Example
     *     circle = phina.geom.Circle(300, 300, 100);
     *     circle.contains(350, 350); // =>  true
     *     circle.contains(350, 400); // => false
     *
     * @param {Number} x 判定する対象の x 座標
     * @param {Number} y 判定する対象の y 座標
     * @return {Boolean} 指定した座標が円領域の中に含まれるかどうか
     */
    contains: function(x, y) {
      var lenX = this.x-x;
      var lenY = this.y-y;
      var lenSquared = (lenX*lenX)+(lenY*lenY);

      return lenSquared <= this.radius*this.radius;
    },

    /**
     * @method clone
     * this のコピーを生成して返します。
     *
     * ### Example
     *     circle = phina.geom.Circle(50, 100, 40);
     *     circle2 = circle.clone();
     *     circle2.x == circle.x; // => true
     *
     * @return {Object} 生成した円領域
     */
    clone: function() {
      return phina.geom.Circle(this.x, this.y, this.radius);
    },

    /**
     * @method toRect
     * 円に外接する正方形を表す矩形領域を生成して返します。
     *
     * ### Example
     *     circle = phina.geom.Circle(50, 100, 40);
     *     rect = circle.toRect();
     *     rect.x; // => 10
     *     rect.y; // => 60
     *     rect.width; // => 80
     *
     * @return {Object} 生成した矩形領域
     */
    toRect: function() {
      var size = this.size;
      return phina.geom.Rect(this.x - this.radius, this.y - this.radius, size, size);
    },
    /**
     * @method toArray
     * this の各値を要素とする配列を生成して返します。
     *
     * ### Example
     *     circle = phina.geom.Circle(50, 100, 40);
     *     rect.toArray(); // => [50, 100, 40]
     *
     * @return {Number[]} 生成した配列
     */
    toArray: function() {
      return [this.x, this.y, this.radius];
    },

    _accessor: {
      
      /**
       * @property {Number} left
       * @readonly
       * キャンバス左端から円の左端までの距離
       *
       * 現時点では読み取り専用です。
       *
       * ### Example
       *     circle = phina.geom.Circle(200, 300, 100);
       *     circle.left; // => 100
       *     circle.top; // => 200
       *     circle.right; // => 300
       *     circle.bottom; // => 400
       */
      left: {
        "get": function()   { return this.x - this.radius; },
        "set": function(v)  {
          // TODO: 
        }
      },
      /**
       * @property {Number} top
       * @readonly
       * キャンバス上端から円の上端までの距離
       *
       * 現時点では読み取り専用です。
       */
      top: {
        "get": function()   { return this.y - this.radius; },
        "set": function(v)  {
          // TODO: 
        }
      },
      /**
       * @property {Number} right
       * @readonly
       * キャンバス右端から円の右端までの距離
       *
       * 現時点では読み取り専用です。
       */
      right: {
        "get": function()   { return this.x + this.radius; },
        "set": function(v)  {
          // TODO: 
        }
      },
      /**
       * @property {Number} bottom
       * @readonly
       * キャンバス下端から円の下端までの距離
       *
       * 現時点では読み取り専用です。
       */
      bottom: {
        "get": function()   { return this.y + this.radius; },
        "set": function(v)  {
          // TODO: 
        }
      },
      /**
       * @property {Number} size
       * @readonly
       * 円の直径
       *
       * 現時点では読み取り専用です。
       */
      size: {
        "get": function()   { return this.radius*2; },
        "set": function(v)  {
          // TODO: 検討中
        },
      },
    }

  });

});


phina.namespace(function() {

  /**
   * @class phina.geom.Collision
   * # 衝突判定用クラス
   * 衝突判定のためのクラスです。すべてのメソッドがスタティックメソッドです。
   * 
   */
  phina.define('phina.geom.Collision', {

    _static: {
      /**
       * @method testCircleCircle
       * @static
       * 2つの円領域が重なっているかどうかを判定します
       *
       * ### Example
       *     circle1 = phina.geom.Circle(100, 100, 30);
       *     circle2 = phina.geom.Circle(130, 140, 30);
       * phina.geom.Collision.testCircleCircle(circle1, circle2); // => true
       *
       * @param {phina.geom.Circle} circle1 円領域オブジェクト
       * @param {phina.geom.Circle} circle2 円領域オブジェクト
       * @return {Boolean} 領域が重なっているかどうか
       */
      testCircleCircle: function(circle0, circle1) {
        var distanceSquared = phina.geom.Vector2.distanceSquared(circle0, circle1);
        return distanceSquared <= Math.pow(circle0.radius + circle1.radius, 2);
      },
      /**
       * @method testRectRect
       * @static
       * 2つの矩形領域が重なっているかどうかを判定します
       *
       * ### Example
       *     rect1 = phina.geom.Rect(100, 100, 30, 40);
       *     rect2 = phina.geom.Rect(200, 200, 10, 10);
       *     phina.geom.Collision.testRectRect(rect1, rect2); // => false
       *
       * @param {phina.geom.Rect} rect1 矩形領域オブジェクト
       * @param {phina.geom.Rect} rect2 矩形領域オブジェクト
       * @return {Boolean} 領域が重なっているかどうか
       */
      testRectRect: function(rect0, rect1) {
        return (rect0.left < rect1.right) && (rect0.right > rect1.left) &&
          (rect0.top < rect1.bottom) && (rect0.bottom > rect1.top);
      },
      /**
       * @method testCircleRect
       * @static
       * 円領域と矩形領域が重なっているかどうかかを判定します
       *
       * ### Example
       *     circle = phina.geom.Circle(100, 100, 30);
       *     rect = phina.geom.Rect(100, 100, 30, 40);
       *     phina.geom.Collision.testCircleRect(circle, rect); // => true
       *
       * @param {phina.geom.Circle} circle 円領域オブジェクト
       * @param {phina.geom.Rect} rect 矩形領域オブジェクト
       * @return {Boolean} 領域が重なっているかどうか
       */
      testCircleRect: function(circle, rect) {
        // まずは大きな矩形で判定(高速化)
        var bigRect = phina.geom.Rect(rect.left-circle.radius, rect.top-circle.radius, rect.width+circle.radius*2, rect.height+circle.radius*2);
        if (bigRect.contains(circle.x, circle.y) === false) {
          return false;
        }
        
        // 2種類の矩形と衝突判定
        var r = phina.geom.Rect(rect.left-circle.radius, rect.top, rect.width+circle.radius*2, rect.height);
        if (r.contains(circle.x, circle.y)) {
          return true;
        }
        r.set(rect.left, rect.top-circle.radius, rect.width, rect.height+circle.radius*2);
        if (r.contains(circle.x, circle.y)) {
          return true;
        }
        
        // 円と矩形の４点の判定
        var c = phina.geom.Circle(circle.x, circle.y, circle.radius);
        // left top
        if (c.contains(rect.left, rect.top)) {
          return true;
        }
        // right top
        if (c.contains(rect.right, rect.top)) {
          return true;
        }
        // right bottom
        if (c.contains(rect.right, rect.bottom)) {
          return true;
        }
        // left bottom
        if (c.contains(rect.left, rect.bottom)) {
          return true;
        }
        
        return false;
      },
      /**
       * @method testCircleLine
       * @static
       * 円領域と線分が重なっているかどうかを判定します
       *
       * ### Example
       *     circle = phina.geom.Circle(100, 100, 20);
       *     p1 = phina.geom.Vector2(0, 0);
       *     p2 = phina.geom.Vector2(300, 400);
       *     phina.geom.Collision.testCircleLine(circle, p1, p2); // => true
       *
       * @param {phina.geom.Circle} circle 円領域オブジェクト
       * @param {phina.geom.Vector2} p1 線分の端の座標
       * @param {phina.geom.Vector2} p2 線分の端の座標
       * @return {Boolean} 円領域と線分が重なっているかどうか
       */
      testCircleLine : function(circle, p1, p2) {
        // 先に線分端との判定
        if (circle.contains(p1.x, p1.y) || circle.contains(p2.x, p2.y)) return true;
        // 半径の2乗
        var r2 = circle.radius * circle.radius;
        // 円の中心座標
        var p3 = phina.geom.Vector2(circle.x, circle.y);
        // 各ベクトル
        var p1p2 = phina.geom.Vector2.sub(p1, p2);
        var p1p3 = phina.geom.Vector2.sub(p1, p3);
        var p2p3 = phina.geom.Vector2.sub(p2, p3);
        // 外積
        var cross = phina.geom.Vector2.cross(p1p2, p1p3);
        // 外積の絶対値の2乗
        var cross2 = cross * cross;
        // p1p2の長さの2乗
        var length2 = p1p2.lengthSquared();
        // 円の中心から線分までの垂線の距離の2乗
        var d2 = cross2 / length2;
        // 円の半径の2乗より小さいなら重複
        if (d2 <= r2) {
          var dot1 = phina.geom.Vector2.dot(p1p3, p1p2);
          var dot2 = phina.geom.Vector2.dot(p2p3, p1p2);
          // 通常は内積の乗算
          if (dot1 * dot2 <= 0) return true;
        }
        return false;
      },
      /**
       * @method testLineLine
       * @static
       * 2つの線分が重なっているかどうかを判定します
       * 参考：http://www5d.biglobe.ne.jp/~tomoya03/shtml/algorithm/Intersection.htm
       *
       * ### Example
       *     p1 = phina.geom.Vector2(100, 100);
       *     p2 = phina.geom.Vector2(200, 200);
       *     p3 = phina.geom.Vector2(150, 240);
       *     p4 = phina.geom.Vector2(200, 100);
       * phina.geom.Collision.testLineLine(p1, p2, p3, p4); // => true
       *
       * @param {phina.geom.Vector2} p1 線分1の端の座標
       * @param {phina.geom.Vector2} p2 線分1の端の座標
       * @param {phina.geom.Vector2} p3 線分2の端の座標
       * @param {phina.geom.Vector2} p4 線分2の端の座標
       * @return {Boolean} 線分1と線分2が重なっているかどうか
       */
      testLineLine : function(p1, p2, p3, p4) {
        //同一ＸＹ軸上に乗ってる場合の誤判定回避
        if (p1.x == p2.x && p1.x == p3.x && p1.x == p4.x) {
          var min = Math.min(p1.y, p2.y);
          var max = Math.max(p1.y, p2.y);
          if (min <= p3.y && p3.y <= max || min <= p4.y && p4.y <= max) return true;
          return false;
        }
        if (p1.y == p2.y && p1.y == p3.y && p1.y == p4.y) {
          var min = Math.min(p1.x, p2.x);
          var max = Math.max(p1.x, p2.x);
          if (min <= p3.x && p3.x <= max || min <= p4.x && p4.x <= max) return true;
          return false;
        }
        //通常判定
        var a = (p1.x - p2.x) * (p3.y - p1.y) + (p1.y - p2.y) * (p1.x - p3.x);
        var b = (p1.x - p2.x) * (p4.y - p1.y) + (p1.y - p2.y) * (p1.x - p4.x);
        var c = (p3.x - p4.x) * (p1.y - p3.y) + (p3.y - p4.y) * (p3.x - p1.x);
        var d = (p3.x - p4.x) * (p2.y - p3.y) + (p3.y - p4.y) * (p3.x - p2.x);
        return a * b <= 0 && c * d <= 0;
      },
      /**
       * @method testRectLine
       * @static
       * 矩形と線分が重なっているかどうかを判定します
       *
       * ### Example
       *     rect = phina.geom.Rect(120, 130, 40, 50);
       *     p1 = phina.geom.Vector2(100, 100);
       *     p2 = phina.geom.Vector2(200, 200);
       * phina.geom.Collision.testRectLine(rect, p1, p2); // => true
       *
       * @param {phina.geom.Rect} rect 矩形領域オブジェクト
       * @param {phina.geom.Vector2} p1 線分の端の座標
       * @param {phina.geom.Vector2} p2 線分の端の座標
       * @return {Boolean} 矩形と線分が重なっているかどうか
       */
      testRectLine : function(rect, p1, p2) {
          //包含判定(p1が含まれてれば良いのでp2の判定はしない）
          if (rect.left <= p1.x && p1.x <= rect.right && rect.top <= p1.y && p1.y <= rect.bottom ) return true;

          //矩形の４点
          var r1 = phina.geom.Vector2(rect.left, rect.top);     //左上
          var r2 = phina.geom.Vector2(rect.right, rect.top);    //右上
          var r3 = phina.geom.Vector2(rect.right, rect.bottom); //右下
          var r4 = phina.geom.Vector2(rect.left, rect.bottom);  //左下

          //矩形の４辺をなす線分との接触判定
          if (phina.geom.Collision.testLineLine(p1, p2, r1, r2)) return true;
          if (phina.geom.Collision.testLineLine(p1, p2, r2, r3)) return true;
          if (phina.geom.Collision.testLineLine(p1, p2, r3, r4)) return true;
          if (phina.geom.Collision.testLineLine(p1, p2, r1, r4)) return true;
          return false;
      },
    }

  });

});


phina.namespace(function() {

  /**
   * @class phina.util.Support
   * 
   */
  phina.define('phina.util.Support', {
    _static: {
      canvas: !!phina.global.CanvasRenderingContext2D,
      webGL: (function() {
        return !!phina.global.CanvasRenderingContext2D && !!document.createElement('canvas').getContext('webgl');
      })(),
      webAudio: !!phina.global.AudioContext || !!phina.global.webkitAudioContext || !!phina.global.mozAudioContext,
    },
  });

});


phina.namespace(function() {

  /**
   * @class phina.util.EventDispatcher
   * # イベントを扱うためのクラス
   * イベントを扱うためのメソッドやプロパティを定義しているクラスです。
   * phina.js が提供するクラスの多くはこの EventDispatcher クラスの子孫となっているため、
   * ほとんどのオブジェクトで容易にイベントを扱うことができます。
   *
   * # 少し説明
   * this.onxxx = function(){}; でもイベントリスナを設定できるが、あまり推奨しない。
   * 呼び出される順序は、まず this.onxxxx が呼び出され、あとは on() で登録した順番。
   */
  phina.define('phina.util.EventDispatcher', {

    init: function() {
      this._listeners = {};
    },

    /**
     * @method on
     * @chainable
     * イベントリスナを登録します。
     *
     * １つのイベントに対するイベントリスナはいくつでも登録することができます。
     *
     * 標準のイベントを検知するには、オブジェクトの {@link Object2D#interactive} プロパティが true である必要があります。
     * {@link Object2D#interactive} プロパティを設定するには {@link Object2D#setInteractive} メソッドを呼び出してください。
     *
     * また、{@link #flare} や {@link #fire} によって定義したカスタムイベントに対するイベントリスナも登録することが
     * できます。カスタムイベントのイベントリスナは {@link Object2D#interactive} プロパティによらず呼び出されます。
     * なおカスタムイベントのオブジェクトは Event オブジェクトとは異なります。
     *
     * ###Reference
     * 標準のイベントの種類は以下を参照してください。  
     * - [Event reference | MDN]( https://developer.mozilla.org/en-US/docs/Web/Events )
     *
     * ### Example
     *     var shape = CircleShape().addChildTo(this).setInteractive(true).setPosition(50, 50);
     *     shape.on("touchstart", function(e){
     *       this.color = "blue";
     *     });
     *
     * @param {String} type イベントの種類
     * @param {Function} listener イベントリスナとなる関数
     * @param {Object} listener.event Event オブジェクト、またはカスタムイベントのオブジェクト
     */
    on: function(type, listener) {
      if (this._listeners[type] === undefined) {
        this._listeners[type] = [];
      }

      this._listeners[type].push(listener);
      return this;
    },

    /**
     * @method off
     * @chainable
     * イベントリスナを削除します。
     *
     * ある種類のイベントに対するイベントリスナをすべて削除するには {@link #clear} を使用してください。
     *
     * @param {String} type イベントの種類
     * @param {Function} listener イベントリスナ関数
     */
    off: function(type, listener) {
      var listeners = this._listeners[type];
      var index = listeners.indexOf(listener);
      if (index != -1) {
        listeners.splice(index,1);
      }
      return this;
    },

    /**
     * @method fire
     * @chainable
     * カスタムイベントを表すオブジェクトを指定してカスタムイベントを発火します。
     *
     * @param {Object} event カスタムイベントを表すオブジェクト
     * @param {String} event.type カスタムイベントの名前
     */
     fire: function(e) {
       if (!e.target) {
         e.target = this;
       }
      var oldEventName = 'on' + e.type;
      if (this[oldEventName]) this[oldEventName](e);
      
      var listeners = this._listeners[e.type];
      if (listeners) {
        var temp = listeners.clone();
        for (var i=0,len=temp.length; i<len; ++i) {
            temp[i].call(this, e);
        }
      }
      
      return this;
    },

    /**
     * @method flare
     * @chainable
     * イベント名を指定してカスタムイベントを発火します。
     *
     * param 引数を指定することによりカスタムイベントに任意のプロパティを設定することができます。  
     * これにより、呼び出し元がイベントリスナに任意の値を渡すことができます。  
     * （ただし target プロパティには必ず自分自身が格納されます。）
     *
     * ### Example
     *     //
     *
     * @param {String} type カスタムイベントの名前
     * @param {Object} [param] カスタムイベントにプロパティを設定するためのオブジェクト
    */
    flare: function(type, param) {
      var e = {type:type};
      if (param) {
        param.forIn(function(key, val) {
          e[key] = val;
        });
      }
      this.fire(e);

      return this;
    },

    /**
     * @method one
     * @chainable
     * 一度だけ実行されるイベントリスナを登録します。
     *
     * 指定したイベントリスナが一度実行されると、そのイベントリスナは削除されます。それ以外の挙動は {@link #on} と同じです。
     *
     * @param {String} type イベントの種類
     * @param {Function} listener イベントリスナとなる関数
     * @param {Object} listener.event Event オブジェクト、またはカスタムイベントのオブジェクト
     */
    one: function(type, listener) {
      var self = this;
      
      var func = function() {
        var result = listener.apply(self, arguments);
        self.off(type, func);
        return result;
      };
      
      this.on(type, func);
      
      return this;
    },

    /**
     * @method has
     * イベントリスナが登録されているかどうかを調べます。
     *
     * 指定したイベントの種類に対するイベントリスナが登録されている場合は true、そうでない場合は false を返します。
     *
     * @param {String} type イベントの種類
     * @return {Boolean} 指定したイベントのイベントリスナが登録されているかどうか
     */
    has: function(type) {
      return (this._listeners[type] !== undefined && this._listeners[type].length !== 0) || !!this['on' + type];
    },

    /**
     * @method clear
     * @chainable
     * ある種類のイベントに対するイベントリスナをすべて削除します。
     *
     * 特定のイベントリスナのみを削除するには {@link #off} を使用してください。
     *
     * @param {String} type イベントの種類
     */
    clear: function(type) {
      var oldEventName = 'on' + type;
      if (this[oldEventName]) delete this[oldEventName];
      this._listeners[type] = [];
      return this;
    },
  });

  /**
   * @method addEventListener
   * {@link #on} のエイリアスです。
   */
  /**
   * @method removeEventListener
   * {@link #off} のエイリアスです。
   */
  /**
   * @method clearEventListener
   * {@link #clear} のエイリアスです。
   */
  /**
   * @method hasEventListener
   * {@link #has} のエイリアスです。
   */
  /**
   * @method dispatchEvent
   * {@link #fire} のエイリアスです。
   */
  /**
   * @method dispatchEventByType
   * {@link #flare} のエイリアスです。
   */
  (function() {
    var methodMap = {
      addEventListener: 'on',
      removeEventListener: 'off',
      clearEventListener: 'clear',
      hasEventListener: 'has',
      dispatchEvent: 'fire',
      dispatchEventByType: 'flare',
    };
    methodMap.forIn(function(old, name) {
      phina.util.EventDispatcher.prototype.$method(old, phina.util.EventDispatcher.prototype[name]);
    });
  })();

});


;(function() {

  /**
   * @class phina.util.Tween
   * @extends phina.util.EventDispatcher
   * 
   */
  phina.define('phina.util.Tween', {
    superClass: 'phina.util.EventDispatcher',

    /**
     * @constructor
     */
    init: function(target) {
      this.superInit();

      this.time = 0;
    },

    fromTo: function(target, beginProps, finishProps, duration, easing) {
      this.target = target;
      this.beginProps = beginProps;
      this.finishProps = finishProps;
      this.duration = duration || 1000;
      this.easing = easing;

      // setup
      this.changeProps = {};
      for (var key in beginProps) {
          this.changeProps[key] = finishProps[key] - beginProps[key];
      }

      return this;
    },

    to: function(target, finishProps, duration, easing) {
      var beginProps = {};

      for (var key in finishProps) {
        beginProps[key] = target[key];
      }

      this.fromTo(target, beginProps, finishProps, duration, easing);

      return this;
    },

    from: function(target, beginProps, duration, easing) {
        var finishProps = {};

        for (var key in beginProps) {
          finishProps[key] = target[key];
          target[key] = beginProps[key];
        }

        this.fromTo(target, beginProps, finishProps, duration, easing);

        return this;
    },

    by: function(target, props, duration, easing) {
      var beginProps = {};
      var finishProps = {};

      for (var key in props) {
        beginProps[key] = target[key];
        finishProps[key] = target[key] + props[key];
      }

      this.fromTo(target, beginProps, finishProps, duration, easing);

      return this;
    },

    yoyo: function() {
      var temp = this.beginProps;
      this.beginProps = this.finishProps;
      this.finishProps = temp;
      this.changeProps.forIn(function(key, value, index) {
        this.changeProps[key] = -value;
        this.target[key] = this.beginProps[key];
      }, this);
      // TODO: easing も反転させる
      // this.easing = easing;
      return this;
    },

    gain: function(time) {
      this.seek(this.time + time);
    },
    forward: function(time) {
      this.seek(this.time + time);
    },

    backward: function(time) {
      this.seek(this.time - time);
    },

    seek: function(time) {
      this.time = Math.clamp(time, 0, this.duration);

      this.beginProps.forIn(function(key, value) {
        var v = this.easing(this.time, value, this.changeProps[key], this.duration);
        this.target[key] = v;
      }, this);

      return this;
    },

    _accessor: {
      easing: {
        get: function() {
          return this._easing;
        },
        set: function(v) {
          this._easing = phina.util.Tween.EASING[v] || phina.util.Tween.EASING.default;
        },
      },
    },

    _static: {
      /**
       * @static
       * イージング
       * ### Reference
       * - <http://coderepos.org/share/wiki/JSTweener>
       * - <http://coderepos.org/share/browser/lang/javascript/jstweener/trunk/src/JSTweener.js>
       * - <http://gsgd.co.uk/sandbox/jquery/easing/jquery.easing.1.3.js>
       * - <http://hosted.zeh.com.br/tweener/docs/en-us/misc/transitions.html>
       */
      EASING: {

        /** default */
        "default": function(t, b, c, d) {
          return c*t/d + b;
        },
        /** linear */
        linear: function(t, b, c, d) {
          return c*t/d + b;
        },
        /** swing */
        swing: function(t, b, c, d) {
          return -c *(t/=d)*(t-2) + b;
        },
        /** easeInQuad */
        easeInQuad: function(t, b, c, d) {
          return c*(t/=d)*t + b;
        },
        /** easeOutQuad */
        easeOutQuad: function(t, b, c, d) {
          return -c *(t/=d)*(t-2) + b;
        },
        /** easeInOutQuad */
        easeInOutQuad: function(t, b, c, d) {
          if((t/=d/2) < 1) return c/2*t*t + b;
          return -c/2 *((--t)*(t-2) - 1) + b;
        },
        /** defeInCubic */
        easeInCubic: function(t, b, c, d) {
          return c*(t/=d)*t*t + b;
        },
        /** easeOutCubic */
        easeOutCubic: function(t, b, c, d) {
          return c*((t=t/d-1)*t*t + 1) + b;
        },
        /** easeInOutCubic */
        easeInOutCubic: function(t, b, c, d) {
          if((t/=d/2) < 1) return c/2*t*t*t + b;
          return c/2*((t-=2)*t*t + 2) + b;
        },
        /** easeOutInCubic */
        easeOutInCubic: function(t, b, c, d) {
          if(t < d/2) return phina.util.Tween.EASING.easeOutCubic(t*2, b, c/2, d);
          return phina.util.Tween.EASING.easeInCubic((t*2)-d, b+c/2, c/2, d);
        },
        /** easeInQuart */
        easeInQuart: function(t, b, c, d) {
          return c*(t/=d)*t*t*t + b;
        },
        /** easeOutQuart */
        easeOutQuart: function(t, b, c, d) {
          return -c *((t=t/d-1)*t*t*t - 1) + b;
        },
        /** easeInOutQuart */
        easeInOutQuart: function(t, b, c, d) {
          if((t/=d/2) < 1) return c/2*t*t*t*t + b;
          return -c/2 *((t-=2)*t*t*t - 2) + b;
        },
        /** easeOutInQuart */
        easeOutInQuart: function(t, b, c, d) {
          if(t < d/2) return phina.util.Tween.EASING.easeOutQuart(t*2, b, c/2, d);
          return phina.util.Tween.EASING.easeInQuart((t*2)-d, b+c/2, c/2, d);
        },
        /** easeInQuint */
        easeInQuint: function(t, b, c, d) {
          return c*(t/=d)*t*t*t*t + b;
        },
        /** easeOutQuint */
        easeOutQuint: function(t, b, c, d) {
          return c*((t=t/d-1)*t*t*t*t + 1) + b;
        },
        /** easeInOutQuint */
        easeInOutQuint: function(t, b, c, d) {
          if((t/=d/2) < 1) return c/2*t*t*t*t*t + b;
          return c/2*((t-=2)*t*t*t*t + 2) + b;
        },
        /** easeOutInQuint */
        easeOutInQuint: function(t, b, c, d) {
          if(t < d/2) return phina.util.Tween.EASING.easeOutQuint(t*2, b, c/2, d);
          return phina.util.Tween.EASING.easeInQuint((t*2)-d, b+c/2, c/2, d);
        },
        /** easeInSine */
        easeInSine: function(t, b, c, d) {
          return -c * Math.cos(t/d *(Math.PI/2)) + c + b;
        },
        /** easeOutSine */
        easeOutSine: function(t, b, c, d) {
          return c * Math.sin(t/d *(Math.PI/2)) + b;
        },
        /** easeInOutSine */
        easeInOutSine: function(t, b, c, d) {
          return -c/2 *(Math.cos(Math.PI*t/d) - 1) + b;
        },
        /** easeOutInSine */
        easeOutInSine: function(t, b, c, d) {
          if(t < d/2) return phina.util.Tween.EASING.easeOutSine(t*2, b, c/2, d);
          return phina.util.Tween.EASING.easeInSine((t*2)-d, b+c/2, c/2, d);
        },
        /** easeInExpo */
        easeInExpo: function(t, b, c, d) {
          return(t==0) ? b : c * Math.pow(2, 10 *(t/d - 1)) + b - c * 0.001;
        },
        /** easeOutExpo */
        easeOutExpo: function(t, b, c, d) {
          return(t==d) ? b+c : c * 1.001 *(-Math.pow(2, -10 * t/d) + 1) + b;
        },
        /** easeInOutExpo */
        easeInOutExpo: function(t, b, c, d) {
          if(t==0) return b;
          if(t==d) return b+c;
          if((t/=d/2) < 1) return c/2 * Math.pow(2, 10 *(t - 1)) + b - c * 0.0005;
          return c/2 * 1.0005 *(-Math.pow(2, -10 * --t) + 2) + b;
        },
        /** easeOutInExpo */
        easeOutInExpo: function(t, b, c, d) {
          if(t < d/2) return phina.util.Tween.EASING.easeOutExpo(t*2, b, c/2, d);
          return phina.util.Tween.EASING.easeInExpo((t*2)-d, b+c/2, c/2, d);
        },
        /** easeInCirc */
        easeInCirc: function(t, b, c, d) {
          return -c *(Math.sqrt(1 -(t/=d)*t) - 1) + b;
        },
        /** easeOutCirc */
        easeOutCirc: function(t, b, c, d) {
          return c * Math.sqrt(1 -(t=t/d-1)*t) + b;
        },
        /** easeInOutCirc */
        easeInOutCirc: function(t, b, c, d) {
          if((t/=d/2) < 1) return -c/2 *(Math.sqrt(1 - t*t) - 1) + b;
          return c/2 *(Math.sqrt(1 -(t-=2)*t) + 1) + b;
        },
        /** easeOutInCirc */
        easeOutInCirc: function(t, b, c, d) {
          if(t < d/2) return phina.util.Tween.EASING.easeOutCirc(t*2, b, c/2, d);
          return phina.util.Tween.EASING.easeInCirc((t*2)-d, b+c/2, c/2, d);
        },
        /** easeInElastic */
        easeInElastic: function(t, b, c, d, a, p) {
          var s;
          if(t==0) return b;  if((t/=d)==1) return b+c;  if(!p) p=d*.3;
          if(!a || a < Math.abs(c)) { a=c; s=p/4; } else s = p/(2*Math.PI) * Math.asin(c/a);
          return -(a*Math.pow(2,10*(t-=1)) * Math.sin((t*d-s)*(2*Math.PI)/p )) + b;
        },
        /** easeOutElastic */
        easeOutElastic: function(t, b, c, d, a, p) {
          var s;
          if(t==0) return b;  if((t/=d)==1) return b+c;  if(!p) p=d*.3;
          if(!a || a < Math.abs(c)) { a=c; s=p/4; } else s = p/(2*Math.PI) * Math.asin(c/a);
          return(a*Math.pow(2,-10*t) * Math.sin((t*d-s)*(2*Math.PI)/p ) + c + b);
        },
        /** easeInOutElastic */
        easeInOutElastic: function(t, b, c, d, a, p) {
          var s;
          if(t==0) return b;  if((t/=d/2)==2) return b+c;  if(!p) p=d*(.3*1.5);
          if(!a || a < Math.abs(c)) { a=c; s=p/4; }       else s = p/(2*Math.PI) * Math.asin(c/a);
          if(t < 1) return -.5*(a*Math.pow(2,10*(t-=1)) * Math.sin((t*d-s)*(2*Math.PI)/p )) + b;
          return a*Math.pow(2,-10*(t-=1)) * Math.sin((t*d-s)*(2*Math.PI)/p )*.5 + c + b;
        },
        /** easeOutInElastic */
        easeOutInElastic: function(t, b, c, d, a, p) {
          if(t < d/2) return phina.util.Tween.EASING.easeOutElastic(t*2, b, c/2, d, a, p);
          return phina.util.Tween.EASING.easeInElastic((t*2)-d, b+c/2, c/2, d, a, p);
        },
        /** easeInBack */
        easeInBack: function(t, b, c, d, s) {
          if(s == undefined) s = 1.70158;
          return c*(t/=d)*t*((s+1)*t - s) + b;
        },
        /** easeOutBack */
        easeOutBack: function(t, b, c, d, s) {
          if(s == undefined) s = 1.70158;
          return c*((t=t/d-1)*t*((s+1)*t + s) + 1) + b;
        },
        /** easeInOutBack */
        easeInOutBack: function(t, b, c, d, s) {
          if(s == undefined) s = 1.70158;
          if((t/=d/2) < 1) return c/2*(t*t*(((s*=(1.525))+1)*t - s)) + b;
          return c/2*((t-=2)*t*(((s*=(1.525))+1)*t + s) + 2) + b;
        },
        /** easeOutInBack */
        easeOutInBack: function(t, b, c, d, s) {
          if(t < d/2) return phina.util.Tween.EASING.easeOutBack(t*2, b, c/2, d, s);
          return phina.util.Tween.EASING.easeInBack((t*2)-d, b+c/2, c/2, d, s);
        },
        /** easeInBounce */
        easeInBounce: function(t, b, c, d) {
          return c - phina.util.Tween.EASING.easeOutBounce(d-t, 0, c, d) + b;
        },
        /** easeOutBounce */
        easeOutBounce: function(t, b, c, d) {
          if((t/=d) <(1/2.75)) {
            return c*(7.5625*t*t) + b;
          } else if(t <(2/2.75)) {
            return c*(7.5625*(t-=(1.5/2.75))*t + .75) + b;
          } else if(t <(2.5/2.75)) {
            return c*(7.5625*(t-=(2.25/2.75))*t + .9375) + b;
          } else {
            return c*(7.5625*(t-=(2.625/2.75))*t + .984375) + b;
          }
        },
        /** easeInOutBounce */
        easeInOutBounce: function(t, b, c, d) {
          if(t < d/2) return phina.util.Tween.EASING.easeInBounce(t*2, 0, c, d) * .5 + b;
          else return phina.util.Tween.EASING.easeOutBounce(t*2-d, 0, c, d) * .5 + c*.5 + b;
        },
        /** easeOutInBounce */
        easeOutInBounce: function(t, b, c, d) {
          if(t < d/2) return phina.util.Tween.EASING.easeOutBounce(t*2, b, c/2, d);
          return phina.util.Tween.EASING.easeInBounce((t*2)-d, b+c/2, c/2, d);
        }

      },
    },
  });

})();



;(function() {

  /**
   * @class phina.util.Ticker
   * tick management class
   * @extends phina.util.EventDispatcher
   */
  phina.define('phina.util.Ticker', {
    superClass: 'phina.util.EventDispatcher',

    /** 経過フレーム数 */
    frame: null,
    /** 1フレームの経過時間 */
    deltaTime: null,
    /** 全体の経過時間 */
    elapsedTime: null,

    /**
     * @constructor
     */
    init: function() {
      this.superInit();

      this.fps = 30;
      this.frame = 0;
      this.deltaTime = 0;
      this.elapsedTime = 0;
      this.isPlaying = true;
      this.runner = phina.util.Ticker.runner;
    },

    tick: function(func) {
      this.on('tick', func);
    },

    untick: function(func) {
      this.off('tick', func);
    },

    run: function() {
      var now = (new Date()).getTime();
      // 1フレームに掛かった時間
      this.deltaTime = now - this.currentTime;
      // 全体の経過時間
      this.elapsedTime = now - this.startTime;

      var start = this.currentTime = now;
      this.flare('tick');
      var end = (new Date()).getTime();

      // フレームを更新
      this.frame += 1;

      // calculate elapsed time
      var elapsed = end-start;

      // calculate next waiting time
      var delay = Math.max(this.frameTime-elapsed, 0);

      return delay;
    },

    start: function() {
      var self = this;
      this.isPlaying = true;
      this.startTime = this.currentTime = (new Date()).getTime();
      var fn = function() {
        if (self.isPlaying) {
          var delay = self.run();
          self.runner(fn, delay);
        }
      };
      fn();

      return this;
    },

    resume: function() {
      // TODO: 
    },

    stop: function() {
      this.isPlaying = false;
      return this;
    },

    rewind: function() {
      // TODO: 
    },

    _accessor: {
      fps: {
        "get": function()   { return this._fps; },
        "set": function(v)  {
          this._fps = v;
          this.frameTime = 1000/this._fps;
        },
      },
    },
    
    _static: {
      runner: function(run, delay) {
        setTimeout(run, delay);
      },
    },
    
  });

})();

;(function() {

  /**
   * @class phina.util.Grid
   * tick management class
   */
  phina.define('phina.util.Grid', {

    /** 幅 */
    width: 640,
    /** 列数 */
    columns: 12,
    /** ループ */
    loop: false,
    /** オフセット値 */
    offset: 0,

    /**
     * @constructor
     */
    init: function() {
      if (typeof arguments[0] === 'object') {
        var param = arguments[0];
        var width = param.width || 640;
        var columns = param.columns || 12;
        var loop = param.loop || false;
        var offset = param.offset || 0;
      }
      else {
        var width   = arguments[0] || 640;
        var columns = arguments[1] || 12;
        var loop    = arguments[2] || false;
        var offset = arguments[3] || 0;
      }

      this.width = width;
      this.columns = columns;
      this.loop = loop;
      this.offset = offset;
      this.unitWidth = this.width/this.columns;
    },

    // スパン指定で値を取得(負数もok)
    span: function(index) {
      if (this.loop) {
        index += this.columns;
        index %= this.columns;
      }
      return this.unitWidth * index + this.offset;
    },

    //
    unit: function() {
      return this.unitWidth;
    },

    center: function(offset) {
      var index = offset || 0;
      return (this.width/2) + (this.unitWidth * index);
    },

  });

})();



// 監視オブジェクト
// register で key を登録 (デフォルト値も一緒に？)
// event dispatcher を継承
// event dispatcher って util じゃね？
// register で登録した値を変更したら change イベントが走る


// 名前候補
//  middleman(仲立人)


phina.namespace(function() {

  /**
   * @class phina.util.ChangeDispatcher
   * @extends phina.util.EventDispatcher
   */
  phina.define('phina.util.ChangeDispatcher', {
    superClass: 'phina.util.EventDispatcher',

    init: function() {
      this.superInit();

      this._observe = true;
    },

    register: function(key, defaultValue) {
      if (arguments.length === 1) {
        var obj = arguments[0];
        obj.forIn(function(key, value) {
          this.register(key, value);
        }, this);
      }
      else {
        var tempKey = '__' + key;
        this[tempKey] = defaultValue;
        this.accessor(key, {
          get: function() {
            return this[tempKey];
          },
          set: function(v) {
            this[tempKey] = v;
            if (this._observe) {
              this.flare('change');
            }
          },
        });
      }
      return this;
    },

    observe: function() {
      this._observe = true;
    },
    unobserve: function() {
      this._observe = false;
    },
  });

});

;(function() {

  /**
   * @class phina.util.Flow
   * tick management class
   * @extends phina.util.EventDispatcher
   */
  phina.define('phina.util.Flow', {
    superClass: 'phina.util.EventDispatcher',

    /**
     * @constructor
     */
    init: function(func, wait) {
      this.superInit();

      this.status = 'pending';
      this.resultValue = null;
      this._queue = [];
      this.func = func;

      if (wait !== true) {
        var self = this;
        var resolve = function() {
          self.resolve.apply(self, arguments);
          self.status = 'resolved';
        };
        var reject = function() {
          self.reject.apply(self, arguments);
          self.status = 'rejected';
        };

        this.func(resolve, reject);
      }
    },

    /*
     * 成功
     */
    resolve: function(arg) {
      this.resultValue = arg;

      // キューに積まれた関数を実行
      this._queue.each(function(func) {
        func(this.resultValue);
      }, this);
      this._queue.clear();
    },

    /*
     * 失敗
     */
    reject: function() {

    },

    /*
     * 非同期終了時の処理を登録
     */
    then: function(func) {
      var self = this;
      // 成功ステータスだった場合は即実行
      if (this.status === 'resolved') {
        var value = func(this.resultValue);
        return phina.util.Flow.resolve(value);
      }
      else {
        var flow = phina.util.Flow(function(resolve) {
          resolve();
        }, true);

        this._queue.push(function(arg) {
          var resultValue = func(arg);

          if (resultValue instanceof phina.util.Flow) {
            resultValue.then(function(value) {
              flow.resolve(value);
            });
          }
          else {
            flow.resolve(arg);
          }
        });

        return flow;
      }
    },

    _static: {
      resolve: function(value) {
        if (value instanceof phina.util.Flow) {
          return value;
        }
        else {
          var flow = phina.util.Flow(function(resolve) {
            resolve(value);
          });
          return flow;
        }
      },
      all: function(flows) {
        return phina.util.Flow(function(resolve) {
          var count = 0;

          var args = [];

          flows.each(function(flow) {
            flow.then(function(d) {
              ++count;
              args.push(d);

              if (count >= flows.length) {
                resolve(args);
              }
            });
          });
        });
      },
    },
  });

})();
/*
 * color.js
 */

phina.namespace(function() {

  /**
   * @class phina.util.Color
   * カラークラス
   */
  phina.define("phina.util.Color", {
    /** R値 */
    r: 255,
    /** G値 */
    g: 255,
    /** B値 */
    b: 255,
    /** A値 */
    a: 1.0,

    /**
     * 初期化
     */
    init: function(r, g, b, a) {
      this.set.apply(this, arguments);
    },

    /**
     * セッター.
     */
    set: function(r, g, b, a) {
      this.r = r;
      this.g = g;
      this.b = b;
      this.a = (a !== undefined) ? a : 1.0;
      return this;
    },

    /**
     * 数値によるセッター.
     */
    setFromNumber: function(r, g, b, a) {
      this.r = r;
      this.g = g;
      this.b = b;
      this.a = (a !== undefined) ? a : 1.0;
      return this;
    },

    /**
     * 配列によるセッター
     */
    setFromArray: function(arr) {
      return this.set.apply(this, arr);
    },

    /**
     * オブジェクトによるセッター
     */
    setFromObject: function(obj) {
      return this.set(obj.r, obj.g, obj.b, obj.a);
    },

    /**
     * 文字列によるセッター
     */
    setFromString: function(str) {
      var color = phina.util.Color.stringToNumber(str);
      return this.set(color[0], color[1], color[2], color[3]);
    },

    /**
     * 賢いセッター
     */
    setSmart: function() {
      var arg = arguments[0];
      if (arguments.length >= 3) {
        this.set(arguments.r, arguments.g, arguments.b, arguments.a);
      } else if (arg instanceof Array) {
        this.setFromArray(arg);
      } else if (arg instanceof Object) {
        this.setFromObject(arg);
      } else if (typeof(arg) == "string") {
        this.setFromString(arg);
      }
      return this;
    },

    /**
     * CSS 用 16進数文字列に変換
     */
    toStyleAsHex: function() {
      return "#{0}{1}{2}".format(
        this.r.toString(16).padding(2, '0'),
        this.g.toString(16).padding(2, '0'),
        this.b.toString(16).padding(2, '0')
      );
    },

    /**
     * CSS 用 RGB文字列に変換
     */
    toStyleAsRGB: function() {
      return "rgb({r},{g},{b})".format({
        r: ~~this.r,
        g: ~~this.g,
        b: ~~this.b
      });
    },


    /**
     * CSS 用 RGBA文字列に変換
     */
    toStyleAsRGBA: function() {
      return "rgba({r},{g},{b},{a})".format({
        r: ~~this.r,
        g: ~~this.g,
        b: ~~this.b,
        a: this.a
      });
    },

    /**
     * CSS 用 RGBA 文字列に変換
     */
    toStyle: function() {
      return "rgba({r},{g},{b},{a})".format({
        r: ~~this.r,
        g: ~~this.g,
        b: ~~this.b,
        a: this.a
      });
    },

    _static: {

      /**
       * @static
       * カラーリスト
       */
      COLOR_LIST: {
        /** @property black */
        "black": [0x00, 0x00, 0x00],
        /** @property silver */
        "silver": [0xc0, 0xc0, 0xc0],
        /** @property gray */
        "gray": [0x80, 0x80, 0x80],
        /** @property white */
        "white": [0xff, 0xff, 0xff],
        /** @property maroon */
        "maroon": [0x80, 0x00, 0x00],
        /** @property red */
        "red": [0xff, 0x00, 0x00],
        /** @property purple */
        "purple": [0x80, 0x00, 0x80],
        /** @property fuchsia */
        "fuchsia": [0xff, 0x00, 0xff],
        /** @property green */
        "green": [0x00, 0x80, 0x00],
        /** @property lime */
        "lime": [0x00, 0xff, 0x00],
        /** @property olive */
        "olive": [0x80, 0x80, 0x00],
        /** @property yellow */
        "yellow": [0xff, 0xff, 0x00],
        /** @property navy */
        "navy": [0x00, 0x00, 0x80],
        /** @property blue */
        "blue": [0x00, 0x00, 0xff],
        /** @property teal */
        "teal": [0x00, 0x80, 0x80],
        /** @property aqua */
        "aqua": [0x00, 0xff, 0xff],
      },

      /**
       * @static
       * @member phina.util.Color
       * @method strToNum
       */
      strToNum: function(str) {
        return this.stringToNumber(str);
      },
      stringToNumber: function(str) {
        var value = null;
        var type = null;

        if (str[0] === '#') {
          type = (str.length == 4) ? "hex111" : "hex222";
        } else if (str[0] === 'r' && str[1] === 'g' && str[2] === 'b') {
          type = (str[3] == 'a') ? "rgba" : "rgb";
        } else if (str[0] === 'h' && str[1] === 's' && str[2] === 'l') {
          type = (str[3] == 'a') ? "hsla" : "hsl";
        }

        if (type) {
          var match_set = MATCH_SET_LIST[type];
          var m = str.match(match_set.reg);
          value = match_set.exec(m);
        } else if (phina.util.Color.COLOR_LIST[str]) {
          value = phina.util.Color.COLOR_LIST[str];
        }

        return value;
      },

      /**
       * @static
       * @method
       * hsl を rgb に変換
       */
      HSLtoRGB: function(h, s, l) {
        var r, g, b;

        h %= 360;
        h += 360;
        h %= 360;
        s *= 0.01;
        l *= 0.01;

        if (s === 0) {
          var l = Math.round(l * 255);
          return [l, l, l];
        }
        var m2 = (l < 0.5) ? l * (1 + s) : l + s - l * s;
        var m1 = l * 2 - m2;

        // red
        var temp = (h + 120) % 360;
        if (temp < 60) {
          r = m1 + (m2 - m1) * temp / 60;
        } else if (temp < 180) {
          r = m2;
        } else {
          r = m1;
        }

        // green
        temp = h;
        if (temp < 60) {
          g = m1 + (m2 - m1) * temp / 60;
        } else if (temp < 180) {
          g = m2;
        } else if (temp < 240) {
          g = m1 + (m2 - m1) * (240 - temp) / 60;
        } else {
          g = m1;
        }

        // blue
        temp = ((h - 120) + 360) % 360;
        if (temp < 60) {
          b = m1 + (m2 - m1) * temp / 60;
        } else if (temp < 180) {
          b = m2;
        } else if (temp < 240) {
          b = m1 + (m2 - m1) * (240 - temp) / 60;
        } else {
          b = m1;
        }

        return [
          parseInt(r * 255),
          parseInt(g * 255),
          parseInt(b * 255)
        ];
      },

      /**
       * @static
       * @method
       * hsla を rgba に変換
       */
      HSLAtoRGBA: function(h, s, l, a) {
        var temp = phina.util.Color.HSLtoRGB(h, s, l);
        temp[3] = a;
        return temp;
      },

      /**
       * @static
       * @method
       * rgb を hsl に変換
       */
      RGBtoHSL: function(r, g, b) {
        var _r = r / 255;
        var _g = g / 255;
        var _b = b / 255;

        var max = Math.max(_r, _g, _b);
        var min = Math.min(_r, _g, _b);
        var delta = max - min;

        var h = 0;
        if (delta === 0) {
          h = 0;
        } else {
          if (max === _r) {
            h = (_g - _b) / delta * 60;
          } else if (max === _g) {
            h = (_b - _r) / delta * 60 + 120;
          } else {
            h = (_r - _g) / delta * 60 + 240;
          }
        }
        h %= 360;
        h += 360;
        h %= 360;

        var l = (max + min) / 2;

        var s = 0;
        if (delta === 0) {
          s = 0;
        } else {
          s = delta / (1 - Math.abs(2 * l - 1));
        }

        return [h, s * 100, l * 100];
      },

      /**
       * @static
       * @method
       * rgba を hsla に変換
       */
      RGBAtoHSLA: function(r, g, b, a) {
        var temp = phina.util.Color.RGBtoHSL(r, g, b);
        temp[3] = a;
        return temp;
      },

      /**
       * @static
       * @method
       * rgb 値を作成
       */
      createStyleRGB: function(r, g, b) {
        return "rgba(" + r + "," + g + "," + b + ")";
      },

      /**
       * @static
       * @method
       * rgba 値を作成
       */
      createStyleRGBA: function(r, g, b, a) {
        return "rgba(" + r + "," + g + "," + b + "," + a + ")";
      },

      /**
       * @static
       * @method
       * hsl 値を作成
       */
      createStyleHSL: function(h, s, l) {
        return "hsl(" + h + "," + s + "%," + l + "%)";
      },

      /**
       * @static
       * @method
       * hsla 値を作成
       */
      createStyleHSLA: function(h, s, l, a) {
        return "hsla(" + h + "," + s + "%," + l + "%," + a + ")";
      },
    }
  });


  var MATCH_SET_LIST = {
    "hex111": {
      reg: /^#(\w{1})(\w{1})(\w{1})$/,
      exec: function(m) {
        return [
          parseInt(m[1] + m[1], 16),
          parseInt(m[2] + m[2], 16),
          parseInt(m[3] + m[3], 16)
        ];
      }
    },
    "hex222": {
      reg: /^#(\w{2})(\w{2})(\w{2})$/,
      exec: function(m) {
        return [
          parseInt(m[1], 16),
          parseInt(m[2], 16),
          parseInt(m[3], 16)
        ];
      }
    },
    "rgb": {
      reg: /^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,
      exec: function(m) {
        return [
          parseInt(m[1]),
          parseInt(m[2]),
          parseInt(m[3])
        ];
      }
    },
    "rgba": {
      reg: /^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1}(\.{1}\d+)?)\)$/,
      exec: function(m) {
        return [
          parseInt(m[1]),
          parseInt(m[2]),
          parseInt(m[3]),
          parseFloat(m[4])
        ];
      }
    },
    "hsl": {
      reg: /^hsl\((\d{1,3}),\s*(\d{1,3})%,\s*(\d{1,3})%\)$/,
      exec: function(m) {
        return phina.util.Color.HSLtoRGB(m[1], m[2], m[3]);
      }
    },
    "hsla": {
      reg: /^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1}(\.{1}\d+)?)\)$/,
      exec: function(m) {
        return phina.util.Color.HSLAtoRGBA(m[1], m[2], m[3], m[4]);
      },
    }
  };

});

/*
 * random.js
 */

phina.namespace(function() {

  /**
   * @class phina.util.Random
   * ランダムクラス
   */
  phina.define("phina.util.Random", {

    seed: 1,

    init: function(seed) {
      this.seed = seed || (Date.now()) || 1;
    },

    random: function() {
      var seed = this.seed;
      seed = seed ^ (seed << 13);
      seed = seed ^ (seed >>> 17);
      seed = (seed ^ (seed << 5));

      this.seed = seed;

      return (seed >>> 0) / phina.util.Random.MAX;
    },

    randint: function(min, max) {
      return Math.floor( this.random()*(max-min+1) ) + min;
    },
    randfloat: function(min, max) {
      return this.random()*(max-min)+min;
    },
    randbool: function() {
      return this.randint(0, 1) === 1;
    },
    randarray: function(len, min, max) {
      len = len || 100;
      min = min || 0;
      max = max || 100;

      return (len).map(function() {
        return this.randint(min, max);
      }, this);
    },

    _accessor: {
      seed: {
        get: function() { return this._seed; },
        set: function (v) { this._seed = (v >>> 0) || 1; },
      },
    },

    _static: {
      MAX: 4294967295,

      seed: (Date.now()),

      getSeed: function() {
        return this.seed;
      },
      setSeed: function(seed) {
        this.seed = (seed >>> 0) || 1;
        return this;
      },

      random: function() {
        this.seed = this.xor32(this.seed);
        return (this.seed >>> 0) / phina.util.Random.MAX;
      },

      randint: function(min, max) {
        return phina.global.Math.floor( this.random()*(max-min+1) ) + min;
      },
      randfloat: function(min, max) {
        return this.random()*(max-min)+min;
      },
      randbool: function() {
        return this.randint(0, 1) === 1;
      },
      randarray: function(len, min, max) {
        len = len || 100;
        min = min || 0;
        max = max || 100;

        return (len).map(function() {
          return this.randint(min, max);
        }, this);
      },

      xor32: function(seed) {
        seed = seed ^ (seed << 13);
        seed = seed ^ (seed >>> 17);
        seed = (seed ^ (seed << 5));

        return seed;
      },

      /*
       * http://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript
       */
      uuid: function() {
        var d = new Date().getTime();
        if(phina.global.performance && typeof phina.global.performance.now === "function"){
          d += performance.now(); //use high-precision timer if available
        }
        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
          var r = (d + Math.random()*16)%16 | 0;
          d = Math.floor(d/16);
          return (c=='x' ? r : (r&0x3|0x8)).toString(16);
        });
        return uuid;
      },

    },
  });

  Math.$method("randint", function(min, max) {
    return phina.util.Random.randint(min, max);
  });
  Math.$method("randfloat", function(min, max) {
    return phina.util.Random.randfloat(min, max);
  });

});


phina.namespace(function() {

  /**
   * @class phina.util.QueryString
   * 
   */
  phina.define('phina.util.QueryString', {
    _static: {
      parse: function(text, sep, eq, isDecode) {
        text = text || location.search.substr(1);
        sep = sep || '&';
        eq = eq || '=';
        var decode = (isDecode) ? decodeURIComponent : function(a) { return a; };
        return text.split(sep).reduce(function(obj, v) {
          var pair = v.split(eq);
          obj[pair[0]] = decode(pair[1]);
          return obj;
        }, {});
      },
      stringify: function(value, sep, eq, isEncode) {
        sep = sep || '&';
        eq = eq || '=';
        var encode = (isEncode) ? encodeURIComponent : function(a) { return a; };
        return Object.keys(value).map(function(key) {
          return key + eq + encode(value[key]);
        }).join(sep);
      },
    },
  });

});



phina.namespace(function() {

  /**
   * @class phina.util.Ajax
   * 
   */
  phina.define('phina.util.Ajax', {
    _static: {
      defaults: {
        type: 'GET',
        contentType: 'application/x-www-form-urlencoded',
        responseType: 'json',
        data: null,
        url: '',
      },

      request: function(options) {
        var data = ({}).$safe(options, this.defaults);

        var xhr = new XMLHttpRequest();
        var flow = phina.util.Flow(function(resolve) {
          xhr.onreadystatechange = function() {
            if (xhr.readyState === 4) {
              if ([200, 201, 0].indexOf(xhr.status) !== -1) {
                resolve(xhr.response);
              }
            }
          };

          xhr.open(data.type, data.url);
          xhr.responseType = data.responseType;
          xhr.send(null);
        });

        return flow;
      },
      get: function(url) {
        return this.request({
          type: 'GET',
          url: url,
        });
      },
      post: function(url) {
        return this.request({
          type: 'POST',
          url: url,
        });
      },
      put: function(url) {
        return this.request({
          type: 'PUT',
          url: url,
        });
      },
      del: function(url) {
        return this.request({
          type: 'DELETE',
          url: url,
        });
      },
    },
  });

});



phina.namespace(function() {

  /**
   * @class phina.asset.Asset
   * @extends phina.util.EventDispatcher
   */
  phina.define('phina.asset.Asset', {
    superClass: "phina.util.EventDispatcher",

    serverError: false,
    notFound: false,
    loadError: false,

    /**
     * @constructor
     */
    init: function(src) {
      this.superInit();

      this.loaded = false;
    },

    load: function(src) {
      this.src = src;
      return phina.util.Flow(this._load.bind(this));
    },

    isLoaded: function() {
      return this.loaded;
    },

    _load: function(resolve) {
      var self = this;
      setTimeout(function() {
        self.loaded = true;
        resolve();
      }, 100);
    },

    // ロード失敗時にダミーをセットする
    loadDummy: function() { },

  });

});



phina.namespace(function() {

  /**
   * @class phina.asset.AssetManager
   * 
   */
  phina.define('phina.asset.AssetManager', {
    _static: {
      assets: {
        image: {},
        sound: {},
        spritesheet: {},
      },
      
      get: function(type, key) {
        return this.assets[type] && this.assets[type][key];
      },
      set: function(type, key, asset) {
        if (!this.assets[type]) {
          this.assets[type] = {};
        }
        this.assets[type][key] = asset;
      },
      contains: function(type, key) {
        return ;
      }
    },

  });

});



phina.namespace(function() {

  /**
   * @class phina.asset.AssetLoader
   * @extends phina.util.EventDispatcher
   */
  phina.define('phina.asset.AssetLoader', {
    superClass: "phina.util.EventDispatcher",

    /**
     * @constructor
     */
    init: function(params) {
      this.superInit();

      params = (params || {}).$safe({
        cache: true,
      });

      this.assets = {};
      this.cache = params.cache;
    },

    load: function(params) {
      var self = this;
      var flows = [];

      var counter = 0;
      var length = 0;
      params.forIn(function(type, assets) {
        length += Object.keys(assets).length;
      });
      
      params.forIn(function(type, assets) {
        assets.forIn(function(key, value) {
          var func = phina.asset.AssetLoader.assetLoadFunctions[type];
          var flow = func(key, value);
          flow.then(function(asset) {
            if (self.cache) {
              phina.asset.AssetManager.set(type, key, asset);
            }
            self.flare('progress', {
              key: key,
              asset: asset,
              progress: (++counter/length),
            });
          });
          flows.push(flow);
        });
      });


      if (self.cache) {

        self.on('progress', function(e) {
          if (e.progress >= 1.0) {
            // load失敗時、対策
            params.forIn(function(type, assets) {
              assets.forIn(function(key, value) {
                var asset = phina.asset.AssetManager.get(type, key);
                if (asset.loadError) {
                  var dummy = phina.asset.AssetManager.get(type, 'dummy');
                  if (dummy) {
                    if (dummy.loadError) {
                      dummy.loadDummy();
                      dummy.loadError = false;
                    }
                    phina.asset.AssetManager.set(type, key, dummy);
                  } else {
                    asset.loadDummy();
                  }
                }
              });
            });
          }
        });
      }
      return phina.util.Flow.all(flows).then(function(args) {
        self.flare('load');
      });
    },

    _static: {
      assetLoadFunctions: {
        image: function(key, path) {
          var texture = phina.asset.Texture();
          var flow = texture.load(path);
          return flow;
        },
        sound: function(key, path) {
          var sound = phina.asset.Sound();
          var flow = sound.load(path);
          return flow;
        },
        spritesheet: function(key, path) {
          var ss = phina.asset.SpriteSheet();
          var flow = ss.load(path);
          return flow;
        },
        script: function(key, path) {
          var script = phina.asset.Script();
          return script.load(path);
        },
        font: function(key, path) {
          var font = phina.asset.Font();
          font.setFontName(key);
          return font.load(path);
        },
        json: function(key, path) {
          var text = phina.asset.File();
          return text.load({
            path: path,
            dataType: "json",
          });
        },
        xml: function(key, path) {
          var text = phina.asset.File();
          return text.load({
            path: path,
            dataType: "xml",
          });
        },
        text: function(key, path) {
          var text = phina.asset.File();
          return text.load(path);
        }
      },
      register: function(key, func) {
        this.assetLoadFunctions[key] = func;
        return this;
      },
    }

  });

});



phina.namespace(function() {

  /**
   * @class phina.asset.File
   * @extends phina.asset.Asset
   */
  phina.define('phina.asset.File', {
    superClass: "phina.asset.Asset",

    /**
     * @constructor
     */
    init: function() {
      this.superInit();
    },

    _load: function(resolve) {

      var params = {};

      if (typeof this.src === 'string') {
        params.$extend({
          path: this.src,
        });
      }
      else if (typeof this.src === 'object') {
        params.$extend(this.src);
      }

      params.$safe({
        path: '',
        dataType: 'text',
      });

      // load
      var self = this;
      var xml = new XMLHttpRequest();
      xml.open('GET', params.path);
      xml.onreadystatechange = function() {
        if (xml.readyState === 4) {
          if ([200, 201, 0].indexOf(xml.status) !== -1) {
            var data = xml.responseText;

            if (params.dataType === 'json') {
              data = JSON.parse(data);
            } else if (params.dataType === 'xml') {
              data = (new DOMParser()).parseFromString(data, "text/xml");
            }
            self.dataType = params.dataType;

            self.data = data;
            resolve(self);
          }
        }
      };

      xml.send(null);
      // this.domElement = new Image();
      // this.domElement.src = this.src;

      // var self = this;
      // this.domElement.onload = function() {
      //   self.loaded = true;
      //   resolve(self);
      // };
    },

  });

});



phina.namespace(function() {

  /**
   * @class phina.asset.Script
   * @extends phina.asset.Asset
   */
  phina.define('phina.asset.Script', {
    superClass: "phina.asset.Asset",

    /**
     * @constructor
     */
    init: function() {
      this.superInit();
    },

    _load: function(resolve) {
      var self = this;
      this.domElement = document.createElement('script');
      this.domElement.src = this.src;

      this.domElement.onload = function() {
        resolve(self);
      }.bind(this);

      document.body.appendChild(this.domElement);
    },

  });

});


phina.namespace(function() {

  /**
   * @class phina.asset.Texture
   * @extends phina.asset.Asset
   */
  phina.define('phina.asset.Texture', {
    superClass: "phina.asset.Asset",

    /**
     * @constructor
     */
    init: function() {
      this.superInit();
    },

    _load: function(resolve) {
      this.domElement = new Image();

      var isLocal = (location.protocol == 'file:');
      if ( !isLocal && !(/^data:/.test(this.src)) ) {
        // this.domElement.crossOrigin = 'Anonymous'; // クロスオリジン解除
      }
      if(!(/^data:/.test(this.src))) {
        this.domElement.crossOrigin = 'anonymous'; // クロスオリジン解除
      }

      var self = this;
      this.domElement.onload = function(e) {
        self.loaded = true;
        resolve(self);
      };
      this.domElement.onerror = function(e) {
        console.error("[phina.js] not found `{0}`!".format(this.src));

        var key = self.src.split('/').last.replace('.png', '').split('?').first.split('#').first;
        e.target.onerror = null;
        e.target.src = "http://dummyimage.com/128x128/444444/eeeeee&text=" + key;
      };

      this.domElement.src = this.src;
    },

    clone: function () {
      var image = this.domElement;
      var canvas = phina.graphics.Canvas().setSize(image.width, image.height);
      var t = phina.asset.Texture();
      canvas.context.drawImage(image, 0, 0);
      t.domElement = canvas.domElement;
      return t;
    },

    transmit: function(color) {
      // imagaオブジェクトをゲット
      var image = this.domElement;
      // 新規canvas作成
      var canvas = phina.graphics.Canvas().setSize(image.width, image.height);
      // 新規canvasに描画
      canvas.context.drawImage(image, 0, 0);
      // canvas全体のイメージデータ配列をゲット
      var imageData = canvas.context.getImageData(0, 0, canvas.width, canvas.height);
      var data = imageData.data;
      // 透過色の指定がなければ左上のrgb値を抽出
      var r = (color !== undefined) ? color.r : data[0];
      var g = (color !== undefined) ? color.g : data[1];
      var b = (color !== undefined) ? color.b : data[2];
      // 配列を4要素目から4つ飛び（アルファ値）でループ
      (3).step(data.length, 4, function(i) {
        // rgb値を逆算でゲットし、左上のrgbと比較
        if (data[i - 3] === r && data[i - 2] === g && data[i - 1] === b) {
          // 一致した場合はアルファ値を書き換える
          data[i] = 0;
        }
      });
      // 書き換えたイメージデータをcanvasに戻す
      canvas.context.putImageData(imageData, 0, 0);

      this.domElement = canvas.domElement;
    },

    filter: function (filters) {
      if (!filters) {
        return this;
      }
      if (!Array.isArray(filters)) {
        filters = [filters];
      }
      var image = this.domElement;
      var w = image.width;
      var h = image.height;
      var canvas = phina.graphics.Canvas().setSize(w, h);
      var imageData = null;

      canvas.context.drawImage(image, 0, 0);
      imageData = canvas.context.getImageData(0, 0, w, h);
      filters.forEach( function (fn) {
        if (typeof fn == 'function') {
          h.times( function (y) {
            w.times( function (x) {
              var i = (y * w + x) * 4;
              var pixel = imageData.data.slice(i, i + 4);
              fn(pixel, i, x, y, imageData);
            });
          });
        }
      });
      canvas.context.putImageData(imageData, 0, 0);
      this.domElement = canvas.domElement;
      return this;
    },

  });

});



phina.namespace(function() {

  /**
   * @class phina.asset.Sound
   * @extends phina.asset.Asset
   */
  phina.define('phina.asset.Sound', {
    superClass: "phina.asset.Asset",
    
    _loop: false,
    _loopStart: 0,
    _loopEnd: 0,
    _playbackRate: 1,
    
    /**
     * @constructor
     */
    init: function() {
      this.superInit();
      this.context = phina.asset.Sound.getAudioContext();
      this.gainNode = this.context.createGain();
    },

    play: function(when, offset, duration) {
      when = when ? when + this.context.currentTime : 0;
      offset = offset || 0;

      if (this.source) {
        // TODO: キャッシュする？
      }

      var source = this.source = this.context.createBufferSource();
      var buffer = source.buffer = this.buffer;
      source.loop = this._loop;
      source.loopStart = this._loopStart;
      source.loopEnd = this._loopEnd;
      source.playbackRate.value = this._playbackRate;

      // connect
      source.connect(this.gainNode);
      this.gainNode.connect(phina.asset.Sound.getMasterGain());
      // play
      if (duration !== undefined) {
        source.start(when, offset, duration);
      }
      else {
        source.start(when, offset);
      }
      
      // check play end
      source.addEventListener('ended', function(){
        this.flare('ended');
      }.bind(this));

      return this;
    },

    stop: function() {
      // stop
      if (this.source) {
        // stop すると source.endedも発火する
        this.source.stop && this.source.stop(0);
        this.source = null;
        this.flare('stop');
      }

      return this;
    },

    pause: function() {
      this.source.playbackRate.value = 0;
      this.flare('pause');
      return this;
    },

    resume: function() {
      this.source.playbackRate.value = this._playbackRate;
      this.flare('resume');
      return this;
    },

    // 試してみるなう
    _oscillator: function(type) {
      var context = this.context;

      var oscillator = context.createOscillator();

      // Sine wave is type = “sine”
      // Square wave is type = “square”
      // Sawtooth wave is type = “saw”
      // Triangle wave is type = “triangle”
      // Custom wave is type = “custom” 
      oscillator.type = type || 'sine';

      this.source = oscillator;
      // connect
      this.source.connect(context.destination);
    },

    loadFromBuffer: function(buffer) {
      var context = this.context;

      // set default buffer
      if (!buffer) {
        buffer = context.createBuffer( 1, 44100, 44100 );
        var channel = buffer.getChannelData(0);

        for( var i=0; i < channel.length; i++ )
        {
          channel[i] = Math.sin( i / 100 * Math.PI);
        }
      }

      // source
      this.buffer = buffer;
    },

    setLoop: function(loop) {
      this.loop = loop;
      return this;
    },
    setLoopStart: function(loopStart) {
      this.loopStart = loopStart;
      return this;
    },
    setLoopEnd: function(loopEnd) {
      this.loopEnd = loopEnd;
      return this;
    },
    
    setPlaybackRate: function(playbackRate) {
      this.playbackRate = playbackRate;
      return this;
    },

    _load: function(r) {
      if (/^data:/.test(this.src)) {
        this._loadFromURIScheme(r);
      }
      else {
        this._loadFromFile(r);
      }
    },

    _loadFromFile: function(r) {
      var self = this;

      var xml = new XMLHttpRequest();
      xml.open('GET', this.src);
      xml.onreadystatechange = function() {
        if (xml.readyState === 4) {
          if ([200, 201, 0].indexOf(xml.status) !== -1) {

            // 音楽バイナリーデータ
            var data = xml.response;

            // webaudio 用に変換
            self.context.decodeAudioData(data, function(buffer) {
              self.loadFromBuffer(buffer);
              r(self);
            }, function() {
              console.warn("音声ファイルのデコードに失敗しました。(" + self.src + ")");
              r(self);
              self.flare('decodeerror');
            });

          } else if (xml.status === 404) {
            // not found

            self.loadError = true;
            self.notFound= true;
            r(self);
            self.flare('loaderror');
            self.flare('notfound');

          } else {
            // サーバーエラー

            self.loadError = true;
            self.serverError = true;
            r(self);
            self.flare('loaderror');
            self.flare('servererror');
          }
        }
      };

      xml.responseType = 'arraybuffer';

      xml.send(null);
    },

    _loadFromURIScheme: function(r) {
      var byteString = '';
      if (this.src.split(',')[0].indexOf('base64') >= 0) {
        byteString = atob(this.src.split(',')[1]);
      }
      else {
        byteString = unescape(this.src.split(',')[1]);
      }

      var self = this;
      var len = byteString.length;
      var buffer = new Uint8Array(len);

      for (var i=0; i<len; ++i) {
        buffer[i] = byteString.charCodeAt(i);
      }

      // webaudio 用に変換
      this.context.decodeAudioData(buffer.buffer, function(buffer) {
        self.loadFromBuffer(buffer);
        r(self);
      }, function() {
        console.warn("音声ファイルのデコードに失敗しました。(" + self.src + ")");
        self.loaded = true;
        r(self);
      });
    },

    loadDummy: function() {
      this.loadFromBuffer();
    },

    _accessor: {
      volume: {
        get: function()  { return this.gainNode.gain.value; },
        set: function(v) { this.gainNode.gain.value = v; },
      },
      loop: {
        get: function()  { return this._loop; },
        set: function(v) {
          this._loop = v;
          if (this.source) this.source._loop = v;
        },
      },
      loopStart: {
        get: function()  { return this._loopStart; },
        set: function(v) {
          this._loopStart = v;
          if (this.source) this.source._loopStart = v;
        },
      },
      loopEnd: {
        get: function()  { return this._loopEnd; },
        set: function(v) {
          this._loopEnd = v;
          if (this.source) this.source._loopEnd = v;
        },
      },
      playbackRate: {
        get: function() { return this._playbackRate; },
        set: function(v) {
          this._playbackRate = v;
          if(this.source && this.source.playbackRate.value !== 0){
            this.source.playbackRate.value = v;
          }
        },
      }
    },

    _defined: function() {
      this.accessor('volume', {
        get: function() {
          return this.getMasterGain().gain.value;
        },
        set: function(v) {
          this.getMasterGain().gain.value = v;
        },
      });
      
    },
    
    _static: {
      
      getMasterGain: function() {
        if(!this._masterGain) {
          var context = this.getAudioContext();
          this._masterGain = context.createGain();
          this._masterGain.connect(context.destination);
        }
        return this._masterGain;
      },
      
      getAudioContext: function() {
        if (!phina.util.Support.webAudio) return null;

        if (this.context) return this.context;

        var g = phina.global;
        var context = null;

        if (g.AudioContext) {
          context = new AudioContext();
        }
        else if (g.webkitAudioContext) {
          context = new webkitAudioContext();
        }
        else if (g.mozAudioContext) {
          context = new mozAudioContext();
        }

        this.context = context;

        return context;
      },
    },

  });

});


phina.namespace(function() {

  /**
   * @class phina.asset.SoundManager
   * ### Ref
   * - http://evolve.reintroducing.com/_source/classes/as3/SoundManager/SoundManager.html
   * - https://github.com/nicklockwood/SoundManager
   */
  phina.define('phina.asset.SoundManager', {
    _static: {
      volume: 0.8,
      musicVolume: 0.8,
      muteFlag: false,
      currentMusic: null,

      play: function(name, when, offset, duration) {
        var sound = phina.asset.AssetManager.get('sound', name);

        sound.volume = this.getVolume();
        sound.play(when, offset, duration);

        return sound;
      },

      stop: function() {
        // TODO: 
      },
      pause: function() {
        // TODO: 
      },
      fade: function() {
        // TODO: 
      },
      setVolume: function(volume) {
        this.volume = volume;
      },
      getVolume: function() {
        return this.volume;
      },

      /*
       * ミュート
       */
      mute: function() {
        this.muteFlag = true;
        if (this.currentMusic) {
          this.currentMusic.volume = 0;
        }
        return this;
      },
      /*
       * ミュート解除
       */
      unmute: function() {
        this.muteFlag = false;
        if (this.currentMusic) {
          this.currentMusic.volume = this.getVolumeMusic();
        }
        return this;
      },
      isMute: function() {
        return this.muteFlag;
      },

      playMusic: function(name, fadeTime, loop, when, offset, duration) {
        loop = (loop !== undefined) ? loop : true;

        if (this.currentMusic) {
          this.stopMusic(fadeTime);
        }

        var music = phina.asset.AssetManager.get('sound', name);

        music.setLoop(loop);
        music.play(when, offset, duration);

        if (fadeTime > 0) {
          var count = 32;
          var counter = 0;
          var unitTime = fadeTime/count;
          var volume = this.getVolumeMusic();

          music.volume = 0;
          var id = setInterval(function() {
            counter += 1;
            var rate = counter/count;
            music.volume = rate*volume;

            if (rate >= 1) {
              clearInterval(id);
              return false;
            }

            return true;
          }, unitTime);
        }
        else {
          music.volume = this.getVolumeMusic();
        }

        this.currentMusic = music;

        return this.currentMusic;
      },

      stopMusic: function(fadeTime) {
        if (!this.currentMusic) { return ; }

        var music = this.currentMusic;
        this.currentMusic = null;

        if (fadeTime > 0) {
          var count = 32;
          var counter = 0;
          var unitTime = fadeTime/count;
          var volume = this.getVolumeMusic();

          music.volume = 0;
          var id = setInterval(function() {
            counter += 1;
            var rate = counter/count;
            music.volume = volume*(1-rate);

            if (rate >= 1) {
              music.stop();
              clearInterval(id);
              return false;
            }

            return true;
          }, unitTime);
        }
        else {
          music.stop();
        }
      },

      /*
       * 音楽を一時停止
       */
      pauseMusic: function() {
        if (!this.currentMusic) { return ; }
        this.currentMusic.pause();
      },
      /*
       * 音楽を再開
       */
      resumeMusic: function() {
        if (!this.currentMusic) { return ; }
        this.currentMusic.resume();
      },
      /*
       * 音楽のボリュームを設定
       */
      setVolumeMusic: function(volume) {
        this.musicVolume = volume;
        if (this.currentMusic) {
          this.currentMusic.volume = volume;
        }

        return this;
      },
      /*
       * 音楽のボリュームを取得
       */
      getVolumeMusic: function() {
        return this.musicVolume;
      },

    },
  });

});


phina.namespace(function() {

  /**
   * @class phina.asset.SpriteSheet
   * @extends phina.asset.Asset
   */
  phina.define('phina.asset.SpriteSheet', {
    superClass: "phina.asset.Asset",

    /**
     * @constructor
     */
    init: function() {
      this.superInit();
    },

    setup: function(params) {
      this._setupFrame(params.frame);
      this._setupAnim(params.animations);
      return this;
    },

    _load: function(resolve) {

      var self = this;

      if (typeof this.src === 'string') {
        var xml = new XMLHttpRequest();
        xml.open('GET', this.src);
        xml.onreadystatechange = function() {
          if (xml.readyState === 4) {
            if ([200, 201, 0].indexOf(xml.status) !== -1) {
              var data = xml.responseText;
              var json = JSON.parse(data);

              self.setup(json);

              resolve(self);
            }
          }
        };

        xml.send(null);
      }
      else {
        this.setup(this.src);
        resolve(self);
      }

    },

    _setupFrame: function(frame) {
      var frames = this.frames = [];
      var unitWidth = frame.width;
      var unitHeight = frame.height;

      var count = frame.rows * frame.cols;
      this.frame = count;

      (count).times(function(i) {
        var xIndex = i%frame.cols;
        var yIndex = (i/frame.cols)|0;

        frames.push({
          x: xIndex*unitWidth,
          y: yIndex*unitHeight,
          width: unitWidth,
          height: unitHeight,
        });
      });
    },

    _setupAnim: function(animations) {
      this.animations = {};

      // デフォルトアニメーション
      this.animations["default"] = {
          frames: [].range(0, this.frame),
          next: "default",
          frequency: 1,
      };

      animations.forIn(function(key, value) {
        var anim = value;

        if (anim instanceof Array) {
          this.animations[key] = {
            frames: [].range(anim[0], anim[1]),
            next: anim[2],
            frequency: anim[3] || 1,
          };
        }
        else {
          this.animations[key] = {
            frames: anim.frames,
            next: anim.next,
            frequency: anim.frequency || 1
          };
        }

      }, this);
    },

    /**
     * フレームを取得
     */
    getFrame: function(index) {
      return this.frames[index];
    },

    getAnimation: function(name) {
      name = (name !== undefined) ? name : "default";
      return this.animations[name];
    },

  });

});


phina.namespace(function() {

  /**
   * @class phina.asset.Font
   * @extends phina.asset.Asset
   */
  phina.define("phina.asset.Font", {
    superClass: "phina.asset.Asset",

    /**
     * @constructor
     */
    init: function() {
      this.superInit();
      this.fontName = null;
    },

    load: function(path) {
      this.src = path;

      var reg = /(.*)(?:\.([^.]+$))/;
      var key = this.fontName || path.match(reg)[1].split('/').last;    //フォント名指定が無い場合はpathの拡張子前を使用
      var type = path.match(reg)[2];
      var format = "unknown";
      switch (type) {
        case "ttf":
          format = "truetype"; break;
        case "otf":
          format = "opentype"; break;
        case "woff":
          format = "woff"; break;
        case "woff2":
          format = "woff2"; break;
        default:
          console.warn("サポートしていないフォント形式です。(" + path + ")");
      }
      this.format = format;
      this.fontName = key;

      if (format !== "unknown") {
        var text = "@font-face { font-family: '{0}'; src: url({1}) format('{2}'); }".format(key, path, format);
        var e = document.querySelector("head");
        var fontFaceStyleElement = document.createElement("style");
        if (fontFaceStyleElement.innerText) {
          fontFaceStyleElement.innerText = text;
        } else {
          fontFaceStyleElement.textContent = text;
        }
        e.appendChild(fontFaceStyleElement);
      }

      return phina.util.Flow(this._load.bind(this));
    },

    _load: function(resolve) {
      if (this.format !== "unknown") {
        this._checkLoaded(this.fontName, function() {
          this.loaded = true;
          resolve(this);
        }.bind(this));
      } else {
        this.loaded = true;
        resolve(this);
      }
    },

    _checkLoaded: function (font, callback) {
      var canvas = phina.graphics.Canvas();
      var DEFAULT_FONT = canvas.context.font.split(' ')[1];
      canvas.context.font = '40px ' + DEFAULT_FONT;

      var checkText = "1234567890-^\\qwertyuiop@[asdfghjkl;:]zxcvbnm,./\!\"#$%&'()=~|QWERTYUIOP`{ASDFGHJKL+*}ZXCVBNM<>?_１２３４５６７８９０－＾￥ｑｗｅｒｔｙｕｉｏｐａｓｄｆｇｈｊｋｌｚｘｃｖｂｎｍ，．あいうかさたなをん時は金なり";
      // 特殊文字対応
      checkText += String.fromCharCode("0xf04b");

      var before = canvas.context.measureText(checkText).width;
      canvas.context.font = '40px ' + font + ', ' + DEFAULT_FONT;

      var timeoutCount = 30;
      var checkLoadFont = function () {
        var after = canvas.context.measureText(checkText).width;
        if (after !== before) {
          setTimeout(function() {
            callback && callback();
          }, 100);
        } else {
          if (--timeoutCount > 0) {
            setTimeout(checkLoadFont, 100);
          }
          else {
            callback && callback();
            console.warn("timeout font loading");
          }
        }
      };
      checkLoadFont();
    },

    setFontName: function(name) {
      if (this.loaded) {
        console.warn("フォント名はLoad前にのみ設定が出来ます(" + name + ")");
        return this;
      }
      this.fontName = name;
      
      return this;
    },

    getFontName: function() {
      return this.fontName;
    },

  });
});


;(function() {
  /**
   * @class phina.input.Input
   * @extends phina.util.EventDispatcher
   */
  phina.define('phina.input.Input', {

    superClass: 'phina.util.EventDispatcher',

    /** domElement */
    domElement: null,

    /**
     * @constructor
     */
    init: function(domElement) {
      this.superInit();
      
      this.domElement = domElement || window.document;

      this.position = phina.geom.Vector2(0, 0);
      this.startPosition = phina.geom.Vector2(0, 0);
      this.deltaPosition = phina.geom.Vector2(0, 0);
      this.prevPosition = phina.geom.Vector2(0, 0);
      this._tempPosition = phina.geom.Vector2(0, 0);

      this.maxCacheNum = phina.input.Input.defaults.maxCacheNum;
      this.minDistance = phina.input.Input.defaults.minDistance;
      this.maxDistance = phina.input.Input.defaults.maxDistance;
      this.cachePositions = [];
      this.flickVelocity = phina.geom.Vector2(0, 0);

      this.flags = 0;
    },

    update: function() {
      this.last = this.now;
      this.now = this.flags;
      this.start = (this.now ^ this.last) & this.now;
      this.end   = (this.now ^ this.last) & this.last;

      // 変化値を更新
      this.deltaPosition.x = this._tempPosition.x - this.position.x;
      this.deltaPosition.y = this._tempPosition.y - this.position.y;

      if (this.deltaPosition.x === 0 && this.deltaPosition.y === 0) {
        this._moveFlag = false;
      }
      else {
        this._moveFlag = true;
      }

      if (this.start) {
        this.startPosition.set(this.position.x, this.position.y);
      }

      // 前回の座標を更新
      this.prevPosition.set(this.position.x, this.position.y);

      // 現在の位置を更新
      this.position.set(this._tempPosition.x, this._tempPosition.y);

      if (this.cachePositions.length > this.maxCacheNum) {
        this.cachePositions.shift();
      }
      this.cachePositions.push(this.position.clone());
    },

    _start: function(x, y, flag) {
      flag = (flag !== undefined) ? flag : 1;
      this._move(x, y);

      this.flags |= flag;

      var x = this._tempPosition.x;
      var y = this._tempPosition.y;
      this.position.set(x, y);
      this.prevPosition.set(x, y);

      this.flickVelocity.set(0, 0);
      this.cachePositions.clear();
    },

    _end: function(flag) {
      flag = (flag !== undefined) ? flag : 1;
      this.flags &= ~(flag);

      if (this.cachePositions.length < 2) return;

      var first = this.cachePositions.first;
      var last = this.cachePositions.last;

      var v = phina.geom.Vector2.sub(last, first);

      var len = v.length();

      if (len > this.minDistance) {
        var normalLen = len.clamp(this.minDistance, this.maxDistance);
        v.div(len).mul(normalLen);
        this.flickVelocity.set(v.x, v.y);
      }

      this.cachePositions.clear();
    },

    // スケールを考慮
    _move: function(x, y) {
      this._tempPosition.x = x;
      this._tempPosition.y = y;

      // adjust scale
      var elm = this.domElement;
      var rect = elm.getBoundingClientRect();
      if (rect.width) {
        this._tempPosition.x *= elm.width / rect.width;
      }
      if (rect.height) {
        this._tempPosition.y *= elm.height / rect.height;
      }
    },

    _accessor: {
      /**
       * @property    x
       * x座標値
       */
      x: {
        "get": function()   { return this.position.x; },
        "set": function(v)  { this.position.x = v; }
      },
      /**
       * @property    y
       * y座標値
       */
      y: {
        "get": function()   { return this.position.y; },
        "set": function(v)  { this.position.y = v; }
      },
      /**
       * @property    dx
       * dx値
       */
      dx: {
        "get": function()   { return this.deltaPosition.x; },
        "set": function(v)  { this.deltaPosition.x = v; }
      },
      /**
       * @property    dy
       * dy値
       */
      dy: {
        "get": function()   { return this.deltaPosition.y; },
        "set": function(v)  { this.deltaPosition.y = v; }
      },

      /**
       * @property    fx
       * fx値
       */
      fx: {
        "get": function()   { return this.flickVelocity.x; },
        "set": function(v)  { this.flickVelocity.x = v; }
      },
      /**
       * @property    fy
       * fy値
       */
      fy: {
        "get": function()   { return this.flickVelocity.y; },
        "set": function(v)  { this.flickVelocity.y = v; }
      },

    },

    _static: {
      defaults: {
        maxCacheNum: 3,
        minDistance: 10,
        maxDistance: 100,
      },
    },
  });


})();

;(function() {

  /**
   * @class phina.input.Mouse
   * @extends phina.input.Input
   */
  phina.define('phina.input.Mouse', {

    superClass: 'phina.input.Input',

    /**
     * @constructor
     */
    init: function(domElement) {
      this.superInit(domElement);

      this.id = 0;

      var self = this;
      this.domElement.addEventListener('mousedown', function(e) {
        self._start(e.pointX, e.pointY, 1<<e.button);
      });

      this.domElement.addEventListener('mouseup', function(e) {
        self._end(1<<e.button);
      });
      this.domElement.addEventListener('mousemove', function(e) {
        self._move(e.pointX, e.pointY);
      });

      // マウスがキャンバス要素の外に出た場合の対応
      this.domElement.addEventListener('mouseout', function(e)  {
        self._end(1);
      });
    },

    /**
     * ボタン取得
     */
    getButton: function(button) {
      if (typeof(button) == "string") {
        button = BUTTON_MAP[button];
      }
      
      return (this.now & button) != 0;
    },

    /**
     * ボタンダウン取得
     */
    getButtonDown: function(button) {
      if (typeof(button) === 'string') {
        button = BUTTON_MAP[button];
      }

      return (this.start & button) != 0;
    },
        
    /**
     * ボタンアップ取得
     */
    getButtonUp: function(button) {
      if (typeof(button) == "string") {
        button = BUTTON_MAP[button];
      }
      
      return (this.end & button) != 0;
    },

    _static: {
      /** @static @property */
      BUTTON_LEFT: 0x1,
      /** @static @property */
      BUTTON_MIDDLE: 0x2,
      /** @static @property */
      BUTTON_RIGHT: 0x4,
    }
  });

  var BUTTON_MAP = {
    "left"  : phina.input.Mouse.BUTTON_LEFT,
    "middle": phina.input.Mouse.BUTTON_MIDDLE,
    "right" : phina.input.Mouse.BUTTON_RIGHT
  };

  phina.input.Mouse.prototype.getPointing = function() { return this.getButton("left"); };
  phina.input.Mouse.prototype.getPointingStart = function() { return this.getButtonDown("left"); };
  phina.input.Mouse.prototype.getPointingEnd = function() { return this.getButtonUp("left"); };

})();

;(function() {

  /**
   * @class phina.input.Touch
   * @extends phina.input.Input
   */
  phina.define('phina.input.Touch', {

    superClass: 'phina.input.Input',

    /**
     * @constructor
     */
    init: function(domElement, isMulti) {
      this.superInit(domElement);

      this.id = null;

      if (isMulti === true) {
        return ;
      }

      var self = this;
      this.domElement.addEventListener('touchstart', function(e) {
        self._start(e.pointX, e.pointY, true);
      });

      this.domElement.addEventListener('touchend', function(e) {
        self._end();
      });
      this.domElement.addEventListener('touchmove', function(e) {
        self._move(e.pointX, e.pointY);
      });
    },

    /**
     * タッチしているかを判定
     */
    getTouch: function() {
      return this.now != 0;
    },
    
    /**
     * タッチ開始時に true
     */
    getTouchStart: function() {
      return this.start != 0;
    },
    
    /**
     * タッチ終了時に true
     */
    getTouchEnd: function() {
      return this.end != 0;
    },

  });

  /**
   * @method
   * ポインティング状態取得(mouse との差異対策)
   */
  phina.input.Touch.prototype.getPointing        = phina.input.Touch.prototype.getTouch;
  /**
   * @method
   * ポインティングを開始したかを取得(mouse との差異対策)
   */
  phina.input.Touch.prototype.getPointingStart   = phina.input.Touch.prototype.getTouchStart;
  /**
   * @method
   * ポインティングを終了したかを取得(mouse との差異対策)
   */
  phina.input.Touch.prototype.getPointingEnd     = phina.input.Touch.prototype.getTouchEnd;


})();


;(function() {

  /**
   * @class phina.input.TouchList
   */
  phina.define('phina.input.TouchList', {
    domElement: null,
    touchMap: null,
    touches: null,
    _id: null,

    init: function(domElement) {
      this.domElement = domElement;

      this.touches = [];
      var touchMap = this.touchMap = {};

      // 32bit 周期でIDをループさせる
      this._id = new Uint32Array(1);

      var self = this;
      var each = Array.prototype.forEach;
      this.domElement.addEventListener('touchstart', function(e) {
        each.call(e.changedTouches, function(t) {
          var touch = self.getEmpty();
          touchMap[t.identifier] = touch;
          touch._start(t.pointX, t.pointY);
        });
      });

      this.domElement.addEventListener('touchend', function(e) {
        each.call(e.changedTouches, function(t) {
          var id = t.identifier;
          var touch = touchMap[id];
          touch._end();
          delete touchMap[id];
        });
      });
      this.domElement.addEventListener('touchmove', function(e) {
        each.call(e.changedTouches, function(t) {
          var touch = touchMap[t.identifier];
          touch._move(t.pointX, t.pointY);
        });
        e.stop();
      });

      // iPhone では 6本指以上タッチすると強制的にすべてのタッチが解除される
      this.domElement.addEventListener('touchcancel', function(e) {
        console.warn('この端末での同時タッチ数の制限を超えました。');
        each.call(e.changedTouches, function(t) {
          var id = t.identifier;
          var touch = touchMap[id];
          touch._end();
          delete touchMap[id];
        });
        e.stop();
      });
    },

    getEmpty: function() {
      var touch = phina.input.Touch(this.domElement, true);
    
      touch.id = this.id;
      this.touches.push(touch);

      return touch;
    },

    getTouch: function(id) {
      return this.touchMap[id];
    },


    removeTouch: function(touch) {
      var i = this.touches.indexOf(touch);
      this.touches.splice(i, 1);
    },

    update: function() {
      this.touches.forEach(function(touch) {
        if (!touch.released) {
          touch.update();

          if (touch.flags === 0) {
            touch.released = true;
          }
        }
        else {
          touch.released = false;
          this.removeTouch(touch);
        }

      }, this);
    },

    _accessor: {
      id: {
        get: function() {
          return this._id[0]++;
        }
      },
    },
  });

})();
/*
 *
 */


phina.namespace(function() {

  /**
   * @class phina.input.Keyboard
   * @extends phina.input.Input
   */
  phina.define('phina.input.Keyboard', {

    superClass: 'phina.input.Input',

    /**
     * @constructor
     */
    init: function(domElement) {
      this.superInit(domElement);

      this.key = {};
      this.press  = {};
      this.down   = {};
      this.up     = {};
      this.last   = {};

      this._keydown = null;
      this._keyup = null;
      this._keypress = null;

      var self = this;
      this.domElement.addEventListener('keydown', function(e) {
        self.key[e.keyCode] = true;
        self._keydown = e.keyCode;
      });

      this.domElement.addEventListener('keyup', function(e) {
        self.key[e.keyCode] = false;
        self._keyup = e.keyCode;
      });
      this.domElement.addEventListener('keypress', function(e) {
        self._keypress = e.keyCode;
      });
    },

    /**
     * 情報更新処理
     * マイフレーム呼んで下さい.
     * @private
     */
    update: function() {
      // TODO: 一括ビット演算で行うよう修正する
      for (var k in this.key) {
        this.last[k]    = this.press[k];
        this.press[k]   = this.key[k];
        
        this.down[k] = (this.press[k] ^ this.last[k]) & this.press[k];
        this.up[k] = (this.press[k] ^ this.last[k]) & this.last[k];
      }

      if (this._keydown) {
        this.flare('keydown', { keyCode: this._keydown });
        this._keydown = null;
      }
      if (this._keyup) {
        this.flare('keyup', { keyCode: this._keyup });
        this._keyup = null;
      }
      if (this._keypress) {
        this.flare('keypress', { keyCode: this._keypress });
        this._keypress = null;
      }
      
      return this;
    },

    /**
     * キーを押しているかをチェック
     * @param   {Number/String} key keyCode or keyName
     * @returns {Boolean}   チェック結果
     */
    getKey: function(key) {
      if (typeof(key) === "string") {
        key = phina.input.Keyboard.KEY_CODE[key];
      }
      return !!this.press[key] === true;
    },
    
    /**
     * キーを押したかをチェック
     * @param   {Number/String} key keyCode or keyName
     * @returns {Boolean}   チェック結果
     */
    getKeyDown: function(key) {
      if (typeof(key) == "string") {
        key = phina.input.Keyboard.KEY_CODE[key];
      }
      return this.down[key] == true;
    },
    
    /**
     * キーを離したかをチェック
     * @param   {Number/String} key keyCode or keyName
     * @returns {Boolean}   チェック結果
     */
    getKeyUp: function(key) {
      if (typeof(key) == "string") {
        key = phina.input.Keyboard.KEY_CODE[key];
      }
      return this.up[key] == true;
    },
    
    /**
     * キーの方向を Angle(Degree) で取得
     * @returns {Boolean}   角度(Degree)
     */
    getKeyAngle: function() {
      var angle = null;
      var arrowBit =
        (this.getKey("left")   << 3) | // 1000
        (this.getKey("up")     << 2) | // 0100
        (this.getKey("right")  << 1) | // 0010
        (this.getKey("down"));         // 0001
      
      if (arrowBit !== 0 && phina.input.Keyboard.ARROW_BIT_TO_ANGLE_TABLE.hasOwnProperty(arrowBit)) {
        angle = phina.input.Keyboard.ARROW_BIT_TO_ANGLE_TABLE[arrowBit];
      }
      
      return angle;
    },

    /**
     * キーの押している向きを取得
     * 正規化されている
     */
    getKeyDirection: function() {
      var direction = phina.geom.Vector2(0, 0);

      if (this.getKey("left")) {
        direction.x = -1;
      }
      else if (this.getKey("right")) {
        direction.x = 1;
      }
      if (this.getKey("up")) {
        direction.y = -1;
      }
      else if (this.getKey("down")) {
        direction.y = 1;
      }

      if (direction.x && direction.y) {
        direction.div(Math.SQRT2);
      }

      return direction;
    },
    
    /**
     * キーの状態を設定する
     */
    setKey: function(key, flag) {
      if (typeof(key) == "string") {
        key = phina.input.Keyboard.KEY_CODE[key];
      }
      this.key[key] = flag;
      
      return this;
    },

    /**
     * キーを全て離したことにする
     */
    clearKey: function() {
      this.key = {};
      
      return this;
    },


    /*
     * @enum ARROW_BIT_TO_ANGLE_TABLE
     * 方向のアングル jsduckでは数字をプロパティに指定できない？
     * @private
     */
    _static: {
      ARROW_BIT_TO_ANGLE_TABLE: {
        /* @property 下 */
        0x01: 270,
        /* @property 右 */
        0x02:   0,
        /* @property 上 */
        0x04:  90,
        /* @property 左 */
        0x08: 180,

        /* @property 右上 */
        0x06:  45,
        /* @property 右下 */
        0x03: 315,
        /* @property 左上 */
        0x0c: 135,
        /* @property 左下 */
        0x09: 225,

        // 三方向同時押し対応
        // 想定外の操作だが対応しといたほうが無難
        /* @property 右上左 */
        0x0e:  90,
        /* @property 上左下 */
        0x0d: 180,
        /* @property 左下右 */
        0x0b: 270,
        /* @property 下右上 */
        0x07:   0,
      },

      /*
       * @enum KEY_CODE
       * キー番号
       * @private
       */
      KEY_CODE: {
        /* @property */
        "backspace" : 8,
        /* @property */
        "tab"       : 9,
        /* @property */
        "enter"     : 13,
        /* @property */
        "return"    : 13,
        /* @property */
        "shift"     : 16,
        /* @property */
        "ctrl"      : 17,
        /* @property */
        "alt"       : 18,
        /* @property */
        "pause"     : 19,
        /* @property */
        "capslock"  : 20,
        /* @property */
        "escape"    : 27,
        /* @property */
        "pageup"    : 33,
        /* @property */
        "pagedown"  : 34,
        /* @property */
        "end"       : 35,
        /* @property */
        "home"      : 36,
        /* @property */
        "left"      : 37,
        /* @property */
        "up"        : 38,
        /* @property */
        "right"     : 39,
        /* @property */
        "down"      : 40,
        /* @property */
        "insert"    : 45,
        /* @property */
        "delete"    : 46,
        
        /* @property */
        "0" : 48,
        /* @property */
        "1" : 49,
        /* @property */
        "2" : 50,
        /* @property */
        "3" : 51,
        /* @property */
        "4" : 52,
        /* @property */
        "5" : 53,
        /* @property */
        "6" : 54,
        /* @property */
        "7" : 55,
        /* @property */
        "8" : 56,
        /* @property */
        "9" : 57,
        /* @property */
        
        "a" : 65,
        /* @property */
        "A" : 65,
        /* @property */
        "b" : 66,
        /* @property */
        "B" : 66,
        /* @property */
        "c" : 67,
        /* @property */
        "C" : 67,
        /* @property */
        "d" : 68,
        /* @property */
        "D" : 68,
        /* @property */
        "e" : 69,
        /* @property */
        "E" : 69,
        /* @property */
        "f" : 70,
        /* @property */
        "F" : 70,
        /* @property */
        "g" : 71,
        /* @property */
        "G" : 71,
        /* @property */
        "h" : 72,
        /* @property */
        "H" : 72,
        /* @property */
        "i" : 73,
        /* @property */
        "I" : 73,
        /* @property */
        "j" : 74,
        /* @property */
        "J" : 74,
        /* @property */
        "k" : 75,
        /* @property */
        "K" : 75,
        /* @property */
        "l" : 76,
        /* @property */
        "L" : 76,
        /* @property */
        "m" : 77,
        /* @property */
        "M" : 77,
        /* @property */
        "n" : 78,
        /* @property */
        "N" : 78,
        /* @property */
        "o" : 79,
        /* @property */
        "O" : 79,
        /* @property */
        "p" : 80,
        /* @property */
        "P" : 80,
        /* @property */
        "q" : 81,
        /* @property */
        "Q" : 81,
        /* @property */
        "r" : 82,
        /* @property */
        "R" : 82,
        /* @property */
        "s" : 83,
        /* @property */
        "S" : 83,
        /* @property */
        "t" : 84,
        /* @property */
        "T" : 84,
        /* @property */
        "u" : 85,
        /* @property */
        "U" : 85,
        /* @property */
        "v" : 86,
        /* @property */
        "V" : 86,
        /* @property */
        "w" : 87,
        /* @property */
        "W" : 87,
        /* @property */
        "x" : 88,
        /* @property */
        "X" : 88,
        /* @property */
        "y" : 89,
        /* @property */
        "Y" : 89,
        /* @property */
        "z" : 90,
        /* @property */
        "Z" : 90,
        
        /* @property */
        "numpad0" : 96,
        /* @property */
        "numpad1" : 97,
        /* @property */
        "numpad2" : 98,
        /* @property */
        "numpad3" : 99,
        /* @property */
        "numpad4" : 100,
        /* @property */
        "numpad5" : 101,
        /* @property */
        "numpad6" : 102,
        /* @property */
        "numpad7" : 103,
        /* @property */
        "numpad8" : 104,
        /* @property */
        "numpad9" : 105,
        /* @property */
        "multiply"      : 106,
        /* @property */
        "add"           : 107,
        /* @property */
        "subtract"      : 109,
        /* @property */
        "decimalpoint"  : 110,
        /* @property */
        "divide"        : 111,

        /* @property */
        "f1"    : 112,
        /* @property */
        "f2"    : 113,
        /* @property */
        "f3"    : 114,
        /* @property */
        "f4"    : 115,
        /* @property */
        "f5"    : 116,
        /* @property */
        "f6"    : 117,
        /* @property */
        "f7"    : 118,
        /* @property */
        "f8"    : 119,
        /* @property */
        "f9"    : 120,
        /* @property */
        "f10"   : 121,
        /* @property */
        "f11"   : 122,
        /* @property */
        "f12"   : 123,
        
        /* @property */
        "numlock"   : 144,
        /* @property */
        "scrolllock": 145,
        /* @property */
        "semicolon" : 186,
        /* @property */
        "equalsign" : 187,
        /* @property */
        "comma"     : 188,
        /* @property */
        "dash"      : 189,
        /* @property */
        "period"    : 190,
        /* @property */
        "forward slash" : 191,
        /* @property */
        "/": 191,
        /* @property */
        "grave accent"  : 192,
        /* @property */
        "open bracket"  : 219,
        /* @property */
        "back slash"    : 220,
        /* @property */
        "close bracket"  : 221,
        /* @property */
        "single quote"  : 222,
        /* @property */
        "space"         : 32

      },
    }
  });

});

phina.namespace(function() {

  /**
   * @class phina.input.GamepadManager
   * ゲームパッドマネージャー.
   * ゲームパッド接続状況の監視、個々のゲームパッドの入力状態の更新を行う.
   * @extends phina.util.EventDispatcher
   */
  phina.define('phina.input.GamepadManager', {
    superClass: 'phina.util.EventDispatcher',

    /**
     * 作成済みphina.input.Gamepadオブジェクトのリスト
     *
     * @type {Object.<number, phina.input.Gamepad>}
     */
    gamepads: null,

    /**
     * 作成済みゲームパッドのindexのリスト
     *
     * @type {number[]}
     * @private
     */
    _created: null,

    /**
     * ラップ前Gamepadのリスト
     * @type {phina.input.Gamepad[]}
     * @private
     */
    _rawgamepads: null,

    /**
     * @constructor
     */
    init: function() {
      this.superInit();

      this.gamepads = {};
      this._created = [];
      this._rawgamepads = [];

      this._prevTimestamps = {};

      this._getGamepads = null;
      var navigator = phina.global.navigator;
      if (navigator && navigator.getGamepads) {
        this._getGamepads = navigator.getGamepads.bind(navigator);
      } else if (navigator && navigator.webkitGetGamepads) {
        this._getGamepads = navigator.webkitGetGamepads.bind(navigator);
      } else {
        this._getGamepads = function() {};
      }

      phina.global.addEventListener('gamepadconnected', function(e) {
        var gamepad = this.get(e.gamepad.index);
        gamepad.connected = true;
        this.flare('connected', {
          gamepad: gamepad,
        });
      }.bind(this));

      phina.global.addEventListener('gamepaddisconnected', function(e) {
        var gamepad = this.get(e.gamepad.index);
        gamepad.connected = false;
        this.flare('disconnected', {
          gamepad: gamepad,
        });
      }.bind(this));
    },

    /**
     * 情報更新処理
     * マイフレーム呼んで下さい.
     */
    update: function() {
      this._poll();

      for (var i = 0, end = this._created.length; i < end; i++) {
        var index = this._created[i];
        var rawgamepad = this._rawgamepads[index];

        if (!rawgamepad) {
          continue;
        }

        if (rawgamepad.timestamp && (rawgamepad.timestamp === this._prevTimestamps[i])) {
          this.gamepads[index]._updateStateEmpty();
          continue;
        }

        this._prevTimestamps[i] = rawgamepad.timestamp;
        this.gamepads[index]._updateState(rawgamepad);
      }
    },

    /**
     * 指定されたindexのGamepadオブジェクトを返す.
     *
     * 未作成の場合は作成して返す.
     */
    get: function(index) {
      index = index || 0;

      if (!this.gamepads[index]) {
        this._created.push(index);
        this.gamepads[index] = phina.input.Gamepad(index);
      }

      return this.gamepads[index];
    },

    /**
     * 指定されたindexのGamepadオブジェクトを破棄する.
     * 破棄されたGamepadオブジェクトは以降更新されない.
     */
    dispose: function(index) {
      if (this._created.contains(index)) {
        var gamepad = this.get(index);
        delete this.gamepad[gamepad];
        this._created.erase(index);

        gamepad.connected = false;
      }
    },

    /**
     * 指定されたindexのゲームパッドが接続中かどうかを返す.
     *
     * Gamepadオブジェクトが未作成の場合でも動作する.
     */
    isConnected: function(index) {
      index = index || 0;

      return this._rawgamepads[index] && this._rawgamepads[index].connected;
    },

    /**
     * @private
     */
    _poll: function() {
      var rawGamepads = this._getGamepads();
      if (rawGamepads) {
        this._rawgamepads.clear();

        for (var i = 0, end = rawGamepads.length; i < end; i++) {
          if (rawGamepads[i]) {
            this._rawgamepads.push(rawGamepads[i]);
          }
        }
      }
    },

    _static: {
      /** ブラウザがGamepad APIに対応しているか. */
      isAvailable: (function() {
        var nav = phina.global.navigator;
        if (!nav) return false;

        return (!!nav.getGamepads) || (!!nav.webkitGetGamepads);
      })(),
    },

  });

  /**
   * @class phina.input.Gamepad
   * ゲームパッド
   *
   * 直接インスタンス化せず、phina.input.GamepadManagerオブジェクトから取得して使用する.
   */
  phina.define("phina.input.Gamepad", {

    index: null,
    buttons: null,
    /** @type {Array.<phina.geom.Vector2>} */
    sticks: null,

    id: null,
    connected: false,
    mapping: null,
    timestamp: null,

    init: function(index) {
      this.index = index || 0;

      this.buttons = Array.range(0, 16).map(function() {
        return {
          value: 0,
          pressed: false,
          last: false,
          down: false,
          up: false,
        };
      });
      this.sticks = Array.range(0, 2).map(function() {
        return phina.geom.Vector2(0, 0);
      });
    },

    /**
     * ボタンが押されているか.
     */
    getKey: function(button) {
      if (typeof(button) === 'string') {
        button = phina.input.Gamepad.BUTTON_CODE[button];
      }
      if (this.buttons[button]) {
        return this.buttons[button].pressed;
      } else {
        return false;
      }
    },

    /**
     * ボタンを押した.
     */
    getKeyDown: function(button) {
      if (typeof(button) === 'string') {
        button = phina.input.Gamepad.BUTTON_CODE[button];
      }
      if (this.buttons[button]) {
        return this.buttons[button].down;
      } else {
        return false;
      }
    },

    /**
     * ボタンを離した.
     */
    getKeyUp: function(button) {
      if (typeof(button) === 'string') {
        button = phina.input.Gamepad.BUTTON_CODE[button];
      }
      if (this.buttons[button]) {
        return this.buttons[button].up;
      } else {
        return false;
      }
    },

    /**
     * 十字キーの入力されている方向.
     */
    getKeyAngle: function() {
      var angle = null;
      var arrowBit =
        (this.getKey('left') << 3) | // 1000
        (this.getKey('up') << 2) | // 0100
        (this.getKey('right') << 1) | // 0010
        (this.getKey('down')); // 0001

      if (arrowBit !== 0 && ARROW_BIT_TO_ANGLE_TABLE.hasOwnProperty(arrowBit)) {
        angle = ARROW_BIT_TO_ANGLE_TABLE[arrowBit];
      }

      return angle;
    },

    /**
     * 十字キーの入力されている方向をベクトルで.
     * 正規化されている.
     */
    getKeyDirection: function() {
      var direction = phina.geom.Vector2(0, 0);

      if (this.getKey('left')) {
        direction.x = -1;
      } else if (this.getKey('right')) {
        direction.x = 1;
      }
      if (this.getKey('up')) {
        direction.y = -1;
      } else if (this.getKey('down')) {
        direction.y = 1;
      }

      if (direction.x && direction.y) {
        direction.div(Math.SQRT2);
      }

      return direction;
    },

    /**
     * スティックの入力されている方向.
     */
    getStickAngle: function(stickId) {
      stickId = stickId || 0;
      var stick = this.sticks[stickId];
      return stick ? Math.atan2(-stick.y, stick.x) : null;
    },

    /**
     * スティックの入力されている方向をベクトルで.
     */
    getStickDirection: function(stickId) {
      stickId = stickId || 0;
      return this.sticks ? this.sticks[stickId].clone() : phina.geom.Vector2(0, 0);
    },

    /**
     * @private
     */
    _updateState: function(gamepad) {
      this.id = gamepad.id;
      this.connected = gamepad.connected;
      this.mapping = gamepad.mapping;
      this.timestamp = gamepad.timestamp;

      for (var i = 0, iend = gamepad.buttons.length; i < iend; i++) {
        this._updateButton(gamepad.buttons[i], i);
      }

      for (var j = 0, jend = gamepad.axes.length; j < jend; j += 2) {
        this._updateStick(gamepad.axes[j + 0], j / 2, 'x');
        this._updateStick(gamepad.axes[j + 1], j / 2, 'y');
      }
    },

    /**
     * @private
     */
    _updateStateEmpty: function() {
      for (var i = 0, iend = this.buttons.length; i < iend; i++) {
        this.buttons[i].down = false;
        this.buttons[i].up = false;
      }
    },

    /**
     * @private
     */
    _updateButton: function(value, buttonId) {
      if (this.buttons[buttonId] === undefined) {
        this.buttons[buttonId] = {
          value: 0,
          pressed: false,
          last: false,
          down: false,
          up: false,
        };
      }
      
      var button = this.buttons[buttonId];

      button.last = button.pressed;

      if (typeof value === 'object') {
        button.value = value.value;
        button.pressed = value.pressed;
      } else {
        button.value = value;
        button.pressed = value > phina.input.Gamepad.ANALOGUE_BUTTON_THRESHOLD;
      }

      button.down = (button.pressed ^ button.last) & button.pressed;
      button.up = (button.pressed ^ button.last) & button.last;
    },

    /**
     * @private
     */
    _updateStick: function(value, stickId, axisName) {
      if (this.sticks[stickId] === undefined) {
        this.sticks[stickId] = phina.geom.Vector2(0, 0);
      }
      this.sticks[stickId][axisName] = value;
    },

    _static: {
      /** ブラウザがGamepad APIに対応しているか. */
      isAvailable: (function() {
        var nav = phina.global.navigator;
        if (!nav) return false;

        return (!!nav.getGamepads) || (!!nav.webkitGetGamepads);
      })(),

      /** アナログ入力対応のボタンの場合、どの程度まで押し込むとonになるかを表すしきい値. */
      ANALOGUE_BUTTON_THRESHOLD: 0.5,

      /** ボタン名とボタンIDのマップ. */
      BUTTON_CODE: {
        'a': 0,
        'b': 1,
        'x': 2,
        'y': 3,

        'l1': 4,
        'r1': 5,
        'l2': 6,
        'r2': 7,

        'select': 8,
        'start': 9,

        'l3': 10,
        'r3': 11,

        'up': 12,
        'down': 13,
        'left': 14,
        'right': 15,

        'special': 16,

        'A': 0,
        'B': 1,
        'X': 2,
        'Y': 3,

        'L1': 4,
        'R1': 5,
        'L2': 6,
        'R2': 7,

        'SELECT': 8,
        'START': 9,

        'L3': 10,
        'R3': 11,

        'UP': 12,
        'DOWN': 13,
        'LEFT': 14,
        'RIGHT': 15,

        'SPECIAL': 16,
      },
    },
  });

  var ARROW_BIT_TO_ANGLE_TABLE = {
    0x00: null,

    /* @property 下 */
    0x01: 270,
    /* @property 右 */
    0x02: 0,
    /* @property 上 */
    0x04: 90,
    /* @property 左 */
    0x08: 180,

    /* @property 右上 */
    0x06: 45,
    /* @property 右下 */
    0x03: 315,
    /* @property 左上 */
    0x0c: 135,
    /* @property 左下 */
    0x09: 225,

    // 三方向同時押し対応
    // 想定外の操作だが対応しといたほうが無難
    /* @property 右上左 */
    0x0e: 90,
    /* @property 上左下 */
    0x0d: 180,
    /* @property 左下右 */
    0x0b: 270,
    /* @property 下右上 */
    0x07: 0,
  };

});

/*
 *
 */


phina.namespace(function() {

  /**
   * @class phina.input.Accelerometer
   * スマートフォンのセンサー情報
   */
  phina.define('phina.input.Accelerometer', {

    /** @property  gravity 重力センサー */
    /** @property  acceleration 加速度センサー */
    /** @property  rotation 回転加速度センサー */
    /** @property  orientation スマートフォンの傾き */

    /**
     * @constructor
     */
    init: function() {

      var self = this;
      
      this.gravity        = phina.geom.Vector3(0, 0, 0);
      this.acceleration   = phina.geom.Vector3(0, 0, 0);
      this.rotation       = phina.geom.Vector3(0, 0, 0);
      this.orientation    = phina.geom.Vector3(0, 0, 0);

      if (phina.isMobile()) {
        phina.global.addEventListener("devicemotion", function(e) {
          var acceleration = self.acceleration;
          var gravity = self.gravity;
          var rotation = self.rotation;
          
          if (e.acceleration) {
            acceleration.x = e.acceleration.x;
            acceleration.y = e.acceleration.y;
            acceleration.z = e.acceleration.z;
          }
          if (e.accelerationIncludingGravity) {
            gravity.x = e.accelerationIncludingGravity.x;
            gravity.y = e.accelerationIncludingGravity.y;
            gravity.z = e.accelerationIncludingGravity.z;
          }
          if (e.rotationRate) {
            rotation.x = rotation.beta  = e.rotationRate.beta;
            rotation.y = rotation.gamma = e.rotationRate.gamma;
            rotation.z = rotation.alpha = e.rotationRate.alpha;
          }
        });
        
        phina.global.addEventListener("deviceorientation", function(e) {
          var orientation = self.orientation;
          orientation.alpha   = e.alpha;  // z(0~360)
          orientation.beta    = e.beta;   // x(-180~180)
          orientation.gamma   = e.gamma;  // y(-90~90)
        });
      }
    },

  });

});

phina.namespace(function() {

  /**
   * @class phina.app.Updater
   */
  phina.define('phina.app.Updater', {

    init: function(app) {
      this.app = app;
    },

    update: function(root) {
      this._updateElement(root);
    },

    _updateElement: function(element) {
      var app = this.app;

      // 更新するかを判定
      if (element.awake === false) return ;

      // エンターフレームイベント
      if (element.has('enterframe')) {
        element.flare('enterframe', {
          app: this.app,
        });
      }

      // 更新
      if (element.update) element.update(app);

      // タッチ判定
      // this._checkPoint(element);

      // 子供を更新
      var len = element.children.length;
      if (element.children.length > 0) {
        var tempChildren = element.children.slice();
        for (var i=0; i<len; ++i) {
          this._updateElement(tempChildren[i]);
        }
      }
    },

    _checkPoint: function(obj) {

      this.app.pointers.forEach(function(p) {
        if (p.id !== null) {
          this.__checkPoint(obj, p);
        }
      }, this);
    },

    __checkPoint: function(obj, p) {
      if (!obj.interactive) return ;

      var prevOverFlag = obj._overFlags[p.id];
      var overFlag = obj.hitTest2(p.x, p.y);
      obj._overFlags[p.id] = overFlag;

      if (!prevOverFlag && overFlag) {
        obj.flare('pointover', {
          pointer: p,
        });
      }
      if (prevOverFlag && !overFlag) {
        obj.flare('pointout');
      }

      if (overFlag) {
        if (p.getPointingStart()) {
          obj._touchFlags[p.id] = true;
          obj.flare('pointstart');
        }
      }

      if (obj._touchFlags[p.id]) {
        obj.flare('pointstay');
        if (p._moveFlag) {
          obj.flare('pointmove');
        }
      }

      if (obj._touchFlags[p.id]===true && p.getPointingEnd()) {
        obj._touchFlags[p.id] = false;
        obj.flare('pointend');

        if (obj._overFlags[p.id]) {
          obj._overFlags[p.id] = false;
          obj.flare('pointout');
        }
      }
    },

  });

  
});

phina.namespace(function() {

  /**
   * @class phina.app.Interactive
   */
  phina.define('phina.app.Interactive', {

    init: function(app) {
      this.app = app;
      this._enable = true;
      this.multiTouch = true;
      this.events = {};
      this.cursor = {
        normal: '',
        hover: 'pointer',
      };
      this.hover = false;
    },

    enable: function() {
      this._enable = true;
      return this;
    },
    disable: function() {
      this._enable = false;
      return this;
    },

    check: function(root) {
      // カーソルのスタイルを反映
      if (this.app.domElement) {
        if (this.hover) {
          this.app.domElement.style.cursor = this.cursor.hover;
        }
        else {
          this.app.domElement.style.cursor = this.cursor.normal;
        }
      }
      this.hover = false;
      if (!this._enable || !this.app.pointers) return ;

      if (this.multiTouch) {
        this.app.pointers.forEach(function(p) {
          if (p.id !== null) {
            this._initEvents(p);
            this._checkElement(root, p);
          }
        }, this);
      }
      else {
        this._initEvents(this.app.pointer);
        this._checkElement(root, this.app.pointer);
      }
    },

    _initEvents: function(pointer) {
      var self = this;
      [
        'pointstart',
        'pointmove',
        'pointend',
        'pointover',
        'pointout',
        'pointstay',
      ].forEach(function(eventName) {
        self._initEvent(eventName, pointer, []);
      });
    },

    _initEvent: function(eventName, pointer, path) {
      this.events[eventName] = {
        type: eventName,
        target: null,
        path: path,
        pointer: pointer,
        interactive: this,
        // 親要素へイベントを伝播するか
        stop: false,
        // 一度イベントが発火しても、続行して背面の要素までイベントを発火させるか
        pass: false,
        _end: false,
      };
    },

    _checkElement: function(element, p) {
      var app = this.app;

      // 更新するかを判定
      if (element.awake === false) return ;

      var events = this.events;
      var allEnded = true;

      for (var k in events) {
        var e = events[k];
        if (!e._end) {
          allEnded = false;
          e.path.unshift(element);
        }
      }
      if (allEnded) {
        return;
      }
      // 子供を更新
      var len = element.children.length;
      if (len > 0) {
        var tempChildren = element.children.slice();
        for (var i = len - 1; i >= 0; --i) {
          this._checkElement(tempChildren[i], p);
        }
      }

      // タッチ判定
      if (element.interactive) {
        // イベント発火対象のイベントの配列を取得
        var targetEvents = this._checkPoint(element, p);
        
        if (element._overFlags[p.id]) {
          // 後ろに要素が重なってる場合に pointover, pointout が発火しないようにする
          events.pointover._end = true;
          events.pointout._end = true;

          // 一つでも overFlag が立っている有効な要素があれば、hoverにする
          if (element.boundingType && element.boundingType !== 'none') {
            this.hover = true;
          }
        }

        targetEvents.forEach(function(event) {
          // targetを発火元の要素に設定
          event.target = element;
          // 発火元から root 要素まで発火
          event.path.some(function(capturedElement) {
            capturedElement.fire(event);
            // イベント内で stop が true になった場合は、親要素へ伝播するのを止める
            return event.stop;
          });

          // イベント終了フラグを立てて、これ以上イベントを発火しないようにする
          event._end = true;

          // イベント通過設定が true なら、イベントが終了せずに後ろの要素へ行く
          if (event.pass) {
            this._initEvent(event.type, p, event.path.slice(0));
          }
        }, this);
      }

      for (var k in events) {
        var e = events[k];
        if (!e._end) {
          e.path.shift();
        }
      }
    },

    _checkPoint: function(obj, p) {
      var events = this.events;
      var prevOverFlag = obj._overFlags[p.id];
      var overFlag = obj.hitTest(p.x, p.y);
      obj._overFlags[p.id] = overFlag;
      var targetEvents = [];

      if (!prevOverFlag && overFlag && !events.pointover._end) {
        targetEvents.push(events.pointover);
      }
      if (prevOverFlag && !overFlag && !events.pointout._end) {
        targetEvents.push(events.pointout);
      }

      if (overFlag && !events.pointstart._end && p.getPointingStart()) {
        obj._touchFlags[p.id] = true;
        targetEvents.push(events.pointstart);
        // クリックフラグを立てる
        obj._clicked = true;
      }

      if (obj._touchFlags[p.id]) {
        if (!events.pointstay._end) {
          targetEvents.push(events.pointstay);
        }
        if (!events.pointmove._end && p._moveFlag) {
          targetEvents.push(events.pointmove);
        }
        if (!events.pointend._end && p.getPointingEnd()) {
          obj._touchFlags[p.id] = false;
          targetEvents.push(events.pointend);

          if (!events.pointout._end && overFlag && phina.isMobile()) {
            obj._overFlags[p.id] = false;
            targetEvents.push(events.pointout);
          }
        }
      }

      return targetEvents;
    },
  });


});

phina.namespace(function() {

  /**
   * @class phina.app.BaseApp
   * ベースとなるアプリケーションクラス
   * @extends phina.util.EventDispatcher
   */
  phina.define('phina.app.BaseApp', {
    superClass: 'phina.util.EventDispatcher',

    /** awake */
    awake: null,
    /** fps */
    fps: null,
    /** frame */
    frame: null,

    /**
     * @constructor
     */
    init: function() {
      this.superInit();
      this._scenes = [phina.app.Scene()];
      this._sceneIndex = 0;

      this.updater = phina.app.Updater(this);
      this.interactive = phina.app.Interactive(this);

      this.awake = true;
      this.ticker = phina.util.Ticker();
    },

    run: function() {
      var self = this;
      this._loopCaller = function() {
        self._loop();
      };
      this.ticker.tick(this._loopCaller);

      this.ticker.start();

      return this;
    },

    kill: function() {
      this.ticker.stop();
      this.ticker.untick(this._loopCaller);
      return this;
    },

    replaceScene: function(scene) {
      this.flare('replace');
      this.flare('changescene');

      var e = null;
      if (this.currentScene) {
        this.currentScene.app = null;
      }
      this.currentScene = scene;
      this.currentScene.app = this;
      this.currentScene.flare('enter', {
        app: this,
      });

      return this;
    },

    pushScene: function(scene) {
      this.flare('push');
      this.flare('changescene');

      this.currentScene.flare('pause', {
        app: this,
      });
      
      this._scenes.push(scene);
      ++this._sceneIndex;

      this.flare('pushed');
      
      scene.app = this;
      scene.flare('enter', {
        app: this,
      });

      return this;
    },

    /**
     * シーンをポップする(ポーズやオブション画面などで使用)
     */
    popScene: function() {
      this.flare('pop');
      this.flare('changescene');

      var scene = this._scenes.pop();
      --this._sceneIndex;

      scene.flare('exit', {
        app: this,
      });
      scene.app = null;

      this.flare('poped');
      
      // 
      this.currentScene.flare('resume', {
        app: this,
        prevScene: scene,
      });
      
      return scene;
    },

    /**
     * シーンのupdateを実行するようにする
     */
    start: function() {
      this.awake = true;

      return this;
    },
    
    /**
     * シーンのupdateを実行しないようにする
     */
    stop: function() {
      this.awake = false;

      return this;
    },

    enableStats: function() {
      if (phina.global.Stats) {
        this.stats = new Stats();
        document.body.appendChild(this.stats.domElement);
      }
      else {
        // console.warn("not defined stats.");
        var STATS_URL = 'https://cdnjs.cloudflare.com/ajax/libs/stats.js/r14/Stats.js';
        var script = document.createElement('script');
        script.src = STATS_URL;
        document.body.appendChild(script);
        script.onload = function() {
          this.enableStats();
        }.bind(this);
      }
      return this;
    },

    enableDatGUI: function(callback) {
      if (phina.global.dat) {
        var gui = new phina.global.dat.GUI();
        callback(gui);
      }
      else {
        // console.warn("not defined dat.GUI.");
        var URL = 'https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.5.1/dat.gui.js';
        var script = document.createElement('script');
        script.src = URL;
        document.body.appendChild(script);
        script.onload = function() {
          var gui = new phina.global.dat.GUI();
          callback(gui);
        }.bind(this);
      }
      return this;
    },

    _loop: function() {
      this._update();
      this.interactive.check(this.currentScene);
      this._draw();

      // stats update
      if (this.stats) this.stats.update();
    },

    _update: function() {
      if (this.awake) {
        // エンターフレームイベント
        if (this.has('enterframe')) {
          this.flare('enterframe');
        }

        this.update && this.update();
        this.updater.update(this.currentScene);
      }
    },

    /**
     * 描画用仮想関数
     * @private
     */
    _draw: function() {},

    _accessor: {
      currentScene: {
        "get": function()   { return this._scenes[this._sceneIndex]; },
        "set": function(v)  { this._scenes[this._sceneIndex] = v; },
      },

      rootScene: {
        "get": function()   { return this._scenes[0]; },
        "set": function(v)  { this._scenes[0] = v; },
      },

      frame: {
        "get": function () { return this.ticker.frame; },
        "set": function (v) { this.ticker.frame = v; },
      },

      fps: {
        "get": function () { return this.ticker.fps; },
        "set": function (v) { this.ticker.fps = v; },
      },

      deltaTime: {
        "get": function () { return this.ticker.deltaTime; },
      },

      elapsedTime: {
        "get": function () { return this.ticker.elapsedTime; },
      },

      currentTime: {
        "get": function () { return this.ticker.currentTime; },
      },

      startTime: {
        "get": function () { return this.ticker.startTime; },
      },
    },

  });

  
});


phina.namespace(function() {

  /**
   * @class phina.app.Element
   * @extends phina.util.EventDispatcher
   * # 主に要素の親子関係を扱うクラス
   * 主に親子関係等を定義するクラスです。
   */
  phina.define('phina.app.Element', {
    superClass: 'phina.util.EventDispatcher',

    /**
     * @property parent
     * 親要素
     */
    parent: null,

    /**
     * @property children
     * 子要素
     */
    children: null,

    /**
     * @property awake
     * 有効かどうか
     */
    awake: true,

    /**
     * @constructor
     */
    init: function() {
      this.superInit();
      this.children = [];
    },

    /**
     * @method addChild
     * 自身に子要素を追加します。
     *
     * 自身を子要素として引数で指定した要素に追加するには {@link #addChildTo} を使用してください。
     *
     * @param {Object} child 追加する子要素
     */
    addChild: function(child) {
      if (child.parent) child.remove();

      child.parent = this;
      this.children.push(child);

      child.has('added') && child.flare('added');

      return child;
    },
    /**
     * @method addChildTo
     * 自身を子要素として引数で指定した要素に追加します。
     *
     * 自身に子要素を追加するには {@link #addChild} を使用してください。
     *
     * @param {Object} parent 自身を子要素として追加する要素
     */
    addChildTo: function(parent) {
      parent.addChild(this);

      return this;
    },
    /**
     * @method addChildAt
     * 自身を、指定した要素の子要素の任意の配列インデックスに追加します。
     *
     * @param {Object} child 追加する子要素
     * @param {Number} index インデックス番号
     */
    addChildAt: function(child, index) {
      if (child.parent) child.remove();

      child.parent = this;
      this.children.splice(index, 0, child);

      child.has('added') && child.flare('added');

      return child;
    },
    /**
     * @method getChildAt
     * 指定したインデックスの子要素を返します。
     *
     * @param {Number} index インデックス番号
     * @return {Object} 指定したインデックスの子要素
     */
    getChildAt: function(index) {
      return this.children.at(index);
    },
    /**
     * @method getChildByName
     * 指定した名前の子要素を返します。（未実装）
     */
    getChildByName: function(name) {
      // TODO:
    },
    /**
     * @method getChildIndex
     * 指定した子要素のインデックス番号を返します。
     *
     * @param {Object} child 子要素
     * @return {Number} 指定した子要素のインデックス番号
     */
    getChildIndex: function(child) {
      return this.children.indexOf(child);
    },
    /**
     * @method getParent
     * 指定した要素の親要素を返します。
     *
     * @return {Object} 指定した要素の親要素
     */
    getParent: function() {
      return this.parent;
    },
    /**
     * @method getRoot
     * 指定した要素の階層ツリーのルートを返します。
     *
     * @return {Object} 指定した要素の階層ツリーのルート
     */
    getRoot: function() {
      var elm = this;
      for (elm=this.parent; elm.parent != null; elm = elm.parent) {

      }
      return elm;
    },
    /**
     * @method removeChild
     * @chainable
     * 指定した要素を自身の子要素から削除します。
     *
     * @param {Object} child 要素
     */
    removeChild: function(child) {
      var index = this.children.indexOf(child);
      if (index !== -1) {
        this.children.splice(index, 1);
        child.has('removed') && child.flare('removed');
      }
      return this;
    },
    /**
     * @method remove
     * 自身を親要素の子要素から削除します。
     */
    remove: function() {
      if (!this.parent) return ;

      this.parent.removeChild(this);
      this.parent = null;

      return this;
    },
    /**
     * @method isAwake
     * 自身が有効かどうかを返します。
     *
     * @return {Boolean} 有効かどうか
     */
    isAwake: function() {
      return this.awake;
    },
    /**
     * @method wakeUp
     * 自身を有効にします。
     */
    wakeUp: function() {
      this.awake = true;
      return this;
    },
    /**
     * @method sleep
     * 自身を無効にします。
     */
    sleep: function() {
      this.awake = false;
      return this;
    },
    /**
     * @method fromJSON
     * JSON 形式を使って自身に子要素を追加することができます。
     *
     * ### Example
     *      this.fromJSON({
     *        "children": {
     *          "label": {                  //キー名が追加する子要素の名前になる
     *            "className": "Label",     //クラス
     *            "arguments": ['hello!'],  //初期化時の引数
     *            "x":320,                  //その他プロパティ
     *            "y":480,
     *          },
     *        },
     *      });
     *
     * @param {JSON} json JSON 形式
     */
    fromJSON: function(json) {

      var createChildren = function(name, data) {
        //
        var args = data.arguments;
        args = (args instanceof Array) ? args : [args];
        //
        var _class = phina.using(data.className);
        //
        var element = _class.apply(null, args);

        element.name = name;
        this[name] = element;

        element.fromJSON(data);
        element.addChildTo(this);
      }.bind(this);

      var createAccessories = function(name, data) {
        //
        var args = data.arguments;
        args = (args instanceof Array) ? args : [args];
        //
        var _class = phina.using(data.className);
        //
        var accessory = _class.apply(null, args);

        accessory.name = name;
        this[name] = accessory;

        accessory.attachTo(this);
      }.bind(this);

      json.forIn(function(key, value) {
        if (key === 'children') {
          value.forIn(function(name, data) {
            createChildren(name, data);
          });
        }
        else if (key === 'accessories') {
          value.forIn(function(name, data) {
            createAccessories(name, data);
          });
        }
        else {
          if (key !== 'type' && key !== 'className') {
            this[key] = value;
          }
        }
      }, this);

      return this;
    },
    /**
     * @method toJSON
     * 自身の子要素を JSON 形式で返します。
     *
     * @return {JSON} JSON形式
     */
    toJSON: function() {
      var keys = Object.keys(phina.using(this.className).defaults || {});

      this._hierarchies.forEach(function(e) {
        var d = e.defaults;
        if (d) {
          Object.keys(d).forEach(function(k) {
            if (keys.indexOf(k) === -1) {
              keys.push(k);
            }
          });
        }
      });

      keys.push('name', 'className');

      var json = {};
      keys.each(function(key) {
        json[key] = this[key];
      }, this);

      var children = this.children.map(function(child) {
        return child.toJSON();
      });

      if (children.length) {
        json.children = {};
        children.each(function(child, i) {
          json.children[child.name || (child.className + '_' + i)] = child;
        });
      }

      return json;
    },
  });

});

phina.namespace(function() {

  /**
   * @class phina.app.Object2D
   * Object2D
   * @extends phina.app.Element
   */
  phina.define('phina.app.Object2D', {
    superClass: 'phina.app.Element',

    /** 位置 */
    position: null,
    /** 回転 */
    rotation: 0,
    /** スケール */
    scale: null,
    /** 基準位置 */
    origin: null,

    /**
     * @constructor
     */
    init: function(options) {
      this.superInit();

      options = ({}).$safe(options, phina.app.Object2D.defaults);

      this.position = phina.geom.Vector2(options.x, options.y);
      this.scale    = phina.geom.Vector2(options.scaleX, options.scaleY);
      this.rotation = options.rotation;
      this.origin   = phina.geom.Vector2(options.originX, options.originY);

      this._matrix = phina.geom.Matrix33().identity();
      this._worldMatrix = phina.geom.Matrix33().identity();

      this.interactive = false;
      this._overFlags = {};
      this._touchFlags = {};

      this.width = options.width;
      this.height = options.height;
      this.radius = options.radius;
      this.boundingType = options.boundingType;
    },

    /**
     * 点と衝突しているかを判定
     * @param {Number} x
     * @param {Number} y
     */
    hitTest: function(x, y) {
      if (this.boundingType === 'rect') {
        return this.hitTestRect(x, y);
      }
      else if (this.boundingType === 'circle') {
        return this.hitTestCircle(x, y);
      }
      else {
        // none の場合
        return true;
      }
    },

    hitTestRect: function(x, y) {
      var p = this.globalToLocal(phina.geom.Vector2(x, y));

      var left   = -this.width*this.originX;
      var right  = +this.width*(1-this.originX);
      var top    = -this.height*this.originY;
      var bottom = +this.height*(1-this.originY);

      return ( left < p.x && p.x < right ) && ( top  < p.y && p.y < bottom );
    },

    hitTestCircle: function(x, y) {
      // 円判定
      var p = this.globalToLocal(phina.geom.Vector2(x, y));
      if (((p.x)*(p.x)+(p.y)*(p.y)) < (this.radius*this.radius)) {
          return true;
      }
      return false;
    },

    /**
     * 要素と衝突しているかを判定
     * @param {Object} elm
     */
    hitTestElement: function(elm) {
      var rect0 = this;
      var rect1 = elm;
      return (rect0.left < rect1.right) && (rect0.right > rect1.left) &&
             (rect0.top < rect1.bottom) && (rect0.bottom > rect1.top);
    },


    globalToLocal: function(p) {
      var matrix = this._worldMatrix.clone();
      matrix.invert();
      // matrix.transpose();

      var temp = matrix.multiplyVector2(p);

      return temp;
    },

    setInteractive: function(flag, type) {
      this.interactive = flag;
      if (type) {
        this.boundingType = type;
      }

      return this;
    },

    /**
     * X 座標値をセット
     * @param {Number} x
     */
    setX: function(x) {
      this.position.x = x;
      return this;
    },
    
    /**
     * Y 座標値をセット
     * @param {Number} y
     */
    setY: function(y) {
      this.position.y = y;
      return this;
    },
    
    /**
     * XY 座標をセット
     * @param {Number} x
     * @param {Number} y
     */
    setPosition: function(x, y) {
      this.position.x = x;
      this.position.y = y;
      return this;
    },

    /**
     * 回転をセット
     * @param {Number} rotation
     */
    setRotation: function(rotation) {
      this.rotation = rotation;
      return this;
    },

    /**
     * スケールをセット
     * @param {Number} x
     * @param {Number} y
     */
    setScale: function(x, y) {
      this.scale.x = x;
      if (arguments.length <= 1) {
          this.scale.y = x;
      } else {
          this.scale.y = y;
      }
      return this;
    },
    
    /**
     * 基準点をセット
     * @param {Number} x
     * @param {Number} y
     */
    setOrigin: function(x, y) {
      this.origin.x = x;
      this.origin.y = y;
      return this;
    },
    
    /**
     * 幅をセット
     * @param {Number} width
     */
    setWidth: function(width) {
      this.width = width;
      return this;
    },
    
    /**
     * 高さをセット
     * @param {Number} height
     */
    setHeight: function(height) {
      this.height = height;
      return this;
    },
    
    /**
     * サイズ(幅, 高さ)をセット
     * @param {Number} width
     * @param {Number} height
     */
    setSize: function(width, height) {
      this.width  = width;
      this.height = height;
      return this;
    },

    setBoundingType: function(type) {
      this.boundingType = type;
      return this;
    },

    moveTo: function(x, y) {
      this.position.x = x;
      this.position.y = y;
      return this;
    },

    moveBy: function(x, y) {
      this.position.x += x;
      this.position.y += y;
      return this;
    },

    _calcWorldMatrix: function() {
      if (!this.parent) return ;

      // cache check
      if (this.rotation != this._cachedRotation) {
        this._cachedRotation = this.rotation;

        var r = this.rotation*(Math.PI/180);
        this._sr = Math.sin(r);
        this._cr = Math.cos(r);
      }

      var local = this._matrix;
      var parent = this.parent._worldMatrix || phina.geom.Matrix33.IDENTITY;
      var world = this._worldMatrix;

      // ローカルの行列を計算
      local.m00 = this._cr * this.scale.x;
      local.m01 =-this._sr * this.scale.y;
      local.m10 = this._sr * this.scale.x;
      local.m11 = this._cr * this.scale.y;
      local.m02 = this.position.x;
      local.m12 = this.position.y;

      // cache
      var a00 = local.m00; var a01 = local.m01; var a02 = local.m02;
      var a10 = local.m10; var a11 = local.m11; var a12 = local.m12;
      var b00 = parent.m00; var b01 = parent.m01; var b02 = parent.m02;
      var b10 = parent.m10; var b11 = parent.m11; var b12 = parent.m12;

      // 親の行列と掛け合わせる
      world.m00 = b00 * a00 + b01 * a10;
      world.m01 = b00 * a01 + b01 * a11;
      world.m02 = b00 * a02 + b01 * a12 + b02;

      world.m10 = b10 * a00 + b11 * a10;
      world.m11 = b10 * a01 + b11 * a11;
      world.m12 = b10 * a02 + b11 * a12 + b12;

      return this;
    },

    _accessor: {
      /**
       * @property    x
       * x座標値
       */
      x: {
        "get": function()   { return this.position.x; },
        "set": function(v)  { this.position.x = v; }
      },
      /**
       * @property    y
       * y座標値
       */
      y: {
        "get": function()   { return this.position.y; },
        "set": function(v)  { this.position.y = v; }
      },

      /**
       * @property    originX
       * x座標値
       */
      originX: {
        "get": function()   { return this.origin.x; },
        "set": function(v)  { this.origin.x = v; }
      },
      
      /**
       * @property    originY
       * y座標値
       */
      originY: {
        "get": function()   { return this.origin.y; },
        "set": function(v)  { this.origin.y = v; }
      },
      
      /**
       * @property    scaleX
       * スケールX値
       */
      scaleX: {
        "get": function()   { return this.scale.x; },
        "set": function(v)  { this.scale.x = v; }
      },
      
      /**
       * @property    scaleY
       * スケールY値
       */
      scaleY: {
        "get": function()   { return this.scale.y; },
        "set": function(v)  { this.scale.y = v; }
      },
      
      /**
       * @property    width
       * width
       */
      width: {
        "get": function()   {
          return (this.boundingType === 'rect') ?
            this._width : this._diameter;
        },
        "set": function(v)  { this._width = v; }
      },
      /**
       * @property    height
       * height
       */
      height: {
        "get": function()   {
          return (this.boundingType === 'rect') ?
            this._height : this._diameter;
        },
        "set": function(v)  { this._height = v; }
      },

      /**
       * @property    radius
       * 半径
       */
      radius: {
        "get": function()   {
          return (this.boundingType === 'rect') ?
            (this.width+this.height)/4 : this._radius;
        },
        "set": function(v)  {
          this._radius = v;
          this._diameter = v*2;
        },
      },
      
      /**
       * @property    top
       * 左
       */
      top: {
        "get": function()   { return this.y - this.height*this.originY; },
        "set": function(v)  { this.y = v + this.height*this.originY; },
      },
   
      /**
       * @property    right
       * 左
       */
      right: {
        "get": function()   { return this.x + this.width*(1-this.originX); },
        "set": function(v)  { this.x = v - this.width*(1-this.originX); },
      },
   
      /**
       * @property    bottom
       * 左
       */
      bottom: {
        "get": function()   { return this.y + this.height*(1-this.originY); },
        "set": function(v)  { this.y = v - this.height*(1-this.originY); },
      },
   
      /**
       * @property    left
       * 左
       */
      left: {
        "get": function()   { return this.x - this.width*this.originX; },
        "set": function(v)  { this.x = v + this.width*this.originX; },
      },

      /**
       * @property    centerX
       * centerX
       */
      centerX: {
        "get": function()   { return this.x + this.width/2 - this.width*this.originX; },
        "set": function(v)  {
          // TODO: どうしようかな??
        }
      },
   
      /**
       * @property    centerY
       * centerY
       */
      centerY: {
        "get": function()   { return this.y + this.height/2 - this.height*this.originY; },
        "set": function(v)  {
          // TODO: どうしようかな??
        }
      },
    },
    _static: {
      defaults: {
        x: 0,
        y: 0,
        scaleX: 1,
        scaleY: 1,
        rotation: 0,
        originX: 0.5,
        originY: 0.5,
        
        width: 64,
        height: 64,
        radius: 32,
        boundingType: 'rect',
      },
    },

  });

  
});

phina.namespace(function() {

  /**
   * @class phina.app.Scene
   * @extends phina.app.Element
   */
  phina.define('phina.app.Scene', {
    superClass: 'phina.app.Element',

    init: function() {
      this.superInit();
    },

    exit: function(nextLabel, nextArguments) {
      if (!this.app) return ;

      if (arguments.length > 0) {
        if (typeof arguments[0] === 'object') {
          nextLabel = arguments[0].nextLabel || this.nextLabel;
          nextArguments = arguments[0];
        }

        this.nextLabel = nextLabel;
        this.nextArguments = nextArguments;
      }

      this.app.popScene();

      return this;
    },
  });
  
});


phina.namespace(function() {

  /**
   * @class phina.accessory.Accessory
   * @extends phina.util.EventDispatcher
   */
  phina.define('phina.accessory.Accessory', {
    superClass: 'phina.util.EventDispatcher',

    /**
     * @constructor
     */
    init: function(target) {
      this.superInit();

      this.target = target;
    },
    setTarget: function(target) {
      if (this.target === target) return ;

      this.target = target;
      return this;
    },
    getTarget: function() {
      return this.target;
    },
    isAttached: function() {
      return !!this.target;
    },
    attachTo: function(element) {
      element.attach(this);
      this.setTarget(element);
      return this;
    },
    remove: function() {
      this.target.detach(this);
      this.target = null;
    },
  });

  phina.app.Element.prototype.$method('attach', function(accessory) {
    if (!this.accessories) {
      this.accessories = [];
      this.on('enterframe', function(e) {
        this.accessories.each(function(accessory) {
          accessory.update && accessory.update(e.app);
        });
      });
    }

    this.accessories.push(accessory);
    accessory.setTarget(this);
    accessory.flare('attached');

    return this;
  });

  phina.app.Element.prototype.$method('detach', function(accessory) {
    if (this.accessories) {
      this.accessories.erase(accessory);
      accessory.setTarget(null);
      accessory.flare('detached');
    }

    return this;
  });

});






phina.namespace(function() {

  /**
   * @class phina.accessory.Tweener
   * # Tweener
   * Tweenerはオブジェクトのプロパティに対して、
   * Tweenアニメーションの効果を与えるクラスです。  
   * 主に {@link phina.app.Element} とそのサブクラスで使用されます。
   * @extends phina.accessory.Accessory
   */
  var Tweener = phina.define('phina.accessory.Tweener', {
    superClass: 'phina.accessory.Accessory',
    
    /**
     * アニメーションを更新する方法を指定します。  
     * 変更するとdurationによる時間の進み方が変わります。  
     * 詳しくは{@link #UPDATE_MAP}を参照してください。
     */
    updateType: 'delta',

    timeScale: 1.0,

    /**
     * @constructor
     */
    init: function(target) {
      this.superInit(target);

      this._init();
    },

    _init: function() {
      this._loop = false;
      this._tasks = [];
      this._index = 0;
      this.playing = true;
      this._update = this._updateTask;
    },

    /**
     * @param {phina.app.BaseApp} app
     */
    update: function(app) {
      this._update(app);
    },

    /**
     * {@link #updateType}を変更します。
     * @param {String} type 更新方法を表す文字列
     * @chainable
     */
    setUpdateType: function(type) {
      this.updateType = type;
      return this;
    },

    /**
     * propsで指定した値になるまで、durationで指定した時間をかけて、アニメーションさせます。
     * @param {Object} props 変更したいプロパティをkeyとしたオブジェクト
     * @param {Number} duration (optional) アニメーションにかける時間
     * @param {String} easing (optional) easing {@link phina.util.Tween#EASING}を参照してください。
     * @chainable
     * 
     */
    to: function(props, duration, easing) {
      this._add({
        type: 'tween',
        mode: 'to',
        props: props,
        duration: duration,
        easing: easing,
      });
      return this;
    },

    /**
     * アニメーション開始時の値とpropsで指定した値を加算した値になるまで、durationで指定した時間をかけて、アニメーションさせます。
     * @param {Object} props 変更したいプロパティをkeyとしたオブジェクト
     * @param {Number} duration (optional) アニメーションにかける時間
     * @param {String} easing (optional) easing {@link phina.util.Tween#EASING}を参照してください。
     * @chainable
     */
    by: function(props, duration, easing) {
      this._add({
        type: 'tween',
        mode: 'by',
        props: props,
        duration: duration,
        easing: easing,
      });

      return this;
    },

    /**
     * propsで指定した値からアニメーション開始時の値になるまで、durationで指定した時間をかけて、アニメーションさせます。
     * @param {Object} props 変更したいプロパティをkeyとしたオブジェクト
     * @param {Number} duration (optional) アニメーションにかける時間
     * @param {String} easing (optional) easing {@link phina.util.Tween#EASING}を参照してください。
     * @chainable
     */
    from: function(props, duration, easing) {
      this._add({
        type: 'tween',
        mode: 'from',
        props: props,
        duration: duration,
        easing: easing,
      });
      return this;
    },

    /**
     * 指定した時間が経過するまで待機します。
     * @param {Number} time waitする時間
     * @chainable
     */
    wait: function(time) {
      this._add({
        type: 'wait',
        data: {
          limit: time,
        },
      });
      return this;
    },

    /**
     * 現在設定されているアニメーションが終了した時に呼び出される関数をセットします。
     * @param {Function} func 呼び出される関数
     * @param {Object} self (optional) func内でthisにしたいオブジェクト。
     * @param {Object[]} args (optional) funcの引数にしたい値
     * @chainable
     */
    call: function(func, self, args) {
      this._add({
        type: 'call',
        data: {
          func: func,
          self: self || this,
          args: args,
        },
      });
      return this;
    },

    /**
     * 現在設定されているアニメーションが終了した時にプロパティをセットします。  
     * 第一引数にオブジェクトをセットすることもできます。
     * @param {String | Object} key valueをセットするプロパティ名か、変更したいプロパティをkeyとしたオブジェクト。
     * @param {Object} value (optional) セットする値
     * @chainable
     */
    set: function(key, value) {
      var values = null;
      if (arguments.length == 2) {
        values = {};
        values[key] = value;
      }
      else {
        values = key;
      }
      this._tasks.push({
        type: "set",
        data: {
          values: values
        }
      });

      return this;
    },

    /**
     * x, yに対して、 {@link #to} の処理を行います。
     * @param {Number} x
     * @param {Number} y
     * @param {Number} duration (optional) アニメーションにかける時間
     * @param {String} easing (optional) easing {@link phina.util.Tween#EASING}を参照してください。
     * @chainable
     */
    moveTo: function(x, y, duration, easing) {
      return this.to({ x: x, y: y }, duration, easing);
    },
    
    /**
     * x, yに対して、 {@link #by} の処理を行います。
     * @param {Number} x
     * @param {Number} y
     * @param {Number} duration (optional) アニメーションにかける時間
     * @param {String} easing (optional) easing {@link phina.util.Tween#EASING}を参照してください。
     * @chainable
     */
    moveBy: function(x, y, duration, easing) {
      return this.by({ x: x, y: y }, duration, easing);
    },

    /**
     * rotationに対して、 {@link #to} の処理を行います。
     * @param {Number} rotation
     * @param {Number} duration (optional) アニメーションにかける時間
     * @param {String} easing (optional) easing {@link phina.util.Tween#EASING}を参照してください。
     * @chainable
     */
    rotateTo: function(rotation, duration, easing) {
      return this.to({ rotation: rotation }, duration, easing);
    },
    
    /**
     * rotationに対して、 {@link #by} の処理を行います。
     * @param {Number} rotation
     * @param {Number} duration (optional) アニメーションにかける時間
     * @param {String} easing (optional) easing {@link phina.util.Tween#EASING}を参照してください。
     * @chainable
     */
    rotateBy: function(rotation, duration, easing) {
      return this.by({ rotation: rotation }, duration, easing);
    },

    /**
     * scaleX, scaleYに対して {@link #to} の処理を行います。
     * @param {Number} scale scaleXとscaleYに設定する値
     * @param {Number} duration (optional) アニメーションにかける時間
     * @param {String} easing (optional) easing {@link phina.util.Tween#EASING}を参照してください。
     * @chainable
     */
    scaleTo: function(scale, duration, easing) {
      return this.to({ scaleX: scale, scaleY: scale }, duration, easing);
    },
    /**
     * scaleX, scaleYに対して {@link #by} の処理を行います。
     * @param {Number} scale scaleXとscaleYに設定する値
     * @param {Number} duration (optional) アニメーションにかける時間
     * @param {String} easing (optional) easing {@link phina.util.Tween#EASING}を参照してください。
     * @chainable
     */
    scaleBy: function(scale, duration, easing) {
      return this.by({ scaleX: scale, scaleY: scale }, duration, easing);
    },

    /**
     * alphaに対して {@link #to} の処理を行います。
     * @param {Number} value alphaに設定する値
     * @param {Number} duration (optional) アニメーションにかける時間
     * @param {String} easing (optional) easing {@link phina.util.Tween#EASING}を参照してください。
     * @chainable
     */
    fade: function(value, duration, easing) {
      return this.to({ alpha: value }, duration, easing);
    },

    /**
     * alphaを0にするアニメーションを設定します。
     * @param {Number} duration (optional) アニメーションにかける時間
     * @param {String} easing (optional) easing {@link phina.util.Tween#EASING}を参照してください。
     * @chainable
     */
    fadeOut: function(duration, easing) {
      return this.fade(0.0, duration, easing);
    },

    /**
     * alphaを1にするアニメーションを設定します。
     * @param {Number} duration (optional) アニメーションにかける時間
     * @param {String} easing (optional) easing {@link phina.util.Tween#EASING}を参照してください。
     * @chainable
     */
    fadeIn: function(duration, easing) {
      return this.fade(1.0, duration, easing);
    },

    /**
     * アニメーション開始
     * @chainable
     */
    play: function() {
      this.playing = true;
      return this;
    },

    /**
     * アニメーションを一時停止
     * @chainable
     */
    pause: function() {
      this.playing = false;
      return this;
    },

    /**
     * アニメーションを停止し、最初まで巻き戻します。
     * @chainable
     */
    stop: function() {
      this.playing = false;
      this.rewind();
      return this;
    },

    /**
     * アニメーションを巻き戻す
     * @chainable
     */
    rewind: function() {
      this._update = this._updateTask;
      this._index = 0;
      return this;
    },

    yoyo: function() {
      // TODO: 最初の値が分からないので反転できない...
      this._update = this._updateTask;
      this._index = 0;
      this._tasks.each(function(task) {
        if (task.type === 'tween') {

        }
      });
      this.play();

      return this;
    },

    /**
     * アニメーションループ設定
     * @param {Boolean} flag
     * @chainable
     */
    setLoop: function(flag) {
      this._loop = flag;
      return this;
    },

    /**
     * アニメーションをクリア
     * @chainable
     */
    clear: function() {
      this._init();
      return this;
    },

    /**
     * 登録されたタスクをすべて完了する
     * ループ設定されている場合は先頭から再開
     */
    finish: function() {
      var _loop = this._loop;
      var _updateType = this.updateType;
      var _playing = this.playing;

      this._loop = false;
      this.updateType = "finish";

      this.playing = true;
      while (this.playing) {
        this._update(null);
      }

      this._loop = _loop;
      this.updateType = _updateType;
      this.playing = _playing;

      if (this._loop) {
        this.rewind();
        if (this.playing) {
          this.play();
        }
      }

      return this;
    },

    /**
     * JSON形式でアニメーションを設定します。
     * @chainable
     * @param {Object} json
     * @param {Boolean} json.loop (optional) ループする場合true
     * @param {Array[]} json.tweens 設定するアニメーション
     * 
     * ```
     * [
     *   [method, arg1, arg2,,,],
     *   ['to', {value: 100}, 1000, 'swing'],
     *   ['wait', 1000],
     *   ['set', 'text', 'END']
     * ]
     * ```
     */
    fromJSON: function(json) {
      if (json.loop !== undefined) {
        this.setLoop(json.loop);
      }

      json.tweens.each(function(t) {
        t = t.clone();
        var method = t.shift();
        this[method].apply(this, t);
      }, this);

      return this;
    },

    _add: function(params) {
      this._tasks.push(params);
    },

    _updateTask: function(app) {
      if (!this.playing) return ;

      var task = this._tasks[this._index];
      if (!task) {
        if (this._loop) {
          this.rewind();
          this._update(app);
        }
        else {
          this.playing = false;
        }
        return ;
      }
      else {
        ++this._index;
      }

      if (task.type === 'tween') {
        this._tween = phina.util.Tween();

        var duration = task.duration || this._getDefaultDuration();
        if (task.mode === 'to') {
          this._tween.to(this.target, task.props, duration, task.easing);
        }
        else if (task.mode === 'by') {
          this._tween.by(this.target, task.props, duration, task.easing);
        }
        else {
          this._tween.from(this.target, task.props, duration, task.easing);
        }
        this._update = this._updateTween;
        this._update(app);
      }
      else if (task.type === 'wait') {
        this._wait = {
          time: 0,
          limit: task.data.limit,
        };

        this._update = this._updateWait;
        this._update(app);
      }
      else if (task.type === 'call') {
        task.data.func.apply(task.data.self, task.data.args);
        // 1フレーム消費しないよう再帰
        this._update(app);
      }
      else if (task.type === 'set') {
        this.target.$extend(task.data.values);
        // 1フレーム消費しないよう再帰
        this._update(app);
      }
    },

    _updateTween: function(app) {
      var tween = this._tween;
      var time = this._getUnitTime(app);

      tween.forward(time);
      this.flare('tween');

      if (tween.time >= tween.duration) {
        delete this._tween;
        this._tween = null;
        this._update = this._updateTask;
      }
    },

    _updateWait: function(app) {
      var wait = this._wait;
      var time = this._getUnitTime(app);
      wait.time += time;

      if (wait.time >= wait.limit) {
        delete this._wait;
        this._wait = null;
        this._update = this._updateTask;
      }
    },

    _getUnitTime: function(app) {
      var obj = UPDATE_MAP[this.updateType];
      if (obj) {
        return obj.func(app) * this.timeScale;
      }
      else {
        return 1000 / app.fps * this.timeScale;
      }
    },

    _getDefaultDuration: function() {
      var obj = UPDATE_MAP[this.updateType];
      return obj && obj.duration;
    },

    _static: {
      /**
       * @static
       * {@link #updateType}に設定する更新方法の定義です。
       * 下記の表に定義済みの更新方法を{@link #updateType}に設定することで、
       * アニメーションの更新方法を変更することができます。
       * 
       * | 更新方法 | 単位(デフォルト値) | 1フレームあたりのアニメーション速度 |
       * |-|-|-|
       * | normal | ミリ秒(1000) | app.fpsによって変化 |
       * | delta | ミリ秒(1000) | 経過時間によって変化 |
       * | fps | フレーム(30) | 必ず同じ速度で変化 |
       */
      UPDATE_MAP: {
        normal: {
          func: function(app) {
            return 1000 / app.fps;
          },
          duration: 1000,
        },

        delta: {
          func: function(app) {
            return app.ticker.deltaTime;
          },
          duration: 1000,
        },

        fps: {
          func: function(app) {
            return 1;
          },
          duration: 30,
        },

        finish: {
          func: function(app) {
            return Infinity;
          },
          duration: 1,
        },

      }
    }
  });

  var UPDATE_MAP = Tweener.UPDATE_MAP;

  /**
   * @member phina.app.Element
   * @property tweener
   * 自身にアタッチ済みの{@link phina.accessory.Tweener}オブジェクト。
   */
  phina.app.Element.prototype.getter('tweener', function() {
    if (!this._tweener) {
      this._tweener = phina.accessory.Tweener().attachTo(this);
    }
    return this._tweener;
  });
  
});



phina.namespace(function() {

  /**
   * @class phina.accessory.Draggable
   * Draggable
   * @extends phina.accessory.Accessory
   */
  phina.define('phina.accessory.Draggable', {
    superClass: 'phina.accessory.Accessory',

    /**
     * @constructor
     */
    init: function(target) {
      this.superInit(target);

      this.initialPosition = phina.geom.Vector2(0, 0);
      var self = this;

      this.on('attached', function() {
        this.target.setInteractive(true);

        this._dragging = false;

        this.target.on('pointstart', function(e) {
          if (phina.accessory.Draggable._lock) return ;

          this._dragging = true;
          self.initialPosition.x = this.x;
          self.initialPosition.y = this.y;
          self.flare('dragstart');
          this.flare('dragstart');
        });
        this.target.on('pointmove', function(e) {
          if (!this._dragging) return ;

          this.x += e.pointer.dx;
          this.y += e.pointer.dy;
          self.flare('drag');
          this.flare('drag');
        });

        this.target.on('pointend', function(e) {
          if (!this._dragging) return ;

          this._dragging = false;
          self.flare('dragend');
          this.flare('dragend');
        });
      });
    },

    back: function(time, easing) {
      if (time) {
        var t = this.target;
        t.setInteractive(false);
        var tweener = phina.accessory.Tweener().attachTo(t);
        tweener
          .to({
            x: this.initialPosition.x,
            y: this.initialPosition.y,
          }, time, easing || 'easeOutElastic')
          .call(function() {
            tweener.remove();

            t.setInteractive(true);
            this.flare('backend');
          }, this);
      }
      else {
        this.target.x = this.initialPosition.x;
        this.target.y = this.initialPosition.y;
        this.flare('backend');
      }
    },

    enable: function() {
      this._enable = true;
    },

    _static: {
      _lock: false,
      lock: function() {
        this._lock = true;
      },
      unlock: function() {
        this._lock = false;
      },
    }

  });

  phina.app.Element.prototype.getter('draggable', function() {
    if (!this._draggable) {
      this._draggable = phina.accessory.Draggable().attachTo(this);
    }
    return this._draggable;
  });
  
});



phina.namespace(function() {

  /**
   * @class phina.accessory.Flickable
   * Flickable
   * @extends phina.accessory.Accessory
   */
  phina.define('phina.accessory.Flickable', {
    superClass: 'phina.accessory.Accessory',

    /**
     * @constructor
     */
    init: function(target) {
      this.superInit(target);

      this.initialPosition = phina.geom.Vector2(0, 0);
      var self = this;

      this.friction = 0.9;
      this.velocity = phina.geom.Vector2(0, 0);
      this.vertical = true;
      this.horizontal = true;

      this.cacheList = [];

      this.on('attached', function() {
        this.target.setInteractive(true);

        this.target.on('pointstart', function(e) {
          self.initialPosition.set(this.x, this.y);
          self.velocity.set(0, 0);
        });
        this.target.on('pointstay', function(e) {
          if (self.horizontal) {
            this.x += e.pointer.dx;
          }
          if (self.vertical) {
            this.y += e.pointer.dy;
          }

          if (self.cacheList.length > 3) self.cacheList.shift();
          self.cacheList.push(e.pointer.deltaPosition.clone());
        });

        this.target.on('pointend', function(e) {
          // 動きのある delta position を後ろから検索　
          var delta = self.cacheList.reverse().find(function(v) {
            return v.lengthSquared() > 10;
          });
          self.cacheList.clear();

          if (delta) {
            self.velocity.x = delta.x;
            self.velocity.y = delta.y;

            self.flare('flickstart', {
              direction: delta.normalize(),
            });
          }
          else {
            self.flare('flickcancel');
          }

          // self.flare('flick');
          // self.flare('flickend');
        });
      });
    },

    update: function() {
      if (!this.target) return ;

      this.velocity.x *= this.friction;
      this.velocity.y *= this.friction;

      if (this.horizontal) {
        this.target.position.x += this.velocity.x;
      }
      if (this.vertical) {
        this.target.position.y += this.velocity.y;
      }
    },

    cancel: function() {
      this.target.x = this.initialPosition.x;
      this.target.y = this.initialPosition.y;
      this.velocity.set(0, 0);

      // TODO: 
      // this.setInteractive(false);
      // this.tweener.clear()
      //     .move(this.initialX, this.initialY, 500, "easeOutElastic")
      //     .call(function () {
      //         this.setInteractive(true);
      //         this.fire(tm.event.Event("backend"));
      //     }.bind(this));
    },

    enable: function() {
      this._enable = true;
    },

  });

  phina.app.Element.prototype.getter('flickable', function() {
    if (!this._flickable) {
      this._flickable = phina.accessory.Flickable().attachTo(this);
    }
    return this._flickable;
  });
  
});
/*
 * frameanimation.js
 */


phina.namespace(function() {

  /**
   * @class phina.accessory.FrameAnimation
   * FrameAnimation
   * @extends phina.accessory.Accessory
   */
  phina.define('phina.accessory.FrameAnimation', {
    superClass: 'phina.accessory.Accessory',

    /**
     * @constructor
     */
    init: function(ss) {
      this.superInit();

      this.ss = phina.asset.AssetManager.get('spritesheet', ss);
      this.paused = true;
      this.finished = false;
      this.fit = true;
    },

    update: function() {
      if (this.paused) return ;
      if (!this.currentAnimation) return ;

      if (this.finished) {
        this.finished = false;
        this.currentFrameIndex = 0;
        return ;
      }

      ++this.frame;
      if (this.frame%this.currentAnimation.frequency === 0) {
        ++this.currentFrameIndex;
        this._updateFrame();
      }
    },

    gotoAndPlay: function(name, keep) {
      keep = (keep !== undefined) ? keep : true;
      if (keep && name === this.currentAnimationName
               && this.currentFrameIndex < this.currentAnimation.frames.length
               && !this.paused) {
        return this;
      }
      this.currentAnimationName = name;
      this.frame = 0;
      this.currentFrameIndex = 0;
      this.currentAnimation = this.ss.getAnimation(name);
      this._updateFrame();

      this.paused = false;

      return this;
    },

    gotoAndStop: function(name) {
      this.currentAnimationName = name;
      this.frame = 0;
      this.currentFrameIndex = 0;
      this.currentAnimation = this.ss.getAnimation(name);
      this._updateFrame();

      this.paused = true;

      return this;
    },

    _updateFrame: function() {
      var anim = this.currentAnimation;
      if (anim) {
        if (this.currentFrameIndex >= anim.frames.length) {
          if (anim.next) {
            this.gotoAndPlay(anim.next);
            return ;
          }
          else {
            this.paused = true;
            this.finished = true;
            return ;
          }
        }
      }

      var index = anim.frames[this.currentFrameIndex];
      var frame = this.ss.getFrame(index);
      this.target.srcRect.set(frame.x, frame.y, frame.width, frame.height);

      if (this.fit) {
        this.target.width = frame.width;
        this.target.height = frame.height;
      }
    },
  });
});
/*
 *
 */


phina.namespace(function() {

  /**
   * @class phina.accessory.Physical
   * 本物ではないので名前変えるかも
   * FakePhysical or MarioPhysical or LiePhysical
   * RetroPysical or PysicaLike
   * @extends phina.accessory.Accessory
   */
  phina.define('phina.accessory.Physical', {
    superClass: 'phina.accessory.Accessory',

    /**
     * @constructor
     */
    init: function(target) {
      this.superInit(target);

      this.velocity = phina.geom.Vector2(0, 0);
      this.gravity = phina.geom.Vector2(0, 0);

      this.friction = 1.0;
    },

    update: function() {
      var t = this.target;

      this.velocity.x *= this.friction;
      this.velocity.y *= this.friction;

      this.velocity.x += this.gravity.x;
      this.velocity.y += this.gravity.y;

      t.position.x += this.velocity.x;
      t.position.y += this.velocity.y;
    },

    force: function(x, y) {
      this.velocity.set(x, y);
      return this;
    },

    addForce: function(x, y) {
      this.velocity.x += x;
      this.velocity.y += y;
      return this;
    },

    setGravity: function(x, y) {
      this.gravity.set(x, y);
      return this;
    },

    setFriction: function(fr) {
      this.friction = fr;
      return this;
    },
  });

  phina.app.Element.prototype.getter('physical', function() {
    if (!this._physical) {
      this._physical = phina.accessory.Physical().attachTo(this);
    }
    return this._physical;
  });


});





(function() {

  if (!phina.global.Event) return ;

  /**
   * @class global.Event
   * 既存のEventオブジェクト拡張
   */
    
  /**
   * @method stop
   * イベントのデフォルト処理 & 伝達を止める
   */
  Event.prototype.stop = function() {
    // イベントキャンセル
    this.preventDefault();
    // イベント伝達を止める
    this.stopPropagation();
  };

})();

(function() {

  if (!phina.global.MouseEvent) return ;

  /**
   * @class global.MouseEvent
   * MouseEvent クラス
   */
  
  /**
   * @method    pointX
   * マウスのX座標.
   */
  MouseEvent.prototype.getter("pointX", function() {
    return this.clientX - this.target.getBoundingClientRect().left;
    // return this.pageX - this.target.getBoundingClientRect().left - window.scrollX;
  });
  
  /**
   * @method    pointY
   * マウスのY座標.
   */
  MouseEvent.prototype.getter("pointY", function() {
    return this.clientY - this.target.getBoundingClientRect().top;
    // return this.pageY - this.target.getBoundingClientRect().top - window.scrollY;
  });
    
})();


(function() {
    
  if (!phina.global.TouchEvent) return ;
  
  
  /**
   * @class global.TouchEvent
   * TouchEvent クラス
   */
  
  /**
   * @method    pointX
   * タッチイベント.
   */
  TouchEvent.prototype.getter("pointX", function() {
      return this.touches[0].clientX - this.target.getBoundingClientRect().left;
      // return this.touches[0].pageX - this.target.getBoundingClientRect().left - tm.global.scrollX;
  });
  
  /**
   * @method    pointY
   * タッチイベント.
   */
  TouchEvent.prototype.getter("pointY", function() {
      return this.touches[0].clientY - this.target.getBoundingClientRect().top;
      // return this.touches[0].pageY - this.target.getBoundingClientRect().top - tm.global.scrollY;
  });  
    
})();


(function() {
    
  if (!phina.global.Touch) return ;
  
  /**
   * @class global.Touch
   * TouchEvent クラス
   */
  
  /**
   * @method    pointX
   * タッチイベント.
   */
  Touch.prototype.getter("pointX", function() {
      return this.clientX - this.target.getBoundingClientRect().left;
  });

  /**
   * @method    pointY
   * タッチイベント.
   */
  Touch.prototype.getter("pointY", function() {
      return this.clientY - this.target.getBoundingClientRect().top;
  });
    
})();


phina.namespace(function() {

  /**
   * @class phina.graphics.Canvas
   * キャンバス拡張クラス
   */
  phina.define('phina.graphics.Canvas', {
    domElement: null,
    canvas: null,
    context: null,

    /**
     * 初期化
     */
    init: function(canvas) {
      if (typeof canvas === 'string') {
        this.canvas = document.querySelector(canvas);
      }
      else {
        this.canvas = canvas || document.createElement('canvas');
      }

      this.domElement = this.canvas;
      this.context = this.canvas.getContext('2d');
      this.context.lineCap = 'round';
      this.context.lineJoin = 'round';
    },

    /**
     * サイズをセット
     */
    setSize: function(width, height) {
      this.canvas.width   = width;
      this.canvas.height  = height;
      return this;
    },

    setSizeToScreen: function() {
      this.canvas.style.position  = "fixed";
      this.canvas.style.margin    = "0px";
      this.canvas.style.padding   = "0px";
      this.canvas.style.left      = "0px";
      this.canvas.style.top       = "0px";
      return this.setSize(window.innerWidth, window.innerHeight);
    },

    fitScreen: function(isEver) {
      isEver = isEver === undefined ? true : isEver;

      var _fitFunc = function() {
        var e = this.domElement;
        var s = e.style;
        
        s.position = "absolute";
        s.margin = "auto";
        s.left = "0px";
        s.top  = "0px";
        s.bottom = "0px";
        s.right = "0px";

        var rateWidth = e.width/window.innerWidth;
        var rateHeight= e.height/window.innerHeight;
        var rate = e.height/e.width;
        
        if (rateWidth > rateHeight) {
          s.width  = Math.floor(innerWidth)+"px";
          s.height = Math.floor(innerWidth*rate)+"px";
        }
        else {
          s.width  = Math.floor(innerHeight/rate)+"px";
          s.height = Math.floor(innerHeight)+"px";
        }
      }.bind(this);
      
      // 一度実行しておく
      _fitFunc();

      // リサイズ時のリスナとして登録しておく
      if (isEver) {
        phina.global.addEventListener("resize", _fitFunc, false);
      }
    },

    /**
     * クリア
     */
    clear: function(x, y, width, height) {
      x = x || 0;
      y = y || 0;
      width = width || this.width;
      height= height|| this.height;
      this.context.clearRect(x, y, width, height);
      return this;
    },

    clearColor: function(fillStyle, x, y, width, height) {
      x = x || 0;
      y = y || 0;
      width = width || this.width;
      height= height|| this.height;

      var context = this.context;

      context.save();
      context.setTransform(1.0, 0.0, 0.0, 1.0, 0.0, 0.0); // 行列初期化
      context.fillStyle = fillStyle;     // 塗りつぶしスタイルセット
      context.fillRect(x, y, width, height);
      context.restore();

      return this;
    },


    /**
     * パスを開始(リセット)
     */
    beginPath: function() {
      this.context.beginPath();
      return this;
    },

    /**
     *  パスを閉じる
     */
    closePath: function() {
      this.context.closePath();
      return this;
    },


    /**
     *  新規パス生成
     */
    moveTo: function(x, y) {
      this.context.moveTo(x, y);
      return this;
    },

    /**
     * パスに追加
     */
    lineTo: function(x, y) {
      this.context.lineTo(x, y);
      return this;
    },

    quadraticCurveTo: function() {
      this.context.quadraticCurveTo.apply(this.context, arguments);
      return this;
    },

    bezierCurveTo: function() {
      this.context.bezierCurveTo.apply(this.context, arguments);
      return this;
    },

    /**
     * パス内を塗りつぶす
     */
    fill: function() {
      this.context.fill();
      return this;
    },

    /**
     * パス上にラインを引く
     */
    stroke: function() {
      this.context.stroke();
      return this;
    },

    /**
     * クリップ
     */
    clip: function() {
      this.context.clip();
      return this;
    },

        
    /**
     * 点描画
     */
    drawPoint: function(x, y) {
      return this.strokeRect(x, y, 1, 1);
    },

    /**
     * ラインパスを作成
     */
    line: function(x0, y0, x1, y1) {
      return this.moveTo(x0, y0).lineTo(x1, y1);
    },
    
    /**
     * ラインを描画
     */
    drawLine: function(x0, y0, x1, y1) {
      return this.beginPath().line(x0, y0, x1, y1).stroke();
    },

    /**
     * ダッシュラインを描画
     */
    drawDashLine: function(x0, y0, x1, y1, pattern) {
      var patternTable = null;
      if (typeof(pattern) == "string") {
        patternTable = pattern;
      }
      else {
        pattern = pattern || 0xf0f0;
        patternTable = pattern.toString(2);
      }
      patternTable = patternTable.padding(16, '1');
      
      var vx = x1-x0;
      var vy = y1-y0;
      var len = Math.sqrt(vx*vx + vy*vy);
      vx/=len; vy/=len;
      
      var x = x0;
      var y = y0;
      for (var i=0; i<len; ++i) {
        if (patternTable[i%16] == '1') {
          this.drawPoint(x, y);
          // this.fillRect(x, y, this.context.lineWidth, this.context.lineWidth);
        }
        x += vx;
        y += vy;
      }
      
      return this;
    },

    /**
     * v0(x0, y0), v1(x1, y1) から角度を求めて矢印を描画
     * http://hakuhin.jp/as/rotation.html
     */
    drawArrow: function(x0, y0, x1, y1, arrowRadius) {
      var vx = x1-x0;
      var vy = y1-y0;
      var angle = Math.atan2(vy, vx)*180/Math.PI;
      
      this.drawLine(x0, y0, x1, y1);
      this.fillPolygon(x1, y1, arrowRadius || 5, 3, angle);
      
      return this;
    },


    /**
     * lines
     */
    lines: function() {
      this.moveTo(arguments[0], arguments[1]);
      for (var i=1,len=arguments.length/2; i<len; ++i) {
        this.lineTo(arguments[i*2], arguments[i*2+1]);
      }
      return this;
    },

    /**
     * ラインストローク描画
     */
    strokeLines: function() {
      this.beginPath();
      this.lines.apply(this, arguments);
      this.stroke();
      return this;
    },

    /**
     * ライン塗りつぶし描画
     */
    fillLines: function() {
      this.beginPath();
      this.lines.apply(this, arguments);
      this.fill();
      return this;
    },
    
    /**
     * 四角形パスを作成する
     */
    rect: function(x, y, width, height) {
      this.context.rect.apply(this.context, arguments);
      return this;
    },
    
    /**
     * 四角形塗りつぶし描画
     */
    fillRect: function() {
      this.context.fillRect.apply(this.context, arguments);
      return this;
    },
    
    /**
     * 四角形ライン描画
     */
    strokeRect: function() {
      this.context.strokeRect.apply(this.context, arguments);
      return this;
    },
    
    /**
     * 角丸四角形パス
     */
    roundRect: function(x, y, width, height, radius) {
      var l = x + radius;
      var r = x + width - radius;
      var t = y + radius;
      var b = y + height - radius;
      
      /*
      var ctx = this.context;
      ctx.moveTo(l, y);
      ctx.lineTo(r, y);
      ctx.quadraticCurveTo(x+width, y, x+width, t);
      ctx.lineTo(x+width, b);
      ctx.quadraticCurveTo(x+width, y+height, r, y+height);
      ctx.lineTo(l, y+height);
      ctx.quadraticCurveTo(x, y+height, x, b);
      ctx.lineTo(x, t);
      ctx.quadraticCurveTo(x, y, l, y);
      /**/
      
      this.context.arc(l, t, radius,     -Math.PI, -Math.PI*0.5, false);  // 左上
      this.context.arc(r, t, radius, -Math.PI*0.5,            0, false);  // 右上
      this.context.arc(r, b, radius,            0,  Math.PI*0.5, false);  // 右下
      this.context.arc(l, b, radius,  Math.PI*0.5,      Math.PI, false);  // 左下
      this.closePath();
      
      return this;
    },

    /**
     * 角丸四角形塗りつぶし
     */
    fillRoundRect: function(x, y, width, height, radius) {
      return this.beginPath().roundRect(x, y, width, height, radius).fill();
    },

    /**
     * 角丸四角形ストローク描画
     */
    strokeRoundRect: function(x, y, width, height, radius) {
      return this.beginPath().roundRect(x, y, width, height, radius).stroke();
    },

    /**
     * 円のパスを設定
     */
    circle: function(x, y, radius) {
      this.context.arc(x, y, radius, 0, Math.PI*2, false);
      return this;
    },
    
    /**
     * 塗りつぶし円を描画
     */
    fillCircle: function(x, y, radius) {
      var c = this.context;
      c.beginPath();
      c.arc(x, y, radius, 0, Math.PI*2, false);
      c.closePath();
      c.fill();
      return this;
    },
    
    /**
     * ストローク円を描画
     */
    strokeCircle: function(x, y, radius) {
      var c = this.context;
      c.beginPath();
      c.arc(x, y, radius, 0, Math.PI*2, false);
      c.closePath();
      c.stroke();
      return this;
    },

    /**
     * 円弧のパスを設定
     */
    arc: function(x, y, radius, startAngle, endAngle, anticlockwise) {
      this.context.arc(x, y, radius, startAngle, endAngle, anticlockwise);
      return this;
    },
    
    /**
     * 塗りつぶし円弧を描画
     */
    fillArc: function(x, y, radius, startAngle, endAngle, anticlockwise) {
      return this.beginPath().arc(x, y, radius, startAngle, endAngle, anticlockwise).fill();
    },
    
    /**
     * ストローク円弧を描画
     */
    strokeArc: function(x, y, radius, startAngle, endAngle, anticlockwise) {
      return this.beginPath().arc(x, y, radius, startAngle, endAngle, anticlockwise).stroke();
    },


    pie: function(x, y, radius, startAngle, endAngle, anticlockwise) {
      var context = this.context;
      context.beginPath();
      context.moveTo(0, 0);
      context.arc(x, y, radius, startAngle, endAngle, anticlockwise);
      context.closePath();
      return this;
    },
    fillPie: function(x, y, radius, startAngle, endAngle, anticlockwise) {
      return this.beginPath().pie(x, y, radius, startAngle, endAngle, anticlockwise).fill();
    },
    strokePie: function(x, y, radius, startAngle, endAngle, anticlockwise) {
      return this.beginPath().pie(x, y, radius, startAngle, endAngle, anticlockwise).stroke();
    },

    
    /**
     * ポリゴンパス
     */
    polygon: function(x, y, size, sides, offsetAngle) {
      var radDiv = (Math.PI*2)/sides;
      var radOffset = (offsetAngle!==undefined) ? offsetAngle*Math.PI/180 : -Math.PI/2;
      
      this.moveTo(x + Math.cos(radOffset)*size, y + Math.sin(radOffset)*size);
      for (var i=1; i<sides; ++i) {
        var rad = radDiv*i+radOffset;
        this.lineTo(
          x + Math.cos(rad)*size,
          y + Math.sin(rad)*size
        );
      }
      this.closePath();
      return this;
    },
    /**
     * ポリゴン塗りつぶし
     */
    fillPolygon: function(x, y, radius, sides, offsetAngle) {
      return this.beginPath().polygon(x, y, radius, sides, offsetAngle).fill();
    },
    /**
     * ポリゴンストローク描画
     */
    strokePolygon: function(x, y, radius, sides, offsetAngle) {
      return this.beginPath().polygon(x, y, radius, sides, offsetAngle).stroke();
    },
    
    /**
     * star
     */
    star: function(x, y, radius, sides, sideIndent, offsetAngle) {
      var x = x || 0;
      var y = y || 0;
      var radius = radius || 64;
      var sides = sides || 5;
      var sideIndentRadius = radius * (sideIndent || 0.38);
      var radOffset = (offsetAngle) ? offsetAngle*Math.PI/180 : -Math.PI/2;
      var radDiv = (Math.PI*2)/sides/2;

      this.moveTo(
        x + Math.cos(radOffset)*radius,
        y + Math.sin(radOffset)*radius
      );
      for (var i=1; i<sides*2; ++i) {
        var rad = radDiv*i + radOffset;
        var len = (i%2) ? sideIndentRadius : radius;
        this.lineTo(
          x + Math.cos(rad)*len,
          y + Math.sin(rad)*len
        );
      }
      this.closePath();

      return this;
    },

    /**
     * 星を塗りつぶし描画
     */
    fillStar: function(x, y, radius, sides, sideIndent, offsetAngle) {
      this.beginPath().star(x, y, radius, sides, sideIndent, offsetAngle).fill();
      return this;
    },

    /**
     * 星をストローク描画
     */
    strokeStar: function(x, y, radius, sides, sideIndent, offsetAngle) {
      this.beginPath().star(x, y, radius, sides, sideIndent, offsetAngle).stroke();
      return this;
    },

    /*
     * heart
     */
    heart: function(x, y, radius, angle) {
      var half_radius = radius*0.5;
      var rad = (angle === undefined) ? Math.PI/4 : Math.degToRad(angle);

      // 半径 half_radius の角度 angle 上の点との接線を求める
      var p = Math.cos(rad)*half_radius;
      var q = Math.sin(rad)*half_radius;

      // 円の接線の方程式 px + qy = r^2 より y = (r^2-px)/q
      var x2 = -half_radius;
      var y2 = (half_radius*half_radius-p*x2)/q;

      // 中心位置調整
      var height = y2 + half_radius;
      var offsetY = half_radius-height/2;

      // パスをセット
      this.moveTo(0+x, y2+y+offsetY);

      this.arc(-half_radius+x, 0+y+offsetY, half_radius, Math.PI-rad, Math.PI*2);
      this.arc(half_radius+x, 0+y+offsetY, half_radius, Math.PI, rad);
      this.closePath();

      return this;
    },

    /*
     * fill heart
     */
    fillHeart: function(x, y, radius, angle) {
      return this.beginPath().heart(x, y, radius, angle).fill();
    },

    /*
     * stroke heart
     */
    strokeHeart: function(x, y, radius, angle) {
      return this.beginPath().heart(x, y, radius, angle).stroke();
    },

    /*
     * http://stackoverflow.com/questions/14169234/the-relation-of-the-bezier-curve-and-ellipse
     */
    ellipse: function(x, y, w, h) {
      var ctx = this.context;
      var kappa = 0.5522848;

      var ox = (w / 2) * kappa; // control point offset horizontal
      var oy = (h / 2) * kappa; // control point offset vertical
      var xe = x + w;           // x-end
      var ye = y + h;           // y-end
      var xm = x + w / 2;       // x-middle
      var ym = y + h / 2;       // y-middle

      ctx.moveTo(x, ym);
      ctx.bezierCurveTo(x, ym - oy, xm - ox, y, xm, y);
      ctx.bezierCurveTo(xm + ox, y, xe, ym - oy, xe, ym);
      ctx.bezierCurveTo(xe, ym + oy, xm + ox, ye, xm, ye);
      ctx.bezierCurveTo(xm - ox, ye, x, ym + oy, x, ym);
      // ctx.closePath();

      return this;
    },

    fillEllipse: function(x, y, width, height) {
      return this.beginPath().ellipse(x, y, width, height).fill();
    },
    strokeEllipse: function(x, y, width, height) {
      return this.beginPath().ellipse(x, y, width, height).stroke();
    },

    fillText: function() {
      this._context.fillText.apply(this._context, arguments);
      return this;
    },

    strokeText: function() {
      this._context.strokeText.apply(this._context, arguments);
      return this;
    },

    /*
     * 画像を描画
     */
    drawImage: function() {
      this.context.drawImage.apply(this.context, arguments);
    },

    /**
     * 行列をセット
     */
    setTransform: function(m11, m12, m21, m22, dx, dy) {
      this.context.setTransform(m11, m12, m21, m22, dx, dy);
      return this;
    },

    /**
     * 行列をリセット
     */
    resetTransform: function() {
      this.setTransform(1.0, 0.0, 0.0, 1.0, 0.0, 0.0);
      return this;
    },
    /**
     * 中心に移動
     */
    transformCenter: function() {
      this.context.setTransform(1, 0, 0, 1, this.width/2, this.height/2);
      return this;
    },

    /**
     * 移動
     */
    translate: function(x, y) {
      this.context.translate(x, y);
      return this;
    },
    
    /**
     * 回転
     */
    rotate: function(rotation) {
      this.context.rotate(rotation);
      return this;
    },
    
    /**
     * スケール
     */
    scale: function(scaleX, scaleY) {
      this.context.scale(scaleX, scaleY);
      return this;
    },

    /**
     * 状態を保存
     */
    save: function() {
      this.context.save();
      return this;
    },

    /**
     * 状態を復元
     */
    restore: function() {
      this.context.restore();
      return this;
    },

    /**
     * 画像として保存
     */
    saveAsImage: function(mime_type) {
      mime_type = mime_type || "image/png";
      var data_url = this.canvas.toDataURL(mime_type);
      // data_url = data_url.replace(mime_type, "image/octet-stream");
      window.open(data_url, "save");
      
      // toDataURL を使えば下記のようなツールが作れるかも!!
      // TODO: プログラムで絵をかいて保存できるツール
    },


    _accessor: {
      /**
       * 幅
       */
      width: {
        "get": function()   { return this.canvas.width; },
        "set": function(v)  { this.canvas.width = v; }
      },

      /**
       * 高さ
       */
      height: {
        "get": function()   { return this.canvas.height; },
        "set": function(v)  { this.canvas.height = v; }
      },

      fillStyle: {
        "get": function()   { return this.context.fillStyle; },
        "set": function(v)  { this.context.fillStyle = v; }
      },

      strokeStyle: {
        "get": function()   { return this.context.strokeStyle; },
        "set": function(v)  { this.context.strokeStyle = v; }
      },

      globalAlpha: {
        "get": function()   { return this.context.globalAlpha; },
        "set": function(v)  { this.context.globalAlpha = v; }
      },

      globalCompositeOperation: {
        "get": function()   { return this.context.globalCompositeOperation; },
        "set": function(v)  { this.context.globalCompositeOperation = v; }
      },

      shadowBlur: {
        "get": function()   { return this.context.shadowBlur; },
        "set": function(v)  { this.context.shadowBlur = v; }
      },

      shadowColor: {
        "get": function()   { return this.context.shadowColor; },
        "set": function(v)  { this.context.shadowColor = v; }
      },

      shadowOffsetX: {
        "get": function()   { return this.context.shadowOffsetX; },
        "set": function(v)  { this.context.shadowOffsetX = v; }
      },

      shadowOffsetY: {
        "get": function()   { return this.context.shadowOffsetY; },
        "set": function(v)  { this.context.shadowOffsetY = v; }
      },

      lineCap: {
        "get": function()   { return this.context.lineCap; },
        "set": function(v)  { this.context.lineCap = v; }
      },

      lineJoin: {
        "get": function()   { return this.context.lineJoin; },
        "set": function(v)  { this.context.lineJoin = v; }
      },

      miterLimit: {
        "get": function()   { return this.context.miterLimit; },
        "set": function(v)  { this.context.miterLimit = v; }
      },

      lineWidth: {
        "get": function()   { return this.context.lineWidth; },
        "set": function(v)  { this.context.lineWidth = v; }
      },

      font: {
        "get": function()   { return this.context.font; },
        "set": function(v)  { this.context.font = v; }
      },

      textAlign: {
        "get": function()   { return this.context.textAlign; },
        "set": function(v)  { this.context.textAlign = v; }
      },

      textBaseline: {
        "get": function()   { return this.context.textBaseline; },
        "set": function(v)  { this.context.textBaseline = v; }
      },

      imageSmoothingEnabled: {
        "get": function()   { return this.context.imageSmoothingEnabled; },
        "set": function(v)  {
          this.context.imageSmoothingEnabled = v;
          this.context.webkitImageSmoothingEnabled = v;
          this.context.mozImageSmoothingEnabled = v;
        }
      },
    },

    _static: {
      _context: (function() {
        if (phina.util.Support.canvas) {
          return document.createElement('canvas').getContext('2d');
        }
        else {
          return null;
        }
      })(),

      measureText: function(font, text) {
        this._context.font = font;
        return this._context.measureText(text);
      },

      createLinearGradient: function() {
        return this._context.createLinearGradient.apply(this._context, arguments);
      },

      createRadialGradient: function() {
        return this._context.createRadialGradient.apply(this._context, arguments);
      },
    },
  });
});

/*
 *
 */


phina.namespace(function() {

  /**
   * @class phina.graphics.CanvasRecorder
   * Reference <https://github.com/jnordberg/gif.js/>
   * @extends phina.util.EventDispatcher
   */
  phina.define('phina.graphics.CanvasRecorder', {

    superClass: 'phina.util.EventDispatcher',

    _id: null,
    objectURL: null,

    init: function(canvas, options) {
      this.superInit();

      this.canvas = canvas;

      this.gif = new GIF((options || {}).$safe({
        workers: 4,
        quality: 10,
        width: canvas.width,
        height: canvas.height,
      }));

      this.gif.on('finished', function(blob) {
        this.objectURL = URL.createObjectURL(blob);
        this.flare('finished');
      }.bind(this));
    },

    /**
     * key と value はアクセサを参照
     */
    setOption: function(key, value) {
      this.gif.setOption(key, value);
      return this;
    },

    /**
     * key と value はアクセサを参照
     */
    setOptions: function(options) {
      this.gif.setOptions(options);
      return this;
    },

    start: function(fps, recordingTime) {
      fps = fps || 30;
      recordingTime = recordingTime || 2000;
      var frameTime = 1000 / fps;
      var time = 0;
      this._id = setInterval(function() {
        var ctx = this.canvas.context;
        this.gif.addFrame(ctx, {
          copy: true,
          delay: frameTime,
        });

        time += frameTime;

        if (time > recordingTime) {
          this.stop();
        }
      }.bind(this), frameTime);

      return this;
    },

    stop: function() {
      if (this._id === null) return this;
      clearInterval(this._id);

      // レンダリング
      this.gif.render();
      this._id = null;
      return this;
    },

    open: function() {
      window.open(this.objectURL);
    },

    _accessor: {

      width: {
        get: function() {
          return this.gif.options.width || this.canvas.width;
        },
        set: function(width) {
          this.setOption('width', width);
        },
      },

      height: {
        get: function() {
          return this.gif.options.height || this.canvas.height;
        },
        set: function(height) {
          this.setOption('height', height);
        },
      },

      // GIF のクオリティ。低いほどハイクオリティ
      quality: {
        get: function() {
          return this.gif.options.quality;
        },
        set: function(quality) {
          this.setOption('quality', quality);
        },
      },

      // Worker の URL デフォルトで gif.worker.js
      workerScript: {
        get: function() {
          return this.gif.options.workerScript;
        },
        set: function(workerScript) {
          this.setOption('workerScript', workerScript);
        },
      },

      // 起動する Worker の数
      workers: {
        get: function() {
          return this.gif.options.workers;
        },
        set: function(workers) {
          this.setOption('workers', workers);
        },
      },

      // ループするか 0 でループ -1 でループしない
      repeat: {
        get: function() {
          return this.gif.options.repeat;
        },
        set: function(repeat) {
          this.setOption('repeat', repeat);
        },
      },

      // true で ループ false でループしない
      loop: {
        get: function() {
          return this.gif.options.repeat === 0;
        },
        set: function(loop) {
          this.setOption('repeat', loop ? 0 : -1);
        },
      },

      // 透過する色 ? transparent hex color, 0x00FF00 = green
      transparent: {
        get: function() {
          return this.gif.options.transparent;
        },
        set: function(transparent) {
          this.setOption('transparent', transparent);
        },
      },

      // background color where source image is transparent
      background: {
        get: function() {
          return this.gif.options.background;
        },
        set: function(background) {
          this.setOption('background', background);
        },
      },
    }
  });


});


phina.namespace(function() {

  /**
   * @class phina.display.DisplayElement
   * @extends phina.app.Object2D
   */
  phina.define('phina.display.DisplayElement', {
    superClass: 'phina.app.Object2D',

    /** 表示フラグ */
    visible: true,
    /** アルファ */
    alpha: 1.0,
    /** ブレンドモード */
    blendMode: "source-over",

    /** 子供を 自分のCanvasRenderer で描画するか */
    renderChildBySelf: false,

    init: function(options) {
      options = (options || {});
      
      this.superInit(options);

      this.visible = true;
      this.alpha = 1.0;
      this._worldAlpha = 1.0;
    },

    /**
     * 表示/非表示をセット
     */
    setVisible: function(flag) {
      this.visible = flag;
      return this;
    },

    /**
     * 表示
     */
    show: function() {
      this.visible = true;
      return this;
    },

    /**
     * 非表示
     */
    hide: function() {
      this.visible = false;
      return this;
    },

    /**
     * @private
     */
    _calcWorldAlpha: function() {
      if (this.alpha < 0) {
        this._worldAlpha = 0;
        return;
      }
      if (!this.parent) {
        this._worldAlpha = this.alpha;
        return ;
      }
      else {
        var worldAlpha = (this.parent._worldAlpha !== undefined) ? this.parent._worldAlpha : 1.0; 
        // alpha
        this._worldAlpha = worldAlpha * this.alpha;
      }
    },
  });

});



phina.namespace(function() {

  /**
   * @class phina.display.PlainElement
   * @extends phina.display.DisplayElement
   */
  phina.define('phina.display.PlainElement', {
    superClass: 'phina.display.DisplayElement',

    init: function(options) {
      this.superInit(options);
      this.canvas = phina.graphics.Canvas();
      this.canvas.setSize(this.width, this.height);
    },

    draw: function(canvas) {
      var image = this.canvas.domElement;
      var w = image.width;
      var h = image.height;

      var x = -w*this.origin.x;
      var y = -h*this.origin.y;

      canvas.context.drawImage(image,
        0, 0, w, h,
        x, y, w, h
        );
    },
  });

});


phina.namespace(function() {

  /**
   * @class phina.display.Shape
   * @extends phina.display.PlainElement
   */
  var Shape = phina.define('phina.display.Shape', {
    superClass: 'phina.display.PlainElement',

    init: function(options) {
      options = ({}).$safe(options, {
        width: 64,
        height: 64,
        padding: 8,

        backgroundColor: '#aaa',
        fill: '#00a',
        stroke: '#aaa',
        strokeWidth: 4,

        shadow: false,
        shadowBlur: 4,
      });
      this.superInit(options);

      this.padding = options.padding;

      this.backgroundColor = options.backgroundColor;
      this.fill = options.fill;
      this.stroke = options.stroke;
      this.strokeWidth = options.strokeWidth;

      this.shadow = options.shadow;
      this.shadowBlur = options.shadowBlur;

      this.watchDraw = true;
      this._dirtyDraw = true;

      var checkRender = function() {
        // render
        if (this.watchDraw && this._dirtyDraw === true) {
          this.render(this.canvas);
          this._dirtyDraw = false;
        }
      };

      this.on('enterframe', checkRender);
      this.on('added', checkRender);
    },

    calcCanvasWidth: function() {
      return this.width + this.padding*2;
    },

    calcCanvasHeight: function() {
      return this.height + this.padding*2;
    },

    calcCanvasSize: function () {
      return {
        width: this.calcCanvasWidth(),
        height: this.calcCanvasHeight(),
      };
    },

    isStrokable: function() {
      return this.stroke && 0 < this.strokeWidth;
    },

    prerender: function(canvas) {

    },
    postrender: function(canvas) {

    },
    renderFill: function(canvas) {
      canvas.fill();
    },
    renderStroke: function(canvas) {
      canvas.stroke();
    },

    render: function(canvas) {
      var context = canvas.context;
      // リサイズ
      var size = this.calcCanvasSize();
      canvas.setSize(size.width, size.height);
      // クリアカラー
      canvas.clearColor(this.backgroundColor);
      // 中心に座標を移動
      canvas.transformCenter();

      // 描画前処理
      this.prerender(this.canvas);

      // ストローク描画
      if (this.isStrokable()) {
        context.strokeStyle = this.stroke;
        context.lineWidth = this.strokeWidth;
        context.lineJoin = "round";
        context.shadowBlur = 0;
        this.renderStroke(canvas);
      }

      // 塗りつぶし描画
      if (this.fill) {
        context.fillStyle = this.fill;

        // shadow の on/off
        if (this.shadow) {
          context.shadowColor = this.shadow;
          context.shadowBlur = this.shadowBlur;
        }
        else {
          context.shadowBlur = 0;
        }

        this.renderFill(canvas);
      }

      // 描画後処理
      this.postrender(this.canvas);

      return this;
    },

    _static: {
      watchRenderProperty: function(key) {
        this.prototype.$watch(key, function(newVal, oldVal) {
          if (newVal !== oldVal) {
            this._dirtyDraw = true;
          }
        });
      },
      watchRenderProperties: function(keys) {
        var watchRenderProperty = this.watchRenderProperty || Shape.watchRenderProperty;
        keys.each(function(key) {
          watchRenderProperty.call(this, key);
        }, this);
      },
    },

    _defined: function() {
      this.watchRenderProperties([
        'width',
        'height',
        'radius',
        'padding',
        'backgroundColor',
        'fill',
        'stroke',
        'strokeWidth',
        'shadow',
        'shadowBlur',
      ]);
    },
  });

});

phina.namespace(function() {
  /**
   * @class phina.display.RectangleShape
   * @extends phina.display.Shape
   */
  phina.define('phina.display.RectangleShape', {
    superClass: 'phina.display.Shape',
    init: function(options) {
      options = ({}).$safe(options, {
        backgroundColor: 'transparent',
        fill: 'blue',
        stroke: '#aaa',
        strokeWidth: 4,

        cornerRadius: 0,
      });
      this.superInit(options);

      this.cornerRadius = options.cornerRadius;
    },

    prerender: function(canvas) {
      canvas.roundRect(-this.width/2, -this.height/2, this.width, this.height, this.cornerRadius);
    },

    _defined: function() {
      phina.display.Shape.watchRenderProperty.call(this, 'cornerRadius');
    },
  });
});

phina.namespace(function() {

  /**
   * @class phina.display.CircleShape
   * @extends phina.display.Shape
   */
  phina.define('phina.display.CircleShape', {
    superClass: 'phina.display.Shape',

    init: function(options) {
      options = ({}).$safe(options, {
        backgroundColor: 'transparent',
        fill: 'red',
        stroke: '#aaa',
        strokeWidth: 4,
        radius: 32,
      });
      this.superInit(options);

      this.setBoundingType('circle');
    },

    prerender: function(canvas) {
      canvas.circle(0, 0, this.radius);
    },
  });
});

phina.namespace(function() {
  /**
   * @class phina.display.TriangleShape
   * @extends phina.display.Shape
   */
  phina.define('phina.display.TriangleShape', {
    superClass: 'phina.display.Shape',

    init: function(options) {
      options = ({}).$safe(options, {
        backgroundColor: 'transparent',
        fill: 'green',
        stroke: '#aaa',
        strokeWidth: 4,

        radius: 32,
      });
      this.superInit(options);

      this.setBoundingType('circle');
    },

    prerender: function(canvas) {
      canvas.polygon(0, 0, this.radius, 3);
    },

  });

});

phina.namespace(function() {
  /**
   * @class phina.display.StarShape
   * @extends phina.display.Shape
   */
  phina.define('phina.display.StarShape', {
    superClass: 'phina.display.Shape',
    init: function(options) {
      options = ({}).$safe(options, {
        backgroundColor: 'transparent',
        fill: 'yellow',
        stroke: '#aaa',
        strokeWidth: 4,

        radius: 32,
        sides: 5,
        sideIndent: 0.38,
      });
      this.superInit(options);

      this.setBoundingType('circle');
      this.sides = options.sides;
      this.sideIndent = options.sideIndent;
    },

    prerender: function(canvas) {
      canvas.star(0, 0, this.radius, this.sides, this.sideIndent);
    },

    _defined: function() {
      phina.display.Shape.watchRenderProperty.call(this, 'sides');
      phina.display.Shape.watchRenderProperty.call(this, 'sideIndent');
    },
  });

});

phina.namespace(function() {
  /**
   * @class phina.display.PolygonShape
   * @extends phina.display.Shape
   */
  phina.define('phina.display.PolygonShape', {
    superClass: 'phina.display.Shape',
    init: function(options) {
      options = ({}).$safe(options, {
        backgroundColor: 'transparent',
        fill: 'cyan',
        stroke: '#aaa',
        strokeWidth: 4,

        radius: 32,
        sides: 5,
      });
      this.superInit(options);

      this.setBoundingType('circle');
      this.sides = options.sides;
    },

    prerender: function(canvas) {
      canvas.polygon(0, 0, this.radius, this.sides);
    },

    _defined: function() {
      phina.display.Shape.watchRenderProperty.call(this, 'sides');
    },
  });

});


phina.namespace(function() {
  /**
   * @class phina.display.HeartShape
   * @extends phina.display.Shape
   */
  phina.define('phina.display.HeartShape', {
    superClass: 'phina.display.Shape',
    init: function(options) {
      options = ({}).$safe(options, {
        backgroundColor: 'transparent',
        fill: 'pink',
        stroke: '#aaa',
        strokeWidth: 4,

        radius: 32,
        cornerAngle: 45,
      });
      this.superInit(options);

      this.setBoundingType('circle');
      this.cornerAngle = options.cornerAngle;
    },

    prerender: function(canvas) {
      canvas.heart(0, 0, this.radius, this.cornerAngle);
    },

    _defined: function() {
      phina.display.Shape.watchRenderProperty.call(this, 'cornerAngle');
    },
  });

});

phina.namespace(function () {
  /**
   * @class phina.display.PathShape
   * @extends phina.display.Shape
   */
  var PathShape = phina.define('phina.display.PathShape', {
    superClass: 'phina.display.Shape',
    paths: null,

    init: function (options) {
      options = ({}).$safe(options || {}, PathShape.defaults);

      this.superInit(options);
      this.paths = options.paths || [];
      this.lineJoin = options.lineJoin;
      this.lineCap = options.lineCap;
    },

    setPaths: function (paths) {
      this.paths = paths;
      this._dirtyDraw = true;
      return this;
    },

    clear: function () {
      this.paths.length = 0;
      this._dirtyDraw = true;
      return this;
    },

    addPaths: function (paths) {
      [].push.apply(this.paths, paths);
      this._dirtyDraw = true;
      return this;
    },

    addPath: function (x, y) {
      this.paths.push(phina.geom.Vector2(x, y));
      this._dirtyDraw = true;
      return this;
    },

    getPath: function (i) {
      return this.paths[i];
    },

    getPaths: function () {
      return this.paths;
    },

    changePath: function (i, x, y) {
      this.paths[i].set(x, y);
      this._dirtyDraw = true;
      return this;
    },

    calcCanvasSize: function () {
      var paths = this.paths;
      if (paths.length === 0) {
        return {
          width: this.padding * 2,
          height:this.padding * 2,
        };
      }
      var maxX = -Infinity;
      var maxY = -Infinity;
      var minX = Infinity;
      var minY = Infinity;

      for (var i = 0, len = paths.length; i < len; ++i) {
        var path = paths[i];
        if (maxX < path.x) { maxX = path.x; }
        if (minX > path.x) { minX = path.x; }
        if (maxY < path.y) { maxY = path.y; }
        if (minY > path.y) { minY = path.y; }
      }
      return {
        width: Math.max(Math.abs(maxX), Math.abs(minX)) * 2 + this.padding * 2,
        height: Math.max(Math.abs(maxY), Math.abs(minY)) * 2 + this.padding * 2,
      };
    },

    calcCanvasWidth: function () {
      return this.calcCanvasSize().width;
    },

    calcCanvasHeight: function () {
      return this.calcCanvasSize().height;
    },

    prerender: function (canvas) {
      canvas.lineCap = this.lineCap;
      canvas.lineJoin = this.lineJoin;
      var paths = this.paths;
      if (paths.length > 1) {
        var c = canvas.context;
        var p = paths[0];
        c.beginPath();
        c.moveTo(p.x, p.y);
        for (var i = 1, len = paths.length; i < len; ++i) {
          p = paths[i];
          c.lineTo(p.x, p.y);
        }
      }
    },

    _defined: function () {
      phina.display.Shape.watchRenderProperties.call(this, [
        'lineCap',
        'lineJoin'
      ]);
    },

    _static: {
      defaults: {
        fill: false,
        backgroundColor: 'transparent',
        lineCap: 'round',
        lineJoin:'round',
      },
    }

  });

});


phina.namespace(function() {

  /**
   * @class phina.display.Sprite
   * @extends phina.display.DisplayElement
   */
  phina.define('phina.display.Sprite', {
    superClass: 'phina.display.DisplayElement',

    init: function(image, width, height) {
      this.superInit();

      this.srcRect = phina.geom.Rect();
      this.setImage(image, width, height);
    },

    draw: function(canvas) {
      var image = this.image.domElement;

      // canvas.context.drawImage(image,
      //   0, 0, image.width, image.height,
      //   -this.width*this.origin.x, -this.height*this.origin.y, this.width, this.height
      //   );

      var srcRect = this.srcRect;
      canvas.context.drawImage(image,
        srcRect.x, srcRect.y, srcRect.width, srcRect.height,
        -this._width*this.originX, -this._height*this.originY, this._width, this._height
        );
    },

    setImage: function(image, width, height) {
      if (typeof image === 'string') {
        image = phina.asset.AssetManager.get('image', image);
      }
      this._image = image;
      this.width = this._image.domElement.width;
      this.height = this._image.domElement.height;

      if (width) { this.width = width; }
      if (height) { this.height = height; }

      this.frameIndex = 0;

      return this;
    },

    setFrameIndex: function(index, width, height) {
      var tw  = width || this._width;      // tw
      var th  = height || this._height;    // th
      var row = ~~(this.image.domElement.width / tw);
      var col = ~~(this.image.domElement.height / th);
      var maxIndex = row*col;
      index = index%maxIndex;
      
      var x = index%row;
      var y = ~~(index/row);
      this.srcRect.x = x*tw;
      this.srcRect.y = y*th;
      this.srcRect.width  = tw;
      this.srcRect.height = th;

      this._frameIndex = index;

      return this;
    },

    _accessor: {
      image: {
        get: function() {return this._image;},
        set: function(v) {
          this.setImage(v);
          return this;
        }
      },
      frameIndex: {
        get: function() {return this._frameIndex;},
        set: function(idx) {
          this.setFrameIndex(idx);
          return this;
        }
      },
    },
  });

});



phina.namespace(function() {

  /**
   * @class phina.display.Label
   * @extends phina.display.Shape
   */
  phina.define('phina.display.Label', {
    superClass: 'phina.display.Shape',

    /**
     * @constructor
     */
    init: function(options) {
      if (typeof arguments[0] !== 'object') {
        options = { text: arguments[0], };
      }
      else {
        options = arguments[0];
      }

      options = ({}).$safe(options, phina.display.Label.defaults);

      this.superInit(options);

      this.text = options.text;
      this.fontSize = options.fontSize;
      this.fontWeight = options.fontWeight;
      this.fontFamily = options.fontFamily;
      this.align = options.align;
      this.baseline = options.baseline;
      this.lineHeight = options.lineHeight;
    },

    calcCanvasWidth: function() {
      var width = 0;
      var canvas = this.canvas;
      canvas.context.font = this.font;
      this._lines.forEach(function(line) {
        var w = canvas.context.measureText(line).width;
        if (width < w) {
          width = w;
        }
      }, this);
      if (this.align !== 'center') width*=2;

      return width + this.padding*2;
    },

    calcCanvasHeight: function() {
      var height = this.fontSize * this._lines.length;
      if (this.baseline !== 'middle') height*=2;
      return height*this.lineHeight + this.padding*2;
    },

    prerender: function(canvas) {
      var context = canvas.context;
      context.font = this.font;
      context.textAlign = this.align;
      context.textBaseline = this.baseline;

      var lines = this._lines;
      this.lineSize = this.fontSize*this.lineHeight;
      this._offset = -Math.floor(lines.length/2)*this.lineSize;
      this._offset += ((lines.length+1)%2) * (this.lineSize/2);
    },

    renderFill: function(canvas) {
      var context = canvas.context;
      this._lines.forEach(function(line, i) {
        context.fillText(line, 0, i*this.lineSize+this._offset);
      }, this);
    },

    renderStroke: function(canvas) {
      var context = canvas.context;
      this._lines.forEach(function(line, i) {
        context.strokeText(line, 0, i*this.lineSize+this._offset);
      }, this);
    },

    _accessor: {
      /**
       * text
       */
      text: {
        get: function() { return this._text; },
        set: function(v) {
          this._text = v;
          this._lines = (this.text + '').split('\n');
        },
      },

      font: {
        get: function() {
          return "{fontWeight} {fontSize}px {fontFamily}".format(this);
        },
      }
    },

    _static: {
      defaults: {
        backgroundColor: 'transparent',

        fill: 'black',
        stroke: null,
        strokeWidth: 2,

        // 
        text: 'Hello, world!',
        // 
        fontSize: 32,
        fontWeight: '',
        fontFamily: "'HiraKakuProN-W3'", // Hiragino or Helvetica,
        // 
        align: 'center',
        baseline: 'middle',
        lineHeight: 1.2,
      },
    },

    _defined: function() {
      var Shape = phina.display.Shape;
      Shape.watchRenderProperty.call(this, 'text');
      Shape.watchRenderProperty.call(this, 'fontSize');
      Shape.watchRenderProperty.call(this, 'fontWeight');
      Shape.watchRenderProperty.call(this, 'fontFamily');
      Shape.watchRenderProperty.call(this, 'align');
      Shape.watchRenderProperty.call(this, 'baseline');
      Shape.watchRenderProperty.call(this, 'lineHeight');
    },
  });

});



phina.namespace(function() {

  /**
   * @class phina.display.DisplayScene
   * @extends phina.app.Scene
   */
  phina.define('phina.display.DisplayScene', {
    superClass: 'phina.app.Scene',

    init: function(params) {
      this.superInit();

      params = ({}).$safe(params, phina.display.DisplayScene.defaults);

      this.canvas = phina.graphics.Canvas();
      this.canvas.setSize(params.width, params.height);
      this.renderer = phina.display.CanvasRenderer(this.canvas);
      this.backgroundColor = (params.backgroundColor) ? params.backgroundColor : null;
      
      this.width = params.width;
      this.height = params.height;
      this.gridX = phina.util.Grid(params.width, 16);
      this.gridY = phina.util.Grid(params.height, 16);

      // TODO: 一旦むりやり対応
      this.interactive = true;
      this.setInteractive = function(flag) {
        this.interactive = flag;
      };
      this._overFlags = {};
      this._touchFlags = {};
    },

    hitTest: function() {
      return true;
    },

    _update: function() {
      if (this.update) {
        this.update();
      }
    },

    _render: function() {
      this.renderer.render(this);
    },

    _static: {
      defaults: {
        width: 640,
        height: 960,
      },
    }

  });


});


phina.namespace(function() {

  /**
   * @class phina.display.Layer
   * @extends phina.display.DisplayElement
   */
  phina.define('phina.display.Layer', {
    superClass: 'phina.display.DisplayElement',

    /** 子供を 自分の CanvasRenderer で描画するか */
    renderChildBySelf: true,

    init: function(options) {
      options = ({}).$safe(options, {
        width: 640,
        height: 960,
      });
      this.superInit(options);
      this.width = options.width;
      this.height = options.height;
      this.gridX = phina.util.Grid(options.width, 16);
      this.gridY = phina.util.Grid(options.height, 16);
    },

    draw: function(canvas) {
      if (!this.domElement) return ;

      var image = this.domElement;
      canvas.context.drawImage(image,
        0, 0, image.width, image.height,
        -this.width*this.originX, -this.height*this.originY, this.width, this.height
        );
    },
  });
});


phina.namespace(function() {

  /**
   * @class phina.display.CanvasLayer
   * @extends phina.display.Layer
   */
  phina.define('phina.display.CanvasLayer', {
    superClass: 'phina.display.Layer',

    init: function(options) {
      this.superInit(options);
      this.canvas = phina.graphics.Canvas();
      this.canvas.width  = this.width;
      this.canvas.height = this.height;

      this.renderer = phina.display.CanvasRenderer(this.canvas);
      this.domElement = this.canvas.domElement;

      this.on('enterframe', function() {
        var temp = this._worldMatrix;
        this._worldMatrix = null;
        this.renderer.render(this);
        this._worldMatrix = temp;
      });
    },

    draw: function(canvas) {
      var image = this.domElement;
      canvas.context.drawImage(image,
        0, 0, image.width, image.height,
        -this.width*this.originX, -this.height*this.originY, this.width, this.height
        );
    },
  });
});

phina.namespace(function() {

  /**
   * @class phina.display.ThreeLayer
   * @extends phina.display.Layer
   */
  phina.define('phina.display.ThreeLayer', {
    superClass: 'phina.display.Layer',

    scene: null,
    camera: null,
    light: null,
    renderer: null,

    init: function(options) {
      this.superInit(options);

      this.scene = new THREE.Scene();

      this.camera = new THREE.PerspectiveCamera( 75, options.width / options.height, 1, 10000 );
      this.camera.position.z = 1000;

      this.light = new THREE.DirectionalLight( 0xffffff, 1 );
      this.light.position.set( 1, 1, 1 ).normalize();
      this.scene.add( this.light );

      this.renderer = new THREE.WebGLRenderer();
      this.renderer.setClearColor( 0xf0f0f0 );
      this.renderer.setSize( options.width, options.height );

      this.on('enterframe', function() {
        this.renderer.render( this.scene, this.camera );
      });

      this.domElement = this.renderer.domElement;
    },
  });
});




phina.namespace(function() {
  /**
   * @class phina.display.CanvasRenderer
   */
  phina.define('phina.display.CanvasRenderer', {

    init: function(canvas) {
      this.canvas = canvas;
      this._context = this.canvas.context;
    },
    render: function(scene) {
      this.canvas.clear();
      if (scene.backgroundColor) {
        this.canvas.clearColor(scene.backgroundColor);
      }

      this._context.save();
      this.renderChildren(scene);
      this._context.restore();
    },

    renderChildren: function(obj) {
      // 子供たちも実行
      if (obj.children.length > 0) {
        var tempChildren = obj.children.slice();
        for (var i=0,len=tempChildren.length; i<len; ++i) {
          this.renderObject(tempChildren[i]);
        }
      }
    },

    renderObject: function(obj) {
      if (obj.visible === false && !obj.interactive) return;

      obj._calcWorldMatrix && obj._calcWorldMatrix();

      if (obj.visible === false) return;

      obj._calcWorldAlpha && obj._calcWorldAlpha();

      var context = this.canvas.context;

      context.globalAlpha = obj._worldAlpha;
      context.globalCompositeOperation = obj.blendMode;

      if (obj._worldMatrix) {
        // 行列をセット
        var m = obj._worldMatrix;
        context.setTransform( m.m00, m.m10, m.m01, m.m11, m.m02, m.m12 );
      }

      if (obj.clip) {

        context.save();

        obj.clip(this.canvas);
        context.clip();

        if (obj.draw) obj.draw(this.canvas);

        // 子供たちも実行
        if (obj.renderChildBySelf === false && obj.children.length > 0) {
            var tempChildren = obj.children.slice();
            for (var i=0,len=tempChildren.length; i<len; ++i) {
                this.renderObject(tempChildren[i]);
            }
        }

        context.restore();
      }
      else {
        if (obj.draw) obj.draw(this.canvas);

        // 子供たちも実行
        if (obj.renderChildBySelf === false && obj.children.length > 0) {
          var tempChildren = obj.children.slice();
          for (var i=0,len=tempChildren.length; i<len; ++i) {
            this.renderObject(tempChildren[i]);
          }
        }

      }
    },

  });

});

phina.namespace(function() {

  /**
   * @class phina.display.DomApp
   * @extends phina.app.BaseApp
   */
  phina.define('phina.display.DomApp', {
    superClass: 'phina.app.BaseApp',

    domElement: null,

    /**
     * @constructor
     */
    init: function(options) {
      this.superInit(options);

      if (options.domElement) {
        this.domElement = options.domElement;
      }
      else {
        if (options.query) {
          this.domElement = document.querySelector(options.query);
        }
        else {
          console.assert('error');
        }
      }

      if (options.fps !== undefined) {
        this.fps = options.fps;
      }
      
      if(typeof options.runner === 'function') {
        this.ticker.runner = options.runner;
      }

      this.mouse = phina.input.Mouse(this.domElement);
      this.touch = phina.input.Touch(this.domElement);
      this.touchList = phina.input.TouchList(this.domElement, 5);
      this.keyboard = phina.input.Keyboard(document);
      // 加速度センサーを生成
      this.accelerometer = phina.input.Accelerometer();

      // ポインタをセット(PC では Mouse, Mobile では Touch)
      this.pointer = this.touch;
      this.pointers = this.touchList.touches;

      this.domElement.addEventListener("touchstart", function () {
        this.pointer = this.touch;
        this.pointers = this.touchList.touches;
      }.bind(this));
      this.domElement.addEventListener("mouseover", function () {
        this.pointer = this.mouse;
        this.pointers = [this.mouse];
      }.bind(this));

      // keyboard event
      this.keyboard.on('keydown', function(e) {
        this.currentScene && this.currentScene.flare('keydown', {
          keyCode: e.keyCode,
        });
      }.bind(this));
      this.keyboard.on('keyup', function(e) {
        this.currentScene && this.currentScene.flare('keyup', {
          keyCode: e.keyCode,
        });
      }.bind(this));
      this.keyboard.on('keypress', function(e) {
        this.currentScene && this.currentScene.flare('keypress', {
          keyCode: e.keyCode,
        });
      }.bind(this));

      // click 対応
      var eventName = phina.isMobile() ? 'touchend' : 'mouseup';
      this.domElement.addEventListener(eventName, this._checkClick.bind(this));

      // 決定時の処理をオフにする(iPhone 時のちらつき対策)
      this.domElement.addEventListener("touchstart", function(e) { e.stop(); });
      this.domElement.addEventListener("touchmove", function(e) { e.stop(); });

      // ウィンドウフォーカス時イベントリスナを登録
      phina.global.addEventListener('focus', function() {
        this.flare('focus');
        this.currentScene.flare('focus');
      }.bind(this), false);
      // ウィンドウブラー時イベントリスナを登録
      phina.global.addEventListener('blur', function() {
        this.flare('blur');
        this.currentScene.flare('blur');
      }.bind(this), false);

      // 更新関数を登録
      this.on('enterframe', function() {
        this.mouse.update();
        this.touch.update();
        this.touchList.update();
        this.keyboard.update();
      });
    },

    _checkClick: function(e) {
      var _check = function(element) {
        if (element.children.length > 0) {
          element.children.each(function(child) {
            _check(child);
          });
        }
        if (element._clicked && element.has('click')) {
          element.flare('click');
        }
        element._clicked = false;
      };

      _check(this.currentScene);
    },

  });

  
});


phina.namespace(function() {

  /**
   * @class phina.display.CanvasApp
   * @extends phina.display.DomApp
   */
  phina.define('phina.display.CanvasApp', {
    superClass: 'phina.display.DomApp',

    /**
     * @constructor
     */
    init: function(options) {
      options = (options || {}).$safe(phina.display.CanvasApp.defaults);
      
      if (!options.query && !options.domElement) {
        options.domElement = document.createElement('canvas');
        if (options.append) {
          document.body.appendChild(options.domElement);
        }
      }
      this.superInit(options);

      this.gridX = phina.util.Grid({
        width: options.width,
        columns: options.columns,
      });
      this.gridY = phina.util.Grid({
        width: options.height,
        columns: options.columns,
      });

      this.canvas = phina.graphics.Canvas(this.domElement);
      this.canvas.setSize(options.width, options.height);

      this.backgroundColor = (options.backgroundColor !== undefined) ? options.backgroundColor : 'white';

      this.replaceScene(phina.display.DisplayScene({
        width: options.width,
        height: options.height,
      }));

      if (options.fit) {
        this.fitScreen();
      }

      if (options.pixelated) {
        // チラつき防止
        // https://drafts.csswg.org/css-images/#the-image-rendering
        this.domElement.style.imageRendering = 'pixelated';
      }

      // pushScene, popScene 対策
      this.on('push', function() {
        // onenter 対策で描画しておく
        if (this.currentScene.canvas) {
          this._draw();
        }
      });
    },

    _draw: function() {
      if (this.backgroundColor) {
        this.canvas.clearColor(this.backgroundColor);
      } else {
        this.canvas.clear();
      }

      if (this.currentScene.canvas) {
        this.currentScene._render();

        this._scenes.each(function(scene) {
          var c = scene.canvas;
          if (c) {
            this.canvas.context.drawImage(c.domElement, 0, 0, c.width, c.height);
          }
        }, this);
      }
    },

    fitScreen: function() {
      this.canvas.fitScreen();
    },

    _static: {
      defaults: {
        width: 640,
        height: 960,
        columns: 12,
        fit: true,
        append: true,
      },
    },

  });
});


phina.namespace(function() {

  /**
   * @class phina.effect.Wave
   * Button
   * @extends phina.display.CircleShape
   */
  phina.define('phina.effect.Wave', {
    superClass: 'phina.display.CircleShape',
    /**
     * @constructor
     */
    init: function(options) {
      options = (options || {}).$safe({
        fill: 'white',
        stroke: false,
      });

      this.superInit(options);

      var tweener = phina.accessory.Tweener().attachTo(this);
      tweener
        .to({scaleX:2, scaleY:2, alpha:0}, 500)
        .call(function() {
          this.remove();
        }, this);
    },
  });

});




phina.namespace(function() {

  /**
   * @class phina.ui.Button
   * Button
   * @extends phina.display.Shape
   */
  phina.define('phina.ui.Button', {
    superClass: 'phina.display.Shape',
    /**
     * @constructor
     */
    init: function(options) {
      options = (options || {}).$safe(phina.ui.Button.defaults);
      this.superInit(options);

      this.cornerRadius = options.cornerRadius;
      this.text         = options.text;
      this.fontColor    = options.fontColor;
      this.fontSize     = options.fontSize;
      this.fontWeight     = options.fontWeight;
      this.fontFamily   = options.fontFamily;

      this.setInteractive(true);
      this.on('pointend', function() {
        this.flare('push');
      });
    },
    prerender: function(canvas) {
      canvas.roundRect(-this.width/2, -this.height/2, this.width, this.height, this.cornerRadius);
    },

    postrender: function(canvas) {
      var context = canvas.context;
      // text
      var font = "{fontWeight} {fontSize}px {fontFamily}".format(this);
      context.font = font;
      context.textAlign = 'center';
      context.textBaseline = 'middle';
      context.fillStyle = this.fontColor;
      context.fillText(this.text, 0, 0);
    },

    _static: {
      defaults: {
        width: 200,
        height: 80,
        backgroundColor: 'transparent',
        fill: 'hsl(200, 80%, 60%)',
        stroke: null,

        cornerRadius: 8,
        text: 'Hello',
        fontColor: 'white',
        fontSize: 32,
        fontWeight: '',
        fontFamily: "'HiraKakuProN-W3'", // Hiragino or Helvetica,
      },
    },

    _defined: function() {
      phina.display.Shape.watchRenderProperty.call(this, 'cornerRadius');
      phina.display.Shape.watchRenderProperty.call(this, 'text');
      phina.display.Shape.watchRenderProperty.call(this, 'fontColor');
      phina.display.Shape.watchRenderProperty.call(this, 'fontSize');
      phina.display.Shape.watchRenderProperty.call(this, 'fontFamily');
    },

  });

});

phina.namespace(function() {

  /**
   * @class phina.ui.Gauge
   * @extends phina.display.Shape
   */
  phina.define('phina.ui.Gauge', {
    superClass: 'phina.display.Shape',

    init: function(options) {
      options = ({}).$safe(options || {}, Gauge.defaults);
      
      this.superInit(options);

      this._value = (options.value !== undefined) ? options.value : options.maxValue;
      this.maxValue = options.maxValue;
      this.gaugeColor = options.gaugeColor;
      this.cornerRadius = options.cornerRadius;

      this.visualValue = (options.value !== undefined) ? options.value : options.maxValue;
      this.animation = true;
      this.animationTime = 1*1000;
    },

    /**
     * 満タンかをチェック
     */
    isFull: function() {
      return this.value === this.maxValue;
    },

    /**
     * 空っぽかをチェック
     */
    isEmpty: function() {
      return this.value === 0;
    },

    setValue: function(value) {
      value = Math.clamp(value, 0, this.maxValue);

      // end when now value equal value of argument
      if (this.value === value) return ;

      // fire value change event
      this.flare('change');

      this._value = value;

      if (this.animation) {
        var range = Math.abs(this.visualValue-value);
        var time = (range/this.maxValue)*this.animationTime;

        this.tweener.ontween = function() {
          this._dirtyDraw = true;
        }.bind(this);
        this.tweener
          .clear()
          .to({'visualValue': value}, time)
          .call(function() {
            this.flare('changed');
            if (this.isEmpty()) {
              this.flare('empty');
            }
            else if (this.isFull()) {
              this.flare('full');
            }
          }, this);
      }
      else {
        this.visualValue = value;
        this.flare('changed');
        if (this.isEmpty()) {
          this.flare('empty');
        }
        else if (this.isFull()) {
          this.flare('full');
        }
      }
    },

    getRate: function() {
      var rate = this.visualValue/this.maxValue;
      return rate;
    },

    prerender: function(canvas) {
      canvas.roundRect(-this.width/2, -this.height/2, this.width, this.height, this.cornerRadius);
    },

    postrender: function(canvas) {
      var rate = this.getRate();
      canvas.context.fillStyle = this.gaugeColor;
      canvas.context.save();
      canvas.context.clip();
      canvas.fillRect(-this.width/2, -this.height/2, this.width*rate, this.height);
      canvas.context.restore();
    },

    _accessor: {
      value: {
        get: function() {
          return this._value;
        },
        set: function(v) {
          this.setValue(v);
        },
      },
    },

    _defined: function() {
      phina.display.Shape.watchRenderProperty.call(this, 'value');
      phina.display.Shape.watchRenderProperty.call(this, 'maxValue');
      phina.display.Shape.watchRenderProperty.call(this, 'gaugeColor');
      phina.display.Shape.watchRenderProperty.call(this, 'cornerRadius');
    },
    
    _static: {
      defaults: {
        width: 256,
        height: 32,
        backgroundColor: 'transparent',
        fill: 'white',
        stroke: '#aaa',
        strokeWidth: 4,
        maxValue: 100,
        gaugeColor: '#44f',
        cornerRadius: 0,
      },
    }
  });

});


phina.namespace(function() {

  /**
   * @class phina.ui.CircleGauge
   * @extends phina.ui.Gauge
   */
  phina.define('phina.ui.CircleGauge', {
    superClass: 'phina.ui.Gauge',

    init: function(options) {
      options = (options || {}).$safe({
        backgroundColor: 'transparent',
        fill: '#aaa',
        stroke: '#222',

        radius: 64,
        anticlockwise: true,
        showPercentage: false, // TODO
      });

      this.superInit(options);

      this.setBoundingType('circle');

      this.radius = options.radius;
      this.anticlockwise = options.anticlockwise;
      this.showPercentage = options.showPercentage;
    },

    prerender: function(canvas) {
      var rate = this.getRate();
      var end = (Math.PI*2)*rate;
      this.startAngle = 0;
      this.endAngle = end;

      this.canvas.rotate(-Math.PI*0.5);
      this.canvas.scale(1, -1);
    },

    renderFill: function(canvas) {
      canvas.fillPie(0, 0, this.radius, this.startAngle, this.endAngle);
    },

    renderStroke: function(canvas) {
      canvas.strokeArc(0, 0, this.radius, this.startAngle, this.endAngle);
    },

    postrender: function() {
      // if (this.showPercentage) {
      //   // TODO:
      //   var left = Math.max(0, this.limit-this.time);
      //   this.label.text = Math.ceil(left/1000)+'';
      // }
    },

  });



});



phina.namespace(function() {

  var textWidthCache = {};

  /**
   * @class phina.ui.LabelArea
   * @extends phina.display.Label
   */
  var LabelArea = phina.define('phina.ui.LabelArea', {
    superClass: 'phina.display.Label',

    _lineUpdate: true,

    init: function(options) {
      options = {}.$safe(options, LabelArea.defaults);
      this.superInit(options);

      this.verticalAlign = options.verticalAlign;
      this.scroll = options.scroll || phina.geom.Vector2();
      this.scrollX = options.scrollX;
      this.scrollY = options.scrollY;
    },

    calcCanvasWidth: function() {
      return this.width + this.padding * 2;
    },

    calcCanvasHeight: function() {
      return this.height + this.padding * 2;
    },
    getOffsetY: function() {
      if (typeof this.verticalAlign === 'number') {
        return this.verticalAlign;
      }
      return LabelArea.verticalAlignToOffsetMap[this.verticalAlign] || 0;
    },

    getOffsetX: function() {
      return LabelArea.alignToOffsetMap[this.align] || 0;
    },

    getTextWidthCache: function() {
      var cache = textWidthCache[this.font];
      return cache || (textWidthCache[this.font] = {});
    },
    
    spliceLines: function(lines) {
      var rowWidth = this.width;
      var context = this.canvas.context;
      context.font = this.font;

      var cache = this.getTextWidthCache();

      // update cache
      this._text.each(function(ch) {
        if (!cache[ch]) {
          cache[ch] = context.measureText(ch).width;
        }
      });
      
      var localLines = [];
      lines.forEach(function(line) {
        
        var str = '';
        var totalWidth = 0;

        // はみ出ていたら強制的に改行する
        line.each(function(ch) {
          var w = cache[ch];

          if ((totalWidth+w) > rowWidth) {
            localLines.push(str);
            str = '';
            totalWidth = 0;
          }

          str += ch;
          totalWidth += w;
        });

        // 残りを push する
        localLines.push(str);

      });
      

      return localLines;
    },
    
    getLines: function() {
      if (this._lineUpdate === false) {
        return this._lines;
      }
      this._lineUpdate = false;

      var lines = (this.text + '').split('\n');
      if (this.width < 1) {
        this._lines = lines;
      }
      else {
        this._lines = this.spliceLines(lines);
      }

      return this._lines;
    },

    prerender: function(canvas) {
      var context = canvas.context;
      context.font = this.font;
      context.textAlign = this.align;
      context.textBaseline = this.baseline;

      var text = this.text + '';
      var lines = this.getLines();
      var length = lines.length;
      var width = this.width;
      var height = this.height;

      var fontSize = this.fontSize;
      var lineSize = fontSize * this.lineHeight;
      var offsetX = this.getOffsetX() * width;
      var offsetY = this.getOffsetY();
      if (offsetY === 0) {
        offsetY = -Math.floor(length / 2) * lineSize;
        offsetY += ((length + 1) % 2) * (lineSize / 2);
      }
      else if (offsetY < 0) {
        offsetY *= height;
      }
      else {
        offsetY = offsetY * height - length * lineSize + lineSize;
      }

      offsetY -= this.scrollY;
      offsetX -= this.scrollX;
      var start = (offsetY + height / 2) / -lineSize | 0;
      if (start < 0) { start = 0; }

      var end = (height / 2 - offsetY + lineSize * 2) / lineSize | 0;
      lines = lines.filter(function(line, i) {
        return start <= i && end > i;
      });

      this.lines = lines;
      this.offsetX = offsetX;
      this.offsetY = offsetY;
      this.lineSize = lineSize;
      this.start = start;
    },

    renderFill: function(canvas) {
      var context = canvas.context;
      var offsetX = this.offsetX;
      var offsetY = this.offsetY;
      var lineSize = this.lineSize;
      var start = this.start;
      this.lines.forEach(function(line, i) {
        context.fillText(line, offsetX, (start + i) * lineSize + offsetY);
      }, this);
    },

    renderStroke: function(canvas) {
      var context = canvas.context;
      var offsetX = this.offsetX;
      var offsetY = this.offsetY;
      var lineSize = this.lineSize;
      var start = this.start;
      this.lines.forEach(function(line, i) {
        context.strokeText(line, offsetX, (start + i) * lineSize + offsetY);
      }, this);
    },

    _accessor: {
      text: {
        get: function() {
          return this._text;
        },
        set: function(v) {
          this._text = v;
        }
      },

      scrollX: {
        get: function() {
          return this.scroll.x;
        },
        set: function(v) {
          this.scroll.x = v;
        },
      },

      scrollY: {
        get: function() {
          return this.scroll.y;
        },
        set: function(v) {
          this.scroll.y = v;
        },
      },
    },
    _static: {
      defaults: {
        verticalAlign: 'top',
        align: 'left',
        baseline: 'top',
        width: 320,
        height: 320,
        scrollX: 0,
        scrollY: 0,
      },
      alignToOffsetMap: {
        start: -0.5,
        left: -0.5,
        center: 0,
        end: 0.5,
        right: 0.5,
      },

      verticalAlignToOffsetMap: {
        top: -0.5,
        center: 0,
        middle: 0,
        bottom: 0.5,
      },
    },

    _defined: function() {
      var func = function(newVal, oldVal) {
        if((this._lineUpdate === false) && (newVal !== oldVal)){
          this._lineUpdate = true;
        }
      };

      [
        'text',
        'width',
        'fontSize',
        'fontWeight',
        'fontFamily'
      ].forEach(function(key) {
        this.$watch(key, func);
      }, this.prototype);

      phina.display.Shape.watchRenderProperties.call(this ,[
        'verticalAlign',
        'text',
        'scroll',
        'scrollX',
        'scrollY'
      ]);
    },


    enableScroll: function() {
      //   this.setInteractive(true);
      //   var physical = phina.accessory.Physical();
      //   physical.attachTo(this);
      //   physical.friction = 0.8;
      //   var lastForce = 0;
      //   var lastMove = 0;
      //   this.on('pointstart', function(e){
      //     lastForce = physical.velocity.y;
      //     lastMove = 0;
      //     physical.force(0, 0);
      //   });
      //   this.on('pointmove', function(e){
      //     var p = e.pointer.deltaPosition;
      //     lastMove = p.y;
      //     this.scrollY += lastMove;
      //   });

      //   this.on('pointend', function(e){
      //     physical.force(0, lastForce + lastMove);
      //   });

      return this;
    },

  });

});

phina.namespace(function() {

  /**
   * @class phina.game.ManagerScene
   * @extends phina.app.Scene
   */
  phina.define('phina.game.ManagerScene', {
    superClass: 'phina.app.Scene',
    /**
     * @constructor
     */
    init: function(params) {
      this.superInit();

      this.setScenes(params.scenes);

      this.on("enter", function() {
        this.gotoScene(params.startLabel || 0);
      }.bind(this));

      this.on("resume", this.onnext.bind(this));

      this.commonArguments = {};
    },


    /**
     * scenes をセット
     */
    setScenes: function(scenes) {
      this.scenes = scenes;
      this.sceneIndex = 0;

      return this;
    },


    replaceScene: function(label, args) {
      var index = (typeof label == 'string') ? this.labelToIndex(label) : label||0;

      var data = this.scenes[index];

      if (!data) {
        console.error('phina.js error: `{0}` に対応するシーンがありません.'.format(label));
      }

      var klass = phina.using(data.className);
      if (typeof klass !== 'function') {
        klass = phina.using('phina.game.' + data.className);
      }

      var initArguments = {}.$extend(data.arguments, args);
      var scene = klass.call(null, initArguments);
      if (!scene.nextLabel) {
          scene.nextLabel = data.nextLabel;
      }
      if (!scene.nextArguments) {
          scene.nextArguments = data.nextArguments;
      }
      this.app.replaceScene(scene);

      this.sceneIndex = index;

      return this;
    },


    /**
     * index(or label) のシーンへ飛ぶ
     */
    gotoScene: function(label, args) {
      var index = (typeof label == 'string') ? this.labelToIndex(label) : label||0;

      var data = this.scenes[index];

      if (!data) {
        console.error('phina.js error: `{0}` に対応するシーンがありません.'.format(label));
      }

      var klass = phina.using(data.className);
      if (typeof klass !== 'function') {
        klass = phina.using('phina.game.' + data.className);
      }

      var initArguments = {}.$extend(data.arguments, args);
      var scene = klass.call(null, initArguments);
      if (!scene.nextLabel) {
          scene.nextLabel = data.nextLabel;
      }
      if (!scene.nextArguments) {
          scene.nextArguments = data.nextArguments;
      }
      this.app.pushScene(scene);

      this.sceneIndex = index;

      return this;
    },

    /**
     * 次のシーンへ飛ぶ
     */
    gotoNext: function(args) {
      var data = this.scenes[this.sceneIndex];
      var nextIndex = null;

      // 次のラベルが設定されていた場合
      if (data.nextLabel) {
          nextIndex = this.labelToIndex(data.nextLabel);
      }
      // 次のシーンに遷移
      else if (this.sceneIndex+1 < this.scenes.length) {
          nextIndex = this.sceneIndex+1;
      }

      if (nextIndex !== null) {
          this.gotoScene(nextIndex, args);
      }
      else {
          this.flare("finish");
      }

      return this;
    },

    /**
     * シーンインデックスを取得
     */
    getCurrentIndex: function() {
      return this.sceneIndex;
    },

    /**
     * シーンラベルを取得
     */
    getCurrentLabel: function() {
      return this.scenes[this.sceneIndex].label;
    },

    /**
     * ラベルからインデックスに変換
     */
    labelToIndex: function(label) {
      var data = this.scenes.filter(function(data) {
        return data.label == label;
      })[0];

      return this.scenes.indexOf(data);
    },

    /**
     * インデックスからラベルに変換
     */
    indexToLabel: function(index) {
      return this.scenes[index].label;
    },

    onnext: function(e) {
      var nextLabel = e.prevScene.nextLabel;
      var nextArguments = e.prevScene.nextArguments;
      if (nextLabel) {
        this.gotoScene(nextLabel, nextArguments);
      }
      else {
        this.gotoNext(nextArguments);
      }
    },

  });

});

/*
 *
 */


phina.namespace(function() {

  /**
   * @class phina.game.SplashScene
   * @extends phina.display.DisplayScene
   */
  phina.define('phina.game.SplashScene', {
    superClass: 'phina.display.DisplayScene',

    init: function(options) {
      var defaults = phina.game.SplashScene.defaults;
      this.superInit(options);

      var texture = phina.asset.Texture();
      texture.load(defaults.imageURL).then(function() {
        this._init();
      }.bind(this));
      this.texture = texture;
    },

    _init: function() {
      this.sprite = phina.display.Sprite(this.texture).addChildTo(this);

      this.sprite.setPosition(this.gridX.center(), this.gridY.center());
      this.sprite.alpha = 0;

      this.sprite.tweener
        .clear()
        .to({alpha:1}, 500, 'easeOutCubic')
        .wait(1000)
        .to({alpha:0}, 500, 'easeOutCubic')
        .wait(250)
        .call(function() {
          this.exit();
        }, this)
        ;
    },

    _static: {
      defaults: {
        imageURL: 'http://cdn.rawgit.com/phi-jp/phina.js/develop/logo.png',
      },
    },
  });

});

/*
 * TitleScene
 */


phina.namespace(function() {

  /**
   * @class phina.game.TitleScene
   * @extends phina.display.DisplayScene
   */
  phina.define('phina.game.TitleScene', {
    superClass: 'phina.display.DisplayScene',
    /**
     * @constructor
     */
    init: function(params) {
      params = ({}).$safe(params, phina.game.TitleScene.defaults);
      this.superInit(params);

      this.backgroundColor = params.backgroundColor;

      this.fromJSON({
        children: {
          titleLabel: {
            className: 'phina.display.Label',
            arguments: {
              text: params.title,
              fill: params.fontColor,
              stroke: false,
              fontSize: 64,
            },
            x: this.gridX.center(),
            y: this.gridY.span(4),
          }
        }
      });

      if (params.exitType === 'touch') {
        this.fromJSON({
          children: {
            touchLabel: {
              className: 'phina.display.Label',
              arguments: {
                text: "TOUCH START",
                fill: params.fontColor,
                stroke: false,
                fontSize: 32,
              },
              x: this.gridX.center(),
              y: this.gridY.span(12),
            },
          },
        });

        this.on('pointend', function() {
          this.exit();
        });
      }
    },

    _static: {
      defaults: {
        title: 'phina.js games',
        message: '',

        fontColor: 'white',
        backgroundColor: 'hsl(200, 80%, 64%)',
        backgroundImage: '',

        exitType: 'touch',
      },
    },

  });

});

/*
 * ResultScene
 */


phina.namespace(function() {

  /**
   * @class phina.game.ResultScene
   * @extends phina.display.DisplayScene
   */
  phina.define('phina.game.ResultScene', {
    superClass: 'phina.display.DisplayScene',
    /**
     * @constructor
     */
    init: function(params) {
      params = ({}).$safe(params, phina.game.ResultScene.defaults);
      this.superInit(params);

      var message = params.message.format(params);

      this.backgroundColor = params.backgroundColor;

      this.fromJSON({
        children: {
          scoreText: {
            className: 'phina.display.Label',
            arguments: {
              text: 'score',
              fill: params.fontColor,
              stroke: null,
              fontSize: 48,
            },
            x: this.gridX.span(8),
            y: this.gridY.span(4),
          },
          scoreLabel: {
            className: 'phina.display.Label',
            arguments: {
              text: params.score+'',
              fill: params.fontColor,
              stroke: null,
              fontSize: 72,
            },
            x: this.gridX.span(8),
            y: this.gridY.span(6),
          },

          messageLabel: {
            className: 'phina.display.Label',
            arguments: {
              text: message,
              fill: params.fontColor,
              stroke: null,
              fontSize: 32,
            },
            x: this.gridX.center(),
            y: this.gridY.span(9),
          },

          shareButton: {
            className: 'phina.ui.Button',
            arguments: [{
              text: '★',
              width: 128,
              height: 128,
              fontColor: params.fontColor,
              fontSize: 50,
              cornerRadius: 64,
              fill: 'rgba(240, 240, 240, 0.5)',
              // stroke: '#aaa',
              // strokeWidth: 2,
            }],
            x: this.gridX.center(-3),
            y: this.gridY.span(12),
          },
          playButton: {
            className: 'phina.ui.Button',
            arguments: [{
              text: '▶',
              width: 128,
              height: 128,
              fontColor: params.fontColor,
              fontSize: 50,
              cornerRadius: 64,
              fill: 'rgba(240, 240, 240, 0.5)',
              // stroke: '#aaa',
              // strokeWidth: 2,
            }],
            x: this.gridX.center(3),
            y: this.gridY.span(12),

            interactive: true,
            onpush: function() {
              this.exit();
            }.bind(this),
          },
        }
      });

      if (params.exitType === 'touch') {
        this.on('pointend', function() {
          this.exit();
        });
      }

      this.shareButton.onclick = function() {
        var text = 'Score: {0}\n{1}'.format(params.score, message);
        var url = phina.social.Twitter.createURL({
          text: text,
          hashtags: params.hashtags,
          url: params.url,
        });
        window.open(url, 'share window', 'width=480, height=320');
      };
    },

    _static: {
      defaults: {
        score: 16,

        message: 'this is phina.js project.',
        hashtags: 'phina_js,game,javascript',
        url: phina.global.location && phina.global.location.href,

        fontColor: 'white',
        backgroundColor: 'hsl(200, 80%, 64%)',
        backgroundImage: '',
      },
    },

  });

});

/*
 * LoadingScene
 */


phina.namespace(function() {

  /**
   * @class phina.game.LoadingScene
   * @extends phina.display.DisplayScene
   */
  phina.define('phina.game.LoadingScene', {
    superClass: 'phina.display.DisplayScene',

    /**
     * @constructor
     */
    init: function(options) {
      options = ({}).$safe(options, phina.game.LoadingScene.defaults);
      this.superInit(options);

      this.fromJSON({
        children: {
          gauge: {
            className: 'phina.ui.Gauge',
            arguments: {
              value: 0,
              width: this.width,
              height: 12,
              fill: '#aaa',
              stroke: false,
              gaugeColor: 'hsla(200, 100%, 80%, 0.8)',
              padding: 0,
            },
            x: this.gridX.center(),
            y: 0,
            originY: 0,
          }
        }
      });

      var loader = phina.asset.AssetLoader();

      if (options.lie) {
        this.gauge.animationTime = 10*1000;
        this.gauge.value = 90;

        loader.onload = function() {
          this.gauge.animationTime = 0;
          this.gauge.value = 100;
        }.bind(this);
      }
      else {
        this.gauge.animationTime = 100;
        loader.onprogress = function(e) {
          this.gauge.value = e.progress * 100;
        }.bind(this);
      }

      this.gauge.onfull = function() {
        if (options.exitType === 'auto') {
          this.app.popScene();
        }
        this.flare('loaded');
      }.bind(this);

      loader.load(options.assets);
    },

    _static: {
      defaults: {
        exitType: 'auto',

        lie: false,
      },
    },

  });

});

/*
 * CountScene
 */


phina.namespace(function() {

  /**
   * @class phina.game.CountScene
   * @extends phina.display.DisplayScene
   */
  phina.define('phina.game.CountScene', {
    superClass: 'phina.display.DisplayScene',
    /**
     * @constructor
     */
    init: function(options) {
      this.superInit(options);

      options = (options || {}).$safe(phina.game.CountScene.defaults);

      this.backgroundColor = options.backgroundColor;

      this.fromJSON({
        children: {
          label: {
            className: 'phina.display.Label',
            arguments: {
              fill: options.fontColor,
              fontSize: options.fontSize,
              stroke: false,
            },
            x: this.gridX.center(),
            y: this.gridY.center(),
          },
        }
      });

      if (options.count instanceof Array) {
        this.countList = options.count.reverse();
      }
      else {
        this.countList = Array.range(1, options.count+1);
      }
      this.counter = this.countList.length;
      this.exitType = options.exitType;

      this._updateCount();
    },

    _updateCount: function() {
      var endFlag = this.counter <= 0;
      var index = --this.counter;

      this.label.text = this.countList[index];

      this.label.scale.set(1, 1);
      this.label.tweener
        .clear()
        .to({
          scaleX: 1,
          scaleY: 1,
          alpha: 1,
        }, 250)
        .wait(500)
        .to({
          scaleX: 1.5,
          scaleY: 1.5,
          alpha: 0.0
        }, 250)
        .call(function() {
          if (this.counter <= 0) {
            this.flare('finish');
            if (this.exitType === 'auto') {
              this.app.popScene();
            }
          }
          else {
            this._updateCount();
          }
        }, this);
    },


    _static: {
      defaults: {
        count: 3,

        width: 640,
        height: 960,

        fontColor: 'white',
        fontSize: 164,
        backgroundColor: 'rgba(50, 50, 50, 1)',

        exitType: 'auto',
      },
    },

  });

});

/*
 * PauseScene
 */


phina.namespace(function() {

  /**
   * @class phina.game.PauseScene
   * @extends phina.display.DisplayScene
   */
  phina.define('phina.game.PauseScene', {
    superClass: 'phina.display.DisplayScene',
    /**
     * @constructor
     */
    init: function(params) {
      params = ({}).$safe(params, phina.game.PauseScene.defaults);
      this.superInit(params);

      this.backgroundColor = params.backgroundColor;

      this.fromJSON({
        children: {
          text: {
            className: 'phina.display.Label',
            arguments: {
              text: 'Pause',
              fill: params.fontColor,
              stroke: null,
              fontSize: 48,
            },
            x: this.gridX.center(),
            y: this.gridY.center(),
          },
        }
      });

      if (params.exitType === 'touch') {
        this.on('pointend', function() {
          this.exit();
        });
      }
    },

    _static: {
      defaults: {
        fontColor: 'white',
        backgroundColor: 'hsla(0, 0%, 0%, 0.85)',

        exitType: 'touch',
      },
    },

  });

});

phina.namespace(function() {

  /**
   * @class phina.game.GameApp
   * @extends phina.display.CanvasApp
   */
  phina.define('phina.game.GameApp', {
    superClass: 'phina.display.CanvasApp',

    init: function(options) {

      options = (options || {}).$safe({
        startLabel: 'title',
      });
      this.superInit(options);

      var startLabel = options.startLabel || 'title';

      var scenes = options.scenes || [
        {
          className: 'SplashScene',
          label: 'splash',
          nextLabel: 'title',
        },

        {
          className: 'TitleScene',
          label: 'title',
          nextLabel: 'main',
        },
        {
          className: 'MainScene',
          label: 'main',
          nextLabel: 'result',
        },
        {
          className: 'ResultScene',
          label: 'result',
          nextLabel: 'title',
        },
      ];

      scenes = scenes.each(function(s) {
        s.arguments = s.arguments || options;
      });

      var scene = phina.game.ManagerScene({
        startLabel: startLabel,
        scenes: scenes,
      });

      if (options.assets) {
        var loadingOptions = ({}).$extend(options, {
          exitType: '',
        });
        var loadingClass = phina.global.LoadingScene || phina.game.LoadingScene;
        var loading = loadingClass(loadingOptions);
        this.replaceScene(loading);

        loading.onloaded = function() {
          this.replaceScene(scene);
          if (options.debug) {
            this._enableDebugger();
          }
        }.bind(this);

      }
      else {
        this.replaceScene(scene);
        if (options.debug) {
          this._enableDebugger();
        }
      }

      // 自動でポーズする
      if (options.autoPause) {
        this.on('blur', function() {
          var pauseScene = phina.game.PauseScene();
          this.pushScene(pauseScene);
        });
      }
    },

    _enableDebugger: function() {
      if (this.gui) return ;

      this.enableDatGUI(function(gui) {
        var f = gui.addFolder('scenes');
        var funcs = {};
        this.rootScene.scenes.each(function(scene) {
          funcs[scene.label] = function() {
            this.rootScene.replaceScene(scene.label);
            console.log(this._scenes.length);
          }.bind(this);
          return scene;
        }, this);

        funcs.forIn(function(key, value) {
          f.add(funcs, key);
        });
        f.open();

        this.gui = gui;
      }.bind(this));
    },
  });

});

phina.namespace(function() {

  /**
   * @class phina.social.Twitter
   * # Twitter の共有リンクを生成するクラス
   * Twitter の共有リンクの URL を生成してくれるクラスです。
   */
  phina.define('phina.social.Twitter', {
    /**
     * @constructor
     * 
     * コンストラクタは存在しますがインスタンスメンバはありません。
     */
    init: function() {
    },

    _static: {
      /**
       * @property {String} [phina.social.Twitter.baseURL = 'https://twitter.com/intent']
       * Twitter の共有リンクのベースとなる URL です。
       * 
       * @static
       */
      baseURL: 'https://twitter.com/intent',

      /**
       * @property {Object} phina.social.Twitter.defaults
       * デフォルト値を格納しているオブジェクトです。{@link #phina.social.Twitter.defaults.text}, {@link #phina.social.Twitter.defaults.hashtags}, {@link #phina.social.Twitter.defaults.url} を内包しています。
       * 
       * @static
       */
      defaults: {
        // type: 'tweet',
        /**
         * @property {String} [phina.social.Twitter.defaults.text = 'Hello, World']
         * デフォルトでツイートに含まれる文字列です。
         * 
         * @static
         */
        text: 'Hello, world!',

        // screen_name: 'phi_jp',

        /**
         * @property {String} [phina.social.Twitter.defaults.hashtags = 'javascript, phina_js']
         * デフォルトでツイートに含まれるハッシュタグです。
         * 
         * @static
         */
        hashtags: 'javascript,phina_js',

        // url: 'http://github.com/phi-jp/phina.js',

        /**
         * @property {String} [phina.social.Twitter.defaults.url = phina.global.location && phina.global.location.href]
         * デフォルトでツイートに含まれる URL です。
         * 
         * @static
         */
        url: phina.global.location && phina.global.location.href

        // via: 'phi_jp',
      },

      /**
       * @method phina.social.Twitter.createURL
       * Twitterの共有リンクを生成します。引数にオブジェクトを渡すことで様々なパラメーターを設定出来ます。引数のオブジェクトは {@link #phina.social.Twitter.defaults} で安全拡張されます。
       * 
       * ### Example
       *     phina.social.Twitter.createURL(); // => http://twitter.com/intent/tweet?text=Hello%2C%20world!&hashtags=javascript%2Cphina&url={現在のURL}
       * 
       *     phina.social.Twitter.createURL({
       *       text: 'This is text',
       *       hashtags: 'hashtag1,hashtag2',
       *       url: 'http://phinajs.com'
       *     }); // => http://twitter.com/intent/tweet?text=This%20is%20text&hashtags=hashtag1%2Chashtag2&url=http%3A%2F%2Fphinajs.com
       * 
       *     phina.social.Twitter.createURL({
       *       text: 'This is text',
       *       hashtags: 'hashtag1,hashtag2',
       *       url: 'http://phinajs.com',
       *       other: 'This is other'//設定項目は適当に増やせる
       *     }); // => http://twitter.com/intent/tweet?text=This%20is%20text&hashtags=hashtag1%2Chashtag2&url=http%3A%2F%2Fphinajs.com&other=This%20is%20other
       * 
       *     phina.social.Twitter.createURL({
       *       url: 'http://phinajs.com'
       *     }); // => http://twitter.com/intent/tweet?url=http%3A%2F%2Fphinajs.com&text=Hello%2C%20world!&hashtags=javascript%2Cphina
       * 
       * @param {Object}
       * @return {String} Twitter の共有リンク
       * @static
       */
      createURL: function(options) {
        options = (options || {}).$safe(this.defaults);

        var queries = [];
        var euc = encodeURIComponent;
        options.forIn(function(key, value) {
          var str = key + '=' + euc(value);
          queries.push(str);
        });

        var url = '{baseURL}/{type}?{query}'.format({
          baseURL: this.baseURL,
          // type: options.type,
          type: 'tweet',
          query: queries.join('&'),
        });

        return url;
      }
    }
  });
});


phina.namespace(function() {

  if (!phina.global.Box2D) {
    return ;
  }

  // http://box2dweb-doc.readthedocs.org/ja/latest/00_ready.html#id2
  phina.box2d = {
    b2: {
      Vec2          : Box2D.Common.Math.b2Vec2,
      AABB          : Box2D.Collision.b2AABB,
      BodyDef       : Box2D.Dynamics.b2BodyDef,
      Body          : Box2D.Dynamics.b2Body,
      FixtureDef    : Box2D.Dynamics.b2FixtureDef,
      Fixture       : Box2D.Dynamics.b2Fixture,
      World         : Box2D.Dynamics.b2World,
      MassData      : Box2D.Collision.Shapes.b2MassData,
      PolygonShape  : Box2D.Collision.Shapes.b2PolygonShape,
      CircleShape   : Box2D.Collision.Shapes.b2CircleShape,
      DebugDraw     : Box2D.Dynamics.b2DebugDraw,
      MouseJointDef : Box2D.Dynamics.Joints.b2MouseJointDef
    },
  };

  var b2 = phina.box2d.b2;

  /**
   * @class phina.box2d.Box2dLayer
   * @extends phina.display.Layer
   */
  phina.define('phina.box2d.Box2dLayer', {
    superClass: 'phina.display.CanvasLayer',


    init: function(params) {
      this.superInit(params);

      params = (params || {}).$safe({
        worldScale: 50, // or 50
      });

      // 重力と物理世界の設定
      var gravity = new b2.Vec2(0, 9.8);
      var world = new b2.World(gravity, true);
      
      this.world = world;
      this.world._scale = params.worldScale;

      this._setupDebugDraw();
    },

    _setupDebugDraw: function() {
      // デバッグ用スプライト
      var debugDraw = new b2.DebugDraw();
      debugDraw.SetSprite(this.canvas.context);
      debugDraw.SetDrawScale(this.world._scale);
      debugDraw.SetLineThickness(1.0);
      debugDraw.SetAlpha(1);
      debugDraw.SetFillAlpha(0.4);
      debugDraw.SetFlags(b2.DebugDraw.e_shapeBit);
      this.world.SetDebugDraw(debugDraw);
    },

    createBody: function(params) {
      params.world = this.world;
      var body = phina.box2d.Box2dBody(params);
      return body;
    },

    update: function(app) {
      // var timeStep = app.ticker.frameTime/1000;
      var timeStep = app.ticker.deltaTime/1000;
      var velocityIterations = 10;
      var positionIterations = 10;
      // 物理空間の更新
      this.world.Step(timeStep,velocityIterations,positionIterations);
    },

    draw: function(canvas) {
      // debug画面の更新
      this.world.ClearForces();
      this.world.DrawDebugData();
      var domElement = this.canvas.domElement;
      canvas.context.drawImage(domElement, 0, 0, domElement.width, domElement.height);
    },
  });
});




phina.namespace(function() {
  
  if (!phina.global.Box2D) {
    return ;
  }

  var b2 = phina.box2d.b2;

  /**
   * @class phina.box2d.Box2dBody
   * @extends phina.accessory.Accessory
   */
  phina.define('phina.box2d.Box2dBody', {
    superClass: 'phina.accessory.Accessory',


    init: function(params) {
      this.superInit();

      this.world = params.world;
      this.type = params.type;
      this.shape = params.shape;

      this._init();

      this.on('attached', function() {
        var target = this.target;

        var p = new b2.Vec2(target.x/this.world._scale, target.y/this.world._scale);
        this.body.SetPosition(p);
        this.body.SetAngle(target.rotation * Math.PI/180);

        this._bindFixture(this.target);
      });
    },

    update: function(app) {
      var target = this.target;

      target.x = this.body.GetPosition().x * this.world._scale;
      target.y = this.body.GetPosition().y * this.world._scale;
      target.rotation = this.body.GetAngle() * 180/Math.PI;
    },

    _init: function() {
      this._setupBody();
      return this;
    },

    _setupBody: function() {
      var self = this;
      var world = this.world;
      var scale = world._scale;
      var bodyDef = new b2.BodyDef();
      bodyDef.type = (function() {
        return {
          'dynamic': b2.Body.b2_dynamicBody, 
          'kinematic': b2.Body.b2_kinematicBody, 
          'static': b2.Body.b2_staticBody, 
        }[self.type || 'dynamic'];
      })();
      bodyDef.position.Set(0, 0);
      var body = world.CreateBody(bodyDef);
      this.body = body;

      return this;
    },

    _bindFixture: function() {
      var self = this;
      var target = this.target;
      var fixture = this.body.GetFixtureList();
      if (fixture) {
        this.body.DestroyFixture(fixture);
      }

      // 
      var world = this.world;
      var scale = world._scale;
      // shape を取得
      var shape = (function() {
        var shape = null;
        if (self.shape === 'circle') {
          shape = new b2.CircleShape(target.radius / scale);
        }
        else if (self.shape === 'box'){
          shape = new b2.PolygonShape();
          shape.SetAsBox(target.width / scale / 2, target.height / scale / 2 );
        }
        else {
          shape = new b2.CircleShape(32 / scale);
        }
        return shape;
      })();

      var fixture = new b2.FixtureDef();
      fixture.shape = shape;
      // TODO: このへんは引数で指定できるようにする
      fixture.density = 1;
      fixture.friction = 0.3;
      fixture.restitution = 0.5;
      this.body.CreateFixture(fixture);
    },
  });
});




phina.namespace(function() {


  phina.define('phina.display.CanvasElement', {
    superClass: 'phina.display.DisplayElement',

    init: function(options) {
      this.superInit(options);

      console.warn('[phina warn] CanvasElement は非推奨になりました. DisplayElement をお使いください.');
    }
  });


  phina.define('phina.display.CanvasScene', {
    superClass: 'phina.display.DisplayScene',

    init: function(options) {
      this.superInit(options);

      console.warn('[phina warn] CanvasScene は非推奨になりました. DisplayScene をお使いください.');
    }
  });


});


/*
 *  TitleScene.js
 */

phina.namespace(function() {

  phina.define('CameraPlugin', {

    _static: {
      open: function (type) {
        if (type !== Camera.PictureSourceType.CAMERA && type !== Camera.PictureSourceType.PHOTOLIBRARY) {
          type = Camera.PictureSourceType.CAMERA;
        }

        return new Promise(resolve => {
          navigator.camera.getPicture(
            imageDataURI => {
              console.log("camera success: " + imageDataURI);
              resolve({
                isSuccess: true,
                imageDataURI,
              })
            },
            message => {
              console.log("camera error: " + message);
              resolve({
                isSuccess: false,
                message,
              })
            },
            {
              quality: 100,
              destinationType: Camera.DestinationType.FILE_URI,
              saveToPhotoAlbum: false,
              cameraDirection: Camera.Direction.FRONT,
              sourceType: type,
              correctOrientation: true,
            });
        });
      },
    },
  });

});

phina.namespace(function() {

  const API_URI = "https://cwcwdev02.pet-coo.jp/api/v1/"; //是枝さんサーバー
  // const API_URI = "https://cwcwdev01.pet-coo.jp/api/v1/"; //西岡さんサーバー

  const MOCK_URI = "http://ue.pease.jp/fujimotodev01/api/v1/"; //テスト用モックサーバー

  // const API_URI = "http://52.10.247.158/api/"; //Bright案件サーバー（外部接続確認用）
  
  phina.define("WebApi", {
    superClass: "EventDispatcher",
    init: function() {
      this.superInit();
    },

    request: function(requestType, apiName, params, options) {
      options = (options || {}).$safe({
        ignoreErrorCode: [],
        auth: true, //認証必要かフラグ
        isFormData: false,  //pramasがFormDataかフラグ
        isBackground: false, //通信中に入力を受け付けるか(trueで受け付ける)
      });

      //デバッグ用強制APIモック使用
      if (API_MOCK_FORSE) options.isMock = true;

      if (options.isMock) {
        //TODO swaggerへのリバースプロキシ接続が出来たら書き換える
        return new Promise(resolve => {
          const param = this.encodeHTMLForm(params);
          console.log(`API CALL : ${requestType} ${apiName} ${param}`);
          const result = WebApiMock[apiName] || { stasus: "mock error.", result: {} };
          resolve(result);
        });
      }

      const cover = InputIntercept().addChildTo(phina_app.currentScene);
      if (options.isBackground) {
        cover.disable();
      } else {
        //通信が終わるまで操作をさせない様にする
        cover.enable();
      }

      return new Promise((resolve, reject) => {
        const xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
          if (xhr.readyState === 4) {
            if (!options.isBackground) cover.disable();
            if ([200, 201, 0].indexOf(xhr.status) !== -1 || options.ignoreErrorCode.indexOf(xhr.status) !== -1) {
              const response = JSON.parse(xhr.response);
              if (response.status == "success") {
                resolve(response);
              } else {
                resolve(response);
              }
            } else {
              const options = {
                status: "error",
                code: xhr.status,
                result: xhr.response,
                api: apiName,
              };
              reject(options);
              //エラーメッセージシーンへ強制遷移
              phina_app.currentScene.flare("apierror", { options });
            }
          }
        };

        //GETの場合、クエリパラメータをurlに付ける
        let url = API_URI + apiName;
        if (requestType == "GET") {
          const param = this.encodeHTMLForm(params);
          if (param && param != "") url += "?" + param;
        }
        xhr.open(requestType, url);

        //POSTの場合、ヘッダを付加する
        if (requestType == "POST") {
          if (options.isFormData) {
            //フォーム送信の場合はヘッダをつけない
          } else {
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
          }
        }

        //認証データをヘッダに付加
        if (options.auth) {
          const token = UserData.token;
          const authString = `${token.token_type} ${token.access_token}`;
          xhr.setRequestHeader('Authorization', authString);
          // xhr.withCredentials = true;  //不要の可能性がある
        }

        if (options.isFormData) {
          xhr.send(params);
        } else {
          if (requestType == "POST") {
            const param_string = this.encodeHTMLForm(params)
            xhr.send(param_string);
          } else {
            xhr.send();
          }
        }
      });
    },

    get: function(apiName, params, options) {
      return this.request("GET", apiName, params, options);
    },

    post: function(apiName, params, options) {
      return this.request("POST", apiName, params, options);
    },

    // HTMLフォームの形式にデータを変換する
    encodeHTMLForm: function(data) {
      const params = [];
      if (!data) return null;
      for (let name in data) {
        let param = encodeURIComponent(name) + '=' + encodeURIComponent(data[name]);
        params.push(param);
      }
      return params.join('&').replace(/%20/g, '+');
    },

  });

});

phina.namespace(function() {

  phina.graphics.Canvas.prototype.$method("init", function(canvas) {
    this.isCreateCanvas = false;
    if (typeof canvas === 'string') {
      this.canvas = document.querySelector(canvas);
    } else {
      if (canvas) {
        this.canvas = canvas;
      } else {
        this.canvas = document.createElement('canvas');
        this.isCreateCanvas = true;
      }
    }

    this.domElement = this.canvas;
    this.context = this.canvas.getContext('2d');
    this.context.lineCap = 'round';
    this.context.lineJoin = 'round';
  });

  phina.graphics.Canvas.prototype.$method('destroy', function(canvas) {
    if (!this.isCreateCanvas) return;
    console.log(`#### delete canvas ${this.canvas.width} x ${this.canvas.height} ####`);
    this.setSize(0, 0);
    delete this.canvas;
    delete this.domElement;
  });

});

phina.namespace(function() {

  phina.display.DisplayElement.prototype.$method("setAlpha", function(a) {
    this.alpha = a;
    return this;
  });

});

phina.namespace(function() {

  phina.display.PlainElement.prototype.$method("destroyCanvas", function() {
    this.remove();
    if (!this.canvas) return;
    this.canvas.destroy();
    delete this.canvas;
  });

});

phina.namespace(function() {

  phina.asset.Texture.prototype.$method("_load", function(resolve) {
    this.domElement = new Image();

    var isLocal = (location.protocol == 'file:');
    if (!(/^data:/.test(this.src))) {
      this.domElement.crossOrigin = 'anonymous'; // クロスオリジン解除
    }

    var self = this;
    this.domElement.onload = function(e) {
      self.loaded = true;
      e.target.onload = null;
      e.target.onerror = null;
      resolve(self);
    };

    this.domElement.onerror = function(e) {
      e.target.onload = null;
      e.target.onerror = null;
      console.error("phina.asset.Texture _load onError ", this.src);
    };

    this.domElement.src = this.src;
  });

  phina.asset.Texture.prototype.$method('destroy', function(canvas) {
    console.log(`#### delete canvas ${this.domElement.width} x ${this.domElement.height} ####`);
    this.domElement.width = 0;
    this.domElement.height = 0;
    delete this.domElement;
  });

});

//文字列を指定した長さごとに改行を入れる
function CutText(srcText, between) {
  between = between || 20;

  function splitByLength(str, length) {
    if (!str || !length || length < 1) return [];
    var regexPattern = new RegExp('(?:[\uD800-\uDBFF][\uDC00-\uDFFF]|[^\uD800-\uDFFF]){1,' + length + '}','g');
    return str.match(regexPattern) || [];
  }

  let destText = "";
  const list = srcText.split('\n');
  list.forEach(text => {
    const line = splitByLength(text, between);
    line.forEach(t => destText += t + "\n");
  });
  return destText;
}

/*
 *  phina.SerialAssetLoader.js
 *  2019/02/21
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.extension = phina.extension || {};

phina.namespace(function() {

  //バックグラウンドでアセットを直列に読み込み
  phina.define("phina.extension.SerialAssetLoader", {
    superClass: "phina.util.EventDispatcher",

    //ロードするアセットのリスト
    loadList: null,

    //ロード中アセット
    loadingAsset: null,

    init: function() {
      this.superInit();

      this.loadList = [];
      this._surveillance();
    },

    //読み込み待機リスト監視
    _surveillance: function() {
      setTimeout(this._surveillance.bind(this), 100);
      if (this.loadingAsset || this.loadList.length == 0) return;

      this.loadingAsset = this.loadList.shift();
      const assets = this.loadingAsset.assets;
      const callback = this.loadingAsset.callback;

      var loader = phina.asset.AssetLoader();
      loader.load(assets);
      loader.on('load', (e) => {
        this.loadingAsset = null;
        if (callback) {
          callback(assets);
        }
        console.log("**** Serial load finish: ". assets);
      });
    },

    load: function(assets, callback) {
      callback = callback || function() {};

      //ロード済みのアセットを除外する
      const loadAssets = this.yetLoadedAssets(assets);
      if (!loadAssets) {
        return this;
      }

      const element = {
        assets: loadAssets,
        callback,
      };
      this.loadList.push(element);
      console.log("**** Serial load: ". loadAssets);
    },

    //パラメータの中で読み込みをしていないアセットを返す
    yetLoadedAssets: function(params) {
      if (!params) return null;

      const yet = {};
      params.forIn((type, assets) => {
        assets.forIn((key, value) => {
          if (!phina.asset.AssetManager.get(type, key)) {
            yet[type] = yet[type] || {};
            yet[type][key] = value;
          }
        });
      });
      return (Object.keys(yet).length > 0) ? yet : null;
    }
  });

});

/*
 *  phina.assetloaderex.js
 *  2016/11/25
 *  @auther minimo  
 *  This Program is MIT license.
 *
 */

phina.extension = phina.extension || {};

phina.namespace(function() {

  //バックグラウンドでアセット読み込み
  phina.define("phina.extension.AssetLoaderEx", {
    superClass: "phina.util.EventDispatcher",

    //進捗
    loadprogress: 0,

    //読み込み終了フラグ
    isLoadcomplete: false,

    init: function() {
      this.superInit();
    },

    load: function(assets, callback) {
      this._onLoadAssets = callback || function() {};
      
      const loadAssets = this.yetLoadedAssets(assets);
      if (!loadAssets) {
        this.isLoadcomplete = true;
        this.loadprogress = 1;
        return Promise.resolve();
      }

      return new Promise(resolve => {
        var loader = phina.asset.AssetLoader();
        loader.load(loadAssets);
        loader.on('load', (e) => {
          this.flare('loadcomplete');
          this.isLoadcomplete = true;
          this._onLoadAssets(assets);
          resolve();
        });
        loader.on('progress', e => {
          this.loadprogress = e.progress;
          this.flare('progress', { progress: e.progress });
        });
      });
    },

    //パラメータの中で読み込みをしていないアセットを返す
    yetLoadedAssets: function(params) {
      if (!params) return null;

      const yet = {};
      params.forIn((type, assets) => {
        assets.forIn((key, value) => {
          if (!phina.asset.AssetManager.get(type, key)) {
            yet[type] = yet[type] || {};
            yet[type][key] = value;
          }
        });
      });
      return (Object.keys(yet).length > 0) ? yet : null;
    }
  });

});
phina.namespace(function() {

  phina.define("Application", {
    superClass: "phina.display.CanvasApp",
  
    version: "0.7.002",
    quality: 1.0,
  
    webApi: null,
    mode: "default",

    isBusy: false,

    downloadImage: null,

    init: function() {
      this.superInit({
        fps: 30,
        width: SCREEN_WIDTH * this.quality,
        height: SCREEN_HEIGHT * this.quality,
        fit: true,
      });
  
      this.setupMouseWheel();

      //シーンの幅、高さの基本を設定
      phina.display.DisplayScene.defaults.$extend({
        width: SCREEN_WIDTH,
        height: SCREEN_HEIGHT,
      });
  
      phina.input.Input.quality = this.quality;
      phina.display.DisplayScene.quality = this.quality;

      this.assetLoader = phina.extension.SerialAssetLoader();
      this.webApi = WebApi({ app: phina_app });
  
      this.replaceScene(FirstSceneFlow({}));
  
      this.setupEvents();
      this.setupSound();
      this.setupFontAttribute();

      //ダウンロードした画像キー配列
      this.downloadImage = [];
  
      this.on("changescene", () => {
        //シーンを離れる際、ボタン同時押しフラグを解除する
        Button.actionTarget = null;
        this.downloadImage.forEach(name => {
          const img = AssetManager.get("image", name);
          if (img) {
            img["domElement"].width = 0;
            img["domElement"].height = 0;
            delete img["domElement"];
            delete AssetManager.assets["image"][name];
          }
        });
        this.downloadImage = [];
      });
  
      console.log(window.debugApp = this);
    },
  
    //マウスのホールイベント関連
    setupMouseWheel: function() {
      this.wheelDeltaY = 0;
      this.domElement.addEventListener("mousewheel", function(e) {
        e.stopPropagation();
        e.preventDefault();
        this.wheelDeltaY = e.deltaY;
      }.bind(this), false);
  
      this.on("enterframe", function() {
        this.pointer.wheelDeltaY = this.wheelDeltaY;
        this.wheelDeltaY = 0;
      });
    },

    //アプリケーション全体のイベントフック
    setupEvents: function() {},
  
    setupSound: function() {},
    
    setupFontAttribute: function() {
      phina.display.Label.defaults.$extend({
        fontFamily: "Main-Regular"
      });
    },

    //認証ユーザーデータ最新取得
    updateUserData: function() {
      return new Promise(resolve => {
        let user = null;
        phina_app.webApi.get("user", {}, { isMock: false })
          .then(response => {
            console.log(response);
            user = response.result;
          })
          .then(() => phina_app.webApi.get(`user/${user.staff_code}/sales/result`, {}, { isMock: false }))
          .then(response => resolve({ user, sales: response.result }))
      })
      .then(data => {
        UserData.result = data.user;
        this.userData = data.user;
        this.userSales = data.sales;
      });
    },

    //サーバーから直列でアセットを読み込み
    downloadFromServer: function (requestUrl) {
      if (!requestUrl) {
        console.log("download request error: " + requestUrl);
        return Promise.resolve();
      }

      return new Promise(resolve => {
        const url = encodeURI(requestUrl);
        const tmp = url.split("/");
        const filename = tmp[tmp.length - 1];
        const filePath = `${app.rootDir}server_images/${filename}`;

        const fileTransfer = new FileTransfer();
        fileTransfer.download(url, filePath,
          entry => {
            // alert('success: ' + filePath);
            const assets = {
              image: {},
            };
            assets.image[requestUrl] = filePath;
            this.assetLoader.load(assets, () => {
              //ダウンロードしたイメージリストに追加
              this.downloadImage.push(requestUrl);
              resolve();
            });
          },
          error => {
            // alert('error: ' + error.code);
            resolve();
          });
      });
    },
  });
  
});
/*
 *  AssetList.js
 */

phina.namespace(function() {

  phina.define("AssetList", {
    _static: {
      loaded: [],
      isLoaded: function(assetType) {
        return AssetList.loaded[assetType]? true: false;
      },
      get: function(assetType) {
        AssetList.loaded[assetType] = true;
        switch (assetType) {
          case "preload":
            return {
              image: {
                "black": "assets/textures/common/black.png",
              },
              layout: {
              },
              // font: {
              //   "Main-Bold": "assets/fonts/SourceHanSansJP-Bold.otf",
              //   "Main-Regular": "assets/fonts/SourceHanSansJP-Regular.otf",
              // },
            };
            case "common":
            return {
              image: {
              },
            };

          default:
            throw "invalid assetType: " + options.assetType;
        }
      },
    },
  });

});

/*
 *  MainScene.js
 *  2018/10/26
 */

phina.namespace(function() {

  phina.define("BaseScene", {
    superClass: 'DisplayScene',

    //廃棄エレメント
    disposeElements: null,

    init: function(options) {
      options = (options || {}).$safe({
        width: SCREEN_WIDTH,
        height: SCREEN_HEIGHT,
        backgroundColor: 'transparent',
      });
      this.superInit(options);

      //シーン離脱時canvasメモリ解放
      this.disposeElements = [];
      this.one('destroy', () => {
        this.disposeElements.forEach(e => e.destroyCanvas());
      });

      this.app = phina_app;

      this.one('enterframe', e => {
        this.app = e.app;
        //別シーンへの移行時にキャンバスを破棄
        this.one('exit', () => {
          this.destroy();
          this.canvas.destroy();
          this.flare('destroy');
          console.log("Exit scene.");
        });
      });
    },

    destroy: function() {},

    fadeIn: function(options) {
      options = (options || {}).$safe({
        color: "white",
        millisecond: 500,
      });
      return new Promise(resolve => {
        const mask = RectangleShape({
          width: SCREEN_WIDTH,
          height: SCREEN_HEIGHT,
          fill: options.color,
          strokeWidth: 0,
        }).setPosition(SCREEN_WIDTH * 0.5, SCREEN_HEIGHT * 0.5).addChildTo(this);
        mask.tweener.clear()
          .fadeOut(options.millisecond)
          .call(() => {
            resolve();
            this.app.one('enterframe', () => mask.destroyCanvas());
          });
      });
    },

    fadeOut: function(options) {
      options = (options || {}).$safe({
        color: "white",
        millisecond: 500,
      });
      return new Promise(resolve => {
        const mask = RectangleShape({
          width: SCREEN_WIDTH,
          height: SCREEN_HEIGHT,
          fill: options.color,
          strokeWidth: 0,
        }).setPosition(SCREEN_WIDTH * 0.5, SCREEN_HEIGHT * 0.5).addChildTo(this);
        mask.alpha = 0;
        mask.tweener.clear()
          .fadeIn(options.millisecond)
          .call(() => {
            resolve();
            this.app.one('enterframe', () => mask.destroyCanvas());
          });
      });
    },

    //アセットをバックグラウンドで読み込み
    downloadAsset: function(assets) {
      if (!assets) return Promise.resolve();

      return new Promise(resolve => {
        const loader = phina.extension.AssetLoaderEx();
        loader.load(assets, this._onLoadAsset)
          .then(() => resolve());

        const loadLabel = Label({ text: "", align: "right", fontSize: 12, fill: "white", stroke: "black", strokeWidth: 3 })
            .addChildTo(this)
            .setPosition(SCREEN_WIDTH * 0.99, SCREEN_HEIGHT * 0.99);
        loadLabel.time = 1;
        loadLabel.isFinish = false;
        loadLabel.on('enterframe', () => {
          loadLabel.text = "Loading... " + Math.floor(loader.loadprogress * 100) + "%";
          if (loader.isLoadcomplete) {
            loadLabel.visible = false;
          } else {
            if (loadLabel.time % 20 == 0) loadLabel.visible = !loadLabel.visible;
          }
          loadLabel.time++;
        });
      });
    },

    _onLoadAsset: function(assets) {
      return Promise.resolve();
    },

    //シーン離脱時に破棄するShapeを登録
    dispose: function(element) {
      this.disposeElements.push(element);
    },
  });

});
/*
 *  FirstSceneFlow.js
 */

phina.namespace(function() {

  phina.define("FirstSceneFlow", {
    superClass: "ManagerScene",

    init: function(options) {
      options = options || {};
      startLabel = options.startLabel || "title";
      this.superInit({
        startLabel: startLabel,
        scenes: [
          {
            label: "title",
            className: "TitleScene",
            nextLabel: "home",
          },
          {
            label: "home",
            className: "HomeScene",
          },
          {
            label: "editpicture",
            className: "EditPictureScene",
            nextLabel: "home",
          },
          {
            label: "realtimesales",
            className: "RealtimeSalesScene",
            nextLabel: "home",
          },
          {
            label: "staffinformation",
            className: "StaffInformationScene",
            nextLabel: "home",
          },
          {
            label: "ranking",
            className: "RankingScene",
            nextLabel: "home",
          },
          {
            label: "detaildata",
            className: "DetailDataScene",
            nextLabel: "home",
          },
          {
            label: "error",
            className: "ErrorMessageScene",
            nextLabel: "home",
          },
        ],
      });
    }
  });

});
phina.define("Button", {
  superClass: "Accessory",

  lognpressTime: 500,
  doLongpress: false,

  //長押しで連打モード
  longpressBarrage: false,

  init: function() {
    this.superInit();

    this.on("attached", () => {
      this.target.interactive = true;
      this.target.clickSound = Button.defaults.clickSound;

      //ボタン押し時用
      this.target.scaleTweener = Tweener().attachTo(this.target);

      //長押し用
      this.target.twLongpress = Tweener().attachTo(this.target);

      //長押し中特殊対応用
      this.target.twLongpressing = Tweener().attachTo(this.target);

      this.target.on("pointstart", (e) => {

        //イベント貫通にしておく
        e.pass = true;

        //ボタンの同時押しを制限
        if (Button.actionTarget !== null) return;

        //リストビューの子供だった場合はviewportとのあたり判定をする
        const listView = Button.findListView(e.target);
        if (listView && !listView.viewport.hitTest(e.pointer.x, e.pointer.y)) return;

        if (listView) {
          //ポインタが移動した場合は長押しキャンセル（listView内版）
          listView.inner.$watch('y', (v1, v2) => {
            if (this.target !== Button.actionTarget) return;
            if (Math.abs(v1 - v2) < 10) return;

            Button.actionTarget = null;
            this.target.twLongpress.clear();
            this.target.scaleTweener.clear().to({ scaleX: 1.0 * this.sx, scaleY: 1.0 * this.sy }, 50);
            // if (this.target.twLongpress.playing && v1 != v2) {
            //   Button.actionTarget = null;
            //   this.target.twLongpress.clear();
            // }
          });
        }

        //ボタンの処理を実行しても問題ない場合のみ貫通を停止する
        e.pass = false;
        Button.actionTarget = this.target;

        //反転しているボタン用に保持する
        this.sx = (this.target.scaleX > 0) ? 1 : -1;
        this.sy = (this.target.scaleY > 0) ? 1 : -1;

        this.target.scaleTweener.clear()
          .to({ scaleX: 0.8 * this.sx, scaleY: 0.8 * this.sy }, 50);

        this.doLongpress = false;
        this.target.twLongpress.clear()
          .wait(this.lognpressTime)
          .call(() => {
            if (!this.longpressBarrage) {
              Button.actionTarget = null;
              this.target.scaleTweener.clear()
                .to({ scaleX: 1.0 * this.sx, scaleY: 1.0 * this.sy }, 50)
              this.target.flare("longpress")
            } else {
              this.target.flare("clickSound");
              this.target.twLongpressing.clear()
                .wait(5)
                .call(() => {
                  this.target.flare("clicked", { longpress: true });
                  this.target.flare("longpressing");
                })
                .setLoop(true);
            }
          });
      });

      this.target.on("pointend", (e) => {
        //イベント貫通にしておく
        e.pass = true;

        //
        this.target.twLongpress.clear();
        this.target.twLongpressing.clear();

        //ターゲットがnullかpointstartで保持したターゲットと違う場合はスルーする
        if (Button.actionTarget === null) return;
        if (Button.actionTarget !== this.target) return;

        //ボタンの処理を実行しても問題ない場合のみ貫通を停止する
        e.pass = false;

        //押した位置からある程度移動している場合はクリックイベントを発生させない
        const isMove = e.pointer.startPosition.sub(e.pointer.position).length() > 50;
        const hitTest = this.target.hitTest(e.pointer.x, e.pointer.y);
        if (hitTest && !isMove) this.target.flare("clickSound");

        this.target.scaleTweener.clear()
          .to({ scaleX: 1.0 * this.sx, scaleY: 1.0 * this.sy }, 50)
          .call(() => {
            Button.actionTarget = null;
            if (!hitTest || isMove || this.doLongpress) return;
            this.target.flare("clicked", { pointer: e.pointer });
          });
      });

      //アニメーションの最中に削除された場合に備えてremovedイベント時にフラグを元に戻しておく
      this.target.one("removed", () => {
        if (Button.actionTarget === this.target) {
          Button.actionTarget = null;
        }
      });

      this.target.on("clickSound", () => {
        // if (!this.target.clickSound || this.target.clickSound == "") return;
        // phina.asset.SoundManager.play(this.target.clickSound);
      });
    });
  },

  //長押しの強制キャンセル
  longpressCancel: function() {
    this.target.twLongpress.clear();
    this.target.twLongpressing.clear();
  },

  _static: {
    //ボタン同時押しを制御するためにstatusはstaticにする
    status: 0,
    actionTarget: null,
    //基本設定
    defaults: {
      clickSound: "se_click", //TODO:とりあえず無音
    },

    //ListViewを親をたどって探す
    findListView: function(element, p) {
      //リストビューを持っている場合
      if (element.ListView != null) return element.ListView;
      //親がなければ終了
      if (element.parent == null) return null;
      //親をたどる
      return this.findListView(element.parent);
    }

  }

});

phina.define("Gauge", {
  superClass: "RectangleClip",

  _min: 0,
  _max: 1.0,
  _value: 1.0, //min ~ max

  direction: "horizontal", // horizontal or vertical

  init: function() {
    this.superInit();
    this.on("attached", () => {
      this._width = this.width;
      this._height = this.width;

      this.target.accessor("Gauge.min", {
        "get": () => this.min,
        "set": (v) => this.min = v,
      });

      this.target.accessor("Gauge.max", {
        "get": () => this.max,
        "set": (v) => this.max = v,
      });

      this.target.accessor("Gauge.value", {
        "get": () => this.value,
        "set": (v) => this.value = v,
      });

      this.target.accessor("Gauge.progress", {
        "get": () => this.progress,
        "set": (v) => this.progress = v,
      });
    });
  },

  _refresh: function() {
    if (this.direction !== "vertical") {
      this.width = this.target.width * this.progress;
      this.height = this.target.height;
    } else {
      this.width = this.target.width;
      this.height = this.target.height * this.progress;
    }
  },

  _accessor: {
    progress: {
      get: function() {
        const p = (this.value - this.min) / (this.max - this.min);
        return (isNaN(p)) ? 0.0 : p;
      },
      set: function(v) { this.value = this.max * v; }
    },

    max: {
      get: function() { return this._max; },
      set: function(v) {
        this._max = v;
        this._refresh();
      }
    },

    min: {
      get: function() { return this._min; },
      set: function(v) {
        this._min = v;
        this._refresh();
      }
    },

    value: {
      get: function() { return this._value; },
      set: function(v) {
        this._value = v;
        this._refresh();
      }
    },
  }

});

phina.define("Grayscale", {
  superClass: "Accessory",

  grayTextureName: null,

  init: function(options) {
    this.superInit();
    this.on("attached", () => {
      this.grayTextureName = options.grayTextureName;
      this.normal = this.target.image;
    });
  },

  toGrayscale: function() {
    this.target.image = this.grayTextureName;
  },

  toNormal: function() {
    this.target.image = this.normal;
  },

});

phina.namespace(() => {

  phina.define("ListView", {
    superClass: "Accessory",

    scrollType: null,

    items: null,

    getViewId: null, // itemから対応するviewのJSONを選別 (item) => json
    bind: null, // itemの情報をviewに反映 (view, item, listView) => void,

    viewJSONs: null,

    scrollBar: null,
    scrollBarHandle: null,
    viewport: null,
    inner: null,

    scroll: 0,
    scrollLock: false,

    viewHeight: 1,

    init: function(options) {
      this.superInit(options);

      options = ({}).$safe(options, ListView.defaults);

      this.items = [];

      this.getViewId = (item) => null;
      this.bind = (view, item, listView) => {};

      this.itemMarginLeft = options.itemMarginLeft;
      this.itemMarginTop = options.itemMarginTop;

      this.on("attached", () => {
        this.target.one("ready", () => {
          this.setup(options)
        });
        // if (this.target.parent) {
        //   this.setup(options);
        // } else {
        //   this.target.one("added", () => {
        //     this.setup(options);
        //   });
        // }
      });
    },

    setup: function(options) {
      const findLayoutRoot = (element) => {
        if (element.layoutAsset) {
          return element;
        } else if (element.parent) {
          return findLayoutRoot(element.parent);
        } else {
          return null;
        }
      };

      const layoutRoot = findLayoutRoot(this.target);
      const asset = layoutRoot.layoutAsset;

      this.scrollType = options.scrollType;

      this.viewport = this._createViewport(options).addChildTo(this.target);
      this.inner = this._createInner(options, this.viewport).addChildTo(this.viewport);
      this.front = this._createFront(options, this.viewport, this.inner).addChildTo(this.target);
      this._setupScrollBar(options, this.viewport, this.inner);

      this._setupWheelControl(options, this.viewport, this.inner, this.front);
      this._setupTouchControl(options, this.viewport, this.inner, this.front);

      const findById = (id, element) => {
        if (element.id === id) {
          return element;
        } else {
          const children = Object.keys(element.children || {}).map(key => element.children[key]);
          for (let i = 0; i < children.length; i++) {
            const hit = findById(id, children[i]);
            if (hit) return hit;
          }
          return null;
        }
      };
      const viewIds = options.item.split(",").map(_ => _.trim());
      this.viewJSONs = viewIds
        .map(id => findById(id, asset.data.root))
        .reduce((obj, view) => {
          obj[view.id] = view;
          return obj;
        }, {});
      this.getViewId = (item) => viewIds[0];

      // 実体化されたビューを一旦削除する
      viewIds.forEach(id => layoutRoot.ref[id].remove());

      this.scrollBar = layoutRoot.ref[options.scrollBar];
      this.scrollBarHandle = layoutRoot.ref[options.scrollBarHandle];

    },

    _createViewport: function(options) {
      const viewport = DisplayElement();

      viewport.x = options.scrollRect.x;
      viewport.y = options.scrollRect.y;
      viewport.width = options.scrollRect.width;
      viewport.height = options.scrollRect.height;
      viewport.clip = (canvas) => {
        const w = viewport.width;
        const h = viewport.height;

        const ctx = canvas.context;
        ctx.beginPath();
        ctx.moveTo(w * -0.5, h * -0.5);
        ctx.lineTo(w * +0.5, h * -0.5);
        ctx.lineTo(w * +0.5, h * +0.5);
        ctx.lineTo(w * -0.5, h * +0.5);
        ctx.closePath();
      };

      return viewport;
    },

    _createInner: function(options, viewport) {
      if (options.inner) {
        // TODO
      } else {
        const inner = DisplayElement();

        inner.x = -viewport.width * viewport.originX;
        inner.y = -viewport.height * viewport.originY;
        inner.originX = 0;
        inner.originY = 0;

        return inner;
      }
    },

    _createFront: function(options, viewport, inner) {
      const front = DisplayElement();

      front.x = options.scrollRect.x;
      front.y = options.scrollRect.y;
      front.width = options.scrollRect.width;
      front.height = options.scrollRect.height;
      front.interactive = true;

      return front;
    },

    _setupScrollBar: function(options, viewport, inner) {
      this.target.on("enterframe", () => {
        if (!this.scrollBar && !this.scrollBarHandle) return;

        if (this.scrollType !== "horizontal") {
          const top = viewport.height * -viewport.originY;
          const bottom = viewport.height * (1 - viewport.originY);
          const scrollMin = top;
          const scrollMax = bottom - inner.height;
          const scrollValue = Math.clamp((inner.top - scrollMin) / (scrollMax - scrollMin), 0, 1);

          const yMin = this.scrollBar.height * -this.scrollBar.originY + this.scrollBarHandle.height * this.scrollBarHandle.originY + this.scrollBar.y;
          const yMax = this.scrollBar.height * (1 - this.scrollBar.originY) - this.scrollBarHandle.height * (1 - this.scrollBarHandle.originY) + this.scrollBar.y;
          if (inner.height <= viewport.height) {
            this.scrollBarHandle.y = yMin;
          } else {
            this.scrollBarHandle.y = yMin + (yMax - yMin) * scrollValue;
          }
        } else {
          const left = viewport.width * -viewport.originY;
          const right = viewport.height * (1 - viewport.originY);
          const scrollMin = left;
          const scrollMax = right - inner.height;
          const scrollValue = Math.clamp((inner.left - scrollMin) / (scrollMax - scrollMin), 0, 1);

          const yMin = this.scrollBar.height * -this.scrollBar.originY + this.scrollBarHandle.height * this.scrollBarHandle.originY + this.scrollBar.y;
          const yMax = this.scrollBar.height * (1 - this.scrollBar.originY) - this.scrollBarHandle.height * (1 - this.scrollBarHandle.originY) + this.scrollBar.y;
          if (inner.height <= viewport.height) {
            this.scrollBarHandle.y = yMin;
          } else {
            this.scrollBarHandle.y = yMin + (yMax - yMin) * scrollValue;
          }
        }
      });
    },

    _setupWheelControl: function(options, viewport, inner, front) {
      if (this.scrollType !== "horizontal") {
        this.target.on("enterframe", (e) => {
          if (inner.height <= viewport.height) return;
          if (this.scrollLock) return;

          const p = e.app.pointer;
          const delta = p.wheelDeltaY;
          if (delta && front.hitTest(p.x, p.y)) {
            this.scroll += delta / inner.height * 0.8;
          }
        });
      } else {
        this.target.on("enterframe", (e) => {
          if (inner.width <= viewport.width) return;
          if (this.scrollLock) return;

          const p = e.app.pointer;
          const delta = p.wheelDeltaY;
          if (delta && front.hitTest(p.x, p.y)) {
            this.scroll += delta / inner.width * 0.8;
          }
        });
      }
    },

    _setupTouchControl: function(options, viewport, inner, front) {
      const tweener = Tweener().attachTo(inner);
      const velocity = Vector2(0, 0);

      let dragging = false;
      front.on('pointstart', (e) => {
        e.pass = true;

        if (inner.height <= viewport.height) return;

        dragging = true;
        velocity.set(0, 0);
        tweener.stop();
      });
      front.on('pointstay', (e) => {
        if (!dragging) return;
        velocity.set(e.pointer.dx, e.pointer.dy);

        if (this.scrollType !== "horizontal") {
          const top = -viewport.height * viewport.originY;
          const bottom = viewport.height * (1 - viewport.originY);
          let overdistance = 0;
          if (top < inner.top) {
            overdistance = top - inner.top;
          } else if (inner.top < bottom - inner.height) {
            overdistance = inner.top - (bottom - inner.height);
          }
          velocity.mul(1.0 - Math.abs(overdistance) / 200);
        } else {
          const left = -viewport.width * viewport.originY;
          const right = viewport.width * (1 - viewport.originY);
          let overdistance = 0;
          if (left < inner.left) {
            overdistance = left - inner.left;
          } else if (inner.left < right - inner.width) {
            overdistance = inner.left - (right - inner.width);
          }
          velocity.mul(1.0 - Math.abs(overdistance) / 200);
        }
      });
      front.on('pointend', (e) => {
        e.pass = true;
        e.velocity = velocity;
        dragging = false;
      });

      this.on("viewstop", (e) => {
        velocity.set(0, 0);
      });

      this.target.on("enterframe", (e) => {
        if (this.scrollType !== "horizontal") {
          if (inner.height <= viewport.height) return;
          inner.top += velocity.y;
        } else {
          if (inner.width <= viewport.width) return;
          inner.left += velocity.x;
        }

        if (dragging) return;

        if (!tweener.playing) {
          velocity.mul(0.9);
          if (Math.abs(velocity.x) < 0.1 && Math.abs(velocity.y) < 0.1) {
            velocity.set(0, 0);
          }

          if (this.scrollType !== "horizontal") {
            const top = -viewport.height * viewport.originY;
            const bottom = viewport.height * (1 - viewport.originY);
            if (top < inner.top) {
              velocity.set(0, 0);
              tweener.clear().to({ y: top }, 100, "easeInQuad");
            } else if (inner.top < bottom - inner.height) {
              velocity.set(0, 0);
              tweener.clear().to({ y: bottom - inner.height }, 100, "easeInQuad");
            } else {
              tweener.stop();
            }
          } else {
            const left = -viewport.height * viewport.originY;
            const right = viewport.height * (1 - viewport.originY);
            if (left < inner.left) {
              velocity.set(0, 0);
              tweener.clear().to({ y: left }, 100, "easeInQuad");
            } else if (inner.left < right - inner.height) {
              velocity.set(0, 0);
              tweener.clear().to({ y: right - inner.height }, 100, "easeInQuad");
            } else {
              tweener.stop();
            }
          }
        }
      });
    },

    createView: function(item) {
      const viewJSON = this.viewJSONs[this.getViewId(item)];
      // console.log(viewJSON);
      this.inner.fromJSON({
        children: [viewJSON],
      });
      const view = this.inner.children.last;
      return view;
    },

    addItem: function(item) {
      this.items.push(item);
      return this;
    },

    addItems: function(items) {
      Array.prototype.push.apply(this.items, items);
      return this;
    },

    removeItem: function(item) {
      this.items.erase(item);
      return this;
    },

    clearItem: function() {
      this.items.clear();
      this.scroll = 0;
      this.flare('viewstop');
      return this;
    },

    invalidate: function() {
      this.inner.children.clone().forEach((child) => child.remove());

      let y = 0;
      let x = 0;

      this.inner.height = 1;

      this.items.forEach((item, index) => {
        const view = this.createView(item);
        view._listView = this;
        view._index = index;
        this.bind(view, item, this);
        this.viweHeight = view.height;

        if (this.scrollType !== "horizontal") {
          view.left = x + this.itemMarginLeft;
          view.top = y + this.itemMarginTop;

          if ((view.right + view.width + this.itemMarginLeft) < this.viewport.width) {
            x = view.right;
          } else {
            x = 0;
            y = view.bottom;
          }

          this.inner.height = Math.max(this.viewport.height, view.top + view.height + this.itemMarginTop);
        } else {
          // TODO
        }
      });

      //お試し実装
      if (this.updateFunc) this.target.off("enterframe", this.updateFunc);

      if (!this.updateFunc) {
        this.updateFunc = () => {
          let y = 0;
          let x = 0;
          this.inner.children.forEach((child, i) => {
            if (this.scrollType !== "horizontal") {
              child.left = x + this.itemMarginLeft;
              child.top = y + this.itemMarginTop;

              if ((child.right + child.width + this.itemMarginLeft) < this.viewport.width) {
                x = child.right;
              } else {
                x = 0;
                y = child.bottom;
              }

              this.inner.height = Math.max(this.viewport.height, child.top + child.height + this.itemMarginTop);
            } else {
              // TODO
            }
          });
        };
      }

      //enterframeではなくてwatchでheightみてもいいかな
      this.target.on("enterframe", this.updateFunc);
    },

    // return 0.0～1.0
    getScroll: function() {
      const viewport = this.viewport;
      const inner = this.inner;

      if (this.scrollType !== "horizontal") {
        const top = viewport.height * -viewport.originY;
        const bottom = viewport.height * (1 - viewport.originY);
        const min = top;
        const max = bottom - inner.height;

        return (inner.top - min) / (max - min);
      } else {
        // TOOD
        return 0;
      }
    },

    // v: 0.0～1.0
    setScroll: function(v) {
      v = Math.clamp(v, 0, 1);

      const viewport = this.viewport;
      const inner = this.inner;

      if (this.scrollType !== "horizontal") {
        if (inner.height <= viewport.height) return;

        const top = viewport.height * -viewport.originY;
        const bottom = viewport.height * (1 - viewport.originY);
        const min = top;
        const max = bottom - inner.height;

        inner.top = min + (max - min) * v;
      } else {
        // TOOD
      }

      return this;
    },

    //指定したカラムのアイテムの先頭にスクロールを移動
    setScrollByColumn: function(column) {
      column = Math.clamp(column, 0, this.items.length);
      const scrollValue = Math.clamp(column / this.items.length, 0, 1);
      this.setScroll(scrollValue);
      return this;
    },

    _accessor: {
      elements: {
        get: function() {
          return this.inner.children;
        },
      },
      scroll: {
        get: function() {
          return this.getScroll();
        },
        set: function(v) {
          this.setScroll(v);
        },
      },
    },

    _static: {
      defaults: {
        scrollType: "vertical",
        itemMarginLeft: 0,
        itemMarginTop: 0,
      },
    },

  });

});

phina.namespace(function() {

  phina.define("PieClip", {
    superClass: "Accessory",

    init: function(options) {
      options = ({}).$safe(options, PieClip.defaults)
      this.superInit(options);

      this.pivotX = options.pivotX;
      this.pivotY = options.pivotY;
      this.angleMin = options.angleMin;
      this.angleMax = options.angleMax;
      this.radius = options.radius;
      this.anticlockwise = options.anticlockwise;
    },

    onattached: function() {
      this.target.clip = (canvas) => {
        const angleMin = this.angleMin * Math.DEG_TO_RAD;
        const angleMax = this.angleMax * Math.DEG_TO_RAD;
        const ctx = canvas.context;
        ctx.beginPath();
        ctx.moveTo(this.pivotX, this.pivotY);
        ctx.lineTo(this.pivotX + Math.cos(angleMin) * this.radius, this.pivotY + Math.sin(angleMin) * this.radius);
        ctx.arc(this.pivotX, this.pivotY, this.radius, angleMin, angleMax, this.anticlockwise);
        ctx.closePath();
      };
    },

    _static: {
      defaults: {
        pivotX: 32,
        pivotY: 32,
        angleMin: 0,
        angleMax: 360,
        radius: 64,
        anticlockwise: false,
      },
    },

  });
});

phina.define("RectangleClip", {
  superClass: "Accessory",

  x: 0,
  y: 0,
  width: 0,
  height: 0,

  _enable: true,

  init: function() {
    this.superInit();
    this._init();
  },

  _init: function() {
    this.on("attached", () => {

      this.target.accessor("RectangleClip.width", {
        "get": () => this.width,
        "set": (v) => this.width = v,
      });

      this.target.accessor("RectangleClip.height", {
        "get": () => this.height,
        "set": (v) => this.height = v,
      });

      this.target.accessor("RectangleClip.x", {
        "get": () => this.x,
        "set": (v) => this.x = v,
      });

      this.target.accessor("RectangleClip.y", {
        "get": () => this.y,
        "set": (v) => this.y = v,
      });

      this.x = 0;
      this.y = 0;
      this.width = this.target.width;
      this.height = this.target.height;

      this.target.clip = (c) => this._clip(c);
    });
  },

  _clip: function(canvas) {
    const x = this.x - (this.width * this.target.originX);
    const y = this.y - (this.height * this.target.originY);

    canvas.beginPath();
    canvas.rect(x, y, this.width, this.height);
    canvas.closePath();
  },

  setEnable: function(enable) {
    this._enable = enable;
    if (this._enable) {
      this.target.clip = (c) => this._clip(c);
    } else {
      this.target.clip = null;
    }
  },

  _accessor: {
    enable: {
      set: function(v) {
        this.setEnable(v);
      },
      get: function() {
        return this._enable;
      }
    }
  },

});

phina.define("Toggle", {
  superClass: "Accessory",

  init: function(isOn) {
    this.superInit();
    this._init(isOn);
  },

  _init: function(isOn) {
    this.isOn = isOn || false;
  },

  setStatus: function(status) {
    this.isOn = status;
    this.target.flare((this.isOn) ? "switchOn" : "switchOff");
  },

  switchOn: function() {
    if (this.isOn) return;
    this.setStatus(true);
  },

  switchOff: function() {
    if (!this.isOn) return;
    this.setStatus(false);
  },

  switch: function() {
    this.isOn = !this.isOn;
    this.setStatus(this.isOn);
  },

  _accessor: {
    status: {
      "get": function() { return this.isOn; },
      "set": function(v) { return setStatus(v); },
    },
  },

});

phina.namespace(() => {

  phina.define("DynamicSprite", {
    superClass: "phina.display.Sprite",

    isLoaded: false,
    _dummy: null,

    init: function(image, width, height) {
      //指定されたイメージが既に読み込まれているかチェック
      if (typeof image === 'string') {
        const img = phina.asset.AssetManager.get('image', image);
        if (img) {
          //イメージ読み込み済
          this.isLoaded = true;
          this.superInit(img, width, height);
        } else {
          //諸々困るので一旦初期化だけしておく
          this.superInit(null, width, height);
          this.one("enterframe", (e) => {
            this.app = e.app;
            this.dynamicLoad(image, width, height);
          });
        }
      } else {
        //イメージ直渡し
        this.isLoaded = true;
        this.superInit(image, width, height);
      }
    },

    //動的に読み込みを行う
    dynamicLoad: function(image, width, height) {
      this.isLoaded = false;
      //ローカル版
      const assets = { image: {} };
      assets.image[image] = image;
      this.app.assetLoader.load(assets, () => {
        this.isLoaded = true;
        const texture = phina.asset.AssetManager.get("image", image);
        this.setImage(texture, width, height);
        if (this._dummy) {
          this._dummy.remove();
          this._dummy = null;
        }
      });

      //cordova-file-transfre版
      // this.app.downloadFromServer(image)
      //   .then(() => {
      //     this.isLoaded = true;
      //     const texture = phina.asset.AssetManager.get("image", image);
      //     this.setImage(texture, width, height);
      //     if (this._dummy) {
      //       this._dummy.remove();
      //       this._dummy = null;
      //     }
      //   });
    },

    draw: function(canvas) {
      if (!this.isLoaded || !this.image) return;

      var image = this.image.domElement;
      var srcRect = this.srcRect;
      canvas.context.drawImage(image,
        srcRect.x, srcRect.y, srcRect.width, srcRect.height,
        -this._width * this.originX, -this._height * this.originY, this._width, this._height
        );
    },

    setImage: function(image, width, height) {
      if (!this.isLoaded || !image) return this;

      if (typeof image === 'string') {
        image = phina.asset.AssetManager.get('image', image);
      }
      this._image = image;
      this.width = this._image.domElement.width;
      this.height = this._image.domElement.height;

      if (width) { this.width = width; }
      if (height) { this.height = height; }

      this.frameIndex = 0;

      return this;
    },

    setDummyImage: function(image, width, height, updateFunction) {
      if (this.isLoaded) return;
      this._dummy = Sprite(image, width, height).addChildTo(this);
      if (updateFunction) {
        this._dummy.update = updateFunction;
      }
      return this;
    },
  });

});

phina.define("Gauge", {
  superClass: "RectangleClip",

  _min: 0,
  _max: 1.0,
  _value: 1.0, //min ~ max

  direction: "horizontal", // horizontal or vertical

  init: function() {
    this.superInit();
    this.on("attached", () => {
      this._width = this.width;
      this._height = this.width;

      this.target.accessor("Gauge.min", {
        "get": () => this.min,
        "set": (v) => this.min = v,
      });

      this.target.accessor("Gauge.max", {
        "get": () => this.max,
        "set": (v) => this.max = v,
      });

      this.target.accessor("Gauge.value", {
        "get": () => this.value,
        "set": (v) => this.value = v,
      });

      this.target.accessor("Gauge.progress", {
        "get": () => this.progress,
        "set": (v) => this.progress = v,
      });
    });
  },

  _refresh: function() {
    if (this.direction !== "vertical") {
      this.width = this.target.width * this.progress;
      this.height = this.target.height;
    } else {
      this.width = this.target.width;
      this.height = this.target.height * this.progress;
    }
  },

  _accessor: {
    progress: {
      get: function() {
        const p = (this.value - this.min) / (this.max - this.min);
        return (isNaN(p)) ? 0.0 : p;
      },
      set: function(v) { this.value = this.max * v; }
    },

    max: {
      get: function() { return this._max; },
      set: function(v) {
        this._max = v;
        this._refresh();
      }
    },

    min: {
      get: function() { return this._min; },
      set: function(v) {
        this._min = v;
        this._refresh();
      }
    },

    value: {
      get: function() { return this._value; },
      set: function(v) {
        this._value = v;
        this._refresh();
      }
    },
  }

});

phina.define("PathClip", {
  superClass: "Accessory",

  isEnable: true,

  init: function() {
    this.superInit();
    this._init();
  },

  _init: function() {
    this.on("attached", () => {
      const x1 = -(this.target.width * this.target.originX);
      const y1 = -(this.target.height * this.target.originY);
      const x2 =  (this.target.width * (1 - this.target.originX));
      const y2 =  (this.target.height * (1 - this.target.originY));

      this.clearPath();
      this.path.push({x: x1, y: y1 });
      this.path.push({x: x2, y: y1 });
      this.path.push({x: x2, y: y2 });
      this.path.push({x: x1, y: y2 });
      this.target.clip = (c) => this._clip(c);
    });
  },

  setEnable: function(enable) {
    this.inEnable = enable;
    if (this.isEnable) {
      this.target.clip = (c) => this._clip(c);
    } else {
      this.target.clip = null;
    }
  },

  clearPath: function() {
    this.path = [];
    return this;
  },

  addPath: function(path) {
    if (path instanceof Array) {
      this.path = this.path.concat(path);
    } else {
      this.path.push(path);
    }
    return this;
  },

  offsetPath: function(offsetX, offsetY) {
    this.path.forEach(pt => {
      pt.x += offsetX;
      pt.y += offsetY;
    });
    return this;
  },

  _clip: function(canvas) {
    if (this.path.length < 3) return;
    canvas.beginPath();
    canvas.moveTo(this.path[0].x, this.path[0].y);
    this.path.forEach(pt => canvas.lineTo(pt.x, pt.y));
    canvas.closePath();
  },

  _accessor: {
    enable: {
      set: function(v) {
        this.setEnable(v);
      },
      get: function() {
        return this.isEnable;
      }
    }
  },

});

phina.define("RectangleClip", {
  superClass: "Accessory",

  x: 0,
  y: 0,
  width: 0,
  height: 0,

  _enable: true,

  init: function() {
    this.superInit();
    this._init();
  },

  _init: function() {
    this.on("attached", () => {

      this.target.accessor("RectangleClip.width", {
        "get": () => this.width,
        "set": (v) => this.width = v,
      });

      this.target.accessor("RectangleClip.height", {
        "get": () => this.height,
        "set": (v) => this.height = v,
      });

      this.target.accessor("RectangleClip.x", {
        "get": () => this.x,
        "set": (v) => this.x = v,
      });

      this.target.accessor("RectangleClip.y", {
        "get": () => this.y,
        "set": (v) => this.y = v,
      });

      this.x = 0;
      this.y = 0;
      this.width = this.target.width;
      this.height = this.target.height;

      this.target.clip = (c) => this._clip(c);
    });
  },

  _clip: function(canvas) {
    const x = this.x - (this.target.width * this.target.originX);
    const y = this.y - (this.target.height * this.target.originY);

    canvas.beginPath();
    canvas.rect(x, y, this.target.width, this.target.height);
    canvas.closePath();
  },

  setEnable: function(enable) {
    this._enable = enable;
    if (this._enable) {
      this.target.clip = (c) => this._clip(c);
    } else {
      this.target.clip = null;
    }
  },

  _accessor: {
    enable: {
      set: function(v) {
        this.setEnable(v);
      },
      get: function() {
        return this._enable;
      }
    }
  },

});

phina.define("RoundRectangleClip", {
  superClass: "Accessory",

  x: 0,
  y: 0,
  width: 0,
  height: 0,

  radius: 5,

  _enable: true,

  init: function() {
    this.superInit();
    this._init();
  },

  _init: function() {
    this.on("attached", () => {

      this.target.accessor("RoundRectangleClip.width", {
        "get": () => this.width,
        "set": (v) => this.width = v,
      });

      this.target.accessor("RoundRectangleClip.height", {
        "get": () => this.height,
        "set": (v) => this.height = v,
      });

      this.target.accessor("RoundRectangleClip.x", {
        "get": () => this.x,
        "set": (v) => this.x = v,
      });

      this.target.accessor("RoundRectangleClip.y", {
        "get": () => this.y,
        "set": (v) => this.y = v,
      });

      this.target.accessor("RoundRectangleClip.radius", {
        "get": () => this.radius,
        "set": (v) => this.radius = v,
      });

      this.x = 0;
      this.y = 0;
      this.width = this.target.width;
      this.height = this.target.height;

      this.target.clip = (c) => this._clip(c);
    });
  },

  _clip: function(canvas) {
    const width = this.target.width;
    const height = this.target.height;
    const x = this.x - (width * this.target.originX);
    const y = this.y - (height * this.target.originY);
    const radius = this.radius;

    const l = x + radius;
    const r = x + width - radius;
    const t = y + radius;
    const b = y + height - radius;

    canvas.beginPath();
    canvas.arc(l, t, radius, -Math.PI,       -Math.PI * 0.5, false);  // 左上
    canvas.arc(r, t, radius, -Math.PI * 0.5,              0, false);  // 右上
    canvas.arc(r, b, radius,              0,  Math.PI * 0.5, false);  // 右下
    canvas.arc(l, b, radius,  Math.PI * 0.5,        Math.PI, false);  // 左下
    canvas.closePath();
  },

  setRadius: function(v) {
    this.radius = v;
    return this;
  },

  setEnable: function(enable) {
    this._enable = enable;
    if (this._enable) {
      this.target.clip = (c) => this._clip(c);
    } else {
      this.target.clip = null;
    }
    return this;
  },

  _accessor: {
    enable: {
      set: function(v) {
        this.setEnable(v);
      },
      get: function() {
        return this._enable;
      }
    }
  },

});

phina.namespace(function() {

  phina.define("phina.asset.Atlas", {
    superClass: "phina.asset.Asset",

    data: null,
    images: null,

    init: function() {
      this.superInit();
      this.images = {};
      this.frameCache = {};
    },

    load: function(key, src) {
      this.key = key;
      if (typeof(src) === "string") {
        this.src = [src];
      } else {
        this.src = src;
      }
      return phina.util.Flow(this._load.bind(this));
    },

    _load: function(resolve) {
      var self = this;

      var flows = self.src.map(function(src) {
        var basePath = null;
        if (src.indexOf('/') < 0) {
          basePath = './';
        } else {
          basePath = src.substring(0, src.lastIndexOf('/') + 1);
        }

        return self._loadJson(src)
          .then(function(data) {
            return self._loadImage(data, basePath);
          });
      });

      phina.util.Flow.all(flows)
        .then(function(dataList) {
          return self._mergeData(dataList);
        })
        .then(function() {
          resolve(self);
        });
    },

    _loadJson: function(src) {
      var self = this;
      return phina.util.Flow(function(resolve) {
        var xml = new XMLHttpRequest();
        xml.open('GET', src);
        xml.onreadystatechange = function() {
          if (xml.readyState === 4) {
            if ([200, 201, 0].indexOf(xml.status) !== -1) {
              var data = JSON.parse(xml.responseText);
              resolve(data);
            }
          }
        };
        xml.send(null);
      });
    },

    _loadImage: function(data, basePath) {
      var self = this;
      return phina.util.Flow(function(resolve) {
        var image = phina.asset.Texture();
        self.images[data.meta.image] = image;
        image.load(basePath + data.meta.image).then(function() {
          resolve(data);
        });
      });
    },

    _mergeData: function(dataList) {
      var self = this;
      this.data = {
        frames: [],
        meta: {
          app: dataList[0].meta.appapp,
          version: dataList[0].meta.version,
          format: dataList[0].meta.format,
          scale: dataList[0].meta.scale,
          smartupdate: dataList[0].meta.smartupdate,
        },
      };
      dataList.forEach(function(data) {
        var frames = data.frames;
        if (frames instanceof Array == false) {
          frames = Object.keys(frames).map(function(key) {
            var frame = frames[key];
            frame.filename = key;
            return frame;
          });
        }

        frames.forEach(function(frame) {
          frame.image = data.meta.image;
          frame.size = data.meta.size;
        });

        self.data.frames = self.data.frames.concat(frames);
      });

      this.data.frames.sort(function(lhs, rhs) {
        return (lhs.filename <= rhs.filename) ? -1 : 1;
      });
    },

    getFrameByName: function(name) {
      var frame = this.frameCache[name];
      if (!frame) {
        frame = this.frameCache[name] = this.data.frames.find(function(f) {
          return f.filename === name;
        });
      }
      return frame;
    },

    unpackAll: function() {
      var self = this;
      var data = self.data;
      var frames = data.frames;
      if (frames instanceof Array == false) {
        frames = Object.keys(frames).map(function(key) {
          var frame = frames[key];
          frame.filename = key;
          return frame;
        });
      }

      return frames.reduce(function(ret, frame) {
        var canvas = phina.graphics.Canvas();

        var f = frame.frame;
        var s = frame.spriteSourceSize;
        var src = frame.sourceSize;
        var p = frame.pivot;

        var image = self.images[frame.image].domElement;

        canvas.setSize(src.w, src.h);
        if (!frame.rotated) {
          canvas.context.drawImage(image,
            f.x, f.y, f.w, f.h,
            s.x, s.y, s.w, s.h
          );
        } else {
          canvas.context.save();
          canvas.context.translate(src.w * p.x, src.h * p.y);
          canvas.context.rotate(Math.PI * -0.5);
          canvas.context.translate(-src.h * p.y, -src.w * p.x);
          canvas.context.drawImage(image,
            f.x, f.y, f.h, f.w,
            s.y, s.x, s.h, s.w
          );
          canvas.context.restore();
        }

        ret[frame.filename] = canvas;
        return ret;
      }, {});
    },

    unpack: function(frame) {
      var data = this.data;
      var frames = data.frames;
      if (frames instanceof Array == false) {
        frames = Object.keys(frames).map(function(key) {
          var frame = frames[key];
          frame.filename = key;
          return frame;
        });
      }

      var canvas = phina.graphics.Canvas();

      var f = frame.frame;
      var s = frame.spriteSourceSize;
      var src = frame.sourceSize;
      var p = frame.pivot;

      var image = this.images[frame.image].domElement;

      canvas.setSize(src.w, src.h);
      if (!frame.rotated) {
        canvas.context.drawImage(image,
          f.x, f.y, f.w, f.h,
          s.x, s.y, s.w, s.h
        );
      } else {
        canvas.context.save();
        canvas.context.translate(src.w * p.x, src.h * p.y);
        canvas.context.rotate(Math.PI * -0.5);
        canvas.context.translate(-src.h * p.y, -src.w * p.x);
        canvas.context.drawImage(image,
          f.x, f.y, f.h, f.w,
          s.y, s.x, s.h, s.w
        );
        canvas.context.restore();
      }

      return canvas;
    },

    /**
     * フレームを切り分けた配列をatlasFramesとしてAssetManagerにつっこむ
     * すでに存在すれば、 AssetManagerから取得する
     */ 
    getAtlasFrames: function() {
      var self = this;
      var atlasFrames = phina.asset.AssetManager.get('atlasFrames', self.key);
      if (atlasFrames) {
        return atlasFrames;
      }
      var data = self.data;
      var frames = data.frames;
      var meta = data.meta;
      if (frames instanceof Array == false) {
        frames = Object.keys(frames).map(function(key) {
          var frame = frames[key];
          frame.filename = key;
          return frame;
        });
      }

      atlasFrames = frames.map(function(frame) {
        var key = self.key + "/" + frame.filename;
        var canvas = phina.graphics.Canvas();

        var f = frame.frame;
        var s = frame.spriteSourceSize;
        var src = frame.sourceSize;
        var p = frame.pivot;

        var image = self.images[frame.image].domElement;

        canvas.setSize(s.w, s.h);
        if (!frame.rotated) {
          canvas.context.drawImage(image,
            f.x, f.y, f.w, f.h,
            0, 0, s.w, s.h
          );
        } else {
          canvas.context.save();
          canvas.context.translate(s.w * p.x, s.h * p.y);
          canvas.context.rotate(Math.PI * -0.5);
          canvas.context.translate(-s.h * p.y, -s.w * p.x);
          canvas.context.drawImage(image,
            f.x, f.y, f.h, f.w,
            0, 0, s.h, s.w
          );
          canvas.context.restore();
        }
        canvas.frame = frame;
        canvas.meta = meta;
        phina.asset.AssetManager.set('image', key, canvas);
        return canvas;
      });

      phina.asset.AssetManager.set('atlasFrames', self.key, atlasFrames);
      return atlasFrames;
    },

  });

  phina.asset.AssetLoader.register('atlas', function(key, src) {
    var asset = phina.asset.Atlas();
    return asset.load(key, src);
  });

  phina.define("phina.display.AtlasSprite", {
    superClass: "phina.display.DisplayElement",

    init: function(options) {
      options = ({}).$safe(options, phina.display.AtlasSprite.defaults);
      this.superInit(options);
      this.srcRect = phina.geom.Rect();
      this.dstRect = phina.geom.Rect();
      this.srcPivot = phina.geom.Vector2();
      this.rotated = false;

      this.atlas = phina.asset.AssetManager.get("atlas", options.atlas);

      this.setFrame(options.frame);

      this.alpha = options.alpha;
    },

    setFrame: function(frameName) {
      var atlas = this.atlas;
      if (typeof (frameName) === "string") {
        this.frame = atlas.getFrameByName(frameName);
      } else {
        this.frame = atlas.data.frames.at(frameName);
      }

      this.image = atlas.images[this.frame.image];

      var f = this.frame.frame;
      var sss = this.frame.spriteSourceSize;
      var p = this.frame.pivot;
      this.srcRect.set(f.x, f.y, f.w, f.h);
      this.dstRect.set(sss.x, sss.y, sss.w, sss.h);
      this.width = this.frame.sourceSize.w;
      this.height = this.frame.sourceSize.h;
      if (atlas.data.meta.scale != "1") {
        var s = 1 / (+atlas.data.meta.scale);
        this.dstRect.x *= s;
        this.dstRect.y *= s;
        this.dstRect.width *= s;
        this.dstRect.height *= s;
        this.width *= s;
        this.height *= s;
      }
      this.srcPivot.set(p.x, p.y);
      this.rotated = this.frame.rotated;

      return this;
    },

    draw: function(canvas) {
      var sr = this.srcRect;
      var dr = this.dstRect;
      var p = this.srcPivot;
      var image = this.image.domElement;

      if (!this.rotated) {
        canvas.context.drawImage(image,
          sr.x, sr.y, sr.width, sr.height, -this._width * this.originX + dr.x, -this._height * this.originY + dr.y, dr.width, dr.height
        );
      } else {
        var ctx = canvas.context;
        ctx.save();
        ctx.rotate(Math.PI * -0.5);
        ctx.drawImage(image,
          sr.x, sr.y, sr.height, sr.width,
          this._height * (1 - this.originY) - dr.height - dr.y, -this._width * this.originX + dr.x, dr.height, dr.width
        );
        ctx.restore();
      }
    },

    _static: {
      defaults: {
        frame: 0,
        alpha: 1,
      },
    },

  });

  phina.define("phina.display.AtlasFrameSprite", {
    superClass: "phina.display.DisplayElement",
    _atlasIndex: 0,
    init: function(options) {
      if (typeof options === 'string') {
        options = {
          atlas: options,
        };
      }
      options = ({}).$safe(options, phina.display.AtlasFrameSprite.defaults);
      this.atlasName = options.atlas;
      this.atlas = phina.asset.AssetManager.get('atlas', this.atlasName);
      this.atlasFrames = this.atlas.getAtlasFrames();
      this.superInit();
      this.dstRect = phina.geom.Rect();
      this.srcPivot = phina.geom.Vector2();

      this.setImage(this.atlasName);
      this.atlasIndex = options.atlasIndex;

      this.alpha = options.alpha;
    },

    setImage: function(image, width, height) {
      if (typeof image === 'string') {
        this.atlasFrames = phina.asset.AssetManager.get('atlas', image).getAtlasFrames();
        image = this.atlasFrames[this.atlasIndex];
      }
      this._image = image;
      this.width = this._image.domElement.width;
      this.height = this._image.domElement.height;

      if (width) { this.width = width; }
      if (height) { this.height = height; }

      return this;
    },

    setFrame: function(atlasIndex) {
      var image = this.image = this.atlasFrames.at(atlasIndex);
      this.frame = image.frame;
      var f = this.frame.frame;
      var ss = this.frame.sourceSize;
      var sss = this.frame.spriteSourceSize;
      var p = this.frame.pivot;
      var dr = this.dstRect;
      dr.set(sss.x, sss.y, sss.w, sss.h);

      dr.x -= ss.w * this.originX;
      dr.y -= ss.h * this.originY;
      if (image.meta.scale != "1") {
        var s = 1 / (+image.meta.scale);
        dr.x *= s;
        dr.y *= s;
        dr.width *= s;
        dr.height *= s;
        this.width *= s;
        this.height *= s;
      }
      this.srcPivot.set(p.x, p.y);

      return this;
    },

    draw: function(canvas) {
      var dr = this.dstRect;
      // 一旦使ってない
      // var p = this.srcPivot;
      var image = this.image.domElement;

      canvas.context.drawImage(image, 0, 0, image.width, image.height, dr.x, dr.y, dr.width, dr.height);
    },

    _accessor: {
      image: {
        get: function() { return this._image; },
        set: function(v) {
          this.setImage(v);
          return this;
        }
      },
      atlasIndex: {
        get: function() {
          return this._atlasIndex;
        },
        set: function(v) {
          this._atlasIndex = v;
          this.setFrame(v);
        },
      }
    },

    _static: {
      defaults: {
        atlasIndex: 0,
        alpha: 1,
      },
    },

  });

});
phina.namespace(() => {

  const generateUUID = () => {
    let chars = "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".split("");
    for (let i = 0, len = chars.length; i < len; i++) {
      switch (chars[i]) {
        case "x":
          chars[i] = Math.floor(Math.random() * 16).toString(16);
          break;
        case "y":
          chars[i] = (Math.floor(Math.random() * 4) + 8).toString(16);
          break;
      }
    }
    return chars.join("");
  };

  phina.define("phina.layout.LayoutAsset", {
    superClass: "phina.asset.File",

    id: null,
    atlas: null,
    textureIds: null,

    init: function() {
      this.superInit();
      this.id = generateUUID();
      this.textureIds = [];
    },

    build: function() {
      const root = phina.display.DisplayElement();
      root.ref = {};
      root.layoutAsset = this;

      root.fromJSON(this.data.root);

      const scanIds = (element) => {
        if (element.id) {
          root.ref[element.id] = element;
        }

        if (element.children) {
          element.children.forIn((key, child) => scanIds(child));
        }
      };
      scanIds(root);

      const traverse = (element) => {
        element.flare("ready");
        if (element.children) {
          element.children.forEach((child) => traverse(child));
        }
      }
      traverse(root);

      //生成レイアウトがremoveされた時に内容の破棄を行う
      const destroy = (child) => {
        if (!child) child = root;
        child.children.clone().forEach(c => {
          //ラベルで保持しているcanvasを破棄
          if (c instanceof Label) {
            c.destroyCanvas();
            c.remove();
          }
          root.destroy(c);
        });
      };
      root.destroy = destroy;

      return root;
    },

    release: function() {
      this.textureIds.forEach(id => {
        const canvas = phina.asset.AssetManager.assets["image"][id]["domElement"];
        canvas.width = 0;
        canvas.height = 0;
        delete phina.asset.AssetManager.assets["image"][id]["domElement"];
        delete phina.asset.AssetManager.assets["image"][id];
      });
      delete this.textureIds;
    },

    _load: function(resolve) {
      phina.util.Flow((resolve) => this.superMethod("_load", resolve))
        .then(() => {
          const json = JSON.parse(this.data);
          return phina.util.Flow.resolve(json);
        })
        .then((json) => this._loadAtlas(json))
        .then((json) => {
          this.data = json;
          resolve(this);
          //アトラスの参照削除
          const atlas = phina.asset.AssetManager.get("atlas", this.id);
          atlas.images.forIn((name) => {
            atlas.images[name].domElement.width = 0;
            atlas.images[name].domElement.height = 0;
            delete atlas.images[name].src;
            delete atlas.images[name].domElement;
          });
          delete json.atlases;
          delete atlas.images;
          delete phina.asset.AssetManager.assets["atlas"][this.id];
        });
    },

    _loadAtlas: function(json) {
      const atlas = phina.asset.Atlas();

      phina.asset.AssetManager.set("atlas", this.id, atlas);

      return phina.util.Flow((resolve) => {
        const flows = json.atlases.map((atlasData) => {
          const name = atlasData.atlas.meta.image;
          atlas.data = atlasData.atlas;
          atlas.images[name] = phina.asset.Texture();
          return atlas.images[name].load(atlasData.texture);
        });

        //アトラスが存在しない場合
        if(flows.length == 0) {
          resolve(json);
        } else {
          phina.util.Flow.all(flows)
            .then(() => {
              atlas._mergeData(json.atlases.map(_ => _.atlas));

              const unpackedTextures = atlas.unpackAll();
              unpackedTextures.forIn((name, tex) => {
                tex.id = generateUUID();
                phina.asset.AssetManager.set("image", tex.id, tex);
                this.textureIds.push(tex.id);
              });

              const scan = (element) => {
                if (element.className === "phina.display.AtlasSprite") {
                  element.arguments.atlas = this.id;
                } else if (element.className === "phina.display.Sprite") {
                  element.arguments[0] = unpackedTextures[element.arguments[0]].id;
                }

                if(element.accessories) {
                  //グレースケール用の画像が考慮されていなかったため取り急ぎ対応
                  const grayscale = element.accessories.Grayscale;
                  if(grayscale) {
                    grayscale.arguments.grayTextureName = unpackedTextures[grayscale.arguments.grayTextureName].id;
                  }
                }

                if (element.children) {
                  element.children.forIn((key, child) => scan(child));
                }
              };
              scan(json.root);

              resolve(json);
            });
        }
      });
    },

  });

  phina.asset.AssetLoader.assetLoadFunctions["layout"] = (key, path) => {
    const asset = phina.layout.LayoutAsset();
    const flow = asset.load(path);
    return flow;
  };

});
phina.namespace(function() {

  phina.define("Dialog", {
    superClass: "Modal",

    _static: {
      openCount: 0,
    },

    //開始前に読み込みが必要なアセットリスト
    assetList: null,

    //廃棄エレメント
    disposeElements: null,

    init: function() {
      this.superInit();

      this.app = phina_app;

      this.background = Sprite("black")
        .addChildTo(this)
        .setPosition(SCREEN_WIDTH * 0.5, SCREEN_HEIGHT * 0.5)
      this.background.alpha = 0;

      this.layoutBase = DisplayElement({ width: SCREEN_WIDTH, height: SCREEN_HEIGHT })
        .addChildTo(this)
        .setPosition(SCREEN_WIDTH * 0.5, SCREEN_HEIGHT * 0.5);

      this.disposeElements = [];
      this.on('closed', () => this.disposeElements.forEach(e => e.remove().destroyCanvas()));
    },

    //シーン離脱時に破棄するShapeを登録
    dispose: function(element) {
      this.disposeElements.push(element);
    },

    //===================================
    //表示
    open: function(scene, options) {
      options = options || {};

      this.parentScene = scene;
      Dialog.openCount++;
      if (options.isNothingBackground) {
        this.background.hide();
      }
      this.addChildTo(scene);
      this.downloadAsset(this.assetList)
        .then(() => {
          this.setup(options);
          this.openAnimation();
          if (StatusBar) {
            StatusBar.show();
            StatusBar.overlaysWebView(true);
            StatusBar.styleLightContent();
          }
        });
      return this;
    },

    //===================================
    //非表示
    close: function() {
      Dialog.openCount--;
      this.closeAnimation();
      return this;
    },

    //===================================
    //表示アニメーション
    openAnimation: function() {
      this.flare("openstart", { dialog: this });
      this.parentScene.flare("dialogopen", { dialog: this });
      return Promise.all([
        new Promise(resolve => {
          this.background.alpha = 0;
          this.background.tweener.clear()
            .fadeIn(250)
            .call(() => resolve());
        }),
        new Promise(resolve => {
          this.layoutBase.scaleX = 0.0;
          this.layoutBase.scaleY = 0.0;
          this.layoutBase.tweener.clear()
            .to({ scaleX: 1.0, scaleY: 1.0 }, 250, "easeInOutQuad")
            .call(() => {
              this.flare("opened", { dialog: this });
              this.parentScene.flare("dialogopened", { dialog: this });
              resolve();
            });
        })
      ]);
    },

    //===================================
    //非表示アニメーション
    closeAnimation: function() {
      this.flare("closestart", { dialog: this });
      this.parentScene.flare("dialogclose", { dialog: this });
      return Promise.all([
        new Promise(resolve => {
          this.background.alpha = 1;
          this.background.tweener.clear()
            .fadeOut(250)
            .call(() => resolve());
        }),
        new Promise(resolve => {
          this.layoutBase.scaleX = 1.0;
          this.layoutBase.scaleY = 1.0;
          this.layoutBase.tweener.clear()
            .to({ scaleX: 0.0, scaleY: 0.0 }, 250, "easeInOutQuad")
            .call(() => {
              this.flare("closed", { dialog: this });
              this.parentScene.flare("dialogclosed", { dialog: this });
              resolve();
            });
        })
      ]).then(() => {
        this.remove();
        if (this.layout) {
          this.layout.destroy();
          delete this.layout;
        }
        this.flare("destroy");
      });
    },

    //アセットをバックグラウンドで読み込み
    downloadAsset: function(assets) {
      if (!assets) return Promise.resolve();

      return new Promise(resolve => {
        const loader = phina.extension.AssetLoaderEx();
        loader.load(assets, this._onLoadAsset)
          .then(() => resolve());
      });
    },

    //APIからデータ取得
    getData: function(apiParam) {
      return new Promise(resolve => {
        resolve();
      });
    },
  });

});

/**
 * DomButton
 * elementにかぶせる形でDOMボタンを作成します。
 * 
 * Paramater
 * app      CanvasApp
 * element  かぶせる対象element
 * func     クリックされた時に実行される関数
 */

phina.namespace(() => {
  phina.define("DomButton", {
    superClass: "DisplayElement",

    init: function(app, element) {
      this.superInit();

      this.app = app;

      this.btn = null;
      this.setup(element);
    },

    setup: function(element) {
      if (this.btn) this.btn.remove();

      this.btn = document.createElement("button");
      this.btn.id = "btn"
      this.btn.style.position = "absolute";
      this.btn.style.display = "none";
      this.btn.style.padding = "0px";
      this.btn.style.borderWidth = "0px";

      this.btn.style.filter = 'alpha(opacity=0)';
      this.btn.style.MozOpacity = 0.0;
      this.btn.style.opacity = 0.0;

      document.body.appendChild(this.btn);

      this.btn.onclick = () => {
        element.flare('clicked');
        this.flare('clicked');
      };

      this.on('enterframe', () => {
        if (!this.btn) return;
        const scale = parseInt(this.app.domElement.style.width) / this.app.domElement.width;
        let width = element.width * scale;
        let height = element.height * scale;
        let canvasLeft = parseInt(this.app.domElement.style.left);
        let canvasTop = parseInt(this.app.domElement.style.top);

        //自身のグローバル座標に合わせる
        canvasLeft += element._worldMatrix.m02 * scale;
        canvasTop += element._worldMatrix.m12 * scale;
        canvasLeft += -element.originX * width;
        canvasTop += -element.originY * height;

        this.btn.style.display = "";
        this.btn.style.width = `${width}px`;
        this.btn.style.height = `${height}px`;
        this.btn.style.left = `${canvasLeft}px`;
        this.btn.style.top = `${canvasTop}px`;
      });

    },

    onremoved: function() {
      if (!this.btn) return;
      this.btn.remove();
      this.btn = null;
    },

  });
});

phina.namespace(() => {
  phina.define("InputField", {
    superClass: "DisplayElement",

    domElement: null,

    init: function(options) {
      this.options = ({}).$safe(options, InputField.defaults);
      this.superInit(options);

      this.domElement = document.createElement("input");
      this.domElement.type = this.options.type;
      this.domElement.value = this.options.text;

      this.domElement.style.position = "absolute";
      this.domElement.style.display = "none";
      this.domElement.style.padding = "0px";
      this.domElement.style.borderWidth = "0px";
      document.body.appendChild(this.domElement);

      this.domElement.addEventListener("focus", () => {
        this.flare("focus");
      });

      this.domElement.addEventListener("focusout", () => {
        this.flare("focusout");
      });

      this.domElement.addEventListener("keyup", () => {
        this.flare("change");
      });

      //TODO:appの参照方法で他に良い方法があれば変更する
      this.one("enterframe", (e) => {
        this.app = e.app;
        this.setup();
      });
    },

    setup: function() {
      this.on("enterframe", () => {
        const scale = parseInt(this.app.domElement.style.width) / this.app.domElement.width * this.app.quality;

        let fontSize = (this.options.fontSize * scale).round();
        //キャンバスの左上に合わせる
        let width = this.width * scale;
        let height = this.height * scale;
        let canvasLeft = parseInt(this.app.domElement.style.left);
        let canvasTop = parseInt(this.app.domElement.style.top);

        //自身のグローバル座標に合わせる
        canvasLeft += this._worldMatrix.m02 * scale;
        canvasTop += this._worldMatrix.m12 * scale;
        //originの調整
        canvasLeft += -this.originX * width;
        canvasTop += -this.originY * height;

        this.domElement.style.display = "";
        this.domElement.style.width = `${width}px`;
        this.domElement.style.height = `${height}px`;
        this.domElement.style.left = `${canvasLeft}px`;
        this.domElement.style.top = `${canvasTop}px`;
        this.domElement.style.fontSize = `${fontSize}px`;
        this.domElement.style.fontFamiliy = "Main-Bold";
      });
    },

    setVisible: function(flag) {
      this.visible = flag;
      if (this.domElement) {
        this.domElement.style.display = (flag) ? "" : "none";
      }
      return this;
    },

    show: function() {
      this.setVisible(true);
      return this;
    },

    hide: function() {
      this.setVisible(false);
      this.domElement.blur();
      return this;
    },

    //ソフトウェアキーボード非表示
    blur: function() {
      this.domElement.blur();
      return this;
    },

    readOnly: function(flag) {
      if (flag == undefined) flag = true;
      if (flag) {
        this.domElement.readOnly = true;
      } else {
        this.domElement.readOnly = false;
      }
      return this;
    },

    addCSS: function(css) {
      if (css instanceof Array) {
        css.forEach((c) => {
          this.domElement.classList.add(c);
        });
      } else {
        if (this.domElement) {
          this.domElement.classList.add(css);
        }
      }
      return this;
    },

    removeCSS: function(css) {
      if (css instanceof Array) {
        css.forEach((c) => {
          this.domElement.classList.remove(c);
        });
      } else {
        if (this.domElement) {
          this.domElement.classList.remove(css);
        }
      }
      return this;
    },

    onremoved: function() {
      if (this.domElement) {
        this.domElement.remove();
      }
    },

    //絵文字の除去
    removeEmoji: function() {
      var ranges = [
        '\ud83c[\udf00-\udfff]',
        '\ud83d[\udc00-\ude4f]',
        '\ud83d[\ude80-\udeff]',
        '\ud7c9[\ude00-\udeff]',
        '[\u2600-\u27BF]',
      ];
      var reg = new RegExp(ranges.join('|'), 'g');
      this.domElement.value = (this.domElement.value).replace(reg, '');
    },
    
    _accessor: {
      text: {
        "get": function() {
          return (this.domElement) ? this.domElement.value : "";
        },
        "set": function(v) {
          if (!this.domElement) return;
          this.domElement.value = v;
        }
      }
    },

    _static: {
      defaults: {
        width: 200,
        height: 40,
        fontSize: 20,
        text: "",
        type: "text",
      }
    },
  });
});

//
// クリックやタッチをインターセプトする
//
phina.define("InputIntercept", {
  superClass: "DisplayElement",

  init: function() {
    this.superInit();

    this.on("added", () => {
      //親に対して覆いかぶせる
      this.width = this.parent.width;
      this.height = this.parent.height;
      this.originX = this.parent.originX || 0;
      this.originY = this.parent.originY || 0;
      this.x = 0;
      this.y = 0;
    });
    this.disable();
  },

  enable: function() {
    this.setInteractive(true);
    return this;
  },

  disable: function() {
    this.setInteractive(false);
    return this;
  },

});

phina.define("Modal", {
  superClass: "InputIntercept",

  init: function() {
    this.superInit();
    this.enable();
  },
  //===================================
  //表示アニメーション
  // アニメーションについては継承元で再定義
  openAnimation: function() {
    return Promise.resolve();
  },

  //===================================
  //非表示アニメーション
  // アニメーションについては継承元で再定義
  closeAnimation: function() {
    return Promise.resolve();
  },

  //===================================
  //表示
  open: function() {
    return this.openAnimation();
  },

  //===================================
  //非表示
  close: function() {
    return this.closeAnimation();
  }

});

phina.namespace(() => {
  phina.define("TextArea", {
    superClass: "DisplayElement",

    domElement: null,

    init: function(options) {
      this.options = ({}).$safe(options, TextArea.defaults);
      this.superInit(options);

      this.domElement = document.createElement("textarea");
      this.domElement.type = "text";
      this.domElement.value = this.options.text;
      this.domElement.resize = "none";
      if (options.rows) this.domElement.rows = options.rows;

      this.domElement.style.position = "absolute";
      this.domElement.style.display = "none";
      this.domElement.style.padding = "0px";
      this.domElement.style.borderWidth = "0px";
      document.body.appendChild(this.domElement);

      this.domElement.addEventListener("focus", () => {
        this.flare("focus");
      });

      this.domElement.addEventListener("focusout", () => {
        this.flare("focusout");
      });

      this.domElement.addEventListener("keyup", () => {
        this.flare("change");
      });

      //TODO:appの参照方法で他に良い方法があれば変更する
      this.one("enterframe", (e) => {
        this.app = e.app;
        this.setup();
      });
    },

    setup: function() {
      this.on("enterframe", () => {
        const scale = parseInt(this.app.domElement.style.width) / this.app.domElement.width * this.app.quality;

        let fontSize = (this.options.fontSize * scale).round();
        //キャンバスの左上に合わせる
        let width = this.width * scale;
        let height = this.height * scale;
        let canvasLeft = parseInt(this.app.domElement.style.left);
        let canvasTop = parseInt(this.app.domElement.style.top);

        //自身のグローバル座標に合わせる
        canvasLeft += this._worldMatrix.m02 * scale;
        canvasTop += this._worldMatrix.m12 * scale;
        //originの調整
        canvasLeft += -this.originX * width;
        canvasTop += -this.originY * height;

        this.domElement.style.display = "";
        this.domElement.style.width = `${width}px`;
        this.domElement.style.height = `${height}px`;
        this.domElement.style.left = `${canvasLeft}px`;
        this.domElement.style.top = `${canvasTop}px`;
        this.domElement.style.fontSize = `${fontSize}px`;
        this.domElement.style.fontFamiliy = "Main-Bold";
      });
    },

    setVisible: function(flag) {
      this.visible = flag;
      if (this.domElement) {
        this.domElement.style.display = (flag) ? "" : "none";
      }
      return this;
    },

    show: function() {
      this.setVisible(true);
      return this;
    },

    hide: function() {
      this.setVisible(false);
      this.domElement.blur();
      return this;
    },

    //ソフトウェアキーボード非表示
    blur: function() {
      this.domElement.blur();
      return this;
    },

    readOnly: function(flag) {
      if (flag == undefined) flag = true;
      if (flag) {
        this.domElement.readOnly = true;
      } else {
        this.domElement.readOnly = false;
      }
      return this;
    },

    addCSS: function(css) {
      if (css instanceof Array) {
        css.forEach((c) => {
          this.domElement.classList.add(c);
        });
      } else {
        if (this.domElement) {
          this.domElement.classList.add(css);
        }
      }
      return this;
    },

    removeCSS: function(css) {
      if (css instanceof Array) {
        css.forEach((c) => {
          this.domElement.classList.remove(c);
        });
      } else {
        if (this.domElement) {
          this.domElement.classList.remove(css);
        }
      }
      return this;
    },

    onremoved: function() {
      if (this.domElement) {
        this.domElement.remove();
      }
    },

    //絵文字があるかチェック
    checkEmoji: function() {
      var ranges = [
        '\ud83c[\udf00-\udfff]',
        '\ud83d[\udc00-\ude4f]',
        '\ud83d[\ude80-\udeff]',
        '\ud7c9[\ude00-\udeff]',
        '[\u2600-\u27BF]',
      ];
      var reg = new RegExp(ranges.join('|'), 'g');
      return this.domElement.value.match(reg);
    },

    //絵文字の除去
    removeEmoji: function() {
      var ranges = [
        '\ud83c[\udf00-\udfff]',
        '\ud83d[\udc00-\ude4f]',
        '\ud83d[\ude80-\udeff]',
        '\ud7c9[\ude00-\udeff]',
        '[\u2600-\u27BF]',
      ];
      var reg = new RegExp(ranges.join('|'), 'g');
      this.domElement.value = (this.domElement.value).replace(reg, '');
    },
    
    _accessor: {
      text: {
        "get": function() {
          return (this.domElement) ? this.domElement.value : "";
        },
        "set": function(v) {
          if (!this.domElement) return;
          this.domElement.value = v;
        }
      }
    },

    _static: {
      defaults: {
        width: 200,
        height: 40,
        fontSize: 20,
        text: "",
      }
    },
  });
});

/*
 *  AssetLoadScene.js
 */

phina.namespace(function() {

  phina.define('AssetLoadScene', {
    superClass: 'BaseScene',

    init: function(options) {
      this.superInit();
      options = (options || {}).$safe({
        assetType: "preload",
      });

      // load asset
      const assets = AssetList.get(options.assetType);
      if (!assets) {
        console.log("Unable asset load: " + options.assetType);
        this.exit();
      }
      this.loader = phina.asset.AssetLoader();
      this.loader.load(assets);
      this.loader.on('load', () => this.exit());
    },
  });

});

/*
 *  TitleScene.js
 */

phina.namespace(function() {

  phina.define('TitleScene', {
    superClass: 'BaseScene',

    init: function(options) {
      this.superInit();
    },

    setup: function() {
      this.base = DisplayElement().addChildTo(this).setPosition(SCREEN_OFFSET_X, SCREEN_OFFSET_Y);

      Sprite("black")
        .setPosition(this.gridX.center(), this.gridY.center())
        .addChildTo(this.base)

      Label({
        text: "Versus",
      })
        .setPosition(this.gridX.center(), this.gridY.center())
        .addChildTo(this.base)
  },

    update: function() {
    },
  });

});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL21haW4uanMiLCJsaWJzL3BoaW5hLmpzIiwianMvMDAwX2NvcmRvdmEvQ2FtZXJhUGx1Z2luLmpzIiwianMvMDEwX2NvbW1vbi9XZWJBcGkuanMiLCJqcy8wMjBfZXh0ZW5zaW9uL0NhbnZhcy5qcyIsImpzLzAyMF9leHRlbnNpb24vRGlzcGxheUVsZW1lbnQuanMiLCJqcy8wMjBfZXh0ZW5zaW9uL1BsYWluRWxlbWVudC5qcyIsImpzLzAyMF9leHRlbnNpb24vVGV4dHVyZS5qcyIsImpzLzAzMF9wbHVnaW5zL0N1dFRleHQuanMiLCJqcy8wMzBfcGx1Z2lucy9waGluYS5TZXJpYWxBc3NldExvYWRlci5qcyIsImpzLzAzMF9wbHVnaW5zL3BoaW5hLmFzc2V0bG9hZGVyZXguanMiLCJqcy8wNDBfYXBwbGljYXRpb24vQXBwbGljYXRpb24uanMiLCJqcy8wNDBfYXBwbGljYXRpb24vQXNzZXRMaXN0LmpzIiwianMvMDQwX2FwcGxpY2F0aW9uL0Jhc2VTY2VuZS5qcyIsImpzLzA0MF9hcHBsaWNhdGlvbi9GaXJzdFNjZW5lRmxvdy5qcyIsImpzLzAzMF9wbHVnaW5zL2FjY2Vzc29yeS9CdXR0b24uanMiLCJqcy8wMzBfcGx1Z2lucy9hY2Nlc3NvcnkvR2F1Z2UuanMiLCJqcy8wMzBfcGx1Z2lucy9hY2Nlc3NvcnkvR3JheXNjYWxlLmpzIiwianMvMDMwX3BsdWdpbnMvYWNjZXNzb3J5L0xpc3RWaWV3LmpzIiwianMvMDMwX3BsdWdpbnMvYWNjZXNzb3J5L1BpZUNsaXAuanMiLCJqcy8wMzBfcGx1Z2lucy9hY2Nlc3NvcnkvUmVjdGFuZ2xlQ2xpcC5qcyIsImpzLzAzMF9wbHVnaW5zL2FjY2Vzc29yeS9Ub2dnbGUuanMiLCJqcy8wMzBfcGx1Z2lucy9lbGVtZW50L0R5bmFtaWNTcHJpdGUuanMiLCJqcy8wMzBfcGx1Z2lucy9lbGVtZW50L0dhdWdlLmpzIiwianMvMDMwX3BsdWdpbnMvZWxlbWVudC9QYXRoQ2xpcC5qcyIsImpzLzAzMF9wbHVnaW5zL2VsZW1lbnQvUmVjdGFuZ2xlQ2xpcC5qcyIsImpzLzAzMF9wbHVnaW5zL2VsZW1lbnQvUm91bmRSZWN0YW5nbGVDbGlwLmpzIiwianMvMDMwX3BsdWdpbnMvZWxlbWVudC9waGluYS5hdGxhcy5qcyIsImpzLzAzMF9wbHVnaW5zL2VsZW1lbnQvcGhpbmEubGF5b3V0LkxheW91dEFzc2V0LmpzIiwianMvMDMwX3BsdWdpbnMvdWkvRGlhbG9nLmpzIiwianMvMDMwX3BsdWdpbnMvdWkvRG9tQnV0dG9uLmpzIiwianMvMDMwX3BsdWdpbnMvdWkvSW5wdXRGaWVsZC5qcyIsImpzLzAzMF9wbHVnaW5zL3VpL0lucHV0SW50ZXJjZXB0LmpzIiwianMvMDMwX3BsdWdpbnMvdWkvTW9kYWwuanMiLCJqcy8wMzBfcGx1Z2lucy91aS9UZXh0QXJlYS5qcyIsImpzLzA1MF9zY2VuZXMvMDEwX3RpdGxlL0Fzc2V0TG9hZFNjZW5lLmpzIiwianMvMDUwX3NjZW5lcy8wMTBfdGl0bGUvVGl0bGVTY2VuZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3aGVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuZUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pjQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNySkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqICBtYWluLmpzXG4gKi9cblxucGhpbmEuZ2xvYmFsaXplKCk7XG5cbmNvbnN0IEZVTExfV0lEVEggPSAxMzM0O1xuY29uc3QgRlVMTF9IRUlHSFQgPSA3NTA7XG5jb25zdCBGVUxMX1dJRFRIX0hBTEYgPSBGVUxMX1dJRFRIICogMC41O1xuY29uc3QgRlVMTF9IRUlHSFRfSEFMRiA9IEZVTExfSEVJR0hUICogMC41O1xuXG5jb25zdCBMQVlPVVRfV0lEVEggPSAxMzM0O1xuY29uc3QgTEFZT1VUX0hFSUdIVCA9IDc1MDtcblxuY29uc3QgU0NSRUVOX1dJRFRIID0gTEFZT1VUX1dJRFRIO1xuY29uc3QgU0NSRUVOX0hFSUdIVCA9IExBWU9VVF9IRUlHSFQ7XG5jb25zdCBTQ1JFRU5fV0lEVEhfSEFMRiA9IFNDUkVFTl9XSURUSCAqIDAuNTtcbmNvbnN0IFNDUkVFTl9IRUlHSFRfSEFMRiA9IFNDUkVFTl9IRUlHSFQgKiAwLjU7XG5cbmNvbnN0IFNDUkVFTl9PRkZTRVRfWCA9IDA7XG5jb25zdCBTQ1JFRU5fT0ZGU0VUX1kgPSAwO1xuXG5sZXQgcGhpbmFfYXBwO1xuXG53aW5kb3cub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gIHBoaW5hX2FwcCA9IEFwcGxpY2F0aW9uKCk7XG4gIHBoaW5hX2FwcC5ydW4oKTtcbn07XG5cbi8v44K544Kv44Ot44O844Or56aB5q2iXG4vLyBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBmdW5jdGlvbihlKSB7XG4vLyAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuLy8gfSwgeyBwYXNzaXZlOiBmYWxzZSB9KTtcbiIsIi8qIFxuICogcGhpbmEuanMgMC4yLjNcbiAqIHBoaW5hLmpzIGlzIGEgZ2FtZSBsaWJyYXJ5IGluIGphdmFzY3JpcHRcbiAqIE1JVCBMaWNlbnNlZFxuICogXG4gKiBDb3B5cmlnaHQgKEMpIDIwMTUgcGhpLCBodHRwOi8vcGhpbmFqcy5jb21cbiAqL1xuXG5cbid1c2Ugc3RyaWN0JztcblxuLypcbiAqXG4gKi9cblxuXG47KGZ1bmN0aW9uKCkge1xuICAvKipcbiAgICogQGNsYXNzIGdsb2JhbC5PYmplY3RcbiAgICogT2JqZWN044Gu5ouh5by1XG4gICAqL1xuXG4gIFxuICAvKipcbiAgICogQG1ldGhvZCBwcm9wZXJ0eVxuICAgKiDlpInmlbDjgpLov73liqBcbiAgICogQHBhcmFtICAge1N0cmluZ30ga2V5IG5hbWVcbiAgICogQHBhcmFtICAge09iamVjdH0gcGFyYW1cbiAgICovXG4gIC8vIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShPYmplY3QucHJvdG90eXBlLCBcInByb3BlcnR5XCIsIHtcbiAgLy8gICB2YWx1ZTogZnVuY3Rpb24obmFtZSwgdmFsKSB7XG4gIC8vICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgbmFtZSwge1xuICAvLyAgICAgICB2YWx1ZTogdmFsLFxuICAvLyAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAvLyAgICAgICB3cml0YWJsZTogdHJ1ZVxuICAvLyAgICAgfSk7XG4gIC8vICAgfVxuICAvLyB9KTtcblxuICAvKipcbiAgICogQG1ldGhvZCBtZXRob2RcbiAgICog6Zai5pWw44KS6L+95YqgXG4gICAqIEBwYXJhbSAgIHtTdHJpbmd9IGtleSBuYW1lXG4gICAqIEBwYXJhbSAgIHtGdW5jdGlvbn0gZnVuY3Rpb25cbiAgICovXG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShPYmplY3QucHJvdG90eXBlLCBcIiRtZXRob2RcIiwge1xuICAgIHZhbHVlOiBmdW5jdGlvbihuYW1lLCBmbikge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIG5hbWUsIHtcbiAgICAgICAgdmFsdWU6IGZuLFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgd3JpdGFibGU6IHRydWVcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cblxuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHNldHRlclxuICAgKiDjgrvjg4Pjgr/jg7zjgpLlrprnvqnjgZnjgotcbiAgICovXG4gIE9iamVjdC5wcm90b3R5cGUuJG1ldGhvZChcInNldHRlclwiLCBmdW5jdGlvbihuYW1lLCBmbil7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIG5hbWUsIHtcbiAgICAgIHNldDogZm4sXG4gICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgZ2V0dGVyXG4gICAqIOOCsuODg+OCv+ODvOOCkuWumue+qeOBmeOCi1xuICAgKi9cbiAgT2JqZWN0LnByb3RvdHlwZS4kbWV0aG9kKFwiZ2V0dGVyXCIsIGZ1bmN0aW9uKG5hbWUsIGZuKXtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgbmFtZSwge1xuICAgICAgZ2V0OiBmbixcbiAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgIH0pO1xuICB9KTtcblxuICAvKipcbiAgICogQG1ldGhvZCBhY2Nlc3NvclxuICAgKiDjgqLjgq/jgrvjg4PjgrUo44K744OD44K/44O8L+OCsuODg+OCv+ODvCnjgpLlrprnvqnjgZnjgotcbiAgICovXG4gIE9iamVjdC5wcm90b3R5cGUuJG1ldGhvZChcImFjY2Vzc29yXCIsIGZ1bmN0aW9uKG5hbWUsIHBhcmFtKSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIG5hbWUsIHtcbiAgICAgIHNldDogcGFyYW1bXCJzZXRcIl0sXG4gICAgICBnZXQ6IHBhcmFtW1wiZ2V0XCJdLFxuICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgfSk7XG4gIH0pO1xuXG5cbiAgLyoqXG4gICAqIEBtZXRob2QgZm9ySW5cbiAgICog44Kq44OW44K444Kn44Kv44OI55So44Or44O844OX5Yem55CGXG4gICAqL1xuICBPYmplY3QucHJvdG90eXBlLiRtZXRob2QoXCJmb3JJblwiLCBmdW5jdGlvbihmbiwgc2VsZikge1xuICAgIHNlbGYgPSBzZWxmIHx8IHRoaXM7XG5cbiAgICBPYmplY3Qua2V5cyh0aGlzKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSwgaW5kZXgpIHtcbiAgICAgIHZhciB2YWx1ZSA9IHRoaXNba2V5XTtcblxuICAgICAgZm4uY2FsbChzZWxmLCBrZXksIHZhbHVlLCBpbmRleCk7XG4gICAgfSwgdGhpcyk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgICRnZXRcbiAgICog44OR44K55oyH5a6a44Gn5YCk44KS5Y+W5b6XXG4gICAqL1xuICBPYmplY3QucHJvdG90eXBlLiRtZXRob2QoJyRnZXQnLCBmdW5jdGlvbihrZXkpIHtcbiAgICByZXR1cm4ga2V5LnNwbGl0KCcuJykucmVkdWNlKGZ1bmN0aW9uKHQsIHYpIHtcbiAgICAgIHJldHVybiB0ICYmIHRbdl07XG4gICAgfSwgdGhpcyk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kICAkc2V0XG4gICAqIOODkeOCueaMh+WumuOBp+WApOOCkuioreWumlxuICAgKi9cbiAgT2JqZWN0LnByb3RvdHlwZS4kbWV0aG9kKCckc2V0JywgZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuICAgIGtleS5zcGxpdCgnLicpLnJlZHVjZShmdW5jdGlvbih0LCB2LCBpLCBhcnIpIHtcbiAgICAgIGlmIChpID09PSAoYXJyLmxlbmd0aC0xKSkge1xuICAgICAgICB0W3ZdID0gdmFsdWU7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgaWYgKCF0W3ZdKSB0W3ZdID0ge307XG4gICAgICAgIHJldHVybiB0W3ZdO1xuICAgICAgfVxuICAgIH0sIHRoaXMpO1xuICB9KTtcblxuICAvKipcbiAgICogQG1ldGhvZCAgJGhhc1xuICAgKiDjgZ3jga7jg5fjg63jg5Hjg4bjgqPjgpLmjIHjgaPjgabjgYTjgovjgYvjgpLliKTlrprjgZnjgotcbiAgICovXG4gIE9iamVjdC5wcm90b3R5cGUuJG1ldGhvZChcIiRoYXNcIiwgZnVuY3Rpb24oa2V5KSB7XG4gICAgcmV0dXJuIHRoaXMuaGFzT3duUHJvcGVydHkoa2V5KTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgICRleHRlbmRcbiAgICog5LuW44Gu44Op44Kk44OW44Op44Oq44Go56u25ZCI44GX44Gh44KD44GG44Gu44GnIGV4dGVuZCAtPiAkZXh0ZW5kIOOBqOOBl+OBvuOBl+OBn1xuICAgKi9cbiAgT2JqZWN0LnByb3RvdHlwZS4kbWV0aG9kKFwiJGV4dGVuZFwiLCBmdW5jdGlvbigpIHtcbiAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKGFyZ3VtZW50cywgZnVuY3Rpb24oc291cmNlKSB7XG4gICAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBzb3VyY2UpIHtcbiAgICAgICAgdGhpc1twcm9wZXJ0eV0gPSBzb3VyY2VbcHJvcGVydHldO1xuICAgICAgfVxuICAgIH0sIHRoaXMpO1xuICAgIHJldHVybiB0aGlzO1xuICB9KTtcblxuXG4gIC8qKlxuICAgKiBAbWV0aG9kICAkc2FmZVxuICAgKiDlronlhajmi6HlvLVcbiAgICog5LiK5pu444GN44GX44Gq44GEXG4gICAqL1xuICBPYmplY3QucHJvdG90eXBlLiRtZXRob2QoXCIkc2FmZVwiLCBmdW5jdGlvbihzb3VyY2UpIHtcbiAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKGFyZ3VtZW50cywgZnVuY3Rpb24oc291cmNlKSB7XG4gICAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBzb3VyY2UpIHtcbiAgICAgICAgaWYgKHRoaXNbcHJvcGVydHldID09PSB1bmRlZmluZWQpIHRoaXNbcHJvcGVydHldID0gc291cmNlW3Byb3BlcnR5XTtcbiAgICAgIH1cbiAgICB9LCB0aGlzKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSk7XG4gIFxuICBcbiAgLyoqXG4gICAqIEBtZXRob2QgICRzdHJpY3RcbiAgICog5Y6z5qC85ouh5by1XG4gICAqIOOBmeOBp+OBq+OBguOBo+OBn+WgtOWQiOOBr+itpuWRilxuICAgKi9cbiAgT2JqZWN0LnByb3RvdHlwZS4kbWV0aG9kKFwiJHN0cmljdFwiLCBmdW5jdGlvbihzb3VyY2UpIHtcbiAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKGFyZ3VtZW50cywgZnVuY3Rpb24oc291cmNlKSB7XG4gICAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBzb3VyY2UpIHtcbiAgICAgICAgY29uc29sZS5hc3NlcnQoIXRoaXNbcHJvcGVydHldLCBcInRtIGVycm9yOiB7MH0gaXMgQWxyZWFkeVwiLmZvcm1hdChwcm9wZXJ0eSkpO1xuICAgICAgICB0aGlzW3Byb3BlcnR5XSA9IHNvdXJjZVtwcm9wZXJ0eV07XG4gICAgICB9XG4gICAgfSwgdGhpcyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kICAkcGlja1xuICAgKiDjg5Tjg4Pjgq9cbiAgICovXG4gIE9iamVjdC5wcm90b3R5cGUuJG1ldGhvZChcIiRwaWNrXCIsIGZ1bmN0aW9uKCkge1xuICAgIHZhciB0ZW1wID0ge307XG5cbiAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKGFyZ3VtZW50cywgZnVuY3Rpb24oa2V5KSB7XG4gICAgICBpZiAoa2V5IGluIHRoaXMpIHRlbXBba2V5XSA9IHRoaXNba2V5XTtcbiAgICB9LCB0aGlzKTtcblxuICAgIHJldHVybiB0ZW1wO1xuICB9KTtcblxuICAvKipcbiAgICogQG1ldGhvZCAgJG9taXRcbiAgICog44Kq44Of44OD44OIXG4gICAqL1xuICBPYmplY3QucHJvdG90eXBlLiRtZXRob2QoXCIkb21pdFwiLCBmdW5jdGlvbigpIHtcbiAgICB2YXIgdGVtcCA9IHt9O1xuXG4gICAgZm9yICh2YXIga2V5IGluIHRoaXMpIHtcbiAgICAgIGlmIChBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGFyZ3VtZW50cywga2V5KSA9PSAtMSkge1xuICAgICAgICB0ZW1wW2tleV0gPSB0aGlzW2tleV07XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRlbXA7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kICAkdG9BcnJheVxuICAgKiDphY3liJfljJZcbiAgICovXG4gIE9iamVjdC5wcm90b3R5cGUuJG1ldGhvZChcIiR0b0FycmF5XCIsIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCh0aGlzKTtcbiAgfSk7XG5cbiAgT2JqZWN0LnByb3RvdHlwZS4kbWV0aG9kKCckd2F0Y2gnLCBmdW5jdGlvbihrZXksIGNhbGxiYWNrKSB7XG4gICAgdmFyIHRhcmdldCA9IHRoaXM7XG4gICAgdmFyIGRlc2NyaXB0b3IgPSBudWxsO1xuXG4gICAgd2hpbGUodGFyZ2V0KSB7XG4gICAgICBkZXNjcmlwdG9yID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSk7XG4gICAgICBpZiAoZGVzY3JpcHRvcikge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIHRhcmdldCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZih0YXJnZXQpO1xuICAgIH1cblxuICAgIC8vIOOBmeOBp+OBq+OCouOCr+OCu+ODg+OCteODvOOBqOOBl+OBpuWtmOWcqOOBmeOCi+WgtOWQiFxuICAgIGlmIChkZXNjcmlwdG9yKSB7XG4gICAgICAvLyDjg4fjg7zjgr/jg4fjgqPjgrnjgq/jg6rjg5fjgr/jga7loLTlkIhcbiAgICAgIGlmIChkZXNjcmlwdG9yLnZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdmFyIHRlbXBLZXkgPSAnX18nICsga2V5O1xuICAgICAgICB2YXIgdGVtcFZhbHVlID0gdGhpc1trZXldO1xuXG4gICAgICAgIHRoaXNbdGVtcEtleV0gPSB0ZW1wVmFsdWU7XG5cbiAgICAgICAgdGhpcy5hY2Nlc3NvcihrZXksIHtcbiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXNbdGVtcEtleV07XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgICAgIHZhciBvbGQgPSB0aGlzW3RlbXBLZXldO1xuICAgICAgICAgICAgdGhpc1t0ZW1wS2V5XSA9IHY7XG4gICAgICAgICAgICBjYWxsYmFjay5jYWxsKHRoaXMsIHYsIG9sZCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICAvLyDjgqLjgq/jgrvjgrXjg4fjgqPjgrnjgq/jg6rjg5fjgr/jga7loLTlkIhcbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLmFjY2Vzc29yKGtleSwge1xuICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gZGVzY3JpcHRvci5nZXQuY2FsbCh0aGlzKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNldDogZnVuY3Rpb24odikge1xuICAgICAgICAgICAgdmFyIG9sZCA9IGRlc2NyaXB0b3IuZ2V0LmNhbGwodGhpcyk7XG4gICAgICAgICAgICBkZXNjcmlwdG9yLnNldC5jYWxsKHRoaXMsIHYpO1xuICAgICAgICAgICAgY2FsbGJhY2suY2FsbCh0aGlzLCB2LCBvbGQpO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHZhciBhY2Nlc3NrZXkgPSAnX18nICsga2V5O1xuXG4gICAgICB0aGlzLmFjY2Vzc29yKGtleSwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzW2FjY2Vzc2tleV07XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24odikge1xuICAgICAgICAgIHZhciBvbGQgPSB0aGlzW2FjY2Vzc2tleV07XG4gICAgICAgICAgdGhpc1thY2Nlc3NrZXldID0gdjtcbiAgICAgICAgICBjYWxsYmFjay5jYWxsKHRoaXMsIHYsIG9sZCk7XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIGlmICghT2JqZWN0Lm9ic2VydmUpIHtcbiAgICBPYmplY3QuJG1ldGhvZCgnb2JzZXJ2ZScsIGZ1bmN0aW9uKG9iaiwgY2FsbGJhY2spIHtcbiAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqKTtcbiAgICAgIGtleXMuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICAgICAgdmFyIHRlbXBLZXkgPSAnX18nICsga2V5O1xuICAgICAgICB2YXIgdGVtcFZhbHVlID0gb2JqW2tleV07XG4gICAgICAgIG9ialt0ZW1wS2V5XSA9IHRlbXBWYWx1ZTtcbiAgICAgICAgXG4gICAgICAgIG9iai5hY2Nlc3NvcihrZXksIHtcbiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXNbdGVtcEtleV07XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgICAgIHRoaXNbdGVtcEtleV0gPSB2O1xuICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgaWYgKCFPYmplY3QudW5vYnNlcnZlKSB7XG4gICAgT2JqZWN0LiRtZXRob2QoJ3Vub2JzZXJ2ZScsIGZ1bmN0aW9uKG9iaiwgY2FsbGJhY2spIHtcbiAgICAgIGNvbnNvbGUuYXNzZXJ0KGZhbHNlKTtcbiAgICB9KTtcbiAgfVxuXG59KSgpO1xuXG5cblxuLypcbiAqIG51bWJlci5qc1xuICovXG5cblxuOyhmdW5jdGlvbigpIHtcbiAgLyoqXG4gICAqIEBjbGFzcyBnbG9iYWwuTnVtYmVyXG4gICAqICMg5ouh5by144GX44GfIE51bWJlciDjgq/jg6njgrlcbiAgICog5pWw5YCk44KS5omx44GGIE51bWJlciDjgq/jg6njgrnjgpLmi6HlvLXjgZfjgabjgYTjgb7jgZnjgIJcbiAgICovXG5cbiAgLyoqXG4gICAqIEBtZXRob2Qgcm91bmRcbiAgICog5oyH5a6a44GX44Gf5bCP5pWw44Gu5L2N44KS5Zub5o2o5LqU5YWl44GX44Gf5YCk44KS6L+U44GX44G+44GZ44CCXG4gICAqXG4gICAqIOiyoOOBruWApOOCkuaMh+WumuOBmeOCi+OBqOaVtOaVsOmDqOOBruS9jeOCkuWbm+aNqOS6lOWFpeOBp+OBjeOBvuOBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgKDEzLjg3KS5yb3VuZCgpOyAvLyA9PiAxNFxuICAgKiAgICAgKC0xLjg3KS5yb3VuZCgpOyAvLyA9PiAtMlxuICAgKiAgICAgKC0xLjI3KS5yb3VuZCgpOyAvLyA9PiAtMVxuICAgKiAgICAgXG4gICAqICAgICAoMi4zNDUpLnJvdW5kKCk7IC8vID0+IDJcbiAgICogICAgICgyLjM0NSkucm91bmQoMSk7IC8vID0+IDIuM1xuICAgKiAgICAgKDIuMzQ1KS5yb3VuZCgyKTsgLy8gPT4gMi4zNVxuICAgKlxuICAgKiAgICAgKDEyMzQ1LjY3KS5yb3VuZCgtMyk7IC8vID0+IDEyMDAwXG4gICAqXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBbZmlndXJlPTBdIOWbm+aNqOS6lOWFpeOBmeOCi+S9jVxuICAgKiBAcmV0dXJuIHtOdW1iZXJ9IOWwj+aVsOesrCBmaWd1cmUg5L2N44Gn5Zub5o2o5LqU5YWl44GX44Gf5YCkXG4gICAqL1xuICBOdW1iZXIucHJvdG90eXBlLiRtZXRob2QoXCJyb3VuZFwiLCBmdW5jdGlvbihmaWd1cmUpIHtcbiAgICBmaWd1cmUgPSBmaWd1cmUgfHwgMDtcbiAgICB2YXIgYmFzZSA9IE1hdGgucG93KDEwLCBmaWd1cmUpO1xuICAgIHZhciB0ZW1wID0gdGhpcyAqIGJhc2U7XG4gICAgdGVtcCA9IE1hdGgucm91bmQodGVtcCk7XG4gICAgcmV0dXJuIHRlbXAvYmFzZTtcbiAgfSk7XG4gIFxuICAvKipcbiAgICogQG1ldGhvZCBjZWlsXG4gICAqIOaMh+WumuOBl+OBn+Wwj+aVsOOBruS9jeOCkuWIh+OCiuS4iuOBkuOBn+WApOOCkui/lOOBl+OBvuOBmeOAglxuICAgKlxuICAgKiDosqDjga7lgKTjgpLmjIflrprjgZnjgovjgajmlbTmlbDpg6jjga7kvY3jgpLliIfjgorkuIrjgZLjgonjgozjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgICgtMS4yNykuY2VpbCgpOyAvLyA9PiAtMVxuICAgKiAgICAgKC0xLjg3KS5jZWlsKCk7IC8vID0+IC0xXG4gICAqICAgICBcbiAgICogICAgICgyLjM0NSkuY2VpbCgpOyAvLyA9PiAzXG4gICAqICAgICAoMi4zNDUpLmNlaWwoMSk7IC8vID0+IDIuNFxuICAgKiAgICAgKDIuMzQ1KS5jZWlsKDIpOyAvLyA9PiAyLjM1XG4gICAqXG4gICAqICAgICAoMTIzNDUuNjcpLmNlaWwoLTMpOyAvLyA9PiAxMzAwMFxuICAgKlxuICAgKiBAcGFyYW0ge051bWJlcn0gW2ZpZ3VyZT0wXSDliIfjgorkuIrjgZLjgovkvY1cbiAgICogQHJldHVybiB7TnVtYmVyfSDlsI/mlbDnrKwgZmlndXJlIOS9jeOBp+WIh+OCiuS4iuOBkuOBn+WApFxuICAgKi9cbiAgTnVtYmVyLnByb3RvdHlwZS4kbWV0aG9kKFwiY2VpbFwiLCAgZnVuY3Rpb24oZmlndXJlKSB7XG4gICAgZmlndXJlID0gZmlndXJlIHx8IDA7XG4gICAgdmFyIGJhc2UgPSBNYXRoLnBvdygxMCwgZmlndXJlKTtcbiAgICB2YXIgdGVtcCA9IHRoaXMgKiBiYXNlO1xuICAgIHRlbXAgPSBNYXRoLmNlaWwodGVtcCk7XG4gICAgcmV0dXJuIHRlbXAvYmFzZTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgZmxvb3JcbiAgICog5oyH5a6a44GX44Gf5bCP5pWw44Gu5L2N44KS5YiH44KK5LiL44GS44Gf5YCk44KS6L+U44GX44G+44GZ44CCXG4gICAqXG4gICAqIOiyoOOBruWApOOCkuaMh+WumuOBmeOCi+OBqOaVtOaVsOmDqOOBruS9jeOCkuWIh+OCiuS4i+OBkuOCieOCjOOBvuOBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgKC0xLjI3KS5mbG9vcigpOyAvLyA9PiAtMlxuICAgKiAgICAgKC0xLjg3KS5mbG9vcigpOyAvLyA9PiAtMlxuICAgKiAgICAgXG4gICAqICAgICAoMi4zNDUpLmZsb29yKCk7IC8vID0+IDJcbiAgICogICAgICgyLjM0NSkuZmxvb3IoMSk7IC8vID0+IDIuM1xuICAgKiAgICAgKDIuMzQ1KS5mbG9vcigyKTsgLy8gPT4gMi4zNFxuICAgKlxuICAgKiAgICAgKDEyMzQ1LjY3KS5mbG9vcigtMyk7IC8vID0+IDEyMDAwXG4gICAqXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBbZmlndXJlPTBdIOWIh+OCiuS4i+OBkuOCi+S9jVxuICAgKiBAcmV0dXJuIHtOdW1iZXJ9IOWwj+aVsOesrCBmaWd1cmUg5L2N44Gn5YiH44KK5LiL44GS44Gf5YCkXG4gICAqL1xuICBOdW1iZXIucHJvdG90eXBlLiRtZXRob2QoXCJmbG9vclwiLCAgZnVuY3Rpb24oZmlndXJlKSB7XG4gICAgZmlndXJlID0gZmlndXJlIHx8IDA7XG4gICAgdmFyIGJhc2UgPSBNYXRoLnBvdygxMCwgZmlndXJlKTtcbiAgICB2YXIgdGVtcCA9IHRoaXMgKiBiYXNlO1xuICAgIHRlbXAgPSBNYXRoLmZsb29yKHRlbXApO1xuICAgIFxuICAgIC8vIH5+dGhpc1xuICAgIC8vIHRoaXN8MFxuICAgIFxuICAgIHJldHVybiB0ZW1wL2Jhc2U7XG4gIH0pO1xuICBcbiAgLyoqXG4gICAqIEBtZXRob2QgdG9JbnRcbiAgICog5pWw5YCk44KS5pW05pWw44Gr5aSJ5o+b44GX44G+44GZ44CCXG4gICAqXG4gICAqICMjIyBFeGFtcGxlXG4gICAqICAgICAoNDIuMTk1KS50b0ludCgpOyAvLyA9PiA0MlxuICAgKlxuICAgKiBAcmV0dXJuIHtOdW1iZXJ9IOaVtOaVsOWApFxuICAgKi9cbiAgTnVtYmVyLnByb3RvdHlwZS4kbWV0aG9kKFwidG9JbnRcIiwgIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAodGhpcyB8IDApO1xuICB9KTtcbiAgXG4gIC8qKlxuICAgKiBAbWV0aG9kIHRvSGV4XG4gICAqIOaVsOWApOOCkjE26YCy5pWw6KGo6KiY44Gr44GX44Gf5paH5a2X5YiX44KS6L+U44GX44G+44GZ44CCXG4gICAqXG4gICAqICMjIyBFeGFtcGxlXG4gICAqICAgICAoMjYpLnRvSGV4KCk7IC8vID0+IFwiMWFcIlxuICAgKiAgICAgKC0yNikudG9IZXgoKTsgLy8gPT4gXCItMWFcIlxuICAgKiAgICAgKDI2LjI1KS50b0hleCgpOyAvLyA9PiBcIjFhLjRcIlxuICAgKlxuICAgKiBAcmV0dXJuIHtTdHJpbmd9IDE26YCy5pWw6KGo6KiY44Gu5paH5a2X5YiXXG4gICAqL1xuICBOdW1iZXIucHJvdG90eXBlLiRtZXRob2QoXCJ0b0hleFwiLCAgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMudG9TdHJpbmcoMTYpO1xuICB9KTtcbiAgXG4gIC8qKlxuICAgKiBAbWV0aG9kIHRvQmluXG4gICAqIOaVsOWApOOCkjLpgLLmlbDooajoqJjjgavjgZfjgZ/mloflrZfliJfjgpLov5TjgZfjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgICg2KS50b0JpbigpOyAvLyA9PiBcIjExMFwiXG4gICAqICAgICAoLTYpLnRvQmluKCk7IC8vID0+IFwiLTExMFwiXG4gICAqICAgICAoMHhBMykudG9CaW4oKTsgLy8gPT4gXCIxMDEwMDAxMVwiXG4gICAqICAgICAoNi4yNSkudG9IZXgoKTsgLy8gPT4gXCIxMTAuMDFcIlxuICAgKlxuICAgKiBAcmV0dXJuIHtTdHJpbmd9IDLpgLLmlbDooajoqJjjga7mloflrZfliJdcbiAgICovXG4gIE51bWJlci5wcm90b3R5cGUuJG1ldGhvZChcInRvQmluXCIsICBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy50b1N0cmluZygyKTtcbiAgfSk7XG4gIFxuICBcbiAgLyoqXG4gICAqIEBtZXRob2QgdG9VbnNpZ25lZFxuICAgKiDmlbDlgKTjgpIgdW5zaWduZWQgaW50IOWei+OBq+WkieaPm+OBl+OBvuOBmeOAglxuICAgKlxuICAgKiDmlbDlgKTjgpLnrKblj7fnhKHjgZfmlbTmlbDjgajjgZfjgaboqZXkvqHjgZfjgZ/lgKTjgpLov5TjgZfjgb7jgZnjgIIgIFxuICAgKiBKYXZhc2NyaXB044Gu44OT44OD44OI5ryU566X44Gn44Gv5pWw5YCk44KS56ym5Y+35LuY44GN44GuMzJiaXTmlbTmlbDjgajjgZfjgabmibHjgYbjgZ/jgoHjgIFSR0JBIOOCklxuICAgKiDmlbTmlbDlgKTjgafooajnj77jgZfjgabmvJTnrpfjgZnjgovloLTlkIjjgIHmnJ/lvoXpgJrjgorjga7ntZDmnpzjgYzlvpfjgonjgozjgarjgYTloLTlkIjjgYzjgYLjgorjgb7jgZnjgIJcbiAgICog44Gd44GT44Gn5pys6Zai5pWw44GnIHVuc2lnbmVkIGludCDlnovjgavlpInmj5vjgZnjgovjgZPjgajjgafmnJ/lvoXpgJrjgorjga7lgKTjgpLlvpfjgovjgZPjgajjgYzjgafjgY3jgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIHJnYmEgPSAweGZlZmZmZmZmICYgMHhmZjAwMDAwMDsgLy8gPT4gLTMzNTU0NDMyXG4gICAqICAgICByZ2JhLnRvSGV4KCk7IC8vID0+IFwiLTIwMDAwMDBcIlxuICAgKiAgICAgcmdiYS50b1Vuc2lnbmVkKCkudG9IZXgoKTsgLy8gPT4gXCJmZTAwMDAwMFwiXG4gICAqXG4gICAqIEByZXR1cm4ge051bWJlcn0gdW5zaWduZWQgaW50IOWei+OBq+WkieaPm+OBl+OBn+WApFxuICAgKi9cbiAgTnVtYmVyLnByb3RvdHlwZS4kbWV0aG9kKFwidG9VbnNpZ25lZFwiLCAgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMgPj4+IDA7XG4gIH0pO1xuICBcbiAgLyoqXG4gICAqIEBtZXRob2QgcGFkZGluZ1xuICAgKiDmjIflrprjgZfjgZ/moYHjgavjgarjgovjgojjgYbjgavmloflrZfjgpLln4vjgoHjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgICgxMjMpLnBhZGRpbmcoNSk7IC8vID0+IFwiMDAxMjNcIlxuICAgKiAgICAgKDEyMykucGFkZGluZyg1LCBcIl9cIik7IC8vID0+IFwiX18xMjNcIlxuICAgKiAgICAgKC0xMikucGFkZGluZyg1KTsgLy8gPT4gXCItMDAxMlwiXG4gICAqXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBuIOahgeaVsFxuICAgKiBAcGFyYW0ge1N0cmluZ30gW2NoPVwiMFwiXSDln4vjgoHjgovmloflrZdcbiAgICogQHJldHVybiB7U3RyaW5nfSDmoYHmlbDjgpLmj4PjgYjjgZ/mloflrZfliJdcbiAgICovXG4gIE51bWJlci5wcm90b3R5cGUuJG1ldGhvZChcInBhZGRpbmdcIiwgIGZ1bmN0aW9uKG4sIGNoKSB7XG4gICAgdmFyIHN0ciA9IHRoaXMrJyc7XG4gICAgbiAgPSBuLXN0ci5sZW5ndGg7XG4gICAgY2ggPSAoY2ggfHwgJzAnKVswXTtcbiAgICBcbiAgICB3aGlsZShuLS0gPiAwKSB7IHN0ciA9IGNoICsgc3RyOyB9XG4gICAgXG4gICAgaWYgKHN0ci5pbmRleE9mKFwiLVwiKSA+PSAwKSB7XG4gICAgICBzdHIgPSBcIi1cIiArIHN0ci5yZXBsYWNlKFwiLVwiLCBcIlwiKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc3RyO1xuICB9KTtcblxuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHRpbWVzXG4gICAqIDAg44GL44KJ6Ieq5YiG6Ieq6Lqr44Gu5pWwLTHjgb7jgafjgIHjgqvjgqbjg7Pjgr/jgpLjgqTjg7Pjgq/jg6rjg6Hjg7Pjg4jjgZfjgarjgYzjgonplqLmlbDjgpLnubDjgorov5TjgZflrp/ooYzjgZfjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIGFyciA9IFtdO1xuICAgKiAgICAgKDUpLnRpbWVzKGZ1bmN0aW9uKGkpe1xuICAgKiAgICAgICBhcnIucHVzaChpKTtcbiAgICogICAgIH0pOyAvLyA9PiBbMCwgMSwgMiwgMywgNF1cbiAgICpcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4g44Kz44O844Or44OQ44OD44Kv6Zai5pWwXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbc2VsZj10aGlzXSDplqLmlbDlhoXjgacgdGhpcyDjgajjgZfjgablj4LnhafjgZXjgozjgovlgKTjgILjg4fjg5Xjgqnjg6vjg4jjga/oh6rliIboh6rouqvjgIJcbiAgICovXG4gIE51bWJlci5wcm90b3R5cGUuJG1ldGhvZChcInRpbWVzXCIsICBmdW5jdGlvbihmbiwgc2VsZikge1xuICAgIHNlbGYgPSBzZWxmIHx8IHRoaXM7XG4gICAgZm9yICh2YXIgaT0wOyBpPHRoaXM7ICsraSkge1xuICAgICAgZm4uY2FsbChzZWxmLCBpLCB0aGlzKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHVwdG9cbiAgICog6Ieq5YiG6Ieq6Lqr44Gu5pWw44GL44KJ5oyH5a6a44GX44Gf5pWw44G+44Gn44CB44Kr44Km44Oz44K/44KS44Kk44Oz44Kv44Oq44Oh44Oz44OI44GX44Gq44GM44KJ6Zai5pWw44KS57mw44KK6L+U44GX5a6f6KGM44GX44G+44GZ44CCXG4gICAqXG4gICAqIOaMh+WumuOBl+OBn+aVsOOBjOiHquWIhuiHqui6q+OBruaVsOOCiOOCiuWwj+OBleOBhOWgtOWQiOOBr+mWouaVsOOBr+Wun+ihjOOBleOCjOOBvuOBm+OCk+OAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgYXJyID0gW107XG4gICAqICAgICAoNikudXB0byg4LCBmdW5jdGlvbihpKXtcbiAgICogICAgICAgYXJyLnB1c2goaSk7XG4gICAqICAgICB9KTtcbiAgICogICAgIGFycjsgLy8gPT4gWzYsIDcsIDhdXG4gICAqXG4gICAqICAgICAoMykudXB0bygwLCBmdW5jdGlvbihpKXtcbiAgICogICAgICAgYXJyLnB1c2goaSk7XG4gICAqICAgICB9KTtcbiAgICogICAgIGFycjsgLy8gPT4gWzYsIDcsIDhdXG4gICAqXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIOOCs+ODvOODq+ODkOODg+OCr+mWouaVsOOAguW8leaVsOOBq+OCq+OCpuODs+OCv+OBjOa4oeOBleOCjOOCi+OAglxuICAgKiBAcGFyYW0ge09iamVjdH0gW3NlbGY9dGhpc10g6Zai5pWw5YaF44GnIHRoaXMg44Go44GX44Gm5Y+C54Wn44GV44KM44KL5YCk44CC44OH44OV44Kp44Or44OI44Gv6Ieq5YiG6Ieq6Lqr44CCXG4gICAqL1xuICBOdW1iZXIucHJvdG90eXBlLiRtZXRob2QoXCJ1cHRvXCIsICBmdW5jdGlvbih0LCBmbiwgc2VsZikge1xuICAgIHNlbGYgPSBzZWxmIHx8IHRoaXM7XG4gICAgZm9yICh2YXIgaT0rdGhpczsgaTw9dDsgKytpKSB7XG4gICAgICBmbi5jYWxsKHNlbGYsIGksIHRoaXMpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfSk7XG4gIFxuICAvKipcbiAgICogQG1ldGhvZCBkb3dudG9cbiAgICog6Ieq5YiG6Ieq6Lqr44Gu5pWw44GL44KJ5oyH5a6a44GX44Gf5pWw44G+44Gn44CB44Kr44Km44Oz44K/44KS44OH44Kv44Oq44Oh44Oz44OI44GX44Gq44GM44KJ6Zai5pWw44KS57mw44KK6L+U44GX5a6f6KGM44GX44G+44GZ44CCXG4gICAqXG4gICAqIOaMh+WumuOBl+OBn+aVsOOBjOiHquWIhuiHqui6q+OBruaVsOOCiOOCiuWkp+OBjeOBhOWgtOWQiOOBr+mWouaVsOOBr+Wun+ihjOOBleOCjOOBvuOBm+OCk+OAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgYXJyID0gW107XG4gICAqICAgICAoNykuZG93bnRvKDQsIGZ1bmN0aW9uKGkpe1xuICAgKiAgICAgICBhcnIucHVzaChpKTtcbiAgICogICAgIH0pOyAvLyA9PiBbNywgNiwgNSwgNF1cbiAgICpcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4g44Kz44O844Or44OQ44OD44Kv6Zai5pWw44CC5byV5pWw44Gr44Kr44Km44Oz44K/44GM5rih44GV44KM44KL44CCXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbc2VsZj10aGlzXSDplqLmlbDlhoXjgacgdGhpcyDjgajjgZfjgablj4LnhafjgZXjgozjgovlgKTjgILjg4fjg5Xjgqnjg6vjg4jjga/oh6rliIboh6rouqvjgIJcbiAgICovXG4gIE51bWJlci5wcm90b3R5cGUuJG1ldGhvZChcImRvd250b1wiLCAgZnVuY3Rpb24odCwgZm4sIHNlbGYpIHtcbiAgICBzZWxmID0gc2VsZiB8fCB0aGlzO1xuICAgIGZvciAodmFyIGk9K3RoaXM7IGk+PXQ7IC0taSkge1xuICAgICAgZm4uY2FsbChzZWxmLCBpLCB0aGlzKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHN0ZXBcbiAgICog6Ieq5YiG6Ieq6Lqr44Gu5YCk44GL44KJ5oyH5a6a44GX44Gf5pWw44G+44Gn44CB44Kr44Km44Oz44K/44KS5aKX5YiG44GV44Gb44Gq44GM44KJ6Zai5pWw44KS57mw44KK6L+U44GX5a6f6KGM44GX44G+44GZ44CCXG4gICAqXG4gICAqIOS4iumZkOWApOOChOWil+WIhuWApOOBryBmbG9hdCDlnovjgpLmjIflrprjgZnjgovjgZPjgajjgYzjgafjgY3jgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIHZhciBhcnIgPSBbXTtcbiAgICogICAgICgyLjQpLnN0ZXAoNS4zLCAwLjgsIGZ1bmN0aW9uKG4pIHtcbiAgICogICAgICAgYXJyLnB1c2gobik7XG4gICAqICAgICAgfSk7IC8vID0+IFsyLjQsIDMuMiwgNC4wLCA0LjhdXG4gICAqXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBsaW1pdCDjgqvjgqbjg7Pjgr/jga7kuIrpmZDlgKRcbiAgICogQHBhcmFtIHtOdW1iZXJ9IHN0ZXAg44Kr44Km44Oz44K/44KS5aKX5YiG44GZ44KL6YePXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIOOCs+ODvOODq+ODkOODg+OCr+mWouaVsOOAguW8leaVsOOBq+OCq+OCpuODs+OCv+OBjOa4oeOBleOCjOOCi+OAglxuICAgKiBAcGFyYW0ge09iamVjdH0gW3NlbGY9dGhpc10g6Zai5pWw5YaF44GnIHRoaXMg44Go44GX44Gm5Y+C54Wn44GV44KM44KL5YCk44CC44OH44OV44Kp44Or44OI44Gv6Ieq5YiG6Ieq6Lqr44CCXG4gICAqL1xuICBOdW1iZXIucHJvdG90eXBlLiRtZXRob2QoXCJzdGVwXCIsICBmdW5jdGlvbihsaW1pdCwgc3RlcCwgZm4sIHNlbGYpIHtcbiAgICBzZWxmID0gc2VsZiB8fCB0aGlzO1xuICAgIGZvciAodmFyIGk9K3RoaXM7IGk8PWxpbWl0OyBpKz1zdGVwKSB7XG4gICAgICBmbi5jYWxsKHNlbGYsIGksIHRoaXMpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgbWFwXG4gICAqIDDjgYvjgonoh6rliIboh6rouqvjga7lgKQtMeOBvuOBp+OCq+OCpuODs+OCv+OCkuOCpOODs+OCr+ODquODoeODs+ODiOOBleOBm+OBquOBjOOCieOCs+ODvOODq+ODkOODg+OCr+mWouaVsOOCkue5sOOCiui/lOOBl+Wun+ihjOOBl+OAgVxuICAgKiDjgZ3jga7ov5TjgorlgKTjgpLopoHntKDjgajjgZnjgovphY3liJfjgpLnlJ/miJDjgZfjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgICg1KS5tYXAoZnVuY3Rpb24oaSkge1xuICAgKiAgICAgICByZXR1cm4gaSppO1xuICAgKiAgICAgfSk7IC8vID0+IFswLCAxLCA0LCA5LCAxNl1cbiAgICpcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4g44Kz44O844Or44OQ44OD44Kv6Zai5pWw44CC5byV5pWw44Gr44Kr44Km44Oz44K/44GM5rih44GV44KM44KL44CCXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbc2VsZj10aGlzXSDplqLmlbDlhoXjgacgdGhpcyDjgajjgZfjgablj4LnhafjgZXjgozjgovlgKTjgILjg4fjg5Xjgqnjg6vjg4jjga/oh6rliIboh6rouqvjgIJcbiAgICogQHJldHVybiB7QXJyYXl9IOeUn+aIkOOBl+OBn+mFjeWIl1xuICAgKi9cbiAgTnVtYmVyLnByb3RvdHlwZS4kbWV0aG9kKFwibWFwXCIsICBmdW5jdGlvbihmbiwgc2VsZikge1xuICAgIHNlbGYgPSBzZWxmIHx8IHRoaXM7XG5cbiAgICB2YXIgcmVzdWx0cyA9IFtdO1xuICAgIGZvciAodmFyIGk9MDsgaTx0aGlzOyArK2kpIHtcbiAgICAgIHZhciByID0gZm4uY2FsbChzZWxmLCBpKTtcbiAgICAgIHJlc3VsdHMucHVzaChyKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGFic1xuICAgKiDntbblr77lgKTjgpLov5TjgZfjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgICgtNSkuYWJzKCk7IC8vID0+IDVcbiAgICogICAgICgrNSkuYWJzKCk7IC8vID0+IDVcbiAgICpcbiAgICogQHJldHVybiB7TnVtYmVyfSDntbblr77lgKRcbiAgICovXG4gIE51bWJlci5wcm90b3R5cGUuJG1ldGhvZChcImFic1wiLCBmdW5jdGlvbigpIHsgcmV0dXJuIE1hdGguYWJzKHRoaXMpIH0pO1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGFjb3NcbiAgICog44Ki44O844Kv44Kz44K144Kk44Oz77yI44Op44K444Ki44Oz5Y2Y5L2N77yJ44KS6L+U44GX44G+44GZ44CCXG4gICAqXG4gICAqICMjIyBFeGFtcGxlXG4gICAqICAgICAoMCkuYXNpbigpOyAvLyA9PiAwXG4gICAqICAgICAoMSkuYXNpbigpOyAvLyA9PiAxLjU3MDc5NjMyNjc5NDg5NjZcbiAgICpcbiAgICogQHJldHVybiB7TnVtYmVyfSDjgqLjg7zjgq/jgrPjgrXjgqTjg7NcbiAgICovXG4gIE51bWJlci5wcm90b3R5cGUuJG1ldGhvZChcImFjb3NcIiwgZnVuY3Rpb24oKSB7IHJldHVybiBNYXRoLmFjb3ModGhpcykgfSk7XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgYXNpblxuICAgKiDjgqLjg7zjgq/jgrXjgqTjg7PvvIjjg6njgrjjgqLjg7PljZjkvY3vvInjgpLov5TjgZfjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgICgxKS5hY29zKCk7IC8vID0+IDBcbiAgICogICAgICgtMSkuYWNvcygpOyAvLyA9PiAzLjE0MTU5MjY1MzU4OTc5M1xuICAgKlxuICAgKiBAcmV0dXJuIHtOdW1iZXJ9IOOCouODvOOCr+OCteOCpOODs1xuICAgKi9cbiAgTnVtYmVyLnByb3RvdHlwZS4kbWV0aG9kKFwiYXNpblwiLCBmdW5jdGlvbigpIHsgcmV0dXJuIE1hdGguYXNpbih0aGlzKSB9KTtcblxuICAvKipcbiAgICogQG1ldGhvZCBhdGFuXG4gICAqIOOCouODvOOCr+OCv+ODs+OCuOOCp+ODs+ODiO+8iOODqeOCuOOCouODs+WNmOS9je+8ieOCkui/lOOBl+OBvuOBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgKDApLmF0YW4oKTsgLy8gPT4gMFxuICAgKiAgICAgKDEpLmF0YW4oKTsgLy8gPT4gMC43ODUzOTgxNjMzOTc0NDgzXG4gICAqXG4gICAqIEByZXR1cm4ge051bWJlcn0g44Ki44O844Kv44K/44Oz44K444Kn44Oz44OIXG4gICAqL1xuICBOdW1iZXIucHJvdG90eXBlLiRtZXRob2QoXCJhdGFuXCIsIGZ1bmN0aW9uKCkgeyByZXR1cm4gTWF0aC5hdGFuKHRoaXMpIH0pO1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGNvc1xuICAgKiDjgrPjgrXjgqTjg7PvvIjjg6njgrjjgqLjg7PljZjkvY3vvInjgpLov5TjgZfjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIChNYXRoLlBJLzMpLmNvcygpOyAvLyA9PiAwLjVcbiAgICpcbiAgICogQHJldHVybiB7TnVtYmVyfSDjgrPjgrXjgqTjg7NcbiAgICovXG4gIE51bWJlci5wcm90b3R5cGUuJG1ldGhvZChcImNvc1wiLCBmdW5jdGlvbigpIHsgcmV0dXJuIE1hdGguY29zKHRoaXMpIH0pO1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGV4cFxuICAgKiBlPHN1cD50aGlzPC9zdXA+IOOCkui/lOOBl+OBvuOBmeOAguOBk+OBk+OBpyBlIOOBr+iHqueEtuWvvuaVsOOBruW6leOBp+OBguOCi+ODjeOCpOODlOOCouaVsO+8iOOCquOCpOODqeODvOaVsO+8ieOBp+OBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgKDIpLmV4cCgpOyAvLyA9PiBlPHN1cD4yPC9zdXA+XG4gICAqICAgICAoMCkuZXhwKCk7IC8vID0+IDFcbiAgICpcbiAgICogQHJldHVybiB7TnVtYmVyfSBlPHN1cD54PC9zdXA+XG4gICAqL1xuICBOdW1iZXIucHJvdG90eXBlLiRtZXRob2QoXCJleHBcIiwgZnVuY3Rpb24oKSB7IHJldHVybiBNYXRoLmV4cCh0aGlzKSB9KTtcblxuICAvKipcbiAgICogQG1ldGhvZCBsb2dcbiAgICog6Ieq54S25a++5pWw44KS6L+U44GX44G+44GZ44CCXG4gICAqXG4gICAqICMjIyBFeGFtcGxlXG4gICAqICAgICAoTWF0aC5FICogTWF0aC5FICogTWF0aC5FKS5sb2coKTsgLy8gPT4gM1xuICAgKiAgICAgKDEpLmxvZygpOyAvLyA9PiAwXG4gICAqICAgICAoMCkubG9nKCk7IC8vID0+IC1JbmZpbml0eVxuICAgKlxuICAgKiBAcmV0dXJuIHtOdW1iZXJ9IOiHqueEtuWvvuaVsFxuICAgKi9cbiAgTnVtYmVyLnByb3RvdHlwZS4kbWV0aG9kKFwibG9nXCIsIGZ1bmN0aW9uKCkgeyByZXR1cm4gTWF0aC5sb2codGhpcykgfSk7XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgbWF4XG4gICAqIOiHquWIhuiHqui6q+OBqOW8leaVsOOBruWApOOCkuavlOOBueOAgeWkp+OBjeOBhOaWueOBruWApOOCkui/lOOBl+OBvuOBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgKDE1KS5tYXgoMTApOyAvLyA9PiAxNVxuICAgKiAgICAgKDE1KS5tYXgoOTApOyAvLyA9PiA5MFxuICAgKlxuICAgKiBAcGFyYW0ge051bWJlcn0gdmFsdWUg5q+U6LyD44GZ44KL5YCkXG4gICAqIEByZXR1cm4ge051bWJlcn0g5pyA5aSn5YCkXG4gICAqL1xuICBOdW1iZXIucHJvdG90eXBlLiRtZXRob2QoXCJtYXhcIiwgZnVuY3Rpb24odmFsdWUpIHsgcmV0dXJuIE1hdGgubWF4KHRoaXMsIHZhbHVlKSB9KTtcblxuICAvKipcbiAgICogQG1ldGhvZCBtaW5cbiAgICog6Ieq5YiG6Ieq6Lqr44Go5byV5pWw44Gu5YCk44KS5q+U44G544CB5bCP44GV44GE5pa544Gu5YCk44KS6L+U44GX44G+44GZ44CCXG4gICAqXG4gICAqICMjIyBFeGFtcGxlXG4gICAqICAgICAoMTUpLm1pbigxMCk7IC8vID0+IDEwXG4gICAqICAgICAoMTUpLm1pbig5MCk7IC8vID0+IDE1XG4gICAqXG4gICAqIEBwYXJhbSB7TnVtYmVyfSB2YWx1ZSDmr5TovIPjgZnjgovlgKRcbiAgICogQHJldHVybiB7TnVtYmVyfSDmnIDlsI/lgKRcbiAgICovXG4gIE51bWJlci5wcm90b3R5cGUuJG1ldGhvZChcIm1pblwiLCBmdW5jdGlvbih2YWx1ZSkgeyByZXR1cm4gTWF0aC5taW4odGhpcywgdmFsdWUpIH0pO1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGNsYW1wXG4gICAqIOaMh+WumuOBl+OBn+evhOWbsuOBq+WPjuOCgeOBn+WApOOCkui/lOOBl+OBvuOBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgKDIwMCkuY2xhbXAoMCwgNjQwKTsgLy8gPT4gMjAwXG4gICAqICAgICAoLTE1KS5jbGFtcCgwLCA2NDApOyAvLyA9PiAwXG4gICAqICAgICAoOTk5KS5jbGFtcCgwLCA2NDApOyAvLyA9PiA2NDBcbiAgICpcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG1pbiDnr4Tlm7Ljga7kuIvpmZBcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG1heCDnr4Tlm7Ljga7kuIrpmZBcbiAgICogQHJldHVybiB7TnVtYmVyfSDnr4Tlm7LlhoXjgavlj47jgoHjgZ/lgKRcbiAgICovXG4gIE51bWJlci5wcm90b3R5cGUuJG1ldGhvZChcImNsYW1wXCIsIGZ1bmN0aW9uKG1pbiwgbWF4KSB7IHJldHVybiBNYXRoLmNsYW1wKHRoaXMsIG1pbiwgbWF4KSB9KTtcblxuICAvKipcbiAgICogQG1ldGhvZCBwb3dcbiAgICog6Ieq5YiG6Ieq6Lqr44KSIGV4cG9uZW50IOS5l+OBl+OBn+WApOOAgeOBpOOBvuOCiiB0aGlzPHN1cD5leHBvbmVudDwvc3VwPiDjga7lgKTjgpLov5TjgZfjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgICgzKS5wb3coMik7IC8vID0+IDlcbiAgICpcbiAgICogQHBhcmFtIHtOdW1iZXJ9IGV4cG9uZW50IOe0r+S5l+OBmeOCi+aMh+aVsFxuICAgKiBAcmV0dXJuIHtOdW1iZXJ9IOe0r+S5l+OBl+OBn+e1kOaenOOBruWApFxuICAgKi9cbiAgTnVtYmVyLnByb3RvdHlwZS4kbWV0aG9kKFwicG93XCIsIGZ1bmN0aW9uKGV4cG9uZW50KSB7IHJldHVybiBNYXRoLnBvdyh0aGlzLCBleHBvbmVudCkgfSk7XG5cbiAgLyoqXG4gICAqIEBtZXRob2Qgc2luXG4gICAqIOOCteOCpOODs++8iOODqeOCuOOCouODs+WNmOS9je+8ieOCkui/lOOBl+OBvuOBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgKE1hdGguUEkvNCkuc2luKCk7IC8vID0+IDAuNzA3MTA2NzgxMTg2NTQ3NlxuICAgKlxuICAgKiBAcmV0dXJuIHtOdW1iZXJ9IOOCteOCpOODs1xuICAgKi9cbiAgTnVtYmVyLnByb3RvdHlwZS4kbWV0aG9kKFwic2luXCIsIGZ1bmN0aW9uKCkgeyByZXR1cm4gTWF0aC5zaW4odGhpcykgfSk7XG5cbiAgLyoqXG4gICAqIEBtZXRob2Qgc3FydFxuICAgKiDlubPmlrnmoLnjgpLov5TjgZfjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgICg0OSkuc3FydCgpOyAvLyA9PiA3XG4gICAqXG4gICAqIEByZXR1cm4ge051bWJlcn0g5bmz5pa55qC5XG4gICAqL1xuICBOdW1iZXIucHJvdG90eXBlLiRtZXRob2QoXCJzcXJ0XCIsIGZ1bmN0aW9uKCkgeyByZXR1cm4gTWF0aC5zcXJ0KHRoaXMpIH0pO1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHRhblxuICAgKiDjgr/jg7Pjgrjjgqfjg7Pjg4jvvIjjg6njgrjjgqLjg7PljZjkvY3vvInjgpLov5TjgZfjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIChNYXRoLlBJLzQpLnRhbigpOyAvLyA9PiAxLjBcbiAgICpcbiAgICogQHJldHVybiB7TnVtYmVyfSDjgr/jg7Pjgrjjgqfjg7Pjg4hcbiAgICovXG4gIE51bWJlci5wcm90b3R5cGUuJG1ldGhvZChcInRhblwiLCBmdW5jdGlvbigpIHsgcmV0dXJuIE1hdGgudGFuKHRoaXMpIH0pO1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHRvRGVncmVlXG4gICAqIOODqeOCuOOCouODs+OCkuW6puOBq+WkieaPm+OBl+OBvuOBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgTWF0aC5yYWRUb0RlZyhNYXRoLlBJLzQpOyAvLyA9PiA0NVxuICAgKlxuICAgKiBAcmV0dXJuIHtOdW1iZXJ9IOW6plxuICAgKi9cbiAgTnVtYmVyLnByb3RvdHlwZS4kbWV0aG9kKFwidG9EZWdyZWVcIiwgZnVuY3Rpb24oKSB7IHJldHVybiAodGhpcypNYXRoLlJBRF9UT19ERUcpOyB9KTtcblxuICAvKipcbiAgICogQG1ldGhvZCB0b1JhZGlhblxuICAgKiDluqbjgpLjg6njgrjjgqLjg7PjgavlpInmj5vjgZfjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgICgxODApLnRvUmFkaWFuKCk7IC8vID0+IDMuMTQxNTkyNjUzNTg5NzkzXG4gICAqXG4gICAqIEByZXR1cm4ge051bWJlcn0g44Op44K444Ki44OzXG4gICAqL1xuICBOdW1iZXIucHJvdG90eXBlLiRtZXRob2QoXCJ0b1JhZGlhblwiLCBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMqTWF0aC5ERUdfVE9fUkFEOyB9KTtcblxufSkoKTtcblxuXG4vKlxuICogc3RyaW5nLmpzXG4gKi9cblxuXG47KGZ1bmN0aW9uKCkge1xuICAvKipcbiAgICogQGNsYXNzIGdsb2JhbC5TdHJpbmdcbiAgICogIyDmi6HlvLXjgZfjgZ8gU3RyaW5nIOOCr+ODqeOCuVxuICAgKiDmloflrZfliJfjgpLmibHjgYYgU3RyaW5nIOOCr+ODqeOCueOCkuaLoeW8teOBl+OBpuOBhOOBvuOBmeOAglxuICAgKi9cblxuICAvKipcbiAgICogQG1ldGhvZCBmb3JtYXRcbiAgICog44OV44Kp44O844Oe44OD44OI44Gr5byV5pWw44KS6YGp55So44GX44Gf5paH5a2X5YiX44KS6L+U44GX44G+44GZ44CCXG4gICAqXG4gICAqIOW8leaVsOOBjOOCquODluOCuOOCp+OCr+ODiOOBruWgtOWQiOOAgVwie+ODl+ODreODkeODhuOCo+WQjX1cIiDjgYzjgqrjg5bjgrjjgqfjgq/jg4jjga7jg5fjg63jg5Hjg4bjgqPjga7lgKTjgavnva7jgY3mj5vjgo/jgorjgb7jgZnjgIJcbiAgICog5oyH5a6a44GX44Gf44OX44Ot44OR44OG44Kj44GM44Kq44OW44K444Kn44Kv44OI44Gr44Gq44GE5aC05ZCI44Gv56m65paH5a2X5YiX44Gr44Gq44KK44G+44GZ44CCXG4gICAqXG4gICAqIOesrDHlvJXmlbDjgYzjgqrjg5bjgrjjgqfjgq/jg4jjgafjgarjgYvjgaPjgZ/loLTlkIjjgIFcInvmlbTmlbB9XCIg44GM5ZCE5byV5pWw44Gr572u44GN5o+b44KP44KK44G+44GZ44CCXG4gICAqIOaMh+WumuOBl+OBn+WApOOBruW8leaVsOOBjOOBquOBi+OBo+OBn+WgtOWQiOOBr+epuuaWh+Wtl+WIl+OBq+OBquOCiuOBvuOBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgb2JqID0ge3I6IDEyOCwgZzogMCwgYjogMjU1fTtcbiAgICogICAgIFwiY29sb3I6IHJnYih7cn0sIHtnfSwge2J9KTtcIi5mb3JtYXQob2JqKTsgLy8gPT4gXCJjb2xvcjogcmdiKDEyOCwgMCwgMjU1KTtcIlxuICAgKlxuICAgKiAgICAgXCJ7MH0gKyB7MX0gPSB7Mn1cIi5mb3JtYXQoNSwgOCwgKDUrOCkpOyAvLyA9PiBcIjUgKyA4ID0gMTNcIlxuICAgKlxuICAgKiBAcGFyYW0ge09iamVjdH0gb2JqIOODkeODqeODoeODvOOCv+OBqOOBquOCi+OCquODluOCuOOCp+OCr+ODiFxuICAgKiBAcmV0dXJuIHtTdHJpbmd9IOeUn+aIkOOBl+OBn+aWh+Wtl+WIl1xuICAgKi9cbiAgU3RyaW5nLnByb3RvdHlwZS4kbWV0aG9kKFwiZm9ybWF0XCIsIGZ1bmN0aW9uKGFyZykge1xuICAgIC8vIOe9ruaPm+ODleOCoeODs+OCr1xuICAgIHZhciByZXBfZm4gPSB1bmRlZmluZWQ7XG4gICAgXG4gICAgLy8g44Kq44OW44K444Kn44Kv44OI44Gu5aC05ZCIXG4gICAgaWYgKHR5cGVvZiBhcmcgPT0gXCJvYmplY3RcIikge1xuICAgICAgLyoqIEBpZ25vcmUgKi9cbiAgICAgIHJlcF9mbiA9IGZ1bmN0aW9uKG0sIGspIHtcbiAgICAgICAgaWYgKGFyZ1trXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHJldHVybiBhcmdba107XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICAgIC8vIOikh+aVsOW8leaVsOOBoOOBo+OBn+WgtOWQiFxuICAgIGVsc2Uge1xuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICAvKiogQGlnbm9yZSAqL1xuICAgICAgcmVwX2ZuID0gZnVuY3Rpb24obSwgaykge1xuICAgICAgICB2YXIgdiA9IGFyZ3NbIHBhcnNlSW50KGspIF07XG4gICAgICAgIGlmICh2ICE9PSB1bmRlZmluZWQgJiYgdiAhPT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiB2O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHRoaXMucmVwbGFjZSggL1xceyhcXHcrKVxcfS9nLCByZXBfZm4gKTtcbiAgfSk7XG5cblxuICAvKipcbiAgICogQG1ldGhvZCB0cmltXG4gICAqIOaWh+Wtl+WIl+WFiOmgreOBqOacq+WwvuOBruepuueZveaWh+Wtl+OCkuWFqOOBpuWPluOCiumZpOOBhOOBn+aWh+Wtl+WIl+OCkui/lOOBl+OBvuOBmeOAglxuICAgKlxuICAgKiAjIyNSZWZlcmVuY2VcbiAgICogLSBbU3RyaW5nIEZ1bmN0aW9ucyBmb3IgSmF2YXNjcmlwdCDigJMgdHJpbSwgdG8gY2FtZWwgY2FzZSwgdG8gZGFzaGVkLCBhbmQgdG8gdW5kZXJzY29yZV0oaHR0cDovL2phbWVzcm9iZXJ0cy5uYW1lL2Jsb2cvMjAxMC8wMi8yMi9zdHJpbmctZnVuY3Rpb25zLWZvci1qYXZhc2NyaXB0LXRyaW0tdG8tY2FtZWwtY2FzZS10by1kYXNoZWQtYW5kLXRvLXVuZGVyc2NvcmUvKVxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgXCIgIEhlbGxvLCB3b3JsZCEgIFwiLnRyaW0oKTsgLy8gPT4gXCJIZWxsbywgd29ybGQhXCJcbiAgICpcbiAgICogQHJldHVybiB7U3RyaW5nfSDjg4jjg6rjg6DjgZfjgZ/ntZDmnpzjga7mloflrZfliJdcbiAgICovXG4gIFN0cmluZy5wcm90b3R5cGUuJG1ldGhvZChcInRyaW1cIiwgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgXCJcIik7XG4gIH0pO1xuICBcbiAgLyoqXG4gICAqIEBtZXRob2QgY2FwaXRhbGl6ZVxuICAgKiDjgq3jg6Pjg5Tjgr/jg6njgqTjgrrjgZfjgZ/mloflrZfliJfjgIHjgZnjgarjgo/jgaHjgIHjgZnjgbnjgabjga7ljZjoqp7jga7lhYjpoK3jgpLlpKfmloflrZfjgavjgZfjgZ/mloflrZfliJfjgpLov5TjgZfjgb7jgZnjgIJcbiAgICpcbiAgICog5Y2Y6Kqe44Gu5YWI6aCt5Lul5aSW44Gv5bCP5paH5a2X5YyW44GV44KM44G+44GZ44CCXG4gICAqXG4gICAqICMjI1JlZmVyZW5jZVxuICAgKiAtIFvjgq3jg6Pjg5Tjgr/jg6njgqTjgroo5Y2Y6Kqe44Gu5YWI6aCt44Gu5aSn5paH5a2X5YyWKeOCkuihjOOBhiAtIG9jdCBpbmFvZHVdKGh0dHA6Ly9kLmhhdGVuYS5uZS5qcC9icmF6aWwvMjAwNTEyMTIvMTEzNDM2OTA4MykgIFxuICAgKiAtIFvjg4fjgrbjgqTjg7Pjgajjg5fjg63jgrDjg6njg6Djga7ni63plpPjgac6IGphdmFzY3JpcHTjgafjgq3jg6Pjg5Tjgr/jg6njgqTjgrrvvIjkuIDmloflrZfnm67jgpLlpKfmloflrZfjgavjgZnjgovvvIldKGh0dHA6Ly9kZXNpZ24tcHJvZ3JhbS5ibG9nc3BvdC5jb20vMjAxMS8wMi9qYXZhc2NyaXB0Lmh0bWwpXG4gICAqXG4gICAqICMjIyBFeGFtcGxlXG4gICAqICAgICBcImkgYU0gYSBwZW4uXCIuY2FwaXRhbGl6ZSgpOyAvLyA9PiBcIkkgQW0gQSBQZW4uXCJcbiAgICpcbiAgICogQHJldHVybiB7U3RyaW5nfSDjgq3jg6Pjg5Tjgr/jg6njgqTjgrrjgZfjgZ/mloflrZfliJdcbiAgICovXG4gIFN0cmluZy5wcm90b3R5cGUuJG1ldGhvZChcImNhcGl0YWxpemVcIiwgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMucmVwbGFjZSgvXFx3Ky9nLCBmdW5jdGlvbih3b3JkKXtcbiAgICAgIHJldHVybiB3b3JkLmNhcGl0YWxpemVGaXJzdExldHRlcigpO1xuICAgIH0pO1xuICB9KTtcbiAgXG4gIC8qKlxuICAgKiBAbWV0aG9kIGNhcGl0YWxpemVGaXJzdExldHRlclxuICAgKiDlhYjpoK3jga7mloflrZfjgpLlpKfmloflrZfjgavjgZfjgabjgIHjgZ3jgozku6XlpJbjgpLlsI/mloflrZfjgavjgZfjgZ/mloflrZfliJfjgpLov5TjgZfjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIFwiaSBhTSBhIHBlbi5cIi5jYXBpdGFsaXplRmlyc3RMZXR0ZXIoKTsgLy8gXCJJIGFtIGEgcGVuLlwiXG4gICAqXG4gICAqIEByZXR1cm4ge1N0cmluZ30g5YWI6aCt44Gu5paH5a2X44KS5aSn5paH5a2X44Gr44GX44Gm44CB44Gd44KM5Lul5aSW44KS5bCP5paH5a2X44Gr44GX44Gf5paH5a2X5YiXXG4gICAqL1xuICBTdHJpbmcucHJvdG90eXBlLiRtZXRob2QoXCJjYXBpdGFsaXplRmlyc3RMZXR0ZXJcIiwgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0aGlzLnN1YnN0cigxKS50b0xvd2VyQ2FzZSgpO1xuICB9KTtcbiAgXG4gIC8qKlxuICAgKiBAbWV0aG9kIHRvRGFzaFxuICAgKiDmloflrZfliJflhoXjga7lpKfmloflrZfjgpLjgIxcIi1cIiArIOWwj+aWh+Wtl+OAjeOBq+WkieaPm+OBl+OBvuOBmeOAglxuICAgKlxuICAgKiBjc3MycHJvcGVydGllc++8iGVsZW1lbnQuc3R5bGXvvInjga7lkITjg5fjg63jg5Hjg4bjgqPlkI3jgpIgQ1NTIOOBruODl+ODreODkeODhuOCo+WQjeOBq+WkieaPm+OBmeOCi+WgtOWQiOOBq+S+v+WIqeOBp+OBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgXCJib3JkZXJUb3BDb2xvclwiLnRvRGFzaCgpOyAvLyA9PiBcImJvcmRlci10b3AtY29sb3JcIlxuICAgKlxuICAgKiAgQHJldHVybiB7U3RyaW5nfSDlpInmj5vlvozjga7mloflrZfliJdcbiAgICovXG4gIFN0cmluZy5wcm90b3R5cGUuJG1ldGhvZChcInRvRGFzaFwiLCBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5yZXBsYWNlKC8oW0EtWl0pL2csIGZ1bmN0aW9uKG0peyByZXR1cm4gJy0nK20udG9Mb3dlckNhc2UoKTsgfSk7XG4gIH0pO1xuICBcbiAgXG4gIC8qKlxuICAgKiBAbWV0aG9kIHRvSGFzaFxuICAgKiDjg4/jg4Pjgrfjg6XlgKTjgpLnlJ/miJDjgZfjgabov5TjgZfjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIFwicGhpbmEuanNcIi50b0hhc2goKTsgLy8gPT4gMjY3NjMyNzM5NFxuICAgKlxuICAgKiBAcmV0dXJuIHtOdW1iZXJ9IENSQzMy44OP44OD44K344Ol5YCkXG4gICAqL1xuICBTdHJpbmcucHJvdG90eXBlLiRtZXRob2QoXCJ0b0hhc2hcIiwgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMudG9DUkMzMigpO1xuICB9KTtcbiAgXG4gIC8qKlxuICAgKiBAbWV0aG9kIHBhZGRpbmdcbiAgICog5bem44Gr5paH5a2X44KS5Z+L44KB44Gm5oyH5a6a44GX44Gf5qGB44Gr44GX44G+44GZ44CCdGhpcyDjga7mloflrZfliJfjga/lj7Plr4TjgZvjgZXjgozjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIFwiMTIzNFwiLnBhZGRpbmcoMTApOyAgICAgIC8vID0+IFwiICAgICAgMTIzNFwiXG4gICAqICAgICBcIjEyMzRcIi5wYWRkaW5nKDEwLCAnMCcpOyAvLyA9PiBcIjAwMDAwMDEyMzRcIlxuICAgKlxuICAgKiBAcGFyYW0ge051bWJlcn0gZmlndXJlIOahgeaVsFxuICAgKiBAcGFyYW0ge1N0cmluZ30gW2NoPVwiIFwiXSDln4vjgoHjgovmloflrZdcbiAgICogQHJldHVybiB7U3RyaW5nfSDmjIflrprjgZfjgZ/moYHjga7mloflrZfliJdcbiAgICovXG4gIFN0cmluZy5wcm90b3R5cGUuJG1ldGhvZChcInBhZGRpbmdcIiwgZnVuY3Rpb24obiwgY2gpIHtcbiAgICB2YXIgc3RyID0gdGhpcy50b1N0cmluZygpO1xuICAgIG4gID0gbi1zdHIubGVuZ3RoO1xuICAgIGNoID0gKGNoIHx8ICcgJylbMF07XG4gICAgXG4gICAgd2hpbGUobi0tID4gMCkgeyBzdHIgPSBjaCArIHN0cjsgfVxuICAgIFxuICAgIHJldHVybiBzdHI7XG4gIH0pO1xuICBcbiAgLyoqXG4gICAqIEBtZXRob2QgcGFkZGluZ0xlZnRcbiAgICog5bem44Gr5paH5a2X44KS5Z+L44KB44Gm5oyH5a6a44GX44Gf5qGB44Gr44GX44G+44GZ44CCdGhpcyDjga7mloflrZfliJfjgpLlj7Plr4TjgZvjgZXjgozjgb7jgZnjgIJcbiAgICpcbiAgICoge0BsaW5rICNwYWRkaW5nfSDjgajlkIzjgZjjgafjgZnjgIJcbiAgICogQGluaGVyaXRkb2MgI3BhZGRpbmdcbiAgICovXG4gIFN0cmluZy5wcm90b3R5cGUuJG1ldGhvZChcInBhZGRpbmdMZWZ0XCIsIGZ1bmN0aW9uKG4sIGNoKSB7XG4gICAgdmFyIHN0ciA9IHRoaXMudG9TdHJpbmcoKTtcbiAgICBuICA9IG4tc3RyLmxlbmd0aDtcbiAgICBjaCA9IChjaCB8fCAnICcpWzBdO1xuICAgIFxuICAgIHdoaWxlKG4tLSA+IDApIHsgc3RyID0gY2ggKyBzdHI7IH1cbiAgICBcbiAgICByZXR1cm4gc3RyO1xuICB9KTtcbiAgXG4gIC8qKlxuICAgKiBAbWV0aG9kIHBhZGRpbmdSaWdodFxuICAgKiDlj7PjgavmloflrZfjgpLln4vjgoHjgabmjIflrprjgZfjgZ/moYHjgavjgZfjgb7jgZnjgIJ0aGlzIOOBruaWh+Wtl+WIl+OBr+W3puWvhOOBm+OBleOCjOOBvuOBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgXCIxMjM0XCIucGFkZGluZ1JpZ2h0KDEwKTsgICAgICAvLyA9PiBcIjEyMzQgICAgICBcIlxuICAgKiAgICAgXCIxMjM0XCIucGFkZGluZ1JpZ2h0KDEwLCAnMCcpOyAvLyA9PiBcIjEyMzQwMDAwMDBcIlxuICAgKlxuICAgKiBAcGFyYW0ge051bWJlcn0gZmlndXJlIOahgeaVsFxuICAgKiBAcGFyYW0ge1N0cmluZ30gW2NoPVwiIFwiXSDln4vjgoHjgovmloflrZdcbiAgICogQHJldHVybiB7U3RyaW5nfSDmjIflrprjgZfjgZ/moYHjga7mloflrZfliJdcbiAgICovXG4gIFN0cmluZy5wcm90b3R5cGUuJG1ldGhvZChcInBhZGRpbmdSaWdodFwiLCBmdW5jdGlvbihuLCBjaCkge1xuICAgIHZhciBzdHIgPSB0aGlzLnRvU3RyaW5nKCk7XG4gICAgbiAgPSBuLXN0ci5sZW5ndGg7XG4gICAgY2ggPSAoY2ggfHwgJyAnKVswXTtcbiAgICBcbiAgICB3aGlsZShuLS0gPiAwKSB7IHN0ciA9IHN0ciArIGNoOyB9XG4gICAgXG4gICAgcmV0dXJuIHN0cjtcbiAgfSk7XG4gIFxuICAvKipcbiAgICogQG1ldGhvZCBxdW90ZW1ldGFcbiAgICog5q2j6KaP6KGo54++44Gu44Oh44K/5paH5a2X44KS44Kv44Kp44O844OI44GX44G+44GZ44CCXG4gICAqXG4gICAqICMjIyBFeGFtcGxlXG4gICAqICAgICBcIkhlbGxvIHdvcmxkLiAoY2FuIHlvdSBoZWFyIG1lPylcIi5xdW90ZW1ldGEoKTsgLy8gPT4gXCJIZWxsb1xcXFwgd29ybGRcXFxcLlxcXFwgXFxcXChjYW5cXFxcIHlvdVxcXFwgaGVhclxcXFwgbWVcXFxcP1xcXFwpXCJcbiAgICpcbiAgICogIEByZXR1cm4ge1N0cmluZ30g44Kv44Kp44O844OI44GV44KM44Gf5paH5a2X5YiXXG4gICAqL1xuICBTdHJpbmcucHJvdG90eXBlLiRtZXRob2QoXCJxdW90ZW1ldGFcIiwgZnVuY3Rpb24obikge1xuICAgIHJldHVybiB0aGlzLnJlcGxhY2UoLyhbXjAtOUEtWmEtel9dKS9nLCAnXFxcXCQxJyk7XG4gIH0pO1xuICBcbiAgLyoqXG4gICAqIEBtZXRob2QgcmVwZWF0XG4gICAqIOiHquWIhuiHqui6q+OCkuaMh+WumuOBl+OBn+WbnuaVsOOBoOOBkee5sOOCiui/lOOBl+OBn+aWh+Wtl+WIl+OCkui/lOOBl+OBvuOBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgXCJBYmNcIi5yZXBlYXQoNCk7IC8vID0+IFwiQWJjQWJjQWJjQWJjXCJcbiAgICpcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG4g57mw44KK6L+U44GX5Zue5pWwXG4gICAqIEByZXR1cm4ge1N0cmluZ30g5paH5a2X5YiXXG4gICAqL1xuICBTdHJpbmcucHJvdG90eXBlLiRtZXRob2QoXCJyZXBlYXRcIiwgZnVuY3Rpb24obikge1xuICAgIC8vIFRPRE86IOeiuuiqjeOBmeOCi1xuICAgIHZhciBhcnIgPSBBcnJheShuKTtcbiAgICBmb3IgKHZhciBpPTA7IGk8bjsgKytpKSBhcnJbaV0gPSB0aGlzO1xuICAgIHJldHVybiBhcnIuam9pbignJyk7XG4gIH0pO1xuICBcbiAgLyoqXG4gICAqIEBtZXRob2QgY291bnRcbiAgICog5oyH5a6a44GX44Gf5paH5a2X5YiX44GM5L2V5YCL5YWl44Gj44Gm44GE44KL44GL44KS44Kr44Km44Oz44OI44GX44Gm6L+U44GX44G+44GZ44CCXG4gICAqXG4gICAqIOWkp+aWh+Wtl+ODu+Wwj+aWh+Wtl+OBr+WMuuWIpeOBleOCjOOBvuOBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgXCJUaGlzIGlzIGEgc3RyaW5nLiBJc24ndCBpdD9cIi5jb3VudChcImlzXCIpOyAvLyA9PiAyXG4gICAqXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBzdHIg6Kq/44G544KL5paH5a2X5YiXXG4gICAqIEByZXR1cm4ge051bWJlcn0gdGhpcyDjgasgc3RyIOOBjOWFpeOBo+OBpuOBhOOCi+WAi+aVsFxuICAgKi9cbiAgU3RyaW5nLnByb3RvdHlwZS4kbWV0aG9kKFwiY291bnRcIiwgZnVuY3Rpb24oc3RyKSB7XG4gICAgdmFyIHJlID0gbmV3IFJlZ0V4cChzdHIsICdnbScpO1xuICAgIHJldHVybiB0aGlzLm1hdGNoKHJlKS5sZW5ndGg7XG4gIH0pO1xuICBcbiAgLyoqXG4gICAqIEBtZXRob2QgaW5jbHVkZVxuICAgKiDmjIflrprjgZfjgZ/mloflrZfliJfjgYzlkKvjgb7jgozjgabjgYTjgovjgYvjganjgYbjgYvjgpLov5TjgZfjgb7jgZnjgIJcbiAgICpcbiAgICog5aSn5paH5a2X44O75bCP5paH5a2X44Gv5Yy65Yil44GV44KM44G+44GZ44CCXG4gICAqXG4gICAqICMjIyBFeGFtcGxlXG4gICAqICAgICBcIlRoaXMgaXMgYSBzdHJpbmcuXCIuaW5jbHVkZShcImlzXCIpOyAvLyA9PiB0cnVlXG4gICAqICAgICBcIlRoaXMgaXMgYSBzdHJpbmcuXCIuaW5jbHVkZShcIndhc1wiKTsgLy8gPT4gZmFsc2VcbiAgICpcbiAgICogQHBhcmFtIHtTdHJpbmd9IHN0ciDoqr/jgbnjgovmloflrZfliJdcbiAgICogQHJldHVybiB7Qm9vbGVhbn0g5ZCr44G+44KM44Gm44GE44KL44GL44Gp44GG44GLXG4gICAqL1xuICBTdHJpbmcucHJvdG90eXBlLiRtZXRob2QoXCJpbmNsdWRlXCIsIGZ1bmN0aW9uKHN0cikge1xuICAgIHJldHVybiB0aGlzLmluZGV4T2Yoc3RyKSAhPSAtMTtcbiAgfSk7XG4gIFxuICAvKipcbiAgICogQG1ldGhvZCBlYWNoXG4gICAqIOWQhOaWh+Wtl+OCkumghueVquOBq+a4oeOBl+OBquOBjOOCiemWouaVsOOCkue5sOOCiui/lOOBl+Wun+ihjOOBl+OBvuOBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgc3RyID0gJ2FiYyc7XG4gICAqICAgICBzdHIuZWFjaChmdW5jdGlvbihjaCkge1xuICAgKiAgICAgICBjb25zb2xlLmxvZyhjaCk7XG4gICAqICAgICB9KTtcbiAgICogICAgIC8vID0+ICdhJ1xuICAgKiAgICAgLy8gICAgJ2InXG4gICAqICAgICAvLyAgICAnYydcbiAgICpcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sg5ZCE6KaB57Sg44Gr5a++44GX44Gm5a6f6KGM44GZ44KL44Kz44O844Or44OQ44OD44Kv6Zai5pWwXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbc2VsZj10aGlzXSBjYWxsYmFjayDlhoXjgacgdGhpcyDjgajjgZfjgablj4LnhafjgZXjgozjgovlgKRcbiAgICovXG4gIFN0cmluZy5wcm90b3R5cGUuJG1ldGhvZChcImVhY2hcIiwgZnVuY3Rpb24oKSB7XG4gICAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSk7XG4gIFxuICAvKipcbiAgICogQG1ldGhvZCB0b0FycmF5XG4gICAqIDHmloflrZfjgZrjgaTliIbop6PjgZfjgZ/phY3liJfjgpLov5TjgZfjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIFwiMTIzNDVcIi50b0FycmF5KCk7IC8vID0+IFtcIjFcIiwgXCIyXCIsIFwiM1wiLCBcIjRcIiwgXCI1XCJdXG4gICAqICAgICBcIuOBguOBhOOBhuOBiOOBilwiLnRvQXJyYXkoKTsgLy8gPT4gXCLjgYJcIiwgXCLjgYRcIiwgXCLjgYZcIiwgXCLjgYhcIiwgXCLjgYpcIl1cbiAgICpcbiAgICogQHJldHVybiB7U3RyaW5nW119IOmFjeWIl1xuICAgKi9cbiAgU3RyaW5nLnByb3RvdHlwZS4kbWV0aG9kKFwidG9BcnJheVwiLCBmdW5jdGlvbigpIHtcbiAgICB2YXIgYXJyID0gW107XG4gICAgZm9yICh2YXIgaT0wLGxlbj10aGlzLmxlbmd0aDsgaTxsZW47ICsraSkge1xuICAgICAgYXJyLnB1c2godGhpc1tpXSk7XG4gICAgfVxuICAgIHJldHVybiBhcnI7XG4gIH0pO1xuICBcbiAgLyoqXG4gICAqIEBtZXRob2QgdG9PYmplY3RcbiAgICog44Kt44O844Go5YCk44Gu57WE44G/5ZCI44KP44Gb44GM6YCj57WQ44GV44KM44Gf5paH5a2X5YiX44GL44KJ44Kq44OW44K444Kn44Kv44OI44KS55Sf5oiQ44GX44G+44GZ44CCXG4gICAqXG4gICAqIOWApOOBryBOdW1iZXLjgIFCb29sZWFu44CBU3RyaW5nIOOBruOBhOOBmuOCjOOBi+OBruWei+OBqOOBl+OBpuipleS+oeOBleOCjOOBvuOBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgb2JqMSA9IFwibnVtPTEyOC41JmZsYWcxPXRydWUmZmxhZzI9ZmFsc2Umc3RyPWhvZ2VcIjtcbiAgICogICAgIG9iajEudG9PYmplY3QoKTsgLy8gPT4ge251bTogMTI4LjUsIGZsYWcxOiB0cnVlLCBmbGFnMjogZmFsc2UsIHN0cjogXCJob2dlXCIgfVxuICAgKiAgICAgXG4gICAqICAgICBvYmoyID0gXCJudW06LTY0LjV8ZmxhZzE6ZmFsc2V8ZmxhZzI6dHJ1ZXxzdHI6Zm9vXCI7XG4gICAqICAgICBvYmoyLnRvT2JqZWN0KCd8JywgJzonKTsgLy8gPT4ge251bTogLTY0LjUsIGZsYWcxOiBmYWxzZSwgZmxhZzI6IHRydWUsIHN0cjogXCJmb29cIiB9XG4gICAqXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBbc2VwPVwiJlwiXSDjgrvjg5Hjg6zjg7zjgr/mloflrZdcbiAgICogQHBhcmFtIHtTdHJpbmd9IFtlcT1cIlwiXSDjgq3jg7zjgajlgKTjga7ntYTjgb/lkIjjgo/jgZvjgpLooajjgZnmloflrZdcbiAgICogQHJldHVybiB7T2JqZWN0fSDjgqrjg5bjgrjjgqfjgq/jg4hcbiAgICovXG4gIFN0cmluZy5wcm90b3R5cGUuJG1ldGhvZChcInRvT2JqZWN0XCIsIGZ1bmN0aW9uKHNlcCwgZXEpIHtcbiAgICBzZXAgPSBzZXAgfHwgJyYnO1xuICAgIGVxICA9IGVxIHx8ICc9JztcblxuICAgIHZhciBvYmogPSB7fTtcbiAgICB2YXIgcGFyYW1zID0gdGhpcy5zcGxpdChzZXApO1xuICAgIHBhcmFtcy5lYWNoKGZ1bmN0aW9uKHN0ciwgaSkge1xuICAgICAgdmFyIHBvcyA9IHN0ci5pbmRleE9mKGVxKTtcbiAgICAgIGlmIChwb3MgPiAwKSB7XG4gICAgICAgIHZhciBrZXkgPSBzdHIuc3Vic3RyaW5nKDAsIHBvcyk7XG4gICAgICAgIHZhciB2YWwgPSBzdHIuc3Vic3RyaW5nKHBvcysxKTtcbiAgICAgICAgdmFyIG51bSA9IE51bWJlcih2YWwpO1xuXG4gICAgICAgIGlmICghaXNOYU4obnVtKSkge1xuICAgICAgICAgIHZhbCA9IG51bTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh2YWwgPT09ICd0cnVlJykge1xuICAgICAgICAgIHZhbCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodmFsID09PSAnZmFsc2UnKSB7XG4gICAgICAgICAgdmFsID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBvYmpba2V5XSA9IHZhbDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBvYmo7XG4gIH0pO1xuICBcbiAgdmFyIHRhYmxlID0gXCIwMDAwMDAwMCA3NzA3MzA5NiBFRTBFNjEyQyA5OTA5NTFCQSAwNzZEQzQxOSA3MDZBRjQ4RiBFOTYzQTUzNSA5RTY0OTVBMyAwRURCODgzMiA3OURDQjhBNCBFMEQ1RTkxRSA5N0QyRDk4OCAwOUI2NEMyQiA3RUIxN0NCRCBFN0I4MkQwNyA5MEJGMUQ5MSAxREI3MTA2NCA2QUIwMjBGMiBGM0I5NzE0OCA4NEJFNDFERSAxQURBRDQ3RCA2RERERTRFQiBGNEQ0QjU1MSA4M0QzODVDNyAxMzZDOTg1NiA2NDZCQThDMCBGRDYyRjk3QSA4QTY1QzlFQyAxNDAxNUM0RiA2MzA2NkNEOSBGQTBGM0Q2MyA4RDA4MERGNSAzQjZFMjBDOCA0QzY5MTA1RSBENTYwNDFFNCBBMjY3NzE3MiAzQzAzRTREMSA0QjA0RDQ0NyBEMjBEODVGRCBBNTBBQjU2QiAzNUI1QThGQSA0MkIyOTg2QyBEQkJCQzlENiBBQ0JDRjk0MCAzMkQ4NkNFMyA0NURGNUM3NSBEQ0Q2MERDRiBBQkQxM0Q1OSAyNkQ5MzBBQyA1MURFMDAzQSBDOEQ3NTE4MCBCRkQwNjExNiAyMUI0RjRCNSA1NkIzQzQyMyBDRkJBOTU5OSBCOEJEQTUwRiAyODAyQjg5RSA1RjA1ODgwOCBDNjBDRDlCMiBCMTBCRTkyNCAyRjZGN0M4NyA1ODY4NEMxMSBDMTYxMURBQiBCNjY2MkQzRCA3NkRDNDE5MCAwMURCNzEwNiA5OEQyMjBCQyBFRkQ1MTAyQSA3MUIxODU4OSAwNkI2QjUxRiA5RkJGRTRBNSBFOEI4RDQzMyA3ODA3QzlBMiAwRjAwRjkzNCA5NjA5QTg4RSBFMTBFOTgxOCA3RjZBMERCQiAwODZEM0QyRCA5MTY0NkM5NyBFNjYzNUMwMSA2QjZCNTFGNCAxQzZDNjE2MiA4NTY1MzBEOCBGMjYyMDA0RSA2QzA2OTVFRCAxQjAxQTU3QiA4MjA4RjRDMSBGNTBGQzQ1NyA2NUIwRDlDNiAxMkI3RTk1MCA4QkJFQjhFQSBGQ0I5ODg3QyA2MkREMURERiAxNURBMkQ0OSA4Q0QzN0NGMyBGQkQ0NEM2NSA0REIyNjE1OCAzQUI1NTFDRSBBM0JDMDA3NCBENEJCMzBFMiA0QURGQTU0MSAzREQ4OTVENyBBNEQxQzQ2RCBEM0Q2RjRGQiA0MzY5RTk2QSAzNDZFRDlGQyBBRDY3ODg0NiBEQTYwQjhEMCA0NDA0MkQ3MyAzMzAzMURFNSBBQTBBNEM1RiBERDBEN0NDOSA1MDA1NzEzQyAyNzAyNDFBQSBCRTBCMTAxMCBDOTBDMjA4NiA1NzY4QjUyNSAyMDZGODVCMyBCOTY2RDQwOSBDRTYxRTQ5RiA1RURFRjkwRSAyOUQ5Qzk5OCBCMEQwOTgyMiBDN0Q3QThCNCA1OUIzM0QxNyAyRUI0MEQ4MSBCN0JENUMzQiBDMEJBNkNBRCBFREI4ODMyMCA5QUJGQjNCNiAwM0I2RTIwQyA3NEIxRDI5QSBFQUQ1NDczOSA5REQyNzdBRiAwNERCMjYxNSA3M0RDMTY4MyBFMzYzMEIxMiA5NDY0M0I4NCAwRDZENkEzRSA3QTZBNUFBOCBFNDBFQ0YwQiA5MzA5RkY5RCAwQTAwQUUyNyA3RDA3OUVCMSBGMDBGOTM0NCA4NzA4QTNEMiAxRTAxRjI2OCA2OTA2QzJGRSBGNzYyNTc1RCA4MDY1NjdDQiAxOTZDMzY3MSA2RTZCMDZFNyBGRUQ0MUI3NiA4OUQzMkJFMCAxMERBN0E1QSA2N0RENEFDQyBGOUI5REY2RiA4RUJFRUZGOSAxN0I3QkU0MyA2MEIwOEVENSBENkQ2QTNFOCBBMUQxOTM3RSAzOEQ4QzJDNCA0RkRGRjI1MiBEMUJCNjdGMSBBNkJDNTc2NyAzRkI1MDZERCA0OEIyMzY0QiBEODBEMkJEQSBBRjBBMUI0QyAzNjAzNEFGNiA0MTA0N0E2MCBERjYwRUZDMyBBODY3REY1NSAzMTZFOEVFRiA0NjY5QkU3OSBDQjYxQjM4QyBCQzY2ODMxQSAyNTZGRDJBMCA1MjY4RTIzNiBDQzBDNzc5NSBCQjBCNDcwMyAyMjAyMTZCOSA1NTA1MjYyRiBDNUJBM0JCRSBCMkJEMEIyOCAyQkI0NUE5MiA1Q0IzNkEwNCBDMkQ3RkZBNyBCNUQwQ0YzMSAyQ0Q5OUU4QiA1QkRFQUUxRCA5QjY0QzJCMCBFQzYzRjIyNiA3NTZBQTM5QyAwMjZEOTMwQSA5QzA5MDZBOSBFQjBFMzYzRiA3MjA3Njc4NSAwNTAwNTcxMyA5NUJGNEE4MiBFMkI4N0ExNCA3QkIxMkJBRSAwQ0I2MUIzOCA5MkQyOEU5QiBFNUQ1QkUwRCA3Q0RDRUZCNyAwQkRCREYyMSA4NkQzRDJENCBGMUQ0RTI0MiA2OEREQjNGOCAxRkRBODM2RSA4MUJFMTZDRCBGNkI5MjY1QiA2RkIwNzdFMSAxOEI3NDc3NyA4ODA4NUFFNiBGRjBGNkE3MCA2NjA2M0JDQSAxMTAxMEI1QyA4RjY1OUVGRiBGODYyQUU2OSA2MTZCRkZEMyAxNjZDQ0Y0NSBBMDBBRTI3OCBENzBERDJFRSA0RTA0ODM1NCAzOTAzQjNDMiBBNzY3MjY2MSBEMDYwMTZGNyA0OTY5NDc0RCAzRTZFNzdEQiBBRUQxNkE0QSBEOUQ2NUFEQyA0MERGMEI2NiAzN0Q4M0JGMCBBOUJDQUU1MyBERUJCOUVDNSA0N0IyQ0Y3RiAzMEI1RkZFOSBCREJERjIxQyBDQUJBQzI4QSA1M0IzOTMzMCAyNEI0QTNBNiBCQUQwMzYwNSBDREQ3MDY5MyA1NERFNTcyOSAyM0Q5NjdCRiBCMzY2N0EyRSBDNDYxNEFCOCA1RDY4MUIwMiAyQTZGMkI5NCBCNDBCQkUzNyBDMzBDOEVBMSA1QTA1REYxQiAyRDAyRUY4RFwiLnNwbGl0KCcgJyk7XG4gIFxuICAvKipcbiAgICogQG1ldGhvZCB0b0NSQzMyXG4gICAqIOaWh+Wtl+WIl+OBriBDUkMzMiDjgpLoqIjnrpfjgZfjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIFwicGhpbmEuanNcIi50b0NSQzMyKCk7IC8vID0+IDI2NzYzMjczOTRcbiAgICpcbiAgICogQHJldHVybiB7TnVtYmVyfSBDUkMzMiDjg4/jg4Pjgrfjg6XlgKRcbiAgICovXG4gIFN0cmluZy5wcm90b3R5cGUuJG1ldGhvZChcInRvQ1JDMzJcIiwgZnVuY3Rpb24oKSB7XG4gICAgdmFyIGNyYyA9IDAsIHg9MCwgeT0wO1xuICAgIFxuICAgIGNyYyA9IGNyYyBeICgtMSk7XG4gICAgZm9yICh2YXIgaT0wLCBpVG9wPXRoaXMubGVuZ3RoOyBpPGlUb3A7ICsraSkge1xuICAgICAgeSA9IChjcmMgXiB0aGlzLmNoYXJDb2RlQXQoaSkpICYgMHhmZjtcbiAgICAgIHggPSBcIjB4XCIgKyB0YWJsZVt5XTtcbiAgICAgIGNyYyA9IChjcmMgPj4+IDgpIF4geDtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIChjcmMgXiAoLTEpKSA+Pj4gMDtcbiAgfSk7XG5cbn0pKCk7XG5cblxuLypcbiAqIGFycmF5LmpzXG4gKi9cblxuOyhmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIGdsb2JhbC5BcnJheVxuICAgKiAjIOaLoeW8teOBl+OBnyBBcnJheSDjgq/jg6njgrlcbiAgICogQXJyYXkg44Kv44Op44K544KS5ouh5by144GX44Gm44GE44G+44GZ44CCXG4gICAqL1xuXG5cbiAgLyoqXG4gICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBmaXJzdFxuICAgKiDmnIDliJ3jga7opoHntKBcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIGFyciA9IFs2LCA1LCAyLCAzLCAxLCA0XTtcbiAgICogICAgIGFyci5maXJzdDsgLy8gPT4gNlxuICAgKi9cbiAgQXJyYXkucHJvdG90eXBlLmFjY2Vzc29yKFwiZmlyc3RcIiwge1xuICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSAgIHsgcmV0dXJuIHRoaXNbMF07IH0sXG4gICAgICBcInNldFwiOiBmdW5jdGlvbih2KSAgeyB0aGlzWzBdID0gdjsgfVxuICB9KTtcbiAgXG4gIC8qKlxuICAgKiBAcHJvcGVydHkge09iamVjdH0gbGFzdFxuICAgKiDmnIDlvozjga7opoHntKBcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIGFyciA9IFs2LCA1LCAyLCAzLCAxLCA0XTtcbiAgICogICAgIGFyci5sYXN0OyAvLyA9PiA0XG4gICAqL1xuICBBcnJheS5wcm90b3R5cGUuYWNjZXNzb3IoXCJsYXN0XCIsIHtcbiAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpc1t0aGlzLmxlbmd0aC0xXTsgfSxcbiAgICBcInNldFwiOiBmdW5jdGlvbih2KSAgeyB0aGlzW3RoaXMubGVuZ3RoLTFdID0gdjsgfVxuICB9KTtcblxuICAvKipcbiAgICogQG1ldGhvZCBlcXVhbHNcbiAgICog5rih44GV44KM44Gf6YWN5YiX44Go562J44GX44GE44GL44Gp44GG44GL44KS44OB44Kn44OD44Kv44GX44G+44GZ44CCXG4gICAqXG4gICAqIOimgee0oOWQjOWjq+OCkiA9PT0g44Gn5q+U6LyD44GX44G+44GZ44CC6KaB57Sg44Gr6YWN5YiX44GM5ZCr44G+44KM44Gm44GE44KL5aC05ZCI44GvIHtAbGluayAjZGVlcEVxdWFsc30g44KS5L2/55So44GX44Gm44GP44Gg44GV44GE44CCXG4gICAqXG4gICAqICMjIyBFeGFtcGxlXG4gICAqICAgICBhcnIxID0gWzYsIDUsIDIsIDMsIDEsIDRdO1xuICAgKiAgICAgYXJyMS5lcXVhbHMoWzYsIDUsIDIsIDMsIDEsIDRdKTsgICAgICAgLy8gPT4gdHJ1ZVxuICAgKiAgICAgYXJyMiA9IFs2LCA1LCAyLCBbMywgMV0sIDRdO1xuICAgKiAgICAgYXJyMi5lcXVhbHMoWzYsIDUsIDIsIFszLCAxXSwgNF0pOyAgICAgLy8gPT4gZmFsc2VcbiAgICogICAgIGFycjIuZGVlcEVxdWFscyhbNiwgNSwgMiwgWzMsIDFdLCA0XSk7IC8vID0+IHRydWVcbiAgICpcbiAgICogQHBhcmFtIHtBcnJheX0gYXJyIOavlOi8g+OBmeOCi+WvvuixoeOBrumFjeWIl1xuICAgKiBAcmV0dXJuIHtCb29sZWFufSDjg4Hjgqfjg4Pjgq/jga7ntZDmnpxcbiAgICovXG4gIEFycmF5LnByb3RvdHlwZS4kbWV0aG9kKFwiZXF1YWxzXCIsIGZ1bmN0aW9uKGFycikge1xuICAgIC8vIOmVt+OBleODgeOCp+ODg+OCr1xuICAgIGlmICh0aGlzLmxlbmd0aCAhPT0gYXJyLmxlbmd0aCkgcmV0dXJuIGZhbHNlO1xuICAgIFxuICAgIGZvciAodmFyIGk9MCxsZW49dGhpcy5sZW5ndGg7IGk8bGVuOyArK2kpIHtcbiAgICAgIGlmICh0aGlzW2ldICE9PSBhcnJbaV0pIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9KTtcblxuICAvKipcbiAgICogQG1ldGhvZCBkZWVwRXF1YWxzXG4gICAqIOODjeOCueODiOOBleOCjOOBpuOBhOOCi+mFjeWIl+OCkuWQq+OCgeOAgea4oeOBleOCjOOBn+mFjeWIl+OBqOetieOBl+OBhOOBi+OBqeOBhuOBi+OCkuODgeOCp+ODg+OCr+OBl+OBvuOBmeOAglxuICAgKlxuICAgKiDigLtlcXVhbHNEZWVwIOOBq+OBmeOCi+OBi+aknOioji4gKEphdmEg44Gn44GvIGRlZXBFcXVhbHMg44Gq44Gu44Gn44Go44KK44GC44GI44Ga5ZCI44KP44Gb44Go44GPKVxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgYXJyID0gWzYsIDUsIDIsIFszLCAxXSwgNF07XG4gICAqICAgICBhcnIuZXF1YWxzKFs2LCA1LCAyLCBbMywgMV0sIDRdKTsgICAgIC8vID0+IGZhbHNlXG4gICAqICAgICBhcnIuZGVlcEVxdWFscyhbNiwgNSwgMiwgWzMsIDFdLCA0XSk7IC8vID0+IHRydWVcbiAgICpcbiAgICogQHBhcmFtIHtBcnJheX0gYXJyIOavlOi8g+OBmeOCi+WvvuixoeOBrumFjeWIl1xuICAgKiBAcmV0dXJuIHtCb29sZWFufSDjg4Hjgqfjg4Pjgq/jga7ntZDmnpxcbiAgICovXG4gIEFycmF5LnByb3RvdHlwZS4kbWV0aG9kKFwiZGVlcEVxdWFsc1wiLCBmdW5jdGlvbihhcnIpIHtcbiAgICAvLyDplbfjgZXjg4Hjgqfjg4Pjgq9cbiAgICBpZiAodGhpcy5sZW5ndGggIT09IGFyci5sZW5ndGgpIHJldHVybiBmYWxzZTtcbiAgICBcbiAgICBmb3IgKHZhciBpPTAsbGVuPXRoaXMubGVuZ3RoOyBpPGxlbjsgKytpKSB7XG4gICAgICB2YXIgcmVzdWx0ID0gKHRoaXNbaV0uZGVlcEVxdWFscykgPyB0aGlzW2ldLmRlZXBFcXVhbHMoYXJyW2ldKSA6ICh0aGlzW2ldID09PSBhcnJbaV0pO1xuICAgICAgaWYgKHJlc3VsdCA9PT0gZmFsc2UpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgY29udGFpbnNcbiAgICog5oyH5a6a44GX44Gf6KaB57Sg44GM6YWN5YiX44Gr5ZCr44G+44KM44Gm44GE44KL44GL44KS44OB44Kn44OD44Kv44GX44G+44GZ44CCXG4gICAqXG4gICAqIOavlOi8g+OBq+OBr+WOs+WvhuOBquWQjOWApO+8iOS4iemHjeOCpOOCs+ODvOODq+a8lOeul+WtkCA9PT0g44Gn5L2/44KP44KM44KL44Gu44Go5ZCM44GY5pa55rOV77yJ44KS55So44GE44G+44GZ44CCXG4gICAqXG4gICAqICMjIyBFeGFtcGxlXG4gICAqICAgICBhcnIgPSBbNiwgNSwgMiwgMywgMSwgNF07XG4gICAqICAgICBhcnIuY29udGFpbnMoMyk7ICAgICAvLyA9PiB0cnVlXG4gICAqICAgICBhcnIuY29udGFpbnMoMywgNCk7ICAvLyA9PiBmYWxzZVxuICAgKiAgICAgYXJyLmNvbnRhaW5zKDMsIC00KTsgLy8gPT4gdHJ1ZVxuICAgKiAgICAgYXJyLmNvbnRhaW5zKFwiNlwiKTsgICAvLyA9PiBmYWxzZVxuICAgKlxuICAgKiBAcGFyYW0ge09iamVjdH0gaXRlbSDjg4Hjgqfjg4Pjgq/jgZnjgovjgqrjg5bjgrjjgqfjgq/jg4hcbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtmcm9tSW5kZXg9MF0g5qSc57Si44KS5aeL44KB44KL5L2N572u44CC6LKg5pWw44KS5oyH5a6a44GX44Gf5aC05ZCI44Gv5pyr5bC+44GL44KJ44Gu44Kq44OV44K744OD44OI44Go6KaL44Gq44GX44G+44GZ44CCXG4gICAqIEByZXR1cm4ge0Jvb2xlYW59IOODgeOCp+ODg+OCr+OBrue1kOaenFxuICAgKi9cbiAgQXJyYXkucHJvdG90eXBlLiRtZXRob2QoXCJjb250YWluc1wiLCBmdW5jdGlvbihpdGVtLCBmcm9tSW5kZXgpIHtcbiAgICByZXR1cm4gdGhpcy5pbmRleE9mKGl0ZW0sIGZyb21JbmRleCkgIT0gLTE7XG4gIH0pO1xuICBcbiAgLyoqXG4gICAqIEBtZXRob2QgYXRcbiAgICog5oyH5a6a44GX44Gf44Kk44Oz44OH44OD44Kv44K544Gu6KaB57Sg44KS6L+U44GX44G+44GZ77yI44Or44O844OX44O76LKg5pWw44Gu5oyH5a6a5Y+v77yJ44CCXG4gICAqXG4gICAqIOa3u+Wtl+OBjOiyoOaVsOOBruWgtOWQiOOBr+acq+WwvuOBi+OCieOBruOCquODleOCu+ODg+ODiOOBqOOBv+OBquOBl+OBvuOBmeOAguacq+WwvuOBruimgee0oOOBjCAtMSDnlarnm67jgavjgarjgorjgb7jgZnjgIIgIFxuICAgKiDmt7vlrZfjga7ntbblr77lgKTjgYwgQXJyYXkubGVuZ3RoIOS7peS4iuOBruWgtOWQiOOBr+ODq+ODvOODl+OBl+OBvuOBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgYXJyID0gWydhJywgJ2InLCAnYycsICdkJywgJ2UnLCAnZiddO1xuICAgKiAgICAgYXJyLmF0KDApOyAgLy8gPT4gJ2EnXG4gICAqICAgICBhcnIuYXQoNik7ICAvLyA9PiAnYSdcbiAgICogICAgIGFyci5hdCgxMyk7IC8vID0+ICdiJ1xuICAgKiAgICAgYXJyLmF0KC0xKTsgLy8gPT4gJ2YnXG4gICAqICAgICBhcnIuYXQoLTgpOyAvLyA9PiAnZSdcbiAgICpcbiAgICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4IOa3u+Wtl1xuICAgKiBAcmV0dXJuIHtPYmplY3R9IOa3u+Wtl+OBp+aMh+WumuOBleOCjOOBn+imgee0oFxuICAgKi9cbiAgQXJyYXkucHJvdG90eXBlLiRtZXRob2QoXCJhdFwiLCBmdW5jdGlvbihpKSB7XG4gICAgaSU9dGhpcy5sZW5ndGg7XG4gICAgaSs9dGhpcy5sZW5ndGg7XG4gICAgaSU9dGhpcy5sZW5ndGg7XG4gICAgcmV0dXJuIHRoaXNbaV07XG4gIH0pO1xuXG5cbiAgLyoqXG4gICAqIEBtZXRob2QgZmluZFxuICAgKiDlkITopoHntKDjgpLlvJXmlbDjgavjgZfjgabplqLmlbDjgpLlrp/ooYzjgZfjgIHjgZ3jga7lgKTjgYznnJ/jgajjgarjgovvvIjvvJ3mnaHku7bjgavjg57jg4Pjg4HjgZnjgovvvInmnIDliJ3jga7opoHntKDjgpLov5TjgZfjgb7jgZnjgIJcbiAgICpcbiAgICog44Gp44Gu6KaB57Sg44KC44Oe44OD44OB44GX44Gq44GR44KM44GwIHVuZGVmaW5lZCDjgpLov5TjgZfjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIGFyciA9IFsnZm9vJywgJ2JhcicsICdob2dlJywgJ2Z1Z2EnXTtcbiAgICogICAgIGFyci5maW5kKCBmdW5jdGlvbihlbG0pIHtcbiAgICogICAgICAgcmV0dXJuIGVsbS5pbmRleE9mKCdhJykgPj0gMDtcbiAgICogICAgIH0pO1xuICAgKiAgICAgLy8gPT4gJ2JhcidcbiAgICpcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sg5ZCE6KaB57Sg44Gr5a++44GX44Gm5a6f6KGM44GZ44KL44Kz44O844Or44OQ44OD44Kv6Zai5pWwXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbc2VsZj10aGlzXSBjYWxsYmFjayDlhoXjgacgdGhpcyDjgajjgZfjgablj4LnhafjgZXjgozjgovlgKTjgILjg4fjg5Xjgqnjg6vjg4jjga/lkbzjgbPlh7rjgZfmmYLjga4gdGhpc+OAglxuICAgKiBAcmV0dXJuIHtPYmplY3R9IOadoeS7tuOBq+ODnuODg+ODgeOBl+OBn+acgOWIneOBruimgee0oOOAgeOBvuOBn+OBryB1bmRlZmluZWRcbiAgICovXG4gIEFycmF5LnByb3RvdHlwZS4kbWV0aG9kKFwiZmluZFwiLCBmdW5jdGlvbihmbiwgc2VsZikge1xuICAgIHZhciB0YXJnZXQgPSBudWxsO1xuXG4gICAgdGhpcy5zb21lKGZ1bmN0aW9uKGVsbSwgaSkge1xuICAgICAgaWYgKGZuLmNhbGwoc2VsZiwgZWxtLCBpLCB0aGlzKSkge1xuICAgICAgICB0YXJnZXQgPSBlbG07XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRhcmdldDtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgZmluZEluZGV4XG4gICAqIOWQhOimgee0oOOCkuW8leaVsOOBq+OBl+OBpumWouaVsOOCkuWun+ihjOOBl+OAgeOBneOBruWApOOBjOecn+OBqOOBquOCi++8iO+8neadoeS7tuOBq+ODnuODg+ODgeOBmeOCi++8ieacgOWIneOBruOCpOODs+ODh+ODg+OCr+OCueOCkui/lOOBl+OBvuOBmeOAglxuICAgKlxuICAgKiDjganjga7opoHntKDjgoLjg57jg4Pjg4HjgZfjgarjgZHjgozjgbAgLTEg44KS6L+U44GX44G+44GZ44CCXG4gICAqXG4gICAqICMjIyBFeGFtcGxlXG4gICAqICAgICBhcnIgPSBbJ2ZvbycsICdiYXInLCAnaG9nZScsICdmdWdhJ107XG4gICAqICAgICBhcnIuZmluZEluZGV4KCBmdW5jdGlvbihlbG0pIHtcbiAgICogICAgICAgcmV0dXJuIGVsbS5pbmRleE9mKCdhJykgPj0gMDtcbiAgICogICAgIH0pO1xuICAgKiAgICAgLy8gPT4gMVxuICAgKlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayDlkITopoHntKDjgavlr77jgZfjgablrp/ooYzjgZnjgovjgrPjg7zjg6vjg5Djg4Pjgq/plqLmlbBcbiAgICogQHBhcmFtIHtPYmplY3R9IFtzZWxmPXRoaXNdIGNhbGxiYWNrIOWGheOBpyB0aGlzIOOBqOOBl+OBpuWPgueFp+OBleOCjOOCi+WApOOAguODh+ODleOCqeODq+ODiOOBr+WRvOOBs+WHuuOBl+aZguOBriB0aGlz44CCXG4gICAqIEByZXR1cm4ge09iamVjdH0g5p2h5Lu244Gr44Oe44OD44OB44GX44Gf5pyA5Yid44Gu44Kk44Oz44OH44OD44Kv44K544CB44G+44Gf44GvIC0xXG4gICAqL1xuICBBcnJheS5wcm90b3R5cGUuJG1ldGhvZChcImZpbmRJbmRleFwiLCBmdW5jdGlvbihmbiwgc2VsZikge1xuICAgIHZhciB0YXJnZXQgPSAtMTtcblxuICAgIHRoaXMuc29tZShmdW5jdGlvbihlbG0sIGkpIHtcbiAgICAgIGlmIChmbi5jYWxsKHNlbGYsIGVsbSwgaSwgdGhpcykpIHtcbiAgICAgICAgdGFyZ2V0ID0gaTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGFyZ2V0O1xuICB9KTtcbiAgXG4gIC8qKlxuICAgKiBAbWV0aG9kIHN3YXBcbiAgICogQGNoYWluYWJsZVxuICAgKiBhIOeVquebruOBruimgee0oCDjgaggYiDnlarnm67jga7opoHntKDjgpLlhaXjgozmm7/jgYjjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIGFycjEgPSBbJ2EnLCAnYicsICdjJywgJ2QnXTtcbiAgICogICAgIGFycjIgPSBhcnIxLnN3YXAoMCwgMyk7IC8vID0+IFsnZCcsICdiJywgJ2MnLCAnYSddXG4gICAqICAgICBhcnIxID09PSBhcnIyOyAgICAgICAgICAvLyA9PiB0cnVlXG4gICAqXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBhICDjgqTjg7Pjg4fjg4Pjgq/jgrlcbiAgICogQHBhcmFtIHtOdW1iZXJ9IGIgIOOCpOODs+ODh+ODg+OCr+OCuVxuICAgKi9cbiAgQXJyYXkucHJvdG90eXBlLiRtZXRob2QoXCJzd2FwXCIsIGZ1bmN0aW9uKGEsIGIpIHtcbiAgICB2YXIgdGVtcCA9IHRoaXNbYV07XG4gICAgdGhpc1thXSA9IHRoaXNbYl07XG4gICAgdGhpc1tiXSA9IHRlbXA7XG4gICAgXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGVyYXNlXG4gICAqIEBjaGFpbmFibGVcbiAgICog5oyH5a6a44GX44Gf44Kq44OW44K444Kn44Kv44OI44Go5LiA6Ie044GX44Gf5pyA5Yid44Gu6KaB57Sg44KS5YmK6Zmk44GX44G+44GZ44CCXG4gICAqXG4gICAqICMjIyBFeGFtcGxlXG4gICAqICAgICBhcnIxID0gWydhJywgJ2InLCAnYicsICdjJ107XG4gICAqICAgICBhcnIyID0gYXJyMS5lcmFzZSgnYicpOyAvLyA9PiBbJ2EnLCAnYicsICdjJ11cbiAgICogICAgIGFycjEgPT09IGFycjI7ICAgICAgICAgIC8vID0+IHRydWVcbiAgICpcbiAgICogQHBhcmFtIHtPYmplY3R9IGVsbSDliYrpmaTjgZfjgZ/jgYTjgqrjg5bjgrjjgqfjgq/jg4hcbiAgICovXG4gIEFycmF5LnByb3RvdHlwZS4kbWV0aG9kKFwiZXJhc2VcIiwgZnVuY3Rpb24oZWxtKSB7XG4gICAgdmFyIGluZGV4ICA9IHRoaXMuaW5kZXhPZihlbG0pO1xuICAgIGlmIChpbmRleCA+PSAwKSB7XG4gICAgICB0aGlzLnNwbGljZShpbmRleCwgMSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9KTtcbiAgXG4gIC8qKlxuICAgKiBAbWV0aG9kIGVyYXNlQWxsXG4gICAqIEBjaGFpbmFibGVcbiAgICog5oyH5a6a44GX44Gf44Kq44OW44K444Kn44Kv44OI44Go5LiA6Ie044GX44Gf44GZ44G544Gm44Gu6KaB57Sg44KS5YmK6Zmk44GX44G+44GZ44CCXG4gICAqXG4gICAqICMjIyBFeGFtcGxlXG4gICAqICAgICBhcnIxID0gWydhJywgJ2InLCAnYicsICdjJ107XG4gICAqICAgICBhcnIyID0gYXJyMS5lcmFzZUFsbCgnYicpOyAvLyA9PiBbJ2EnLCAnYyddXG4gICAqICAgICBhcnIxID09PSBhcnIyOyAgICAgICAgICAgICAvLyA9PiB0cnVlXG4gICAqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBlbG0g5YmK6Zmk44GX44Gf44GE44Kq44OW44K444Kn44Kv44OIXG4gICAqL1xuICBBcnJheS5wcm90b3R5cGUuJG1ldGhvZChcImVyYXNlQWxsXCIsIGZ1bmN0aW9uKGVsbSkge1xuICAgIGZvciAodmFyIGk9MCxsZW49dGhpcy5sZW5ndGg7IGk8bGVuOyArK2kpIHtcbiAgICAgIGlmICh0aGlzW2ldID09IGVsbSkge1xuICAgICAgICB0aGlzLnNwbGljZShpLS0sIDEpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfSk7XG4gIFxuICAvKipcbiAgICogQG1ldGhvZCBlcmFzZUlmXG4gICAqIEBjaGFpbmFibGVcbiAgICog5ZCE6KaB57Sg44KS5byV5pWw44Gr44GX44Gm6Zai5pWw44KS5a6f6KGM44GX44CB44Gd44Gu5YCk44GM55yf44Go44Gq44KL77yI77yd5p2h5Lu244Gr44Oe44OD44OB44GZ44KL77yJ5pyA5Yid44Gu6KaB57Sg44KS5YmK6Zmk44GX44G+44GZ44CCXG4gICAqXG4gICAqIOOBqeOBruimgee0oOOCguODnuODg+ODgeOBl+OBquOBkeOCjOOBsOS9leOCgui1t+OBjeOBvuOBm+OCk+OAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgYXJyID0gWydmb28nLCAnYmFyJywgJ2hvZ2UnLCAnZnVnYSddO1xuICAgKiAgICAgYXJyLmVyYXNlSWYoIGZ1bmN0aW9uKGVsbSkge1xuICAgKiAgICAgICByZXR1cm4gZWxtLmluZGV4T2YoJ28nKSA+PSAwO1xuICAgKiAgICAgfSk7XG4gICAqICAgICAvLyA9PiBbJ2JhcicsICdob2dlJywgJ2Z1Z2EnXVxuICAgKlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayDlkITopoHntKDjgavlr77jgZfjgablrp/ooYzjgZnjgovjgrPjg7zjg6vjg5Djg4Pjgq/plqLmlbBcbiAgICovXG4gIEFycmF5LnByb3RvdHlwZS4kbWV0aG9kKFwiZXJhc2VJZlwiLCBmdW5jdGlvbihmbikge1xuICAgIGZvciAodmFyIGk9MCxsZW49dGhpcy5sZW5ndGg7IGk8bGVuOyArK2kpIHtcbiAgICAgIGlmICggZm4odGhpc1tpXSwgaSwgdGhpcykgKSB7XG4gICAgICAgIHRoaXMuc3BsaWNlKGksIDEpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0pO1xuICBcbiAgLyoqXG4gICAqIEBtZXRob2QgZXJhc2VJZkFsbFxuICAgKiBAY2hhaW5hYmxlXG4gICAqIOWQhOimgee0oOOCkuW8leaVsOOBq+OBl+OBpumWouaVsOOCkuWun+ihjOOBl+OAgeOBneOBruWApOOBjOecn+OBqOOBquOCi++8iO+8neadoeS7tuOBq+ODnuODg+ODgeOBmeOCi++8ieOBmeOBueOBpuOBruimgee0oOOCkuWJiumZpOOBl+OBvuOBmeOAglxuICAgKlxuICAgKiDjganjga7opoHntKDjgoLjg57jg4Pjg4HjgZfjgarjgZHjgozjgbDkvZXjgoLotbfjgY3jgb7jgZvjgpPjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIGFyciA9IFsnZm9vJywgJ2JhcicsICdob2dlJywgJ2Z1Z2EnXTtcbiAgICogICAgIGFyci5lcmFzZUlmQWxsKCBmdW5jdGlvbihlbG0pIHtcbiAgICogICAgICAgcmV0dXJuIGVsbS5pbmRleE9mKCdvJykgPj0gMDtcbiAgICogICAgIH0pO1xuICAgKiAgICAgLy8gPT4gWydiYXInLCAnZnVnYSddXG4gICAqXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIOWQhOimgee0oOOBq+WvvuOBl+OBpuWun+ihjOOBmeOCi+OCs+ODvOODq+ODkOODg+OCr+mWouaVsFxuICAgKi9cbiAgQXJyYXkucHJvdG90eXBlLiRtZXRob2QoXCJlcmFzZUlmQWxsXCIsIGZ1bmN0aW9uKGZuKSB7XG4gICAgZm9yICh2YXIgaT0wLGxlbj10aGlzLmxlbmd0aDsgaTxsZW47ICsraSkge1xuICAgICAgaWYgKCBmbih0aGlzW2ldLCBpLCB0aGlzKSApIHtcbiAgICAgICAgdGhpcy5zcGxpY2UoaS0tLCAxKTtcbiAgICAgICAgbGVuLS07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9KTtcbiAgXG4gIC8qKlxuICAgKiBAbWV0aG9kIHJhbmRvbVxuICAgKiDphY3liJfjgYvjgonjg6njg7Pjg4Djg6Djgasx44Gk5Y+W44KK5Ye644GX44Gf6KaB57Sg44KS6L+U44GX44G+44GZ44CCXG4gICAqXG4gICAqIOWPluOCiuWHuuOBmeevhOWbsuOCkuOCpOODs+ODh+ODg+OCr+OCueOBp+aMh+WumuOBmeOCi+OBk+OBqOOCguOBp+OBjeOBvuOBmeOAgiAgXG4gICAqIHtAbGluayAjcGlja3VwfeOAgXtAbGluayAjbG90fSDjgajlkIzjgZjjgafjgZnjgIIgIFxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgYXJyID0gWydmb28nLCAnYmFyJywgJ2hvZ2UnLCAnZnVnYSddO1xuICAgKiAgICAgYXJyLnJhbmRvbSgyLCAzKTsgIC8vID0+ICdob2dlJyDjgb7jgZ/jga8gJ2Z1Z2EnXG4gICAqXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBbbWluPTBdIOOCpOODs+ODh+ODg+OCr+OCueOBruS4i+mZkFxuICAgKiBAcGFyYW0ge051bWJlcn0gW21heD3phY3liJfjga7mnIDlpKfjgqTjg7Pjg4fjg4Pjgq/jgrldIOOCpOODs+ODh+ODg+OCr+OCueOBruS4iumZkFxuICAgKiBAcmV0dXJuIHtPYmplY3R9IOODqeODs+ODgOODoOOBqzHjgaTlj5bjgorlh7rjgZfjgZ/opoHntKBcbiAgICovXG4gIEFycmF5LnByb3RvdHlwZS4kbWV0aG9kKFwicmFuZG9tXCIsIGZ1bmN0aW9uKG1pbiwgbWF4KSB7XG4gICAgbWluID0gbWluIHx8IDA7XG4gICAgbWF4ID0gbWF4IHx8IHRoaXMubGVuZ3RoLTE7XG4gICAgcmV0dXJuIHRoaXNbIE1hdGgucmFuZGludChtaW4sIG1heCkgXTtcbiAgfSk7XG4gIFxuICAvKipcbiAgICogQG1ldGhvZCBwaWNrdXBcbiAgICog6YWN5YiX44GL44KJ44Op44Oz44OA44Og44GnMeOBpOWPluOCiuWHuuOBl+OBn+imgee0oOOCkui/lOOBl+OBvuOBmeOAglxuICAgKlxuICAgKiB7QGxpbmsgI3JhbmRvbX3jgIF7QGxpbmsgI2xvdH0g44Go5ZCM44GY44Gn44GZ44CCXG4gICAqIEBpbmhlcml0ZG9jICNyYW5kb21cbiAgICovXG4gIEFycmF5LnByb3RvdHlwZS4kbWV0aG9kKFwicGlja3VwXCIsIGZ1bmN0aW9uKG1pbiwgbWF4KSB7XG4gICAgbWluID0gbWluIHx8IDA7XG4gICAgbWF4ID0gbWF4IHx8IHRoaXMubGVuZ3RoLTE7XG4gICAgcmV0dXJuIHRoaXNbIE1hdGgucmFuZGludChtaW4sIG1heCkgXTtcbiAgfSk7XG4gIFxuICAvKipcbiAgICogQG1ldGhvZCBsb3RcbiAgICog6YWN5YiX44GL44KJ44Op44Oz44OA44Og44GnMeOBpOWPluOCiuWHuuOBl+OBn+imgee0oOOCkui/lOOBl+OBvuOBmeOAglxuICAgKlxuICAgKiB7QGxpbmsgI3JhbmRvbX3jgIF7QGxpbmsgI3BpY2t1cH0g44Go5ZCM44GY44Gn44GZ44CCXG4gICAqIEBpbmhlcml0ZG9jICNyYW5kb21cbiAgICovXG4gIEFycmF5LnByb3RvdHlwZS4kbWV0aG9kKFwibG90XCIsIGZ1bmN0aW9uKG1pbiwgbWF4KSB7XG4gICAgbWluID0gbWluIHx8IDA7XG4gICAgbWF4ID0gbWF4IHx8IHRoaXMubGVuZ3RoLTE7XG4gICAgcmV0dXJuIHRoaXNbIE1hdGgucmFuZGludChtaW4sIG1heCkgXTtcbiAgfSk7XG4gIFxuICAvKipcbiAgICogQG1ldGhvZCB1bmlxXG4gICAqIOimgee0oOOBrumHjeikh+OCkuWPluOCiumZpOOBhOOBn+mFjeWIl+OCkueUn+aIkOOBl+OBpui/lOOBl+OBvuOBmeOAglxuICAgKlxuICAgKiDoh6rliIboh6rouqvjga/noLTlo4rjgZXjgozjgb7jgZvjgpPjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIGFyciA9IFsxLCAyLCAzLCA0LCAzLCAyXTtcbiAgICogICAgIGFyci51bmlxKCk7IC8vID0+IFsxLCAyLCAzLCA0XVxuICAgKlxuICAgKiBAcGFyYW0ge051bWJlcn0gW2RlZXBdIOKAu+acquS9v+eUqFxuICAgKiBAcmV0dXJuIHtPYmplY3R9IOaWsOOBl+OBhOmFjeWIl1xuICAgKi9cbiAgQXJyYXkucHJvdG90eXBlLiRtZXRob2QoXCJ1bmlxXCIsIGZ1bmN0aW9uKGRlZXApIHtcbiAgICByZXR1cm4gdGhpcy5maWx0ZXIoZnVuY3Rpb24odmFsdWUsIGluZGV4LCBzZWxmKSB7XG4gICAgICByZXR1cm4gc2VsZi5pbmRleE9mKHZhbHVlKSA9PT0gaW5kZXg7XG4gICAgfSk7XG4gIH0pO1xuICBcblxuICAvKipcbiAgICogQG1ldGhvZCBmbGF0dGVuXG4gICAqIOiHqui6q+OCkuWGjeW4sOeahOOBq+W5s+a7keWMluOBl+OBn+mFjeWIl+OCkueUn+aIkOOBl+OBpui/lOOBl+OBvuOBmeOAglxuICAgKlxuICAgKiBsZXZlbCDjgpLmjIflrprjgZfjgarjgZHjgozjgbDmt7HjgZXjga7pmpvpmZDjgarjgY/lrozlhajjgavlubPmu5HljJbjgZfjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIGFyciA9IFsxLCAyLCBbMywgWzQsIDVdXV07XG4gICAqICAgICBhcnIuZmxhdHRlbigpOyAgLy8gPT4gWzEsIDIsIDMsIDQsIDVdXG4gICAqICAgICBhcnIuZmxhdHRlbigxKTsgLy8gPT4gWzEsIDIsIDMsIFs0LCA1XV1cbiAgICpcbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtsZXZlbD0wXSAg5bmz5ruR5YyW44Gu5YaN5biw44Gu5rex44GVXG4gICAqIEByZXR1cm4ge09iamVjdH0g5bmz5ruR5YyW44GX44Gf6YWN5YiXXG4gICAqL1xuICBBcnJheS5wcm90b3R5cGUuJG1ldGhvZChcImZsYXR0ZW5cIiwgZnVuY3Rpb24obGV2ZWwpIHtcbiAgICB2YXIgYXJyID0gbnVsbDtcblxuICAgIGlmIChsZXZlbCkge1xuICAgICAgYXJyID0gdGhpcztcbiAgICAgIGZvciAodmFyIGk9MDsgaTxsZXZlbDsgKytpKSB7XG4gICAgICAgIGFyciA9IEFycmF5LnByb3RvdHlwZS5jb25jYXQuYXBwbHkoW10sIGFycik7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgLy8g5a6M5YWo44OV44Op44OD44OIXG4gICAgICBhcnIgPSB0aGlzLnJlZHVjZShmdW5jdGlvbiAocHJldmlvdXNWYWx1ZSwgY3VyZW50VmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoY3VyZW50VmFsdWUpID9cbiAgICAgICAgICBwcmV2aW91c1ZhbHVlLmNvbmNhdChjdXJlbnRWYWx1ZS5mbGF0dGVuKCkpIDogcHJldmlvdXNWYWx1ZS5jb25jYXQoY3VyZW50VmFsdWUpO1xuICAgICAgfSwgW10pO1xuICAgIH1cblxuICAgIHJldHVybiBhcnI7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGNsb25lXG4gICAqIOiHqui6q+OBruOCs+ODlOODvOOCkueUn+aIkOOBl+OBpui/lOOBl+OBvuOBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgYXJyMSA9IFsxLCAyLCBbMywgNF1dO1xuICAgKiAgICAgYXJyMiA9IGFycjEuY2xvbmUoKTsgICAgICAvLyA9PiBbMSwgMiwgWzMsIDRdXVxuICAgKiAgICAgYXJyMVsyXSA9PT0gYXJyMlsyXTsgICAgICAvLyA9PiB0cnVlXG4gICAqICAgICBhcnIxWzJdWzBdID0gOTtcbiAgICogICAgIGFycjI7ICAgICAgICAgICAgICAgICAgICAgLy8gPT4gWzEsIDIsIFs5LCA0XV1cbiAgICogICAgIGFycjEgPSBbMSwgMiwgWzMsIDRdXTtcbiAgICogICAgIGFycjIgPSBhcnIxLmNsb25lKHRydWUpOyAgLy8gPT4gWzEsIDIsIFszLCA0XV1cbiAgICogICAgIGFycjFbMl0gPT09IGFycjJbMl07ICAgICAgLy8gPT4gZmFsc2VcbiAgICogICAgIGFycjFbMl1bMF0gPSA5O1xuICAgKiAgICAgYXJyMjsgICAgICAgICAgICAgICAgICAgICAvLyA9PiBbMSwgMiwgWzMsIDRdXVxuICAgKlxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtkZWVwPWZhbHNlXSDphY3liJfjga7jg43jgrnjg4jjgpLjgZ/jganjgaPjgabopIfoo73jgZnjgovjgYvjganjgYbjgYtcbiAgICogQHJldHVybiB7T2JqZWN0fSDmlrDjgZfjgYTphY3liJdcbiAgICovXG4gIEFycmF5LnByb3RvdHlwZS4kbWV0aG9kKFwiY2xvbmVcIiwgZnVuY3Rpb24oZGVlcCkge1xuICAgIGlmIChkZWVwID09PSB0cnVlKSB7XG4gICAgICB2YXIgYSA9IEFycmF5KHRoaXMubGVuZ3RoKTtcbiAgICAgIGZvciAodmFyIGk9MCxsZW49dGhpcy5sZW5ndGg7IGk8bGVuOyArK2kpIHtcbiAgICAgICAgYVtpXSA9ICh0aGlzW2ldLmNsb25lKSA/IHRoaXNbaV0uY2xvbmUoZGVlcCkgOiB0aGlzW2ldO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGE7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5hcHBseSh0aGlzKTtcbiAgICB9XG4gIH0pO1xuXG5cbiAgLyoqXG4gICAqIEBtZXRob2QgY2xlYXJcbiAgICogQGNoYWluYWJsZVxuICAgKiDoh6rouqvjgpLnqbrjga7phY3liJfjgavjgZfjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIGFyciA9IFsxLCAyLCBbMywgNF1dO1xuICAgKiAgICAgYXJyLmNsZWFyKCk7IC8vID0+IFtdXG4gICAqL1xuICBBcnJheS5wcm90b3R5cGUuJG1ldGhvZChcImNsZWFyXCIsIGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubGVuZ3RoID0gMDtcbiAgICByZXR1cm4gdGhpcztcbiAgfSk7XG4gIFxuICAvKipcbiAgICogQG1ldGhvZCBmaWxsXG4gICAqIEBjaGFpbmFibGVcbiAgICog6Ieq6Lqr44Gu5LiA6YOo44Gu6KaB57Sg44KS54m55a6a44Gu5YCk44Gn5Z+L44KB44G+44GZ44CCXG4gICAqXG4gICAqICMjIyBFeGFtcGxlXG4gICAqICAgICBhcnIgPSBbMSwgMiwgMywgNCwgNV07XG4gICAqICAgICBhcnIuZmlsbChcInhcIik7ICAgICAgIC8vID0+IFtcInhcIiwgXCJ4XCIsIFwieFwiLCBcInhcIiwgXCJ4XCJdXG4gICAqICAgICBhcnIuZmlsbChcInhcIiwgMiwgNCk7IC8vID0+IFsxLCAyLCBcInhcIiwgXCJ4XCIsIDVdXG4gICAqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSB2YWx1ZSDln4vjgoHjgovlgKRcbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtzdGFydD0wXSDlgKTjgpLln4vjgoHjgovmnIDliJ3jga7jgqTjg7Pjg4fjg4Pjgq/jgrlcbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtlbmQ96Ieq6Lqr44Gu6YWN5YiX44Gu6ZW344GVXSDlgKTjgpLln4vjgoHjgovmnIDlvozjga7jgqTjg7Pjg4fjg4Pjgq/jgrkrMVxuICAgKi9cbiAgQXJyYXkucHJvdG90eXBlLiRtZXRob2QoXCJmaWxsXCIsIGZ1bmN0aW9uKHZhbHVlLCBzdGFydCwgZW5kKSB7XG4gICAgc3RhcnQgPSBzdGFydCB8fCAwO1xuICAgIGVuZCAgID0gZW5kICAgfHwgKHRoaXMubGVuZ3RoKTtcbiAgICBcbiAgICBmb3IgKHZhciBpPXN0YXJ0OyBpPGVuZDsgKytpKSB7XG4gICAgICB0aGlzW2ldID0gdmFsdWU7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiB0aGlzO1xuICB9KTtcbiAgXG5cbiAgLyoqXG4gICAqIEBtZXRob2QgcmFuZ2VcbiAgICogQGNoYWluYWJsZVxuICAgKiDoh6rouqvjgpLnrYnlt67mlbDliJfvvIjkuIDlrprplpPpmpTjga7mlbTmlbDlgKTjga7liJfvvInjgajjgZfjgb7jgZnjgIJcbiAgICpcbiAgICogLSDlvJXmlbDjgYwx44Gk44Gu5aC05ZCI44CBMO+9nmVuZO+8iGVuZOWQq+OBvuOBmu+8ieOBruaVtOaVsOOBrumFjeWIl+OBp+OBmeOAgiAgXG4gICAqIC0g5byV5pWw44GMMuOBpOOBruWgtOWQiOOAgXN0YXJ0772eZW5k77yIZW5k5ZCr44G+44Ga77yJ44Gu5pW05pWw44Gu6YWN5YiX44Gn44GZ44CCICBcbiAgICogLSDlvJXmlbDjgYwz44Gk44Gu5aC05ZCI44CBc3RhcnTvvZ5lbmTvvIhlbmTlkKvjgb7jgZrvvInjgYvjgaQgc3RhcnQgKyBuICogc3RlcCAobuOBr+aVtOaVsCnjgpLmuoDjgZ/jgZnmlbTmlbDjga7phY3liJfjgafjgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIGFyciA9IFtdO1xuICAgKiAgICAgYXJyLnJhbmdlKDQpOyAgICAgICAgLy8gPT4gWzAsIDEsIDIsIDNdXG4gICAqICAgICBhcnIucmFuZ2UoMiwgNSk7ICAgICAvLyA9PiBbMiwgMywgNF1cbiAgICogICAgIGFyci5yYW5nZSgyLCAxNCwgNSk7IC8vID0+IFsyLCA3LCAxMl1cbiAgICogICAgIGFyci5yYW5nZSgyLCAtMyk7ICAgIC8vID0+IFsyLCAxLCAwLCAtMSwgLTJdXG4gICAqXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBzdGFydCDmnIDliJ3jga7lgKTvvIjjg4fjg5Xjgqnjg6vjg4jjga8gMO+8iVxuICAgKiBAcGFyYW0ge051bWJlcn0gZW5kIOacgOW+jOOBruWApO+8iOecgeeVpeS4jeWPr++8iVxuICAgKiBAcGFyYW0ge051bWJlcn0gW3N0ZXA9MeOBvuOBn+OBry0xXSDplpPpmpRcbiAgICovXG4gIEFycmF5LnByb3RvdHlwZS4kbWV0aG9kKFwicmFuZ2VcIiwgZnVuY3Rpb24oc3RhcnQsIGVuZCwgc3RlcCkge1xuICAgIHRoaXMuY2xlYXIoKTtcbiAgICBcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAxKSB7XG4gICAgICBmb3IgKHZhciBpPTA7IGk8c3RhcnQ7ICsraSkgdGhpc1tpXSA9IGk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHN0YXJ0IDwgZW5kKSB7XG4gICAgICBzdGVwID0gc3RlcCB8fCAxO1xuICAgICAgaWYgKHN0ZXAgPiAwKSB7XG4gICAgICAgIGZvciAodmFyIGk9c3RhcnQsIGluZGV4PTA7IGk8ZW5kOyBpKz1zdGVwLCArK2luZGV4KSB7XG4gICAgICAgICAgdGhpc1tpbmRleF0gPSBpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgc3RlcCA9IHN0ZXAgfHwgLTE7XG4gICAgICBpZiAoc3RlcCA8IDApIHtcbiAgICAgICAgZm9yICh2YXIgaT1zdGFydCwgaW5kZXg9MDsgaT5lbmQ7IGkrPXN0ZXAsICsraW5kZXgpIHtcbiAgICAgICAgICB0aGlzW2luZGV4XSA9IGk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0pO1xuICBcbiAgLyoqXG4gICAqIEBtZXRob2Qgc2h1ZmZsZVxuICAgKiBAY2hhaW5hYmxlXG4gICAqIOiHqui6q+OBruimgee0oOOCkuODqeODs+ODgOODoOOBq+OCt+ODo+ODg+ODleODq+OBl+OBvuOBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgYXJyID0gWzEsIDIsIDMsIDQsIDVdO1xuICAgKiAgICAgYXJyLnNodWZmbGUoKTsgLy8gPT4gWzUsIDEsIDQsIDIsIDNdIOOBquOBqVxuICAgKi9cbiAgQXJyYXkucHJvdG90eXBlLiRtZXRob2QoXCJzaHVmZmxlXCIsIGZ1bmN0aW9uKCkge1xuICAgIGZvciAodmFyIGk9MCxsZW49dGhpcy5sZW5ndGg7IGk8bGVuOyArK2kpIHtcbiAgICAgIHZhciBqID0gTWF0aC5yYW5kaW50KDAsIGxlbi0xKTtcbiAgICAgIFxuICAgICAgaWYgKGkgIT0gaikge1xuICAgICAgICB0aGlzLnN3YXAoaSwgaik7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiB0aGlzO1xuICB9KTtcblxuICAvKipcbiAgICogQG1ldGhvZCBzdW1cbiAgICog6KaB57Sg44Gu5ZCI6KiI5YCk44KS6L+U44GX44G+44GZ44CCXG4gICAqXG4gICAqIOimgee0oOOBq+aVsOWApOS7peWkluOBjOWQq+OBvuOCjOOCi+WgtOWQiOOBruaMmeWLleOBr+S4jeWumuOBp+OBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgYXJyID0gWzEsIDIsIDMsIDQsIDUsIDZdO1xuICAgKiAgICAgYXJyLnN1bSgpOyAvLyA9PiAyMVxuICAgKlxuICAgKiBAcmV0dXJuIHtOdW1iZXJ9IOWQiOioiFxuICAgKi9cbiAgQXJyYXkucHJvdG90eXBlLiRtZXRob2QoXCJzdW1cIiwgZnVuY3Rpb24oKSB7XG4gICAgdmFyIHN1bSA9IDA7XG4gICAgZm9yICh2YXIgaT0wLGxlbj10aGlzLmxlbmd0aDsgaTxsZW47ICsraSkge1xuICAgICAgc3VtICs9IHRoaXNbaV07XG4gICAgfVxuICAgIHJldHVybiBzdW07XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGF2ZXJhZ2VcbiAgICog6KaB57Sg44Gu5bmz5Z2H5YCk44KS6L+U44GX44G+44GZ44CCXG4gICAqXG4gICAqIOimgee0oOOBq+aVsOWApOS7peWkluOBjOWQq+OBvuOCjOOCi+WgtOWQiOOBruaMmeWLleOBr+S4jeWumuOBp+OBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgYXJyID0gWzEsIDIsIDMsIDQsIDUsIDZdXG4gICAqICAgICBhcnIuYXZlcmFnZSgpOyAvLyA9PiAzLjVcbiAgICpcbiAgICogQHJldHVybiB7TnVtYmVyfSDlubPlnYflgKRcbiAgICovXG4gIEFycmF5LnByb3RvdHlwZS4kbWV0aG9kKFwiYXZlcmFnZVwiLCBmdW5jdGlvbigpIHtcbiAgICB2YXIgc3VtID0gMDtcbiAgICB2YXIgbGVuID0gdGhpcy5sZW5ndGg7XG4gICAgZm9yICh2YXIgaT0wOyBpPGxlbjsgKytpKSB7XG4gICAgICBzdW0gKz0gdGhpc1tpXTtcbiAgICB9XG4gICAgcmV0dXJuIHN1bS9sZW47XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGVhY2hcbiAgICogQGNoYWluYWJsZVxuICAgKiDopoHntKDjgpLpoIbnlarjgavmuKHjgZfjgarjgYzjgonplqLmlbDjgpLnubDjgorov5TjgZflrp/ooYzjgZfjgb7jgZnjgIJcbiAgICpcbiAgICog44Oh44K944OD44OJ44OB44Kn44O844Oz44Gr5a++5b+c44GX44Gm44GE44G+44GZ44GM44CB44GT44Gu44Oh44K944OD44OJ44Gr44KI44Gj44Gm6Ieq5YiG6Ieq6Lqr44Gv5aSJ5YyW44GX44G+44Gb44KT44CCXG4gICAqXG4gICAqICMjI1JlZmVyZW5jZVxuICAgKiAtIFtBcnJheS5wcm90b3R5cGUuZm9yRWFjaCgpIC0gSmF2YVNjcmlwdCB8IE1ETl0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvamEvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvQXJyYXkvZm9yRWFjaClcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIGFyciA9IFsxLCAyLCAzXTtcbiAgICogICAgIGFyci5lYWNoKCBmdW5jdGlvbihlbG0pIHtcbiAgICogICAgICAgY29uc29sZS5sb2coZWxtICogZWxtKVxuICAgKiAgICAgfSk7XG4gICAqICAgICAvLyA9PiAxXG4gICAqICAgICAvLyAgICA0XG4gICAqICAgICAvLyAgICA5XG4gICAqXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIOWQhOimgee0oOOBq+WvvuOBl+OBpuWun+ihjOOBmeOCi+OCs+ODvOODq+ODkOODg+OCr+mWouaVsFxuICAgKiBAcGFyYW0ge09iamVjdH0gW3NlbGY9dGhpc10gY2FsbGJhY2sg5YaF44GnIHRoaXMg44Go44GX44Gm5Y+C54Wn44GV44KM44KL5YCkXG4gICAqL1xuICBBcnJheS5wcm90b3R5cGUuJG1ldGhvZChcImVhY2hcIiwgZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5mb3JFYWNoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0pO1xuXG4gIFxuICAvKipcbiAgICogQG1ldGhvZCB0b1VMRWxlbWVudFxuICAgKiBVTEVsZW1lbnQg44Gr5aSJ5o+b44GX44G+44GZ77yI5pyq5a6f6KOF77yJXG4gICAqL1xuICBBcnJheS5wcm90b3R5cGUuJG1ldGhvZChcInRvVUxFbGVtZW50XCIsIGZ1bmN0aW9uKCl7XG4gICAgICAvLyBUT0RPOiBcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgdG9PTEVsZW1lbnRcbiAgICogT0xFbGVtZW50IOOBq+WkieaPm+OBl+OBvuOBme+8iOacquWun+ijhe+8iVxuICAgKi9cbiAgQXJyYXkucHJvdG90eXBlLiRtZXRob2QoXCJ0b09MRWxlbWVudFwiLCBmdW5jdGlvbigpe1xuICAgICAgLy8gVE9ETzpcbiAgfSk7XG5cbiAgXG4gIC8qKlxuICAgKiBAbWV0aG9kIHJhbmdlXG4gICAqIEBzdGF0aWNcbiAgICog44Kk44Oz44K544K/44Oz44K544Oh44K944OD44OJ44GuIHtAbGluayAjcmFuZ2V9IOOBqOWQjOOBmOOBp+OBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgQXJyYXkucmFuZ2UoMiwgMTQsIDUpOyAvLyA9PiBbMiwgNywgMTJdXG4gICAqL1xuICBBcnJheS4kbWV0aG9kKFwicmFuZ2VcIiwgZnVuY3Rpb24oc3RhcnQsIGVuZCwgc3RlcCkge1xuICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUucmFuZ2UuYXBwbHkoW10sIGFyZ3VtZW50cyk7XG4gIH0pO1xuXG5cbiAgLyoqXG4gICAqIEBtZXRob2Qgb2ZcbiAgICogQHN0YXRpY1xuICAgKiBFUzYg5rqW5oug44GuIG9mIOmWouaVsOOBp+OBmeOAguWPr+WkiemVt+W8leaVsOOCkuOBqOOBo+OBpiBBcnJheSDjgqrjg5bjgrjjgqfjgq/jg4jjgavjgZfjgabov5TjgZfjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIEFycmF5Lm9mKCk7ICAgICAgICAvLyA9PiBbXVxuICAgKiAgICAgQXJyYXkub2YoMSwgMiwgMyk7IC8vID0+IFsxLCAyLCAzXVxuICAgKlxuICAgKiBAcGFyYW0ge09iamVjdH0gZWxlbWVudE4g55Sf5oiQ44GZ44KL6YWN5YiX44Gu6KaB57SgXG4gICAqIEByZXR1cm4ge0FycmF5fSDnlJ/miJDjgZfjgZ/phY3liJdcbiAgICovXG4gIEFycmF5LiRtZXRob2QoXCJvZlwiLCBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgZnJvbVxuICAgKiBAc3RhdGljXG4gICAqIEVTNiDmupbmi6Djga4gZnJvbSDplqLmlbDjgafjgZnjgIJhcnJheS1saWtlIOOCquODluOCuOOCp+OCr+ODiOOBi2l0ZXJhYmxlIOOCquODluOCuOOCp+OCr+ODiOOBi+OCieaWsOOBl+OBhOmFjeWIl+OCkueUn+aIkOOBl+OBvuOBmeOAglxuICAgKlxuICAgKiBhcnJheS1saWtlIOOCquODluOCuOOCp+OCr+ODiOOBqOOBr+OAgWxlbmd0aCDjg5fjg63jg5Hjg4bjgqPjgpLmjIHjgaHjgIHmlbDlrZfjga7mt7vlrZfjgafjgqLjgq/jgrvjgrnlj6/og73jgarjgqrjg5bjgrjjgqfjgq/jg4jjga7jgZPjgajjgafjgZnjgIJcbiAgICog6YCa5bi444Gu6YWN5YiX44Gu44G744GL44CBU3RyaW5n44CBYXJndW1lbnRz44CBTm9kZUxpc3Qg44Gq44Gp44KCIGFycmF5LWxpa2Ug44Kq44OW44K444Kn44Kv44OI44Gn44GZ44CCXG4gICAqXG4gICAqIGl0ZXJhYmxlIOOCquODluOCuOOCp+OCr+ODiOOBqOOBr+OAgVN5bWJvbC5pdGVyYXRvciDjg5fjg63jg5Hjg4bjgqPjgpLmjIHjgaTjgqrjg5bjgrjjgqfjgq/jg4jjga7jgZPjgajjgafjgZnjgIJcbiAgICog6YCa5bi444Gu6YWN5YiX44Gu44G744GL44CBU3RyaW5n44CBYXJndW1lbnRz44CBTm9kZUxpc3Qg44Gq44Gp44KCIGl0ZXJhYmxlIOOCquODluOCuOOCp+OCr+ODiOOBp+OBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgQXJyYXkuZnJvbShbMSwgMiwgM10sIGZ1bmN0aW9uKGVsbSl7IHJldHVybiBlbG0gKiBlbG19ICk7IC8vID0+IFsxLCA0LCA5XVxuICAgKiAgICAgQXJyYXkuZnJvbShcImZvb1wiKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gPT4gW1wiZlwiLCBcIm9cIiwgXCJvXCJdXG4gICAqICAgICBBcnJheS5mcm9tKCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwic3BhblwiKSkgICAgICAgICAgICAvLyA9PiBbRWxlbWVudCwgRWxlbWVudCwgRWxlbWVudCwuLi5dXG4gICAqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBhcnJheUxpa2Ug6YWN5YiX44Gr5aSJ5o+b44GZ44KLIGFycmF5LWxpa2Ug44Kq44OW44K444Kn44Kv44OIXG4gICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYWxsYmFja10gYXJyYXlMaWtlIOOBruOBmeOBueOBpuOBruimgee0oOOBq+WvvuOBl+OBpuWun+ihjOOBmeOCi+ODnuODg+ODl+mWouaVsFxuICAgKiBAcGFyYW0ge09iamVjdH0gW2NvbnRleHRdIGNhbGxiYWNrIOWGheOBpyB0aGlzIOOBqOOBl+OBpuWPgueFp+OBleOCjOOCi+WApFxuICAgKiBAcmV0dXJuIHtBcnJheX0g55Sf5oiQ44GX44Gf6YWN5YiXXG4gICAqL1xuICBBcnJheS4kbWV0aG9kKFwiZnJvbVwiLCBmdW5jdGlvbihhcnJheUxpa2UsIGNhbGxiYWNrLCBjb250ZXh0KSB7XG4gICAgaWYgKCFPYmplY3QoYXJyYXlMaWtlKS5sZW5ndGgpIHJldHVybiBbXTtcblxuICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICBpZiAoU3ltYm9sICYmIFN5bWJvbC5pdGVyYXRvciAmJiBhcnJheUxpa2VbU3ltYm9sLml0ZXJhdG9yXSkge1xuICAgICAgICB2YXIgaXRlcmF0b3IgPSBhcnJheUxpa2VbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgdmFyIGl0ZXJhdG9yUmVzdWx0ID0gaXRlcmF0b3IubmV4dCgpO1xuICAgICAgICAgICAgaWYgKGl0ZXJhdG9yUmVzdWx0LmRvbmUpIGJyZWFrO1xuXG4gICAgICAgICAgICB2YXIgdmFsdWUgPSB0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicgPyBjYWxsYmFjay5iaW5kKGNvbnRleHQgfHwgdGhpcykoaXRlcmF0b3JSZXN1bHQudmFsdWUpIDogaXRlcmF0b3JSZXN1bHQudmFsdWU7XG4gICAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gYXJyYXlMaWtlLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIHJlc3VsdC5wdXNoKGFycmF5TGlrZVtpXSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQubWFwKHR5cGVvZiBjYWxsYmFjayA9PSAnZnVuY3Rpb24nID8gY2FsbGJhY2sgOiBmdW5jdGlvbihpdGVtKSB7XG4gICAgICByZXR1cm4gaXRlbTtcbiAgICB9LCBjb250ZXh0KTtcbiAgfSk7XG4gIFxuICAvKipcbiAgICogQG1ldGhvZCBtb3N0XG4gICAqIOaMh+WumuOBl+OBn+mWouaVsOOBrui/lOOCiuWApOOBjOacgOWwj+OBqOOBquOCi+imgee0oOOBqOacgOWkp+OBqOOBquOCi+imgee0oOOCkuOBvuOBqOOCgeOBpui/lOOBl+OBvuOBmeOAglxuICAgKlxuICAgKiDnqbrjga7phY3liJfjgavlr77jgZfjgablrp/ooYzjgZnjgovjgagge21heDogSW5maW5pdHksIG1pbjogLUluZmluaXR5fSDjgpLov5TjgZfjgb7jgZnjgIJcbiAgICpcbiAgICogIyMjIEV4YW1wbGVcbiAgICogICAgIFs1LDEsNCwxLDksMiwtMTBdLm1vc3QoKTsgLy8gPT4ge21heDo5LCBtaW46IC0xMH1cbiAgICpcbiAgICogICAgIHBvaW50cyA9IFsge3g6MCwgeTowfSwge3g6NjQwLCB5Ojk2MH0sIHt4Oi04MCwgeToxMDB9IF07XG4gICAqICAgICBwb2ludHMubW9zdChmdW5jdGlvbihlKXtyZXR1cm4gZS54O30pLm1pbjsgLy8gPT4gW3g6LTgwLCB5OjEwMF1cbiAgICogICAgIHBvaW50cy5tb3N0KGZ1bmN0aW9uKGUpe3JldHVybiBlLnk7fSkubWF4OyAvLyA9PiBbeDo2NDAsIHk6OTYwXVxuICAgKlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY2FsbGJhY2tdIOWQhOimgee0oOOBq+WvvuOBl+OBpuWun+ihjOOBmeOCi+OCs+ODvOODq+ODkOODg+OCr+mWouaVsFxuICAgKiBAcGFyYW0ge09iamVjdH0gW3NlbGY9dGhpc10g6Zai5pWw5YaF44GnIHRoaXMg44Go44GX44Gm5Y+C54Wn44GV44KM44KL5YCk44CC44OH44OV44Kp44Or44OI44Gv6Ieq5YiG6Ieq6Lqr44CCXG4gICAqIEByZXR1cm4ge09iamVjdH0gbWF4IOOBqCBtaW4g44KS44Kt44O844Gr5oyB44Gk44Kq44OW44K444Kn44Kv44OIXG4gICAqIEByZXR1cm4ge09iamVjdH0gcmV0dXJuLm1pbiDplqLmlbDjga7ov5TjgorlgKTjgYzmnIDlsI/jgajjgarjgovopoHntKBcbiAgICogQHJldHVybiB7T2JqZWN0fSByZXR1cm4ubWF4IOmWouaVsOOBrui/lOOCiuWApOOBjOacgOWkp+OBqOOBquOCi+imgee0oFxuICAgKi9cbiAgQXJyYXkucHJvdG90eXBlLiRtZXRob2QoXCJtb3N0XCIsIGZ1bmN0aW9uKGZ1bmMsIHNlbGYpIHtcbiAgICBpZih0aGlzLmxlbmd0aCA8IDEpe1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWF4OiAtSW5maW5pdHksXG4gICAgICAgIG1pbjogSW5maW5pdHksXG4gICAgICB9O1xuICAgIH1cbiAgICBpZihmdW5jKXtcbiAgICAgIHZhciBtYXhWYWx1ZSA9IC1JbmZpbml0eTtcbiAgICAgIHZhciBtaW5WYWx1ZSA9IEluZmluaXR5O1xuICAgICAgdmFyIG1heEluZGV4ID0gMDtcbiAgICAgIHZhciBtaW5JbmRleCA9IDA7XG4gICAgICBcbiAgICAgIGlmKHR5cGVvZiBzZWxmID09PSAndW5kZWZpbmVkJyl7c2VsZiA9IHRoaXM7fVxuICAgICAgXG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuICAgICAgICB2YXIgdiA9IGZ1bmMuY2FsbChzZWxmLCB0aGlzW2ldLCBpLCB0aGlzKTtcbiAgICAgICAgaWYobWF4VmFsdWUgPCB2KXtcbiAgICAgICAgICBtYXhWYWx1ZSA9IHY7XG4gICAgICAgICAgbWF4SW5kZXggPSBpO1xuICAgICAgICB9XG4gICAgICAgIGlmKG1pblZhbHVlID4gdil7XG4gICAgICAgICAgbWluVmFsdWUgPSB2O1xuICAgICAgICAgIG1pbkluZGV4ID0gaTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWF4OiB0aGlzW21heEluZGV4XSxcbiAgICAgICAgbWluOiB0aGlzW21pbkluZGV4XSxcbiAgICAgIH07XG4gICAgfVxuICAgIGVsc2V7XG4gICAgICB2YXIgbWF4ID0gLUluZmluaXR5O1xuICAgICAgdmFyIG1pbiA9IEluZmluaXR5O1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMubGVuZ3RoO2kgPCBsZW47ICsraSkge1xuICAgICAgICBpZihtYXg8dGhpc1tpXSl7bWF4PXRoaXNbaV07fVxuICAgICAgICBpZihtaW4+dGhpc1tpXSl7bWluPXRoaXNbaV07fVxuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWF4OiBtYXgsXG4gICAgICAgIG1pbjogbWluLFxuICAgICAgfTtcbiAgICB9XG4gICAgXG4gIH0pOyAgXG5cbn0pKCk7XG5cbi8qXG4gKiBkYXRlLmpzXG4gKi9cblxuKGZ1bmN0aW9uKCkge1xuICBcbiAgLyoqXG4gICAqIEBjbGFzcyBnbG9iYWwuRGF0ZVxuICAgKiAjIOaLoeW8teOBl+OBnyBEYXRlIOOCr+ODqeOCuVxuICAgKiDml6Xku5jjgpLmibHjgYYgRGF0ZSDjgq/jg6njgrnjgpLmi6HlvLXjgZfjgabjgYTjgb7jgZnjgIJcbiAgICovXG4gIFxuICB2YXIgTU9OVEggPSBbXG4gICAgJ0phbnVhcnknLCAnRmVicnVhcnknLCAnTWFyY2gnLCAnQXByaWwnLCAnTWF5JywgJ0p1bmUnLCAnSnVseScsICdBdWd1c3QnLCAnU2VwdGVtYmVyJywgJ09jdG9iZXInLCAnTm92ZW1iZXInLCAnRGVjZW1iZXInXG4gIF07XG4gIFxuICB2YXIgV0VFSyA9IFtcbiAgICAnU3VuZGF5JywgJ01vbmRheScsICdUdWVzZGF5JywgJ1dlZG5lc2RheScsICdUaHVyc2RheScsICdGcmlkYXknLCAnU2F0dXJkYXknXG4gIF07XG4gIFxuICAvKipcbiAgICogQG1ldGhvZCBmb3JtYXRcbiAgICog5oyH5a6a44GX44Gf44OV44Kp44O844Oe44OD44OI44Gr5b6T44Gj44Gm5pel5LuY44KS5paH5a2X5YiX5YyW44GX44G+44GZ44CCXG4gICAqXG4gICAqIDx0YWJsZSBib3JkZXI9XCIxXCI+XG4gICAqICAgPHRyPjx0ZD7lpInmj5vmjIflrprmloflrZfliJc8L3RkPjx0ZD7mhI/lkbM8L3RkPjwvdHI+XG4gICAqICAgPHRyPjx0ZD55eXl5PC90ZD48dGQ+6KW/5pqm5bm077yINOahge+8iTwvdGQ+PC90cj5cbiAgICogICA8dHI+PHRkPnl5PC90ZD48dGQ+6KW/5pqm5bm077yIMuahge+8iTwvdGQ+PC90cj5cbiAgICogICA8dHI+PHRkPnk8L3RkPjx0ZD7opb/mmqblubQ8L3RkPjwvdHI+XG4gICAqICAgPHRyPjx0ZD5NTU1NPC90ZD48dGQ+5pyI77yI6Iux6Kqe5ZCN77yJPC90ZD48L3RyPlxuICAgKiAgIDx0cj48dGQ+TU1NPC90ZD48dGQ+5pyI77yI6Iux6Kqe55yB55Wl5ZCN77yJPC90ZD48L3RyPlxuICAgKiAgIDx0cj48dGQ+TU08L3RkPjx0ZD7mnIjvvIgy5qGB5pWw5a2X77yJPC90ZD48L3RyPlxuICAgKiAgIDx0cj48dGQ+TTwvdGQ+PHRkPuaciDwvdGQ+PC90cj5cbiAgICogICA8dHI+PHRkPmRkPC90ZD48dGQ+5pel77yIMuahge+8iTwvdGQ+PC90cj5cbiAgICogICA8dHI+PHRkPmQ8L3RkPjx0ZD7ml6U8L3RkPjwvdHI+XG4gICAqICAgPHRyPjx0ZD5FRUVFPC90ZD48dGQ+5puc5pel77yI6Iux6Kqe5ZCN77yJPC90ZD48L3RyPlxuICAgKiAgIDx0cj48dGQ+RUVFPC90ZD48dGQ+5puc5pel77yI6Iux6Kqe55yB55Wl5ZCN77yJPC90ZD48L3RyPlxuICAgKiAgIDx0cj48dGQ+SEg8L3RkPjx0ZD7mmYLvvIgyNOaZgumWk+ihqOiomOODuzLmoYHvvIk8L3RkPjwvdHI+XG4gICAqICAgPHRyPjx0ZD5IPC90ZD48dGQ+5pmC77yIMjTmmYLplpPooajoqJjvvIk8L3RkPjwvdHI+XG4gICAqICAgPHRyPjx0ZD5tbTwvdGQ+PHRkPuWIhu+8iDLmoYHvvIk8L3RkPjwvdHI+XG4gICAqICAgPHRyPjx0ZD5tPC90ZD48dGQ+5YiGPC90ZD48L3RyPlxuICAgKiAgIDx0cj48dGQ+c3M8L3RkPjx0ZD7np5LvvIgy5qGB77yJPC90ZD48L3RyPlxuICAgKiAgIDx0cj48dGQ+czwvdGQ+PHRkPuenkjwvdGQ+PC90cj5cbiAgICogPC90YWJsZT5cbiAgICog5qGB5pWw44GM5oyH5a6a44GV44KM44Gm44GE44KL44KC44Gu44GvMOODkeODh+OCo+ODs+OCsOOBleOCjOOBvuOBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgKG5ldyBEYXRlKCkpLmZvcm1hdChcInl5eXktTU0tZGQoRUVFKVwiKTsgLy8gPT4gXCIyMDE2LTA0LTA1KFR1ZSlcIiDjgarjgalcbiAgICpcbiAgICogQHBhcmFtIHtTdHJpbmd9IHBhdHRlcm4g44OV44Kp44O844Oe44OD44OI5paH5a2X5YiXXG4gICAqIEByZXR1cm4ge1N0cmluZ30g44OV44Kp44O844Oe44OD44OI5paH5a2X5YiX44Gr5b6T44Gj44Gm55Sf5oiQ44GV44KM44Gf5paH5a2X5YiXXG4gICAqL1xuICBEYXRlLnByb3RvdHlwZS4kbWV0aG9kKCdmb3JtYXQnLCBmdW5jdGlvbihwYXR0ZXJuKSB7XG4gICAgdmFyIHllYXIgICAgPSB0aGlzLmdldEZ1bGxZZWFyKCk7XG4gICAgdmFyIG1vbnRoICAgPSB0aGlzLmdldE1vbnRoKCk7XG4gICAgdmFyIGRhdGUgICAgPSB0aGlzLmdldERhdGUoKTtcbiAgICB2YXIgZGF5ICAgICA9IHRoaXMuZ2V0RGF5KCk7XG4gICAgdmFyIGhvdXJzICAgPSB0aGlzLmdldEhvdXJzKCk7XG4gICAgdmFyIG1pbnV0ZXMgPSB0aGlzLmdldE1pbnV0ZXMoKTtcbiAgICB2YXIgc2Vjb25kcyA9IHRoaXMuZ2V0U2Vjb25kcygpO1xuICAgIHZhciBtaWxsc2Vjb25kcyA9IHRoaXMuZ2V0TWlsbGlzZWNvbmRzKCk7XG4gICAgXG4gICAgdmFyIHBhdHRlcm5zID0ge1xuICAgICAgJ3l5eXknOiBTdHJpbmcoeWVhcikucGFkZGluZyg0LCAnMCcpLFxuICAgICAgJ3l5JzogeWVhci50b1N0cmluZygpLnN1YnN0cigyLCAyKSxcbiAgICAgICd5JzogeWVhcixcblxuICAgICAgJ01NTU0nOiBNT05USFttb250aF0sXG4gICAgICAnTU1NJzogTU9OVEhbbW9udGhdLnN1YnN0cigwLCAzKSxcbiAgICAgICdNTSc6IFN0cmluZyhtb250aCsxKS5wYWRkaW5nKDIsICcwJyksXG4gICAgICAnTSc6IChtb250aCsxKSxcblxuICAgICAgJ2RkJzogU3RyaW5nKGRhdGUpLnBhZGRpbmcoMiwgJzAnKSxcbiAgICAgICdkJzogZGF0ZSxcblxuICAgICAgJ0VFRUUnOiBXRUVLW2RheV0sXG4gICAgICAnRUVFJzogV0VFS1tkYXldLnN1YnN0cigwLCAzKSxcblxuICAgICAgJ0hIJzogU3RyaW5nKGhvdXJzKS5wYWRkaW5nKDIsICcwJyksXG4gICAgICAnSCc6IGhvdXJzLFxuXG4gICAgICAnbW0nOiBTdHJpbmcobWludXRlcykucGFkZGluZygyLCAnMCcpLFxuICAgICAgJ20nOiBtaW51dGVzLFxuXG4gICAgICAnc3MnOiBTdHJpbmcoc2Vjb25kcykucGFkZGluZygyLCAnMCcpLFxuICAgICAgJ3MnOiBzZWNvbmRzLFxuICAgICAgXG4gICAgICAvLyAvLyBkYXRlXG4gICAgICAvLyAnZCc6IFN0cmluZygnMDAnICsgZGF0ZSkuc2xpY2UoLTIpLFxuICAgICAgLy8gJ0QnOiBXRUVLW2RheV0uc3Vic3RyKDAsIDMpLFxuICAgICAgLy8gJ2onOiBkYXRlLFxuICAgICAgLy8gJ2wnOiBXRUVLW2RheV0sXG4gICAgICBcbiAgICAgIC8vIC8vIG1vbnRoXG4gICAgICAvLyAnbSc6IFN0cmluZygnMDAnICsgKG1vbnRoKzEpKS5zbGljZSgtMiksXG4gICAgICAvLyAnTSc6IE1PTlRIW21vbnRoXS5zdWJzdHIoMCwgMyksXG4gICAgICAvLyAnbic6IChtb250aCsxKSxcbiAgICAgIC8vICdGJzogTU9OVEhbbW9udGhdLFxuICAgICAgXG4gICAgICAvLyAvLyB5ZWFyXG4gICAgICAvLyAneSc6IHllYXIudG9TdHJpbmcoKS5zdWJzdHIoMiwgMiksXG4gICAgICAvLyAnWSc6IHllYXIsXG4gICAgICBcbiAgICAgIC8vIC8vIHRpbWVcbiAgICAgIC8vICdHJzogaG91cnMsXG4gICAgICAvLyAnSCc6IFN0cmluZygnMDAnICsgaG91cnMpLnNsaWNlKC0yKSxcbiAgICAgIC8vICdpJzogU3RyaW5nKCcwMCcgKyBtaW51dGVzKS5zbGljZSgtMiksXG4gICAgICAvLyAncyc6IFN0cmluZygnMDAnICsgc2Vjb25kcykuc2xpY2UoLTIpLFxuICAgICAgLy8gJ1MnOiBTdHJpbmcoJzAwMCcgKyBtaWxsc2Vjb25kcykuc2xpY2UoLTMpLFxuICAgIH07XG5cbiAgICB2YXIgcmVnc3RyID0gJygnICsgT2JqZWN0LmtleXMocGF0dGVybnMpLmpvaW4oJ3wnKSArICcpJztcbiAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKHJlZ3N0ciwgJ2cnKTtcblxuICAgIHJldHVybiBwYXR0ZXJuLnJlcGxhY2UocmUsIGZ1bmN0aW9uKHN0cikge1xuICAgICAgcmV0dXJuIHBhdHRlcm5zW3N0cl07XG4gICAgfSk7XG4gIH0pO1xuXG5cbiAgLyoqXG4gICAqIEBtZXRob2QgY2FsY3VsYXRlQWdlXG4gICAqIEBzdGF0aWNcbiAgICog5oyH5a6a44GX44Gf6KqV55Sf5pel44GL44KJ44CB54++5Zyo44G+44Gf44Gv5oyH5a6a44GX44Gf5pel5LuY44Gr44GK44GR44KL5bm06b2i44KS6KiI566X44GX44G+44GZ44CCXG4gICAqXG4gICAqICMjI1JlZmVyZW5jZVxuICAgKiAtIFtKYXZhc2NyaXB044Gn6KqV55Sf5pel44GL44KJ54++5Zyo44Gu5bm06b2i44KS566X5Ye6XShodHRwOi8vcWlpdGEuY29tL24wYmlzdWtlL2l0ZW1zL2RkNTM3YmQ0Y2JlOWFiNTAxY2U4KVxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgRGF0ZS5jYWxjdWxhdGVBZ2UoXCIxOTkwLTAxLTE3XCIpOyAvLyA9PiAyNiDjgarjgalcbiAgICpcbiAgICogQHBhcmFtIHtTdHJpbmcvRGF0ZX0gYmlydGhkYXkg6KqV55Sf5pelXG4gICAqIEBwYXJhbSB7U3RyaW5nL0RhdGV9IFt3aGVuPeacrOaXpV0g5Z+65rqW44Gu5pel5LuYXG4gICAqIEByZXR1cm4ge051bWJlcn0g5bm06b2iXG4gICAqL1xuICBEYXRlLiRtZXRob2QoJ2NhbGN1bGF0ZUFnZScsIGZ1bmN0aW9uKGJpcnRoZGF5LCB3aGVuKSB7XG4gICAgLy8gYmlydGhkYXlcbiAgICBpZiAodHlwZW9mIGJpcnRoZGF5ID09PSAnc3RyaW5nJykge1xuICAgICAgYmlydGhkYXkgPSBuZXcgRGF0ZShiaXJ0aGRheSk7XG4gICAgfVxuICAgIC8vIHdoZW5cbiAgICBpZiAoIXdoZW4pIHtcbiAgICAgIHdoZW4gPSBuZXcgRGF0ZSgpO1xuICAgIH1cbiAgICBlbHNlIGlmICh0eXBlb2Ygd2hlbiA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHdoZW4gPSBuZXcgRGF0ZSh3aGVuKTtcbiAgICB9XG5cbiAgICB2YXIgYm4gPSBuZXcgRGF0ZShiaXJ0aGRheS5nZXRUaW1lKCkpLnNldEZ1bGxZZWFyKDI1Nik7XG4gICAgdmFyIHduID0gbmV3IERhdGUod2hlbi5nZXRUaW1lKCkpLnNldEZ1bGxZZWFyKDI1Nik7XG4gICAgdmFyIHN0ZXAgPSAod24gPCBibikgPyAxIDogMDtcblxuICAgIHJldHVybiAod2hlbi5nZXRGdWxsWWVhcigpIC0gYmlydGhkYXkuZ2V0RnVsbFllYXIoKSkgLSBzdGVwO1xuICB9KTtcbiAgXG59KSgpO1xuXG4vKlxuICogbWF0aC5qc1xuICovXG5cbjsoZnVuY3Rpb24oKSB7XG4gICAgXG4gIC8qKlxuICAgKiBAY2xhc3MgZ2xvYmFsLk1hdGhcbiAgICogIyDmi6HlvLXjgZfjgZ8gTWF0aCDjgq/jg6njgrlcbiAgICog5pWw5a2m55qE44Gq5Yem55CG44KS5omx44GGIE1hdGgg44Kv44Op44K544KS5ouh5by144GX44Gm44GE44G+44GZ44CCXG4gICAqL1xuXG4gIFxuICAvKipcbiAgICogQHByb3BlcnR5IERFR19UT19SQURcbiAgICog5bqm44KS44Op44K444Ki44Oz44Gr5aSJ5o+b44GZ44KL44Gf44KB44Gu5a6a5pWw44Gn44GZ44CCXG4gICAqL1xuICBNYXRoLkRFR19UT19SQUQgPSBNYXRoLlBJLzE4MDtcbiAgXG4gIC8qKlxuICAgKiBAcHJvcGVydHkgUkFEX1RPX0RFR1xuICAgKiDjg6njgrjjgqLjg7PjgpLluqbjgavlpInmj5vjgZnjgovjgZ/jgoHjga7lrprmlbDjgafjgZnjgIJcbiAgICovXG4gIE1hdGguUkFEX1RPX0RFRyA9IDE4MC9NYXRoLlBJO1xuICBcbiAgLyoqXG4gICAqIEBwcm9wZXJ0eSBQSElcbiAgICog6buE6YeR5q+U44Gn44GZ44CCXG4gICAqL1xuICBNYXRoLlBISSA9ICgxICsgTWF0aC5zcXJ0KDUpKSAvIDI7XG4gIFxuICAvKipcbiAgICogQHN0YXRpY1xuICAgKiBAbWV0aG9kIGRlZ1RvUmFkXG4gICAqIOW6puOCkuODqeOCuOOCouODs+OBq+WkieaPm+OBl+OBvuOBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgTWF0aC5kZWdUb1JhZCgxODApOyAvLyA9PiAzLjE0MTU5MjY1MzU4OTc5M1xuICAgKlxuICAgKiBAcGFyYW0ge051bWJlcn0gZGVnIOW6plxuICAgKiBAcmV0dXJuIHtOdW1iZXJ9IOODqeOCuOOCouODs1xuICAgKi9cbiAgTWF0aC5kZWdUb1JhZCA9IGZ1bmN0aW9uKGRlZykge1xuICAgIHJldHVybiBkZWcgKiBNYXRoLkRFR19UT19SQUQ7XG4gIH07XG4gIFxuICAvKipcbiAgICogQHN0YXRpY1xuICAgKiBAbWV0aG9kIHJhZFRvRGVnXG4gICAqIOODqeOCuOOCouODs+OCkuW6puOBq+WkieaPm+OBl+OBvuOBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgTWF0aC5yYWRUb0RlZyhNYXRoLlBJLzQpOyAvLyA9PiA0NVxuICAgKlxuICAgKiBAcGFyYW0ge051bWJlcn0gcmFkIOODqeOCuOOCouODs1xuICAgKiBAcmV0dXJuIHtOdW1iZXJ9IOW6plxuICAgKi9cbiAgTWF0aC5yYWRUb0RlZyA9IGZ1bmN0aW9uKHJhZCkge1xuICAgIHJldHVybiByYWQgKiBNYXRoLlJBRF9UT19ERUc7XG4gIH07XG4gIFxuXG4gIFxuICAvKipcbiAgICogQHN0YXRpY1xuICAgKiBAbWV0aG9kIGNsYW1wXG4gICAqIOaMh+WumuOBl+OBn+WApOOCkuaMh+WumuOBl+OBn+evhOWbsuOBq+WPjuOCgeOBn+e1kOaenOOCkui/lOOBl+OBvuOBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgTWF0aC5jbGFtcCgxMjAsIDAsIDY0MCk7IC8vID0+IDEyMFxuICAgKiAgICAgTWF0aC5jbGFtcCg5ODAsIDAsIDY0MCk7IC8vID0+IDY0MFxuICAgKiAgICAgTWF0aC5jbGFtcCgtODAsIDAsIDY0MCk7IC8vID0+IDBcbiAgICpcbiAgICogQHBhcmFtIHtOdW1iZXJ9IHZhbHVlIOWApFxuICAgKiBAcGFyYW0ge051bWJlcn0gbWluICDnr4Tlm7Ljga7kuIvpmZBcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG1heCAg56+E5Zuy44Gu5LiK6ZmQXG4gICAqIEByZXR1cm4ge051bWJlcn0g5Li444KB44Gf57WQ5p6c44Gu5YCkXG4gICAqL1xuICBNYXRoLiRtZXRob2QoXCJjbGFtcFwiLCBmdW5jdGlvbih2YWx1ZSwgbWluLCBtYXgpIHtcbiAgICByZXR1cm4gKHZhbHVlIDwgbWluKSA/IG1pbiA6ICggKHZhbHVlID4gbWF4KSA/IG1heCA6IHZhbHVlICk7XG4gIH0pO1xuICBcbiAgLyoqXG4gICAqIEBzdGF0aWNcbiAgICogQG1ldGhvZCBpbnNpZGVcbiAgICog5oyH5a6a44GX44Gf5YCk44GM5oyH5a6a44GX44Gf5YCk44Gu56+E5Zuy44Gr44GC44KL44GL44Gp44GG44GL44KS6L+U44GX44G+44GZ44CCXG4gICAqXG4gICAqICMjIyBFeGFtcGxlXG4gICAqICAgICBNYXRoLmluc2lkZSg5ODAsIDAsIDY0MCk7IC8vID0+IGZhbHNlXG4gICAqICAgICBNYXRoLmluc2lkZSgxMjAsIDAsIDY0MCk7IC8vID0+IHRydWVcbiAgICpcbiAgICogQHBhcmFtIHtOdW1iZXJ9IHZhbHVlIOODgeOCp+ODg+OCr+OBmeOCi+WApFxuICAgKiBAcGFyYW0ge051bWJlcn0gbWluICDnr4Tlm7Ljga7kuIvpmZBcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG1heCAg56+E5Zuy44Gu5LiK6ZmQXG4gICAqIEByZXR1cm4ge0Jvb2xlYW59IOevhOWbsuWGheOBq+WApOOBjOOBguOCi+OBi+OBquOBhOOBi1xuICAgKi9cbiAgTWF0aC4kbWV0aG9kKFwiaW5zaWRlXCIsIGZ1bmN0aW9uKHZhbHVlLCBtaW4sIG1heCkge1xuICAgIHJldHVybiAodmFsdWUgPj0gbWluKSAmJiAodmFsdWUpIDw9IG1heDtcbiAgfSk7XG4gIFxuICAvKipcbiAgICogQHN0YXRpY1xuICAgKiBAbWV0aG9kIHJhbmRpbnRcbiAgICog5oyH5a6a44GV44KM44Gf56+E5Zuy5YaF44Gn44Op44Oz44OA44Og44Gq5pW05pWw5YCk44KS55Sf5oiQ44GX44G+44GZ44CCXG4gICAqXG4gICAqICMjIyBFeGFtcGxlXG4gICAqICAgICBNYXRoLnJhbmRpbnQoLTQsIDQpOyAvLyA9PiAtNOOAgTDjgIEz44CBNCDjgarjgalcbiAgICpcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG1pbiAg56+E5Zuy44Gu5pyA5bCP5YCkXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBtYXggIOevhOWbsuOBruacgOWkp+WApFxuICAgKiBAcmV0dXJuIHtOdW1iZXJ9IOODqeODs+ODgOODoOOBquaVtOaVsOWApFxuICAgKi9cbiAgTWF0aC4kbWV0aG9kKFwicmFuZGludFwiLCBmdW5jdGlvbihtaW4sIG1heCkge1xuICAgIHJldHVybiBNYXRoLmZsb29yKCBNYXRoLnJhbmRvbSgpKihtYXgtbWluKzEpICkgKyBtaW47XG4gIH0pO1xuICBcbiAgLyoqXG4gICAqIEBzdGF0aWNcbiAgICogQG1ldGhvZCByYW5kZmxvYXRcbiAgICog5oyH5a6a44GV44KM44Gf56+E5Zuy5YaF44Gn44Op44Oz44OA44Og44Gq5pWw5YCk44KS55Sf5oiQ44GX44G+44GZ44CCXG4gICAqXG4gICAqICMjIyBFeGFtcGxlXG4gICAqICAgICBNYXRoLnJhbmRmbG9hdCgtNCwgNCk7IC8vID0+IC0yLjc0ODkxOTM4MjQwMDA5Mzcg44Gq44GpXG4gICAqXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBtaW4gIOevhOWbsuOBruacgOWwj+WApFxuICAgKiBAcGFyYW0ge051bWJlcn0gbWF4ICDnr4Tlm7Ljga7mnIDlpKflgKRcbiAgICogQHJldHVybiB7TnVtYmVyfSDjg6njg7Pjg4Djg6DjgarmlbDlgKRcbiAgICovXG4gIE1hdGguJG1ldGhvZChcInJhbmRmbG9hdFwiLCBmdW5jdGlvbihtaW4sIG1heCkge1xuICAgIHJldHVybiBNYXRoLnJhbmRvbSgpKihtYXgtbWluKSttaW47XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAc3RhdGljXG4gICAqIEBtZXRob2QgcmFuZGJvb2xcbiAgICog44Op44Oz44OA44Og44Gr55yf5YG95YCk44KS55Sf5oiQ44GX44G+44GZ44CCXG4gICAqIOW8leaVsOOBp+eZvuWIhueOh+OCkuaMh+WumuOBmeOCi+S6i+OCguOBp+OBjeOBvuOBmeOAglxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKiAgICAgTWF0aC5yYW5kYm9vbCgpOyAgIC8vID0+IHRydWUg44G+44Gf44GvIGZhbHNlXG4gICAqICAgICBNYXRoLnJhbmRib29sKDgwKTsgLy8gPT4gODAlIOOBrueiuueOh+OBpyB0cnVlXG4gICAqXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBwZXJjZW50ICDnnJ/jgavjgarjgovnmb7liIbnjodcbiAgICogQHJldHVybiB7Qm9vbGVhbn0g44Op44Oz44OA44Og44Gq55yf5YG95YCkXG4gICAqL1xuICBNYXRoLiRtZXRob2QoXCJyYW5kYm9vbFwiLCBmdW5jdGlvbihwZXJlY2VudCkge1xuICAgIHJldHVybiBNYXRoLnJhbmRpbnQoMCwgMTAwKSA8IChwZXJlY2VudCB8fCA1MCk7XG4gIH0pO1xuICAgIFxufSkoKTtcbi8qXG4gKlxuICovXG5cblxuXG4vKlxuICogcGhpbmEuanMgbmFtZXNwYWNlXG4gKi9cbnZhciBwaGluYSA9IHBoaW5hIHx8IHt9O1xuXG47KGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmFcbiAgICogcGhpbmEuanMgbmFtZXNwYWNlXG4gICAqL1xuXG4gIC8qKlxuICAgKiDjg5Djg7zjgrjjg6fjg7NcbiAgICovXG4gIHBoaW5hLlZFUlNJT04gPSAnMC4yLjMnO1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGlzTm9kZVxuICAgKiBAbWVtYmVyIHBoaW5hXG4gICAqIEBzdGF0aWNcbiAgICovXG4gIHBoaW5hLiRtZXRob2QoJ2lzTm9kZScsIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpO1xuICB9KTtcblxuICAvKipcbiAgICogQG1ldGhvZCBuYW1lc3BhY2VcbiAgICogQG1lbWJlciBwaGluYVxuICAgKiBAc3RhdGljXG4gICAqL1xuICBwaGluYS4kbWV0aG9kKCduYW1lc3BhY2UnLCBmdW5jdGlvbihmbikge1xuICAgIGZuLmNhbGwodGhpcyk7XG4gIH0pO1xuXG4gIHZhciBucyA9IHBoaW5hLmlzTm9kZSgpID8gZ2xvYmFsIDogd2luZG93O1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGdsb2JhbFxuICAgKiBnbG9iYWxcbiAgICovXG4gIHBoaW5hLmFjY2Vzc29yKCdnbG9iYWwnLCB7XG4gICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBucztcbiAgICB9LFxuICB9KTtcblxuICBcbiAgLyoqXG4gICAqIEBtZXRob2QgdGVzdFVBXG4gICAqIFVB44KS5q2j6KaP6KGo54++44OG44K544OIXG4gICAqIEBtZW1iZXIgcGhpbmFcbiAgICogQHN0YXRpY1xuICAgKi9cbiAgcGhpbmEuJG1ldGhvZCgndGVzdFVBJywgZnVuY3Rpb24ocmVnRXhwKSB7XG4gICAgaWYgKCFwaGluYS5nbG9iYWwubmF2aWdhdG9yKSByZXR1cm4gZmFsc2U7XG4gICAgdmFyIHVhID0gcGhpbmEuZ2xvYmFsLm5hdmlnYXRvci51c2VyQWdlbnQ7XG4gICAgcmV0dXJuIHJlZ0V4cC50ZXN0KHVhKTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEBtZXRob2QgaXNBbmRyb2lkXG4gICAqIEFuZHJvaWQg44GL44Gp44GG44GL44KS44OB44Kn44OD44KvXG4gICAqIEBtZW1iZXIgcGhpbmFcbiAgICogQHN0YXRpY1xuICAgKi9cbiAgcGhpbmEuJG1ldGhvZCgnaXNBbmRyb2lkJywgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHBoaW5hLnRlc3RVQSgvQW5kcm9pZC8pO1xuICB9KTtcbiAgXG4gIC8qKlxuICAgKiBAbWV0aG9kIGlzSVBob25lXG4gICAqIGlQaG9uZSDjgYvjganjgYbjgYvjgpLjg4Hjgqfjg4Pjgq9cbiAgICogQG1lbWJlciBwaGluYVxuICAgKiBAc3RhdGljXG4gICAqL1xuICBwaGluYS4kbWV0aG9kKCdpc0lQaG9uZScsIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBwaGluYS50ZXN0VUEoL2lQaG9uZS8pO1xuICB9KTtcbiAgXG4gIC8qKlxuICAgKiBAbWV0aG9kIGlzSVBhZFxuICAgKiBpUGFkIOOBi+OBqeOBhuOBi+OCkuODgeOCp+ODg+OCr1xuICAgKiBAbWVtYmVyIHBoaW5hXG4gICAqIEBzdGF0aWNcbiAgICovXG4gIHBoaW5hLiRtZXRob2QoJ2lzSVBhZCcsIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBwaGluYS50ZXN0VUEoL2lQYWQvKTtcbiAgfSk7XG4gIFxuICAvKipcbiAgICogQG1ldGhvZCBpc0lPU1xuICAgKiBpT1Mg44GL44Gp44GG44GL44KS44OB44Kn44OD44KvXG4gICAqIEBtZW1iZXIgcGhpbmFcbiAgICogQHN0YXRpY1xuICAgKi9cbiAgcGhpbmEuJG1ldGhvZCgnaXNJT1MnLCBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gcGhpbmEudGVzdFVBKC9pUGhvbmV8aVBhZC8pO1xuICB9KTtcblxuICAvKipcbiAgICogQG1ldGhvZCBpc01vYmlsZVxuICAgKiBtb2JpbGUg44GL44Gp44GG44GL44KS44OB44Kn44OD44KvXG4gICAqIEBtZW1iZXIgcGhpbmFcbiAgICogQHN0YXRpY1xuICAgKi9cbiAgcGhpbmEuJG1ldGhvZCgnaXNNb2JpbGUnLCBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gcGhpbmEudGVzdFVBKC9pUGhvbmV8aVBhZHxBbmRyb2lkLyk7XG4gIH0pO1xuICBcbiAgXG5cblxuICAvLyBzdXBwb3J0IG5vZGUuanNcbiAgaWYgKHBoaW5hLmlzTm9kZSgpKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBwaGluYTtcbiAgfVxuXG4gIG5zLnBoaW5hID0gcGhpbmE7XG5cbn0pKHRoaXMpO1xuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQG1lbWJlciBwaGluYVxuICAgKiBAc3RhdGljXG4gICAqIEBtZXRob2QgY3JlYXRlQ2xhc3NcbiAgICog44Kv44Op44K544KS55Sf5oiQXG4gICAqL1xuICBwaGluYS4kbWV0aG9kKCdjcmVhdGVDbGFzcycsIGZ1bmN0aW9uKHBhcmFtcykge1xuICAgIHZhciBwcm9wcyA9IHt9O1xuXG4gICAgdmFyIF9jbGFzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGluc3RhbmNlID0gbmV3IF9jbGFzcy5wcm90b3R5cGUuX2NyZWF0b3IoKTtcbiAgICAgIF9jbGFzcy5wcm90b3R5cGUuaW5pdC5hcHBseShpbnN0YW5jZSwgYXJndW1lbnRzKTtcbiAgICAgIHJldHVybiBpbnN0YW5jZTtcbiAgICB9O1xuXG4gICAgaWYgKHBhcmFtcy5zdXBlckNsYXNzKSB7XG4gICAgICBfY2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShwYXJhbXMuc3VwZXJDbGFzcy5wcm90b3R5cGUpO1xuICAgICAgcGFyYW1zLmluaXQub3duZXIgPSBfY2xhc3M7XG4gICAgICBfY2xhc3MucHJvdG90eXBlLnN1cGVySW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLl9fY291bnRlciA9IHRoaXMuX19jb3VudGVyIHx8IDA7XG5cbiAgICAgICAgdmFyIHN1cGVyQ2xhc3MgPSB0aGlzLl9oaWVyYXJjaGllc1t0aGlzLl9fY291bnRlcisrXTtcbiAgICAgICAgdmFyIHN1cGVySW5pdCA9IHN1cGVyQ2xhc3MucHJvdG90eXBlLmluaXQ7XG4gICAgICAgIHN1cGVySW5pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuXG4gICAgICAgIHRoaXMuX19jb3VudGVyID0gMDtcbiAgICAgIH07XG4gICAgICBfY2xhc3MucHJvdG90eXBlLnN1cGVyTWV0aG9kID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTtcbiAgICAgICAgdmFyIG5hbWUgPSBhcmdzLnNoaWZ0KCk7XG4gICAgICAgIHRoaXMuX19jb3VudGVycyA9IHRoaXMuX19jb3VudGVycyB8fCB7fTtcbiAgICAgICAgdGhpcy5fX2NvdW50ZXJzW25hbWVdID0gdGhpcy5fX2NvdW50ZXJzW25hbWVdIHx8IDA7XG5cbiAgICAgICAgdmFyIHN1cGVyQ2xhc3MgPSB0aGlzLl9oaWVyYXJjaGllc1sgdGhpcy5fX2NvdW50ZXJzW25hbWVdKysgXTtcbiAgICAgICAgdmFyIHN1cGVyTWV0aG9kID0gc3VwZXJDbGFzcy5wcm90b3R5cGVbbmFtZV07XG4gICAgICAgIHZhciByc3QgPSBzdXBlck1ldGhvZC5hcHBseSh0aGlzLCBhcmdzKTtcblxuICAgICAgICB0aGlzLl9fY291bnRlcnNbbmFtZV0gPSAwO1xuXG4gICAgICAgIHJldHVybiByc3Q7XG4gICAgICB9O1xuICAgICAgX2NsYXNzLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IF9jbGFzcztcbiAgICB9XG5cblxuICAgIC8vIC8vIFxuICAgIC8vIHBhcmFtcy5mb3JJbihmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgLy8gICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgLy8gICAgIF9jbGFzcy4kbWV0aG9kKGtleSwgdmFsdWUpO1xuICAgIC8vICAgfVxuICAgIC8vICAgZWxzZSB7XG4gICAgLy8gICAgIF9jbGFzcy5wcm90b3R5cGVba2V5XSA9IHZhbHVlO1xuICAgIC8vICAgfVxuICAgIC8vIH0pO1xuICAgIC8vIOe2meaJv1xuICAgIF9jbGFzcy5wcm90b3R5cGUuJGV4dGVuZChwYXJhbXMpO1xuXG4gICAgLy8g57aZ5om/55SoXG4gICAgX2NsYXNzLnByb3RvdHlwZS5faGllcmFyY2hpZXMgPSBbXTtcbiAgICB2YXIgX3N1cGVyID0gX2NsYXNzLnByb3RvdHlwZS5zdXBlckNsYXNzO1xuICAgIHdoaWxlKF9zdXBlcikge1xuICAgICAgX2NsYXNzLnByb3RvdHlwZS5faGllcmFyY2hpZXMucHVzaChfc3VwZXIpO1xuICAgICAgX3N1cGVyID0gX3N1cGVyLnByb3RvdHlwZS5zdXBlckNsYXNzO1xuICAgIH1cblxuICAgIC8vIGFjY2Vzc29yXG4gICAgaWYgKHBhcmFtcy5fYWNjZXNzb3IpIHtcbiAgICAgIHBhcmFtcy5fYWNjZXNzb3IuZm9ySW4oZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuICAgICAgICBfY2xhc3MucHJvdG90eXBlLmFjY2Vzc29yKGtleSwgdmFsdWUpO1xuICAgICAgfSk7XG4gICAgICAvLyBfY2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShfY2xhc3MucHJvdG90eXBlLCBwYXJhbXMuX2FjY2Vzc29yKTtcbiAgICB9XG5cbiAgICBfY2xhc3MucHJvdG90eXBlLl9jcmVhdG9yID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzOyB9O1xuICAgIF9jbGFzcy5wcm90b3R5cGUuX2NyZWF0b3IucHJvdG90eXBlID0gX2NsYXNzLnByb3RvdHlwZTtcblxuICAgIC8vIHN0YXRpYyBwcm9wZXJ0eS9tZXRob2RcbiAgICBpZiAocGFyYW1zLl9zdGF0aWMpIHtcbiAgICAgIF9jbGFzcy4kZXh0ZW5kKHBhcmFtcy5fc3RhdGljKTtcbiAgICB9XG5cbiAgICBpZiAocGFyYW1zLl9kZWZpbmVkKSB7XG4gICAgICBwYXJhbXMuX2RlZmluZWQuY2FsbChfY2xhc3MsIF9jbGFzcyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIF9jbGFzcztcbiAgfSk7XG5cbiAgdmFyIGNoYWNoZWRDbGFzc2VzID0ge307XG4gIFxuICAvKipcbiAgICogQG1ldGhvZCB1c2luZ1xuICAgKiBAbWVtYmVyIHBoaW5hXG4gICAqIEBzdGF0aWNcbiAgICovXG4gIHBoaW5hLiRtZXRob2QoJ3VzaW5nJywgZnVuY3Rpb24ocGF0aCkge1xuICAgIGlmICghcGF0aCkge1xuICAgICAgcmV0dXJuIHBoaW5hLmdsb2JhbDtcbiAgICB9XG4gICAgXG4gICAgdmFyIHBhdGhlcyA9IHBhdGguc3BsaXQoL1ssLlxcLyBdfDo6Lyk7XG4gICAgdmFyIGN1cnJlbnQgPSBwaGluYS5nbG9iYWw7XG5cbiAgICBwYXRoZXMuZm9yRWFjaChmdW5jdGlvbihwKSB7XG4gICAgICBjdXJyZW50ID0gY3VycmVudFtwXSB8fCAoY3VycmVudFtwXT17fSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gY3VycmVudDtcbiAgfSk7XG4gIFxuICAvKipcbiAgICogQG1ldGhvZCByZWdpc3RlclxuICAgKiBcbiAgICogQG1lbWJlciBwaGluYVxuICAgKiBAc3RhdGljXG4gICAqL1xuICBwaGluYS4kbWV0aG9kKCdyZWdpc3RlcicsIGZ1bmN0aW9uKHBhdGgsIF9jbGFzcykge1xuICAgIHZhciBwYXRoZXMgPSBwYXRoLnNwbGl0KC9bLC5cXC8gXXw6Oi8pO1xuICAgIHZhciBjbGFzc05hbWUgPSBwYXRoZXMubGFzdDtcbiAgICB2YXIgcGFyZW50UGF0aCA9IHBhdGguc3Vic3RyaW5nKDAsIHBhdGgubGFzdEluZGV4T2YoJy4nKSk7XG4gICAgdmFyIHBhcmVudCA9IHBoaW5hLnVzaW5nKHBhcmVudFBhdGgpO1xuXG4gICAgcGFyZW50W2NsYXNzTmFtZV0gPSBfY2xhc3M7XG5cbiAgICByZXR1cm4gX2NsYXNzO1xuICB9KTtcbiAgXG4gIHZhciBfY2xhc3NEZWZpbmVkQ2FsbGJhY2sgPSB7fTtcblxuICAvKipcbiAgICogQG1lbWJlciBwaGluYVxuICAgKiBAc3RhdGljXG4gICAqIEBtZXRob2QgZGVmaW5lXG4gICAqIOOCr+ODqeOCueOCkuWumue+qVxuICAgKi9cbiAgcGhpbmEuJG1ldGhvZCgnZGVmaW5lJywgZnVuY3Rpb24ocGF0aCwgcGFyYW1zKSB7XG4gICAgaWYgKHBhcmFtcy5zdXBlckNsYXNzKSB7XG4gICAgICBpZiAodHlwZW9mIHBhcmFtcy5zdXBlckNsYXNzID09PSAnc3RyaW5nJykge1xuICAgICAgICB2YXIgX3N1cGVyQ2xhc3MgPSBwaGluYS51c2luZyhwYXJhbXMuc3VwZXJDbGFzcyk7XG4gICAgICAgIGlmICh0eXBlb2YgX3N1cGVyQ2xhc3MgIT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIGlmICghX2NsYXNzRGVmaW5lZENhbGxiYWNrW3BhcmFtcy5zdXBlckNsYXNzXSkge1xuICAgICAgICAgICAgX2NsYXNzRGVmaW5lZENhbGxiYWNrW3BhcmFtcy5zdXBlckNsYXNzXSA9IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBfY2xhc3NEZWZpbmVkQ2FsbGJhY2tbcGFyYW1zLnN1cGVyQ2xhc3NdLnB1c2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBwaGluYS5kZWZpbmUocGF0aCwgcGFyYW1zKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIHJldHVybiA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgcGFyYW1zLnN1cGVyQ2xhc3MgPSBfc3VwZXJDbGFzcztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHBhcmFtcy5zdXBlckNsYXNzID0gcGFyYW1zLnN1cGVyQ2xhc3M7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIF9jbGFzcyA9IHBoaW5hLmNyZWF0ZUNsYXNzKHBhcmFtcyk7XG4gICAgX2NsYXNzLnByb3RvdHlwZS5hY2Nlc3NvcignY2xhc3NOYW1lJywge1xuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHBhdGg7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgcGhpbmEucmVnaXN0ZXIocGF0aCwgX2NsYXNzKTtcbiAgICBcbiAgICBpZiAoX2NsYXNzRGVmaW5lZENhbGxiYWNrW3BhdGhdKSB7XG4gICAgICBfY2xhc3NEZWZpbmVkQ2FsbGJhY2tbcGF0aF0uZm9yRWFjaChmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgfSk7XG4gICAgICBfY2xhc3NEZWZpbmVkQ2FsbGJhY2tbcGF0aF0gPSBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiBfY2xhc3M7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGdsb2JhbGl6ZVxuICAgKiBAbWVtYmVyIHBoaW5hXG4gICAqIEBzdGF0aWNcbiAgICovXG4gIHBoaW5hLiRtZXRob2QoJ2dsb2JhbGl6ZScsIGZ1bmN0aW9uKCkge1xuICAgIHBoaW5hLmZvckluKGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbiAgICAgIHZhciBucyA9IGtleTtcblxuICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ29iamVjdCcpIHJldHVybiA7XG5cbiAgICAgIHZhbHVlLmZvckluKGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbiAgICAgICAgLy8gaWYgKHBoaW5hLmdsb2JhbFtrZXldKSB7XG4gICAgICAgIC8vICAgY29uc29sZS5sb2cobnMsIGtleSk7XG4gICAgICAgIC8vICAgcGhpbmEuZ2xvYmFsWydfJyArIGtleV0gPSB2YWx1ZTtcbiAgICAgICAgLy8gfVxuICAgICAgICAvLyBlbHNlIHtcbiAgICAgICAgLy8gICBwaGluYS5nbG9iYWxba2V5XSA9IHZhbHVlO1xuICAgICAgICAvLyB9XG4gICAgICAgIHBoaW5hLmdsb2JhbFtrZXldID0gdmFsdWU7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgcGhpbmEuX21haW5MaXN0ZW5lcnMgPSBbXTtcbiAgcGhpbmEuX21haW5Mb2FkZWQgPSBmYWxzZTtcbiAgcGhpbmEuJG1ldGhvZCgnbWFpbicsIGZ1bmN0aW9uKGZ1bmMpIHtcbiAgICBpZiAocGhpbmEuX21haW5Mb2FkZWQpIHtcbiAgICAgIGZ1bmMoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBwaGluYS5fbWFpbkxpc3RlbmVycy5wdXNoKGZ1bmMpO1xuICAgIH1cbiAgfSk7XG5cbiAgdmFyIGRvYyA9IHBoaW5hLmdsb2JhbC5kb2N1bWVudDtcbiAgaWYgKHBoaW5hLmdsb2JhbC5hZGRFdmVudExpc3RlbmVyICYmIGRvYyAmJiBkb2MucmVhZHlTdGF0ZSAhPT0gJ2NvbXBsZXRlJykge1xuICAgIHBoaW5hLmdsb2JhbC5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcnVuID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBsaXN0ZW5lcnMgPSBwaGluYS5fbWFpbkxpc3RlbmVycy5jbG9uZSgpO1xuICAgICAgICBwaGluYS5fbWFpbkxpc3RlbmVycy5jbGVhcigpO1xuICAgICAgICBsaXN0ZW5lcnMuZWFjaChmdW5jdGlvbihmdW5jKSB7XG4gICAgICAgICAgZnVuYygpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBtYWluIOWGheOBpyBtYWluIOOCkui/veWKoOOBl+OBpuOBhOOCi+WgtOWQiOOBjOOBguOCi+OBruOBp+OBneOBruODgeOCp+ODg+OCr1xuICAgICAgICBpZiAocGhpbmEuX21haW5MaXN0ZW5lcnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHJ1bigwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBwaGluYS5fbWFpbkxvYWRlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICAvLyDjgaHjgofjgaPjgajpgYXlu7bjgZXjgZvjgoso55S76Z2i44K144Kk44K65ZWP6aGMKVxuICAgICAgc2V0VGltZW91dChydW4pO1xuICAgIH0pO1xuICB9XG4gIGVsc2Uge1xuICAgIHBoaW5hLl9tYWluTG9hZGVkID0gdHJ1ZTtcbiAgfVxuXG5cblxufSk7XG5cblxuXG5cblxuXG5cblxuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5nZW9tLlZlY3RvcjJcbiAgICogIyAy5qyh5YWD44OZ44Kv44OI44Or44Kv44Op44K5XG4gICAqIDLmrKHlhYPjga7jg5njgq/jg4jjg6vjgoTluqfmqJnjgpLooajjgZnjgq/jg6njgrnjgafjgZnjgIJcbiAgICovXG4gIHBoaW5hLmRlZmluZSgncGhpbmEuZ2VvbS5WZWN0b3IyJywge1xuXG4gICAgLyoqIHjluqfmqJkgKi9cbiAgICB4OiAwLFxuICAgIC8qKiB55bqn5qiZICovXG4gICAgeTogMCxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgaW5pdFxuICAgICAqIDLmrKHlhYPjg5njgq/jg4jjg6vjga7jgrPjg7Pjgrnjg4jjg6njgq/jgr/jgafjgZnjgIJcbiAgICAgKlxuICAgICAqICMjIyBFeGFtcGxlXG4gICAgICogICAgIHYgPSBwaGluYS5nZW9tLlZlY3RvcjIoMywgNCk7XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge051bWJlcn0geCDjg5njgq/jg4jjg6vjga4geCDluqfmqJlcbiAgICAgKiBAcGFyYW0ge051bWJlcn0geSDjg5njgq/jg4jjg6vjga4geSDluqfmqJlcbiAgICAgKiBAcmV0dXJuIHtwaGluYS5nZW9tLlZlY3RvcjJ9IDLmrKHlhYPjg5njgq/jg4jjg6vjgqrjg5bjgrjjgqfjgq/jg4hcbiAgICAgKi9cbiAgICBpbml0OiBmdW5jdGlvbih4LCB5KSB7XG4gICAgICB0aGlzLnggPSB4O1xuICAgICAgdGhpcy55ID0geTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBjbG9uZVxuICAgICAqIHRoaXMg44Gu44Kz44OU44O844KS55Sf5oiQ44GX44Gm6L+U44GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAqICAgICB2ID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDMsIDQpO1xuICAgICAqICAgICB2MiA9IHYuY2xvbmUoKTtcbiAgICAgKiAgICAgdjIueCA9PSB2Lng7IC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIEByZXR1cm4ge09iamVjdH0g55Sf5oiQ44GX44Gf44OZ44Kv44OI44OrXG4gICAgICovXG4gICAgY2xvbmU6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHBoaW5hLmdlb20uVmVjdG9yMih0aGlzLngsIHRoaXMueSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZXF1YWxzXG4gICAgICogdGhpcyDjga7lkITopoHntKDjgYzjgZnjgbnjgaYgb3RoZXIg44Go562J44GX44GE44GL44Gp44GG44GL44KS6L+U44GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAqICAgICB2MSA9IHBoaW5hLmdlb20uVmVjdG9yMigzLCA0KTtcbiAgICAgKiAgICAgdjIgPSBwaGluYS5nZW9tLlZlY3RvcjIoNSwgNik7XG4gICAgICogICAgIHYxLmVxdWFscyh2Mik7IC8vID0+IGZhbHNlXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gb3RoZXIg5q+U6LyD44GZ44KL5a++6LGh44Gu44OZ44Kv44OI44OrXG4gICAgICogQHJldHVybiB7Qm9vbGVhbn0g562J44GX44GE44GL44Gp44GG44GLXG4gICAgICovXG4gICAgZXF1YWxzOiBmdW5jdGlvbih2KSB7XG4gICAgICByZXR1cm4gKHRoaXMueCA9PT0gdi54ICYmIHRoaXMueSA9PT0gdi55KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBzZXRcbiAgICAgKiBAY2hhaW5hYmxlXG4gICAgICogdGhpcyDjga7lkITopoHntKDjga7lgKTjgpLlho3oqK3lrprjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqICMjIyBFeGFtcGxlXG4gICAgICogICAgIHYgPSBwaGluYS5nZW9tLlZlY3RvcjIoMywgNCk7XG4gICAgICogICAgIHYuc2V0KDUsIDYpO1xuICAgICAqXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHgg44OZ44Kv44OI44Or44GuIHgg5bqn5qiZXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHkg44OZ44Kv44OI44Or44GuIHkg5bqn5qiZXG4gICAgICogQHJldHVybiB7cGhpbmEuZ2VvbS5WZWN0b3IyfSDlho3oqK3lrprlvozjga7jg5njgq/jg4jjg6tcbiAgICAgKi9cbiAgICBzZXQ6IGZ1bmN0aW9uKHgsIHkpIHtcbiAgICAgIHRoaXMueCA9IHg7XG4gICAgICB0aGlzLnkgPSB5O1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgYWRkXG4gICAgICogQGNoYWluYWJsZVxuICAgICAqIHRoaXMg44GrIG90aGVyIOOCkuWKoOOBiOOBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgdjEgPSBwaGluYS5nZW9tLlZlY3RvcjIoMywgNCk7XG4gICAgICogICAgIHYyID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDUsIDYpO1xuICAgICAqICAgICB2MS5hZGQodjIpOyAvLyA9PiBwaGluYS5nZW9tLlZlY3Rvcig4LCAxMClcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7cGhpbmEuZ2VvbS5WZWN0b3IyfSBvdGhlciDjg5njgq/jg4jjg6tcbiAgICAgKiBAcmV0dXJuIHtwaGluYS5nZW9tLlZlY3RvcjJ9IOWKoOeul+OBl+OBn+e1kOaenOOBruODmeOCr+ODiOODq1xuICAgICAqL1xuICAgIGFkZDogZnVuY3Rpb24odikge1xuICAgICAgdGhpcy54ICs9IHYueDtcbiAgICAgIHRoaXMueSArPSB2Lnk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBzdWJcbiAgICAgKiBAY2hhaW5hYmxlXG4gICAgICogdGhpcyDjgYvjgokgb3RoZXIg44KS5rib44GY44G+44GZ44CCXG4gICAgICpcbiAgICAgKiDjg5njgq/jg4jjg6vjgYzluqfmqJnjgpLooajjgZnloLTlkIjjga/jgIHmjIflrprjgZfjgZ/luqfmqJnjgYvjgonoh6rliIboh6rouqvjgbjjgajlkJHjgYvjgYbjg5njgq/jg4jjg6vjgYzlvpfjgonjgozjgb7jgZnjgIJcbiAgICAgKiBcbiAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAqICAgICB2MSA9IHBoaW5hLmdlb20uVmVjdG9yMigzLCA0KTtcbiAgICAgKiAgICAgdjIgPSBwaGluYS5nZW9tLlZlY3RvcjIoMSwgNSk7XG4gICAgICogICAgIHYxLnN1Yih2Mik7IC8vID0+IHBoaW5hLmdlb20uVmVjdG9yKDIsIC0xKVxuICAgICAqXG4gICAgICogQHBhcmFtIHtwaGluYS5nZW9tLlZlY3RvcjJ9IG90aGVyIOODmeOCr+ODiOODq1xuICAgICAqIEByZXR1cm4ge3BoaW5hLmdlb20uVmVjdG9yMn0g5rib566X44GX44Gf57WQ5p6c44Gu44OZ44Kv44OI44OrXG4gICAgICovXG4gICAgc3ViOiBmdW5jdGlvbih2KSB7XG4gICAgICB0aGlzLnggLT0gdi54O1xuICAgICAgdGhpcy55IC09IHYueTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIG11bFxuICAgICAqIEBjaGFpbmFibGVcbiAgICAgKiB0aGlzIOOBruWQhOimgee0oOOBq+aVsOWApCBuIOOCkuS5l+OBmOOBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgdjEgPSBwaGluYS5nZW9tLlZlY3RvcjIoMywgNCk7XG4gICAgICogICAgIHYxLm11bCgzKSAvLyA9PiBwaGluYS5nZW9tLlZlY3Rvcig5LCAxMilcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBuIOS5l+OBmOOCi+WApFxuICAgICAqIEByZXR1cm4ge3BoaW5hLmdlb20uVmVjdG9yMn0g5LmX566X44GX44Gf57WQ5p6c44Gu44OZ44Kv44OI44OrXG4gICAgICovXG4gICAgbXVsOiBmdW5jdGlvbihuKSB7XG4gICAgICB0aGlzLnggKj0gbjtcbiAgICAgIHRoaXMueSAqPSBuO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZGl2XG4gICAgICogQGNoYWluYWJsZVxuICAgICAqIHRoaXMg44Gu5ZCE6KaB57Sg44KS5pWw5YCkIG4g44Gn5Ymy44KK44G+44GZ44CCXG4gICAgICpcbiAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAqICAgICB2MSA9IHBoaW5hLmdlb20uVmVjdG9yMig4LCAxNik7XG4gICAgICogICAgIHYxLmRpdigyKSAvLyA9PiBwaGluYS5nZW9tLlZlY3Rvcig0LCA4KVxuICAgICAqXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IG4g5Ymy44KL5YCkXG4gICAgICogQHJldHVybiB7cGhpbmEuZ2VvbS5WZWN0b3IyfSDpmaTnrpfjgZfjgZ/ntZDmnpzjga7jg5njgq/jg4jjg6tcbiAgICAgKi9cbiAgICBkaXY6IGZ1bmN0aW9uKG4pIHtcbiAgICAgIC8vY29uc29sZS5hc3NlcnQobiAhPSAwLCBcIjAgZGl2aXNpb24hIVwiKTtcbiAgICAgIG4gPSBuIHx8IDAuMDE7XG4gICAgICB0aGlzLnggLz0gbjtcbiAgICAgIHRoaXMueSAvPSBuO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgbmVnYXRlXG4gICAgICogQGNoYWluYWJsZVxuICAgICAqIHRoaXMg44Gu5ZCE6KaB57Sg44Gu5q2j6LKg44KS5Y+N6Lui44GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiB0aGlzIOOBqOWQjOOBmOWkp+OBjeOBleOBp+aWueWQkeOBjOmAhuOBruODmeOCr+ODiOODq+OBjOW+l+OCieOCjOOBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgdjEgPSBwaGluYS5nZW9tLlZlY3RvcjIoMywgLTQpO1xuICAgICAqICAgICB2MS5uZWdhdGUoKSAvLyA9PiBwaGluYS5nZW9tLlZlY3RvcigtMywgNClcbiAgICAgKlxuICAgICAqIEByZXR1cm4ge3BoaW5hLmdlb20uVmVjdG9yMn0g5Y+N6Lui5b6M44Gu44OZ44Kv44OI44OrXG4gICAgICovXG4gICAgbmVnYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMueCA9IC10aGlzLng7XG4gICAgICB0aGlzLnkgPSAtdGhpcy55O1xuICAgICAgXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBkb3RcbiAgICAgKiBvdGhlciDjgajjga7lhoXnqY3jgpLov5TjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqIOaKleW9seODmeOCr+ODiOODq+OCkuaxguOCgeOBn+OCiuOAgemhnuS8vOW6puOBruioiOeul+OBq+WIqeeUqOOBmeOCi+OBk+OBqOOBjOOBp+OBjeOBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgdjEgPSBwaGluYS5nZW9tLlZlY3RvcjIoMywgNCk7XG4gICAgICogICAgIHYyID0gcGhpbmEuZ2VvbS5WZWN0b3IyKC0yLCAyKTtcbiAgICAgKiAgICAgdjEuZG90KHYyKSAvLyA9PiAyXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gb3RoZXIg44OZ44Kv44OI44OrXG4gICAgICogQHJldHVybiB7TnVtYmVyfSDlhoXnqY1cbiAgICAgKi9cbiAgICBkb3Q6IGZ1bmN0aW9uKHYpIHtcbiAgICAgIHJldHVybiB0aGlzLnggKiB2LnggKyB0aGlzLnkgKiB2Lnk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgY3Jvc3NcbiAgICAgKiBvdGhlciDjgajjga7lpJbnqY3vvIjjgq/jg63jgrnnqY3vvInjgpLov5TjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqIDLmrKHlhYPjg5njgq/jg4jjg6vjgafjga7lpJbnqY3jga/jg5njgq/jg4jjg6vjgafjgarjgY/mlbDlgKTjgpLov5TjgZnjgZPjgajjgavms6jmhI/jgZfjgabjgY/jgaDjgZXjgYTjgIJcbiAgICAgKiBvdGhlciDjgojjgoogdGhpcyDmmYLoqIjlm57jgorjgavjgYLjgovjgajjgY3jga/mraPjga7lgKTjgavjgarjgorjgIHlj43mmYLoqIjlm57jgorjgavjgYLjgovjgajjgY3jga/osqDjga7lgKTjgavjgarjgorjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqICMjIyBFeGFtcGxlXG4gICAgICogICAgIHYxID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDMsIDQpO1xuICAgICAqICAgICB2MiA9IHBoaW5hLmdlb20uVmVjdG9yMigzLCAxKTtcbiAgICAgKiAgICAgdjEuY3Jvc3ModjIpIC8vID0+IC04XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gb3RoZXIg44OZ44Kv44OI44OrXG4gICAgICogQHJldHVybiB7TnVtYmVyfSDlpJbnqY1cbiAgICAgKi9cbiAgICBjcm9zczogZnVuY3Rpb24odikge1xuICAgICAgcmV0dXJuICh0aGlzLngqdi55KSAtICh0aGlzLnkqdi54KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBsZW5ndGhcbiAgICAgKiB0aGlzIOOBruWkp+OBjeOBleOCkui/lOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogKG1lbW8pIG1hZ25pdHVkZSDjgaPjgablkI3liY3jga7mlrnjgYzoia/jgYTjgYvjgoIuIOaknOiojuS4rS5cbiAgICAgKlxuICAgICAqICMjIyBFeGFtcGxlXG4gICAgICogICAgIHYxID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDMsIDQpO1xuICAgICAqICAgICB2MS5sZW5ndGgoKTsgLy8gPT4gNVxuICAgICAqXG4gICAgICogQHJldHVybiB7TnVtYmVyfSDjg5njgq/jg4jjg6vjga7lpKfjgY3jgZVcbiAgICAgKi9cbiAgICBsZW5ndGg6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIE1hdGguc3FydCh0aGlzLngqdGhpcy54ICsgdGhpcy55KnRoaXMueSk7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGxlbmd0aFNxdWFyZWRcbiAgICAgKiB0aGlzIOOBruWkp+OBjeOBleOBruiHquS5l+OCkui/lOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogQyMg44Gu5ZCN5YmN44KS5byV55So77yIb3IgbGVuZ3RoU3F1YXJlIG9yIGxlbmd0aFNxcnTvvIlcbiAgICAgKlxuICAgICAqICMjIyBFeGFtcGxlXG4gICAgICogICAgIHYxID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDMsIDQpO1xuICAgICAqICAgICB2MS5sZW5ndGhTcXVhcmVkKCk7IC8vID0+IDI1XG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9IOODmeOCr+ODiOODq+OBruWkp+OBjeOBleOBruiHquS5l1xuICAgICAqL1xuICAgIGxlbmd0aFNxdWFyZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMueCp0aGlzLnggKyB0aGlzLnkqdGhpcy55O1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBkaXN0YW5jZVxuICAgICAqIHRoaXMg44GoIG90aGVyIOOCkuW6p+aomeOBqOOBv+OBquOBl+OBn+OBqOOBjeOBrjLngrnplpPjga7ot53pm6LjgpLov5TjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqICMjIyBFeGFtcGxlXG4gICAgICogICAgIHYxID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDEsIDIpO1xuICAgICAqICAgICB2MiA9IHBoaW5hLmdlb20uVmVjdG9yMig0LCA2KTtcbiAgICAgKiAgICAgdjEuZGlzdGFuY2UodjIpOyAvLyA9PiA1XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gb3RoZXIg5bqn5qiZ44KS6KGo44GZ44OZ44Kv44OI44OrXG4gICAgICogQHJldHVybiB7TnVtYmVyfSAy54K56ZaT44Gu6Led6ZuiXG4gICAgICovXG4gICAgZGlzdGFuY2U6IGZ1bmN0aW9uKHYpIHtcbiAgICAgIHJldHVybiBNYXRoLnNxcnQoIE1hdGgucG93KHRoaXMueC12LngsIDIpICsgTWF0aC5wb3codGhpcy55LXYueSwgMikgKTtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZGlzdGFuY2VTcXVhcmVkXG4gICAgICogdGhpcyDjgaggb3RoZXIg44KS5bqn5qiZ44Go44G/44Gq44GX44Gf44Go44GN44GuMueCuemWk+OBrui3nembouOBruiHquS5l+OCkui/lOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgdjEgPSBwaGluYS5nZW9tLlZlY3RvcjIoMSwgMik7XG4gICAgICogICAgIHYyID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDQsIDYpO1xuICAgICAqICAgICB2MS5kaXN0YW5jZVNxdWFyZWQodjIpOyAvLyA9PiAyNVxuICAgICAqXG4gICAgICogQHBhcmFtIHtwaGluYS5nZW9tLlZlY3RvcjJ9IG90aGVyIOW6p+aomeOCkuihqOOBmeODmeOCr+ODiOODq1xuICAgICAqIEByZXR1cm4ge051bWJlcn0gMueCuemWk+OBrui3nembouOBruiHquS5l1xuICAgICAqL1xuICAgIGRpc3RhbmNlU3F1YXJlZDogZnVuY3Rpb24odikge1xuICAgICAgcmV0dXJuIE1hdGgucG93KHRoaXMueC12LngsIDIpICsgTWF0aC5wb3codGhpcy55LXYueSwgMik7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgcmFuZG9tXG4gICAgICogQGNoYWluYWJsZVxuICAgICAqIOinkuW6puOBjCBtaW4g44GL44KJIG1heCDjga7nr4Tlm7LvvIjluqbljZjkvY3vvInjgaflpKfjgY3jgZXjgYwgbGVuIOOBruODqeODs+ODgOODoOOBquODmeOCr+ODiOODq+OCkui/lOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgcGhpbmEuZ2VvbS5WZWN0b3IyKCkucmFuZG9tKDkwLCAxODAsIDEpOyAvLyA9PiBwaGluYS5nZW9tLlZlY3RvcjIoLTAuNSwgMC44NjYpIOOBquOBqVxuICAgICAqXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFttaW49MF0g6KeS5bqm77yI5bqm5Y2Y5L2N77yJ44Gu5LiL6ZmQ5YCkXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFttYXg9MzYwXSDop5LluqbvvIjluqbljZjkvY3vvInjga7kuIrpmZDlgKRcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW2xlbj0xXSDlpKfjgY3jgZVcbiAgICAgKiBAcmV0dXJuIHtwaGluYS5nZW9tLlZlY3RvcjJ9IOODqeODs+ODgOODoOWMluOBl+OBn+ODmeOCr+ODiOODq1xuICAgICAqL1xuICAgIHJhbmRvbTogZnVuY3Rpb24obWluLCBtYXgsIGxlbikge1xuICAgICAgdmFyIGRlZ3JlZSA9IHBoaW5hLnV0aWwuUmFuZG9tLnJhbmRmbG9hdChtaW4gfHwgMCwgbWF4IHx8IDM2MCk7XG4gICAgICB2YXIgcmFkID0gZGVncmVlKk1hdGguREVHX1RPX1JBRDtcbiAgICAgIHZhciBsZW4gPSBsZW4gfHwgMTtcblxuICAgICAgdGhpcy54ID0gTWF0aC5jb3MocmFkKSpsZW47XG4gICAgICB0aGlzLnkgPSBNYXRoLnNpbihyYWQpKmxlbjtcblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIG5vcm1hbGl6ZVxuICAgICAqIEBjaGFpbmFibGVcbiAgICAgKiB0aGlzIOOCkuato+imj+WMluOBl+OBvuOBmeOAguOBmeOBquOCj+OBoeOAgXRoaXMg44Go5ZCM44GY5pa55ZCR44Gn5aSn44GN44GV44GMMeOBruODmeOCr+ODiOODq+OCkui/lOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgdjEgPSBwaGluYS5nZW9tLlZlY3RvcjIoMywgNCk7XG4gICAgICogICAgIHYxLm5vcm1hbGl6ZSgpOyAvLyA9PiBwaGluYS5nZW9tLlZlY3RvcjIoMC42LCAwLjgpXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtwaGluYS5nZW9tLlZlY3RvcjJ9IOato+imj+WMluOBl+OBn+ODmeOCr+ODiOODq1xuICAgICAqL1xuICAgIG5vcm1hbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmRpdih0aGlzLmxlbmd0aCgpKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHRvU3RyaW5nXG4gICAgICogdGhpcyDjgpIgSlNPTiDlvaLlvI/jgafooajnj77jgZfjgZ/mloflrZfliJfjgpLov5TjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqICMjIyBFeGFtcGxlXG4gICAgICogICAgIHYxID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDMsIDQpO1xuICAgICAqICAgICB2MS50b1N0cmluZygpOyAvLyA9PiBcInt4OjMsIHk6NH1cIlxuICAgICAqXG4gICAgICogQHJldHVybiB7U3RyaW5nfSBKU09OIOaWh+Wtl+WIl1xuICAgICAqL1xuICAgIHRvU3RyaW5nOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBcInt4Ont4fSwgeTp7eX19XCIuZm9ybWF0KHRoaXMpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGdldERpcmVjdGlvblxuICAgICAqIHRoaXMg44Gu44GK44GK44KI44Gd44Gu5pa55ZCR44KS56S644GX44Gf5paH5a2X5YiX44KS6L+U44GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAqICAgICB2MSA9IHBoaW5hLmdlb20uVmVjdG9yMigzLCA0KTtcbiAgICAgKiAgICAgdjEuZ2V0RGlyZWN0aW9uKCk7IC8vID0+IFwidXBcIlxuICAgICAqXG4gICAgICogQHJldHVybiB7U3RyaW5nfSDmlrnlkJHjgpLooajjgZnmloflrZfliJfvvIhcInVwXCIsIFwicmlnaHRcIiwgXCJkb3duXCIsIFwibGVmdFwi77yJXG4gICAgICovXG4gICAgZ2V0RGlyZWN0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBhbmdsZSA9IHRoaXMudG9EZWdyZWUoKTtcbiAgICAgIGlmIChhbmdsZSA8IDQ1KSB7XG4gICAgICAgIHJldHVybiBcInJpZ2h0XCI7XG4gICAgICB9IGVsc2UgaWYgKGFuZ2xlIDwgMTM1KSB7XG4gICAgICAgIHJldHVybiBcImRvd25cIjtcbiAgICAgIH0gZWxzZSBpZiAoYW5nbGUgPCAyMjUpIHtcbiAgICAgICAgcmV0dXJuIFwibGVmdFwiXG4gICAgICB9IGVsc2UgaWYgKGFuZ2xlIDwgMzE1KSB7XG4gICAgICAgIHJldHVybiBcInVwXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gXCJyaWdodFwiO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHRvQW5nbGVcbiAgICAgKiB0aGlzIOOBqCB4IOi7uOOBqOOBruinkuW6pu+8iOODqeOCuOOCouODs+WNmOS9je+8ieOCkui/lOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgdjEgPSBwaGluYS5nZW9tLlZlY3RvcjIoLTIsIDApO1xuICAgICAqICAgICB2MS50b0FuZ2xlKCk7IC8vID0+IDMuMTQxNTlcbiAgICAgKlxuICAgICAqIEByZXR1cm4ge051bWJlcn0g44OZ44Kv44OI44Or44Gu6KeS5bqm77yI44Op44K444Ki44Oz5Y2Y5L2N77yJXG4gICAgICovXG4gICAgdG9BbmdsZTogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcmFkID0gTWF0aC5hdGFuMih0aGlzLnksIHRoaXMueCk7XG4gICAgICByZXR1cm4gKHJhZCArIE1hdGguUEkqMiklKE1hdGguUEkqMik7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGZyb21BbmdsZVxuICAgICAqIEBjaGFpbmFibGVcbiAgICAgKiDop5LluqbvvIjjg6njgrjjgqLjg7PljZjkvY3vvInjgajlpKfjgY3jgZXjgpLmjIflrprjgZfjgabjg5njgq/jg4jjg6vjgpLoqK3lrprjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqICMjIyBFeGFtcGxlXG4gICAgICogICAgIHBoaW5hLmdlb20uVmVjdG9yMigpLmZyb21BbmdsZShNYXRoLlBJLzQsIDIpOyAvLyA9PiBwaGluYS5nZW9tLlZlY3RvcjIoMS40MTQyLCAxLjQxNDIpXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gcmFkIOinkuW6pu+8iOODqeOCuOOCouODs+WNmOS9je+8iVxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbbGVuPTFdIOWkp+OBjeOBlVxuICAgICAqIEByZXR1cm4ge3BoaW5hLmdlb20uVmVjdG9yMn0g44OZ44Kv44OI44OrXG4gICAgICovXG4gICAgZnJvbUFuZ2xlOiBmdW5jdGlvbihyYWQsIGxlbikge1xuICAgICAgbGVuID0gbGVuIHx8IDE7XG4gICAgICB0aGlzLnggPSBNYXRoLmNvcyhyYWQpKmxlbjtcbiAgICAgIHRoaXMueSA9IE1hdGguc2luKHJhZCkqbGVuO1xuICAgICAgXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCB0b0RlZ3JlZVxuICAgICAqIHRoaXMg44GoIHgg6Lu444Go44Gu6KeS5bqm77yI5bqm5Y2Y5L2N77yJ44KS6L+U44GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAqICAgICB2MSA9IHBoaW5hLmdlb20uVmVjdG9yMigtMiwgMik7XG4gICAgICogICAgIHYxLnRvQW5nbGUoKTsgLy8gPT4gMTM1XG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9IOODmeOCr+ODiOODq+OBruinkuW6pu+8iOW6puWNmOS9je+8iVxuICAgICAqL1xuICAgIHRvRGVncmVlOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLnRvQW5nbGUoKS50b0RlZ3JlZSgpO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBmcm9tRGVncmVlXG4gICAgICogQGNoYWluYWJsZVxuICAgICAqIOinkuW6pu+8iOW6puWNmOS9je+8ieOBqOWkp+OBjeOBleOCkuaMh+WumuOBl+OBpuODmeOCr+ODiOODq+OCkuioreWumuOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgcGhpbmEuZ2VvbS5WZWN0b3IyKCkuZnJvbURlZ3JlZSg2MCwgMik7IC8vID0+IHBoaW5hLmdlb20uVmVjdG9yMigxLCAxLjczMilcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBkZWcg6KeS5bqm77yI5bqm5Y2Y5L2N77yJXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtsZW49MV0g5aSn44GN44GVXG4gICAgICogQHJldHVybiB7cGhpbmEuZ2VvbS5WZWN0b3IyfSDjg5njgq/jg4jjg6tcbiAgICAgKi9cbiAgICBmcm9tRGVncmVlOiBmdW5jdGlvbihkZWcsIGxlbikge1xuICAgICAgcmV0dXJuIHRoaXMuZnJvbUFuZ2xlKGRlZy50b1JhZGlhbigpLCBsZW4pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHJvdGF0ZVxuICAgICAqIEBjaGFpbmFibGVcbiAgICAgKiB0aGlzIOOCkuWbnui7ouOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgdjEgPSBwaGluYS5nZW9tLlZlY3RvcjIoMywgMSk7XG4gICAgICogICAgIHYxLnJvdGF0ZShNYXRoLlBJLzIpOyAvLyA9PiBwaGluYS5nZW9tLlZlY3RvcjIoLTEsIDMpO1xuICAgICAqXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHJhZCDop5LluqbvvIjjg6njgrjjgqLjg7PljZjkvY3vvIlcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW2NlbnRlcj0oMCwgMCldIOWbnui7ouOBruS4reW/g+W6p+aomVxuICAgICAqIEByZXR1cm4ge051bWJlcn0g5Zue6Lui5b6M44Gu44OZ44Kv44OI44OrXG4gICAgICovXG4gICAgcm90YXRlOiBmdW5jdGlvbihyYWQsIGNlbnRlcikge1xuICAgICAgY2VudGVyID0gY2VudGVyIHx8IHBoaW5hLmdlb20uVmVjdG9yMigwLCAwKTtcblxuICAgICAgdmFyIHgxID0gdGhpcy54IC0gY2VudGVyLng7XG4gICAgICB2YXIgeTEgPSB0aGlzLnkgLSBjZW50ZXIueTtcbiAgICAgIHZhciB4MiA9IHgxICogTWF0aC5jb3MocmFkKSAtIHkxICogTWF0aC5zaW4ocmFkKTtcbiAgICAgIHZhciB5MiA9IHgxICogTWF0aC5zaW4ocmFkKSArIHkxICogTWF0aC5jb3MocmFkKTtcbiAgICAgIHRoaXMuc2V0KCBjZW50ZXIueCArIHgyLCBjZW50ZXIueSArIHkyICk7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBfYWNjZXNzb3I6IHtcbiAgICB9LFxuXG4gICAgX3N0YXRpYzoge1xuICAgICAgLyoqXG4gICAgICAgKiBAbWV0aG9kIG1pblxuICAgICAgICogQHN0YXRpY1xuICAgICAgICogdjEg44GoIHYyIOOBruWQhOimgee0oOOBq+WvvuOBl+OAgeOCiOOCiuWwj+OBleOBhOaWueOCkuimgee0oOOBqOOBmeOCi+aWsOOBl+OBhOODmeOCr+ODiOODq+OCkueUn+aIkOOBl+OBpui/lOOBl+OBvuOBmeOAglxuICAgICAgICpcbiAgICAgICAqICMjIyBFeGFtcGxlXG4gICAgICAgKiAgICAgdjEgPSBwaGluYS5nZW9tLlZlY3RvcjIoMywgMSk7XG4gICAgICAgKiAgICAgdjIgPSBwaGluYS5nZW9tLlZlY3RvcjIoLTMsIDIpO1xuICAgICAgICogICAgIHBoaW5hLmdlb20uVmVjdG9yMi5taW4odjEsIHYyKTsgLy8gcGhpbmEuZ2VvbS5WZWN0b3IyKC0zLCAxKTtcbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gdjEg44OZ44Kv44OI44OrXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gdjIg44OZ44Kv44OI44OrXG4gICAgICAgKiBAcmV0dXJuIHtwaGluYS5nZW9tLlZlY3RvcjJ9IOeUn+aIkOOBl+OBn+ODmeOCr+ODiOODq1xuICAgICAgICovXG4gICAgICBtaW46IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgcmV0dXJuIHBoaW5hLmdlb20uVmVjdG9yMihcbiAgICAgICAgICAoYS54IDwgYi54KSA/IGEueCA6IGIueCxcbiAgICAgICAgICAoYS55IDwgYi55KSA/IGEueSA6IGIueVxuICAgICAgICAgICk7XG4gICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAqIEBtZXRob2QgbWF4XG4gICAgICAgKiBAc3RhdGljXG4gICAgICAgKiAy5qyh5YWD44OZ44Kv44OI44OrIHYxIOOBqCB2MiDjga7lkITopoHntKDjgavlr77jgZfjgIHjgojjgorlpKfjgY3jgYTmlrnjgpLopoHntKDjgajjgZnjgovmlrDjgZfjgYTjg5njgq/jg4jjg6vjgpLnlJ/miJDjgZfjgabov5TjgZfjgb7jgZnjgIJcbiAgICAgICAqXG4gICAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAgICogICAgIHYxID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDMsIDEpO1xuICAgICAgICogICAgIHYyID0gcGhpbmEuZ2VvbS5WZWN0b3IyKC0zLCAyKTtcbiAgICAgICAqICAgICBwaGluYS5nZW9tLlZlY3RvcjIubWF4KHYxLCB2Mik7IC8vIHBoaW5hLmdlb20uVmVjdG9yMigzLCAyKTtcbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gdjEg44OZ44Kv44OI44OrXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gdjIg44OZ44Kv44OI44OrXG4gICAgICAgKiBAcmV0dXJuIHtwaGluYS5nZW9tLlZlY3RvcjJ9IOeUn+aIkOOBl+OBn+ODmeOCr+ODiOODq1xuICAgICAgICovXG4gICAgICBtYXg6IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgcmV0dXJuIHBoaW5hLmdlb20uVmVjdG9yMihcbiAgICAgICAgICAoYS54ID4gYi54KSA/IGEueCA6IGIueCxcbiAgICAgICAgICAoYS55ID4gYi55KSA/IGEueSA6IGIueVxuICAgICAgICAgICk7XG4gICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAqIEBtZXRob2QgYWRkXG4gICAgICAgKiBAc3RhdGljXG4gICAgICAgKiB2MSDjgasgdjIg44KS5Yqg566X44GX44Gf5paw44GX44GE44OZ44Kv44OI44Or44KS55Sf5oiQ44GX44Gm6L+U44GX44G+44GZ44CCXG4gICAgICAgKlxuICAgICAgICogIyMjIEV4YW1wbGVcbiAgICAgICAqICAgICB2MSA9IHBoaW5hLmdlb20uVmVjdG9yMigzLCAxKTtcbiAgICAgICAqICAgICB2MiA9IHBoaW5hLmdlb20uVmVjdG9yMigtMywgMik7XG4gICAgICAgKiAgICAgcGhpbmEuZ2VvbS5WZWN0b3IyLmFkZCh2MSwgdjIpOyAvLyBwaGluYS5nZW9tLlZlY3RvcjIoMCwgMyk7XG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtwaGluYS5nZW9tLlZlY3RvcjJ9IHYxIOODmeOCr+ODiOODq1xuICAgICAgICogQHBhcmFtIHtwaGluYS5nZW9tLlZlY3RvcjJ9IHYyIOODmeOCr+ODiOODq1xuICAgICAgICogQHJldHVybiB7cGhpbmEuZ2VvbS5WZWN0b3IyfSDliqDnrpfjgZfjgZ/ntZDmnpxcbiAgICAgICAqL1xuICAgICAgYWRkOiBmdW5jdGlvbihsaHMsIHJocykge1xuICAgICAgICByZXR1cm4gcGhpbmEuZ2VvbS5WZWN0b3IyKGxocy54K3Jocy54LCBsaHMueStyaHMueSk7XG4gICAgICB9LFxuICAgICAgXG4gICAgICAvKipcbiAgICAgICAqIEBtZXRob2Qgc3ViXG4gICAgICAgKiBAc3RhdGljXG4gICAgICAgKiAy5qyh5YWD44OZ44Kv44OI44OrIHYxIOOBi+OCiSB2MiDjgpLmuJvjgZjjgZ/mlrDjgZfjgYTjg5njgq/jg4jjg6vjgpLnlJ/miJDjgZfjgabov5TjgZfjgb7jgZnjgIJcbiAgICAgICAqXG4gICAgICAgKiDjg5njgq/jg4jjg6vjgYzluqfmqJnjgpLooajjgZnloLTlkIjjgIEy44Gk55uu44Gu5bqn5qiZ44GL44KJMeOBpOebruOBruW6p+aomeOBuOOBqOWQkeOBi+OBhuODmeOCr+ODiOODq+OBjOW+l+OCieOCjOOBvuOBmeOAglxuICAgICAgICpcbiAgICAgICAqICMjIyBFeGFtcGxlXG4gICAgICAgKiAgICAgdjEgPSBwaGluYS5nZW9tLlZlY3RvcjIoMywgMSk7XG4gICAgICAgKiAgICAgdjIgPSBwaGluYS5nZW9tLlZlY3RvcjIoLTMsIDIpO1xuICAgICAgICogICAgIHBoaW5hLmdlb20uVmVjdG9yMi5zdWIodjEsIHYyKTsgLy8gcGhpbmEuZ2VvbS5WZWN0b3IyKDYsIC0xKTtcbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gdjEg44OZ44Kv44OI44OrXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gdjIg44OZ44Kv44OI44OrXG4gICAgICAgKiBAcmV0dXJuIHtwaGluYS5nZW9tLlZlY3RvcjJ9IOa4m+eul+OBl+OBn+e1kOaenFxuICAgICAgICovXG4gICAgICBzdWI6IGZ1bmN0aW9uKGxocywgcmhzKSB7XG4gICAgICAgIHJldHVybiBwaGluYS5nZW9tLlZlY3RvcjIobGhzLngtcmhzLngsIGxocy55LXJocy55KTtcbiAgICAgIH0sXG4gICAgICBcbiAgICAgIC8qKlxuICAgICAgICogQG1ldGhvZCBtdWxcbiAgICAgICAqIEBzdGF0aWNcbiAgICAgICAqIDLmrKHlhYPjg5njgq/jg4jjg6sgdiDjga7lkITopoHntKDjgasgbiDjgpLkuZfjgZjjgZ/mlrDjgZfjgYTjg5njgq/jg4jjg6vjgpLnlJ/miJDjgZfjgabov5TjgZfjgb7jgZnjgIJcbiAgICAgICAqXG4gICAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAgICogICAgIHYxID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDMsIDEpO1xuICAgICAgICogICAgIHBoaW5hLmdlb20uVmVjdG9yMi5tdWwodjEsIDIpOyAvLyBwaGluYS5nZW9tLlZlY3RvcjIoNiwgMilcbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gdiDjg5njgq/jg4jjg6tcbiAgICAgICAqIEBwYXJhbSB7cGhpbmEuZ2VvbS5WZWN0b3IyfSBuIOS5l+OBmOOCi+WApFxuICAgICAgICogQHJldHVybiB7cGhpbmEuZ2VvbS5WZWN0b3IyfSDkuZfnrpfjgZfjgZ/ntZDmnpxcbiAgICAgICAqL1xuICAgICAgbXVsOiBmdW5jdGlvbih2LCBuKSB7XG4gICAgICAgIHJldHVybiBwaGluYS5nZW9tLlZlY3RvcjIodi54Km4sIHYueSpuKTtcbiAgICAgIH0sXG4gICAgICBcbiAgICAgIC8qKlxuICAgICAgICogQG1ldGhvZCBkaXZcbiAgICAgICAqIEBzdGF0aWNcbiAgICAgICAqIDLmrKHlhYPjg5njgq/jg4jjg6sgdiDjga7lkITopoHntKDjgpIgbiDjgaflibLjgaPjgZ/mlrDjgZfjgYTjg5njgq/jg4jjg6vjgpLnlJ/miJDjgZfjgabov5TjgZfjgb7jgZnjgIJcbiAgICAgICAqXG4gICAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAgICogICAgIHYxID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDMsIDEpO1xuICAgICAgICogICAgIHBoaW5hLmdlb20uVmVjdG9yMi5kaXYodjEsIDIpOyAvLyBwaGluYS5nZW9tLlZlY3RvcjIoMS41LCAwLjUpXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtwaGluYS5nZW9tLlZlY3RvcjJ9IHYg44OZ44Kv44OI44OrXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gbiDlibLjgovlgKRcbiAgICAgICAqIEByZXR1cm4ge3BoaW5hLmdlb20uVmVjdG9yMn0g6Zmk566X44GX44Gf57WQ5p6cXG4gICAgICAgKi9cbiAgICAgIGRpdjogZnVuY3Rpb24odiwgbikge1xuICAgICAgICByZXR1cm4gcGhpbmEuZ2VvbS5WZWN0b3IyKHYueC9uLCB2Lnkvbik7XG4gICAgICB9LFxuICAgICAgXG4gICAgICAvKipcbiAgICAgICAqIEBtZXRob2QgbmVnYXRlXG4gICAgICAgKiBAc3RhdGljXG4gICAgICAgKiAy5qyh5YWD44OZ44Kv44OI44OrIHYg44KS5Y+N6Lui44GX44Gf5paw44GX44GE44OZ44Kv44OI44Or44KS55Sf5oiQ44GX44Gm6L+U44GX44G+44GZ44CCXG4gICAgICAgKlxuICAgICAgICogIyMjIEV4YW1wbGVcbiAgICAgICAqICAgICB2MSA9IHBoaW5hLmdlb20uVmVjdG9yMigzLCAxKTtcbiAgICAgICAqICAgICBwaGluYS5nZW9tLlZlY3RvcjIubmVnYXRlKCk7IC8vIHBoaW5hLmdlb20uVmVjdG9yMigtMywgLTEpXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtwaGluYS5nZW9tLlZlY3RvcjJ9IHYg44OZ44Kv44OI44OrXG4gICAgICAgKiBAcmV0dXJuIHtwaGluYS5nZW9tLlZlY3RvcjJ9IOWPjei7ouOBl+OBn+ODmeOCr+ODiOODq1xuICAgICAgICovXG4gICAgICBuZWdhdGU6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgcmV0dXJuIHBoaW5hLmdlb20uVmVjdG9yMigtdi54LCAtdi55KTtcbiAgICAgIH0sXG4gICAgICBcbiAgICAgIC8qKlxuICAgICAgICogQG1ldGhvZCBkb3RcbiAgICAgICAqIEBzdGF0aWNcbiAgICAgICAqIDLmrKHlhYPjg5njgq/jg4jjg6sgdjEg44GoIHYyIOOBruWGheepjeOCkui/lOOBl+OBvuOBmeOAglxuICAgICAgICpcbiAgICAgICAqICMjIyBFeGFtcGxlXG4gICAgICAgKiAgICAgdjEgPSBwaGluYS5nZW9tLlZlY3RvcjIoMywgNCk7XG4gICAgICAgKiAgICAgdjIgPSBwaGluYS5nZW9tLlZlY3RvcjIoLTIsIDIpO1xuICAgICAgICogICAgIHBoaW5hLmdlb20uVmVjdG9yMi5kb3QodjEsIHYyKSAvLyA9PiAyXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtwaGluYS5nZW9tLlZlY3RvcjJ9IHYxIOODmeOCr+ODiOODq1xuICAgICAgICogQHBhcmFtIHtwaGluYS5nZW9tLlZlY3RvcjJ9IHYyIOODmeOCr+ODiOODq1xuICAgICAgICogQHJldHVybiB7cGhpbmEuZ2VvbS5WZWN0b3IyfSDlhoXnqY1cbiAgICAgICAqL1xuICAgICAgZG90OiBmdW5jdGlvbihsaHMsIHJocykge1xuICAgICAgICByZXR1cm4gbGhzLnggKiByaHMueCArIGxocy55ICogcmhzLnk7XG4gICAgICB9LFxuICAgICAgXG4gICAgICAvKipcbiAgICAgICAqIEBtZXRob2QgY3Jvc3NcbiAgICAgICAqIEBzdGF0aWNcbiAgICAgICAqIDLmrKHlhYPjg5njgq/jg4jjg6sgdjEg44GoIHYyIOOBruWkluepje+8iOOCr+ODreOCueepje+8ieOCkui/lOOBl+OBvuOBmeOAglxuICAgICAgICpcbiAgICAgICAqIDLmrKHlhYPjg5njgq/jg4jjg6vjgafjga7lpJbnqY3jga/jg5njgq/jg4jjg6vjgafjgarjgY/mlbDlgKTjgpLov5TjgZnjgZPjgajjgavms6jmhI/jgZfjgabjgY/jgaDjgZXjgYTjgIJcbiAgICAgICAqIDHjgaTnm67jga7jg5njgq/jg4jjg6vjgYwy44Gk55uu44Gu44OZ44Kv44OI44Or44KI44KK5pmC6KiI5Zue44KK44Gr44GC44KL44Go44GN44Gv5q2j44Gu5YCk44Gr44Gq44KK44CB5Y+N5pmC6KiI5Zue44KK44Gr44GC44KL44Go44GN44Gv6LKg44Gu5YCk44Gr44Gq44KK44G+44GZ44CCXG4gICAgICAgKlxuICAgICAgICogIyMjIEV4YW1wbGVcbiAgICAgICAqICAgICB2MSA9IHBoaW5hLmdlb20uVmVjdG9yMigzLCA0KTtcbiAgICAgICAqICAgICB2MiA9IHBoaW5hLmdlb20uVmVjdG9yMigzLCAxKTtcbiAgICAgICAqICAgICBwaGluYS5nZW9tLlZlY3RvcjIuY3Jvc3ModjEsIHYyKTsgLy8gPT4gLThcbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gdjEg44OZ44Kv44OI44OrXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gdjIg44OZ44Kv44OI44OrXG4gICAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9IOWkluepjVxuICAgICAgICovXG4gICAgICBjcm9zczogZnVuY3Rpb24obGhzLCByaHMpIHtcbiAgICAgICAgcmV0dXJuIChsaHMueCpyaHMueSkgLSAobGhzLnkqcmhzLngpO1xuICAgICAgfSxcbiAgICAgIFxuICAgICAgLyoqXG4gICAgICAgKiBAbWV0aG9kIGRpc3RhbmNlXG4gICAgICAgKiBAc3RhdGljXG4gICAgICAgKiB2MSDjgaggdjIg44KS5bqn5qiZ44Go44G/44Gq44GX44Gf44Go44GN44GuMueCuemWk+OBrui3nembouOCkui/lOOBl+OBvuOBmeOAglxuICAgICAgICpcbiAgICAgICAqICMjIyBFeGFtcGxlXG4gICAgICAgKiAgICAgdjEgPSBwaGluYS5nZW9tLlZlY3RvcjIoMSwgMik7XG4gICAgICAgKiAgICAgdjIgPSBwaGluYS5nZW9tLlZlY3RvcjIoNCwgNik7XG4gICAgICAgKiAgICAgcGhpbmEuZ2VvbS5WZWN0b3IyLmRpc3RhbmNlKHYxLCB2Mik7IC8vID0+IDVcbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gdjEg5bqn5qiZ44KS6KGo44GZ44OZ44Kv44OI44OrXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gdjIg5bqn5qiZ44KS6KGo44GZ44OZ44Kv44OI44OrXG4gICAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9IDLngrnplpPjga7ot53pm6JcbiAgICAgICAqL1xuICAgICAgZGlzdGFuY2U6IGZ1bmN0aW9uKGxocywgcmhzKSB7XG4gICAgICAgIHJldHVybiBNYXRoLnNxcnQoIE1hdGgucG93KGxocy54LXJocy54LCAyKSArIE1hdGgucG93KGxocy55LXJocy55LCAyKSApO1xuICAgICAgfSxcblxuICAgICAgLyoqXG4gICAgICAgKiBAbWV0aG9kIGRpc3RhbmNlU3F1YXJlZFxuICAgICAgICogQHN0YXRpY1xuICAgICAgICogdjEg44GoIHYyIOOCkuW6p+aomeOBqOOBv+OBquOBl+OBn+OBqOOBjeOBrjLngrnplpPjga7ot53pm6Ljga7oh6rkuZfjgpLov5TjgZfjgb7jgZnjgIJcbiAgICAgICAqXG4gICAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAgICogICAgIHYxID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDEsIDIpO1xuICAgICAgICogICAgIHYyID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDQsIDYpO1xuICAgICAgICogICAgIHBoaW5hLmdlb20uVmVjdG9yMi5kaXN0YW5jZVNxdWFyZWQodjEsIHYyKTsgLy8gPT4gMjVcbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gdjEg5bqn5qiZ44KS6KGo44GZ44OZ44Kv44OI44OrXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gdjIg5bqn5qiZ44KS6KGo44GZ44OZ44Kv44OI44OrXG4gICAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9IDLngrnplpPjga7ot53pm6Ljga7oh6rkuZdcbiAgICAgICAqL1xuICAgICAgZGlzdGFuY2VTcXVhcmVkOiBmdW5jdGlvbihsaHMsIHJocykge1xuICAgICAgICByZXR1cm4gTWF0aC5wb3cobGhzLngtcmhzLngsIDIpICsgTWF0aC5wb3cobGhzLnktcmhzLnksIDIpO1xuICAgICAgfSxcblxuICAgICAgLyoqXG4gICAgICAgKiBAbWV0aG9kIG1hbmhhdHRhbkRpc3RhbmNlXG4gICAgICAgKiBAc3RhdGljXG4gICAgICAgKiB2MSDjgaggdjIg44KS5bqn5qiZ44Go44G/44Gq44GX44Gf44Go44GN44GuMueCuemWk+OBruODnuODs+ODj+ODg+OCv+ODs+i3nembou+8iOi7uOOBq+W5s+ihjOOBq+mAsuOCgOOBqOOBjeOBruacgOefrei3nembou+8ieOCkui/lOOBl+OBvuOBmeOAglxuICAgICAgICpcbiAgICAgICAqICMjIyBFeGFtcGxlXG4gICAgICAgKiAgICAgdjEgPSBwaGluYS5nZW9tLlZlY3RvcjIoMSwgMik7XG4gICAgICAgKiAgICAgdjIgPSBwaGluYS5nZW9tLlZlY3RvcjIoNCwgNik7XG4gICAgICAgKiAgICAgcGhpbmEuZ2VvbS5WZWN0b3IyLm1hbmhhdHRhbkRpc3RhbmNlKHYxLCB2Mik7IC8vID0+IDdcbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gdjEg5bqn5qiZ44KS6KGo44GZ44OZ44Kv44OI44OrXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gdjIg5bqn5qiZ44KS6KGo44GZ44OZ44Kv44OI44OrXG4gICAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9IDLngrnplpPjga7jg57jg7Pjg4/jg4Pjgr/jg7Pot53pm6JcbiAgICAgICAqL1xuICAgICAgbWFuaGF0dGFuRGlzdGFuY2U6IGZ1bmN0aW9uKGxocywgcmhzKSB7XG4gICAgICAgIHJldHVybiBNYXRoLmFicyhsaHMueC1yaHMueCkgKyBNYXRoLmFicyhsaHMueS1yaHMueSk7XG4gICAgICB9LFxuICAgICAgXG4gICAgICAvKipcbiAgICAgICAqIEBtZXRob2Qgbm9ybWFsXG4gICAgICAgKiBAc3RhdGljXG4gICAgICAgKiB2MSDjgaggdjIg44KS5bqn5qiZ44Go44G/44Gq44GX44Gf44Go44GN44Gu44CBdjIg44GL44KJIHYxIOOBq+WQkeOBi+OBhuODmeOCr+ODiOODq+OBq+WvvuOBmeOCi+azlee3muODmeOCr+ODiOODq+OCkui/lOOBl+OBvuOBmeOAglxuICAgICAgICpcbiAgICAgICAqICMjIyBFeGFtcGxlXG4gICAgICAgKiAgICAgdjEgPSBwaGluYS5nZW9tLlZlY3RvcjIoMSwgMik7XG4gICAgICAgKiAgICAgdjIgPSBwaGluYS5nZW9tLlZlY3RvcjIoNCwgNik7XG4gICAgICAgKiAgICAgcGhpbmEuZ2VvbS5WZWN0b3IyLm5vcm1hbCh2MSwgdjIpOyAvLyA9PiBwaGluYS5nZW9tLlZlY3RvcjIoNCwgLTMpXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtwaGluYS5nZW9tLlZlY3RvcjJ9IHYxIOW6p+aomeOCkuihqOOBmeODmeOCr+ODiOODq1xuICAgICAgICogQHBhcmFtIHtwaGluYS5nZW9tLlZlY3RvcjJ9IHYyIOW6p+aomeOCkuihqOOBmeODmeOCr+ODiOODq1xuICAgICAgICogQHJldHVybiB7cGhpbmEuZ2VvbS5WZWN0b3IyfSDms5Xnt5rjg5njgq/jg4jjg6tcbiAgICAgICAqL1xuICAgICAgbm9ybWFsOiBmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgIHZhciB0ZW1wID0gcGhpbmEuZ2VvbS5WZWN0b3IyLnN1YihhLCBiKTtcblxuICAgICAgICByZXR1cm4gcGhpbmEuZ2VvbS5WZWN0b3IyKC10ZW1wLnksIHRlbXAueCk7XG4gICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAqIEBtZXRob2QgcmVmbGVjdFxuICAgICAgICogQHN0YXRpY1xuICAgICAgICogMuasoeWFg+ODmeOCr+ODiOODqyB2IOOCkuWjgeOBuOOBruWFpeWwhOODmeOCr+ODiOODq+OBqOOBl+OBpuOAgeWjgeOBq+WPjeWwhOOBl+OBn+mam+OBruODmeOCr+ODiOODq++8iOWPjeWwhOODmeOCr+ODiOODq++8ieOCkui/lOOBl+OBvuOBmeOAglxuICAgICAgICpcbiAgICAgICAqIOWjgeOBruWQkeOBjeOBr+azlee3muODmeOCr+ODiOODqyBub3JtYWwg44Gr44KI44Gj44Gm6KGo44GX44G+44GZ44CCXG4gICAgICAgKlxuICAgICAgICogIyMjIEV4YW1wbGVcbiAgICAgICAqICAgICB2MSA9IHBoaW5hLmdlb20uVmVjdG9yMig0LCAzKTtcbiAgICAgICAqICAgICBub3JtYWwgPSBwaGluYS5nZW9tLlZlY3RvcjIoLTEsIDEpO1xuICAgICAgICogICAgIHBoaW5hLmdlb20uVmVjdG9yMi5yZWZsZWN0KHYxLCBub3JtYWwpOyAvLyA9PiBwaGluYS5nZW9tLlZlY3RvcjIoMiwgNSlcbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gdiDlhaXlsITjg5njgq/jg4jjg6tcbiAgICAgICAqIEBwYXJhbSB7cGhpbmEuZ2VvbS5WZWN0b3IyfSBub3JtYWwg5aOB44Gu5rOV57ea44OZ44Kv44OI44OrXG4gICAgICAgKiBAcmV0dXJuIHtwaGluYS5nZW9tLlZlY3RvcjJ9IOWPjeWwhOODmeOCr+ODiOODq1xuICAgICAgICovXG4gICAgICByZWZsZWN0OiBmdW5jdGlvbih2LCBub3JtYWwpIHtcbiAgICAgICAgdmFyIGxlbiA9IHBoaW5hLmdlb20uVmVjdG9yMi5kb3Qodiwgbm9ybWFsKTtcbiAgICAgICAgdmFyIHRlbXA9IHBoaW5hLmdlb20uVmVjdG9yMi5tdWwobm9ybWFsLCAyKmxlbik7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gcGhpbmEuZ2VvbS5WZWN0b3IyLnN1Yih2LCB0ZW1wKTtcbiAgICAgIH0sXG4gICAgICBcbiAgICAgIC8qKlxuICAgICAgICogQG1ldGhvZCB3YWxsXG4gICAgICAgKiBAc3RhdGljXG4gICAgICAgKiAy5qyh5YWD44OZ44Kv44OI44OrIHYg44KS5aOB44G444Gu5YWl5bCE44OZ44Kv44OI44Or44Go44GX44Gm44CB5aOB44Gr5rK/44Gj44Gf44OZ44Kv44OI44Or77yI5aOB44Ga44KK44Kv44OI44Or77yJ44KS6L+U44GX44G+44GZ44CCXG4gICAgICAgKlxuICAgICAgICog5aOB44Gu5ZCR44GN44Gv5rOV57ea44OZ44Kv44OI44OrIG5vcm1hbCDjgavjgojjgaPjgabooajjgZfjgb7jgZnjgIJcbiAgICAgICAqXG4gICAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAgICogICAgIHYxID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDQsIDMpO1xuICAgICAgICogICAgIG5vcm1hbCA9IHBoaW5hLmdlb20uVmVjdG9yMigtMSwgMSk7XG4gICAgICAgKiAgICAgcGhpbmEuZ2VvbS5WZWN0b3IyLndhbGwodjEsIG5vcm1hbCk7IC8vID0+IHBoaW5hLmdlb20uVmVjdG9yMigzLCA0KVxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSB7cGhpbmEuZ2VvbS5WZWN0b3IyfSB2IOWFpeWwhOODmeOCr+ODiOODq1xuICAgICAgICogQHBhcmFtIHtwaGluYS5nZW9tLlZlY3RvcjJ9IG5vcm1hbCDlo4Hjga7ms5Xnt5rjg5njgq/jg4jjg6tcbiAgICAgICAqIEByZXR1cm4ge3BoaW5hLmdlb20uVmVjdG9yMn0g5aOB44Ga44KK44OZ44Kv44OI44OrXG4gICAgICAgKi9cbiAgICAgIHdhbGw6IGZ1bmN0aW9uKHYsIG5vcm1hbCkge1xuICAgICAgICB2YXIgbGVuID0gcGhpbmEuZ2VvbS5WZWN0b3IyLmRvdCh2LCBub3JtYWwpO1xuICAgICAgICB2YXIgdGVtcD0gcGhpbmEuZ2VvbS5WZWN0b3IyLm11bChub3JtYWwsIGxlbik7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gcGhpbmEuZ2VvbS5WZWN0b3IyLnN1Yih2LCB0ZW1wKTtcbiAgICAgIH0sXG4gICAgICBcbiAgICAgIC8qKlxuICAgICAgICogQG1ldGhvZCBsZXJwXG4gICAgICAgKiBAc3RhdGljXG4gICAgICAgKiB2MSDjgaggdjIg44KS5aqS5LuL5aSJ5pWwIHQg44Gn57ea5b2i6KOc6ZaT44GX44G+44GZ44CCXG4gICAgICAgKiB0PTAuNSDjgacgdjEg44GoIHYyIOOBruS4remWk+ODmeOCr+ODiOODq+OCkuaxguOCgeOCi+OBk+OBqOOBjOOBp+OBjeOBvuOBmeOAglxuICAgICAgICpcbiAgICAgICAqICMjIyBFeGFtcGxlXG4gICAgICAgKiAgICAgdjEgPSBwaGluYS5nZW9tLlZlY3RvcjIoMSwgMik7XG4gICAgICAgKiAgICAgdjIgPSBwaGluYS5nZW9tLlZlY3RvcjIoNCwgNik7XG4gICAgICAgKiAgICAgcGhpbmEuZ2VvbS5WZWN0b3IyLmxlcnAodjEsIHYyLCAwLjUpOyAvLyA9PiAoMi41LCA0KVxuICAgICAgICogICAgIHBoaW5hLmdlb20uVmVjdG9yMi5sZXJwKHYxLCB2MiwgMCk7IC8vID0+ICgxLCAyKVxuICAgICAgICogICAgIHBoaW5hLmdlb20uVmVjdG9yMi5sZXJwKHYxLCB2MiwgMSk7IC8vID0+ICg0LCA2KVxuICAgICAgICogXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gdjEg44OZ44Kv44OI44OrXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gdjIg44OZ44Kv44OI44OrXG4gICAgICAgKiBAcGFyYW0ge051bWJlcn0gdCDlqpLku4vlpInmlbBcbiAgICAgICAqIEByZXR1cm4ge3BoaW5hLmdlb20uVmVjdG9yMn0g57ea5b2i6KOc6ZaT44Gu57WQ5p6cXG4gICAgICAgKi9cbiAgICAgIGxlcnA6IGZ1bmN0aW9uKGEsIGIsIHQpIHtcbiAgICAgICAgcmV0dXJuIHBoaW5hLmdlb20uVmVjdG9yMihcbiAgICAgICAgICBhLnggKyAoYi54LWEueCkqdCxcbiAgICAgICAgICBhLnkgKyAoYi55LWEueSkqdFxuICAgICAgICApO1xuICAgICAgfSxcbiAgICAgIFxuICAgICAgXG4gICAgICAvKipcbiAgICAgICAqIEBtZXRob2Qgc2xlcnBcbiAgICAgICAqIEBzdGF0aWNcbiAgICAgICAqIOijnOmWk++8iOacquWun+ijhe+8iVxuICAgICAgICovXG4gICAgICBzbGVycDogZnVuY3Rpb24obGhzLCByaHMsIHQpIHtcbiAgICAgICAgICAvLyBUT0RPOlxuICAgICAgICAgIC8vIGNvcy4uLlxuICAgICAgfSxcblxuICAgICAgLyoqXG4gICAgICAgKiBAbWV0aG9kIHJhbmRvbVxuICAgICAgICogQHN0YXRpY1xuICAgICAgICog6KeS5bqm44GMIG1pbiDjgYvjgokgbWF4IOOBruevhOWbsu+8iOW6puWNmOS9je+8ieOBp+Wkp+OBjeOBleOBjCBsZW4g44Gu44Op44Oz44OA44Og44Gq44OZ44Kv44OI44Or44KS55Sf5oiQ44GX44Gm6L+U44GX44G+44GZ44CCXG4gICAgICAgKlxuICAgICAgICogIyMjIEV4YW1wbGVcbiAgICAgICAqICAgICBwaGluYS5nZW9tLlZlY3RvcjIucmFuZG9tKDkwLCAxODAsIDEpOyAvLyA9PiBwaGluYS5nZW9tLlZlY3RvcjIoLTAuNSwgMC44NjYpIOOBquOBqVxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbbWluPTBdIOinkuW6pu+8iOW6puWNmOS9je+8ieOBruS4i+mZkOWApFxuICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFttYXg9MzYwXSDop5LluqbvvIjluqbljZjkvY3vvInjga7kuIrpmZDlgKRcbiAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbbGVuPTFdIOWkp+OBjeOBlVxuICAgICAgICogQHJldHVybiB7cGhpbmEuZ2VvbS5WZWN0b3IyfSDnlJ/miJDjgZfjgZ/jg5njgq/jg4jjg6tcbiAgICAgICAqL1xuICAgICAgcmFuZG9tOiBmdW5jdGlvbihtaW4sIG1heCwgbGVuKSB7XG4gICAgICAgIHJldHVybiBwaGluYS5nZW9tLlZlY3RvcjIoKS5yYW5kb20obWluLCBtYXgpLm11bChsZW58fDEpO1xuICAgICAgfSxcbiAgICB9LFxuXG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAcHJvcGVydHkge3BoaW5hLmdlb20uVmVjdG9yMn0gWkVSTyDjgrzjg63jg5njgq/jg4jjg6tcbiAgICogQHJlYWRvbmx5XG4gICAqL1xuICBwaGluYS5nZW9tLlZlY3RvcjIuWkVSTyA9IHBoaW5hLmdlb20uVmVjdG9yMigwLCAwKTtcbiAgLyoqXG4gICAqIEBwcm9wZXJ0eSB7cGhpbmEuZ2VvbS5WZWN0b3IyfSBMRUZUIOW3puaWueWQkeOBruWNmOS9jeODmeOCr+ODiOODq1xuICAgKiBAcmVhZG9ubHlcbiAgICovXG4gIHBoaW5hLmdlb20uVmVjdG9yMi5MRUZUID0gcGhpbmEuZ2VvbS5WZWN0b3IyKC0xLCAwKTtcbiAgLyoqXG4gICAqIEBwcm9wZXJ0eSB7cGhpbmEuZ2VvbS5WZWN0b3IyfSBSSUdIVCDlj7PmlrnlkJHjga7ljZjkvY3jg5njgq/jg4jjg6tcbiAgICogQHJlYWRvbmx5XG4gICAqL1xuICBwaGluYS5nZW9tLlZlY3RvcjIuUklHSFQ9IHBoaW5hLmdlb20uVmVjdG9yMigxLCAwKTtcbiAgLyoqXG4gICAqIEBwcm9wZXJ0eSB7cGhpbmEuZ2VvbS5WZWN0b3IyfSBVUCDkuIrmlrnlkJHjga7ljZjkvY3jg5njgq/jg4jjg6tcbiAgICogQHJlYWRvbmx5XG4gICAqL1xuICBwaGluYS5nZW9tLlZlY3RvcjIuVVAgICA9IHBoaW5hLmdlb20uVmVjdG9yMigwLCAtMSk7XG4gIC8qKlxuICAgKiBAcHJvcGVydHkge3BoaW5hLmdlb20uVmVjdG9yMn0gRE9XTiDkuIvmlrnlkJHjga7ljZjkvY3jg5njgq/jg4jjg6tcbiAgICogQHJlYWRvbmx5XG4gICAqL1xuICBwaGluYS5nZW9tLlZlY3RvcjIuRE9XTiA9IHBoaW5hLmdlb20uVmVjdG9yMigwLCAxKTtcblxufSk7XG5cblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEuZ2VvbS5WZWN0b3IzXG4gICAqICMgM+asoeWFg+ODmeOCr+ODiOODq+OCr+ODqeOCue+8iOacquWun+ijhe+8iVxuICAgKiAz5qyh5YWD44Gu44OZ44Kv44OI44Or44KE5bqn5qiZ44KS6KGo44GZ44Kv44Op44K544Gn44GZ44CCXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmdlb20uVmVjdG9yMycsIHtcblxuICAgIC8qKiB45bqn5qiZICovXG4gICAgeDogMCxcbiAgICAvKiogeeW6p+aomSAqL1xuICAgIHk6IDAsXG4gICAgLyoqIHrluqfmqJkgKi9cbiAgICB6OiAwLFxuXG4gICAgLyoqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgaW5pdDogZnVuY3Rpb24oeCwgeSwgeikge1xuICAgICAgdGhpcy54ID0geDtcbiAgICAgIHRoaXMueSA9IHk7XG4gICAgICB0aGlzLnogPSB6O1xuICAgIH0sXG5cbiAgfSk7XG5cbn0pO1xuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmdlb20uTWF0cml4MzNcbiAgICogIyDooYzliJfjgq/jg6njgrlcbiAgICogM3gz44Gu6KGM5YiX44KS6KGo44GZ44Kv44Op44K544Gn44GZ44CCXG4gICAqIFxuICAgKiA8cHJlPlxuICAgKiB8IG0wMCBtMDEgbTAyIHxcbiAgICogfCBtMTAgbTExIG0xMiB8XG4gICAqIHwgbTIwIG0yMSBtMjIgfFxuICAgKiA8L3ByZT5cbiAgICovXG4gIHBoaW5hLmRlZmluZSgncGhpbmEuZ2VvbS5NYXRyaXgzMycsIHtcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgaW5pdFxuICAgICAqIOODnuODiOODquODg+OCr+OCueOCr+ODqeOCueOBruOCs+ODs+OCueODiOODqeOCr+OCv+OBp+OBmeOAglxuICAgICAqXG4gICAgICog5byV5pWw44GvIG0wMCwgbTAxLCBtMDIsIG0xMCwgbTExLCBtMTIsIG0yMCwgbTIxLCBtMjIg44Gu6aCG44Gr5oyH5a6a44GX44G+44GZ44CCXG4gICAgICog5byV5pWw44GMOeWAi+OBq+a6gOOBn+OBquOBhOWgtOWQiOOBr+WNmOS9jeihjOWIl+OCkueUn+aIkOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgbWF0MSA9IHBoaW5hLmdlb20uTWF0cml4MzMoMSwgMiwgMywgNCwgNSwgNiwgNywgOCwgOSk7XG4gICAgICogICAgIG1hdDIgPSBwaGluYS5nZW9tLk1hdHJpeDMzKCk7XG4gICAgICogICAgIG1hdDEubTAwICsgbWF0Mi5tMDA7IC8vID0+IDJcbiAgICAgKiAgICAgbWF0MS5tMDEgLSBtYXQyLm0wMTsgLy8gPT4gMlxuICAgICAqXG4gICAgICogQHBhcmFtIHtOdW1iZXIuLi59IG0wMCwgbTAxLC4uLiDlkITopoHntKDjga7lgKRcbiAgICAgKiBAcmV0dXJuIHtwaGluYS5nZW9tLk1hdHJpeDMzfSDooYzliJfjgqrjg5bjgrjjgqfjgq/jg4hcbiAgICAgKi9cbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID49IDkpIHtcbiAgICAgICAgICB0aGlzLnNldC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgICAgdGhpcy5pZGVudGl0eSgpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHNldFxuICAgICAqIEBjaGFpbmFibGVcbiAgICAgKiB0aGlzIOOBruWQhOimgee0oOOBruWApOOCkuWGjeioreWumuOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgbWF0MSA9IHBoaW5hLmdlb20uTWF0cml4MzMoMSwgMiwgMywgNCwgNSwgNiwgNywgOCwgOSk7XG4gICAgICogICAgIG1hdDIgPSBwaGluYS5nZW9tLk1hdHJpeDMzKCk7XG4gICAgICogICAgIG1hdDIuc2V0KDEsIDIsIDMsIDQsIDUsIDYsIDcsIDgsIDkpO1xuICAgICAqICAgICBtYXQxLnRvU3RyaW5nKCkgPT0gbWF0Mi50b1N0cmluZygpOyAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge051bWJlci4uLn0gbTAwLCBtMDEsLi4uIOWQhOimgee0oOOBruWApFxuICAgICAqIEByZXR1cm4ge3BoaW5hLmdlb20uTWF0cml4MzN9IOihjOWIl+OCquODluOCuOOCp+OCr+ODiFxuICAgICAqL1xuICAgIHNldDogZnVuY3Rpb24obTAwLCBtMDEsIG0wMiwgbTEwLCBtMTEsIG0xMiwgbTIwLCBtMjEsIG0yMikge1xuICAgICAgdGhpcy5tMDAgPSBtMDA7IHRoaXMubTAxID0gbTAxOyB0aGlzLm0wMiA9IG0wMjtcbiAgICAgIHRoaXMubTEwID0gbTEwOyB0aGlzLm0xMSA9IG0xMTsgdGhpcy5tMTIgPSBtMTI7XG4gICAgICB0aGlzLm0yMCA9IG0yMDsgdGhpcy5tMjEgPSBtMjE7IHRoaXMubTIyID0gbTIyO1xuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBpZGVudGl0eVxuICAgICAqIEBjaGFpbmFibGVcbiAgICAgKiB0aGlzIOOCkuWNmOS9jeihjOWIl+OBq+OBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgbWF0MSA9IHBoaW5hLmdlb20uTWF0cml4MzMoMSwgMiwgMywgNCwgNSwgNiwgNywgOCwgOSk7XG4gICAgICogICAgIG1hdDIgPSBwaGluYS5nZW9tLk1hdHJpeDMzKCk7XG4gICAgICogICAgIG1hdDEuaWRlbnRpdHkoKS50b1N0cmluZygpID09IG1hdDIudG9TdHJpbmcoKTsgLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogQHJldHVybiB7cGhpbmEuZ2VvbS5NYXRyaXgzM30g5Y2Y5L2N6KGM5YiXXG4gICAgICovXG4gICAgaWRlbnRpdHk6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5tMDAgPSAxOyB0aGlzLm0wMSA9IDA7IHRoaXMubTAyID0gMDtcbiAgICAgIHRoaXMubTEwID0gMDsgdGhpcy5tMTEgPSAxOyB0aGlzLm0xMiA9IDA7XG4gICAgICB0aGlzLm0yMCA9IDA7IHRoaXMubTIxID0gMDsgdGhpcy5tMjIgPSAxO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgY2xvbmVcbiAgICAgKiB0aGlzIOOBruOCs+ODlOODvOOCkueUn+aIkOOBl+OBpui/lOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgbWF0MSA9IHBoaW5hLmdlb20uTWF0cml4MzMoMSwgMiwgMywgNCwgNSwgNiwgNywgOCwgOSk7XG4gICAgICogICAgIG1hdDIgPSBtYXQxLmNsb25lKCk7XG4gICAgICogICAgIG1hdDEudG9TdHJpbmcoKSA9PSBtYXQyLnRvU3RyaW5nKCk7IC8vID0+IHRydWVcbiAgICAgKiAgICAgbWF0MSA9PSBtYXQyOyAvLyA9PiBmYWxzZVxuICAgICAqXG4gICAgICogQHJldHVybiB7cGhpbmEuZ2VvbS5NYXRyaXgzM30g6KGM5YiX44Kq44OW44K444Kn44Kv44OIXG4gICAgICovXG4gICAgY2xvbmU6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHBoaW5hLmdlb20uTWF0cml4MzMoXG4gICAgICAgIHRoaXMubTAwLCB0aGlzLm0wMSwgdGhpcy5tMDIsXG4gICAgICAgIHRoaXMubTEwLCB0aGlzLm0xMSwgdGhpcy5tMTIsXG4gICAgICAgIHRoaXMubTIwLCB0aGlzLm0yMSwgdGhpcy5tMjJcbiAgICAgICk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZGV0ZXJtaW5hbnRcbiAgICAgKiDooYzliJflvI/jgpLov5TjgZfjgb7jgZlcbiAgICAgKlxuICAgICAqICMjIyBFeGFtcGxlXG4gICAgICogICAgIG1hdDEgPSBwaGluYS5nZW9tLk1hdHJpeDMzKDAsIC0yLCAwLCAtMSwgMywgMSwgNCwgMiwgMSk7XG4gICAgICogICAgIG1hdDEuZGV0ZXJtaW5hbnQoKTsgLy8gPT4gLTEwXG4gICAgICogICAgIG1hdDEuaWRlbnRpdHkoKS5kZXRlcm1pbmFudCgpOyAvLyA9PiAxXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9IOihjOWIl+W8j1xuICAgICAqL1xuICAgIGRldGVybWluYW50OiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBtMDAgPSB0aGlzLm0wMDsgdmFyIG0wMSA9IHRoaXMubTAxOyB2YXIgbTAyID0gdGhpcy5tMDI7XG4gICAgICB2YXIgbTEwID0gdGhpcy5tMTA7IHZhciBtMTEgPSB0aGlzLm0xMTsgdmFyIG0xMiA9IHRoaXMubTEyO1xuICAgICAgdmFyIG0yMCA9IHRoaXMubTIwOyB2YXIgbTIxID0gdGhpcy5tMjE7IHZhciBtMjIgPSB0aGlzLm0yMjtcbiAgICAgIFxuICAgICAgcmV0dXJuIG0wMCptMTEqbTIyICsgbTEwKm0yMSptMDIgKyBtMDEqbTEyKm0yMCAtIG0wMiptMTEqbTIwIC0gbTAxKm0xMCptMjIgLSBtMTIqbTIxKm0wMDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCB0cmFuc3Bvc2VcbiAgICAgKiBAY2hhaW5hYmxlXG4gICAgICog6Lui572u6KGM5YiX44KS6L+U44GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAqICAgICBtYXQxID0gcGhpbmEuZ2VvbS5NYXRyaXgzMygxLCAyLCAzLCA0LCA1LCA2LCA3LCA4LCA5KTtcbiAgICAgKiAgICAgbWF0MiA9IHBoaW5hLmdlb20uTWF0cml4MzMoMSwgNCwgNywgMiwgNSwgOCwgMywgNiwgOSk7XG4gICAgICogICAgIG1hdDEudHJhbnNwb3NlKCkudG9TdHJpbmcoKSA9PSBtYXQyLnRvU3RyaW5nKCk7IC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIEByZXR1cm4ge3BoaW5hLmdlb20uTWF0cml4MzN9IOi7oue9ruihjOWIl1xuICAgICAqL1xuICAgIHRyYW5zcG9zZTogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc3dhcCA9IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgdmFyIHRlbXAgPSB0aGlzW2FdO1xuICAgICAgICB0aGlzW2FdID0gdGhpc1tiXTtcbiAgICAgICAgdGhpc1tiXSA9IHRlbXA7XG4gICAgICB9LmJpbmQodGhpcyk7XG5cbiAgICAgIHN3YXAoJ20wMScsICdtMTAnKTtcbiAgICAgIHN3YXAoJ20wMicsICdtMjAnKTtcbiAgICAgIHN3YXAoJ20xMicsICdtMjEnKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgaW52ZXJ0XG4gICAgICogQGNoYWluYWJsZVxuICAgICAqIOmAhuihjOWIl+OCkui/lOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgbWF0MSA9IHBoaW5hLmdlb20uTWF0cml4MzMoMCwgLTEsIDEsIC0xLCA0LCAtMiwgMSwgMSwgMSk7XG4gICAgICogICAgIG1hdDIgPSBtYXQxLmNsb25lKCkuaW52ZXJ0KCk7XG4gICAgICogICAgIG1hdDMgPSBtYXQxLmNsb25lKCkubXVsdGlwbHkobWF0Mik7XG4gICAgICogICAgIG1hdDMudG9TdHJpbmcoKSA9PSBwaGluYS5nZW9tLk1hdHJpeDMzLklERU5USVRZLnRvU3RyaW5nKCk7IC8vID0+IHRydWVcbiAgICAgKlxuICAgICAqIEByZXR1cm4ge3BoaW5hLmdlb20uTWF0cml4MzN9IOmAhuihjOWIl1xuICAgICAqL1xuICAgIGludmVydDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgbTAwID0gdGhpcy5tMDA7IHZhciBtMDEgPSB0aGlzLm0wMTsgdmFyIG0wMiA9IHRoaXMubTAyO1xuICAgICAgdmFyIG0xMCA9IHRoaXMubTEwOyB2YXIgbTExID0gdGhpcy5tMTE7IHZhciBtMTIgPSB0aGlzLm0xMjtcbiAgICAgIHZhciBtMjAgPSB0aGlzLm0yMDsgdmFyIG0yMSA9IHRoaXMubTIxOyB2YXIgbTIyID0gdGhpcy5tMjI7XG5cbiAgICAgIHZhciBkZXQgPSB0aGlzLmRldGVybWluYW50KCk7XG5cbiAgICAgIC8vIHxtMDAsIG0wMSwgbTAyfFxuICAgICAgLy8gfG0xMCwgbTExLCBtMTJ8XG4gICAgICAvLyB8bTIwLCBtMjEsIG0yMnxcbiAgICAgIHRoaXMubTAwID0gKG0xMSptMjItbTEyKm0yMSkvZGV0O1xuICAgICAgdGhpcy5tMDEgPSAobTEwKm0yMi1tMTIqbTIwKS9kZXQqLTE7XG4gICAgICB0aGlzLm0wMiA9IChtMTAqbTIxLW0xMSptMjApL2RldDtcbiAgICAgIFxuICAgICAgdGhpcy5tMTAgPSAobTAxKm0yMi1tMDIqbTIxKS9kZXQqLTE7XG4gICAgICB0aGlzLm0xMSA9IChtMDAqbTIyLW0wMiptMjApL2RldDtcbiAgICAgIHRoaXMubTEyID0gKG0wMCptMjEtbTAxKm0yMCkvZGV0Ki0xO1xuICAgICAgXG4gICAgICB0aGlzLm0yMCA9IChtMDEqbTEyLW0wMiptMTEpL2RldDtcbiAgICAgIHRoaXMubTIxID0gKG0wMCptMTItbTAyKm0xMCkvZGV0Ki0xO1xuICAgICAgdGhpcy5tMjIgPSAobTAwKm0xMS1tMDEqbTEwKS9kZXQ7XG4gICAgICBcbiAgICAgIHRoaXMudHJhbnNwb3NlKCk7XG4gICAgICBcbiAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgbXVsdGlwbHlcbiAgICAgKiB0aGlzIOOBqyBvdGhlciDjgpLkuZfjgZjjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqICMjIyBFeGFtcGxlXG4gICAgICogICAgIG1hdDEgPSBwaGluYS5nZW9tLk1hdHJpeDMzKDAsIC0xLCAxLCAtMSwgNCwgLTIsIDEsIDEsIDEpO1xuICAgICAqICAgICBtYXQyID0gbWF0MS5jbG9uZSgpLmludmVydCgpO1xuICAgICAqICAgICBtYXQzID0gbWF0MS5jbG9uZSgpLm11bHRpcGx5KG1hdDIpO1xuICAgICAqICAgICBtYXQzLnRvU3RyaW5nKCkgPT0gcGhpbmEuZ2VvbS5NYXRyaXgzMy5JREVOVElUWS50b1N0cmluZygpOyAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uTWF0cml4MzN9IG90aGVyIOS5l+OBmOOCi+ihjOWIl1xuICAgICAqIEByZXR1cm4ge3BoaW5hLmdlb20uTWF0cml4MzN9IOS5l+eul+e1kOaenOOBruihjOWIl1xuICAgICAqL1xuICAgIG11bHRpcGx5OiBmdW5jdGlvbihtYXQpIHtcbiAgICAgICAgdmFyIHRtID0gdGhpcy5tO1xuICAgICAgICB2YXIgb20gPSBtYXQubTtcblxuICAgICAgICB2YXIgYTAwID0gdGhpcy5tMDAsIGEwMSA9IHRoaXMubTAxLCBhMDIgPSB0aGlzLm0wMjtcbiAgICAgICAgdmFyIGExMCA9IHRoaXMubTEwLCBhMTEgPSB0aGlzLm0xMSwgYTEyID0gdGhpcy5tMTI7XG4gICAgICAgIHZhciBhMjAgPSB0aGlzLm0yMCwgYTIxID0gdGhpcy5tMjEsIGEyMiA9IHRoaXMubTIyO1xuICAgICAgICB2YXIgYjAwID0gbWF0Lm0wMCwgYjAxID0gbWF0Lm0wMSwgYjAyID0gbWF0Lm0wMjtcbiAgICAgICAgdmFyIGIxMCA9IG1hdC5tMTAsIGIxMSA9IG1hdC5tMTEsIGIxMiA9IG1hdC5tMTI7XG4gICAgICAgIHZhciBiMjAgPSBtYXQubTIwLCBiMjEgPSBtYXQubTIxLCBiMjIgPSBtYXQubTIyO1xuXG4gICAgICAgIHRoaXMubTAwID0gYTAwKmIwMCArIGEwMSpiMTAgKyBhMDIqYjIwO1xuICAgICAgICB0aGlzLm0wMSA9IGEwMCpiMDEgKyBhMDEqYjExICsgYTAyKmIyMTtcbiAgICAgICAgdGhpcy5tMDIgPSBhMDAqYjAyICsgYTAxKmIxMiArIGEwMipiMjI7XG5cbiAgICAgICAgdGhpcy5tMTAgPSBhMTAqYjAwICsgYTExKmIxMCArIGExMipiMjA7XG4gICAgICAgIHRoaXMubTExID0gYTEwKmIwMSArIGExMSpiMTEgKyBhMTIqYjIxO1xuICAgICAgICB0aGlzLm0xMiA9IGExMCpiMDIgKyBhMTEqYjEyICsgYTEyKmIyMjtcblxuICAgICAgICB0aGlzLm0yMCA9IGEyMCpiMDAgKyBhMjEqYjEwICsgYTIyKmIyMDtcbiAgICAgICAgdGhpcy5tMjEgPSBhMjAqYjAxICsgYTIxKmIxMSArIGEyMipiMjE7XG4gICAgICAgIHRoaXMubTIyID0gYTIwKmIwMiArIGEyMSpiMTIgKyBhMjIqYjIyO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgbXVsdGlwbHlWZWN0b3IyXG4gICAgICogdGhpcyDjgasy5qyh5YWD44OZ44Kv44OI44OrIHYg44KS5LmX44GY44G+44GZ44CCXG4gICAgICogMuasoeWFg+ODmeOCr+ODiOODq+OBryAoeCwgeSwgMSkg44Go44GX44Gm5LmX566X44GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAqICAgICBtYXQgPSBwaGluYS5nZW9tLk1hdHJpeDMzKDAsIC0xLCAxLCAtMSwgNCwgLTIsIDEsIDEsIDEpO1xuICAgICAqICAgICB2ID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDIsIDQpXG4gICAgICogICAgIG1hdC5tdWx0aXBseVZlY3RvcjIodikgLy8gPT4ge3g6IC0zLCB5OiAxMn1cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7cGhpbmEuZ2VvbS5WZWN0b3IyfSB2IOS5l+OBmOOCi+ODmeOCr+ODiOODq1xuICAgICAqIEByZXR1cm4ge3BoaW5hLmdlb20uVmVjdG9yMn0g5LmX566X57WQ5p6c44Gu44OZ44Kv44OI44OrXG4gICAgICovXG4gICAgbXVsdGlwbHlWZWN0b3IyOiBmdW5jdGlvbih2KSB7XG4gICAgICB2YXIgdnggPSB0aGlzLm0wMCp2LnggKyB0aGlzLm0wMSp2LnkgKyB0aGlzLm0wMjtcbiAgICAgIHZhciB2eSA9IHRoaXMubTEwKnYueCArIHRoaXMubTExKnYueSArIHRoaXMubTEyO1xuICAgICAgXG4gICAgICByZXR1cm4gcGhpbmEuZ2VvbS5WZWN0b3IyKHZ4LCB2eSk7XG4gICAgfSxcblxuICAgIC8vIOihjFxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZ2V0Um93XG4gICAgICogcm93IOeVquebruOBruihjOOCkumFjeWIl+OBp+i/lOOBl+OBvuOBmeOAgnJvdyDjgYwgMOOAgTHjgIEyIOOBruOBhOOBmuOCjOOBi+OBp+OBquOBkeOCjOOBsCBudWxsIOOCkui/lOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgbWF0MSA9IHBoaW5hLmdlb20uTWF0cml4MzMoMSwgMiwgMywgNCwgNSwgNiwgNywgOCwgOSk7XG4gICAgICogICAgIG1hdDEuZ2V0Um93KDApOyAvLyBbMSwgMiwgM11cbiAgICAgKiAgICAgbWF0MS5nZXRSb3coMSk7IC8vIFs0LCA1LCA2XVxuICAgICAqICAgICBtYXQxLmdldFJvdyg5KTsgLy8gbnVsbFxuICAgICAqXG4gICAgICogQHBhcmFtIHswLzEvMn0gcm93IOihjOeVquWPt1xuICAgICAqIEByZXR1cm4ge051bWJlcltdfSDooYzjgpLooajjgZnphY3liJdcbiAgICAgKi9cbiAgICBnZXRSb3c6IGZ1bmN0aW9uKHJvdykge1xuICAgICAgaWYgKCByb3cgPT09IDAgKSB7XG4gICAgICAgIHJldHVybiBbIHRoaXMubTAwLCB0aGlzLm0wMSwgdGhpcy5tMDIgXTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKCByb3cgPT09IDEgKSB7XG4gICAgICAgIHJldHVybiBbIHRoaXMubTEwLCB0aGlzLm0xMSwgdGhpcy5tMTIgXTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKCByb3cgPT09IDIgKSB7XG4gICAgICAgIHJldHVybiBbIHRoaXMubTIwLCB0aGlzLm0yMSwgdGhpcy5tMjIgXTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBnZXRDb2xcbiAgICAgKiBjb2wg55Wq55uu44Gu5YiX44KS6YWN5YiX44Gn6L+U44GX44G+44GZ44CCY29sIOOBjCAw44CBMeOAgTIg44Gu44GE44Ga44KM44GL44Gn44Gq44GR44KM44GwIG51bGwg44KS6L+U44GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAqICAgICBtYXQxID0gcGhpbmEuZ2VvbS5NYXRyaXgzMygxLCAyLCAzLCA0LCA1LCA2LCA3LCA4LCA5KTtcbiAgICAgKiAgICAgbWF0MS5nZXRDb2woMCk7IC8vIFsxLCA0LCA3XVxuICAgICAqICAgICBtYXQxLmdldENvbCgxKTsgLy8gWzIsIDUsIDhdXG4gICAgICogICAgIG1hdDEuZ2V0Um93KC0xKTsgLy8gbnVsbFxuICAgICAqXG4gICAgICogQHBhcmFtIHswLzEvMn0gY29sIOWIl+eVquWPt1xuICAgICAqIEByZXR1cm4ge051bWJlcltdfSDliJfjgpLooajjgZnphY3liJdcbiAgICAgKi9cbiAgICBnZXRDb2w6IGZ1bmN0aW9uKGNvbCkge1xuICAgICAgaWYgKCBjb2wgPT09IDAgKSB7XG4gICAgICAgIHJldHVybiBbIHRoaXMubTAwLCB0aGlzLm0xMCwgdGhpcy5tMjAgXTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKCBjb2wgPT09IDEgKSB7XG4gICAgICAgIHJldHVybiBbIHRoaXMubTAxLCB0aGlzLm0xMSwgdGhpcy5tMjEgXTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKCBjb2wgPT09IDIgKSB7XG4gICAgICAgIHJldHVybiBbIHRoaXMubTAyLCB0aGlzLm0xMiwgdGhpcy5tMjIgXTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCB0b1N0cmluZ1xuICAgICAqIOihjOWIl+OCkiBKU09OIOW9ouW8j+OBp+ihqOePvuOBl+OBn+aWh+Wtl+WIl+OCkui/lOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgdiA9IHBoaW5hLmdlb20uVmVjdG9yMigzLCA0KTtcbiAgICAgKiAgICAgdjIgPSB2LmNsb25lKCk7XG4gICAgICogICAgIHYyLnggPT0gdi54OyAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IEpTT04g5paH5a2X5YiXXG4gICAgICovXG4gICAgdG9TdHJpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIFwifHttMDB9LCB7bTAxfSwge20wMn18XFxufHttMTB9LCB7bTExfSwge20xMn18XFxufHttMjB9LCB7bTIxfSwge20yMn18XCIuZm9ybWF0KHRoaXMpO1xuICAgIH0sXG5cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEBwcm9wZXJ0eSB7cGhpbmEuZ2VvbS5NYXRyaXgzM30gSURFTlRJVFkg5Y2Y5L2N6KGM5YiXXG4gICAqIEByZWFkb25seVxuICAgKi9cbiAgcGhpbmEuZ2VvbS5NYXRyaXgzMy5JREVOVElUWSA9IHBoaW5hLmdlb20uTWF0cml4MzMoKS5pZGVudGl0eSgpO1xuXG59KTtcblxuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5nZW9tLlJlY3RcbiAgICogIyDnn6nlvaLpoJjln5/jgpLooajjgZnjgq/jg6njgrlcbiAgICog44Kt44Oj44Oz44OQ44K55LiK44Gu55+p5b2i6aCY5Z+f44KS5omx44GG44Kv44Op44K544Gn44GZ44CCXG4gICAqIFxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5nZW9tLlJlY3QnLCB7XG5cbiAgICAvKipcbiAgICAgKiBAcHJvcGVydHkge051bWJlcn0geFxuICAgICAqIOefqeW9ouOBruW3puS4iumggueCueOBriB4IOW6p+aomVxuICAgICAqL1xuICAgIHg6IDAsXG4gICAgLyoqXG4gICAgICogQHByb3BlcnR5IHtOdW1iZXJ9IHlcbiAgICAgKiDnn6nlvaLjga7lt6bkuIrpoILngrnjga4geSDluqfmqJlcbiAgICAgKi9cbiAgICB5OiAwLFxuICAgIC8qKlxuICAgICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSB3aWR0aFxuICAgICAqIOefqeW9ouOBruW5hVxuICAgICAqL1xuICAgIHdpZHRoOiAzMixcbiAgICAvKipcbiAgICAgKiBAcHJvcGVydHkge051bWJlcn0gaGlnaHRcbiAgICAgKiDnn6nlvaLjga7pq5jjgZVcbiAgICAgKi9cbiAgICBoZWlnaHQ6IDMyLFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBpbml0XG4gICAgICog55+p5b2i6aCY5Z+f44Gu44Kz44Oz44K544OI44Op44Kv44K/44Gn44GZ44CCXG4gICAgICpcbiAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAqICAgICByZWN0ID0gcGhpbmEuZ2VvbS5SZWN0KDgsIDE2LCAzMiwgNjQpO1xuICAgICAqXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHgg55+p5b2i44Gu5bem5LiK6aCC54K544GuIHgg5bqn5qiZXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHkg55+p5b2i44Gu5bem5LiK6aCC54K544GuIHkg5bqn5qiZXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHdpZHRoIOW5hVxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBoZWlnaHQg6auY44GVXG4gICAgICogQHJldHVybiB7cGhpbmEuZ2VvbS5SZWN0fSDnn6nlvaLpoJjln5/jgqrjg5bjgrjjgqfjgq/jg4hcbiAgICAgKi9cbiAgICBpbml0OiBmdW5jdGlvbih4LCB5LCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICB0aGlzLnNldCh4LCB5LCB3aWR0aCwgaGVpZ2h0KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBzZXRcbiAgICAgKiBAY2hhaW5hYmxlXG4gICAgICogdGhpcyDjga7lkITlgKTjgpLlho3oqK3lrprjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqICMjIyBFeGFtcGxlXG4gICAgICogICAgIHJlY3QgPSBwaGluYS5nZW9tLlJlY3QoOCwgMTYsIDMyLCA2NCk7XG4gICAgICogICAgIHJlY3Quc2V0KDAsIDE2LCAzMiwgNjQpO1xuICAgICAqXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHgg55+p5b2i44Gu5bem5LiK6aCC54K544GuIHgg5bqn5qiZXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHkg55+p5b2i44Gu5bem5LiK6aCC54K544GuIHkg5bqn5qiZXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHdpZHRoIOW5hVxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBoZWlnaHQg6auY44GVXG4gICAgICovXG4gICAgc2V0OiBmdW5jdGlvbih4LCB5LCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICB0aGlzLnggPSB4O1xuICAgICAgdGhpcy55ID0geTtcbiAgICAgIHRoaXMud2lkdGggPSB3aWR0aDtcbiAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0O1xuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBtb3ZlVG9cbiAgICAgKiBAY2hhaW5hYmxlXG4gICAgICog55+p5b2i6aCY5Z+f44KS5bqn5qiZICh4LCB5KSDjgavnp7vli5XjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqICMjIyBFeGFtcGxlXG4gICAgICogICAgIHJlY3QgPSBwaGluYS5nZW9tLlJlY3QoOCwgMTYsIDMyLCA2NCk7XG4gICAgICogICAgIHJlY3QuY2VudGVyWDsgLy8gPT4gMjRcbiAgICAgKiAgICAgcmVjdC5tb3ZlVG8oMCwgMCk7XG4gICAgICogICAgIHJlY3QuY2VudGVyWDsgLy8gPT4gMTZcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB4IOenu+WLleWFiOOBriB4IOW6p+aomVxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB5IOenu+WLleWFiOOBriB5IOW6p+aomVxuICAgICAqL1xuICAgIG1vdmVUbzogZnVuY3Rpb24oeCwgeSkge1xuICAgICAgdGhpcy54ID0geDtcbiAgICAgIHRoaXMueSA9IHk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBtb3ZlQnlcbiAgICAgKiBAY2hhaW5hYmxlXG4gICAgICog55+p5b2i6aCY5Z+f44KSICh4LCB5KSDjgaDjgZHnp7vli5XjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqICMjIyBFeGFtcGxlXG4gICAgICogICAgIHJlY3QgPSBwaGluYS5nZW9tLlJlY3QoOCwgMTYsIDMyLCA2NCk7XG4gICAgICogICAgIHJlY3QubW92ZUJ5KDEwLCAtMTApO1xuICAgICAqICAgICByZWN0Lng7IC8vID0+IDE4XG4gICAgICogICAgIHJlY3QueTsgLy8gPT4gNlxuICAgICAqXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHgg56e75YuV6YeP44GuIHgg5bqn5qiZXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHkg56e75YuV6YeP44GuIHkg5bqn5qiZXG4gICAgICovXG4gICAgbW92ZUJ5OiBmdW5jdGlvbih4LCB5KSB7XG4gICAgICB0aGlzLnggKz0geDtcbiAgICAgIHRoaXMueSArPSB5O1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2Qgc2V0U2l6c2VcbiAgICAgKiBAY2hhaW5hYmxlXG4gICAgICog55+p5b2i6aCY5Z+f44Gu5bmF44Go6auY44GV44KS5aSJ5pu044GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAqICAgICByZWN0ID0gcGhpbmEuZ2VvbS5SZWN0KDgsIDE2LCAzMiwgNjQpO1xuICAgICAqICAgICByZWN0LnNldFNpemUoMTAsIDIwKTtcbiAgICAgKiAgICAgcmVjdC53aWR0aDsgLy8gPT4gMTBcbiAgICAgKiAgICAgcmVjdC5oZWlnaHQ7IC8vID0+IDIwXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gd2lkdGgg5bmFXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGhlaWdodCDpq5jjgZVcbiAgICAgKi9cbiAgICBzZXRTaXplOiBmdW5jdGlvbih3LCBoKSB7XG4gICAgICB0aGlzLndpZHRoID0gdztcbiAgICAgIHRoaXMuaGVpZ2h0ID0gaDtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHBhZGRpbmdcbiAgICAgKiBAY2hhaW5hYmxlXG4gICAgICog55+p5b2i6aCY5Z+f44Gu5Lit44Gr44OR44OH44Kj44Oz44Kw6aCY5Z+f44KS6Kit5a6a44GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiDnn6nlvaLpoJjln5/oh6rkvZPjga7jgrXjgqTjgrrjga/jg5Hjg4fjgqPjg7PjgrDpoJjln5/jga7liIbjgaDjgZHlsI/jgZXjgY/jgarjgorjgb7jgZnjgIIgIFxuICAgICAqIOW5heOBruaMh+WumuaWueazleOBryBDU1Mg44GuIHBhZGRpbmcg5oyH5a6a44Go5ZCM44GY44KI44GG44Gr5pmC6KiI5Zue44KK44Gn44GZ44CCICBcbiAgICAgKiDlvJXmlbDjgYwx44Gk44Gu5aC05ZCI44Gv5LiK5LiL5bem5Y+z44Gu5YCk44CB5byV5pWw44GMMuOBpOOBruWgtOWQiOOBr+S4iuS4i+OBqOW3puWPs+OBruWApOOAgeW8leaVsOOBjO+8k+OBpOOBruWgtOWQiOOBr+S4iuOAgeW3puWPs+OAgeS4i+OBruWApOOBqOino+mHiOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgcmVjdCA9IHBoaW5hLmdlb20uUmVjdCg1MCwgMTAwLCAxNTAsIDIwMCk7XG4gICAgICogICAgIHJlY3QucGFkZGluZygxMCk7XG4gICAgICogICAgIHJlY3QueDsgLy8gPT4gNjBcbiAgICAgKiAgICAgcmVjdC55OyAvLyA9PiAxMTBcbiAgICAgKiAgICAgcmVjdC53aWR0aDsgLy8gPT4gMTMwXG4gICAgICogICAgIHJlY3QuaGVpZ2h0OyAvLyA9PiAxODBcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB0b3Ag5LiK6L6644Gu44OR44OH44Kj44Oz44Kw5bmFXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHJpZ2h0IOWPs+i+uuOBruODkeODh+OCo+ODs+OCsOW5hVxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBib3R0b20g5LiL6L6644Gu44OR44OH44Kj44Oz44Kw5bmFXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGxlZnQg5bem6L6644Gu44OR44OH44Kj44Oz44Kw5bmFXG4gICAgICovXG4gICAgcGFkZGluZzogZnVuY3Rpb24odG9wLCByaWdodCwgYm90dG9tLCBsZWZ0KSB7XG4gICAgICAvLyBjc3Mg44GuIHBhZGRpbmcg44Gr5ZCI44KP44Gb44Gm5pmC6KiI5Zue44KK44Gr44OR44Op44Oh44O844K/6Kq/5pW0XG4gICAgICBzd2l0Y2ggKGFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICAgICAgY2FzZSAxOlxuICAgICAgICAgIHRvcCA9IHJpZ2h0ID0gYm90dG9tID0gbGVmdCA9IGFyZ3VtZW50c1swXTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAyOlxuICAgICAgICAgIHRvcCAgICAgPSBib3R0b20gPSBhcmd1bWVudHNbMF07XG4gICAgICAgICAgcmlnaHQgICA9IGxlZnQgICA9IGFyZ3VtZW50c1sxXTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAzOlxuICAgICAgICAgIHRvcCAgICAgPSBhcmd1bWVudHNbMF07XG4gICAgICAgICAgcmlnaHQgICA9IGxlZnQgPSBhcmd1bWVudHNbMV07XG4gICAgICAgICAgYm90dG9tICA9IGFyZ3VtZW50c1syXTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIFxuICAgICAgdGhpcy54ICs9IGxlZnQ7XG4gICAgICB0aGlzLnkgKz0gdG9wO1xuICAgICAgdGhpcy53aWR0aCAtPSBsZWZ0K3JpZ2h0O1xuICAgICAgdGhpcy5oZWlnaHQtPSB0b3AgK2JvdHRvbTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgY29udGFpbnNcbiAgICAgKiDluqfmqJkgKHgsIHkpIOOBjCDnn6nlvaLpoJjln5/jga7kuK3jgavlkKvjgb7jgozjgovjgYvjganjgYbjgYvjgpLov5TjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqICMjIyBFeGFtcGxlXG4gICAgICogICAgIHJlY3QgPSBwaGluYS5nZW9tLlJlY3QoNTAsIDEwMCwgMTUwLCAyMDApO1xuICAgICAqICAgICByZWN0LmNvbnRhaW5zKDM1LCA2OCk7IC8vID0+ICB0cnVlXG4gICAgICogICAgIHJlY3QuY29udGFpbnMoMjAwLCA2OCk7IC8vID0+IGZhbHNlXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge051bWJlcn0geCDliKTlrprjgZnjgovlr77osaHjga4geCDluqfmqJlcbiAgICAgKiBAcGFyYW0ge051bWJlcn0geSDliKTlrprjgZnjgovlr77osaHjga4geSDluqfmqJlcbiAgICAgKiBAcmV0dXJuIHtCb29sZWFufSDmjIflrprjgZfjgZ/luqfmqJnjgYznn6nlvaLpoJjln5/jga7kuK3jgavlkKvjgb7jgozjgovjgYvjganjgYbjgYtcbiAgICAgKi9cbiAgICBjb250YWluczogZnVuY3Rpb24oeCwgeSkge1xuICAgICAgcmV0dXJuIHRoaXMubGVmdCA8PSB4ICYmIHggPD0gdGhpcy5yaWdodCAmJiB0aGlzLnRvcCA8PSB5ICYmIHkgPD0gdGhpcy5ib3R0b207XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgY2xvbmVcbiAgICAgKiB0aGlzIOOBruOCs+ODlOODvOOCkueUn+aIkOOBl+OBpui/lOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgcmVjdCA9IHBoaW5hLmdlb20uUmVjdCg1MCwgMTAwLCAxNTAsIDIwMCk7XG4gICAgICogICAgIHJlY3QyID0gcmVjdC5jbG9uZSgpO1xuICAgICAqICAgICByZWN0Mi54ID09IHJlY3QueDsgLy8gPT4gdHJ1ZVxuICAgICAqXG4gICAgICogQHJldHVybiB7T2JqZWN0fSDnlJ/miJDjgZfjgZ/nn6nlvaLpoJjln59cbiAgICAgKi9cbiAgICBjbG9uZTogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gcGhpbmEuZ2VvbS5SZWN0KHRoaXMueCwgdGhpcy55LCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgdG9DaXJjbGVcbiAgICAgKiDnn6nlvaLpoJjln5/lhoXjgavlj47jgb7jgovmnIDlpKfjga7lhobpoJjln5/jgpLnlJ/miJDjgZfjgabov5TjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqICMjIyBFeGFtcGxlXG4gICAgICogICAgIHJlY3QgPSBwaGluYS5nZW9tLlJlY3QoMzIsIDY0LCAxMDAsIDIwMCk7XG4gICAgICogICAgIGNpcmNsZSA9IHJlY3QudG9DaXJjbGUoKTtcbiAgICAgKiAgICAgY2lyY2xlLng7IC8vID0+IDgyXG4gICAgICogICAgIGNpcmNsZS55OyAvLyA9PiAxNjRcbiAgICAgKiAgICAgY2lyY2xlLnJhZGl1czsgLy8gPT4gNTBcbiAgICAgKlxuICAgICAqIEByZXR1cm4ge09iamVjdH0g55Sf5oiQ44GX44Gf5YaG6aCY5Z+fXG4gICAgICovXG4gICAgdG9DaXJjbGU6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHJhZGl1cyA9ICgodGhpcy53aWR0aCA8IHRoaXMuaGVpZ2h0KSA/IHRoaXMud2lkdGggOiB0aGlzLmhlaWdodCkvMjtcbiAgICAgIHJldHVybiBwaGluYS5nZW9tLkNpcmNsZSh0aGlzLmNlbnRlclgsIHRoaXMuY2VudGVyWSwgcmFkaXVzKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCB0b0FycmF5XG4gICAgICogdGhpcyDjga7lkITlgKTjgpLopoHntKDjgajjgZnjgovphY3liJfjgpLnlJ/miJDjgZfjgabov5TjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqICMjIyBFeGFtcGxlXG4gICAgICogICAgIHJlY3QgPSBwaGluYS5nZW9tLlJlY3QoMzIsIDY0LCAxMDAsIDIwMCk7XG4gICAgICogICAgIHJlY3QudG9BcnJheSgpOyAvLyA9PiBbMzIsIDY0LCAxMDAsIDIwMF1cbiAgICAgKlxuICAgICAqIEByZXR1cm4ge051bWJlcltdfSDnlJ/miJDjgZfjgZ/phY3liJdcbiAgICAgKi9cbiAgICB0b0FycmF5OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0XTtcbiAgICB9LFxuXG4gICAgX2FjY2Vzc29yOiB7XG4gICAgICBcbiAgICAgIC8qKlxuICAgICAgICogQHByb3BlcnR5IHtOdW1iZXJ9IGxlZnRcbiAgICAgICAqIOOCreODo+ODs+ODkOOCueW3puerr+OBi+OCieefqeW9oumgmOWfn+OBruW3pui+uuOBvuOBp+OBrui3nembolxuICAgICAgICpcbiAgICAgICAqIGxlZnQg44KS5aSJ5pu044GZ44KL44Go55+p5b2i6aCY5Z+f44Gu5bmF77yId2lkdGjvvInjgYzoh6rli5XnmoTjgavoqr/mlbTjgZXjgozjgb7jgZnjgIJcbiAgICAgICAqXG4gICAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAgICogICAgIHJlY3QgPSBwaGluYS5nZW9tLlJlY3QoMzIsIDY0LCAxMDAsIDIwMCk7XG4gICAgICAgKiAgICAgcmVjdC5sZWZ0OyAvLyA9PiAzMlxuICAgICAgICogICAgIHJlY3Qud2lkdGg7IC8vID0+IDEwMFxuICAgICAgICogICAgIHJlY3QucmlnaHQ7IC8vID0+IDEzMlxuICAgICAgICogICAgIFxuICAgICAgICogICAgIHJlY3QubGVmdCA9IDQyO1xuICAgICAgICogICAgIHJlY3Qud2lkdGg7IC8vID0+IDkwXG4gICAgICAgKi9cbiAgICAgIGxlZnQ6IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSAgIHsgcmV0dXJuIHRoaXMueDsgfSxcbiAgICAgICAgXCJzZXRcIjogZnVuY3Rpb24odikgIHsgdGhpcy53aWR0aCAtPSB2LXRoaXMueDsgdGhpcy54ID0gdjsgfVxuICAgICAgfSxcbiAgICAgIC8qKlxuICAgICAgICogQHByb3BlcnR5IHtOdW1iZXJ9IHRvcFxuICAgICAgICog44Kt44Oj44Oz44OQ44K55LiK56uv44GL44KJ55+p5b2i6aCY5Z+f44Gu5LiK6L6644G+44Gn44Gu5L2N572uXG4gICAgICAgKlxuICAgICAgICogdG9wIOOCkuWkieabtOOBmeOCi+OBqOefqeW9oumgmOWfn+OBrumrmOOBle+8iGhlaWdodO+8ieOBjOiHquWLleeahOOBq+iqv+aVtOOBleOCjOOBvuOBmeOAglxuICAgICAgICovXG4gICAgICB0b3A6IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSAgIHsgcmV0dXJuIHRoaXMueTsgfSxcbiAgICAgICAgXCJzZXRcIjogZnVuY3Rpb24odikgIHsgdGhpcy5oZWlnaHQgLT0gdi10aGlzLnk7IHRoaXMueSA9IHY7IH1cbiAgICAgIH0sXG4gICAgICAvKipcbiAgICAgICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSByaWdodFxuICAgICAgICog44Kt44Oj44Oz44OQ44K55bem56uv44GL44KJ55+p5b2i6aCY5Z+f44Gu5Y+z6L6644G+44Gn44Gu6Led6ZuiXG4gICAgICAgKlxuICAgICAgICogcmlnaHQg44KS5aSJ5pu044GZ44KL44Go55+p5b2i6aCY5Z+f44Gu5bmF77yId2lkdGjvvInjgYzoh6rli5XnmoTjgavoqr/mlbTjgZXjgozjgb7jgZnjgIJcbiAgICAgICAqL1xuICAgICAgcmlnaHQ6IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSAgIHsgcmV0dXJuIHRoaXMueCArIHRoaXMud2lkdGg7IH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKHYpICB7IHRoaXMud2lkdGggKz0gdi10aGlzLnJpZ2h0OyB9LFxuICAgICAgfSxcbiAgICAgIC8qKlxuICAgICAgICogQHByb3BlcnR5IHtOdW1iZXJ9IGJvdHRvbVxuICAgICAgICog44Kt44Oj44Oz44OQ44K55LiK56uv44GL44KJ55+p5b2i6aCY5Z+f44Gu5LiL6L6644G+44Gn44Gu5L2N572uXG4gICAgICAgKlxuICAgICAgICogYm90dG9tIOOCkuWkieabtOOBmeOCi+OBqOefqeW9oumgmOWfn+OBrumrmOOBle+8iGhlaWdodO+8ieOBjOiHquWLleeahOOBq+iqv+aVtOOBleOCjOOBvuOBmeOAglxuICAgICAgICovXG4gICAgICBib3R0b206IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSAgIHsgcmV0dXJuIHRoaXMueSArIHRoaXMuaGVpZ2h0OyB9LFxuICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2KSAgeyB0aGlzLmhlaWdodCArPSB2LXRoaXMuYm90dG9tOyB9LFxuICAgICAgfSxcbiAgICAgIFxuICAgICAgLyoqXG4gICAgICAgKiBAcHJvcGVydHkge051bWJlcn0gY2VudGVyWFxuICAgICAgICog55+p5b2i6aCY5Z+f44GuIHgg5bqn5qiZXG4gICAgICAgKlxuICAgICAgICog54++5pmC54K544Gn44Gv6Kqt44G/5Y+W44KK5bCC55So44Gn44GZ44CCXG4gICAgICAgKi9cbiAgICAgIGNlbnRlclg6IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSAgIHsgcmV0dXJuIHRoaXMueCArIHRoaXMud2lkdGgvMjsgfSxcbiAgICAgICAgXCJzZXRcIjogZnVuY3Rpb24odikgIHtcbiAgICAgICAgICAvLyBUT0RPOiDmpJzoqI7kuK1cbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICAvKipcbiAgICAgICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBjZW50ZXJZXG4gICAgICAgKiDnn6nlvaLpoJjln5/jga4geSDluqfmqJlcbiAgICAgICAqXG4gICAgICAgKiDnj77mmYLngrnjgafjga/oqq3jgb/lj5bjgorlsILnlKjjgafjgZnjgIJcbiAgICAgICAqL1xuICAgICAgY2VudGVyWToge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpcy55ICsgdGhpcy5oZWlnaHQvMjsgfSxcbiAgICAgICAgXCJzZXRcIjogZnVuY3Rpb24odikgIHtcbiAgICAgICAgICAvLyBUT0RPOiDmpJzoqI7kuK1cbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfVxuXG4gIH0pO1xuXG59KTtcblxuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5nZW9tLkNpcmNsZVxuICAgKiAjIOWGhumgmOWfn+OCkuihqOOBmeOCr+ODqeOCuVxuICAgKiDjgq3jg6Pjg7Pjg5DjgrnkuIrjga7lhobpoJjln5/jgpLmibHjgYbjgq/jg6njgrnjgafjgZnjgIJcbiAgICogXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmdlb20uQ2lyY2xlJywge1xuXG4gICAgLyoqXG4gICAgICogQHByb3BlcnR5IHtOdW1iZXJ9IHhcbiAgICAgKiDlhobjga7kuK3lv4Pjga4geCDluqfmqJlcbiAgICAgKi9cbiAgICB4OiAwLFxuICAgIC8qKlxuICAgICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSB5XG4gICAgICog5YaG44Gu5Lit5b+D44GuIHkg5bqn5qiZXG4gICAgICovXG4gICAgeTogMCxcbiAgICAvKipcbiAgICAgKiBAcHJvcGVydHkge051bWJlcn0gcmFkaXVzXG4gICAgICog5YaG44Gu5Y2K5b6EXG4gICAgICovXG4gICAgcmFkaXVzOiAzMixcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgaW5pdFxuICAgICAqIOWGhumgmOWfn+OBruOCs+ODs+OCueODiOODqeOCr+OCv+OBp+OBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgY2lyY2xlID0gcGhpbmEuZ2VvbS5DaXJjbGUoMzIsIDY0LCAxMjgpO1xuICAgICAqXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHgg5YaG44Gu5Lit5b+D44GuIHgg5bqn5qiZXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHkg5YaG44Gu5Lit5b+D44GuIHkg5bqn5qiZXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHJhZGl1cyDljYrlvoRcbiAgICAgKiBAcmV0dXJuIHtwaGluYS5nZW9tLlJlY3R9IOWGhumgmOWfn+OCquODluOCuOOCp+OCr+ODiFxuICAgICAqL1xuICAgIGluaXQ6IGZ1bmN0aW9uKHgsIHksIHJhZGl1cykge1xuICAgICAgdGhpcy5zZXQoeCwgeSwgcmFkaXVzKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBzZXRcbiAgICAgKiBAY2hhaW5hYmxlXG4gICAgICogdGhpcyDjga7lkITlgKTjgpLlho3oqK3lrprjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqICMjIyBFeGFtcGxlXG4gICAgICogICAgIGNpcmNsZSA9IHBoaW5hLmdlb20uQ2lyY2xlKDMyLCA2NCwgMTI4KTtcbiAgICAgKiAgICAgY2lyY2xlLnNldCgxMDAsIDIwMCwgMzIpO1xuICAgICAqXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHgg5YaG44KS5Zuy44GG55+p5b2i44Gu5bem5LiK6aCC54K544GuIHgg5bqn5qiZXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHkg5YaG44KS5Zuy44GG55+p5b2i44Gu5bem5LiK6aCC54K544GuIHgg5bqn5qiZXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHJhZGl1cyDljYrlvoRcbiAgICAgKiBAcmV0dXJuIHtwaGluYS5nZW9tLkNpcmNsZX0g5YaG6aCY5Z+f44Kq44OW44K444Kn44Kv44OIXG4gICAgICovXG4gICAgc2V0OiBmdW5jdGlvbih4LCB5LCByYWRpdXMpIHtcbiAgICAgIHRoaXMueCA9IHg7XG4gICAgICB0aGlzLnkgPSB5O1xuICAgICAgdGhpcy5yYWRpdXMgPSByYWRpdXM7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIG1vdmVUb1xuICAgICAqIEBjaGFpbmFibGVcbiAgICAgKiDlhobpoJjln5/jgpLluqfmqJkgKHgsIHkpIOOBq+enu+WLleOBl+OBvuOBmeOAgih4LCB5KSDjga/lhobjga7kuK3lv4PjgpLooajjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqICMjIyBFeGFtcGxlXG4gICAgICogICAgIGNpcmNsZSA9IHBoaW5hLmdlb20uQ2lyY2xlKDMwMCwgMzAwLCA0MCk7XG4gICAgICogICAgIGNpcmNsZS5sZWZ0OyAvLyA9PiAyNjBcbiAgICAgKiAgICAgY2lyY2xlLm1vdmVUbygxMDAsIDEwMCk7XG4gICAgICogICAgIGNpcmNsZS5sZWZ0OyAvLyA9PiA2MFxuICAgICAqXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHgg56e75YuV5YWI44GuIHgg5bqn5qiZXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHkg56e75YuV5YWI44GuIHkg5bqn5qiZXG4gICAgICovXG4gICAgbW92ZVRvOiBmdW5jdGlvbih4LCB5KSB7XG4gICAgICB0aGlzLnggPSB4O1xuICAgICAgdGhpcy55ID0geTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIG1vdmVCeVxuICAgICAqIEBjaGFpbmFibGVcbiAgICAgKiDlhobpoJjln5/jgpIgKHgsIHkpIOOBoOOBkeenu+WLleOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgY2lyY2xlID0gcGhpbmEuZ2VvbS5DaXJjbGUoMzAwLCAzMDAsIDQwKTtcbiAgICAgKiAgICAgY2lyY2xlLmxlZnQ7IC8vID0+IDI2MFxuICAgICAqICAgICBjaXJjbGUubW92ZUJ5KDEwMCwgMTAwKTtcbiAgICAgKiAgICAgY2lyY2xlLmxlZnQ7IC8vID0+IDQ2MFxuICAgICAqXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHgg56e75YuV6YeP44GuIHgg5bqn5qiZXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHkg56e75YuV6YeP44GuIHkg5bqn5qiZXG4gICAgICovXG4gICAgbW92ZUJ5OiBmdW5jdGlvbih4LCB5KSB7XG4gICAgICB0aGlzLnggKz0geDtcbiAgICAgIHRoaXMueSArPSB5O1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgY29udGFpbnNcbiAgICAgKiDluqfmqJkgKHgsIHkpIOOBjOWGhumgmOWfn+OBruS4reOBq+WQq+OBvuOCjOOCi+OBi+OBqeOBhuOBi+OCkui/lOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgY2lyY2xlID0gcGhpbmEuZ2VvbS5DaXJjbGUoMzAwLCAzMDAsIDEwMCk7XG4gICAgICogICAgIGNpcmNsZS5jb250YWlucygzNTAsIDM1MCk7IC8vID0+ICB0cnVlXG4gICAgICogICAgIGNpcmNsZS5jb250YWlucygzNTAsIDQwMCk7IC8vID0+IGZhbHNlXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge051bWJlcn0geCDliKTlrprjgZnjgovlr77osaHjga4geCDluqfmqJlcbiAgICAgKiBAcGFyYW0ge051bWJlcn0geSDliKTlrprjgZnjgovlr77osaHjga4geSDluqfmqJlcbiAgICAgKiBAcmV0dXJuIHtCb29sZWFufSDmjIflrprjgZfjgZ/luqfmqJnjgYzlhobpoJjln5/jga7kuK3jgavlkKvjgb7jgozjgovjgYvjganjgYbjgYtcbiAgICAgKi9cbiAgICBjb250YWluczogZnVuY3Rpb24oeCwgeSkge1xuICAgICAgdmFyIGxlblggPSB0aGlzLngteDtcbiAgICAgIHZhciBsZW5ZID0gdGhpcy55LXk7XG4gICAgICB2YXIgbGVuU3F1YXJlZCA9IChsZW5YKmxlblgpKyhsZW5ZKmxlblkpO1xuXG4gICAgICByZXR1cm4gbGVuU3F1YXJlZCA8PSB0aGlzLnJhZGl1cyp0aGlzLnJhZGl1cztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBjbG9uZVxuICAgICAqIHRoaXMg44Gu44Kz44OU44O844KS55Sf5oiQ44GX44Gm6L+U44GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAqICAgICBjaXJjbGUgPSBwaGluYS5nZW9tLkNpcmNsZSg1MCwgMTAwLCA0MCk7XG4gICAgICogICAgIGNpcmNsZTIgPSBjaXJjbGUuY2xvbmUoKTtcbiAgICAgKiAgICAgY2lyY2xlMi54ID09IGNpcmNsZS54OyAvLyA9PiB0cnVlXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IOeUn+aIkOOBl+OBn+WGhumgmOWfn1xuICAgICAqL1xuICAgIGNsb25lOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBwaGluYS5nZW9tLkNpcmNsZSh0aGlzLngsIHRoaXMueSwgdGhpcy5yYWRpdXMpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHRvUmVjdFxuICAgICAqIOWGhuOBq+WkluaOpeOBmeOCi+ato+aWueW9ouOCkuihqOOBmeefqeW9oumgmOWfn+OCkueUn+aIkOOBl+OBpui/lOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgY2lyY2xlID0gcGhpbmEuZ2VvbS5DaXJjbGUoNTAsIDEwMCwgNDApO1xuICAgICAqICAgICByZWN0ID0gY2lyY2xlLnRvUmVjdCgpO1xuICAgICAqICAgICByZWN0Lng7IC8vID0+IDEwXG4gICAgICogICAgIHJlY3QueTsgLy8gPT4gNjBcbiAgICAgKiAgICAgcmVjdC53aWR0aDsgLy8gPT4gODBcbiAgICAgKlxuICAgICAqIEByZXR1cm4ge09iamVjdH0g55Sf5oiQ44GX44Gf55+p5b2i6aCY5Z+fXG4gICAgICovXG4gICAgdG9SZWN0OiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzaXplID0gdGhpcy5zaXplO1xuICAgICAgcmV0dXJuIHBoaW5hLmdlb20uUmVjdCh0aGlzLnggLSB0aGlzLnJhZGl1cywgdGhpcy55IC0gdGhpcy5yYWRpdXMsIHNpemUsIHNpemUpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCB0b0FycmF5XG4gICAgICogdGhpcyDjga7lkITlgKTjgpLopoHntKDjgajjgZnjgovphY3liJfjgpLnlJ/miJDjgZfjgabov5TjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqICMjIyBFeGFtcGxlXG4gICAgICogICAgIGNpcmNsZSA9IHBoaW5hLmdlb20uQ2lyY2xlKDUwLCAxMDAsIDQwKTtcbiAgICAgKiAgICAgcmVjdC50b0FycmF5KCk7IC8vID0+IFs1MCwgMTAwLCA0MF1cbiAgICAgKlxuICAgICAqIEByZXR1cm4ge051bWJlcltdfSDnlJ/miJDjgZfjgZ/phY3liJdcbiAgICAgKi9cbiAgICB0b0FycmF5OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMucmFkaXVzXTtcbiAgICB9LFxuXG4gICAgX2FjY2Vzc29yOiB7XG4gICAgICBcbiAgICAgIC8qKlxuICAgICAgICogQHByb3BlcnR5IHtOdW1iZXJ9IGxlZnRcbiAgICAgICAqIEByZWFkb25seVxuICAgICAgICog44Kt44Oj44Oz44OQ44K55bem56uv44GL44KJ5YaG44Gu5bem56uv44G+44Gn44Gu6Led6ZuiXG4gICAgICAgKlxuICAgICAgICog54++5pmC54K544Gn44Gv6Kqt44G/5Y+W44KK5bCC55So44Gn44GZ44CCXG4gICAgICAgKlxuICAgICAgICogIyMjIEV4YW1wbGVcbiAgICAgICAqICAgICBjaXJjbGUgPSBwaGluYS5nZW9tLkNpcmNsZSgyMDAsIDMwMCwgMTAwKTtcbiAgICAgICAqICAgICBjaXJjbGUubGVmdDsgLy8gPT4gMTAwXG4gICAgICAgKiAgICAgY2lyY2xlLnRvcDsgLy8gPT4gMjAwXG4gICAgICAgKiAgICAgY2lyY2xlLnJpZ2h0OyAvLyA9PiAzMDBcbiAgICAgICAqICAgICBjaXJjbGUuYm90dG9tOyAvLyA9PiA0MDBcbiAgICAgICAqL1xuICAgICAgbGVmdDoge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpcy54IC0gdGhpcy5yYWRpdXM7IH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKHYpICB7XG4gICAgICAgICAgLy8gVE9ETzogXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvKipcbiAgICAgICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSB0b3BcbiAgICAgICAqIEByZWFkb25seVxuICAgICAgICog44Kt44Oj44Oz44OQ44K55LiK56uv44GL44KJ5YaG44Gu5LiK56uv44G+44Gn44Gu6Led6ZuiXG4gICAgICAgKlxuICAgICAgICog54++5pmC54K544Gn44Gv6Kqt44G/5Y+W44KK5bCC55So44Gn44GZ44CCXG4gICAgICAgKi9cbiAgICAgIHRvcDoge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpcy55IC0gdGhpcy5yYWRpdXM7IH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKHYpICB7XG4gICAgICAgICAgLy8gVE9ETzogXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvKipcbiAgICAgICAqIEBwcm9wZXJ0eSB7TnVtYmVyfSByaWdodFxuICAgICAgICogQHJlYWRvbmx5XG4gICAgICAgKiDjgq3jg6Pjg7Pjg5Djgrnlj7Pnq6/jgYvjgonlhobjga7lj7Pnq6/jgb7jgafjga7ot53pm6JcbiAgICAgICAqXG4gICAgICAgKiDnj77mmYLngrnjgafjga/oqq3jgb/lj5bjgorlsILnlKjjgafjgZnjgIJcbiAgICAgICAqL1xuICAgICAgcmlnaHQ6IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSAgIHsgcmV0dXJuIHRoaXMueCArIHRoaXMucmFkaXVzOyB9LFxuICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2KSAge1xuICAgICAgICAgIC8vIFRPRE86IFxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLyoqXG4gICAgICAgKiBAcHJvcGVydHkge051bWJlcn0gYm90dG9tXG4gICAgICAgKiBAcmVhZG9ubHlcbiAgICAgICAqIOOCreODo+ODs+ODkOOCueS4i+err+OBi+OCieWGhuOBruS4i+err+OBvuOBp+OBrui3nembolxuICAgICAgICpcbiAgICAgICAqIOePvuaZgueCueOBp+OBr+iqreOBv+WPluOCiuWwgueUqOOBp+OBmeOAglxuICAgICAgICovXG4gICAgICBib3R0b206IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSAgIHsgcmV0dXJuIHRoaXMueSArIHRoaXMucmFkaXVzOyB9LFxuICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2KSAge1xuICAgICAgICAgIC8vIFRPRE86IFxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLyoqXG4gICAgICAgKiBAcHJvcGVydHkge051bWJlcn0gc2l6ZVxuICAgICAgICogQHJlYWRvbmx5XG4gICAgICAgKiDlhobjga7nm7TlvoRcbiAgICAgICAqXG4gICAgICAgKiDnj77mmYLngrnjgafjga/oqq3jgb/lj5bjgorlsILnlKjjgafjgZnjgIJcbiAgICAgICAqL1xuICAgICAgc2l6ZToge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpcy5yYWRpdXMqMjsgfSxcbiAgICAgICAgXCJzZXRcIjogZnVuY3Rpb24odikgIHtcbiAgICAgICAgICAvLyBUT0RPOiDmpJzoqI7kuK1cbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfVxuXG4gIH0pO1xuXG59KTtcblxuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5nZW9tLkNvbGxpc2lvblxuICAgKiAjIOihneeqgeWIpOWumueUqOOCr+ODqeOCuVxuICAgKiDooZ3nqoHliKTlrprjga7jgZ/jgoHjga7jgq/jg6njgrnjgafjgZnjgILjgZnjgbnjgabjga7jg6Hjgr3jg4Pjg4njgYzjgrnjgr/jg4bjgqPjg4Pjgq/jg6Hjgr3jg4Pjg4njgafjgZnjgIJcbiAgICogXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmdlb20uQ29sbGlzaW9uJywge1xuXG4gICAgX3N0YXRpYzoge1xuICAgICAgLyoqXG4gICAgICAgKiBAbWV0aG9kIHRlc3RDaXJjbGVDaXJjbGVcbiAgICAgICAqIEBzdGF0aWNcbiAgICAgICAqIDLjgaTjga7lhobpoJjln5/jgYzph43jgarjgaPjgabjgYTjgovjgYvjganjgYbjgYvjgpLliKTlrprjgZfjgb7jgZlcbiAgICAgICAqXG4gICAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAgICogICAgIGNpcmNsZTEgPSBwaGluYS5nZW9tLkNpcmNsZSgxMDAsIDEwMCwgMzApO1xuICAgICAgICogICAgIGNpcmNsZTIgPSBwaGluYS5nZW9tLkNpcmNsZSgxMzAsIDE0MCwgMzApO1xuICAgICAgICogcGhpbmEuZ2VvbS5Db2xsaXNpb24udGVzdENpcmNsZUNpcmNsZShjaXJjbGUxLCBjaXJjbGUyKTsgLy8gPT4gdHJ1ZVxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSB7cGhpbmEuZ2VvbS5DaXJjbGV9IGNpcmNsZTEg5YaG6aCY5Z+f44Kq44OW44K444Kn44Kv44OIXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uQ2lyY2xlfSBjaXJjbGUyIOWGhumgmOWfn+OCquODluOCuOOCp+OCr+ODiFxuICAgICAgICogQHJldHVybiB7Qm9vbGVhbn0g6aCY5Z+f44GM6YeN44Gq44Gj44Gm44GE44KL44GL44Gp44GG44GLXG4gICAgICAgKi9cbiAgICAgIHRlc3RDaXJjbGVDaXJjbGU6IGZ1bmN0aW9uKGNpcmNsZTAsIGNpcmNsZTEpIHtcbiAgICAgICAgdmFyIGRpc3RhbmNlU3F1YXJlZCA9IHBoaW5hLmdlb20uVmVjdG9yMi5kaXN0YW5jZVNxdWFyZWQoY2lyY2xlMCwgY2lyY2xlMSk7XG4gICAgICAgIHJldHVybiBkaXN0YW5jZVNxdWFyZWQgPD0gTWF0aC5wb3coY2lyY2xlMC5yYWRpdXMgKyBjaXJjbGUxLnJhZGl1cywgMik7XG4gICAgICB9LFxuICAgICAgLyoqXG4gICAgICAgKiBAbWV0aG9kIHRlc3RSZWN0UmVjdFxuICAgICAgICogQHN0YXRpY1xuICAgICAgICogMuOBpOOBruefqeW9oumgmOWfn+OBjOmHjeOBquOBo+OBpuOBhOOCi+OBi+OBqeOBhuOBi+OCkuWIpOWumuOBl+OBvuOBmVxuICAgICAgICpcbiAgICAgICAqICMjIyBFeGFtcGxlXG4gICAgICAgKiAgICAgcmVjdDEgPSBwaGluYS5nZW9tLlJlY3QoMTAwLCAxMDAsIDMwLCA0MCk7XG4gICAgICAgKiAgICAgcmVjdDIgPSBwaGluYS5nZW9tLlJlY3QoMjAwLCAyMDAsIDEwLCAxMCk7XG4gICAgICAgKiAgICAgcGhpbmEuZ2VvbS5Db2xsaXNpb24udGVzdFJlY3RSZWN0KHJlY3QxLCByZWN0Mik7IC8vID0+IGZhbHNlXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtwaGluYS5nZW9tLlJlY3R9IHJlY3QxIOefqeW9oumgmOWfn+OCquODluOCuOOCp+OCr+ODiFxuICAgICAgICogQHBhcmFtIHtwaGluYS5nZW9tLlJlY3R9IHJlY3QyIOefqeW9oumgmOWfn+OCquODluOCuOOCp+OCr+ODiFxuICAgICAgICogQHJldHVybiB7Qm9vbGVhbn0g6aCY5Z+f44GM6YeN44Gq44Gj44Gm44GE44KL44GL44Gp44GG44GLXG4gICAgICAgKi9cbiAgICAgIHRlc3RSZWN0UmVjdDogZnVuY3Rpb24ocmVjdDAsIHJlY3QxKSB7XG4gICAgICAgIHJldHVybiAocmVjdDAubGVmdCA8IHJlY3QxLnJpZ2h0KSAmJiAocmVjdDAucmlnaHQgPiByZWN0MS5sZWZ0KSAmJlxuICAgICAgICAgIChyZWN0MC50b3AgPCByZWN0MS5ib3R0b20pICYmIChyZWN0MC5ib3R0b20gPiByZWN0MS50b3ApO1xuICAgICAgfSxcbiAgICAgIC8qKlxuICAgICAgICogQG1ldGhvZCB0ZXN0Q2lyY2xlUmVjdFxuICAgICAgICogQHN0YXRpY1xuICAgICAgICog5YaG6aCY5Z+f44Go55+p5b2i6aCY5Z+f44GM6YeN44Gq44Gj44Gm44GE44KL44GL44Gp44GG44GL44GL44KS5Yik5a6a44GX44G+44GZXG4gICAgICAgKlxuICAgICAgICogIyMjIEV4YW1wbGVcbiAgICAgICAqICAgICBjaXJjbGUgPSBwaGluYS5nZW9tLkNpcmNsZSgxMDAsIDEwMCwgMzApO1xuICAgICAgICogICAgIHJlY3QgPSBwaGluYS5nZW9tLlJlY3QoMTAwLCAxMDAsIDMwLCA0MCk7XG4gICAgICAgKiAgICAgcGhpbmEuZ2VvbS5Db2xsaXNpb24udGVzdENpcmNsZVJlY3QoY2lyY2xlLCByZWN0KTsgLy8gPT4gdHJ1ZVxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSB7cGhpbmEuZ2VvbS5DaXJjbGV9IGNpcmNsZSDlhobpoJjln5/jgqrjg5bjgrjjgqfjgq/jg4hcbiAgICAgICAqIEBwYXJhbSB7cGhpbmEuZ2VvbS5SZWN0fSByZWN0IOefqeW9oumgmOWfn+OCquODluOCuOOCp+OCr+ODiFxuICAgICAgICogQHJldHVybiB7Qm9vbGVhbn0g6aCY5Z+f44GM6YeN44Gq44Gj44Gm44GE44KL44GL44Gp44GG44GLXG4gICAgICAgKi9cbiAgICAgIHRlc3RDaXJjbGVSZWN0OiBmdW5jdGlvbihjaXJjbGUsIHJlY3QpIHtcbiAgICAgICAgLy8g44G+44Ga44Gv5aSn44GN44Gq55+p5b2i44Gn5Yik5a6aKOmrmOmAn+WMlilcbiAgICAgICAgdmFyIGJpZ1JlY3QgPSBwaGluYS5nZW9tLlJlY3QocmVjdC5sZWZ0LWNpcmNsZS5yYWRpdXMsIHJlY3QudG9wLWNpcmNsZS5yYWRpdXMsIHJlY3Qud2lkdGgrY2lyY2xlLnJhZGl1cyoyLCByZWN0LmhlaWdodCtjaXJjbGUucmFkaXVzKjIpO1xuICAgICAgICBpZiAoYmlnUmVjdC5jb250YWlucyhjaXJjbGUueCwgY2lyY2xlLnkpID09PSBmYWxzZSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gMueorumhnuOBruefqeW9ouOBqOihneeqgeWIpOWumlxuICAgICAgICB2YXIgciA9IHBoaW5hLmdlb20uUmVjdChyZWN0LmxlZnQtY2lyY2xlLnJhZGl1cywgcmVjdC50b3AsIHJlY3Qud2lkdGgrY2lyY2xlLnJhZGl1cyoyLCByZWN0LmhlaWdodCk7XG4gICAgICAgIGlmIChyLmNvbnRhaW5zKGNpcmNsZS54LCBjaXJjbGUueSkpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByLnNldChyZWN0LmxlZnQsIHJlY3QudG9wLWNpcmNsZS5yYWRpdXMsIHJlY3Qud2lkdGgsIHJlY3QuaGVpZ2h0K2NpcmNsZS5yYWRpdXMqMik7XG4gICAgICAgIGlmIChyLmNvbnRhaW5zKGNpcmNsZS54LCBjaXJjbGUueSkpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8g5YaG44Go55+p5b2i44Gu77yU54K544Gu5Yik5a6aXG4gICAgICAgIHZhciBjID0gcGhpbmEuZ2VvbS5DaXJjbGUoY2lyY2xlLngsIGNpcmNsZS55LCBjaXJjbGUucmFkaXVzKTtcbiAgICAgICAgLy8gbGVmdCB0b3BcbiAgICAgICAgaWYgKGMuY29udGFpbnMocmVjdC5sZWZ0LCByZWN0LnRvcCkpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICAvLyByaWdodCB0b3BcbiAgICAgICAgaWYgKGMuY29udGFpbnMocmVjdC5yaWdodCwgcmVjdC50b3ApKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gcmlnaHQgYm90dG9tXG4gICAgICAgIGlmIChjLmNvbnRhaW5zKHJlY3QucmlnaHQsIHJlY3QuYm90dG9tKSkge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vIGxlZnQgYm90dG9tXG4gICAgICAgIGlmIChjLmNvbnRhaW5zKHJlY3QubGVmdCwgcmVjdC5ib3R0b20pKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0sXG4gICAgICAvKipcbiAgICAgICAqIEBtZXRob2QgdGVzdENpcmNsZUxpbmVcbiAgICAgICAqIEBzdGF0aWNcbiAgICAgICAqIOWGhumgmOWfn+OBqOe3muWIhuOBjOmHjeOBquOBo+OBpuOBhOOCi+OBi+OBqeOBhuOBi+OCkuWIpOWumuOBl+OBvuOBmVxuICAgICAgICpcbiAgICAgICAqICMjIyBFeGFtcGxlXG4gICAgICAgKiAgICAgY2lyY2xlID0gcGhpbmEuZ2VvbS5DaXJjbGUoMTAwLCAxMDAsIDIwKTtcbiAgICAgICAqICAgICBwMSA9IHBoaW5hLmdlb20uVmVjdG9yMigwLCAwKTtcbiAgICAgICAqICAgICBwMiA9IHBoaW5hLmdlb20uVmVjdG9yMigzMDAsIDQwMCk7XG4gICAgICAgKiAgICAgcGhpbmEuZ2VvbS5Db2xsaXNpb24udGVzdENpcmNsZUxpbmUoY2lyY2xlLCBwMSwgcDIpOyAvLyA9PiB0cnVlXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtwaGluYS5nZW9tLkNpcmNsZX0gY2lyY2xlIOWGhumgmOWfn+OCquODluOCuOOCp+OCr+ODiFxuICAgICAgICogQHBhcmFtIHtwaGluYS5nZW9tLlZlY3RvcjJ9IHAxIOe3muWIhuOBruerr+OBruW6p+aomVxuICAgICAgICogQHBhcmFtIHtwaGluYS5nZW9tLlZlY3RvcjJ9IHAyIOe3muWIhuOBruerr+OBruW6p+aomVxuICAgICAgICogQHJldHVybiB7Qm9vbGVhbn0g5YaG6aCY5Z+f44Go57ea5YiG44GM6YeN44Gq44Gj44Gm44GE44KL44GL44Gp44GG44GLXG4gICAgICAgKi9cbiAgICAgIHRlc3RDaXJjbGVMaW5lIDogZnVuY3Rpb24oY2lyY2xlLCBwMSwgcDIpIHtcbiAgICAgICAgLy8g5YWI44Gr57ea5YiG56uv44Go44Gu5Yik5a6aXG4gICAgICAgIGlmIChjaXJjbGUuY29udGFpbnMocDEueCwgcDEueSkgfHwgY2lyY2xlLmNvbnRhaW5zKHAyLngsIHAyLnkpKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgLy8g5Y2K5b6E44GuMuS5l1xuICAgICAgICB2YXIgcjIgPSBjaXJjbGUucmFkaXVzICogY2lyY2xlLnJhZGl1cztcbiAgICAgICAgLy8g5YaG44Gu5Lit5b+D5bqn5qiZXG4gICAgICAgIHZhciBwMyA9IHBoaW5hLmdlb20uVmVjdG9yMihjaXJjbGUueCwgY2lyY2xlLnkpO1xuICAgICAgICAvLyDlkITjg5njgq/jg4jjg6tcbiAgICAgICAgdmFyIHAxcDIgPSBwaGluYS5nZW9tLlZlY3RvcjIuc3ViKHAxLCBwMik7XG4gICAgICAgIHZhciBwMXAzID0gcGhpbmEuZ2VvbS5WZWN0b3IyLnN1YihwMSwgcDMpO1xuICAgICAgICB2YXIgcDJwMyA9IHBoaW5hLmdlb20uVmVjdG9yMi5zdWIocDIsIHAzKTtcbiAgICAgICAgLy8g5aSW56mNXG4gICAgICAgIHZhciBjcm9zcyA9IHBoaW5hLmdlb20uVmVjdG9yMi5jcm9zcyhwMXAyLCBwMXAzKTtcbiAgICAgICAgLy8g5aSW56mN44Gu57W25a++5YCk44GuMuS5l1xuICAgICAgICB2YXIgY3Jvc3MyID0gY3Jvc3MgKiBjcm9zcztcbiAgICAgICAgLy8gcDFwMuOBrumVt+OBleOBrjLkuZdcbiAgICAgICAgdmFyIGxlbmd0aDIgPSBwMXAyLmxlbmd0aFNxdWFyZWQoKTtcbiAgICAgICAgLy8g5YaG44Gu5Lit5b+D44GL44KJ57ea5YiG44G+44Gn44Gu5Z6C57ea44Gu6Led6Zui44GuMuS5l1xuICAgICAgICB2YXIgZDIgPSBjcm9zczIgLyBsZW5ndGgyO1xuICAgICAgICAvLyDlhobjga7ljYrlvoTjga4y5LmX44KI44KK5bCP44GV44GE44Gq44KJ6YeN6KSHXG4gICAgICAgIGlmIChkMiA8PSByMikge1xuICAgICAgICAgIHZhciBkb3QxID0gcGhpbmEuZ2VvbS5WZWN0b3IyLmRvdChwMXAzLCBwMXAyKTtcbiAgICAgICAgICB2YXIgZG90MiA9IHBoaW5hLmdlb20uVmVjdG9yMi5kb3QocDJwMywgcDFwMik7XG4gICAgICAgICAgLy8g6YCa5bi444Gv5YaF56mN44Gu5LmX566XXG4gICAgICAgICAgaWYgKGRvdDEgKiBkb3QyIDw9IDApIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0sXG4gICAgICAvKipcbiAgICAgICAqIEBtZXRob2QgdGVzdExpbmVMaW5lXG4gICAgICAgKiBAc3RhdGljXG4gICAgICAgKiAy44Gk44Gu57ea5YiG44GM6YeN44Gq44Gj44Gm44GE44KL44GL44Gp44GG44GL44KS5Yik5a6a44GX44G+44GZXG4gICAgICAgKiDlj4LogIPvvJpodHRwOi8vd3d3NWQuYmlnbG9iZS5uZS5qcC9+dG9tb3lhMDMvc2h0bWwvYWxnb3JpdGhtL0ludGVyc2VjdGlvbi5odG1cbiAgICAgICAqXG4gICAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAgICogICAgIHAxID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDEwMCwgMTAwKTtcbiAgICAgICAqICAgICBwMiA9IHBoaW5hLmdlb20uVmVjdG9yMigyMDAsIDIwMCk7XG4gICAgICAgKiAgICAgcDMgPSBwaGluYS5nZW9tLlZlY3RvcjIoMTUwLCAyNDApO1xuICAgICAgICogICAgIHA0ID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDIwMCwgMTAwKTtcbiAgICAgICAqIHBoaW5hLmdlb20uQ29sbGlzaW9uLnRlc3RMaW5lTGluZShwMSwgcDIsIHAzLCBwNCk7IC8vID0+IHRydWVcbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gcDEg57ea5YiGMeOBruerr+OBruW6p+aomVxuICAgICAgICogQHBhcmFtIHtwaGluYS5nZW9tLlZlY3RvcjJ9IHAyIOe3muWIhjHjga7nq6/jga7luqfmqJlcbiAgICAgICAqIEBwYXJhbSB7cGhpbmEuZ2VvbS5WZWN0b3IyfSBwMyDnt5rliIYy44Gu56uv44Gu5bqn5qiZXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gcDQg57ea5YiGMuOBruerr+OBruW6p+aomVxuICAgICAgICogQHJldHVybiB7Qm9vbGVhbn0g57ea5YiGMeOBqOe3muWIhjLjgYzph43jgarjgaPjgabjgYTjgovjgYvjganjgYbjgYtcbiAgICAgICAqL1xuICAgICAgdGVzdExpbmVMaW5lIDogZnVuY3Rpb24ocDEsIHAyLCBwMywgcDQpIHtcbiAgICAgICAgLy/lkIzkuIDvvLjvvLnou7jkuIrjgavkuZfjgaPjgabjgovloLTlkIjjga7oqqTliKTlrprlm57pgb9cbiAgICAgICAgaWYgKHAxLnggPT0gcDIueCAmJiBwMS54ID09IHAzLnggJiYgcDEueCA9PSBwNC54KSB7XG4gICAgICAgICAgdmFyIG1pbiA9IE1hdGgubWluKHAxLnksIHAyLnkpO1xuICAgICAgICAgIHZhciBtYXggPSBNYXRoLm1heChwMS55LCBwMi55KTtcbiAgICAgICAgICBpZiAobWluIDw9IHAzLnkgJiYgcDMueSA8PSBtYXggfHwgbWluIDw9IHA0LnkgJiYgcDQueSA8PSBtYXgpIHJldHVybiB0cnVlO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocDEueSA9PSBwMi55ICYmIHAxLnkgPT0gcDMueSAmJiBwMS55ID09IHA0LnkpIHtcbiAgICAgICAgICB2YXIgbWluID0gTWF0aC5taW4ocDEueCwgcDIueCk7XG4gICAgICAgICAgdmFyIG1heCA9IE1hdGgubWF4KHAxLngsIHAyLngpO1xuICAgICAgICAgIGlmIChtaW4gPD0gcDMueCAmJiBwMy54IDw9IG1heCB8fCBtaW4gPD0gcDQueCAmJiBwNC54IDw9IG1heCkgcmV0dXJuIHRydWU7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIC8v6YCa5bi45Yik5a6aXG4gICAgICAgIHZhciBhID0gKHAxLnggLSBwMi54KSAqIChwMy55IC0gcDEueSkgKyAocDEueSAtIHAyLnkpICogKHAxLnggLSBwMy54KTtcbiAgICAgICAgdmFyIGIgPSAocDEueCAtIHAyLngpICogKHA0LnkgLSBwMS55KSArIChwMS55IC0gcDIueSkgKiAocDEueCAtIHA0LngpO1xuICAgICAgICB2YXIgYyA9IChwMy54IC0gcDQueCkgKiAocDEueSAtIHAzLnkpICsgKHAzLnkgLSBwNC55KSAqIChwMy54IC0gcDEueCk7XG4gICAgICAgIHZhciBkID0gKHAzLnggLSBwNC54KSAqIChwMi55IC0gcDMueSkgKyAocDMueSAtIHA0LnkpICogKHAzLnggLSBwMi54KTtcbiAgICAgICAgcmV0dXJuIGEgKiBiIDw9IDAgJiYgYyAqIGQgPD0gMDtcbiAgICAgIH0sXG4gICAgICAvKipcbiAgICAgICAqIEBtZXRob2QgdGVzdFJlY3RMaW5lXG4gICAgICAgKiBAc3RhdGljXG4gICAgICAgKiDnn6nlvaLjgajnt5rliIbjgYzph43jgarjgaPjgabjgYTjgovjgYvjganjgYbjgYvjgpLliKTlrprjgZfjgb7jgZlcbiAgICAgICAqXG4gICAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAgICogICAgIHJlY3QgPSBwaGluYS5nZW9tLlJlY3QoMTIwLCAxMzAsIDQwLCA1MCk7XG4gICAgICAgKiAgICAgcDEgPSBwaGluYS5nZW9tLlZlY3RvcjIoMTAwLCAxMDApO1xuICAgICAgICogICAgIHAyID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDIwMCwgMjAwKTtcbiAgICAgICAqIHBoaW5hLmdlb20uQ29sbGlzaW9uLnRlc3RSZWN0TGluZShyZWN0LCBwMSwgcDIpOyAvLyA9PiB0cnVlXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtwaGluYS5nZW9tLlJlY3R9IHJlY3Qg55+p5b2i6aCY5Z+f44Kq44OW44K444Kn44Kv44OIXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gcDEg57ea5YiG44Gu56uv44Gu5bqn5qiZXG4gICAgICAgKiBAcGFyYW0ge3BoaW5hLmdlb20uVmVjdG9yMn0gcDIg57ea5YiG44Gu56uv44Gu5bqn5qiZXG4gICAgICAgKiBAcmV0dXJuIHtCb29sZWFufSDnn6nlvaLjgajnt5rliIbjgYzph43jgarjgaPjgabjgYTjgovjgYvjganjgYbjgYtcbiAgICAgICAqL1xuICAgICAgdGVzdFJlY3RMaW5lIDogZnVuY3Rpb24ocmVjdCwgcDEsIHAyKSB7XG4gICAgICAgICAgLy/ljIXlkKvliKTlrpoocDHjgYzlkKvjgb7jgozjgabjgozjgbDoia/jgYTjga7jgadwMuOBruWIpOWumuOBr+OBl+OBquOBhO+8iVxuICAgICAgICAgIGlmIChyZWN0LmxlZnQgPD0gcDEueCAmJiBwMS54IDw9IHJlY3QucmlnaHQgJiYgcmVjdC50b3AgPD0gcDEueSAmJiBwMS55IDw9IHJlY3QuYm90dG9tICkgcmV0dXJuIHRydWU7XG5cbiAgICAgICAgICAvL+efqeW9ouOBru+8lOeCuVxuICAgICAgICAgIHZhciByMSA9IHBoaW5hLmdlb20uVmVjdG9yMihyZWN0LmxlZnQsIHJlY3QudG9wKTsgICAgIC8v5bem5LiKXG4gICAgICAgICAgdmFyIHIyID0gcGhpbmEuZ2VvbS5WZWN0b3IyKHJlY3QucmlnaHQsIHJlY3QudG9wKTsgICAgLy/lj7PkuIpcbiAgICAgICAgICB2YXIgcjMgPSBwaGluYS5nZW9tLlZlY3RvcjIocmVjdC5yaWdodCwgcmVjdC5ib3R0b20pOyAvL+WPs+S4i1xuICAgICAgICAgIHZhciByNCA9IHBoaW5hLmdlb20uVmVjdG9yMihyZWN0LmxlZnQsIHJlY3QuYm90dG9tKTsgIC8v5bem5LiLXG5cbiAgICAgICAgICAvL+efqeW9ouOBru+8lOi+uuOCkuOBquOBmee3muWIhuOBqOOBruaOpeinpuWIpOWumlxuICAgICAgICAgIGlmIChwaGluYS5nZW9tLkNvbGxpc2lvbi50ZXN0TGluZUxpbmUocDEsIHAyLCByMSwgcjIpKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICBpZiAocGhpbmEuZ2VvbS5Db2xsaXNpb24udGVzdExpbmVMaW5lKHAxLCBwMiwgcjIsIHIzKSkgcmV0dXJuIHRydWU7XG4gICAgICAgICAgaWYgKHBoaW5hLmdlb20uQ29sbGlzaW9uLnRlc3RMaW5lTGluZShwMSwgcDIsIHIzLCByNCkpIHJldHVybiB0cnVlO1xuICAgICAgICAgIGlmIChwaGluYS5nZW9tLkNvbGxpc2lvbi50ZXN0TGluZUxpbmUocDEsIHAyLCByMSwgcjQpKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9LFxuICAgIH1cblxuICB9KTtcblxufSk7XG5cblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEudXRpbC5TdXBwb3J0XG4gICAqIFxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS51dGlsLlN1cHBvcnQnLCB7XG4gICAgX3N0YXRpYzoge1xuICAgICAgY2FudmFzOiAhIXBoaW5hLmdsb2JhbC5DYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsXG4gICAgICB3ZWJHTDogKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gISFwaGluYS5nbG9iYWwuQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEICYmICEhZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJykuZ2V0Q29udGV4dCgnd2ViZ2wnKTtcbiAgICAgIH0pKCksXG4gICAgICB3ZWJBdWRpbzogISFwaGluYS5nbG9iYWwuQXVkaW9Db250ZXh0IHx8ICEhcGhpbmEuZ2xvYmFsLndlYmtpdEF1ZGlvQ29udGV4dCB8fCAhIXBoaW5hLmdsb2JhbC5tb3pBdWRpb0NvbnRleHQsXG4gICAgfSxcbiAgfSk7XG5cbn0pO1xuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLnV0aWwuRXZlbnREaXNwYXRjaGVyXG4gICAqICMg44Kk44OZ44Oz44OI44KS5omx44GG44Gf44KB44Gu44Kv44Op44K5XG4gICAqIOOCpOODmeODs+ODiOOCkuaJseOBhuOBn+OCgeOBruODoeOCveODg+ODieOChOODl+ODreODkeODhuOCo+OCkuWumue+qeOBl+OBpuOBhOOCi+OCr+ODqeOCueOBp+OBmeOAglxuICAgKiBwaGluYS5qcyDjgYzmj5DkvpvjgZnjgovjgq/jg6njgrnjga7lpJrjgY/jga/jgZPjga4gRXZlbnREaXNwYXRjaGVyIOOCr+ODqeOCueOBruWtkOWtq+OBqOOBquOBo+OBpuOBhOOCi+OBn+OCgeOAgVxuICAgKiDjgbvjgajjgpPjganjga7jgqrjg5bjgrjjgqfjgq/jg4jjgaflrrnmmJPjgavjgqTjg5njg7Pjg4jjgpLmibHjgYbjgZPjgajjgYzjgafjgY3jgb7jgZnjgIJcbiAgICpcbiAgICogIyDlsJHjgZfoqqzmmI5cbiAgICogdGhpcy5vbnh4eCA9IGZ1bmN0aW9uKCl7fTsg44Gn44KC44Kk44OZ44Oz44OI44Oq44K544OK44KS6Kit5a6a44Gn44GN44KL44GM44CB44GC44G+44KK5o6o5aWo44GX44Gq44GE44CCXG4gICAqIOWRvOOBs+WHuuOBleOCjOOCi+mghuW6j+OBr+OAgeOBvuOBmiB0aGlzLm9ueHh4eCDjgYzlkbzjgbPlh7rjgZXjgozjgIHjgYLjgajjga8gb24oKSDjgafnmbvpjLLjgZfjgZ/poIbnlarjgIJcbiAgICovXG4gIHBoaW5hLmRlZmluZSgncGhpbmEudXRpbC5FdmVudERpc3BhdGNoZXInLCB7XG5cbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuX2xpc3RlbmVycyA9IHt9O1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIG9uXG4gICAgICogQGNoYWluYWJsZVxuICAgICAqIOOCpOODmeODs+ODiOODquOCueODiuOCkueZu+mMsuOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICog77yR44Gk44Gu44Kk44OZ44Oz44OI44Gr5a++44GZ44KL44Kk44OZ44Oz44OI44Oq44K544OK44Gv44GE44GP44Gk44Gn44KC55m76Yyy44GZ44KL44GT44Go44GM44Gn44GN44G+44GZ44CCXG4gICAgICpcbiAgICAgKiDmqJnmupbjga7jgqTjg5njg7Pjg4jjgpLmpJznn6XjgZnjgovjgavjga/jgIHjgqrjg5bjgrjjgqfjgq/jg4jjga4ge0BsaW5rIE9iamVjdDJEI2ludGVyYWN0aXZlfSDjg5fjg63jg5Hjg4bjgqPjgYwgdHJ1ZSDjgafjgYLjgovlv4XopoHjgYzjgYLjgorjgb7jgZnjgIJcbiAgICAgKiB7QGxpbmsgT2JqZWN0MkQjaW50ZXJhY3RpdmV9IOODl+ODreODkeODhuOCo+OCkuioreWumuOBmeOCi+OBq+OBryB7QGxpbmsgT2JqZWN0MkQjc2V0SW50ZXJhY3RpdmV9IOODoeOCveODg+ODieOCkuWRvOOBs+WHuuOBl+OBpuOBj+OBoOOBleOBhOOAglxuICAgICAqXG4gICAgICog44G+44Gf44CBe0BsaW5rICNmbGFyZX0g44KEIHtAbGluayAjZmlyZX0g44Gr44KI44Gj44Gm5a6a576p44GX44Gf44Kr44K544K/44Og44Kk44OZ44Oz44OI44Gr5a++44GZ44KL44Kk44OZ44Oz44OI44Oq44K544OK44KC55m76Yyy44GZ44KL44GT44Go44GMXG4gICAgICog44Gn44GN44G+44GZ44CC44Kr44K544K/44Og44Kk44OZ44Oz44OI44Gu44Kk44OZ44Oz44OI44Oq44K544OK44GvIHtAbGluayBPYmplY3QyRCNpbnRlcmFjdGl2ZX0g44OX44Ot44OR44OG44Kj44Gr44KI44KJ44Ga5ZG844Gz5Ye644GV44KM44G+44GZ44CCXG4gICAgICog44Gq44GK44Kr44K544K/44Og44Kk44OZ44Oz44OI44Gu44Kq44OW44K444Kn44Kv44OI44GvIEV2ZW50IOOCquODluOCuOOCp+OCr+ODiOOBqOOBr+eVsOOBquOCiuOBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjUmVmZXJlbmNlXG4gICAgICog5qiZ5rqW44Gu44Kk44OZ44Oz44OI44Gu56iu6aGe44Gv5Lul5LiL44KS5Y+C54Wn44GX44Gm44GP44Gg44GV44GE44CCICBcbiAgICAgKiAtIFtFdmVudCByZWZlcmVuY2UgfCBNRE5dKCBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9FdmVudHMgKVxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgdmFyIHNoYXBlID0gQ2lyY2xlU2hhcGUoKS5hZGRDaGlsZFRvKHRoaXMpLnNldEludGVyYWN0aXZlKHRydWUpLnNldFBvc2l0aW9uKDUwLCA1MCk7XG4gICAgICogICAgIHNoYXBlLm9uKFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbihlKXtcbiAgICAgKiAgICAgICB0aGlzLmNvbG9yID0gXCJibHVlXCI7XG4gICAgICogICAgIH0pO1xuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHR5cGUg44Kk44OZ44Oz44OI44Gu56iu6aGeXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gbGlzdGVuZXIg44Kk44OZ44Oz44OI44Oq44K544OK44Go44Gq44KL6Zai5pWwXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGxpc3RlbmVyLmV2ZW50IEV2ZW50IOOCquODluOCuOOCp+OCr+ODiOOAgeOBvuOBn+OBr+OCq+OCueOCv+ODoOOCpOODmeODs+ODiOOBruOCquODluOCuOOCp+OCr+ODiFxuICAgICAqL1xuICAgIG9uOiBmdW5jdGlvbih0eXBlLCBsaXN0ZW5lcikge1xuICAgICAgaWYgKHRoaXMuX2xpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMuX2xpc3RlbmVyc1t0eXBlXSA9IFtdO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl9saXN0ZW5lcnNbdHlwZV0ucHVzaChsaXN0ZW5lcik7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBvZmZcbiAgICAgKiBAY2hhaW5hYmxlXG4gICAgICog44Kk44OZ44Oz44OI44Oq44K544OK44KS5YmK6Zmk44GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiDjgYLjgovnqK7poZ7jga7jgqTjg5njg7Pjg4jjgavlr77jgZnjgovjgqTjg5njg7Pjg4jjg6rjgrnjg4rjgpLjgZnjgbnjgabliYrpmaTjgZnjgovjgavjga8ge0BsaW5rICNjbGVhcn0g44KS5L2/55So44GX44Gm44GP44Gg44GV44GE44CCXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSDjgqTjg5njg7Pjg4jjga7nqK7poZ5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lciDjgqTjg5njg7Pjg4jjg6rjgrnjg4rplqLmlbBcbiAgICAgKi9cbiAgICBvZmY6IGZ1bmN0aW9uKHR5cGUsIGxpc3RlbmVyKSB7XG4gICAgICB2YXIgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzW3R5cGVdO1xuICAgICAgdmFyIGluZGV4ID0gbGlzdGVuZXJzLmluZGV4T2YobGlzdGVuZXIpO1xuICAgICAgaWYgKGluZGV4ICE9IC0xKSB7XG4gICAgICAgIGxpc3RlbmVycy5zcGxpY2UoaW5kZXgsMSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBmaXJlXG4gICAgICogQGNoYWluYWJsZVxuICAgICAqIOOCq+OCueOCv+ODoOOCpOODmeODs+ODiOOCkuihqOOBmeOCquODluOCuOOCp+OCr+ODiOOCkuaMh+WumuOBl+OBpuOCq+OCueOCv+ODoOOCpOODmeODs+ODiOOCkueZuueBq+OBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGV2ZW50IOOCq+OCueOCv+ODoOOCpOODmeODs+ODiOOCkuihqOOBmeOCquODluOCuOOCp+OCr+ODiFxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudC50eXBlIOOCq+OCueOCv+ODoOOCpOODmeODs+ODiOOBruWQjeWJjVxuICAgICAqL1xuICAgICBmaXJlOiBmdW5jdGlvbihlKSB7XG4gICAgICAgaWYgKCFlLnRhcmdldCkge1xuICAgICAgICAgZS50YXJnZXQgPSB0aGlzO1xuICAgICAgIH1cbiAgICAgIHZhciBvbGRFdmVudE5hbWUgPSAnb24nICsgZS50eXBlO1xuICAgICAgaWYgKHRoaXNbb2xkRXZlbnROYW1lXSkgdGhpc1tvbGRFdmVudE5hbWVdKGUpO1xuICAgICAgXG4gICAgICB2YXIgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzW2UudHlwZV07XG4gICAgICBpZiAobGlzdGVuZXJzKSB7XG4gICAgICAgIHZhciB0ZW1wID0gbGlzdGVuZXJzLmNsb25lKCk7XG4gICAgICAgIGZvciAodmFyIGk9MCxsZW49dGVtcC5sZW5ndGg7IGk8bGVuOyArK2kpIHtcbiAgICAgICAgICAgIHRlbXBbaV0uY2FsbCh0aGlzLCBlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBmbGFyZVxuICAgICAqIEBjaGFpbmFibGVcbiAgICAgKiDjgqTjg5njg7Pjg4jlkI3jgpLmjIflrprjgZfjgabjgqvjgrnjgr/jg6DjgqTjg5njg7Pjg4jjgpLnmbrngavjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqIHBhcmFtIOW8leaVsOOCkuaMh+WumuOBmeOCi+OBk+OBqOOBq+OCiOOCiuOCq+OCueOCv+ODoOOCpOODmeODs+ODiOOBq+S7u+aEj+OBruODl+ODreODkeODhuOCo+OCkuioreWumuOBmeOCi+OBk+OBqOOBjOOBp+OBjeOBvuOBmeOAgiAgXG4gICAgICog44GT44KM44Gr44KI44KK44CB5ZG844Gz5Ye644GX5YWD44GM44Kk44OZ44Oz44OI44Oq44K544OK44Gr5Lu75oSP44Gu5YCk44KS5rih44GZ44GT44Go44GM44Gn44GN44G+44GZ44CCICBcbiAgICAgKiDvvIjjgZ/jgaDjgZcgdGFyZ2V0IOODl+ODreODkeODhuOCo+OBq+OBr+W/heOBmuiHquWIhuiHqui6q+OBjOagvOe0jeOBleOCjOOBvuOBmeOAgu+8iVxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgLy9cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIOOCq+OCueOCv+ODoOOCpOODmeODs+ODiOOBruWQjeWJjVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbcGFyYW1dIOOCq+OCueOCv+ODoOOCpOODmeODs+ODiOOBq+ODl+ODreODkeODhuOCo+OCkuioreWumuOBmeOCi+OBn+OCgeOBruOCquODluOCuOOCp+OCr+ODiFxuICAgICovXG4gICAgZmxhcmU6IGZ1bmN0aW9uKHR5cGUsIHBhcmFtKSB7XG4gICAgICB2YXIgZSA9IHt0eXBlOnR5cGV9O1xuICAgICAgaWYgKHBhcmFtKSB7XG4gICAgICAgIHBhcmFtLmZvckluKGZ1bmN0aW9uKGtleSwgdmFsKSB7XG4gICAgICAgICAgZVtrZXldID0gdmFsO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZmlyZShlKTtcblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2Qgb25lXG4gICAgICogQGNoYWluYWJsZVxuICAgICAqIOS4gOW6puOBoOOBkeWun+ihjOOBleOCjOOCi+OCpOODmeODs+ODiOODquOCueODiuOCkueZu+mMsuOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICog5oyH5a6a44GX44Gf44Kk44OZ44Oz44OI44Oq44K544OK44GM5LiA5bqm5a6f6KGM44GV44KM44KL44Go44CB44Gd44Gu44Kk44OZ44Oz44OI44Oq44K544OK44Gv5YmK6Zmk44GV44KM44G+44GZ44CC44Gd44KM5Lul5aSW44Gu5oyZ5YuV44GvIHtAbGluayAjb259IOOBqOWQjOOBmOOBp+OBmeOAglxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHR5cGUg44Kk44OZ44Oz44OI44Gu56iu6aGeXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gbGlzdGVuZXIg44Kk44OZ44Oz44OI44Oq44K544OK44Go44Gq44KL6Zai5pWwXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGxpc3RlbmVyLmV2ZW50IEV2ZW50IOOCquODluOCuOOCp+OCr+ODiOOAgeOBvuOBn+OBr+OCq+OCueOCv+ODoOOCpOODmeODs+ODiOOBruOCquODluOCuOOCp+OCr+ODiFxuICAgICAqL1xuICAgIG9uZTogZnVuY3Rpb24odHlwZSwgbGlzdGVuZXIpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIFxuICAgICAgdmFyIGZ1bmMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IGxpc3RlbmVyLmFwcGx5KHNlbGYsIGFyZ3VtZW50cyk7XG4gICAgICAgIHNlbGYub2ZmKHR5cGUsIGZ1bmMpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgdGhpcy5vbih0eXBlLCBmdW5jKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgaGFzXG4gICAgICog44Kk44OZ44Oz44OI44Oq44K544OK44GM55m76Yyy44GV44KM44Gm44GE44KL44GL44Gp44GG44GL44KS6Kq/44G544G+44GZ44CCXG4gICAgICpcbiAgICAgKiDmjIflrprjgZfjgZ/jgqTjg5njg7Pjg4jjga7nqK7poZ7jgavlr77jgZnjgovjgqTjg5njg7Pjg4jjg6rjgrnjg4rjgYznmbvpjLLjgZXjgozjgabjgYTjgovloLTlkIjjga8gdHJ1ZeOAgeOBneOBhuOBp+OBquOBhOWgtOWQiOOBryBmYWxzZSDjgpLov5TjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIOOCpOODmeODs+ODiOOBrueorumhnlxuICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IOaMh+WumuOBl+OBn+OCpOODmeODs+ODiOOBruOCpOODmeODs+ODiOODquOCueODiuOBjOeZu+mMsuOBleOCjOOBpuOBhOOCi+OBi+OBqeOBhuOBi1xuICAgICAqL1xuICAgIGhhczogZnVuY3Rpb24odHlwZSkge1xuICAgICAgcmV0dXJuICh0aGlzLl9saXN0ZW5lcnNbdHlwZV0gIT09IHVuZGVmaW5lZCAmJiB0aGlzLl9saXN0ZW5lcnNbdHlwZV0ubGVuZ3RoICE9PSAwKSB8fCAhIXRoaXNbJ29uJyArIHR5cGVdO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGNsZWFyXG4gICAgICogQGNoYWluYWJsZVxuICAgICAqIOOBguOCi+eorumhnuOBruOCpOODmeODs+ODiOOBq+WvvuOBmeOCi+OCpOODmeODs+ODiOODquOCueODiuOCkuOBmeOBueOBpuWJiumZpOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICog54m55a6a44Gu44Kk44OZ44Oz44OI44Oq44K544OK44Gu44G/44KS5YmK6Zmk44GZ44KL44Gr44GvIHtAbGluayAjb2ZmfSDjgpLkvb/nlKjjgZfjgabjgY/jgaDjgZXjgYTjgIJcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIOOCpOODmeODs+ODiOOBrueorumhnlxuICAgICAqL1xuICAgIGNsZWFyOiBmdW5jdGlvbih0eXBlKSB7XG4gICAgICB2YXIgb2xkRXZlbnROYW1lID0gJ29uJyArIHR5cGU7XG4gICAgICBpZiAodGhpc1tvbGRFdmVudE5hbWVdKSBkZWxldGUgdGhpc1tvbGRFdmVudE5hbWVdO1xuICAgICAgdGhpcy5fbGlzdGVuZXJzW3R5cGVdID0gW107XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICB9KTtcblxuICAvKipcbiAgICogQG1ldGhvZCBhZGRFdmVudExpc3RlbmVyXG4gICAqIHtAbGluayAjb259IOOBruOCqOOCpOODquOCouOCueOBp+OBmeOAglxuICAgKi9cbiAgLyoqXG4gICAqIEBtZXRob2QgcmVtb3ZlRXZlbnRMaXN0ZW5lclxuICAgKiB7QGxpbmsgI29mZn0g44Gu44Ko44Kk44Oq44Ki44K544Gn44GZ44CCXG4gICAqL1xuICAvKipcbiAgICogQG1ldGhvZCBjbGVhckV2ZW50TGlzdGVuZXJcbiAgICoge0BsaW5rICNjbGVhcn0g44Gu44Ko44Kk44Oq44Ki44K544Gn44GZ44CCXG4gICAqL1xuICAvKipcbiAgICogQG1ldGhvZCBoYXNFdmVudExpc3RlbmVyXG4gICAqIHtAbGluayAjaGFzfSDjga7jgqjjgqTjg6rjgqLjgrnjgafjgZnjgIJcbiAgICovXG4gIC8qKlxuICAgKiBAbWV0aG9kIGRpc3BhdGNoRXZlbnRcbiAgICoge0BsaW5rICNmaXJlfSDjga7jgqjjgqTjg6rjgqLjgrnjgafjgZnjgIJcbiAgICovXG4gIC8qKlxuICAgKiBAbWV0aG9kIGRpc3BhdGNoRXZlbnRCeVR5cGVcbiAgICoge0BsaW5rICNmbGFyZX0g44Gu44Ko44Kk44Oq44Ki44K544Gn44GZ44CCXG4gICAqL1xuICAoZnVuY3Rpb24oKSB7XG4gICAgdmFyIG1ldGhvZE1hcCA9IHtcbiAgICAgIGFkZEV2ZW50TGlzdGVuZXI6ICdvbicsXG4gICAgICByZW1vdmVFdmVudExpc3RlbmVyOiAnb2ZmJyxcbiAgICAgIGNsZWFyRXZlbnRMaXN0ZW5lcjogJ2NsZWFyJyxcbiAgICAgIGhhc0V2ZW50TGlzdGVuZXI6ICdoYXMnLFxuICAgICAgZGlzcGF0Y2hFdmVudDogJ2ZpcmUnLFxuICAgICAgZGlzcGF0Y2hFdmVudEJ5VHlwZTogJ2ZsYXJlJyxcbiAgICB9O1xuICAgIG1ldGhvZE1hcC5mb3JJbihmdW5jdGlvbihvbGQsIG5hbWUpIHtcbiAgICAgIHBoaW5hLnV0aWwuRXZlbnREaXNwYXRjaGVyLnByb3RvdHlwZS4kbWV0aG9kKG9sZCwgcGhpbmEudXRpbC5FdmVudERpc3BhdGNoZXIucHJvdG90eXBlW25hbWVdKTtcbiAgICB9KTtcbiAgfSkoKTtcblxufSk7XG5cblxuOyhmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLnV0aWwuVHdlZW5cbiAgICogQGV4dGVuZHMgcGhpbmEudXRpbC5FdmVudERpc3BhdGNoZXJcbiAgICogXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLnV0aWwuVHdlZW4nLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLnV0aWwuRXZlbnREaXNwYXRjaGVyJyxcblxuICAgIC8qKlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGluaXQ6IGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgdGhpcy5zdXBlckluaXQoKTtcblxuICAgICAgdGhpcy50aW1lID0gMDtcbiAgICB9LFxuXG4gICAgZnJvbVRvOiBmdW5jdGlvbih0YXJnZXQsIGJlZ2luUHJvcHMsIGZpbmlzaFByb3BzLCBkdXJhdGlvbiwgZWFzaW5nKSB7XG4gICAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcbiAgICAgIHRoaXMuYmVnaW5Qcm9wcyA9IGJlZ2luUHJvcHM7XG4gICAgICB0aGlzLmZpbmlzaFByb3BzID0gZmluaXNoUHJvcHM7XG4gICAgICB0aGlzLmR1cmF0aW9uID0gZHVyYXRpb24gfHwgMTAwMDtcbiAgICAgIHRoaXMuZWFzaW5nID0gZWFzaW5nO1xuXG4gICAgICAvLyBzZXR1cFxuICAgICAgdGhpcy5jaGFuZ2VQcm9wcyA9IHt9O1xuICAgICAgZm9yICh2YXIga2V5IGluIGJlZ2luUHJvcHMpIHtcbiAgICAgICAgICB0aGlzLmNoYW5nZVByb3BzW2tleV0gPSBmaW5pc2hQcm9wc1trZXldIC0gYmVnaW5Qcm9wc1trZXldO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgdG86IGZ1bmN0aW9uKHRhcmdldCwgZmluaXNoUHJvcHMsIGR1cmF0aW9uLCBlYXNpbmcpIHtcbiAgICAgIHZhciBiZWdpblByb3BzID0ge307XG5cbiAgICAgIGZvciAodmFyIGtleSBpbiBmaW5pc2hQcm9wcykge1xuICAgICAgICBiZWdpblByb3BzW2tleV0gPSB0YXJnZXRba2V5XTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5mcm9tVG8odGFyZ2V0LCBiZWdpblByb3BzLCBmaW5pc2hQcm9wcywgZHVyYXRpb24sIGVhc2luZyk7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBmcm9tOiBmdW5jdGlvbih0YXJnZXQsIGJlZ2luUHJvcHMsIGR1cmF0aW9uLCBlYXNpbmcpIHtcbiAgICAgICAgdmFyIGZpbmlzaFByb3BzID0ge307XG5cbiAgICAgICAgZm9yICh2YXIga2V5IGluIGJlZ2luUHJvcHMpIHtcbiAgICAgICAgICBmaW5pc2hQcm9wc1trZXldID0gdGFyZ2V0W2tleV07XG4gICAgICAgICAgdGFyZ2V0W2tleV0gPSBiZWdpblByb3BzW2tleV07XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmZyb21Ubyh0YXJnZXQsIGJlZ2luUHJvcHMsIGZpbmlzaFByb3BzLCBkdXJhdGlvbiwgZWFzaW5nKTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgYnk6IGZ1bmN0aW9uKHRhcmdldCwgcHJvcHMsIGR1cmF0aW9uLCBlYXNpbmcpIHtcbiAgICAgIHZhciBiZWdpblByb3BzID0ge307XG4gICAgICB2YXIgZmluaXNoUHJvcHMgPSB7fTtcblxuICAgICAgZm9yICh2YXIga2V5IGluIHByb3BzKSB7XG4gICAgICAgIGJlZ2luUHJvcHNba2V5XSA9IHRhcmdldFtrZXldO1xuICAgICAgICBmaW5pc2hQcm9wc1trZXldID0gdGFyZ2V0W2tleV0gKyBwcm9wc1trZXldO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmZyb21Ubyh0YXJnZXQsIGJlZ2luUHJvcHMsIGZpbmlzaFByb3BzLCBkdXJhdGlvbiwgZWFzaW5nKTtcblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIHlveW86IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHRlbXAgPSB0aGlzLmJlZ2luUHJvcHM7XG4gICAgICB0aGlzLmJlZ2luUHJvcHMgPSB0aGlzLmZpbmlzaFByb3BzO1xuICAgICAgdGhpcy5maW5pc2hQcm9wcyA9IHRlbXA7XG4gICAgICB0aGlzLmNoYW5nZVByb3BzLmZvckluKGZ1bmN0aW9uKGtleSwgdmFsdWUsIGluZGV4KSB7XG4gICAgICAgIHRoaXMuY2hhbmdlUHJvcHNba2V5XSA9IC12YWx1ZTtcbiAgICAgICAgdGhpcy50YXJnZXRba2V5XSA9IHRoaXMuYmVnaW5Qcm9wc1trZXldO1xuICAgICAgfSwgdGhpcyk7XG4gICAgICAvLyBUT0RPOiBlYXNpbmcg44KC5Y+N6Lui44GV44Gb44KLXG4gICAgICAvLyB0aGlzLmVhc2luZyA9IGVhc2luZztcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBnYWluOiBmdW5jdGlvbih0aW1lKSB7XG4gICAgICB0aGlzLnNlZWsodGhpcy50aW1lICsgdGltZSk7XG4gICAgfSxcbiAgICBmb3J3YXJkOiBmdW5jdGlvbih0aW1lKSB7XG4gICAgICB0aGlzLnNlZWsodGhpcy50aW1lICsgdGltZSk7XG4gICAgfSxcblxuICAgIGJhY2t3YXJkOiBmdW5jdGlvbih0aW1lKSB7XG4gICAgICB0aGlzLnNlZWsodGhpcy50aW1lIC0gdGltZSk7XG4gICAgfSxcblxuICAgIHNlZWs6IGZ1bmN0aW9uKHRpbWUpIHtcbiAgICAgIHRoaXMudGltZSA9IE1hdGguY2xhbXAodGltZSwgMCwgdGhpcy5kdXJhdGlvbik7XG5cbiAgICAgIHRoaXMuYmVnaW5Qcm9wcy5mb3JJbihmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgIHZhciB2ID0gdGhpcy5lYXNpbmcodGhpcy50aW1lLCB2YWx1ZSwgdGhpcy5jaGFuZ2VQcm9wc1trZXldLCB0aGlzLmR1cmF0aW9uKTtcbiAgICAgICAgdGhpcy50YXJnZXRba2V5XSA9IHY7XG4gICAgICB9LCB0aGlzKTtcblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIF9hY2Nlc3Nvcjoge1xuICAgICAgZWFzaW5nOiB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuX2Vhc2luZztcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbih2KSB7XG4gICAgICAgICAgdGhpcy5fZWFzaW5nID0gcGhpbmEudXRpbC5Ud2Vlbi5FQVNJTkdbdl0gfHwgcGhpbmEudXRpbC5Ud2Vlbi5FQVNJTkcuZGVmYXVsdDtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcblxuICAgIF9zdGF0aWM6IHtcbiAgICAgIC8qKlxuICAgICAgICogQHN0YXRpY1xuICAgICAgICog44Kk44O844K444Oz44KwXG4gICAgICAgKiAjIyMgUmVmZXJlbmNlXG4gICAgICAgKiAtIDxodHRwOi8vY29kZXJlcG9zLm9yZy9zaGFyZS93aWtpL0pTVHdlZW5lcj5cbiAgICAgICAqIC0gPGh0dHA6Ly9jb2RlcmVwb3Mub3JnL3NoYXJlL2Jyb3dzZXIvbGFuZy9qYXZhc2NyaXB0L2pzdHdlZW5lci90cnVuay9zcmMvSlNUd2VlbmVyLmpzPlxuICAgICAgICogLSA8aHR0cDovL2dzZ2QuY28udWsvc2FuZGJveC9qcXVlcnkvZWFzaW5nL2pxdWVyeS5lYXNpbmcuMS4zLmpzPlxuICAgICAgICogLSA8aHR0cDovL2hvc3RlZC56ZWguY29tLmJyL3R3ZWVuZXIvZG9jcy9lbi11cy9taXNjL3RyYW5zaXRpb25zLmh0bWw+XG4gICAgICAgKi9cbiAgICAgIEVBU0lORzoge1xuXG4gICAgICAgIC8qKiBkZWZhdWx0ICovXG4gICAgICAgIFwiZGVmYXVsdFwiOiBmdW5jdGlvbih0LCBiLCBjLCBkKSB7XG4gICAgICAgICAgcmV0dXJuIGMqdC9kICsgYjtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqIGxpbmVhciAqL1xuICAgICAgICBsaW5lYXI6IGZ1bmN0aW9uKHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICByZXR1cm4gYyp0L2QgKyBiO1xuICAgICAgICB9LFxuICAgICAgICAvKiogc3dpbmcgKi9cbiAgICAgICAgc3dpbmc6IGZ1bmN0aW9uKHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICByZXR1cm4gLWMgKih0Lz1kKSoodC0yKSArIGI7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKiBlYXNlSW5RdWFkICovXG4gICAgICAgIGVhc2VJblF1YWQ6IGZ1bmN0aW9uKHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICByZXR1cm4gYyoodC89ZCkqdCArIGI7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKiBlYXNlT3V0UXVhZCAqL1xuICAgICAgICBlYXNlT3V0UXVhZDogZnVuY3Rpb24odCwgYiwgYywgZCkge1xuICAgICAgICAgIHJldHVybiAtYyAqKHQvPWQpKih0LTIpICsgYjtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqIGVhc2VJbk91dFF1YWQgKi9cbiAgICAgICAgZWFzZUluT3V0UXVhZDogZnVuY3Rpb24odCwgYiwgYywgZCkge1xuICAgICAgICAgIGlmKCh0Lz1kLzIpIDwgMSkgcmV0dXJuIGMvMip0KnQgKyBiO1xuICAgICAgICAgIHJldHVybiAtYy8yICooKC0tdCkqKHQtMikgLSAxKSArIGI7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKiBkZWZlSW5DdWJpYyAqL1xuICAgICAgICBlYXNlSW5DdWJpYzogZnVuY3Rpb24odCwgYiwgYywgZCkge1xuICAgICAgICAgIHJldHVybiBjKih0Lz1kKSp0KnQgKyBiO1xuICAgICAgICB9LFxuICAgICAgICAvKiogZWFzZU91dEN1YmljICovXG4gICAgICAgIGVhc2VPdXRDdWJpYzogZnVuY3Rpb24odCwgYiwgYywgZCkge1xuICAgICAgICAgIHJldHVybiBjKigodD10L2QtMSkqdCp0ICsgMSkgKyBiO1xuICAgICAgICB9LFxuICAgICAgICAvKiogZWFzZUluT3V0Q3ViaWMgKi9cbiAgICAgICAgZWFzZUluT3V0Q3ViaWM6IGZ1bmN0aW9uKHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICBpZigodC89ZC8yKSA8IDEpIHJldHVybiBjLzIqdCp0KnQgKyBiO1xuICAgICAgICAgIHJldHVybiBjLzIqKCh0LT0yKSp0KnQgKyAyKSArIGI7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKiBlYXNlT3V0SW5DdWJpYyAqL1xuICAgICAgICBlYXNlT3V0SW5DdWJpYzogZnVuY3Rpb24odCwgYiwgYywgZCkge1xuICAgICAgICAgIGlmKHQgPCBkLzIpIHJldHVybiBwaGluYS51dGlsLlR3ZWVuLkVBU0lORy5lYXNlT3V0Q3ViaWModCoyLCBiLCBjLzIsIGQpO1xuICAgICAgICAgIHJldHVybiBwaGluYS51dGlsLlR3ZWVuLkVBU0lORy5lYXNlSW5DdWJpYygodCoyKS1kLCBiK2MvMiwgYy8yLCBkKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqIGVhc2VJblF1YXJ0ICovXG4gICAgICAgIGVhc2VJblF1YXJ0OiBmdW5jdGlvbih0LCBiLCBjLCBkKSB7XG4gICAgICAgICAgcmV0dXJuIGMqKHQvPWQpKnQqdCp0ICsgYjtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqIGVhc2VPdXRRdWFydCAqL1xuICAgICAgICBlYXNlT3V0UXVhcnQ6IGZ1bmN0aW9uKHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICByZXR1cm4gLWMgKigodD10L2QtMSkqdCp0KnQgLSAxKSArIGI7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKiBlYXNlSW5PdXRRdWFydCAqL1xuICAgICAgICBlYXNlSW5PdXRRdWFydDogZnVuY3Rpb24odCwgYiwgYywgZCkge1xuICAgICAgICAgIGlmKCh0Lz1kLzIpIDwgMSkgcmV0dXJuIGMvMip0KnQqdCp0ICsgYjtcbiAgICAgICAgICByZXR1cm4gLWMvMiAqKCh0LT0yKSp0KnQqdCAtIDIpICsgYjtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqIGVhc2VPdXRJblF1YXJ0ICovXG4gICAgICAgIGVhc2VPdXRJblF1YXJ0OiBmdW5jdGlvbih0LCBiLCBjLCBkKSB7XG4gICAgICAgICAgaWYodCA8IGQvMikgcmV0dXJuIHBoaW5hLnV0aWwuVHdlZW4uRUFTSU5HLmVhc2VPdXRRdWFydCh0KjIsIGIsIGMvMiwgZCk7XG4gICAgICAgICAgcmV0dXJuIHBoaW5hLnV0aWwuVHdlZW4uRUFTSU5HLmVhc2VJblF1YXJ0KCh0KjIpLWQsIGIrYy8yLCBjLzIsIGQpO1xuICAgICAgICB9LFxuICAgICAgICAvKiogZWFzZUluUXVpbnQgKi9cbiAgICAgICAgZWFzZUluUXVpbnQ6IGZ1bmN0aW9uKHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICByZXR1cm4gYyoodC89ZCkqdCp0KnQqdCArIGI7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKiBlYXNlT3V0UXVpbnQgKi9cbiAgICAgICAgZWFzZU91dFF1aW50OiBmdW5jdGlvbih0LCBiLCBjLCBkKSB7XG4gICAgICAgICAgcmV0dXJuIGMqKCh0PXQvZC0xKSp0KnQqdCp0ICsgMSkgKyBiO1xuICAgICAgICB9LFxuICAgICAgICAvKiogZWFzZUluT3V0UXVpbnQgKi9cbiAgICAgICAgZWFzZUluT3V0UXVpbnQ6IGZ1bmN0aW9uKHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICBpZigodC89ZC8yKSA8IDEpIHJldHVybiBjLzIqdCp0KnQqdCp0ICsgYjtcbiAgICAgICAgICByZXR1cm4gYy8yKigodC09MikqdCp0KnQqdCArIDIpICsgYjtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqIGVhc2VPdXRJblF1aW50ICovXG4gICAgICAgIGVhc2VPdXRJblF1aW50OiBmdW5jdGlvbih0LCBiLCBjLCBkKSB7XG4gICAgICAgICAgaWYodCA8IGQvMikgcmV0dXJuIHBoaW5hLnV0aWwuVHdlZW4uRUFTSU5HLmVhc2VPdXRRdWludCh0KjIsIGIsIGMvMiwgZCk7XG4gICAgICAgICAgcmV0dXJuIHBoaW5hLnV0aWwuVHdlZW4uRUFTSU5HLmVhc2VJblF1aW50KCh0KjIpLWQsIGIrYy8yLCBjLzIsIGQpO1xuICAgICAgICB9LFxuICAgICAgICAvKiogZWFzZUluU2luZSAqL1xuICAgICAgICBlYXNlSW5TaW5lOiBmdW5jdGlvbih0LCBiLCBjLCBkKSB7XG4gICAgICAgICAgcmV0dXJuIC1jICogTWF0aC5jb3ModC9kICooTWF0aC5QSS8yKSkgKyBjICsgYjtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqIGVhc2VPdXRTaW5lICovXG4gICAgICAgIGVhc2VPdXRTaW5lOiBmdW5jdGlvbih0LCBiLCBjLCBkKSB7XG4gICAgICAgICAgcmV0dXJuIGMgKiBNYXRoLnNpbih0L2QgKihNYXRoLlBJLzIpKSArIGI7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKiBlYXNlSW5PdXRTaW5lICovXG4gICAgICAgIGVhc2VJbk91dFNpbmU6IGZ1bmN0aW9uKHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICByZXR1cm4gLWMvMiAqKE1hdGguY29zKE1hdGguUEkqdC9kKSAtIDEpICsgYjtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqIGVhc2VPdXRJblNpbmUgKi9cbiAgICAgICAgZWFzZU91dEluU2luZTogZnVuY3Rpb24odCwgYiwgYywgZCkge1xuICAgICAgICAgIGlmKHQgPCBkLzIpIHJldHVybiBwaGluYS51dGlsLlR3ZWVuLkVBU0lORy5lYXNlT3V0U2luZSh0KjIsIGIsIGMvMiwgZCk7XG4gICAgICAgICAgcmV0dXJuIHBoaW5hLnV0aWwuVHdlZW4uRUFTSU5HLmVhc2VJblNpbmUoKHQqMiktZCwgYitjLzIsIGMvMiwgZCk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKiBlYXNlSW5FeHBvICovXG4gICAgICAgIGVhc2VJbkV4cG86IGZ1bmN0aW9uKHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICByZXR1cm4odD09MCkgPyBiIDogYyAqIE1hdGgucG93KDIsIDEwICoodC9kIC0gMSkpICsgYiAtIGMgKiAwLjAwMTtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqIGVhc2VPdXRFeHBvICovXG4gICAgICAgIGVhc2VPdXRFeHBvOiBmdW5jdGlvbih0LCBiLCBjLCBkKSB7XG4gICAgICAgICAgcmV0dXJuKHQ9PWQpID8gYitjIDogYyAqIDEuMDAxICooLU1hdGgucG93KDIsIC0xMCAqIHQvZCkgKyAxKSArIGI7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKiBlYXNlSW5PdXRFeHBvICovXG4gICAgICAgIGVhc2VJbk91dEV4cG86IGZ1bmN0aW9uKHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICBpZih0PT0wKSByZXR1cm4gYjtcbiAgICAgICAgICBpZih0PT1kKSByZXR1cm4gYitjO1xuICAgICAgICAgIGlmKCh0Lz1kLzIpIDwgMSkgcmV0dXJuIGMvMiAqIE1hdGgucG93KDIsIDEwICoodCAtIDEpKSArIGIgLSBjICogMC4wMDA1O1xuICAgICAgICAgIHJldHVybiBjLzIgKiAxLjAwMDUgKigtTWF0aC5wb3coMiwgLTEwICogLS10KSArIDIpICsgYjtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqIGVhc2VPdXRJbkV4cG8gKi9cbiAgICAgICAgZWFzZU91dEluRXhwbzogZnVuY3Rpb24odCwgYiwgYywgZCkge1xuICAgICAgICAgIGlmKHQgPCBkLzIpIHJldHVybiBwaGluYS51dGlsLlR3ZWVuLkVBU0lORy5lYXNlT3V0RXhwbyh0KjIsIGIsIGMvMiwgZCk7XG4gICAgICAgICAgcmV0dXJuIHBoaW5hLnV0aWwuVHdlZW4uRUFTSU5HLmVhc2VJbkV4cG8oKHQqMiktZCwgYitjLzIsIGMvMiwgZCk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKiBlYXNlSW5DaXJjICovXG4gICAgICAgIGVhc2VJbkNpcmM6IGZ1bmN0aW9uKHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICByZXR1cm4gLWMgKihNYXRoLnNxcnQoMSAtKHQvPWQpKnQpIC0gMSkgKyBiO1xuICAgICAgICB9LFxuICAgICAgICAvKiogZWFzZU91dENpcmMgKi9cbiAgICAgICAgZWFzZU91dENpcmM6IGZ1bmN0aW9uKHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICByZXR1cm4gYyAqIE1hdGguc3FydCgxIC0odD10L2QtMSkqdCkgKyBiO1xuICAgICAgICB9LFxuICAgICAgICAvKiogZWFzZUluT3V0Q2lyYyAqL1xuICAgICAgICBlYXNlSW5PdXRDaXJjOiBmdW5jdGlvbih0LCBiLCBjLCBkKSB7XG4gICAgICAgICAgaWYoKHQvPWQvMikgPCAxKSByZXR1cm4gLWMvMiAqKE1hdGguc3FydCgxIC0gdCp0KSAtIDEpICsgYjtcbiAgICAgICAgICByZXR1cm4gYy8yICooTWF0aC5zcXJ0KDEgLSh0LT0yKSp0KSArIDEpICsgYjtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqIGVhc2VPdXRJbkNpcmMgKi9cbiAgICAgICAgZWFzZU91dEluQ2lyYzogZnVuY3Rpb24odCwgYiwgYywgZCkge1xuICAgICAgICAgIGlmKHQgPCBkLzIpIHJldHVybiBwaGluYS51dGlsLlR3ZWVuLkVBU0lORy5lYXNlT3V0Q2lyYyh0KjIsIGIsIGMvMiwgZCk7XG4gICAgICAgICAgcmV0dXJuIHBoaW5hLnV0aWwuVHdlZW4uRUFTSU5HLmVhc2VJbkNpcmMoKHQqMiktZCwgYitjLzIsIGMvMiwgZCk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKiBlYXNlSW5FbGFzdGljICovXG4gICAgICAgIGVhc2VJbkVsYXN0aWM6IGZ1bmN0aW9uKHQsIGIsIGMsIGQsIGEsIHApIHtcbiAgICAgICAgICB2YXIgcztcbiAgICAgICAgICBpZih0PT0wKSByZXR1cm4gYjsgIGlmKCh0Lz1kKT09MSkgcmV0dXJuIGIrYzsgIGlmKCFwKSBwPWQqLjM7XG4gICAgICAgICAgaWYoIWEgfHwgYSA8IE1hdGguYWJzKGMpKSB7IGE9Yzsgcz1wLzQ7IH0gZWxzZSBzID0gcC8oMipNYXRoLlBJKSAqIE1hdGguYXNpbihjL2EpO1xuICAgICAgICAgIHJldHVybiAtKGEqTWF0aC5wb3coMiwxMCoodC09MSkpICogTWF0aC5zaW4oKHQqZC1zKSooMipNYXRoLlBJKS9wICkpICsgYjtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqIGVhc2VPdXRFbGFzdGljICovXG4gICAgICAgIGVhc2VPdXRFbGFzdGljOiBmdW5jdGlvbih0LCBiLCBjLCBkLCBhLCBwKSB7XG4gICAgICAgICAgdmFyIHM7XG4gICAgICAgICAgaWYodD09MCkgcmV0dXJuIGI7ICBpZigodC89ZCk9PTEpIHJldHVybiBiK2M7ICBpZighcCkgcD1kKi4zO1xuICAgICAgICAgIGlmKCFhIHx8IGEgPCBNYXRoLmFicyhjKSkgeyBhPWM7IHM9cC80OyB9IGVsc2UgcyA9IHAvKDIqTWF0aC5QSSkgKiBNYXRoLmFzaW4oYy9hKTtcbiAgICAgICAgICByZXR1cm4oYSpNYXRoLnBvdygyLC0xMCp0KSAqIE1hdGguc2luKCh0KmQtcykqKDIqTWF0aC5QSSkvcCApICsgYyArIGIpO1xuICAgICAgICB9LFxuICAgICAgICAvKiogZWFzZUluT3V0RWxhc3RpYyAqL1xuICAgICAgICBlYXNlSW5PdXRFbGFzdGljOiBmdW5jdGlvbih0LCBiLCBjLCBkLCBhLCBwKSB7XG4gICAgICAgICAgdmFyIHM7XG4gICAgICAgICAgaWYodD09MCkgcmV0dXJuIGI7ICBpZigodC89ZC8yKT09MikgcmV0dXJuIGIrYzsgIGlmKCFwKSBwPWQqKC4zKjEuNSk7XG4gICAgICAgICAgaWYoIWEgfHwgYSA8IE1hdGguYWJzKGMpKSB7IGE9Yzsgcz1wLzQ7IH0gICAgICAgZWxzZSBzID0gcC8oMipNYXRoLlBJKSAqIE1hdGguYXNpbihjL2EpO1xuICAgICAgICAgIGlmKHQgPCAxKSByZXR1cm4gLS41KihhKk1hdGgucG93KDIsMTAqKHQtPTEpKSAqIE1hdGguc2luKCh0KmQtcykqKDIqTWF0aC5QSSkvcCApKSArIGI7XG4gICAgICAgICAgcmV0dXJuIGEqTWF0aC5wb3coMiwtMTAqKHQtPTEpKSAqIE1hdGguc2luKCh0KmQtcykqKDIqTWF0aC5QSSkvcCApKi41ICsgYyArIGI7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKiBlYXNlT3V0SW5FbGFzdGljICovXG4gICAgICAgIGVhc2VPdXRJbkVsYXN0aWM6IGZ1bmN0aW9uKHQsIGIsIGMsIGQsIGEsIHApIHtcbiAgICAgICAgICBpZih0IDwgZC8yKSByZXR1cm4gcGhpbmEudXRpbC5Ud2Vlbi5FQVNJTkcuZWFzZU91dEVsYXN0aWModCoyLCBiLCBjLzIsIGQsIGEsIHApO1xuICAgICAgICAgIHJldHVybiBwaGluYS51dGlsLlR3ZWVuLkVBU0lORy5lYXNlSW5FbGFzdGljKCh0KjIpLWQsIGIrYy8yLCBjLzIsIGQsIGEsIHApO1xuICAgICAgICB9LFxuICAgICAgICAvKiogZWFzZUluQmFjayAqL1xuICAgICAgICBlYXNlSW5CYWNrOiBmdW5jdGlvbih0LCBiLCBjLCBkLCBzKSB7XG4gICAgICAgICAgaWYocyA9PSB1bmRlZmluZWQpIHMgPSAxLjcwMTU4O1xuICAgICAgICAgIHJldHVybiBjKih0Lz1kKSp0KigocysxKSp0IC0gcykgKyBiO1xuICAgICAgICB9LFxuICAgICAgICAvKiogZWFzZU91dEJhY2sgKi9cbiAgICAgICAgZWFzZU91dEJhY2s6IGZ1bmN0aW9uKHQsIGIsIGMsIGQsIHMpIHtcbiAgICAgICAgICBpZihzID09IHVuZGVmaW5lZCkgcyA9IDEuNzAxNTg7XG4gICAgICAgICAgcmV0dXJuIGMqKCh0PXQvZC0xKSp0KigocysxKSp0ICsgcykgKyAxKSArIGI7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKiBlYXNlSW5PdXRCYWNrICovXG4gICAgICAgIGVhc2VJbk91dEJhY2s6IGZ1bmN0aW9uKHQsIGIsIGMsIGQsIHMpIHtcbiAgICAgICAgICBpZihzID09IHVuZGVmaW5lZCkgcyA9IDEuNzAxNTg7XG4gICAgICAgICAgaWYoKHQvPWQvMikgPCAxKSByZXR1cm4gYy8yKih0KnQqKCgocyo9KDEuNTI1KSkrMSkqdCAtIHMpKSArIGI7XG4gICAgICAgICAgcmV0dXJuIGMvMiooKHQtPTIpKnQqKCgocyo9KDEuNTI1KSkrMSkqdCArIHMpICsgMikgKyBiO1xuICAgICAgICB9LFxuICAgICAgICAvKiogZWFzZU91dEluQmFjayAqL1xuICAgICAgICBlYXNlT3V0SW5CYWNrOiBmdW5jdGlvbih0LCBiLCBjLCBkLCBzKSB7XG4gICAgICAgICAgaWYodCA8IGQvMikgcmV0dXJuIHBoaW5hLnV0aWwuVHdlZW4uRUFTSU5HLmVhc2VPdXRCYWNrKHQqMiwgYiwgYy8yLCBkLCBzKTtcbiAgICAgICAgICByZXR1cm4gcGhpbmEudXRpbC5Ud2Vlbi5FQVNJTkcuZWFzZUluQmFjaygodCoyKS1kLCBiK2MvMiwgYy8yLCBkLCBzKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqIGVhc2VJbkJvdW5jZSAqL1xuICAgICAgICBlYXNlSW5Cb3VuY2U6IGZ1bmN0aW9uKHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICByZXR1cm4gYyAtIHBoaW5hLnV0aWwuVHdlZW4uRUFTSU5HLmVhc2VPdXRCb3VuY2UoZC10LCAwLCBjLCBkKSArIGI7XG4gICAgICAgIH0sXG4gICAgICAgIC8qKiBlYXNlT3V0Qm91bmNlICovXG4gICAgICAgIGVhc2VPdXRCb3VuY2U6IGZ1bmN0aW9uKHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICBpZigodC89ZCkgPCgxLzIuNzUpKSB7XG4gICAgICAgICAgICByZXR1cm4gYyooNy41NjI1KnQqdCkgKyBiO1xuICAgICAgICAgIH0gZWxzZSBpZih0IDwoMi8yLjc1KSkge1xuICAgICAgICAgICAgcmV0dXJuIGMqKDcuNTYyNSoodC09KDEuNS8yLjc1KSkqdCArIC43NSkgKyBiO1xuICAgICAgICAgIH0gZWxzZSBpZih0IDwoMi41LzIuNzUpKSB7XG4gICAgICAgICAgICByZXR1cm4gYyooNy41NjI1Kih0LT0oMi4yNS8yLjc1KSkqdCArIC45Mzc1KSArIGI7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBjKig3LjU2MjUqKHQtPSgyLjYyNS8yLjc1KSkqdCArIC45ODQzNzUpICsgYjtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIC8qKiBlYXNlSW5PdXRCb3VuY2UgKi9cbiAgICAgICAgZWFzZUluT3V0Qm91bmNlOiBmdW5jdGlvbih0LCBiLCBjLCBkKSB7XG4gICAgICAgICAgaWYodCA8IGQvMikgcmV0dXJuIHBoaW5hLnV0aWwuVHdlZW4uRUFTSU5HLmVhc2VJbkJvdW5jZSh0KjIsIDAsIGMsIGQpICogLjUgKyBiO1xuICAgICAgICAgIGVsc2UgcmV0dXJuIHBoaW5hLnV0aWwuVHdlZW4uRUFTSU5HLmVhc2VPdXRCb3VuY2UodCoyLWQsIDAsIGMsIGQpICogLjUgKyBjKi41ICsgYjtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqIGVhc2VPdXRJbkJvdW5jZSAqL1xuICAgICAgICBlYXNlT3V0SW5Cb3VuY2U6IGZ1bmN0aW9uKHQsIGIsIGMsIGQpIHtcbiAgICAgICAgICBpZih0IDwgZC8yKSByZXR1cm4gcGhpbmEudXRpbC5Ud2Vlbi5FQVNJTkcuZWFzZU91dEJvdW5jZSh0KjIsIGIsIGMvMiwgZCk7XG4gICAgICAgICAgcmV0dXJuIHBoaW5hLnV0aWwuVHdlZW4uRUFTSU5HLmVhc2VJbkJvdW5jZSgodCoyKS1kLCBiK2MvMiwgYy8yLCBkKTtcbiAgICAgICAgfVxuXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG59KSgpO1xuXG5cblxuOyhmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLnV0aWwuVGlja2VyXG4gICAqIHRpY2sgbWFuYWdlbWVudCBjbGFzc1xuICAgKiBAZXh0ZW5kcyBwaGluYS51dGlsLkV2ZW50RGlzcGF0Y2hlclxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS51dGlsLlRpY2tlcicsIHtcbiAgICBzdXBlckNsYXNzOiAncGhpbmEudXRpbC5FdmVudERpc3BhdGNoZXInLFxuXG4gICAgLyoqIOe1jOmBjuODleODrOODvOODoOaVsCAqL1xuICAgIGZyYW1lOiBudWxsLFxuICAgIC8qKiAx44OV44Os44O844Og44Gu57WM6YGO5pmC6ZaTICovXG4gICAgZGVsdGFUaW1lOiBudWxsLFxuICAgIC8qKiDlhajkvZPjga7ntYzpgY7mmYLplpMgKi9cbiAgICBlbGFwc2VkVGltZTogbnVsbCxcblxuICAgIC8qKlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5zdXBlckluaXQoKTtcblxuICAgICAgdGhpcy5mcHMgPSAzMDtcbiAgICAgIHRoaXMuZnJhbWUgPSAwO1xuICAgICAgdGhpcy5kZWx0YVRpbWUgPSAwO1xuICAgICAgdGhpcy5lbGFwc2VkVGltZSA9IDA7XG4gICAgICB0aGlzLmlzUGxheWluZyA9IHRydWU7XG4gICAgICB0aGlzLnJ1bm5lciA9IHBoaW5hLnV0aWwuVGlja2VyLnJ1bm5lcjtcbiAgICB9LFxuXG4gICAgdGljazogZnVuY3Rpb24oZnVuYykge1xuICAgICAgdGhpcy5vbigndGljaycsIGZ1bmMpO1xuICAgIH0sXG5cbiAgICB1bnRpY2s6IGZ1bmN0aW9uKGZ1bmMpIHtcbiAgICAgIHRoaXMub2ZmKCd0aWNrJywgZnVuYyk7XG4gICAgfSxcblxuICAgIHJ1bjogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgbm93ID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKTtcbiAgICAgIC8vIDHjg5Xjg6zjg7zjg6DjgavmjpvjgYvjgaPjgZ/mmYLplpNcbiAgICAgIHRoaXMuZGVsdGFUaW1lID0gbm93IC0gdGhpcy5jdXJyZW50VGltZTtcbiAgICAgIC8vIOWFqOS9k+OBrue1jOmBjuaZgumWk1xuICAgICAgdGhpcy5lbGFwc2VkVGltZSA9IG5vdyAtIHRoaXMuc3RhcnRUaW1lO1xuXG4gICAgICB2YXIgc3RhcnQgPSB0aGlzLmN1cnJlbnRUaW1lID0gbm93O1xuICAgICAgdGhpcy5mbGFyZSgndGljaycpO1xuICAgICAgdmFyIGVuZCA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7XG5cbiAgICAgIC8vIOODleODrOODvOODoOOCkuabtOaWsFxuICAgICAgdGhpcy5mcmFtZSArPSAxO1xuXG4gICAgICAvLyBjYWxjdWxhdGUgZWxhcHNlZCB0aW1lXG4gICAgICB2YXIgZWxhcHNlZCA9IGVuZC1zdGFydDtcblxuICAgICAgLy8gY2FsY3VsYXRlIG5leHQgd2FpdGluZyB0aW1lXG4gICAgICB2YXIgZGVsYXkgPSBNYXRoLm1heCh0aGlzLmZyYW1lVGltZS1lbGFwc2VkLCAwKTtcblxuICAgICAgcmV0dXJuIGRlbGF5O1xuICAgIH0sXG5cbiAgICBzdGFydDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICB0aGlzLmlzUGxheWluZyA9IHRydWU7XG4gICAgICB0aGlzLnN0YXJ0VGltZSA9IHRoaXMuY3VycmVudFRpbWUgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpO1xuICAgICAgdmFyIGZuID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChzZWxmLmlzUGxheWluZykge1xuICAgICAgICAgIHZhciBkZWxheSA9IHNlbGYucnVuKCk7XG4gICAgICAgICAgc2VsZi5ydW5uZXIoZm4sIGRlbGF5KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGZuKCk7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICByZXN1bWU6IGZ1bmN0aW9uKCkge1xuICAgICAgLy8gVE9ETzogXG4gICAgfSxcblxuICAgIHN0b3A6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5pc1BsYXlpbmcgPSBmYWxzZTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICByZXdpbmQ6IGZ1bmN0aW9uKCkge1xuICAgICAgLy8gVE9ETzogXG4gICAgfSxcblxuICAgIF9hY2Nlc3Nvcjoge1xuICAgICAgZnBzOiB7XG4gICAgICAgIFwiZ2V0XCI6IGZ1bmN0aW9uKCkgICB7IHJldHVybiB0aGlzLl9mcHM7IH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKHYpICB7XG4gICAgICAgICAgdGhpcy5fZnBzID0gdjtcbiAgICAgICAgICB0aGlzLmZyYW1lVGltZSA9IDEwMDAvdGhpcy5fZnBzO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICAgIFxuICAgIF9zdGF0aWM6IHtcbiAgICAgIHJ1bm5lcjogZnVuY3Rpb24ocnVuLCBkZWxheSkge1xuICAgICAgICBzZXRUaW1lb3V0KHJ1biwgZGVsYXkpO1xuICAgICAgfSxcbiAgICB9LFxuICAgIFxuICB9KTtcblxufSkoKTtcblxuOyhmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLnV0aWwuR3JpZFxuICAgKiB0aWNrIG1hbmFnZW1lbnQgY2xhc3NcbiAgICovXG4gIHBoaW5hLmRlZmluZSgncGhpbmEudXRpbC5HcmlkJywge1xuXG4gICAgLyoqIOW5hSAqL1xuICAgIHdpZHRoOiA2NDAsXG4gICAgLyoqIOWIl+aVsCAqL1xuICAgIGNvbHVtbnM6IDEyLFxuICAgIC8qKiDjg6vjg7zjg5cgKi9cbiAgICBsb29wOiBmYWxzZSxcbiAgICAvKiog44Kq44OV44K744OD44OI5YCkICovXG4gICAgb2Zmc2V0OiAwLFxuXG4gICAgLyoqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodHlwZW9mIGFyZ3VtZW50c1swXSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgdmFyIHBhcmFtID0gYXJndW1lbnRzWzBdO1xuICAgICAgICB2YXIgd2lkdGggPSBwYXJhbS53aWR0aCB8fCA2NDA7XG4gICAgICAgIHZhciBjb2x1bW5zID0gcGFyYW0uY29sdW1ucyB8fCAxMjtcbiAgICAgICAgdmFyIGxvb3AgPSBwYXJhbS5sb29wIHx8IGZhbHNlO1xuICAgICAgICB2YXIgb2Zmc2V0ID0gcGFyYW0ub2Zmc2V0IHx8IDA7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdmFyIHdpZHRoICAgPSBhcmd1bWVudHNbMF0gfHwgNjQwO1xuICAgICAgICB2YXIgY29sdW1ucyA9IGFyZ3VtZW50c1sxXSB8fCAxMjtcbiAgICAgICAgdmFyIGxvb3AgICAgPSBhcmd1bWVudHNbMl0gfHwgZmFsc2U7XG4gICAgICAgIHZhciBvZmZzZXQgPSBhcmd1bWVudHNbM10gfHwgMDtcbiAgICAgIH1cblxuICAgICAgdGhpcy53aWR0aCA9IHdpZHRoO1xuICAgICAgdGhpcy5jb2x1bW5zID0gY29sdW1ucztcbiAgICAgIHRoaXMubG9vcCA9IGxvb3A7XG4gICAgICB0aGlzLm9mZnNldCA9IG9mZnNldDtcbiAgICAgIHRoaXMudW5pdFdpZHRoID0gdGhpcy53aWR0aC90aGlzLmNvbHVtbnM7XG4gICAgfSxcblxuICAgIC8vIOOCueODkeODs+aMh+WumuOBp+WApOOCkuWPluW+lyjosqDmlbDjgoJvaylcbiAgICBzcGFuOiBmdW5jdGlvbihpbmRleCkge1xuICAgICAgaWYgKHRoaXMubG9vcCkge1xuICAgICAgICBpbmRleCArPSB0aGlzLmNvbHVtbnM7XG4gICAgICAgIGluZGV4ICU9IHRoaXMuY29sdW1ucztcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLnVuaXRXaWR0aCAqIGluZGV4ICsgdGhpcy5vZmZzZXQ7XG4gICAgfSxcblxuICAgIC8vXG4gICAgdW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy51bml0V2lkdGg7XG4gICAgfSxcblxuICAgIGNlbnRlcjogZnVuY3Rpb24ob2Zmc2V0KSB7XG4gICAgICB2YXIgaW5kZXggPSBvZmZzZXQgfHwgMDtcbiAgICAgIHJldHVybiAodGhpcy53aWR0aC8yKSArICh0aGlzLnVuaXRXaWR0aCAqIGluZGV4KTtcbiAgICB9LFxuXG4gIH0pO1xuXG59KSgpO1xuXG5cblxuLy8g55uj6KaW44Kq44OW44K444Kn44Kv44OIXG4vLyByZWdpc3RlciDjgacga2V5IOOCkueZu+mMsiAo44OH44OV44Kp44Or44OI5YCk44KC5LiA57eS44Gr77yfKVxuLy8gZXZlbnQgZGlzcGF0Y2hlciDjgpLntpnmib9cbi8vIGV2ZW50IGRpc3BhdGNoZXIg44Gj44GmIHV0aWwg44GY44KD44Gt77yfXG4vLyByZWdpc3RlciDjgafnmbvpjLLjgZfjgZ/lgKTjgpLlpInmm7TjgZfjgZ/jgokgY2hhbmdlIOOCpOODmeODs+ODiOOBjOi1sOOCi1xuXG5cbi8vIOWQjeWJjeWAmeijnFxuLy8gIG1pZGRsZW1hbijku7Lnq4vkuropXG5cblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEudXRpbC5DaGFuZ2VEaXNwYXRjaGVyXG4gICAqIEBleHRlbmRzIHBoaW5hLnV0aWwuRXZlbnREaXNwYXRjaGVyXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLnV0aWwuQ2hhbmdlRGlzcGF0Y2hlcicsIHtcbiAgICBzdXBlckNsYXNzOiAncGhpbmEudXRpbC5FdmVudERpc3BhdGNoZXInLFxuXG4gICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnN1cGVySW5pdCgpO1xuXG4gICAgICB0aGlzLl9vYnNlcnZlID0gdHJ1ZTtcbiAgICB9LFxuXG4gICAgcmVnaXN0ZXI6IGZ1bmN0aW9uKGtleSwgZGVmYXVsdFZhbHVlKSB7XG4gICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICB2YXIgb2JqID0gYXJndW1lbnRzWzBdO1xuICAgICAgICBvYmouZm9ySW4oZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuICAgICAgICAgIHRoaXMucmVnaXN0ZXIoa2V5LCB2YWx1ZSk7XG4gICAgICAgIH0sIHRoaXMpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHZhciB0ZW1wS2V5ID0gJ19fJyArIGtleTtcbiAgICAgICAgdGhpc1t0ZW1wS2V5XSA9IGRlZmF1bHRWYWx1ZTtcbiAgICAgICAgdGhpcy5hY2Nlc3NvcihrZXksIHtcbiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXNbdGVtcEtleV07XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgICAgIHRoaXNbdGVtcEtleV0gPSB2O1xuICAgICAgICAgICAgaWYgKHRoaXMuX29ic2VydmUpIHtcbiAgICAgICAgICAgICAgdGhpcy5mbGFyZSgnY2hhbmdlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgb2JzZXJ2ZTogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLl9vYnNlcnZlID0gdHJ1ZTtcbiAgICB9LFxuICAgIHVub2JzZXJ2ZTogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLl9vYnNlcnZlID0gZmFsc2U7XG4gICAgfSxcbiAgfSk7XG5cbn0pO1xuXG47KGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEudXRpbC5GbG93XG4gICAqIHRpY2sgbWFuYWdlbWVudCBjbGFzc1xuICAgKiBAZXh0ZW5kcyBwaGluYS51dGlsLkV2ZW50RGlzcGF0Y2hlclxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS51dGlsLkZsb3cnLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLnV0aWwuRXZlbnREaXNwYXRjaGVyJyxcblxuICAgIC8qKlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGluaXQ6IGZ1bmN0aW9uKGZ1bmMsIHdhaXQpIHtcbiAgICAgIHRoaXMuc3VwZXJJbml0KCk7XG5cbiAgICAgIHRoaXMuc3RhdHVzID0gJ3BlbmRpbmcnO1xuICAgICAgdGhpcy5yZXN1bHRWYWx1ZSA9IG51bGw7XG4gICAgICB0aGlzLl9xdWV1ZSA9IFtdO1xuICAgICAgdGhpcy5mdW5jID0gZnVuYztcblxuICAgICAgaWYgKHdhaXQgIT09IHRydWUpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICB2YXIgcmVzb2x2ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHNlbGYucmVzb2x2ZS5hcHBseShzZWxmLCBhcmd1bWVudHMpO1xuICAgICAgICAgIHNlbGYuc3RhdHVzID0gJ3Jlc29sdmVkJztcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHJlamVjdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHNlbGYucmVqZWN0LmFwcGx5KHNlbGYsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgc2VsZi5zdGF0dXMgPSAncmVqZWN0ZWQnO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuZnVuYyhyZXNvbHZlLCByZWplY3QpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKlxuICAgICAqIOaIkOWKn1xuICAgICAqL1xuICAgIHJlc29sdmU6IGZ1bmN0aW9uKGFyZykge1xuICAgICAgdGhpcy5yZXN1bHRWYWx1ZSA9IGFyZztcblxuICAgICAgLy8g44Kt44Ol44O844Gr56mN44G+44KM44Gf6Zai5pWw44KS5a6f6KGMXG4gICAgICB0aGlzLl9xdWV1ZS5lYWNoKGZ1bmN0aW9uKGZ1bmMpIHtcbiAgICAgICAgZnVuYyh0aGlzLnJlc3VsdFZhbHVlKTtcbiAgICAgIH0sIHRoaXMpO1xuICAgICAgdGhpcy5fcXVldWUuY2xlYXIoKTtcbiAgICB9LFxuXG4gICAgLypcbiAgICAgKiDlpLHmlZdcbiAgICAgKi9cbiAgICByZWplY3Q6IGZ1bmN0aW9uKCkge1xuXG4gICAgfSxcblxuICAgIC8qXG4gICAgICog6Z2e5ZCM5pyf57WC5LqG5pmC44Gu5Yem55CG44KS55m76YyyXG4gICAgICovXG4gICAgdGhlbjogZnVuY3Rpb24oZnVuYykge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgLy8g5oiQ5Yqf44K544OG44O844K/44K544Gg44Gj44Gf5aC05ZCI44Gv5Y2z5a6f6KGMXG4gICAgICBpZiAodGhpcy5zdGF0dXMgPT09ICdyZXNvbHZlZCcpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gZnVuYyh0aGlzLnJlc3VsdFZhbHVlKTtcbiAgICAgICAgcmV0dXJuIHBoaW5hLnV0aWwuRmxvdy5yZXNvbHZlKHZhbHVlKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB2YXIgZmxvdyA9IHBoaW5hLnV0aWwuRmxvdyhmdW5jdGlvbihyZXNvbHZlKSB7XG4gICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9LCB0cnVlKTtcblxuICAgICAgICB0aGlzLl9xdWV1ZS5wdXNoKGZ1bmN0aW9uKGFyZykge1xuICAgICAgICAgIHZhciByZXN1bHRWYWx1ZSA9IGZ1bmMoYXJnKTtcblxuICAgICAgICAgIGlmIChyZXN1bHRWYWx1ZSBpbnN0YW5jZW9mIHBoaW5hLnV0aWwuRmxvdykge1xuICAgICAgICAgICAgcmVzdWx0VmFsdWUudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgICBmbG93LnJlc29sdmUodmFsdWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZmxvdy5yZXNvbHZlKGFyZyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gZmxvdztcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX3N0YXRpYzoge1xuICAgICAgcmVzb2x2ZTogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgcGhpbmEudXRpbC5GbG93KSB7XG4gICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHZhciBmbG93ID0gcGhpbmEudXRpbC5GbG93KGZ1bmN0aW9uKHJlc29sdmUpIHtcbiAgICAgICAgICAgIHJlc29sdmUodmFsdWUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBmbG93O1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgYWxsOiBmdW5jdGlvbihmbG93cykge1xuICAgICAgICByZXR1cm4gcGhpbmEudXRpbC5GbG93KGZ1bmN0aW9uKHJlc29sdmUpIHtcbiAgICAgICAgICB2YXIgY291bnQgPSAwO1xuXG4gICAgICAgICAgdmFyIGFyZ3MgPSBbXTtcblxuICAgICAgICAgIGZsb3dzLmVhY2goZnVuY3Rpb24oZmxvdykge1xuICAgICAgICAgICAgZmxvdy50aGVuKGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgKytjb3VudDtcbiAgICAgICAgICAgICAgYXJncy5wdXNoKGQpO1xuXG4gICAgICAgICAgICAgIGlmIChjb3VudCA+PSBmbG93cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKGFyZ3MpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG59KSgpO1xuLypcbiAqIGNvbG9yLmpzXG4gKi9cblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEudXRpbC5Db2xvclxuICAgKiDjgqvjg6njg7zjgq/jg6njgrlcbiAgICovXG4gIHBoaW5hLmRlZmluZShcInBoaW5hLnV0aWwuQ29sb3JcIiwge1xuICAgIC8qKiBS5YCkICovXG4gICAgcjogMjU1LFxuICAgIC8qKiBH5YCkICovXG4gICAgZzogMjU1LFxuICAgIC8qKiBC5YCkICovXG4gICAgYjogMjU1LFxuICAgIC8qKiBB5YCkICovXG4gICAgYTogMS4wLFxuXG4gICAgLyoqXG4gICAgICog5Yid5pyf5YyWXG4gICAgICovXG4gICAgaW5pdDogZnVuY3Rpb24ociwgZywgYiwgYSkge1xuICAgICAgdGhpcy5zZXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog44K744OD44K/44O8LlxuICAgICAqL1xuICAgIHNldDogZnVuY3Rpb24ociwgZywgYiwgYSkge1xuICAgICAgdGhpcy5yID0gcjtcbiAgICAgIHRoaXMuZyA9IGc7XG4gICAgICB0aGlzLmIgPSBiO1xuICAgICAgdGhpcy5hID0gKGEgIT09IHVuZGVmaW5lZCkgPyBhIDogMS4wO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOaVsOWApOOBq+OCiOOCi+OCu+ODg+OCv+ODvC5cbiAgICAgKi9cbiAgICBzZXRGcm9tTnVtYmVyOiBmdW5jdGlvbihyLCBnLCBiLCBhKSB7XG4gICAgICB0aGlzLnIgPSByO1xuICAgICAgdGhpcy5nID0gZztcbiAgICAgIHRoaXMuYiA9IGI7XG4gICAgICB0aGlzLmEgPSAoYSAhPT0gdW5kZWZpbmVkKSA/IGEgOiAxLjA7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog6YWN5YiX44Gr44KI44KL44K744OD44K/44O8XG4gICAgICovXG4gICAgc2V0RnJvbUFycmF5OiBmdW5jdGlvbihhcnIpIHtcbiAgICAgIHJldHVybiB0aGlzLnNldC5hcHBseSh0aGlzLCBhcnIpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDjgqrjg5bjgrjjgqfjgq/jg4jjgavjgojjgovjgrvjg4Pjgr/jg7xcbiAgICAgKi9cbiAgICBzZXRGcm9tT2JqZWN0OiBmdW5jdGlvbihvYmopIHtcbiAgICAgIHJldHVybiB0aGlzLnNldChvYmouciwgb2JqLmcsIG9iai5iLCBvYmouYSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOaWh+Wtl+WIl+OBq+OCiOOCi+OCu+ODg+OCv+ODvFxuICAgICAqL1xuICAgIHNldEZyb21TdHJpbmc6IGZ1bmN0aW9uKHN0cikge1xuICAgICAgdmFyIGNvbG9yID0gcGhpbmEudXRpbC5Db2xvci5zdHJpbmdUb051bWJlcihzdHIpO1xuICAgICAgcmV0dXJuIHRoaXMuc2V0KGNvbG9yWzBdLCBjb2xvclsxXSwgY29sb3JbMl0sIGNvbG9yWzNdKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog6LOi44GE44K744OD44K/44O8XG4gICAgICovXG4gICAgc2V0U21hcnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGFyZyA9IGFyZ3VtZW50c1swXTtcbiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID49IDMpIHtcbiAgICAgICAgdGhpcy5zZXQoYXJndW1lbnRzLnIsIGFyZ3VtZW50cy5nLCBhcmd1bWVudHMuYiwgYXJndW1lbnRzLmEpO1xuICAgICAgfSBlbHNlIGlmIChhcmcgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICB0aGlzLnNldEZyb21BcnJheShhcmcpO1xuICAgICAgfSBlbHNlIGlmIChhcmcgaW5zdGFuY2VvZiBPYmplY3QpIHtcbiAgICAgICAgdGhpcy5zZXRGcm9tT2JqZWN0KGFyZyk7XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZihhcmcpID09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgdGhpcy5zZXRGcm9tU3RyaW5nKGFyZyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ1NTIOeUqCAxNumAsuaVsOaWh+Wtl+WIl+OBq+WkieaPm1xuICAgICAqL1xuICAgIHRvU3R5bGVBc0hleDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gXCIjezB9ezF9ezJ9XCIuZm9ybWF0KFxuICAgICAgICB0aGlzLnIudG9TdHJpbmcoMTYpLnBhZGRpbmcoMiwgJzAnKSxcbiAgICAgICAgdGhpcy5nLnRvU3RyaW5nKDE2KS5wYWRkaW5nKDIsICcwJyksXG4gICAgICAgIHRoaXMuYi50b1N0cmluZygxNikucGFkZGluZygyLCAnMCcpXG4gICAgICApO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDU1Mg55SoIFJHQuaWh+Wtl+WIl+OBq+WkieaPm1xuICAgICAqL1xuICAgIHRvU3R5bGVBc1JHQjogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gXCJyZ2Ioe3J9LHtnfSx7Yn0pXCIuZm9ybWF0KHtcbiAgICAgICAgcjogfn50aGlzLnIsXG4gICAgICAgIGc6IH5+dGhpcy5nLFxuICAgICAgICBiOiB+fnRoaXMuYlxuICAgICAgfSk7XG4gICAgfSxcblxuXG4gICAgLyoqXG4gICAgICogQ1NTIOeUqCBSR0JB5paH5a2X5YiX44Gr5aSJ5o+bXG4gICAgICovXG4gICAgdG9TdHlsZUFzUkdCQTogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gXCJyZ2JhKHtyfSx7Z30se2J9LHthfSlcIi5mb3JtYXQoe1xuICAgICAgICByOiB+fnRoaXMucixcbiAgICAgICAgZzogfn50aGlzLmcsXG4gICAgICAgIGI6IH5+dGhpcy5iLFxuICAgICAgICBhOiB0aGlzLmFcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDU1Mg55SoIFJHQkEg5paH5a2X5YiX44Gr5aSJ5o+bXG4gICAgICovXG4gICAgdG9TdHlsZTogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gXCJyZ2JhKHtyfSx7Z30se2J9LHthfSlcIi5mb3JtYXQoe1xuICAgICAgICByOiB+fnRoaXMucixcbiAgICAgICAgZzogfn50aGlzLmcsXG4gICAgICAgIGI6IH5+dGhpcy5iLFxuICAgICAgICBhOiB0aGlzLmFcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBfc3RhdGljOiB7XG5cbiAgICAgIC8qKlxuICAgICAgICogQHN0YXRpY1xuICAgICAgICog44Kr44Op44O844Oq44K544OIXG4gICAgICAgKi9cbiAgICAgIENPTE9SX0xJU1Q6IHtcbiAgICAgICAgLyoqIEBwcm9wZXJ0eSBibGFjayAqL1xuICAgICAgICBcImJsYWNrXCI6IFsweDAwLCAweDAwLCAweDAwXSxcbiAgICAgICAgLyoqIEBwcm9wZXJ0eSBzaWx2ZXIgKi9cbiAgICAgICAgXCJzaWx2ZXJcIjogWzB4YzAsIDB4YzAsIDB4YzBdLFxuICAgICAgICAvKiogQHByb3BlcnR5IGdyYXkgKi9cbiAgICAgICAgXCJncmF5XCI6IFsweDgwLCAweDgwLCAweDgwXSxcbiAgICAgICAgLyoqIEBwcm9wZXJ0eSB3aGl0ZSAqL1xuICAgICAgICBcIndoaXRlXCI6IFsweGZmLCAweGZmLCAweGZmXSxcbiAgICAgICAgLyoqIEBwcm9wZXJ0eSBtYXJvb24gKi9cbiAgICAgICAgXCJtYXJvb25cIjogWzB4ODAsIDB4MDAsIDB4MDBdLFxuICAgICAgICAvKiogQHByb3BlcnR5IHJlZCAqL1xuICAgICAgICBcInJlZFwiOiBbMHhmZiwgMHgwMCwgMHgwMF0sXG4gICAgICAgIC8qKiBAcHJvcGVydHkgcHVycGxlICovXG4gICAgICAgIFwicHVycGxlXCI6IFsweDgwLCAweDAwLCAweDgwXSxcbiAgICAgICAgLyoqIEBwcm9wZXJ0eSBmdWNoc2lhICovXG4gICAgICAgIFwiZnVjaHNpYVwiOiBbMHhmZiwgMHgwMCwgMHhmZl0sXG4gICAgICAgIC8qKiBAcHJvcGVydHkgZ3JlZW4gKi9cbiAgICAgICAgXCJncmVlblwiOiBbMHgwMCwgMHg4MCwgMHgwMF0sXG4gICAgICAgIC8qKiBAcHJvcGVydHkgbGltZSAqL1xuICAgICAgICBcImxpbWVcIjogWzB4MDAsIDB4ZmYsIDB4MDBdLFxuICAgICAgICAvKiogQHByb3BlcnR5IG9saXZlICovXG4gICAgICAgIFwib2xpdmVcIjogWzB4ODAsIDB4ODAsIDB4MDBdLFxuICAgICAgICAvKiogQHByb3BlcnR5IHllbGxvdyAqL1xuICAgICAgICBcInllbGxvd1wiOiBbMHhmZiwgMHhmZiwgMHgwMF0sXG4gICAgICAgIC8qKiBAcHJvcGVydHkgbmF2eSAqL1xuICAgICAgICBcIm5hdnlcIjogWzB4MDAsIDB4MDAsIDB4ODBdLFxuICAgICAgICAvKiogQHByb3BlcnR5IGJsdWUgKi9cbiAgICAgICAgXCJibHVlXCI6IFsweDAwLCAweDAwLCAweGZmXSxcbiAgICAgICAgLyoqIEBwcm9wZXJ0eSB0ZWFsICovXG4gICAgICAgIFwidGVhbFwiOiBbMHgwMCwgMHg4MCwgMHg4MF0sXG4gICAgICAgIC8qKiBAcHJvcGVydHkgYXF1YSAqL1xuICAgICAgICBcImFxdWFcIjogWzB4MDAsIDB4ZmYsIDB4ZmZdLFxuICAgICAgfSxcblxuICAgICAgLyoqXG4gICAgICAgKiBAc3RhdGljXG4gICAgICAgKiBAbWVtYmVyIHBoaW5hLnV0aWwuQ29sb3JcbiAgICAgICAqIEBtZXRob2Qgc3RyVG9OdW1cbiAgICAgICAqL1xuICAgICAgc3RyVG9OdW06IGZ1bmN0aW9uKHN0cikge1xuICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdUb051bWJlcihzdHIpO1xuICAgICAgfSxcbiAgICAgIHN0cmluZ1RvTnVtYmVyOiBmdW5jdGlvbihzdHIpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gbnVsbDtcbiAgICAgICAgdmFyIHR5cGUgPSBudWxsO1xuXG4gICAgICAgIGlmIChzdHJbMF0gPT09ICcjJykge1xuICAgICAgICAgIHR5cGUgPSAoc3RyLmxlbmd0aCA9PSA0KSA/IFwiaGV4MTExXCIgOiBcImhleDIyMlwiO1xuICAgICAgICB9IGVsc2UgaWYgKHN0clswXSA9PT0gJ3InICYmIHN0clsxXSA9PT0gJ2cnICYmIHN0clsyXSA9PT0gJ2InKSB7XG4gICAgICAgICAgdHlwZSA9IChzdHJbM10gPT0gJ2EnKSA/IFwicmdiYVwiIDogXCJyZ2JcIjtcbiAgICAgICAgfSBlbHNlIGlmIChzdHJbMF0gPT09ICdoJyAmJiBzdHJbMV0gPT09ICdzJyAmJiBzdHJbMl0gPT09ICdsJykge1xuICAgICAgICAgIHR5cGUgPSAoc3RyWzNdID09ICdhJykgPyBcImhzbGFcIiA6IFwiaHNsXCI7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZSkge1xuICAgICAgICAgIHZhciBtYXRjaF9zZXQgPSBNQVRDSF9TRVRfTElTVFt0eXBlXTtcbiAgICAgICAgICB2YXIgbSA9IHN0ci5tYXRjaChtYXRjaF9zZXQucmVnKTtcbiAgICAgICAgICB2YWx1ZSA9IG1hdGNoX3NldC5leGVjKG0pO1xuICAgICAgICB9IGVsc2UgaWYgKHBoaW5hLnV0aWwuQ29sb3IuQ09MT1JfTElTVFtzdHJdKSB7XG4gICAgICAgICAgdmFsdWUgPSBwaGluYS51dGlsLkNvbG9yLkNPTE9SX0xJU1Rbc3RyXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH0sXG5cbiAgICAgIC8qKlxuICAgICAgICogQHN0YXRpY1xuICAgICAgICogQG1ldGhvZFxuICAgICAgICogaHNsIOOCkiByZ2Ig44Gr5aSJ5o+bXG4gICAgICAgKi9cbiAgICAgIEhTTHRvUkdCOiBmdW5jdGlvbihoLCBzLCBsKSB7XG4gICAgICAgIHZhciByLCBnLCBiO1xuXG4gICAgICAgIGggJT0gMzYwO1xuICAgICAgICBoICs9IDM2MDtcbiAgICAgICAgaCAlPSAzNjA7XG4gICAgICAgIHMgKj0gMC4wMTtcbiAgICAgICAgbCAqPSAwLjAxO1xuXG4gICAgICAgIGlmIChzID09PSAwKSB7XG4gICAgICAgICAgdmFyIGwgPSBNYXRoLnJvdW5kKGwgKiAyNTUpO1xuICAgICAgICAgIHJldHVybiBbbCwgbCwgbF07XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG0yID0gKGwgPCAwLjUpID8gbCAqICgxICsgcykgOiBsICsgcyAtIGwgKiBzO1xuICAgICAgICB2YXIgbTEgPSBsICogMiAtIG0yO1xuXG4gICAgICAgIC8vIHJlZFxuICAgICAgICB2YXIgdGVtcCA9IChoICsgMTIwKSAlIDM2MDtcbiAgICAgICAgaWYgKHRlbXAgPCA2MCkge1xuICAgICAgICAgIHIgPSBtMSArIChtMiAtIG0xKSAqIHRlbXAgLyA2MDtcbiAgICAgICAgfSBlbHNlIGlmICh0ZW1wIDwgMTgwKSB7XG4gICAgICAgICAgciA9IG0yO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHIgPSBtMTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGdyZWVuXG4gICAgICAgIHRlbXAgPSBoO1xuICAgICAgICBpZiAodGVtcCA8IDYwKSB7XG4gICAgICAgICAgZyA9IG0xICsgKG0yIC0gbTEpICogdGVtcCAvIDYwO1xuICAgICAgICB9IGVsc2UgaWYgKHRlbXAgPCAxODApIHtcbiAgICAgICAgICBnID0gbTI7XG4gICAgICAgIH0gZWxzZSBpZiAodGVtcCA8IDI0MCkge1xuICAgICAgICAgIGcgPSBtMSArIChtMiAtIG0xKSAqICgyNDAgLSB0ZW1wKSAvIDYwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGcgPSBtMTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGJsdWVcbiAgICAgICAgdGVtcCA9ICgoaCAtIDEyMCkgKyAzNjApICUgMzYwO1xuICAgICAgICBpZiAodGVtcCA8IDYwKSB7XG4gICAgICAgICAgYiA9IG0xICsgKG0yIC0gbTEpICogdGVtcCAvIDYwO1xuICAgICAgICB9IGVsc2UgaWYgKHRlbXAgPCAxODApIHtcbiAgICAgICAgICBiID0gbTI7XG4gICAgICAgIH0gZWxzZSBpZiAodGVtcCA8IDI0MCkge1xuICAgICAgICAgIGIgPSBtMSArIChtMiAtIG0xKSAqICgyNDAgLSB0ZW1wKSAvIDYwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGIgPSBtMTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgcGFyc2VJbnQociAqIDI1NSksXG4gICAgICAgICAgcGFyc2VJbnQoZyAqIDI1NSksXG4gICAgICAgICAgcGFyc2VJbnQoYiAqIDI1NSlcbiAgICAgICAgXTtcbiAgICAgIH0sXG5cbiAgICAgIC8qKlxuICAgICAgICogQHN0YXRpY1xuICAgICAgICogQG1ldGhvZFxuICAgICAgICogaHNsYSDjgpIgcmdiYSDjgavlpInmj5tcbiAgICAgICAqL1xuICAgICAgSFNMQXRvUkdCQTogZnVuY3Rpb24oaCwgcywgbCwgYSkge1xuICAgICAgICB2YXIgdGVtcCA9IHBoaW5hLnV0aWwuQ29sb3IuSFNMdG9SR0IoaCwgcywgbCk7XG4gICAgICAgIHRlbXBbM10gPSBhO1xuICAgICAgICByZXR1cm4gdGVtcDtcbiAgICAgIH0sXG5cbiAgICAgIC8qKlxuICAgICAgICogQHN0YXRpY1xuICAgICAgICogQG1ldGhvZFxuICAgICAgICogcmdiIOOCkiBoc2wg44Gr5aSJ5o+bXG4gICAgICAgKi9cbiAgICAgIFJHQnRvSFNMOiBmdW5jdGlvbihyLCBnLCBiKSB7XG4gICAgICAgIHZhciBfciA9IHIgLyAyNTU7XG4gICAgICAgIHZhciBfZyA9IGcgLyAyNTU7XG4gICAgICAgIHZhciBfYiA9IGIgLyAyNTU7XG5cbiAgICAgICAgdmFyIG1heCA9IE1hdGgubWF4KF9yLCBfZywgX2IpO1xuICAgICAgICB2YXIgbWluID0gTWF0aC5taW4oX3IsIF9nLCBfYik7XG4gICAgICAgIHZhciBkZWx0YSA9IG1heCAtIG1pbjtcblxuICAgICAgICB2YXIgaCA9IDA7XG4gICAgICAgIGlmIChkZWx0YSA9PT0gMCkge1xuICAgICAgICAgIGggPSAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChtYXggPT09IF9yKSB7XG4gICAgICAgICAgICBoID0gKF9nIC0gX2IpIC8gZGVsdGEgKiA2MDtcbiAgICAgICAgICB9IGVsc2UgaWYgKG1heCA9PT0gX2cpIHtcbiAgICAgICAgICAgIGggPSAoX2IgLSBfcikgLyBkZWx0YSAqIDYwICsgMTIwO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBoID0gKF9yIC0gX2cpIC8gZGVsdGEgKiA2MCArIDI0MDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaCAlPSAzNjA7XG4gICAgICAgIGggKz0gMzYwO1xuICAgICAgICBoICU9IDM2MDtcblxuICAgICAgICB2YXIgbCA9IChtYXggKyBtaW4pIC8gMjtcblxuICAgICAgICB2YXIgcyA9IDA7XG4gICAgICAgIGlmIChkZWx0YSA9PT0gMCkge1xuICAgICAgICAgIHMgPSAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHMgPSBkZWx0YSAvICgxIC0gTWF0aC5hYnMoMiAqIGwgLSAxKSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gW2gsIHMgKiAxMDAsIGwgKiAxMDBdO1xuICAgICAgfSxcblxuICAgICAgLyoqXG4gICAgICAgKiBAc3RhdGljXG4gICAgICAgKiBAbWV0aG9kXG4gICAgICAgKiByZ2JhIOOCkiBoc2xhIOOBq+WkieaPm1xuICAgICAgICovXG4gICAgICBSR0JBdG9IU0xBOiBmdW5jdGlvbihyLCBnLCBiLCBhKSB7XG4gICAgICAgIHZhciB0ZW1wID0gcGhpbmEudXRpbC5Db2xvci5SR0J0b0hTTChyLCBnLCBiKTtcbiAgICAgICAgdGVtcFszXSA9IGE7XG4gICAgICAgIHJldHVybiB0ZW1wO1xuICAgICAgfSxcblxuICAgICAgLyoqXG4gICAgICAgKiBAc3RhdGljXG4gICAgICAgKiBAbWV0aG9kXG4gICAgICAgKiByZ2Ig5YCk44KS5L2c5oiQXG4gICAgICAgKi9cbiAgICAgIGNyZWF0ZVN0eWxlUkdCOiBmdW5jdGlvbihyLCBnLCBiKSB7XG4gICAgICAgIHJldHVybiBcInJnYmEoXCIgKyByICsgXCIsXCIgKyBnICsgXCIsXCIgKyBiICsgXCIpXCI7XG4gICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAqIEBzdGF0aWNcbiAgICAgICAqIEBtZXRob2RcbiAgICAgICAqIHJnYmEg5YCk44KS5L2c5oiQXG4gICAgICAgKi9cbiAgICAgIGNyZWF0ZVN0eWxlUkdCQTogZnVuY3Rpb24ociwgZywgYiwgYSkge1xuICAgICAgICByZXR1cm4gXCJyZ2JhKFwiICsgciArIFwiLFwiICsgZyArIFwiLFwiICsgYiArIFwiLFwiICsgYSArIFwiKVwiO1xuICAgICAgfSxcblxuICAgICAgLyoqXG4gICAgICAgKiBAc3RhdGljXG4gICAgICAgKiBAbWV0aG9kXG4gICAgICAgKiBoc2wg5YCk44KS5L2c5oiQXG4gICAgICAgKi9cbiAgICAgIGNyZWF0ZVN0eWxlSFNMOiBmdW5jdGlvbihoLCBzLCBsKSB7XG4gICAgICAgIHJldHVybiBcImhzbChcIiArIGggKyBcIixcIiArIHMgKyBcIiUsXCIgKyBsICsgXCIlKVwiO1xuICAgICAgfSxcblxuICAgICAgLyoqXG4gICAgICAgKiBAc3RhdGljXG4gICAgICAgKiBAbWV0aG9kXG4gICAgICAgKiBoc2xhIOWApOOCkuS9nOaIkFxuICAgICAgICovXG4gICAgICBjcmVhdGVTdHlsZUhTTEE6IGZ1bmN0aW9uKGgsIHMsIGwsIGEpIHtcbiAgICAgICAgcmV0dXJuIFwiaHNsYShcIiArIGggKyBcIixcIiArIHMgKyBcIiUsXCIgKyBsICsgXCIlLFwiICsgYSArIFwiKVwiO1xuICAgICAgfSxcbiAgICB9XG4gIH0pO1xuXG5cbiAgdmFyIE1BVENIX1NFVF9MSVNUID0ge1xuICAgIFwiaGV4MTExXCI6IHtcbiAgICAgIHJlZzogL14jKFxcd3sxfSkoXFx3ezF9KShcXHd7MX0pJC8sXG4gICAgICBleGVjOiBmdW5jdGlvbihtKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgcGFyc2VJbnQobVsxXSArIG1bMV0sIDE2KSxcbiAgICAgICAgICBwYXJzZUludChtWzJdICsgbVsyXSwgMTYpLFxuICAgICAgICAgIHBhcnNlSW50KG1bM10gKyBtWzNdLCAxNilcbiAgICAgICAgXTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwiaGV4MjIyXCI6IHtcbiAgICAgIHJlZzogL14jKFxcd3syfSkoXFx3ezJ9KShcXHd7Mn0pJC8sXG4gICAgICBleGVjOiBmdW5jdGlvbihtKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgcGFyc2VJbnQobVsxXSwgMTYpLFxuICAgICAgICAgIHBhcnNlSW50KG1bMl0sIDE2KSxcbiAgICAgICAgICBwYXJzZUludChtWzNdLCAxNilcbiAgICAgICAgXTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwicmdiXCI6IHtcbiAgICAgIHJlZzogL15yZ2JcXCgoXFxkezEsM30pLFxccyooXFxkezEsM30pLFxccyooXFxkezEsM30pXFwpJC8sXG4gICAgICBleGVjOiBmdW5jdGlvbihtKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgcGFyc2VJbnQobVsxXSksXG4gICAgICAgICAgcGFyc2VJbnQobVsyXSksXG4gICAgICAgICAgcGFyc2VJbnQobVszXSlcbiAgICAgICAgXTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwicmdiYVwiOiB7XG4gICAgICByZWc6IC9ecmdiYVxcKChcXGR7MSwzfSksXFxzKihcXGR7MSwzfSksXFxzKihcXGR7MSwzfSksXFxzKihcXGR7MX0oXFwuezF9XFxkKyk/KVxcKSQvLFxuICAgICAgZXhlYzogZnVuY3Rpb24obSkge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgIHBhcnNlSW50KG1bMV0pLFxuICAgICAgICAgIHBhcnNlSW50KG1bMl0pLFxuICAgICAgICAgIHBhcnNlSW50KG1bM10pLFxuICAgICAgICAgIHBhcnNlRmxvYXQobVs0XSlcbiAgICAgICAgXTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwiaHNsXCI6IHtcbiAgICAgIHJlZzogL15oc2xcXCgoXFxkezEsM30pLFxccyooXFxkezEsM30pJSxcXHMqKFxcZHsxLDN9KSVcXCkkLyxcbiAgICAgIGV4ZWM6IGZ1bmN0aW9uKG0pIHtcbiAgICAgICAgcmV0dXJuIHBoaW5hLnV0aWwuQ29sb3IuSFNMdG9SR0IobVsxXSwgbVsyXSwgbVszXSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBcImhzbGFcIjoge1xuICAgICAgcmVnOiAvXnJnYmFcXCgoXFxkezEsM30pLFxccyooXFxkezEsM30pLFxccyooXFxkezEsM30pLFxccyooXFxkezF9KFxcLnsxfVxcZCspPylcXCkkLyxcbiAgICAgIGV4ZWM6IGZ1bmN0aW9uKG0pIHtcbiAgICAgICAgcmV0dXJuIHBoaW5hLnV0aWwuQ29sb3IuSFNMQXRvUkdCQShtWzFdLCBtWzJdLCBtWzNdLCBtWzRdKTtcbiAgICAgIH0sXG4gICAgfVxuICB9O1xuXG59KTtcblxuLypcbiAqIHJhbmRvbS5qc1xuICovXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLnV0aWwuUmFuZG9tXG4gICAqIOODqeODs+ODgOODoOOCr+ODqeOCuVxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKFwicGhpbmEudXRpbC5SYW5kb21cIiwge1xuXG4gICAgc2VlZDogMSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHNlZWQpIHtcbiAgICAgIHRoaXMuc2VlZCA9IHNlZWQgfHwgKERhdGUubm93KCkpIHx8IDE7XG4gICAgfSxcblxuICAgIHJhbmRvbTogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VlZCA9IHRoaXMuc2VlZDtcbiAgICAgIHNlZWQgPSBzZWVkIF4gKHNlZWQgPDwgMTMpO1xuICAgICAgc2VlZCA9IHNlZWQgXiAoc2VlZCA+Pj4gMTcpO1xuICAgICAgc2VlZCA9IChzZWVkIF4gKHNlZWQgPDwgNSkpO1xuXG4gICAgICB0aGlzLnNlZWQgPSBzZWVkO1xuXG4gICAgICByZXR1cm4gKHNlZWQgPj4+IDApIC8gcGhpbmEudXRpbC5SYW5kb20uTUFYO1xuICAgIH0sXG5cbiAgICByYW5kaW50OiBmdW5jdGlvbihtaW4sIG1heCkge1xuICAgICAgcmV0dXJuIE1hdGguZmxvb3IoIHRoaXMucmFuZG9tKCkqKG1heC1taW4rMSkgKSArIG1pbjtcbiAgICB9LFxuICAgIHJhbmRmbG9hdDogZnVuY3Rpb24obWluLCBtYXgpIHtcbiAgICAgIHJldHVybiB0aGlzLnJhbmRvbSgpKihtYXgtbWluKSttaW47XG4gICAgfSxcbiAgICByYW5kYm9vbDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5yYW5kaW50KDAsIDEpID09PSAxO1xuICAgIH0sXG4gICAgcmFuZGFycmF5OiBmdW5jdGlvbihsZW4sIG1pbiwgbWF4KSB7XG4gICAgICBsZW4gPSBsZW4gfHwgMTAwO1xuICAgICAgbWluID0gbWluIHx8IDA7XG4gICAgICBtYXggPSBtYXggfHwgMTAwO1xuXG4gICAgICByZXR1cm4gKGxlbikubWFwKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yYW5kaW50KG1pbiwgbWF4KTtcbiAgICAgIH0sIHRoaXMpO1xuICAgIH0sXG5cbiAgICBfYWNjZXNzb3I6IHtcbiAgICAgIHNlZWQ6IHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMuX3NlZWQ7IH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHYpIHsgdGhpcy5fc2VlZCA9ICh2ID4+PiAwKSB8fCAxOyB9LFxuICAgICAgfSxcbiAgICB9LFxuXG4gICAgX3N0YXRpYzoge1xuICAgICAgTUFYOiA0Mjk0OTY3Mjk1LFxuXG4gICAgICBzZWVkOiAoRGF0ZS5ub3coKSksXG5cbiAgICAgIGdldFNlZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZWVkO1xuICAgICAgfSxcbiAgICAgIHNldFNlZWQ6IGZ1bmN0aW9uKHNlZWQpIHtcbiAgICAgICAgdGhpcy5zZWVkID0gKHNlZWQgPj4+IDApIHx8IDE7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfSxcblxuICAgICAgcmFuZG9tOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5zZWVkID0gdGhpcy54b3IzMih0aGlzLnNlZWQpO1xuICAgICAgICByZXR1cm4gKHRoaXMuc2VlZCA+Pj4gMCkgLyBwaGluYS51dGlsLlJhbmRvbS5NQVg7XG4gICAgICB9LFxuXG4gICAgICByYW5kaW50OiBmdW5jdGlvbihtaW4sIG1heCkge1xuICAgICAgICByZXR1cm4gcGhpbmEuZ2xvYmFsLk1hdGguZmxvb3IoIHRoaXMucmFuZG9tKCkqKG1heC1taW4rMSkgKSArIG1pbjtcbiAgICAgIH0sXG4gICAgICByYW5kZmxvYXQ6IGZ1bmN0aW9uKG1pbiwgbWF4KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJhbmRvbSgpKihtYXgtbWluKSttaW47XG4gICAgICB9LFxuICAgICAgcmFuZGJvb2w6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yYW5kaW50KDAsIDEpID09PSAxO1xuICAgICAgfSxcbiAgICAgIHJhbmRhcnJheTogZnVuY3Rpb24obGVuLCBtaW4sIG1heCkge1xuICAgICAgICBsZW4gPSBsZW4gfHwgMTAwO1xuICAgICAgICBtaW4gPSBtaW4gfHwgMDtcbiAgICAgICAgbWF4ID0gbWF4IHx8IDEwMDtcblxuICAgICAgICByZXR1cm4gKGxlbikubWFwKGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLnJhbmRpbnQobWluLCBtYXgpO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICAgIH0sXG5cbiAgICAgIHhvcjMyOiBmdW5jdGlvbihzZWVkKSB7XG4gICAgICAgIHNlZWQgPSBzZWVkIF4gKHNlZWQgPDwgMTMpO1xuICAgICAgICBzZWVkID0gc2VlZCBeIChzZWVkID4+PiAxNyk7XG4gICAgICAgIHNlZWQgPSAoc2VlZCBeIChzZWVkIDw8IDUpKTtcblxuICAgICAgICByZXR1cm4gc2VlZDtcbiAgICAgIH0sXG5cbiAgICAgIC8qXG4gICAgICAgKiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzEwNTAzNC9jcmVhdGUtZ3VpZC11dWlkLWluLWphdmFzY3JpcHRcbiAgICAgICAqL1xuICAgICAgdXVpZDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBkID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgIGlmKHBoaW5hLmdsb2JhbC5wZXJmb3JtYW5jZSAmJiB0eXBlb2YgcGhpbmEuZ2xvYmFsLnBlcmZvcm1hbmNlLm5vdyA9PT0gXCJmdW5jdGlvblwiKXtcbiAgICAgICAgICBkICs9IHBlcmZvcm1hbmNlLm5vdygpOyAvL3VzZSBoaWdoLXByZWNpc2lvbiB0aW1lciBpZiBhdmFpbGFibGVcbiAgICAgICAgfVxuICAgICAgICB2YXIgdXVpZCA9ICd4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgnLnJlcGxhY2UoL1t4eV0vZywgZnVuY3Rpb24oYykge1xuICAgICAgICAgIHZhciByID0gKGQgKyBNYXRoLnJhbmRvbSgpKjE2KSUxNiB8IDA7XG4gICAgICAgICAgZCA9IE1hdGguZmxvb3IoZC8xNik7XG4gICAgICAgICAgcmV0dXJuIChjPT0neCcgPyByIDogKHImMHgzfDB4OCkpLnRvU3RyaW5nKDE2KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB1dWlkO1xuICAgICAgfSxcblxuICAgIH0sXG4gIH0pO1xuXG4gIE1hdGguJG1ldGhvZChcInJhbmRpbnRcIiwgZnVuY3Rpb24obWluLCBtYXgpIHtcbiAgICByZXR1cm4gcGhpbmEudXRpbC5SYW5kb20ucmFuZGludChtaW4sIG1heCk7XG4gIH0pO1xuICBNYXRoLiRtZXRob2QoXCJyYW5kZmxvYXRcIiwgZnVuY3Rpb24obWluLCBtYXgpIHtcbiAgICByZXR1cm4gcGhpbmEudXRpbC5SYW5kb20ucmFuZGZsb2F0KG1pbiwgbWF4KTtcbiAgfSk7XG5cbn0pO1xuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLnV0aWwuUXVlcnlTdHJpbmdcbiAgICogXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLnV0aWwuUXVlcnlTdHJpbmcnLCB7XG4gICAgX3N0YXRpYzoge1xuICAgICAgcGFyc2U6IGZ1bmN0aW9uKHRleHQsIHNlcCwgZXEsIGlzRGVjb2RlKSB7XG4gICAgICAgIHRleHQgPSB0ZXh0IHx8IGxvY2F0aW9uLnNlYXJjaC5zdWJzdHIoMSk7XG4gICAgICAgIHNlcCA9IHNlcCB8fCAnJic7XG4gICAgICAgIGVxID0gZXEgfHwgJz0nO1xuICAgICAgICB2YXIgZGVjb2RlID0gKGlzRGVjb2RlKSA/IGRlY29kZVVSSUNvbXBvbmVudCA6IGZ1bmN0aW9uKGEpIHsgcmV0dXJuIGE7IH07XG4gICAgICAgIHJldHVybiB0ZXh0LnNwbGl0KHNlcCkucmVkdWNlKGZ1bmN0aW9uKG9iaiwgdikge1xuICAgICAgICAgIHZhciBwYWlyID0gdi5zcGxpdChlcSk7XG4gICAgICAgICAgb2JqW3BhaXJbMF1dID0gZGVjb2RlKHBhaXJbMV0pO1xuICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgIH0sIHt9KTtcbiAgICAgIH0sXG4gICAgICBzdHJpbmdpZnk6IGZ1bmN0aW9uKHZhbHVlLCBzZXAsIGVxLCBpc0VuY29kZSkge1xuICAgICAgICBzZXAgPSBzZXAgfHwgJyYnO1xuICAgICAgICBlcSA9IGVxIHx8ICc9JztcbiAgICAgICAgdmFyIGVuY29kZSA9IChpc0VuY29kZSkgPyBlbmNvZGVVUklDb21wb25lbnQgOiBmdW5jdGlvbihhKSB7IHJldHVybiBhOyB9O1xuICAgICAgICByZXR1cm4gT2JqZWN0LmtleXModmFsdWUpLm1hcChmdW5jdGlvbihrZXkpIHtcbiAgICAgICAgICByZXR1cm4ga2V5ICsgZXEgKyBlbmNvZGUodmFsdWVba2V5XSk7XG4gICAgICAgIH0pLmpvaW4oc2VwKTtcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbn0pO1xuXG5cblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEudXRpbC5BamF4XG4gICAqIFxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS51dGlsLkFqYXgnLCB7XG4gICAgX3N0YXRpYzoge1xuICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgdHlwZTogJ0dFVCcsXG4gICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyxcbiAgICAgICAgcmVzcG9uc2VUeXBlOiAnanNvbicsXG4gICAgICAgIGRhdGE6IG51bGwsXG4gICAgICAgIHVybDogJycsXG4gICAgICB9LFxuXG4gICAgICByZXF1ZXN0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHZhciBkYXRhID0gKHt9KS4kc2FmZShvcHRpb25zLCB0aGlzLmRlZmF1bHRzKTtcblxuICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgIHZhciBmbG93ID0gcGhpbmEudXRpbC5GbG93KGZ1bmN0aW9uKHJlc29sdmUpIHtcbiAgICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT09IDQpIHtcbiAgICAgICAgICAgICAgaWYgKFsyMDAsIDIwMSwgMF0uaW5kZXhPZih4aHIuc3RhdHVzKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHhoci5yZXNwb25zZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgeGhyLm9wZW4oZGF0YS50eXBlLCBkYXRhLnVybCk7XG4gICAgICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9IGRhdGEucmVzcG9uc2VUeXBlO1xuICAgICAgICAgIHhoci5zZW5kKG51bGwpO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gZmxvdztcbiAgICAgIH0sXG4gICAgICBnZXQ6IGZ1bmN0aW9uKHVybCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KHtcbiAgICAgICAgICB0eXBlOiAnR0VUJyxcbiAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgcG9zdDogZnVuY3Rpb24odXJsKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3Qoe1xuICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgcHV0OiBmdW5jdGlvbih1cmwpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdCh7XG4gICAgICAgICAgdHlwZTogJ1BVVCcsXG4gICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIGRlbDogZnVuY3Rpb24odXJsKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3Qoe1xuICAgICAgICAgIHR5cGU6ICdERUxFVEUnLFxuICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbn0pO1xuXG5cblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEuYXNzZXQuQXNzZXRcbiAgICogQGV4dGVuZHMgcGhpbmEudXRpbC5FdmVudERpc3BhdGNoZXJcbiAgICovXG4gIHBoaW5hLmRlZmluZSgncGhpbmEuYXNzZXQuQXNzZXQnLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS51dGlsLkV2ZW50RGlzcGF0Y2hlclwiLFxuXG4gICAgc2VydmVyRXJyb3I6IGZhbHNlLFxuICAgIG5vdEZvdW5kOiBmYWxzZSxcbiAgICBsb2FkRXJyb3I6IGZhbHNlLFxuXG4gICAgLyoqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgaW5pdDogZnVuY3Rpb24oc3JjKSB7XG4gICAgICB0aGlzLnN1cGVySW5pdCgpO1xuXG4gICAgICB0aGlzLmxvYWRlZCA9IGZhbHNlO1xuICAgIH0sXG5cbiAgICBsb2FkOiBmdW5jdGlvbihzcmMpIHtcbiAgICAgIHRoaXMuc3JjID0gc3JjO1xuICAgICAgcmV0dXJuIHBoaW5hLnV0aWwuRmxvdyh0aGlzLl9sb2FkLmJpbmQodGhpcykpO1xuICAgIH0sXG5cbiAgICBpc0xvYWRlZDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5sb2FkZWQ7XG4gICAgfSxcblxuICAgIF9sb2FkOiBmdW5jdGlvbihyZXNvbHZlKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICBzZWxmLmxvYWRlZCA9IHRydWU7XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH0sIDEwMCk7XG4gICAgfSxcblxuICAgIC8vIOODreODvOODieWkseaVl+aZguOBq+ODgOODn+ODvOOCkuOCu+ODg+ODiOOBmeOCi1xuICAgIGxvYWREdW1teTogZnVuY3Rpb24oKSB7IH0sXG5cbiAgfSk7XG5cbn0pO1xuXG5cblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyXG4gICAqIFxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5hc3NldC5Bc3NldE1hbmFnZXInLCB7XG4gICAgX3N0YXRpYzoge1xuICAgICAgYXNzZXRzOiB7XG4gICAgICAgIGltYWdlOiB7fSxcbiAgICAgICAgc291bmQ6IHt9LFxuICAgICAgICBzcHJpdGVzaGVldDoge30sXG4gICAgICB9LFxuICAgICAgXG4gICAgICBnZXQ6IGZ1bmN0aW9uKHR5cGUsIGtleSkge1xuICAgICAgICByZXR1cm4gdGhpcy5hc3NldHNbdHlwZV0gJiYgdGhpcy5hc3NldHNbdHlwZV1ba2V5XTtcbiAgICAgIH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uKHR5cGUsIGtleSwgYXNzZXQpIHtcbiAgICAgICAgaWYgKCF0aGlzLmFzc2V0c1t0eXBlXSkge1xuICAgICAgICAgIHRoaXMuYXNzZXRzW3R5cGVdID0ge307XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hc3NldHNbdHlwZV1ba2V5XSA9IGFzc2V0O1xuICAgICAgfSxcbiAgICAgIGNvbnRhaW5zOiBmdW5jdGlvbih0eXBlLCBrZXkpIHtcbiAgICAgICAgcmV0dXJuIDtcbiAgICAgIH1cbiAgICB9LFxuXG4gIH0pO1xuXG59KTtcblxuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmFzc2V0LkFzc2V0TG9hZGVyXG4gICAqIEBleHRlbmRzIHBoaW5hLnV0aWwuRXZlbnREaXNwYXRjaGVyXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmFzc2V0LkFzc2V0TG9hZGVyJywge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEudXRpbC5FdmVudERpc3BhdGNoZXJcIixcblxuICAgIC8qKlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmFtcykge1xuICAgICAgdGhpcy5zdXBlckluaXQoKTtcblxuICAgICAgcGFyYW1zID0gKHBhcmFtcyB8fCB7fSkuJHNhZmUoe1xuICAgICAgICBjYWNoZTogdHJ1ZSxcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmFzc2V0cyA9IHt9O1xuICAgICAgdGhpcy5jYWNoZSA9IHBhcmFtcy5jYWNoZTtcbiAgICB9LFxuXG4gICAgbG9hZDogZnVuY3Rpb24ocGFyYW1zKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICB2YXIgZmxvd3MgPSBbXTtcblxuICAgICAgdmFyIGNvdW50ZXIgPSAwO1xuICAgICAgdmFyIGxlbmd0aCA9IDA7XG4gICAgICBwYXJhbXMuZm9ySW4oZnVuY3Rpb24odHlwZSwgYXNzZXRzKSB7XG4gICAgICAgIGxlbmd0aCArPSBPYmplY3Qua2V5cyhhc3NldHMpLmxlbmd0aDtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBwYXJhbXMuZm9ySW4oZnVuY3Rpb24odHlwZSwgYXNzZXRzKSB7XG4gICAgICAgIGFzc2V0cy5mb3JJbihmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgICAgdmFyIGZ1bmMgPSBwaGluYS5hc3NldC5Bc3NldExvYWRlci5hc3NldExvYWRGdW5jdGlvbnNbdHlwZV07XG4gICAgICAgICAgdmFyIGZsb3cgPSBmdW5jKGtleSwgdmFsdWUpO1xuICAgICAgICAgIGZsb3cudGhlbihmdW5jdGlvbihhc3NldCkge1xuICAgICAgICAgICAgaWYgKHNlbGYuY2FjaGUpIHtcbiAgICAgICAgICAgICAgcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLnNldCh0eXBlLCBrZXksIGFzc2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNlbGYuZmxhcmUoJ3Byb2dyZXNzJywge1xuICAgICAgICAgICAgICBrZXk6IGtleSxcbiAgICAgICAgICAgICAgYXNzZXQ6IGFzc2V0LFxuICAgICAgICAgICAgICBwcm9ncmVzczogKCsrY291bnRlci9sZW5ndGgpLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgZmxvd3MucHVzaChmbG93KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuXG4gICAgICBpZiAoc2VsZi5jYWNoZSkge1xuXG4gICAgICAgIHNlbGYub24oJ3Byb2dyZXNzJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgIGlmIChlLnByb2dyZXNzID49IDEuMCkge1xuICAgICAgICAgICAgLy8gbG9hZOWkseaVl+aZguOAgeWvvuetllxuICAgICAgICAgICAgcGFyYW1zLmZvckluKGZ1bmN0aW9uKHR5cGUsIGFzc2V0cykge1xuICAgICAgICAgICAgICBhc3NldHMuZm9ySW4oZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHZhciBhc3NldCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQodHlwZSwga2V5KTtcbiAgICAgICAgICAgICAgICBpZiAoYXNzZXQubG9hZEVycm9yKSB7XG4gICAgICAgICAgICAgICAgICB2YXIgZHVtbXkgPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KHR5cGUsICdkdW1teScpO1xuICAgICAgICAgICAgICAgICAgaWYgKGR1bW15KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkdW1teS5sb2FkRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICBkdW1teS5sb2FkRHVtbXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICBkdW1teS5sb2FkRXJyb3IgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuc2V0KHR5cGUsIGtleSwgZHVtbXkpO1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXQubG9hZER1bW15KCk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcGhpbmEudXRpbC5GbG93LmFsbChmbG93cykudGhlbihmdW5jdGlvbihhcmdzKSB7XG4gICAgICAgIHNlbGYuZmxhcmUoJ2xvYWQnKTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBfc3RhdGljOiB7XG4gICAgICBhc3NldExvYWRGdW5jdGlvbnM6IHtcbiAgICAgICAgaW1hZ2U6IGZ1bmN0aW9uKGtleSwgcGF0aCkge1xuICAgICAgICAgIHZhciB0ZXh0dXJlID0gcGhpbmEuYXNzZXQuVGV4dHVyZSgpO1xuICAgICAgICAgIHZhciBmbG93ID0gdGV4dHVyZS5sb2FkKHBhdGgpO1xuICAgICAgICAgIHJldHVybiBmbG93O1xuICAgICAgICB9LFxuICAgICAgICBzb3VuZDogZnVuY3Rpb24oa2V5LCBwYXRoKSB7XG4gICAgICAgICAgdmFyIHNvdW5kID0gcGhpbmEuYXNzZXQuU291bmQoKTtcbiAgICAgICAgICB2YXIgZmxvdyA9IHNvdW5kLmxvYWQocGF0aCk7XG4gICAgICAgICAgcmV0dXJuIGZsb3c7XG4gICAgICAgIH0sXG4gICAgICAgIHNwcml0ZXNoZWV0OiBmdW5jdGlvbihrZXksIHBhdGgpIHtcbiAgICAgICAgICB2YXIgc3MgPSBwaGluYS5hc3NldC5TcHJpdGVTaGVldCgpO1xuICAgICAgICAgIHZhciBmbG93ID0gc3MubG9hZChwYXRoKTtcbiAgICAgICAgICByZXR1cm4gZmxvdztcbiAgICAgICAgfSxcbiAgICAgICAgc2NyaXB0OiBmdW5jdGlvbihrZXksIHBhdGgpIHtcbiAgICAgICAgICB2YXIgc2NyaXB0ID0gcGhpbmEuYXNzZXQuU2NyaXB0KCk7XG4gICAgICAgICAgcmV0dXJuIHNjcmlwdC5sb2FkKHBhdGgpO1xuICAgICAgICB9LFxuICAgICAgICBmb250OiBmdW5jdGlvbihrZXksIHBhdGgpIHtcbiAgICAgICAgICB2YXIgZm9udCA9IHBoaW5hLmFzc2V0LkZvbnQoKTtcbiAgICAgICAgICBmb250LnNldEZvbnROYW1lKGtleSk7XG4gICAgICAgICAgcmV0dXJuIGZvbnQubG9hZChwYXRoKTtcbiAgICAgICAgfSxcbiAgICAgICAganNvbjogZnVuY3Rpb24oa2V5LCBwYXRoKSB7XG4gICAgICAgICAgdmFyIHRleHQgPSBwaGluYS5hc3NldC5GaWxlKCk7XG4gICAgICAgICAgcmV0dXJuIHRleHQubG9hZCh7XG4gICAgICAgICAgICBwYXRoOiBwYXRoLFxuICAgICAgICAgICAgZGF0YVR5cGU6IFwianNvblwiLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICB4bWw6IGZ1bmN0aW9uKGtleSwgcGF0aCkge1xuICAgICAgICAgIHZhciB0ZXh0ID0gcGhpbmEuYXNzZXQuRmlsZSgpO1xuICAgICAgICAgIHJldHVybiB0ZXh0LmxvYWQoe1xuICAgICAgICAgICAgcGF0aDogcGF0aCxcbiAgICAgICAgICAgIGRhdGFUeXBlOiBcInhtbFwiLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICB0ZXh0OiBmdW5jdGlvbihrZXksIHBhdGgpIHtcbiAgICAgICAgICB2YXIgdGV4dCA9IHBoaW5hLmFzc2V0LkZpbGUoKTtcbiAgICAgICAgICByZXR1cm4gdGV4dC5sb2FkKHBhdGgpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcmVnaXN0ZXI6IGZ1bmN0aW9uKGtleSwgZnVuYykge1xuICAgICAgICB0aGlzLmFzc2V0TG9hZEZ1bmN0aW9uc1trZXldID0gZnVuYztcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9LFxuICAgIH1cblxuICB9KTtcblxufSk7XG5cblxuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5hc3NldC5GaWxlXG4gICAqIEBleHRlbmRzIHBoaW5hLmFzc2V0LkFzc2V0XG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmFzc2V0LkZpbGUnLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5hc3NldC5Bc3NldFwiLFxuXG4gICAgLyoqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnN1cGVySW5pdCgpO1xuICAgIH0sXG5cbiAgICBfbG9hZDogZnVuY3Rpb24ocmVzb2x2ZSkge1xuXG4gICAgICB2YXIgcGFyYW1zID0ge307XG5cbiAgICAgIGlmICh0eXBlb2YgdGhpcy5zcmMgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHBhcmFtcy4kZXh0ZW5kKHtcbiAgICAgICAgICBwYXRoOiB0aGlzLnNyYyxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBlbHNlIGlmICh0eXBlb2YgdGhpcy5zcmMgPT09ICdvYmplY3QnKSB7XG4gICAgICAgIHBhcmFtcy4kZXh0ZW5kKHRoaXMuc3JjKTtcbiAgICAgIH1cblxuICAgICAgcGFyYW1zLiRzYWZlKHtcbiAgICAgICAgcGF0aDogJycsXG4gICAgICAgIGRhdGFUeXBlOiAndGV4dCcsXG4gICAgICB9KTtcblxuICAgICAgLy8gbG9hZFxuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgdmFyIHhtbCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgeG1sLm9wZW4oJ0dFVCcsIHBhcmFtcy5wYXRoKTtcbiAgICAgIHhtbC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHhtbC5yZWFkeVN0YXRlID09PSA0KSB7XG4gICAgICAgICAgaWYgKFsyMDAsIDIwMSwgMF0uaW5kZXhPZih4bWwuc3RhdHVzKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIHZhciBkYXRhID0geG1sLnJlc3BvbnNlVGV4dDtcblxuICAgICAgICAgICAgaWYgKHBhcmFtcy5kYXRhVHlwZSA9PT0gJ2pzb24nKSB7XG4gICAgICAgICAgICAgIGRhdGEgPSBKU09OLnBhcnNlKGRhdGEpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJhbXMuZGF0YVR5cGUgPT09ICd4bWwnKSB7XG4gICAgICAgICAgICAgIGRhdGEgPSAobmV3IERPTVBhcnNlcigpKS5wYXJzZUZyb21TdHJpbmcoZGF0YSwgXCJ0ZXh0L3htbFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNlbGYuZGF0YVR5cGUgPSBwYXJhbXMuZGF0YVR5cGU7XG5cbiAgICAgICAgICAgIHNlbGYuZGF0YSA9IGRhdGE7XG4gICAgICAgICAgICByZXNvbHZlKHNlbGYpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgeG1sLnNlbmQobnVsbCk7XG4gICAgICAvLyB0aGlzLmRvbUVsZW1lbnQgPSBuZXcgSW1hZ2UoKTtcbiAgICAgIC8vIHRoaXMuZG9tRWxlbWVudC5zcmMgPSB0aGlzLnNyYztcblxuICAgICAgLy8gdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgLy8gdGhpcy5kb21FbGVtZW50Lm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgLy8gICBzZWxmLmxvYWRlZCA9IHRydWU7XG4gICAgICAvLyAgIHJlc29sdmUoc2VsZik7XG4gICAgICAvLyB9O1xuICAgIH0sXG5cbiAgfSk7XG5cbn0pO1xuXG5cblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEuYXNzZXQuU2NyaXB0XG4gICAqIEBleHRlbmRzIHBoaW5hLmFzc2V0LkFzc2V0XG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmFzc2V0LlNjcmlwdCcsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmFzc2V0LkFzc2V0XCIsXG5cbiAgICAvKipcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuc3VwZXJJbml0KCk7XG4gICAgfSxcblxuICAgIF9sb2FkOiBmdW5jdGlvbihyZXNvbHZlKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICB0aGlzLmRvbUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICAgIHRoaXMuZG9tRWxlbWVudC5zcmMgPSB0aGlzLnNyYztcblxuICAgICAgdGhpcy5kb21FbGVtZW50Lm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXNvbHZlKHNlbGYpO1xuICAgICAgfS5iaW5kKHRoaXMpO1xuXG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuZG9tRWxlbWVudCk7XG4gICAgfSxcblxuICB9KTtcblxufSk7XG5cblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEuYXNzZXQuVGV4dHVyZVxuICAgKiBAZXh0ZW5kcyBwaGluYS5hc3NldC5Bc3NldFxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5hc3NldC5UZXh0dXJlJywge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuYXNzZXQuQXNzZXRcIixcblxuICAgIC8qKlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5zdXBlckluaXQoKTtcbiAgICB9LFxuXG4gICAgX2xvYWQ6IGZ1bmN0aW9uKHJlc29sdmUpIHtcbiAgICAgIHRoaXMuZG9tRWxlbWVudCA9IG5ldyBJbWFnZSgpO1xuXG4gICAgICB2YXIgaXNMb2NhbCA9IChsb2NhdGlvbi5wcm90b2NvbCA9PSAnZmlsZTonKTtcbiAgICAgIGlmICggIWlzTG9jYWwgJiYgISgvXmRhdGE6Ly50ZXN0KHRoaXMuc3JjKSkgKSB7XG4gICAgICAgIC8vIHRoaXMuZG9tRWxlbWVudC5jcm9zc09yaWdpbiA9ICdBbm9ueW1vdXMnOyAvLyDjgq/jg63jgrnjgqrjg6rjgrjjg7Pop6PpmaRcbiAgICAgIH1cbiAgICAgIGlmKCEoL15kYXRhOi8udGVzdCh0aGlzLnNyYykpKSB7XG4gICAgICAgIHRoaXMuZG9tRWxlbWVudC5jcm9zc09yaWdpbiA9ICdhbm9ueW1vdXMnOyAvLyDjgq/jg63jgrnjgqrjg6rjgrjjg7Pop6PpmaRcbiAgICAgIH1cblxuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgdGhpcy5kb21FbGVtZW50Lm9ubG9hZCA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgc2VsZi5sb2FkZWQgPSB0cnVlO1xuICAgICAgICByZXNvbHZlKHNlbGYpO1xuICAgICAgfTtcbiAgICAgIHRoaXMuZG9tRWxlbWVudC5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiW3BoaW5hLmpzXSBub3QgZm91bmQgYHswfWAhXCIuZm9ybWF0KHRoaXMuc3JjKSk7XG5cbiAgICAgICAgdmFyIGtleSA9IHNlbGYuc3JjLnNwbGl0KCcvJykubGFzdC5yZXBsYWNlKCcucG5nJywgJycpLnNwbGl0KCc/JykuZmlyc3Quc3BsaXQoJyMnKS5maXJzdDtcbiAgICAgICAgZS50YXJnZXQub25lcnJvciA9IG51bGw7XG4gICAgICAgIGUudGFyZ2V0LnNyYyA9IFwiaHR0cDovL2R1bW15aW1hZ2UuY29tLzEyOHgxMjgvNDQ0NDQ0L2VlZWVlZSZ0ZXh0PVwiICsga2V5O1xuICAgICAgfTtcblxuICAgICAgdGhpcy5kb21FbGVtZW50LnNyYyA9IHRoaXMuc3JjO1xuICAgIH0sXG5cbiAgICBjbG9uZTogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGltYWdlID0gdGhpcy5kb21FbGVtZW50O1xuICAgICAgdmFyIGNhbnZhcyA9IHBoaW5hLmdyYXBoaWNzLkNhbnZhcygpLnNldFNpemUoaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCk7XG4gICAgICB2YXIgdCA9IHBoaW5hLmFzc2V0LlRleHR1cmUoKTtcbiAgICAgIGNhbnZhcy5jb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7XG4gICAgICB0LmRvbUVsZW1lbnQgPSBjYW52YXMuZG9tRWxlbWVudDtcbiAgICAgIHJldHVybiB0O1xuICAgIH0sXG5cbiAgICB0cmFuc21pdDogZnVuY3Rpb24oY29sb3IpIHtcbiAgICAgIC8vIGltYWdh44Kq44OW44K444Kn44Kv44OI44KS44Ky44OD44OIXG4gICAgICB2YXIgaW1hZ2UgPSB0aGlzLmRvbUVsZW1lbnQ7XG4gICAgICAvLyDmlrDopo9jYW52YXPkvZzmiJBcbiAgICAgIHZhciBjYW52YXMgPSBwaGluYS5ncmFwaGljcy5DYW52YXMoKS5zZXRTaXplKGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpO1xuICAgICAgLy8g5paw6KaPY2FudmFz44Gr5o+P55S7XG4gICAgICBjYW52YXMuY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIDApO1xuICAgICAgLy8gY2FudmFz5YWo5L2T44Gu44Kk44Oh44O844K444OH44O844K/6YWN5YiX44KS44Ky44OD44OIXG4gICAgICB2YXIgaW1hZ2VEYXRhID0gY2FudmFzLmNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG4gICAgICB2YXIgZGF0YSA9IGltYWdlRGF0YS5kYXRhO1xuICAgICAgLy8g6YCP6YGO6Imy44Gu5oyH5a6a44GM44Gq44GR44KM44Gw5bem5LiK44Gucmdi5YCk44KS5oq95Ye6XG4gICAgICB2YXIgciA9IChjb2xvciAhPT0gdW5kZWZpbmVkKSA/IGNvbG9yLnIgOiBkYXRhWzBdO1xuICAgICAgdmFyIGcgPSAoY29sb3IgIT09IHVuZGVmaW5lZCkgPyBjb2xvci5nIDogZGF0YVsxXTtcbiAgICAgIHZhciBiID0gKGNvbG9yICE9PSB1bmRlZmluZWQpID8gY29sb3IuYiA6IGRhdGFbMl07XG4gICAgICAvLyDphY3liJfjgpI06KaB57Sg55uu44GL44KJNOOBpOmjm+OBs++8iOOCouODq+ODleOCoeWApO+8ieOBp+ODq+ODvOODl1xuICAgICAgKDMpLnN0ZXAoZGF0YS5sZW5ndGgsIDQsIGZ1bmN0aW9uKGkpIHtcbiAgICAgICAgLy8gcmdi5YCk44KS6YCG566X44Gn44Ky44OD44OI44GX44CB5bem5LiK44Gucmdi44Go5q+U6LyDXG4gICAgICAgIGlmIChkYXRhW2kgLSAzXSA9PT0gciAmJiBkYXRhW2kgLSAyXSA9PT0gZyAmJiBkYXRhW2kgLSAxXSA9PT0gYikge1xuICAgICAgICAgIC8vIOS4gOiHtOOBl+OBn+WgtOWQiOOBr+OCouODq+ODleOCoeWApOOCkuabuOOBjeaPm+OBiOOCi1xuICAgICAgICAgIGRhdGFbaV0gPSAwO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIC8vIOabuOOBjeaPm+OBiOOBn+OCpOODoeODvOOCuOODh+ODvOOCv+OCkmNhbnZhc+OBq+aIu+OBmVxuICAgICAgY2FudmFzLmNvbnRleHQucHV0SW1hZ2VEYXRhKGltYWdlRGF0YSwgMCwgMCk7XG5cbiAgICAgIHRoaXMuZG9tRWxlbWVudCA9IGNhbnZhcy5kb21FbGVtZW50O1xuICAgIH0sXG5cbiAgICBmaWx0ZXI6IGZ1bmN0aW9uIChmaWx0ZXJzKSB7XG4gICAgICBpZiAoIWZpbHRlcnMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9XG4gICAgICBpZiAoIUFycmF5LmlzQXJyYXkoZmlsdGVycykpIHtcbiAgICAgICAgZmlsdGVycyA9IFtmaWx0ZXJzXTtcbiAgICAgIH1cbiAgICAgIHZhciBpbWFnZSA9IHRoaXMuZG9tRWxlbWVudDtcbiAgICAgIHZhciB3ID0gaW1hZ2Uud2lkdGg7XG4gICAgICB2YXIgaCA9IGltYWdlLmhlaWdodDtcbiAgICAgIHZhciBjYW52YXMgPSBwaGluYS5ncmFwaGljcy5DYW52YXMoKS5zZXRTaXplKHcsIGgpO1xuICAgICAgdmFyIGltYWdlRGF0YSA9IG51bGw7XG5cbiAgICAgIGNhbnZhcy5jb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7XG4gICAgICBpbWFnZURhdGEgPSBjYW52YXMuY29udGV4dC5nZXRJbWFnZURhdGEoMCwgMCwgdywgaCk7XG4gICAgICBmaWx0ZXJzLmZvckVhY2goIGZ1bmN0aW9uIChmbikge1xuICAgICAgICBpZiAodHlwZW9mIGZuID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICBoLnRpbWVzKCBmdW5jdGlvbiAoeSkge1xuICAgICAgICAgICAgdy50aW1lcyggZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgICAgdmFyIGkgPSAoeSAqIHcgKyB4KSAqIDQ7XG4gICAgICAgICAgICAgIHZhciBwaXhlbCA9IGltYWdlRGF0YS5kYXRhLnNsaWNlKGksIGkgKyA0KTtcbiAgICAgICAgICAgICAgZm4ocGl4ZWwsIGksIHgsIHksIGltYWdlRGF0YSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBjYW52YXMuY29udGV4dC5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhLCAwLCAwKTtcbiAgICAgIHRoaXMuZG9tRWxlbWVudCA9IGNhbnZhcy5kb21FbGVtZW50O1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICB9KTtcblxufSk7XG5cblxuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5hc3NldC5Tb3VuZFxuICAgKiBAZXh0ZW5kcyBwaGluYS5hc3NldC5Bc3NldFxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5hc3NldC5Tb3VuZCcsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmFzc2V0LkFzc2V0XCIsXG4gICAgXG4gICAgX2xvb3A6IGZhbHNlLFxuICAgIF9sb29wU3RhcnQ6IDAsXG4gICAgX2xvb3BFbmQ6IDAsXG4gICAgX3BsYXliYWNrUmF0ZTogMSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuc3VwZXJJbml0KCk7XG4gICAgICB0aGlzLmNvbnRleHQgPSBwaGluYS5hc3NldC5Tb3VuZC5nZXRBdWRpb0NvbnRleHQoKTtcbiAgICAgIHRoaXMuZ2Fpbk5vZGUgPSB0aGlzLmNvbnRleHQuY3JlYXRlR2FpbigpO1xuICAgIH0sXG5cbiAgICBwbGF5OiBmdW5jdGlvbih3aGVuLCBvZmZzZXQsIGR1cmF0aW9uKSB7XG4gICAgICB3aGVuID0gd2hlbiA/IHdoZW4gKyB0aGlzLmNvbnRleHQuY3VycmVudFRpbWUgOiAwO1xuICAgICAgb2Zmc2V0ID0gb2Zmc2V0IHx8IDA7XG5cbiAgICAgIGlmICh0aGlzLnNvdXJjZSkge1xuICAgICAgICAvLyBUT0RPOiDjgq3jg6Pjg4Pjgrfjg6XjgZnjgovvvJ9cbiAgICAgIH1cblxuICAgICAgdmFyIHNvdXJjZSA9IHRoaXMuc291cmNlID0gdGhpcy5jb250ZXh0LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpO1xuICAgICAgdmFyIGJ1ZmZlciA9IHNvdXJjZS5idWZmZXIgPSB0aGlzLmJ1ZmZlcjtcbiAgICAgIHNvdXJjZS5sb29wID0gdGhpcy5fbG9vcDtcbiAgICAgIHNvdXJjZS5sb29wU3RhcnQgPSB0aGlzLl9sb29wU3RhcnQ7XG4gICAgICBzb3VyY2UubG9vcEVuZCA9IHRoaXMuX2xvb3BFbmQ7XG4gICAgICBzb3VyY2UucGxheWJhY2tSYXRlLnZhbHVlID0gdGhpcy5fcGxheWJhY2tSYXRlO1xuXG4gICAgICAvLyBjb25uZWN0XG4gICAgICBzb3VyY2UuY29ubmVjdCh0aGlzLmdhaW5Ob2RlKTtcbiAgICAgIHRoaXMuZ2Fpbk5vZGUuY29ubmVjdChwaGluYS5hc3NldC5Tb3VuZC5nZXRNYXN0ZXJHYWluKCkpO1xuICAgICAgLy8gcGxheVxuICAgICAgaWYgKGR1cmF0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgc291cmNlLnN0YXJ0KHdoZW4sIG9mZnNldCwgZHVyYXRpb24pO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHNvdXJjZS5zdGFydCh3aGVuLCBvZmZzZXQpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBjaGVjayBwbGF5IGVuZFxuICAgICAgc291cmNlLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZGVkJywgZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5mbGFyZSgnZW5kZWQnKTtcbiAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBzdG9wOiBmdW5jdGlvbigpIHtcbiAgICAgIC8vIHN0b3BcbiAgICAgIGlmICh0aGlzLnNvdXJjZSkge1xuICAgICAgICAvLyBzdG9wIOOBmeOCi+OBqCBzb3VyY2UuZW5kZWTjgoLnmbrngavjgZnjgotcbiAgICAgICAgdGhpcy5zb3VyY2Uuc3RvcCAmJiB0aGlzLnNvdXJjZS5zdG9wKDApO1xuICAgICAgICB0aGlzLnNvdXJjZSA9IG51bGw7XG4gICAgICAgIHRoaXMuZmxhcmUoJ3N0b3AnKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIHBhdXNlOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuc291cmNlLnBsYXliYWNrUmF0ZS52YWx1ZSA9IDA7XG4gICAgICB0aGlzLmZsYXJlKCdwYXVzZScpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIHJlc3VtZTogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnNvdXJjZS5wbGF5YmFja1JhdGUudmFsdWUgPSB0aGlzLl9wbGF5YmFja1JhdGU7XG4gICAgICB0aGlzLmZsYXJlKCdyZXN1bWUnKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvLyDoqabjgZfjgabjgb/jgovjgarjgYZcbiAgICBfb3NjaWxsYXRvcjogZnVuY3Rpb24odHlwZSkge1xuICAgICAgdmFyIGNvbnRleHQgPSB0aGlzLmNvbnRleHQ7XG5cbiAgICAgIHZhciBvc2NpbGxhdG9yID0gY29udGV4dC5jcmVhdGVPc2NpbGxhdG9yKCk7XG5cbiAgICAgIC8vIFNpbmUgd2F2ZSBpcyB0eXBlID0g4oCcc2luZeKAnVxuICAgICAgLy8gU3F1YXJlIHdhdmUgaXMgdHlwZSA9IOKAnHNxdWFyZeKAnVxuICAgICAgLy8gU2F3dG9vdGggd2F2ZSBpcyB0eXBlID0g4oCcc2F34oCdXG4gICAgICAvLyBUcmlhbmdsZSB3YXZlIGlzIHR5cGUgPSDigJx0cmlhbmdsZeKAnVxuICAgICAgLy8gQ3VzdG9tIHdhdmUgaXMgdHlwZSA9IOKAnGN1c3RvbeKAnSBcbiAgICAgIG9zY2lsbGF0b3IudHlwZSA9IHR5cGUgfHwgJ3NpbmUnO1xuXG4gICAgICB0aGlzLnNvdXJjZSA9IG9zY2lsbGF0b3I7XG4gICAgICAvLyBjb25uZWN0XG4gICAgICB0aGlzLnNvdXJjZS5jb25uZWN0KGNvbnRleHQuZGVzdGluYXRpb24pO1xuICAgIH0sXG5cbiAgICBsb2FkRnJvbUJ1ZmZlcjogZnVuY3Rpb24oYnVmZmVyKSB7XG4gICAgICB2YXIgY29udGV4dCA9IHRoaXMuY29udGV4dDtcblxuICAgICAgLy8gc2V0IGRlZmF1bHQgYnVmZmVyXG4gICAgICBpZiAoIWJ1ZmZlcikge1xuICAgICAgICBidWZmZXIgPSBjb250ZXh0LmNyZWF0ZUJ1ZmZlciggMSwgNDQxMDAsIDQ0MTAwICk7XG4gICAgICAgIHZhciBjaGFubmVsID0gYnVmZmVyLmdldENoYW5uZWxEYXRhKDApO1xuXG4gICAgICAgIGZvciggdmFyIGk9MDsgaSA8IGNoYW5uZWwubGVuZ3RoOyBpKysgKVxuICAgICAgICB7XG4gICAgICAgICAgY2hhbm5lbFtpXSA9IE1hdGguc2luKCBpIC8gMTAwICogTWF0aC5QSSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gc291cmNlXG4gICAgICB0aGlzLmJ1ZmZlciA9IGJ1ZmZlcjtcbiAgICB9LFxuXG4gICAgc2V0TG9vcDogZnVuY3Rpb24obG9vcCkge1xuICAgICAgdGhpcy5sb29wID0gbG9vcDtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgc2V0TG9vcFN0YXJ0OiBmdW5jdGlvbihsb29wU3RhcnQpIHtcbiAgICAgIHRoaXMubG9vcFN0YXJ0ID0gbG9vcFN0YXJ0O1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBzZXRMb29wRW5kOiBmdW5jdGlvbihsb29wRW5kKSB7XG4gICAgICB0aGlzLmxvb3BFbmQgPSBsb29wRW5kO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBcbiAgICBzZXRQbGF5YmFja1JhdGU6IGZ1bmN0aW9uKHBsYXliYWNrUmF0ZSkge1xuICAgICAgdGhpcy5wbGF5YmFja1JhdGUgPSBwbGF5YmFja1JhdGU7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgX2xvYWQ6IGZ1bmN0aW9uKHIpIHtcbiAgICAgIGlmICgvXmRhdGE6Ly50ZXN0KHRoaXMuc3JjKSkge1xuICAgICAgICB0aGlzLl9sb2FkRnJvbVVSSVNjaGVtZShyKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLl9sb2FkRnJvbUZpbGUocik7XG4gICAgICB9XG4gICAgfSxcblxuICAgIF9sb2FkRnJvbUZpbGU6IGZ1bmN0aW9uKHIpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgdmFyIHhtbCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgeG1sLm9wZW4oJ0dFVCcsIHRoaXMuc3JjKTtcbiAgICAgIHhtbC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHhtbC5yZWFkeVN0YXRlID09PSA0KSB7XG4gICAgICAgICAgaWYgKFsyMDAsIDIwMSwgMF0uaW5kZXhPZih4bWwuc3RhdHVzKSAhPT0gLTEpIHtcblxuICAgICAgICAgICAgLy8g6Z+z5qW944OQ44Kk44OK44Oq44O844OH44O844K/XG4gICAgICAgICAgICB2YXIgZGF0YSA9IHhtbC5yZXNwb25zZTtcblxuICAgICAgICAgICAgLy8gd2ViYXVkaW8g55So44Gr5aSJ5o+bXG4gICAgICAgICAgICBzZWxmLmNvbnRleHQuZGVjb2RlQXVkaW9EYXRhKGRhdGEsIGZ1bmN0aW9uKGJ1ZmZlcikge1xuICAgICAgICAgICAgICBzZWxmLmxvYWRGcm9tQnVmZmVyKGJ1ZmZlcik7XG4gICAgICAgICAgICAgIHIoc2VsZik7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgY29uc29sZS53YXJuKFwi6Z+z5aOw44OV44Kh44Kk44Or44Gu44OH44Kz44O844OJ44Gr5aSx5pWX44GX44G+44GX44Gf44CCKFwiICsgc2VsZi5zcmMgKyBcIilcIik7XG4gICAgICAgICAgICAgIHIoc2VsZik7XG4gICAgICAgICAgICAgIHNlbGYuZmxhcmUoJ2RlY29kZWVycm9yJyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgIH0gZWxzZSBpZiAoeG1sLnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICAgICAgICAvLyBub3QgZm91bmRcblxuICAgICAgICAgICAgc2VsZi5sb2FkRXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgc2VsZi5ub3RGb3VuZD0gdHJ1ZTtcbiAgICAgICAgICAgIHIoc2VsZik7XG4gICAgICAgICAgICBzZWxmLmZsYXJlKCdsb2FkZXJyb3InKTtcbiAgICAgICAgICAgIHNlbGYuZmxhcmUoJ25vdGZvdW5kJyk7XG5cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8g44K144O844OQ44O844Ko44Op44O8XG5cbiAgICAgICAgICAgIHNlbGYubG9hZEVycm9yID0gdHJ1ZTtcbiAgICAgICAgICAgIHNlbGYuc2VydmVyRXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgcihzZWxmKTtcbiAgICAgICAgICAgIHNlbGYuZmxhcmUoJ2xvYWRlcnJvcicpO1xuICAgICAgICAgICAgc2VsZi5mbGFyZSgnc2VydmVyZXJyb3InKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHhtbC5yZXNwb25zZVR5cGUgPSAnYXJyYXlidWZmZXInO1xuXG4gICAgICB4bWwuc2VuZChudWxsKTtcbiAgICB9LFxuXG4gICAgX2xvYWRGcm9tVVJJU2NoZW1lOiBmdW5jdGlvbihyKSB7XG4gICAgICB2YXIgYnl0ZVN0cmluZyA9ICcnO1xuICAgICAgaWYgKHRoaXMuc3JjLnNwbGl0KCcsJylbMF0uaW5kZXhPZignYmFzZTY0JykgPj0gMCkge1xuICAgICAgICBieXRlU3RyaW5nID0gYXRvYih0aGlzLnNyYy5zcGxpdCgnLCcpWzFdKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBieXRlU3RyaW5nID0gdW5lc2NhcGUodGhpcy5zcmMuc3BsaXQoJywnKVsxXSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIHZhciBsZW4gPSBieXRlU3RyaW5nLmxlbmd0aDtcbiAgICAgIHZhciBidWZmZXIgPSBuZXcgVWludDhBcnJheShsZW4pO1xuXG4gICAgICBmb3IgKHZhciBpPTA7IGk8bGVuOyArK2kpIHtcbiAgICAgICAgYnVmZmVyW2ldID0gYnl0ZVN0cmluZy5jaGFyQ29kZUF0KGkpO1xuICAgICAgfVxuXG4gICAgICAvLyB3ZWJhdWRpbyDnlKjjgavlpInmj5tcbiAgICAgIHRoaXMuY29udGV4dC5kZWNvZGVBdWRpb0RhdGEoYnVmZmVyLmJ1ZmZlciwgZnVuY3Rpb24oYnVmZmVyKSB7XG4gICAgICAgIHNlbGYubG9hZEZyb21CdWZmZXIoYnVmZmVyKTtcbiAgICAgICAgcihzZWxmKTtcbiAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICBjb25zb2xlLndhcm4oXCLpn7Plo7Djg5XjgqHjgqTjg6vjga7jg4fjgrPjg7zjg4njgavlpLHmlZfjgZfjgb7jgZfjgZ/jgIIoXCIgKyBzZWxmLnNyYyArIFwiKVwiKTtcbiAgICAgICAgc2VsZi5sb2FkZWQgPSB0cnVlO1xuICAgICAgICByKHNlbGYpO1xuICAgICAgfSk7XG4gICAgfSxcblxuICAgIGxvYWREdW1teTogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmxvYWRGcm9tQnVmZmVyKCk7XG4gICAgfSxcblxuICAgIF9hY2Nlc3Nvcjoge1xuICAgICAgdm9sdW1lOiB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSAgeyByZXR1cm4gdGhpcy5nYWluTm9kZS5nYWluLnZhbHVlOyB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHsgdGhpcy5nYWluTm9kZS5nYWluLnZhbHVlID0gdjsgfSxcbiAgICAgIH0sXG4gICAgICBsb29wOiB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSAgeyByZXR1cm4gdGhpcy5fbG9vcDsgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbih2KSB7XG4gICAgICAgICAgdGhpcy5fbG9vcCA9IHY7XG4gICAgICAgICAgaWYgKHRoaXMuc291cmNlKSB0aGlzLnNvdXJjZS5fbG9vcCA9IHY7XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgbG9vcFN0YXJ0OiB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSAgeyByZXR1cm4gdGhpcy5fbG9vcFN0YXJ0OyB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgICB0aGlzLl9sb29wU3RhcnQgPSB2O1xuICAgICAgICAgIGlmICh0aGlzLnNvdXJjZSkgdGhpcy5zb3VyY2UuX2xvb3BTdGFydCA9IHY7XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgbG9vcEVuZDoge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgIHsgcmV0dXJuIHRoaXMuX2xvb3BFbmQ7IH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24odikge1xuICAgICAgICAgIHRoaXMuX2xvb3BFbmQgPSB2O1xuICAgICAgICAgIGlmICh0aGlzLnNvdXJjZSkgdGhpcy5zb3VyY2UuX2xvb3BFbmQgPSB2O1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHBsYXliYWNrUmF0ZToge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5fcGxheWJhY2tSYXRlOyB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgICB0aGlzLl9wbGF5YmFja1JhdGUgPSB2O1xuICAgICAgICAgIGlmKHRoaXMuc291cmNlICYmIHRoaXMuc291cmNlLnBsYXliYWNrUmF0ZS52YWx1ZSAhPT0gMCl7XG4gICAgICAgICAgICB0aGlzLnNvdXJjZS5wbGF5YmFja1JhdGUudmFsdWUgPSB2O1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX2RlZmluZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5hY2Nlc3Nvcigndm9sdW1lJywge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLmdldE1hc3RlckdhaW4oKS5nYWluLnZhbHVlO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgICB0aGlzLmdldE1hc3RlckdhaW4oKS5nYWluLnZhbHVlID0gdjtcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgXG4gICAgfSxcbiAgICBcbiAgICBfc3RhdGljOiB7XG4gICAgICBcbiAgICAgIGdldE1hc3RlckdhaW46IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZighdGhpcy5fbWFzdGVyR2Fpbikge1xuICAgICAgICAgIHZhciBjb250ZXh0ID0gdGhpcy5nZXRBdWRpb0NvbnRleHQoKTtcbiAgICAgICAgICB0aGlzLl9tYXN0ZXJHYWluID0gY29udGV4dC5jcmVhdGVHYWluKCk7XG4gICAgICAgICAgdGhpcy5fbWFzdGVyR2Fpbi5jb25uZWN0KGNvbnRleHQuZGVzdGluYXRpb24pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9tYXN0ZXJHYWluO1xuICAgICAgfSxcbiAgICAgIFxuICAgICAgZ2V0QXVkaW9Db250ZXh0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCFwaGluYS51dGlsLlN1cHBvcnQud2ViQXVkaW8pIHJldHVybiBudWxsO1xuXG4gICAgICAgIGlmICh0aGlzLmNvbnRleHQpIHJldHVybiB0aGlzLmNvbnRleHQ7XG5cbiAgICAgICAgdmFyIGcgPSBwaGluYS5nbG9iYWw7XG4gICAgICAgIHZhciBjb250ZXh0ID0gbnVsbDtcblxuICAgICAgICBpZiAoZy5BdWRpb0NvbnRleHQpIHtcbiAgICAgICAgICBjb250ZXh0ID0gbmV3IEF1ZGlvQ29udGV4dCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGcud2Via2l0QXVkaW9Db250ZXh0KSB7XG4gICAgICAgICAgY29udGV4dCA9IG5ldyB3ZWJraXRBdWRpb0NvbnRleHQoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChnLm1vekF1ZGlvQ29udGV4dCkge1xuICAgICAgICAgIGNvbnRleHQgPSBuZXcgbW96QXVkaW9Db250ZXh0KCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0O1xuXG4gICAgICAgIHJldHVybiBjb250ZXh0O1xuICAgICAgfSxcbiAgICB9LFxuXG4gIH0pO1xuXG59KTtcblxuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5hc3NldC5Tb3VuZE1hbmFnZXJcbiAgICogIyMjIFJlZlxuICAgKiAtIGh0dHA6Ly9ldm9sdmUucmVpbnRyb2R1Y2luZy5jb20vX3NvdXJjZS9jbGFzc2VzL2FzMy9Tb3VuZE1hbmFnZXIvU291bmRNYW5hZ2VyLmh0bWxcbiAgICogLSBodHRwczovL2dpdGh1Yi5jb20vbmlja2xvY2t3b29kL1NvdW5kTWFuYWdlclxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5hc3NldC5Tb3VuZE1hbmFnZXInLCB7XG4gICAgX3N0YXRpYzoge1xuICAgICAgdm9sdW1lOiAwLjgsXG4gICAgICBtdXNpY1ZvbHVtZTogMC44LFxuICAgICAgbXV0ZUZsYWc6IGZhbHNlLFxuICAgICAgY3VycmVudE11c2ljOiBudWxsLFxuXG4gICAgICBwbGF5OiBmdW5jdGlvbihuYW1lLCB3aGVuLCBvZmZzZXQsIGR1cmF0aW9uKSB7XG4gICAgICAgIHZhciBzb3VuZCA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoJ3NvdW5kJywgbmFtZSk7XG5cbiAgICAgICAgc291bmQudm9sdW1lID0gdGhpcy5nZXRWb2x1bWUoKTtcbiAgICAgICAgc291bmQucGxheSh3aGVuLCBvZmZzZXQsIGR1cmF0aW9uKTtcblxuICAgICAgICByZXR1cm4gc291bmQ7XG4gICAgICB9LFxuXG4gICAgICBzdG9wOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gVE9ETzogXG4gICAgICB9LFxuICAgICAgcGF1c2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBUT0RPOiBcbiAgICAgIH0sXG4gICAgICBmYWRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gVE9ETzogXG4gICAgICB9LFxuICAgICAgc2V0Vm9sdW1lOiBmdW5jdGlvbih2b2x1bWUpIHtcbiAgICAgICAgdGhpcy52b2x1bWUgPSB2b2x1bWU7XG4gICAgICB9LFxuICAgICAgZ2V0Vm9sdW1lOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudm9sdW1lO1xuICAgICAgfSxcblxuICAgICAgLypcbiAgICAgICAqIOODn+ODpeODvOODiFxuICAgICAgICovXG4gICAgICBtdXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5tdXRlRmxhZyA9IHRydWU7XG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRNdXNpYykge1xuICAgICAgICAgIHRoaXMuY3VycmVudE11c2ljLnZvbHVtZSA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9LFxuICAgICAgLypcbiAgICAgICAqIOODn+ODpeODvOODiOino+mZpFxuICAgICAgICovXG4gICAgICB1bm11dGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLm11dGVGbGFnID0gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRNdXNpYykge1xuICAgICAgICAgIHRoaXMuY3VycmVudE11c2ljLnZvbHVtZSA9IHRoaXMuZ2V0Vm9sdW1lTXVzaWMoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH0sXG4gICAgICBpc011dGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tdXRlRmxhZztcbiAgICAgIH0sXG5cbiAgICAgIHBsYXlNdXNpYzogZnVuY3Rpb24obmFtZSwgZmFkZVRpbWUsIGxvb3AsIHdoZW4sIG9mZnNldCwgZHVyYXRpb24pIHtcbiAgICAgICAgbG9vcCA9IChsb29wICE9PSB1bmRlZmluZWQpID8gbG9vcCA6IHRydWU7XG5cbiAgICAgICAgaWYgKHRoaXMuY3VycmVudE11c2ljKSB7XG4gICAgICAgICAgdGhpcy5zdG9wTXVzaWMoZmFkZVRpbWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIG11c2ljID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgnc291bmQnLCBuYW1lKTtcblxuICAgICAgICBtdXNpYy5zZXRMb29wKGxvb3ApO1xuICAgICAgICBtdXNpYy5wbGF5KHdoZW4sIG9mZnNldCwgZHVyYXRpb24pO1xuXG4gICAgICAgIGlmIChmYWRlVGltZSA+IDApIHtcbiAgICAgICAgICB2YXIgY291bnQgPSAzMjtcbiAgICAgICAgICB2YXIgY291bnRlciA9IDA7XG4gICAgICAgICAgdmFyIHVuaXRUaW1lID0gZmFkZVRpbWUvY291bnQ7XG4gICAgICAgICAgdmFyIHZvbHVtZSA9IHRoaXMuZ2V0Vm9sdW1lTXVzaWMoKTtcblxuICAgICAgICAgIG11c2ljLnZvbHVtZSA9IDA7XG4gICAgICAgICAgdmFyIGlkID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb3VudGVyICs9IDE7XG4gICAgICAgICAgICB2YXIgcmF0ZSA9IGNvdW50ZXIvY291bnQ7XG4gICAgICAgICAgICBtdXNpYy52b2x1bWUgPSByYXRlKnZvbHVtZTtcblxuICAgICAgICAgICAgaWYgKHJhdGUgPj0gMSkge1xuICAgICAgICAgICAgICBjbGVhckludGVydmFsKGlkKTtcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9LCB1bml0VGltZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgbXVzaWMudm9sdW1lID0gdGhpcy5nZXRWb2x1bWVNdXNpYygpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jdXJyZW50TXVzaWMgPSBtdXNpYztcblxuICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50TXVzaWM7XG4gICAgICB9LFxuXG4gICAgICBzdG9wTXVzaWM6IGZ1bmN0aW9uKGZhZGVUaW1lKSB7XG4gICAgICAgIGlmICghdGhpcy5jdXJyZW50TXVzaWMpIHsgcmV0dXJuIDsgfVxuXG4gICAgICAgIHZhciBtdXNpYyA9IHRoaXMuY3VycmVudE11c2ljO1xuICAgICAgICB0aGlzLmN1cnJlbnRNdXNpYyA9IG51bGw7XG5cbiAgICAgICAgaWYgKGZhZGVUaW1lID4gMCkge1xuICAgICAgICAgIHZhciBjb3VudCA9IDMyO1xuICAgICAgICAgIHZhciBjb3VudGVyID0gMDtcbiAgICAgICAgICB2YXIgdW5pdFRpbWUgPSBmYWRlVGltZS9jb3VudDtcbiAgICAgICAgICB2YXIgdm9sdW1lID0gdGhpcy5nZXRWb2x1bWVNdXNpYygpO1xuXG4gICAgICAgICAgbXVzaWMudm9sdW1lID0gMDtcbiAgICAgICAgICB2YXIgaWQgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvdW50ZXIgKz0gMTtcbiAgICAgICAgICAgIHZhciByYXRlID0gY291bnRlci9jb3VudDtcbiAgICAgICAgICAgIG11c2ljLnZvbHVtZSA9IHZvbHVtZSooMS1yYXRlKTtcblxuICAgICAgICAgICAgaWYgKHJhdGUgPj0gMSkge1xuICAgICAgICAgICAgICBtdXNpYy5zdG9wKCk7XG4gICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaWQpO1xuICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH0sIHVuaXRUaW1lKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBtdXNpYy5zdG9wKCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG5cbiAgICAgIC8qXG4gICAgICAgKiDpn7Pmpb3jgpLkuIDmmYLlgZzmraJcbiAgICAgICAqL1xuICAgICAgcGF1c2VNdXNpYzogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICghdGhpcy5jdXJyZW50TXVzaWMpIHsgcmV0dXJuIDsgfVxuICAgICAgICB0aGlzLmN1cnJlbnRNdXNpYy5wYXVzZSgpO1xuICAgICAgfSxcbiAgICAgIC8qXG4gICAgICAgKiDpn7Pmpb3jgpLlho3plotcbiAgICAgICAqL1xuICAgICAgcmVzdW1lTXVzaWM6IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoIXRoaXMuY3VycmVudE11c2ljKSB7IHJldHVybiA7IH1cbiAgICAgICAgdGhpcy5jdXJyZW50TXVzaWMucmVzdW1lKCk7XG4gICAgICB9LFxuICAgICAgLypcbiAgICAgICAqIOmfs+alveOBruODnOODquODpeODvOODoOOCkuioreWumlxuICAgICAgICovXG4gICAgICBzZXRWb2x1bWVNdXNpYzogZnVuY3Rpb24odm9sdW1lKSB7XG4gICAgICAgIHRoaXMubXVzaWNWb2x1bWUgPSB2b2x1bWU7XG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRNdXNpYykge1xuICAgICAgICAgIHRoaXMuY3VycmVudE11c2ljLnZvbHVtZSA9IHZvbHVtZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfSxcbiAgICAgIC8qXG4gICAgICAgKiDpn7Pmpb3jga7jg5zjg6rjg6Xjg7zjg6DjgpLlj5blvpdcbiAgICAgICAqL1xuICAgICAgZ2V0Vm9sdW1lTXVzaWM6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tdXNpY1ZvbHVtZTtcbiAgICAgIH0sXG5cbiAgICB9LFxuICB9KTtcblxufSk7XG5cblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEuYXNzZXQuU3ByaXRlU2hlZXRcbiAgICogQGV4dGVuZHMgcGhpbmEuYXNzZXQuQXNzZXRcbiAgICovXG4gIHBoaW5hLmRlZmluZSgncGhpbmEuYXNzZXQuU3ByaXRlU2hlZXQnLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5hc3NldC5Bc3NldFwiLFxuXG4gICAgLyoqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnN1cGVySW5pdCgpO1xuICAgIH0sXG5cbiAgICBzZXR1cDogZnVuY3Rpb24ocGFyYW1zKSB7XG4gICAgICB0aGlzLl9zZXR1cEZyYW1lKHBhcmFtcy5mcmFtZSk7XG4gICAgICB0aGlzLl9zZXR1cEFuaW0ocGFyYW1zLmFuaW1hdGlvbnMpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIF9sb2FkOiBmdW5jdGlvbihyZXNvbHZlKSB7XG5cbiAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgaWYgKHR5cGVvZiB0aGlzLnNyYyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgdmFyIHhtbCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICB4bWwub3BlbignR0VUJywgdGhpcy5zcmMpO1xuICAgICAgICB4bWwub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYgKHhtbC5yZWFkeVN0YXRlID09PSA0KSB7XG4gICAgICAgICAgICBpZiAoWzIwMCwgMjAxLCAwXS5pbmRleE9mKHhtbC5zdGF0dXMpICE9PSAtMSkge1xuICAgICAgICAgICAgICB2YXIgZGF0YSA9IHhtbC5yZXNwb25zZVRleHQ7XG4gICAgICAgICAgICAgIHZhciBqc29uID0gSlNPTi5wYXJzZShkYXRhKTtcblxuICAgICAgICAgICAgICBzZWxmLnNldHVwKGpzb24pO1xuXG4gICAgICAgICAgICAgIHJlc29sdmUoc2VsZik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHhtbC5zZW5kKG51bGwpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuc2V0dXAodGhpcy5zcmMpO1xuICAgICAgICByZXNvbHZlKHNlbGYpO1xuICAgICAgfVxuXG4gICAgfSxcblxuICAgIF9zZXR1cEZyYW1lOiBmdW5jdGlvbihmcmFtZSkge1xuICAgICAgdmFyIGZyYW1lcyA9IHRoaXMuZnJhbWVzID0gW107XG4gICAgICB2YXIgdW5pdFdpZHRoID0gZnJhbWUud2lkdGg7XG4gICAgICB2YXIgdW5pdEhlaWdodCA9IGZyYW1lLmhlaWdodDtcblxuICAgICAgdmFyIGNvdW50ID0gZnJhbWUucm93cyAqIGZyYW1lLmNvbHM7XG4gICAgICB0aGlzLmZyYW1lID0gY291bnQ7XG5cbiAgICAgIChjb3VudCkudGltZXMoZnVuY3Rpb24oaSkge1xuICAgICAgICB2YXIgeEluZGV4ID0gaSVmcmFtZS5jb2xzO1xuICAgICAgICB2YXIgeUluZGV4ID0gKGkvZnJhbWUuY29scyl8MDtcblxuICAgICAgICBmcmFtZXMucHVzaCh7XG4gICAgICAgICAgeDogeEluZGV4KnVuaXRXaWR0aCxcbiAgICAgICAgICB5OiB5SW5kZXgqdW5pdEhlaWdodCxcbiAgICAgICAgICB3aWR0aDogdW5pdFdpZHRoLFxuICAgICAgICAgIGhlaWdodDogdW5pdEhlaWdodCxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgX3NldHVwQW5pbTogZnVuY3Rpb24oYW5pbWF0aW9ucykge1xuICAgICAgdGhpcy5hbmltYXRpb25zID0ge307XG5cbiAgICAgIC8vIOODh+ODleOCqeODq+ODiOOCouODi+ODoeODvOOCt+ODp+ODs1xuICAgICAgdGhpcy5hbmltYXRpb25zW1wiZGVmYXVsdFwiXSA9IHtcbiAgICAgICAgICBmcmFtZXM6IFtdLnJhbmdlKDAsIHRoaXMuZnJhbWUpLFxuICAgICAgICAgIG5leHQ6IFwiZGVmYXVsdFwiLFxuICAgICAgICAgIGZyZXF1ZW5jeTogMSxcbiAgICAgIH07XG5cbiAgICAgIGFuaW1hdGlvbnMuZm9ySW4oZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuICAgICAgICB2YXIgYW5pbSA9IHZhbHVlO1xuXG4gICAgICAgIGlmIChhbmltIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICB0aGlzLmFuaW1hdGlvbnNba2V5XSA9IHtcbiAgICAgICAgICAgIGZyYW1lczogW10ucmFuZ2UoYW5pbVswXSwgYW5pbVsxXSksXG4gICAgICAgICAgICBuZXh0OiBhbmltWzJdLFxuICAgICAgICAgICAgZnJlcXVlbmN5OiBhbmltWzNdIHx8IDEsXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICB0aGlzLmFuaW1hdGlvbnNba2V5XSA9IHtcbiAgICAgICAgICAgIGZyYW1lczogYW5pbS5mcmFtZXMsXG4gICAgICAgICAgICBuZXh0OiBhbmltLm5leHQsXG4gICAgICAgICAgICBmcmVxdWVuY3k6IGFuaW0uZnJlcXVlbmN5IHx8IDFcbiAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgIH0sIHRoaXMpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDjg5Xjg6zjg7zjg6DjgpLlj5blvpdcbiAgICAgKi9cbiAgICBnZXRGcmFtZTogZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgIHJldHVybiB0aGlzLmZyYW1lc1tpbmRleF07XG4gICAgfSxcblxuICAgIGdldEFuaW1hdGlvbjogZnVuY3Rpb24obmFtZSkge1xuICAgICAgbmFtZSA9IChuYW1lICE9PSB1bmRlZmluZWQpID8gbmFtZSA6IFwiZGVmYXVsdFwiO1xuICAgICAgcmV0dXJuIHRoaXMuYW5pbWF0aW9uc1tuYW1lXTtcbiAgICB9LFxuXG4gIH0pO1xuXG59KTtcblxuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5hc3NldC5Gb250XG4gICAqIEBleHRlbmRzIHBoaW5hLmFzc2V0LkFzc2V0XG4gICAqL1xuICBwaGluYS5kZWZpbmUoXCJwaGluYS5hc3NldC5Gb250XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmFzc2V0LkFzc2V0XCIsXG5cbiAgICAvKipcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuc3VwZXJJbml0KCk7XG4gICAgICB0aGlzLmZvbnROYW1lID0gbnVsbDtcbiAgICB9LFxuXG4gICAgbG9hZDogZnVuY3Rpb24ocGF0aCkge1xuICAgICAgdGhpcy5zcmMgPSBwYXRoO1xuXG4gICAgICB2YXIgcmVnID0gLyguKikoPzpcXC4oW14uXSskKSkvO1xuICAgICAgdmFyIGtleSA9IHRoaXMuZm9udE5hbWUgfHwgcGF0aC5tYXRjaChyZWcpWzFdLnNwbGl0KCcvJykubGFzdDsgICAgLy/jg5Xjgqnjg7Pjg4jlkI3mjIflrprjgYznhKHjgYTloLTlkIjjga9wYXRo44Gu5ouh5by15a2Q5YmN44KS5L2/55SoXG4gICAgICB2YXIgdHlwZSA9IHBhdGgubWF0Y2gocmVnKVsyXTtcbiAgICAgIHZhciBmb3JtYXQgPSBcInVua25vd25cIjtcbiAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlIFwidHRmXCI6XG4gICAgICAgICAgZm9ybWF0ID0gXCJ0cnVldHlwZVwiOyBicmVhaztcbiAgICAgICAgY2FzZSBcIm90ZlwiOlxuICAgICAgICAgIGZvcm1hdCA9IFwib3BlbnR5cGVcIjsgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJ3b2ZmXCI6XG4gICAgICAgICAgZm9ybWF0ID0gXCJ3b2ZmXCI7IGJyZWFrO1xuICAgICAgICBjYXNlIFwid29mZjJcIjpcbiAgICAgICAgICBmb3JtYXQgPSBcIndvZmYyXCI7IGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGNvbnNvbGUud2FybihcIuOCteODneODvOODiOOBl+OBpuOBhOOBquOBhOODleOCqeODs+ODiOW9ouW8j+OBp+OBmeOAgihcIiArIHBhdGggKyBcIilcIik7XG4gICAgICB9XG4gICAgICB0aGlzLmZvcm1hdCA9IGZvcm1hdDtcbiAgICAgIHRoaXMuZm9udE5hbWUgPSBrZXk7XG5cbiAgICAgIGlmIChmb3JtYXQgIT09IFwidW5rbm93blwiKSB7XG4gICAgICAgIHZhciB0ZXh0ID0gXCJAZm9udC1mYWNlIHsgZm9udC1mYW1pbHk6ICd7MH0nOyBzcmM6IHVybCh7MX0pIGZvcm1hdCgnezJ9Jyk7IH1cIi5mb3JtYXQoa2V5LCBwYXRoLCBmb3JtYXQpO1xuICAgICAgICB2YXIgZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJoZWFkXCIpO1xuICAgICAgICB2YXIgZm9udEZhY2VTdHlsZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3R5bGVcIik7XG4gICAgICAgIGlmIChmb250RmFjZVN0eWxlRWxlbWVudC5pbm5lclRleHQpIHtcbiAgICAgICAgICBmb250RmFjZVN0eWxlRWxlbWVudC5pbm5lclRleHQgPSB0ZXh0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGZvbnRGYWNlU3R5bGVFbGVtZW50LnRleHRDb250ZW50ID0gdGV4dDtcbiAgICAgICAgfVxuICAgICAgICBlLmFwcGVuZENoaWxkKGZvbnRGYWNlU3R5bGVFbGVtZW50KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHBoaW5hLnV0aWwuRmxvdyh0aGlzLl9sb2FkLmJpbmQodGhpcykpO1xuICAgIH0sXG5cbiAgICBfbG9hZDogZnVuY3Rpb24ocmVzb2x2ZSkge1xuICAgICAgaWYgKHRoaXMuZm9ybWF0ICE9PSBcInVua25vd25cIikge1xuICAgICAgICB0aGlzLl9jaGVja0xvYWRlZCh0aGlzLmZvbnROYW1lLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICB0aGlzLmxvYWRlZCA9IHRydWU7XG4gICAgICAgICAgcmVzb2x2ZSh0aGlzKTtcbiAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgcmVzb2x2ZSh0aGlzKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX2NoZWNrTG9hZGVkOiBmdW5jdGlvbiAoZm9udCwgY2FsbGJhY2spIHtcbiAgICAgIHZhciBjYW52YXMgPSBwaGluYS5ncmFwaGljcy5DYW52YXMoKTtcbiAgICAgIHZhciBERUZBVUxUX0ZPTlQgPSBjYW52YXMuY29udGV4dC5mb250LnNwbGl0KCcgJylbMV07XG4gICAgICBjYW52YXMuY29udGV4dC5mb250ID0gJzQwcHggJyArIERFRkFVTFRfRk9OVDtcblxuICAgICAgdmFyIGNoZWNrVGV4dCA9IFwiMTIzNDU2Nzg5MC1eXFxcXHF3ZXJ0eXVpb3BAW2FzZGZnaGprbDs6XXp4Y3Zibm0sLi9cXCFcXFwiIyQlJicoKT1+fFFXRVJUWVVJT1Bge0FTREZHSEpLTCsqfVpYQ1ZCTk08Pj9f77yR77yS77yT77yU77yV77yW77yX77yY77yZ77yQ77yN77y+77+l772R772X772F772S772U772Z772V772J772P772Q772B772T772E772G772H772I772K772L772M772a772Y772D772W772C772O772N77yM77yO44GC44GE44GG44GL44GV44Gf44Gq44KS44KT5pmC44Gv6YeR44Gq44KKXCI7XG4gICAgICAvLyDnibnmrormloflrZflr77lv5xcbiAgICAgIGNoZWNrVGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKFwiMHhmMDRiXCIpO1xuXG4gICAgICB2YXIgYmVmb3JlID0gY2FudmFzLmNvbnRleHQubWVhc3VyZVRleHQoY2hlY2tUZXh0KS53aWR0aDtcbiAgICAgIGNhbnZhcy5jb250ZXh0LmZvbnQgPSAnNDBweCAnICsgZm9udCArICcsICcgKyBERUZBVUxUX0ZPTlQ7XG5cbiAgICAgIHZhciB0aW1lb3V0Q291bnQgPSAzMDtcbiAgICAgIHZhciBjaGVja0xvYWRGb250ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYWZ0ZXIgPSBjYW52YXMuY29udGV4dC5tZWFzdXJlVGV4dChjaGVja1RleHQpLndpZHRoO1xuICAgICAgICBpZiAoYWZ0ZXIgIT09IGJlZm9yZSkge1xuICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjaygpO1xuICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKC0tdGltZW91dENvdW50ID4gMCkge1xuICAgICAgICAgICAgc2V0VGltZW91dChjaGVja0xvYWRGb250LCAxMDApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXCJ0aW1lb3V0IGZvbnQgbG9hZGluZ1wiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBjaGVja0xvYWRGb250KCk7XG4gICAgfSxcblxuICAgIHNldEZvbnROYW1lOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICBpZiAodGhpcy5sb2FkZWQpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwi44OV44Kp44Oz44OI5ZCN44GvTG9hZOWJjeOBq+OBruOBv+ioreWumuOBjOWHuuadpeOBvuOBmShcIiArIG5hbWUgKyBcIilcIik7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuICAgICAgdGhpcy5mb250TmFtZSA9IG5hbWU7XG4gICAgICBcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBnZXRGb250TmFtZTogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5mb250TmFtZTtcbiAgICB9LFxuXG4gIH0pO1xufSk7XG5cblxuOyhmdW5jdGlvbigpIHtcbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5pbnB1dC5JbnB1dFxuICAgKiBAZXh0ZW5kcyBwaGluYS51dGlsLkV2ZW50RGlzcGF0Y2hlclxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5pbnB1dC5JbnB1dCcsIHtcblxuICAgIHN1cGVyQ2xhc3M6ICdwaGluYS51dGlsLkV2ZW50RGlzcGF0Y2hlcicsXG5cbiAgICAvKiogZG9tRWxlbWVudCAqL1xuICAgIGRvbUVsZW1lbnQ6IG51bGwsXG5cbiAgICAvKipcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBpbml0OiBmdW5jdGlvbihkb21FbGVtZW50KSB7XG4gICAgICB0aGlzLnN1cGVySW5pdCgpO1xuICAgICAgXG4gICAgICB0aGlzLmRvbUVsZW1lbnQgPSBkb21FbGVtZW50IHx8IHdpbmRvdy5kb2N1bWVudDtcblxuICAgICAgdGhpcy5wb3NpdGlvbiA9IHBoaW5hLmdlb20uVmVjdG9yMigwLCAwKTtcbiAgICAgIHRoaXMuc3RhcnRQb3NpdGlvbiA9IHBoaW5hLmdlb20uVmVjdG9yMigwLCAwKTtcbiAgICAgIHRoaXMuZGVsdGFQb3NpdGlvbiA9IHBoaW5hLmdlb20uVmVjdG9yMigwLCAwKTtcbiAgICAgIHRoaXMucHJldlBvc2l0aW9uID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDAsIDApO1xuICAgICAgdGhpcy5fdGVtcFBvc2l0aW9uID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDAsIDApO1xuXG4gICAgICB0aGlzLm1heENhY2hlTnVtID0gcGhpbmEuaW5wdXQuSW5wdXQuZGVmYXVsdHMubWF4Q2FjaGVOdW07XG4gICAgICB0aGlzLm1pbkRpc3RhbmNlID0gcGhpbmEuaW5wdXQuSW5wdXQuZGVmYXVsdHMubWluRGlzdGFuY2U7XG4gICAgICB0aGlzLm1heERpc3RhbmNlID0gcGhpbmEuaW5wdXQuSW5wdXQuZGVmYXVsdHMubWF4RGlzdGFuY2U7XG4gICAgICB0aGlzLmNhY2hlUG9zaXRpb25zID0gW107XG4gICAgICB0aGlzLmZsaWNrVmVsb2NpdHkgPSBwaGluYS5nZW9tLlZlY3RvcjIoMCwgMCk7XG5cbiAgICAgIHRoaXMuZmxhZ3MgPSAwO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5sYXN0ID0gdGhpcy5ub3c7XG4gICAgICB0aGlzLm5vdyA9IHRoaXMuZmxhZ3M7XG4gICAgICB0aGlzLnN0YXJ0ID0gKHRoaXMubm93IF4gdGhpcy5sYXN0KSAmIHRoaXMubm93O1xuICAgICAgdGhpcy5lbmQgICA9ICh0aGlzLm5vdyBeIHRoaXMubGFzdCkgJiB0aGlzLmxhc3Q7XG5cbiAgICAgIC8vIOWkieWMluWApOOCkuabtOaWsFxuICAgICAgdGhpcy5kZWx0YVBvc2l0aW9uLnggPSB0aGlzLl90ZW1wUG9zaXRpb24ueCAtIHRoaXMucG9zaXRpb24ueDtcbiAgICAgIHRoaXMuZGVsdGFQb3NpdGlvbi55ID0gdGhpcy5fdGVtcFBvc2l0aW9uLnkgLSB0aGlzLnBvc2l0aW9uLnk7XG5cbiAgICAgIGlmICh0aGlzLmRlbHRhUG9zaXRpb24ueCA9PT0gMCAmJiB0aGlzLmRlbHRhUG9zaXRpb24ueSA9PT0gMCkge1xuICAgICAgICB0aGlzLl9tb3ZlRmxhZyA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuX21vdmVGbGFnID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuc3RhcnQpIHtcbiAgICAgICAgdGhpcy5zdGFydFBvc2l0aW9uLnNldCh0aGlzLnBvc2l0aW9uLngsIHRoaXMucG9zaXRpb24ueSk7XG4gICAgICB9XG5cbiAgICAgIC8vIOWJjeWbnuOBruW6p+aomeOCkuabtOaWsFxuICAgICAgdGhpcy5wcmV2UG9zaXRpb24uc2V0KHRoaXMucG9zaXRpb24ueCwgdGhpcy5wb3NpdGlvbi55KTtcblxuICAgICAgLy8g54++5Zyo44Gu5L2N572u44KS5pu05pawXG4gICAgICB0aGlzLnBvc2l0aW9uLnNldCh0aGlzLl90ZW1wUG9zaXRpb24ueCwgdGhpcy5fdGVtcFBvc2l0aW9uLnkpO1xuXG4gICAgICBpZiAodGhpcy5jYWNoZVBvc2l0aW9ucy5sZW5ndGggPiB0aGlzLm1heENhY2hlTnVtKSB7XG4gICAgICAgIHRoaXMuY2FjaGVQb3NpdGlvbnMuc2hpZnQoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY2FjaGVQb3NpdGlvbnMucHVzaCh0aGlzLnBvc2l0aW9uLmNsb25lKCkpO1xuICAgIH0sXG5cbiAgICBfc3RhcnQ6IGZ1bmN0aW9uKHgsIHksIGZsYWcpIHtcbiAgICAgIGZsYWcgPSAoZmxhZyAhPT0gdW5kZWZpbmVkKSA/IGZsYWcgOiAxO1xuICAgICAgdGhpcy5fbW92ZSh4LCB5KTtcblxuICAgICAgdGhpcy5mbGFncyB8PSBmbGFnO1xuXG4gICAgICB2YXIgeCA9IHRoaXMuX3RlbXBQb3NpdGlvbi54O1xuICAgICAgdmFyIHkgPSB0aGlzLl90ZW1wUG9zaXRpb24ueTtcbiAgICAgIHRoaXMucG9zaXRpb24uc2V0KHgsIHkpO1xuICAgICAgdGhpcy5wcmV2UG9zaXRpb24uc2V0KHgsIHkpO1xuXG4gICAgICB0aGlzLmZsaWNrVmVsb2NpdHkuc2V0KDAsIDApO1xuICAgICAgdGhpcy5jYWNoZVBvc2l0aW9ucy5jbGVhcigpO1xuICAgIH0sXG5cbiAgICBfZW5kOiBmdW5jdGlvbihmbGFnKSB7XG4gICAgICBmbGFnID0gKGZsYWcgIT09IHVuZGVmaW5lZCkgPyBmbGFnIDogMTtcbiAgICAgIHRoaXMuZmxhZ3MgJj0gfihmbGFnKTtcblxuICAgICAgaWYgKHRoaXMuY2FjaGVQb3NpdGlvbnMubGVuZ3RoIDwgMikgcmV0dXJuO1xuXG4gICAgICB2YXIgZmlyc3QgPSB0aGlzLmNhY2hlUG9zaXRpb25zLmZpcnN0O1xuICAgICAgdmFyIGxhc3QgPSB0aGlzLmNhY2hlUG9zaXRpb25zLmxhc3Q7XG5cbiAgICAgIHZhciB2ID0gcGhpbmEuZ2VvbS5WZWN0b3IyLnN1YihsYXN0LCBmaXJzdCk7XG5cbiAgICAgIHZhciBsZW4gPSB2Lmxlbmd0aCgpO1xuXG4gICAgICBpZiAobGVuID4gdGhpcy5taW5EaXN0YW5jZSkge1xuICAgICAgICB2YXIgbm9ybWFsTGVuID0gbGVuLmNsYW1wKHRoaXMubWluRGlzdGFuY2UsIHRoaXMubWF4RGlzdGFuY2UpO1xuICAgICAgICB2LmRpdihsZW4pLm11bChub3JtYWxMZW4pO1xuICAgICAgICB0aGlzLmZsaWNrVmVsb2NpdHkuc2V0KHYueCwgdi55KTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5jYWNoZVBvc2l0aW9ucy5jbGVhcigpO1xuICAgIH0sXG5cbiAgICAvLyDjgrnjgrHjg7zjg6vjgpLogIPmha5cbiAgICBfbW92ZTogZnVuY3Rpb24oeCwgeSkge1xuICAgICAgdGhpcy5fdGVtcFBvc2l0aW9uLnggPSB4O1xuICAgICAgdGhpcy5fdGVtcFBvc2l0aW9uLnkgPSB5O1xuXG4gICAgICAvLyBhZGp1c3Qgc2NhbGVcbiAgICAgIHZhciBlbG0gPSB0aGlzLmRvbUVsZW1lbnQ7XG4gICAgICB2YXIgcmVjdCA9IGVsbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIGlmIChyZWN0LndpZHRoKSB7XG4gICAgICAgIHRoaXMuX3RlbXBQb3NpdGlvbi54ICo9IGVsbS53aWR0aCAvIHJlY3Qud2lkdGg7XG4gICAgICB9XG4gICAgICBpZiAocmVjdC5oZWlnaHQpIHtcbiAgICAgICAgdGhpcy5fdGVtcFBvc2l0aW9uLnkgKj0gZWxtLmhlaWdodCAvIHJlY3QuaGVpZ2h0O1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBfYWNjZXNzb3I6IHtcbiAgICAgIC8qKlxuICAgICAgICogQHByb3BlcnR5ICAgIHhcbiAgICAgICAqIHjluqfmqJnlgKRcbiAgICAgICAqL1xuICAgICAgeDoge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpcy5wb3NpdGlvbi54OyB9LFxuICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2KSAgeyB0aGlzLnBvc2l0aW9uLnggPSB2OyB9XG4gICAgICB9LFxuICAgICAgLyoqXG4gICAgICAgKiBAcHJvcGVydHkgICAgeVxuICAgICAgICogeeW6p+aomeWApFxuICAgICAgICovXG4gICAgICB5OiB7XG4gICAgICAgIFwiZ2V0XCI6IGZ1bmN0aW9uKCkgICB7IHJldHVybiB0aGlzLnBvc2l0aW9uLnk7IH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKHYpICB7IHRoaXMucG9zaXRpb24ueSA9IHY7IH1cbiAgICAgIH0sXG4gICAgICAvKipcbiAgICAgICAqIEBwcm9wZXJ0eSAgICBkeFxuICAgICAgICogZHjlgKRcbiAgICAgICAqL1xuICAgICAgZHg6IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSAgIHsgcmV0dXJuIHRoaXMuZGVsdGFQb3NpdGlvbi54OyB9LFxuICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2KSAgeyB0aGlzLmRlbHRhUG9zaXRpb24ueCA9IHY7IH1cbiAgICAgIH0sXG4gICAgICAvKipcbiAgICAgICAqIEBwcm9wZXJ0eSAgICBkeVxuICAgICAgICogZHnlgKRcbiAgICAgICAqL1xuICAgICAgZHk6IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSAgIHsgcmV0dXJuIHRoaXMuZGVsdGFQb3NpdGlvbi55OyB9LFxuICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2KSAgeyB0aGlzLmRlbHRhUG9zaXRpb24ueSA9IHY7IH1cbiAgICAgIH0sXG5cbiAgICAgIC8qKlxuICAgICAgICogQHByb3BlcnR5ICAgIGZ4XG4gICAgICAgKiBmeOWApFxuICAgICAgICovXG4gICAgICBmeDoge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpcy5mbGlja1ZlbG9jaXR5Lng7IH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKHYpICB7IHRoaXMuZmxpY2tWZWxvY2l0eS54ID0gdjsgfVxuICAgICAgfSxcbiAgICAgIC8qKlxuICAgICAgICogQHByb3BlcnR5ICAgIGZ5XG4gICAgICAgKiBmeeWApFxuICAgICAgICovXG4gICAgICBmeToge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpcy5mbGlja1ZlbG9jaXR5Lnk7IH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKHYpICB7IHRoaXMuZmxpY2tWZWxvY2l0eS55ID0gdjsgfVxuICAgICAgfSxcblxuICAgIH0sXG5cbiAgICBfc3RhdGljOiB7XG4gICAgICBkZWZhdWx0czoge1xuICAgICAgICBtYXhDYWNoZU51bTogMyxcbiAgICAgICAgbWluRGlzdGFuY2U6IDEwLFxuICAgICAgICBtYXhEaXN0YW5jZTogMTAwLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuXG59KSgpO1xuXG47KGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEuaW5wdXQuTW91c2VcbiAgICogQGV4dGVuZHMgcGhpbmEuaW5wdXQuSW5wdXRcbiAgICovXG4gIHBoaW5hLmRlZmluZSgncGhpbmEuaW5wdXQuTW91c2UnLCB7XG5cbiAgICBzdXBlckNsYXNzOiAncGhpbmEuaW5wdXQuSW5wdXQnLFxuXG4gICAgLyoqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgaW5pdDogZnVuY3Rpb24oZG9tRWxlbWVudCkge1xuICAgICAgdGhpcy5zdXBlckluaXQoZG9tRWxlbWVudCk7XG5cbiAgICAgIHRoaXMuaWQgPSAwO1xuXG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICB0aGlzLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgZnVuY3Rpb24oZSkge1xuICAgICAgICBzZWxmLl9zdGFydChlLnBvaW50WCwgZS5wb2ludFksIDE8PGUuYnV0dG9uKTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgc2VsZi5fZW5kKDE8PGUuYnV0dG9uKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgc2VsZi5fbW92ZShlLnBvaW50WCwgZS5wb2ludFkpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIOODnuOCpuOCueOBjOOCreODo+ODs+ODkOOCueimgee0oOOBruWkluOBq+WHuuOBn+WgtOWQiOOBruWvvuW/nFxuICAgICAgdGhpcy5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3V0JywgZnVuY3Rpb24oZSkgIHtcbiAgICAgICAgc2VsZi5fZW5kKDEpO1xuICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOODnOOCv+ODs+WPluW+l1xuICAgICAqL1xuICAgIGdldEJ1dHRvbjogZnVuY3Rpb24oYnV0dG9uKSB7XG4gICAgICBpZiAodHlwZW9mKGJ1dHRvbikgPT0gXCJzdHJpbmdcIikge1xuICAgICAgICBidXR0b24gPSBCVVRUT05fTUFQW2J1dHRvbl07XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiAodGhpcy5ub3cgJiBidXR0b24pICE9IDA7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOODnOOCv+ODs+ODgOOCpuODs+WPluW+l1xuICAgICAqL1xuICAgIGdldEJ1dHRvbkRvd246IGZ1bmN0aW9uKGJ1dHRvbikge1xuICAgICAgaWYgKHR5cGVvZihidXR0b24pID09PSAnc3RyaW5nJykge1xuICAgICAgICBidXR0b24gPSBCVVRUT05fTUFQW2J1dHRvbl07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAodGhpcy5zdGFydCAmIGJ1dHRvbikgIT0gMDtcbiAgICB9LFxuICAgICAgICBcbiAgICAvKipcbiAgICAgKiDjg5zjgr/jg7PjgqLjg4Pjg5flj5blvpdcbiAgICAgKi9cbiAgICBnZXRCdXR0b25VcDogZnVuY3Rpb24oYnV0dG9uKSB7XG4gICAgICBpZiAodHlwZW9mKGJ1dHRvbikgPT0gXCJzdHJpbmdcIikge1xuICAgICAgICBidXR0b24gPSBCVVRUT05fTUFQW2J1dHRvbl07XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiAodGhpcy5lbmQgJiBidXR0b24pICE9IDA7XG4gICAgfSxcblxuICAgIF9zdGF0aWM6IHtcbiAgICAgIC8qKiBAc3RhdGljIEBwcm9wZXJ0eSAqL1xuICAgICAgQlVUVE9OX0xFRlQ6IDB4MSxcbiAgICAgIC8qKiBAc3RhdGljIEBwcm9wZXJ0eSAqL1xuICAgICAgQlVUVE9OX01JRERMRTogMHgyLFxuICAgICAgLyoqIEBzdGF0aWMgQHByb3BlcnR5ICovXG4gICAgICBCVVRUT05fUklHSFQ6IDB4NCxcbiAgICB9XG4gIH0pO1xuXG4gIHZhciBCVVRUT05fTUFQID0ge1xuICAgIFwibGVmdFwiICA6IHBoaW5hLmlucHV0Lk1vdXNlLkJVVFRPTl9MRUZULFxuICAgIFwibWlkZGxlXCI6IHBoaW5hLmlucHV0Lk1vdXNlLkJVVFRPTl9NSURETEUsXG4gICAgXCJyaWdodFwiIDogcGhpbmEuaW5wdXQuTW91c2UuQlVUVE9OX1JJR0hUXG4gIH07XG5cbiAgcGhpbmEuaW5wdXQuTW91c2UucHJvdG90eXBlLmdldFBvaW50aW5nID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLmdldEJ1dHRvbihcImxlZnRcIik7IH07XG4gIHBoaW5hLmlucHV0Lk1vdXNlLnByb3RvdHlwZS5nZXRQb2ludGluZ1N0YXJ0ID0gZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLmdldEJ1dHRvbkRvd24oXCJsZWZ0XCIpOyB9O1xuICBwaGluYS5pbnB1dC5Nb3VzZS5wcm90b3R5cGUuZ2V0UG9pbnRpbmdFbmQgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMuZ2V0QnV0dG9uVXAoXCJsZWZ0XCIpOyB9O1xuXG59KSgpO1xuXG47KGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEuaW5wdXQuVG91Y2hcbiAgICogQGV4dGVuZHMgcGhpbmEuaW5wdXQuSW5wdXRcbiAgICovXG4gIHBoaW5hLmRlZmluZSgncGhpbmEuaW5wdXQuVG91Y2gnLCB7XG5cbiAgICBzdXBlckNsYXNzOiAncGhpbmEuaW5wdXQuSW5wdXQnLFxuXG4gICAgLyoqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgaW5pdDogZnVuY3Rpb24oZG9tRWxlbWVudCwgaXNNdWx0aSkge1xuICAgICAgdGhpcy5zdXBlckluaXQoZG9tRWxlbWVudCk7XG5cbiAgICAgIHRoaXMuaWQgPSBudWxsO1xuXG4gICAgICBpZiAoaXNNdWx0aSA9PT0gdHJ1ZSkge1xuICAgICAgICByZXR1cm4gO1xuICAgICAgfVxuXG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICB0aGlzLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgc2VsZi5fc3RhcnQoZS5wb2ludFgsIGUucG9pbnRZLCB0cnVlKTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIHNlbGYuX2VuZCgpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgZnVuY3Rpb24oZSkge1xuICAgICAgICBzZWxmLl9tb3ZlKGUucG9pbnRYLCBlLnBvaW50WSk7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog44K/44OD44OB44GX44Gm44GE44KL44GL44KS5Yik5a6aXG4gICAgICovXG4gICAgZ2V0VG91Y2g6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMubm93ICE9IDA7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiDjgr/jg4Pjg4Hplovlp4vmmYLjgasgdHJ1ZVxuICAgICAqL1xuICAgIGdldFRvdWNoU3RhcnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuc3RhcnQgIT0gMDtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIOOCv+ODg+ODgee1guS6huaZguOBqyB0cnVlXG4gICAgICovXG4gICAgZ2V0VG91Y2hFbmQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZW5kICE9IDA7XG4gICAgfSxcblxuICB9KTtcblxuICAvKipcbiAgICogQG1ldGhvZFxuICAgKiDjg53jgqTjg7Pjg4bjgqPjg7PjgrDnirbmhYvlj5blvpcobW91c2Ug44Go44Gu5beu55Ww5a++562WKVxuICAgKi9cbiAgcGhpbmEuaW5wdXQuVG91Y2gucHJvdG90eXBlLmdldFBvaW50aW5nICAgICAgICA9IHBoaW5hLmlucHV0LlRvdWNoLnByb3RvdHlwZS5nZXRUb3VjaDtcbiAgLyoqXG4gICAqIEBtZXRob2RcbiAgICog44Od44Kk44Oz44OG44Kj44Oz44Kw44KS6ZaL5aeL44GX44Gf44GL44KS5Y+W5b6XKG1vdXNlIOOBqOOBruW3rueVsOWvvuetlilcbiAgICovXG4gIHBoaW5hLmlucHV0LlRvdWNoLnByb3RvdHlwZS5nZXRQb2ludGluZ1N0YXJ0ICAgPSBwaGluYS5pbnB1dC5Ub3VjaC5wcm90b3R5cGUuZ2V0VG91Y2hTdGFydDtcbiAgLyoqXG4gICAqIEBtZXRob2RcbiAgICog44Od44Kk44Oz44OG44Kj44Oz44Kw44KS57WC5LqG44GX44Gf44GL44KS5Y+W5b6XKG1vdXNlIOOBqOOBruW3rueVsOWvvuetlilcbiAgICovXG4gIHBoaW5hLmlucHV0LlRvdWNoLnByb3RvdHlwZS5nZXRQb2ludGluZ0VuZCAgICAgPSBwaGluYS5pbnB1dC5Ub3VjaC5wcm90b3R5cGUuZ2V0VG91Y2hFbmQ7XG5cblxufSkoKTtcblxuXG47KGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEuaW5wdXQuVG91Y2hMaXN0XG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmlucHV0LlRvdWNoTGlzdCcsIHtcbiAgICBkb21FbGVtZW50OiBudWxsLFxuICAgIHRvdWNoTWFwOiBudWxsLFxuICAgIHRvdWNoZXM6IG51bGwsXG4gICAgX2lkOiBudWxsLFxuXG4gICAgaW5pdDogZnVuY3Rpb24oZG9tRWxlbWVudCkge1xuICAgICAgdGhpcy5kb21FbGVtZW50ID0gZG9tRWxlbWVudDtcblxuICAgICAgdGhpcy50b3VjaGVzID0gW107XG4gICAgICB2YXIgdG91Y2hNYXAgPSB0aGlzLnRvdWNoTWFwID0ge307XG5cbiAgICAgIC8vIDMyYml0IOWRqOacn+OBp0lE44KS44Or44O844OX44GV44Gb44KLXG4gICAgICB0aGlzLl9pZCA9IG5ldyBVaW50MzJBcnJheSgxKTtcblxuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgdmFyIGVhY2ggPSBBcnJheS5wcm90b3R5cGUuZm9yRWFjaDtcbiAgICAgIHRoaXMuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgZnVuY3Rpb24oZSkge1xuICAgICAgICBlYWNoLmNhbGwoZS5jaGFuZ2VkVG91Y2hlcywgZnVuY3Rpb24odCkge1xuICAgICAgICAgIHZhciB0b3VjaCA9IHNlbGYuZ2V0RW1wdHkoKTtcbiAgICAgICAgICB0b3VjaE1hcFt0LmlkZW50aWZpZXJdID0gdG91Y2g7XG4gICAgICAgICAgdG91Y2guX3N0YXJ0KHQucG9pbnRYLCB0LnBvaW50WSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgZWFjaC5jYWxsKGUuY2hhbmdlZFRvdWNoZXMsIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICB2YXIgaWQgPSB0LmlkZW50aWZpZXI7XG4gICAgICAgICAgdmFyIHRvdWNoID0gdG91Y2hNYXBbaWRdO1xuICAgICAgICAgIHRvdWNoLl9lbmQoKTtcbiAgICAgICAgICBkZWxldGUgdG91Y2hNYXBbaWRdO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgZWFjaC5jYWxsKGUuY2hhbmdlZFRvdWNoZXMsIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICB2YXIgdG91Y2ggPSB0b3VjaE1hcFt0LmlkZW50aWZpZXJdO1xuICAgICAgICAgIHRvdWNoLl9tb3ZlKHQucG9pbnRYLCB0LnBvaW50WSk7XG4gICAgICAgIH0pO1xuICAgICAgICBlLnN0b3AoKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBpUGhvbmUg44Gn44GvIDbmnKzmjIfku6XkuIrjgr/jg4Pjg4HjgZnjgovjgajlvLfliLbnmoTjgavjgZnjgbnjgabjga7jgr/jg4Pjg4HjgYzop6PpmaTjgZXjgozjgotcbiAgICAgIHRoaXMuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGNhbmNlbCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCfjgZPjga7nq6/mnKvjgafjga7lkIzmmYLjgr/jg4Pjg4HmlbDjga7liLbpmZDjgpLotoXjgYjjgb7jgZfjgZ/jgIInKTtcbiAgICAgICAgZWFjaC5jYWxsKGUuY2hhbmdlZFRvdWNoZXMsIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICB2YXIgaWQgPSB0LmlkZW50aWZpZXI7XG4gICAgICAgICAgdmFyIHRvdWNoID0gdG91Y2hNYXBbaWRdO1xuICAgICAgICAgIHRvdWNoLl9lbmQoKTtcbiAgICAgICAgICBkZWxldGUgdG91Y2hNYXBbaWRdO1xuICAgICAgICB9KTtcbiAgICAgICAgZS5zdG9wKCk7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgZ2V0RW1wdHk6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHRvdWNoID0gcGhpbmEuaW5wdXQuVG91Y2godGhpcy5kb21FbGVtZW50LCB0cnVlKTtcbiAgICBcbiAgICAgIHRvdWNoLmlkID0gdGhpcy5pZDtcbiAgICAgIHRoaXMudG91Y2hlcy5wdXNoKHRvdWNoKTtcblxuICAgICAgcmV0dXJuIHRvdWNoO1xuICAgIH0sXG5cbiAgICBnZXRUb3VjaDogZnVuY3Rpb24oaWQpIHtcbiAgICAgIHJldHVybiB0aGlzLnRvdWNoTWFwW2lkXTtcbiAgICB9LFxuXG5cbiAgICByZW1vdmVUb3VjaDogZnVuY3Rpb24odG91Y2gpIHtcbiAgICAgIHZhciBpID0gdGhpcy50b3VjaGVzLmluZGV4T2YodG91Y2gpO1xuICAgICAgdGhpcy50b3VjaGVzLnNwbGljZShpLCAxKTtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMudG91Y2hlcy5mb3JFYWNoKGZ1bmN0aW9uKHRvdWNoKSB7XG4gICAgICAgIGlmICghdG91Y2gucmVsZWFzZWQpIHtcbiAgICAgICAgICB0b3VjaC51cGRhdGUoKTtcblxuICAgICAgICAgIGlmICh0b3VjaC5mbGFncyA9PT0gMCkge1xuICAgICAgICAgICAgdG91Y2gucmVsZWFzZWQgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICB0b3VjaC5yZWxlYXNlZCA9IGZhbHNlO1xuICAgICAgICAgIHRoaXMucmVtb3ZlVG91Y2godG91Y2gpO1xuICAgICAgICB9XG5cbiAgICAgIH0sIHRoaXMpO1xuICAgIH0sXG5cbiAgICBfYWNjZXNzb3I6IHtcbiAgICAgIGlkOiB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuX2lkWzBdKys7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbn0pKCk7XG4vKlxuICpcbiAqL1xuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmlucHV0LktleWJvYXJkXG4gICAqIEBleHRlbmRzIHBoaW5hLmlucHV0LklucHV0XG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmlucHV0LktleWJvYXJkJywge1xuXG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmlucHV0LklucHV0JyxcblxuICAgIC8qKlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGluaXQ6IGZ1bmN0aW9uKGRvbUVsZW1lbnQpIHtcbiAgICAgIHRoaXMuc3VwZXJJbml0KGRvbUVsZW1lbnQpO1xuXG4gICAgICB0aGlzLmtleSA9IHt9O1xuICAgICAgdGhpcy5wcmVzcyAgPSB7fTtcbiAgICAgIHRoaXMuZG93biAgID0ge307XG4gICAgICB0aGlzLnVwICAgICA9IHt9O1xuICAgICAgdGhpcy5sYXN0ICAgPSB7fTtcblxuICAgICAgdGhpcy5fa2V5ZG93biA9IG51bGw7XG4gICAgICB0aGlzLl9rZXl1cCA9IG51bGw7XG4gICAgICB0aGlzLl9rZXlwcmVzcyA9IG51bGw7XG5cbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIHRoaXMuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24oZSkge1xuICAgICAgICBzZWxmLmtleVtlLmtleUNvZGVdID0gdHJ1ZTtcbiAgICAgICAgc2VsZi5fa2V5ZG93biA9IGUua2V5Q29kZTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIHNlbGYua2V5W2Uua2V5Q29kZV0gPSBmYWxzZTtcbiAgICAgICAgc2VsZi5fa2V5dXAgPSBlLmtleUNvZGU7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlwcmVzcycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgc2VsZi5fa2V5cHJlc3MgPSBlLmtleUNvZGU7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog5oOF5aCx5pu05paw5Yem55CGXG4gICAgICog44Oe44Kk44OV44Os44O844Og5ZG844KT44Gn5LiL44GV44GELlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgIC8vIFRPRE86IOS4gOaLrOODk+ODg+ODiOa8lOeul+OBp+ihjOOBhuOCiOOBhuS/ruato+OBmeOCi1xuICAgICAgZm9yICh2YXIgayBpbiB0aGlzLmtleSkge1xuICAgICAgICB0aGlzLmxhc3Rba10gICAgPSB0aGlzLnByZXNzW2tdO1xuICAgICAgICB0aGlzLnByZXNzW2tdICAgPSB0aGlzLmtleVtrXTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMuZG93bltrXSA9ICh0aGlzLnByZXNzW2tdIF4gdGhpcy5sYXN0W2tdKSAmIHRoaXMucHJlc3Nba107XG4gICAgICAgIHRoaXMudXBba10gPSAodGhpcy5wcmVzc1trXSBeIHRoaXMubGFzdFtrXSkgJiB0aGlzLmxhc3Rba107XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLl9rZXlkb3duKSB7XG4gICAgICAgIHRoaXMuZmxhcmUoJ2tleWRvd24nLCB7IGtleUNvZGU6IHRoaXMuX2tleWRvd24gfSk7XG4gICAgICAgIHRoaXMuX2tleWRvd24gPSBudWxsO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuX2tleXVwKSB7XG4gICAgICAgIHRoaXMuZmxhcmUoJ2tleXVwJywgeyBrZXlDb2RlOiB0aGlzLl9rZXl1cCB9KTtcbiAgICAgICAgdGhpcy5fa2V5dXAgPSBudWxsO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuX2tleXByZXNzKSB7XG4gICAgICAgIHRoaXMuZmxhcmUoJ2tleXByZXNzJywgeyBrZXlDb2RlOiB0aGlzLl9rZXlwcmVzcyB9KTtcbiAgICAgICAgdGhpcy5fa2V5cHJlc3MgPSBudWxsO1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog44Kt44O844KS5oq844GX44Gm44GE44KL44GL44KS44OB44Kn44OD44KvXG4gICAgICogQHBhcmFtICAge051bWJlci9TdHJpbmd9IGtleSBrZXlDb2RlIG9yIGtleU5hbWVcbiAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gICDjg4Hjgqfjg4Pjgq/ntZDmnpxcbiAgICAgKi9cbiAgICBnZXRLZXk6IGZ1bmN0aW9uKGtleSkge1xuICAgICAgaWYgKHR5cGVvZihrZXkpID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIGtleSA9IHBoaW5hLmlucHV0LktleWJvYXJkLktFWV9DT0RFW2tleV07XG4gICAgICB9XG4gICAgICByZXR1cm4gISF0aGlzLnByZXNzW2tleV0gPT09IHRydWU7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiDjgq3jg7zjgpLmirzjgZfjgZ/jgYvjgpLjg4Hjgqfjg4Pjgq9cbiAgICAgKiBAcGFyYW0gICB7TnVtYmVyL1N0cmluZ30ga2V5IGtleUNvZGUgb3Iga2V5TmFtZVxuICAgICAqIEByZXR1cm5zIHtCb29sZWFufSAgIOODgeOCp+ODg+OCr+e1kOaenFxuICAgICAqL1xuICAgIGdldEtleURvd246IGZ1bmN0aW9uKGtleSkge1xuICAgICAgaWYgKHR5cGVvZihrZXkpID09IFwic3RyaW5nXCIpIHtcbiAgICAgICAga2V5ID0gcGhpbmEuaW5wdXQuS2V5Ym9hcmQuS0VZX0NPREVba2V5XTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLmRvd25ba2V5XSA9PSB0cnVlO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICog44Kt44O844KS6Zui44GX44Gf44GL44KS44OB44Kn44OD44KvXG4gICAgICogQHBhcmFtICAge051bWJlci9TdHJpbmd9IGtleSBrZXlDb2RlIG9yIGtleU5hbWVcbiAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gICDjg4Hjgqfjg4Pjgq/ntZDmnpxcbiAgICAgKi9cbiAgICBnZXRLZXlVcDogZnVuY3Rpb24oa2V5KSB7XG4gICAgICBpZiAodHlwZW9mKGtleSkgPT0gXCJzdHJpbmdcIikge1xuICAgICAgICBrZXkgPSBwaGluYS5pbnB1dC5LZXlib2FyZC5LRVlfQ09ERVtrZXldO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMudXBba2V5XSA9PSB0cnVlO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICog44Kt44O844Gu5pa55ZCR44KSIEFuZ2xlKERlZ3JlZSkg44Gn5Y+W5b6XXG4gICAgICogQHJldHVybnMge0Jvb2xlYW59ICAg6KeS5bqmKERlZ3JlZSlcbiAgICAgKi9cbiAgICBnZXRLZXlBbmdsZTogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgYW5nbGUgPSBudWxsO1xuICAgICAgdmFyIGFycm93Qml0ID1cbiAgICAgICAgKHRoaXMuZ2V0S2V5KFwibGVmdFwiKSAgIDw8IDMpIHwgLy8gMTAwMFxuICAgICAgICAodGhpcy5nZXRLZXkoXCJ1cFwiKSAgICAgPDwgMikgfCAvLyAwMTAwXG4gICAgICAgICh0aGlzLmdldEtleShcInJpZ2h0XCIpICA8PCAxKSB8IC8vIDAwMTBcbiAgICAgICAgKHRoaXMuZ2V0S2V5KFwiZG93blwiKSk7ICAgICAgICAgLy8gMDAwMVxuICAgICAgXG4gICAgICBpZiAoYXJyb3dCaXQgIT09IDAgJiYgcGhpbmEuaW5wdXQuS2V5Ym9hcmQuQVJST1dfQklUX1RPX0FOR0xFX1RBQkxFLmhhc093blByb3BlcnR5KGFycm93Qml0KSkge1xuICAgICAgICBhbmdsZSA9IHBoaW5hLmlucHV0LktleWJvYXJkLkFSUk9XX0JJVF9UT19BTkdMRV9UQUJMRVthcnJvd0JpdF07XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiBhbmdsZTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog44Kt44O844Gu5oq844GX44Gm44GE44KL5ZCR44GN44KS5Y+W5b6XXG4gICAgICog5q2j6KaP5YyW44GV44KM44Gm44GE44KLXG4gICAgICovXG4gICAgZ2V0S2V5RGlyZWN0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBkaXJlY3Rpb24gPSBwaGluYS5nZW9tLlZlY3RvcjIoMCwgMCk7XG5cbiAgICAgIGlmICh0aGlzLmdldEtleShcImxlZnRcIikpIHtcbiAgICAgICAgZGlyZWN0aW9uLnggPSAtMTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHRoaXMuZ2V0S2V5KFwicmlnaHRcIikpIHtcbiAgICAgICAgZGlyZWN0aW9uLnggPSAxO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuZ2V0S2V5KFwidXBcIikpIHtcbiAgICAgICAgZGlyZWN0aW9uLnkgPSAtMTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHRoaXMuZ2V0S2V5KFwiZG93blwiKSkge1xuICAgICAgICBkaXJlY3Rpb24ueSA9IDE7XG4gICAgICB9XG5cbiAgICAgIGlmIChkaXJlY3Rpb24ueCAmJiBkaXJlY3Rpb24ueSkge1xuICAgICAgICBkaXJlY3Rpb24uZGl2KE1hdGguU1FSVDIpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZGlyZWN0aW9uO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICog44Kt44O844Gu54q25oWL44KS6Kit5a6a44GZ44KLXG4gICAgICovXG4gICAgc2V0S2V5OiBmdW5jdGlvbihrZXksIGZsYWcpIHtcbiAgICAgIGlmICh0eXBlb2Yoa2V5KSA9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIGtleSA9IHBoaW5hLmlucHV0LktleWJvYXJkLktFWV9DT0RFW2tleV07XG4gICAgICB9XG4gICAgICB0aGlzLmtleVtrZXldID0gZmxhZztcbiAgICAgIFxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOOCreODvOOCkuWFqOOBpumbouOBl+OBn+OBk+OBqOOBq+OBmeOCi1xuICAgICAqL1xuICAgIGNsZWFyS2V5OiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMua2V5ID0ge307XG4gICAgICBcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cblxuICAgIC8qXG4gICAgICogQGVudW0gQVJST1dfQklUX1RPX0FOR0xFX1RBQkxFXG4gICAgICog5pa55ZCR44Gu44Ki44Oz44Kw44OrIGpzZHVja+OBp+OBr+aVsOWtl+OCkuODl+ODreODkeODhuOCo+OBq+aMh+WumuOBp+OBjeOBquOBhO+8n1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3N0YXRpYzoge1xuICAgICAgQVJST1dfQklUX1RPX0FOR0xFX1RBQkxFOiB7XG4gICAgICAgIC8qIEBwcm9wZXJ0eSDkuIsgKi9cbiAgICAgICAgMHgwMTogMjcwLFxuICAgICAgICAvKiBAcHJvcGVydHkg5Y+zICovXG4gICAgICAgIDB4MDI6ICAgMCxcbiAgICAgICAgLyogQHByb3BlcnR5IOS4iiAqL1xuICAgICAgICAweDA0OiAgOTAsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSDlt6YgKi9cbiAgICAgICAgMHgwODogMTgwLFxuXG4gICAgICAgIC8qIEBwcm9wZXJ0eSDlj7PkuIogKi9cbiAgICAgICAgMHgwNjogIDQ1LFxuICAgICAgICAvKiBAcHJvcGVydHkg5Y+z5LiLICovXG4gICAgICAgIDB4MDM6IDMxNSxcbiAgICAgICAgLyogQHByb3BlcnR5IOW3puS4iiAqL1xuICAgICAgICAweDBjOiAxMzUsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSDlt6bkuIsgKi9cbiAgICAgICAgMHgwOTogMjI1LFxuXG4gICAgICAgIC8vIOS4ieaWueWQkeWQjOaZguaKvOOBl+WvvuW/nFxuICAgICAgICAvLyDmg7PlrprlpJbjga7mk43kvZzjgaDjgYzlr77lv5zjgZfjgajjgYTjgZ/jgbvjgYbjgYznhKHpm6NcbiAgICAgICAgLyogQHByb3BlcnR5IOWPs+S4iuW3piAqL1xuICAgICAgICAweDBlOiAgOTAsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSDkuIrlt6bkuIsgKi9cbiAgICAgICAgMHgwZDogMTgwLFxuICAgICAgICAvKiBAcHJvcGVydHkg5bem5LiL5Y+zICovXG4gICAgICAgIDB4MGI6IDI3MCxcbiAgICAgICAgLyogQHByb3BlcnR5IOS4i+WPs+S4iiAqL1xuICAgICAgICAweDA3OiAgIDAsXG4gICAgICB9LFxuXG4gICAgICAvKlxuICAgICAgICogQGVudW0gS0VZX0NPREVcbiAgICAgICAqIOOCreODvOeVquWPt1xuICAgICAgICogQHByaXZhdGVcbiAgICAgICAqL1xuICAgICAgS0VZX0NPREU6IHtcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiYmFja3NwYWNlXCIgOiA4LFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJ0YWJcIiAgICAgICA6IDksXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImVudGVyXCIgICAgIDogMTMsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcInJldHVyblwiICAgIDogMTMsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcInNoaWZ0XCIgICAgIDogMTYsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImN0cmxcIiAgICAgIDogMTcsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImFsdFwiICAgICAgIDogMTgsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcInBhdXNlXCIgICAgIDogMTksXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImNhcHNsb2NrXCIgIDogMjAsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImVzY2FwZVwiICAgIDogMjcsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcInBhZ2V1cFwiICAgIDogMzMsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcInBhZ2Vkb3duXCIgIDogMzQsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImVuZFwiICAgICAgIDogMzUsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImhvbWVcIiAgICAgIDogMzYsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImxlZnRcIiAgICAgIDogMzcsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcInVwXCIgICAgICAgIDogMzgsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcInJpZ2h0XCIgICAgIDogMzksXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImRvd25cIiAgICAgIDogNDAsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImluc2VydFwiICAgIDogNDUsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImRlbGV0ZVwiICAgIDogNDYsXG4gICAgICAgIFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCIwXCIgOiA0OCxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiMVwiIDogNDksXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcIjJcIiA6IDUwLFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCIzXCIgOiA1MSxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiNFwiIDogNTIsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcIjVcIiA6IDUzLFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCI2XCIgOiA1NCxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiN1wiIDogNTUsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcIjhcIiA6IDU2LFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCI5XCIgOiA1NyxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFxuICAgICAgICBcImFcIiA6IDY1LFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJBXCIgOiA2NSxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiYlwiIDogNjYsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcIkJcIiA6IDY2LFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJjXCIgOiA2NyxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiQ1wiIDogNjcsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImRcIiA6IDY4LFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJEXCIgOiA2OCxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiZVwiIDogNjksXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcIkVcIiA6IDY5LFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJmXCIgOiA3MCxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiRlwiIDogNzAsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImdcIiA6IDcxLFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJHXCIgOiA3MSxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiaFwiIDogNzIsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcIkhcIiA6IDcyLFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJpXCIgOiA3MyxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiSVwiIDogNzMsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImpcIiA6IDc0LFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJKXCIgOiA3NCxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwia1wiIDogNzUsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcIktcIiA6IDc1LFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJsXCIgOiA3NixcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiTFwiIDogNzYsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcIm1cIiA6IDc3LFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJNXCIgOiA3NyxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiblwiIDogNzgsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcIk5cIiA6IDc4LFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJvXCIgOiA3OSxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiT1wiIDogNzksXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcInBcIiA6IDgwLFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJQXCIgOiA4MCxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwicVwiIDogODEsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcIlFcIiA6IDgxLFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJyXCIgOiA4MixcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiUlwiIDogODIsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcInNcIiA6IDgzLFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJTXCIgOiA4MyxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwidFwiIDogODQsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcIlRcIiA6IDg0LFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJ1XCIgOiA4NSxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiVVwiIDogODUsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcInZcIiA6IDg2LFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJWXCIgOiA4NixcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwid1wiIDogODcsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcIldcIiA6IDg3LFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJ4XCIgOiA4OCxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiWFwiIDogODgsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcInlcIiA6IDg5LFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJZXCIgOiA4OSxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwielwiIDogOTAsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcIlpcIiA6IDkwLFxuICAgICAgICBcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwibnVtcGFkMFwiIDogOTYsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcIm51bXBhZDFcIiA6IDk3LFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJudW1wYWQyXCIgOiA5OCxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwibnVtcGFkM1wiIDogOTksXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcIm51bXBhZDRcIiA6IDEwMCxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwibnVtcGFkNVwiIDogMTAxLFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJudW1wYWQ2XCIgOiAxMDIsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcIm51bXBhZDdcIiA6IDEwMyxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwibnVtcGFkOFwiIDogMTA0LFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJudW1wYWQ5XCIgOiAxMDUsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcIm11bHRpcGx5XCIgICAgICA6IDEwNixcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiYWRkXCIgICAgICAgICAgIDogMTA3LFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJzdWJ0cmFjdFwiICAgICAgOiAxMDksXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImRlY2ltYWxwb2ludFwiICA6IDExMCxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiZGl2aWRlXCIgICAgICAgIDogMTExLFxuXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImYxXCIgICAgOiAxMTIsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImYyXCIgICAgOiAxMTMsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImYzXCIgICAgOiAxMTQsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImY0XCIgICAgOiAxMTUsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImY1XCIgICAgOiAxMTYsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImY2XCIgICAgOiAxMTcsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImY3XCIgICAgOiAxMTgsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImY4XCIgICAgOiAxMTksXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImY5XCIgICAgOiAxMjAsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImYxMFwiICAgOiAxMjEsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImYxMVwiICAgOiAxMjIsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImYxMlwiICAgOiAxMjMsXG4gICAgICAgIFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJudW1sb2NrXCIgICA6IDE0NCxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwic2Nyb2xsbG9ja1wiOiAxNDUsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcInNlbWljb2xvblwiIDogMTg2LFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJlcXVhbHNpZ25cIiA6IDE4NyxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiY29tbWFcIiAgICAgOiAxODgsXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImRhc2hcIiAgICAgIDogMTg5LFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJwZXJpb2RcIiAgICA6IDE5MCxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiZm9yd2FyZCBzbGFzaFwiIDogMTkxLFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCIvXCI6IDE5MSxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiZ3JhdmUgYWNjZW50XCIgIDogMTkyLFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJvcGVuIGJyYWNrZXRcIiAgOiAyMTksXG4gICAgICAgIC8qIEBwcm9wZXJ0eSAqL1xuICAgICAgICBcImJhY2sgc2xhc2hcIiAgICA6IDIyMCxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwiY2xvc2UgYnJhY2tldFwiICA6IDIyMSxcbiAgICAgICAgLyogQHByb3BlcnR5ICovXG4gICAgICAgIFwic2luZ2xlIHF1b3RlXCIgIDogMjIyLFxuICAgICAgICAvKiBAcHJvcGVydHkgKi9cbiAgICAgICAgXCJzcGFjZVwiICAgICAgICAgOiAzMlxuXG4gICAgICB9LFxuICAgIH1cbiAgfSk7XG5cbn0pO1xuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5pbnB1dC5HYW1lcGFkTWFuYWdlclxuICAgKiDjgrLjg7zjg6Djg5Hjg4Pjg4njg57jg43jg7zjgrjjg6Pjg7wuXG4gICAqIOOCsuODvOODoOODkeODg+ODieaOpee2mueKtuazgeOBruebo+imluOAgeWAi+OAheOBruOCsuODvOODoOODkeODg+ODieOBruWFpeWKm+eKtuaFi+OBruabtOaWsOOCkuihjOOBhi5cbiAgICogQGV4dGVuZHMgcGhpbmEudXRpbC5FdmVudERpc3BhdGNoZXJcbiAgICovXG4gIHBoaW5hLmRlZmluZSgncGhpbmEuaW5wdXQuR2FtZXBhZE1hbmFnZXInLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLnV0aWwuRXZlbnREaXNwYXRjaGVyJyxcblxuICAgIC8qKlxuICAgICAqIOS9nOaIkOa4iOOBv3BoaW5hLmlucHV0LkdhbWVwYWTjgqrjg5bjgrjjgqfjgq/jg4jjga7jg6rjgrnjg4hcbiAgICAgKlxuICAgICAqIEB0eXBlIHtPYmplY3QuPG51bWJlciwgcGhpbmEuaW5wdXQuR2FtZXBhZD59XG4gICAgICovXG4gICAgZ2FtZXBhZHM6IG51bGwsXG5cbiAgICAvKipcbiAgICAgKiDkvZzmiJDmuIjjgb/jgrLjg7zjg6Djg5Hjg4Pjg4njga5pbmRleOOBruODquOCueODiFxuICAgICAqXG4gICAgICogQHR5cGUge251bWJlcltdfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2NyZWF0ZWQ6IG51bGwsXG5cbiAgICAvKipcbiAgICAgKiDjg6njg4Pjg5fliY1HYW1lcGFk44Gu44Oq44K544OIXG4gICAgICogQHR5cGUge3BoaW5hLmlucHV0LkdhbWVwYWRbXX1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9yYXdnYW1lcGFkczogbnVsbCxcblxuICAgIC8qKlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5zdXBlckluaXQoKTtcblxuICAgICAgdGhpcy5nYW1lcGFkcyA9IHt9O1xuICAgICAgdGhpcy5fY3JlYXRlZCA9IFtdO1xuICAgICAgdGhpcy5fcmF3Z2FtZXBhZHMgPSBbXTtcblxuICAgICAgdGhpcy5fcHJldlRpbWVzdGFtcHMgPSB7fTtcblxuICAgICAgdGhpcy5fZ2V0R2FtZXBhZHMgPSBudWxsO1xuICAgICAgdmFyIG5hdmlnYXRvciA9IHBoaW5hLmdsb2JhbC5uYXZpZ2F0b3I7XG4gICAgICBpZiAobmF2aWdhdG9yICYmIG5hdmlnYXRvci5nZXRHYW1lcGFkcykge1xuICAgICAgICB0aGlzLl9nZXRHYW1lcGFkcyA9IG5hdmlnYXRvci5nZXRHYW1lcGFkcy5iaW5kKG5hdmlnYXRvcik7XG4gICAgICB9IGVsc2UgaWYgKG5hdmlnYXRvciAmJiBuYXZpZ2F0b3Iud2Via2l0R2V0R2FtZXBhZHMpIHtcbiAgICAgICAgdGhpcy5fZ2V0R2FtZXBhZHMgPSBuYXZpZ2F0b3Iud2Via2l0R2V0R2FtZXBhZHMuYmluZChuYXZpZ2F0b3IpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5fZ2V0R2FtZXBhZHMgPSBmdW5jdGlvbigpIHt9O1xuICAgICAgfVxuXG4gICAgICBwaGluYS5nbG9iYWwuYWRkRXZlbnRMaXN0ZW5lcignZ2FtZXBhZGNvbm5lY3RlZCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgdmFyIGdhbWVwYWQgPSB0aGlzLmdldChlLmdhbWVwYWQuaW5kZXgpO1xuICAgICAgICBnYW1lcGFkLmNvbm5lY3RlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuZmxhcmUoJ2Nvbm5lY3RlZCcsIHtcbiAgICAgICAgICBnYW1lcGFkOiBnYW1lcGFkLFxuICAgICAgICB9KTtcbiAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgIHBoaW5hLmdsb2JhbC5hZGRFdmVudExpc3RlbmVyKCdnYW1lcGFkZGlzY29ubmVjdGVkJywgZnVuY3Rpb24oZSkge1xuICAgICAgICB2YXIgZ2FtZXBhZCA9IHRoaXMuZ2V0KGUuZ2FtZXBhZC5pbmRleCk7XG4gICAgICAgIGdhbWVwYWQuY29ubmVjdGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZmxhcmUoJ2Rpc2Nvbm5lY3RlZCcsIHtcbiAgICAgICAgICBnYW1lcGFkOiBnYW1lcGFkLFxuICAgICAgICB9KTtcbiAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOaDheWgseabtOaWsOWHpueQhlxuICAgICAqIOODnuOCpOODleODrOODvOODoOWRvOOCk+OBp+S4i+OBleOBhC5cbiAgICAgKi9cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5fcG9sbCgpO1xuXG4gICAgICBmb3IgKHZhciBpID0gMCwgZW5kID0gdGhpcy5fY3JlYXRlZC5sZW5ndGg7IGkgPCBlbmQ7IGkrKykge1xuICAgICAgICB2YXIgaW5kZXggPSB0aGlzLl9jcmVhdGVkW2ldO1xuICAgICAgICB2YXIgcmF3Z2FtZXBhZCA9IHRoaXMuX3Jhd2dhbWVwYWRzW2luZGV4XTtcblxuICAgICAgICBpZiAoIXJhd2dhbWVwYWQpIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChyYXdnYW1lcGFkLnRpbWVzdGFtcCAmJiAocmF3Z2FtZXBhZC50aW1lc3RhbXAgPT09IHRoaXMuX3ByZXZUaW1lc3RhbXBzW2ldKSkge1xuICAgICAgICAgIHRoaXMuZ2FtZXBhZHNbaW5kZXhdLl91cGRhdGVTdGF0ZUVtcHR5KCk7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9wcmV2VGltZXN0YW1wc1tpXSA9IHJhd2dhbWVwYWQudGltZXN0YW1wO1xuICAgICAgICB0aGlzLmdhbWVwYWRzW2luZGV4XS5fdXBkYXRlU3RhdGUocmF3Z2FtZXBhZCk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOaMh+WumuOBleOCjOOBn2luZGV444GuR2FtZXBhZOOCquODluOCuOOCp+OCr+ODiOOCkui/lOOBmS5cbiAgICAgKlxuICAgICAqIOacquS9nOaIkOOBruWgtOWQiOOBr+S9nOaIkOOBl+OBpui/lOOBmS5cbiAgICAgKi9cbiAgICBnZXQ6IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICBpbmRleCA9IGluZGV4IHx8IDA7XG5cbiAgICAgIGlmICghdGhpcy5nYW1lcGFkc1tpbmRleF0pIHtcbiAgICAgICAgdGhpcy5fY3JlYXRlZC5wdXNoKGluZGV4KTtcbiAgICAgICAgdGhpcy5nYW1lcGFkc1tpbmRleF0gPSBwaGluYS5pbnB1dC5HYW1lcGFkKGluZGV4KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuZ2FtZXBhZHNbaW5kZXhdO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDmjIflrprjgZXjgozjgZ9pbmRleOOBrkdhbWVwYWTjgqrjg5bjgrjjgqfjgq/jg4jjgpLnoLTmo4TjgZnjgosuXG4gICAgICog56C05qOE44GV44KM44GfR2FtZXBhZOOCquODluOCuOOCp+OCr+ODiOOBr+S7pemZjeabtOaWsOOBleOCjOOBquOBhC5cbiAgICAgKi9cbiAgICBkaXNwb3NlOiBmdW5jdGlvbihpbmRleCkge1xuICAgICAgaWYgKHRoaXMuX2NyZWF0ZWQuY29udGFpbnMoaW5kZXgpKSB7XG4gICAgICAgIHZhciBnYW1lcGFkID0gdGhpcy5nZXQoaW5kZXgpO1xuICAgICAgICBkZWxldGUgdGhpcy5nYW1lcGFkW2dhbWVwYWRdO1xuICAgICAgICB0aGlzLl9jcmVhdGVkLmVyYXNlKGluZGV4KTtcblxuICAgICAgICBnYW1lcGFkLmNvbm5lY3RlZCA9IGZhbHNlO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDmjIflrprjgZXjgozjgZ9pbmRleOOBruOCsuODvOODoOODkeODg+ODieOBjOaOpee2muS4reOBi+OBqeOBhuOBi+OCkui/lOOBmS5cbiAgICAgKlxuICAgICAqIEdhbWVwYWTjgqrjg5bjgrjjgqfjgq/jg4jjgYzmnKrkvZzmiJDjga7loLTlkIjjgafjgoLli5XkvZzjgZnjgosuXG4gICAgICovXG4gICAgaXNDb25uZWN0ZWQ6IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICBpbmRleCA9IGluZGV4IHx8IDA7XG5cbiAgICAgIHJldHVybiB0aGlzLl9yYXdnYW1lcGFkc1tpbmRleF0gJiYgdGhpcy5fcmF3Z2FtZXBhZHNbaW5kZXhdLmNvbm5lY3RlZDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfcG9sbDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcmF3R2FtZXBhZHMgPSB0aGlzLl9nZXRHYW1lcGFkcygpO1xuICAgICAgaWYgKHJhd0dhbWVwYWRzKSB7XG4gICAgICAgIHRoaXMuX3Jhd2dhbWVwYWRzLmNsZWFyKCk7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGVuZCA9IHJhd0dhbWVwYWRzLmxlbmd0aDsgaSA8IGVuZDsgaSsrKSB7XG4gICAgICAgICAgaWYgKHJhd0dhbWVwYWRzW2ldKSB7XG4gICAgICAgICAgICB0aGlzLl9yYXdnYW1lcGFkcy5wdXNoKHJhd0dhbWVwYWRzW2ldKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX3N0YXRpYzoge1xuICAgICAgLyoqIOODluODqeOCpuOCtuOBjEdhbWVwYWQgQVBJ44Gr5a++5b+c44GX44Gm44GE44KL44GLLiAqL1xuICAgICAgaXNBdmFpbGFibGU6IChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG5hdiA9IHBoaW5hLmdsb2JhbC5uYXZpZ2F0b3I7XG4gICAgICAgIGlmICghbmF2KSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgcmV0dXJuICghIW5hdi5nZXRHYW1lcGFkcykgfHwgKCEhbmF2LndlYmtpdEdldEdhbWVwYWRzKTtcbiAgICAgIH0pKCksXG4gICAgfSxcblxuICB9KTtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmlucHV0LkdhbWVwYWRcbiAgICog44Ky44O844Og44OR44OD44OJXG4gICAqXG4gICAqIOebtOaOpeOCpOODs+OCueOCv+ODs+OCueWMluOBm+OBmuOAgXBoaW5hLmlucHV0LkdhbWVwYWRNYW5hZ2Vy44Kq44OW44K444Kn44Kv44OI44GL44KJ5Y+W5b6X44GX44Gm5L2/55So44GZ44KLLlxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKFwicGhpbmEuaW5wdXQuR2FtZXBhZFwiLCB7XG5cbiAgICBpbmRleDogbnVsbCxcbiAgICBidXR0b25zOiBudWxsLFxuICAgIC8qKiBAdHlwZSB7QXJyYXkuPHBoaW5hLmdlb20uVmVjdG9yMj59ICovXG4gICAgc3RpY2tzOiBudWxsLFxuXG4gICAgaWQ6IG51bGwsXG4gICAgY29ubmVjdGVkOiBmYWxzZSxcbiAgICBtYXBwaW5nOiBudWxsLFxuICAgIHRpbWVzdGFtcDogbnVsbCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICB0aGlzLmluZGV4ID0gaW5kZXggfHwgMDtcblxuICAgICAgdGhpcy5idXR0b25zID0gQXJyYXkucmFuZ2UoMCwgMTYpLm1hcChmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWx1ZTogMCxcbiAgICAgICAgICBwcmVzc2VkOiBmYWxzZSxcbiAgICAgICAgICBsYXN0OiBmYWxzZSxcbiAgICAgICAgICBkb3duOiBmYWxzZSxcbiAgICAgICAgICB1cDogZmFsc2UsXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICAgIHRoaXMuc3RpY2tzID0gQXJyYXkucmFuZ2UoMCwgMikubWFwKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcGhpbmEuZ2VvbS5WZWN0b3IyKDAsIDApO1xuICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOODnOOCv+ODs+OBjOaKvOOBleOCjOOBpuOBhOOCi+OBiy5cbiAgICAgKi9cbiAgICBnZXRLZXk6IGZ1bmN0aW9uKGJ1dHRvbikge1xuICAgICAgaWYgKHR5cGVvZihidXR0b24pID09PSAnc3RyaW5nJykge1xuICAgICAgICBidXR0b24gPSBwaGluYS5pbnB1dC5HYW1lcGFkLkJVVFRPTl9DT0RFW2J1dHRvbl07XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5idXR0b25zW2J1dHRvbl0pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnV0dG9uc1tidXR0b25dLnByZXNzZWQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOODnOOCv+ODs+OCkuaKvOOBl+OBny5cbiAgICAgKi9cbiAgICBnZXRLZXlEb3duOiBmdW5jdGlvbihidXR0b24pIHtcbiAgICAgIGlmICh0eXBlb2YoYnV0dG9uKSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgYnV0dG9uID0gcGhpbmEuaW5wdXQuR2FtZXBhZC5CVVRUT05fQ09ERVtidXR0b25dO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuYnV0dG9uc1tidXR0b25dKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJ1dHRvbnNbYnV0dG9uXS5kb3duO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDjg5zjgr/jg7PjgpLpm6LjgZfjgZ8uXG4gICAgICovXG4gICAgZ2V0S2V5VXA6IGZ1bmN0aW9uKGJ1dHRvbikge1xuICAgICAgaWYgKHR5cGVvZihidXR0b24pID09PSAnc3RyaW5nJykge1xuICAgICAgICBidXR0b24gPSBwaGluYS5pbnB1dC5HYW1lcGFkLkJVVFRPTl9DT0RFW2J1dHRvbl07XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5idXR0b25zW2J1dHRvbl0pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnV0dG9uc1tidXR0b25dLnVwO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDljYHlrZfjgq3jg7zjga7lhaXlipvjgZXjgozjgabjgYTjgovmlrnlkJEuXG4gICAgICovXG4gICAgZ2V0S2V5QW5nbGU6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGFuZ2xlID0gbnVsbDtcbiAgICAgIHZhciBhcnJvd0JpdCA9XG4gICAgICAgICh0aGlzLmdldEtleSgnbGVmdCcpIDw8IDMpIHwgLy8gMTAwMFxuICAgICAgICAodGhpcy5nZXRLZXkoJ3VwJykgPDwgMikgfCAvLyAwMTAwXG4gICAgICAgICh0aGlzLmdldEtleSgncmlnaHQnKSA8PCAxKSB8IC8vIDAwMTBcbiAgICAgICAgKHRoaXMuZ2V0S2V5KCdkb3duJykpOyAvLyAwMDAxXG5cbiAgICAgIGlmIChhcnJvd0JpdCAhPT0gMCAmJiBBUlJPV19CSVRfVE9fQU5HTEVfVEFCTEUuaGFzT3duUHJvcGVydHkoYXJyb3dCaXQpKSB7XG4gICAgICAgIGFuZ2xlID0gQVJST1dfQklUX1RPX0FOR0xFX1RBQkxFW2Fycm93Qml0XTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGFuZ2xlO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDljYHlrZfjgq3jg7zjga7lhaXlipvjgZXjgozjgabjgYTjgovmlrnlkJHjgpLjg5njgq/jg4jjg6vjgacuXG4gICAgICog5q2j6KaP5YyW44GV44KM44Gm44GE44KLLlxuICAgICAqL1xuICAgIGdldEtleURpcmVjdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZGlyZWN0aW9uID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDAsIDApO1xuXG4gICAgICBpZiAodGhpcy5nZXRLZXkoJ2xlZnQnKSkge1xuICAgICAgICBkaXJlY3Rpb24ueCA9IC0xO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLmdldEtleSgncmlnaHQnKSkge1xuICAgICAgICBkaXJlY3Rpb24ueCA9IDE7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5nZXRLZXkoJ3VwJykpIHtcbiAgICAgICAgZGlyZWN0aW9uLnkgPSAtMTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5nZXRLZXkoJ2Rvd24nKSkge1xuICAgICAgICBkaXJlY3Rpb24ueSA9IDE7XG4gICAgICB9XG5cbiAgICAgIGlmIChkaXJlY3Rpb24ueCAmJiBkaXJlY3Rpb24ueSkge1xuICAgICAgICBkaXJlY3Rpb24uZGl2KE1hdGguU1FSVDIpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZGlyZWN0aW9uO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDjgrnjg4bjgqPjg4Pjgq/jga7lhaXlipvjgZXjgozjgabjgYTjgovmlrnlkJEuXG4gICAgICovXG4gICAgZ2V0U3RpY2tBbmdsZTogZnVuY3Rpb24oc3RpY2tJZCkge1xuICAgICAgc3RpY2tJZCA9IHN0aWNrSWQgfHwgMDtcbiAgICAgIHZhciBzdGljayA9IHRoaXMuc3RpY2tzW3N0aWNrSWRdO1xuICAgICAgcmV0dXJuIHN0aWNrID8gTWF0aC5hdGFuMigtc3RpY2sueSwgc3RpY2sueCkgOiBudWxsO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDjgrnjg4bjgqPjg4Pjgq/jga7lhaXlipvjgZXjgozjgabjgYTjgovmlrnlkJHjgpLjg5njgq/jg4jjg6vjgacuXG4gICAgICovXG4gICAgZ2V0U3RpY2tEaXJlY3Rpb246IGZ1bmN0aW9uKHN0aWNrSWQpIHtcbiAgICAgIHN0aWNrSWQgPSBzdGlja0lkIHx8IDA7XG4gICAgICByZXR1cm4gdGhpcy5zdGlja3MgPyB0aGlzLnN0aWNrc1tzdGlja0lkXS5jbG9uZSgpIDogcGhpbmEuZ2VvbS5WZWN0b3IyKDAsIDApO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF91cGRhdGVTdGF0ZTogZnVuY3Rpb24oZ2FtZXBhZCkge1xuICAgICAgdGhpcy5pZCA9IGdhbWVwYWQuaWQ7XG4gICAgICB0aGlzLmNvbm5lY3RlZCA9IGdhbWVwYWQuY29ubmVjdGVkO1xuICAgICAgdGhpcy5tYXBwaW5nID0gZ2FtZXBhZC5tYXBwaW5nO1xuICAgICAgdGhpcy50aW1lc3RhbXAgPSBnYW1lcGFkLnRpbWVzdGFtcDtcblxuICAgICAgZm9yICh2YXIgaSA9IDAsIGllbmQgPSBnYW1lcGFkLmJ1dHRvbnMubGVuZ3RoOyBpIDwgaWVuZDsgaSsrKSB7XG4gICAgICAgIHRoaXMuX3VwZGF0ZUJ1dHRvbihnYW1lcGFkLmJ1dHRvbnNbaV0sIGkpO1xuICAgICAgfVxuXG4gICAgICBmb3IgKHZhciBqID0gMCwgamVuZCA9IGdhbWVwYWQuYXhlcy5sZW5ndGg7IGogPCBqZW5kOyBqICs9IDIpIHtcbiAgICAgICAgdGhpcy5fdXBkYXRlU3RpY2soZ2FtZXBhZC5heGVzW2ogKyAwXSwgaiAvIDIsICd4Jyk7XG4gICAgICAgIHRoaXMuX3VwZGF0ZVN0aWNrKGdhbWVwYWQuYXhlc1tqICsgMV0sIGogLyAyLCAneScpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF91cGRhdGVTdGF0ZUVtcHR5OiBmdW5jdGlvbigpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBpZW5kID0gdGhpcy5idXR0b25zLmxlbmd0aDsgaSA8IGllbmQ7IGkrKykge1xuICAgICAgICB0aGlzLmJ1dHRvbnNbaV0uZG93biA9IGZhbHNlO1xuICAgICAgICB0aGlzLmJ1dHRvbnNbaV0udXAgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfdXBkYXRlQnV0dG9uOiBmdW5jdGlvbih2YWx1ZSwgYnV0dG9uSWQpIHtcbiAgICAgIGlmICh0aGlzLmJ1dHRvbnNbYnV0dG9uSWRdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5idXR0b25zW2J1dHRvbklkXSA9IHtcbiAgICAgICAgICB2YWx1ZTogMCxcbiAgICAgICAgICBwcmVzc2VkOiBmYWxzZSxcbiAgICAgICAgICBsYXN0OiBmYWxzZSxcbiAgICAgICAgICBkb3duOiBmYWxzZSxcbiAgICAgICAgICB1cDogZmFsc2UsXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBcbiAgICAgIHZhciBidXR0b24gPSB0aGlzLmJ1dHRvbnNbYnV0dG9uSWRdO1xuXG4gICAgICBidXR0b24ubGFzdCA9IGJ1dHRvbi5wcmVzc2VkO1xuXG4gICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jykge1xuICAgICAgICBidXR0b24udmFsdWUgPSB2YWx1ZS52YWx1ZTtcbiAgICAgICAgYnV0dG9uLnByZXNzZWQgPSB2YWx1ZS5wcmVzc2VkO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYnV0dG9uLnZhbHVlID0gdmFsdWU7XG4gICAgICAgIGJ1dHRvbi5wcmVzc2VkID0gdmFsdWUgPiBwaGluYS5pbnB1dC5HYW1lcGFkLkFOQUxPR1VFX0JVVFRPTl9USFJFU0hPTEQ7XG4gICAgICB9XG5cbiAgICAgIGJ1dHRvbi5kb3duID0gKGJ1dHRvbi5wcmVzc2VkIF4gYnV0dG9uLmxhc3QpICYgYnV0dG9uLnByZXNzZWQ7XG4gICAgICBidXR0b24udXAgPSAoYnV0dG9uLnByZXNzZWQgXiBidXR0b24ubGFzdCkgJiBidXR0b24ubGFzdDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfdXBkYXRlU3RpY2s6IGZ1bmN0aW9uKHZhbHVlLCBzdGlja0lkLCBheGlzTmFtZSkge1xuICAgICAgaWYgKHRoaXMuc3RpY2tzW3N0aWNrSWRdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5zdGlja3Nbc3RpY2tJZF0gPSBwaGluYS5nZW9tLlZlY3RvcjIoMCwgMCk7XG4gICAgICB9XG4gICAgICB0aGlzLnN0aWNrc1tzdGlja0lkXVtheGlzTmFtZV0gPSB2YWx1ZTtcbiAgICB9LFxuXG4gICAgX3N0YXRpYzoge1xuICAgICAgLyoqIOODluODqeOCpuOCtuOBjEdhbWVwYWQgQVBJ44Gr5a++5b+c44GX44Gm44GE44KL44GLLiAqL1xuICAgICAgaXNBdmFpbGFibGU6IChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG5hdiA9IHBoaW5hLmdsb2JhbC5uYXZpZ2F0b3I7XG4gICAgICAgIGlmICghbmF2KSByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgcmV0dXJuICghIW5hdi5nZXRHYW1lcGFkcykgfHwgKCEhbmF2LndlYmtpdEdldEdhbWVwYWRzKTtcbiAgICAgIH0pKCksXG5cbiAgICAgIC8qKiDjgqLjg4rjg63jgrDlhaXlipvlr77lv5zjga7jg5zjgr/jg7Pjga7loLTlkIjjgIHjganjga7nqIvluqbjgb7jgafmirzjgZfovrzjgoDjgahvbuOBq+OBquOCi+OBi+OCkuihqOOBmeOBl+OBjeOBhOWApC4gKi9cbiAgICAgIEFOQUxPR1VFX0JVVFRPTl9USFJFU0hPTEQ6IDAuNSxcblxuICAgICAgLyoqIOODnOOCv+ODs+WQjeOBqOODnOOCv+ODs0lE44Gu44Oe44OD44OXLiAqL1xuICAgICAgQlVUVE9OX0NPREU6IHtcbiAgICAgICAgJ2EnOiAwLFxuICAgICAgICAnYic6IDEsXG4gICAgICAgICd4JzogMixcbiAgICAgICAgJ3knOiAzLFxuXG4gICAgICAgICdsMSc6IDQsXG4gICAgICAgICdyMSc6IDUsXG4gICAgICAgICdsMic6IDYsXG4gICAgICAgICdyMic6IDcsXG5cbiAgICAgICAgJ3NlbGVjdCc6IDgsXG4gICAgICAgICdzdGFydCc6IDksXG5cbiAgICAgICAgJ2wzJzogMTAsXG4gICAgICAgICdyMyc6IDExLFxuXG4gICAgICAgICd1cCc6IDEyLFxuICAgICAgICAnZG93bic6IDEzLFxuICAgICAgICAnbGVmdCc6IDE0LFxuICAgICAgICAncmlnaHQnOiAxNSxcblxuICAgICAgICAnc3BlY2lhbCc6IDE2LFxuXG4gICAgICAgICdBJzogMCxcbiAgICAgICAgJ0InOiAxLFxuICAgICAgICAnWCc6IDIsXG4gICAgICAgICdZJzogMyxcblxuICAgICAgICAnTDEnOiA0LFxuICAgICAgICAnUjEnOiA1LFxuICAgICAgICAnTDInOiA2LFxuICAgICAgICAnUjInOiA3LFxuXG4gICAgICAgICdTRUxFQ1QnOiA4LFxuICAgICAgICAnU1RBUlQnOiA5LFxuXG4gICAgICAgICdMMyc6IDEwLFxuICAgICAgICAnUjMnOiAxMSxcblxuICAgICAgICAnVVAnOiAxMixcbiAgICAgICAgJ0RPV04nOiAxMyxcbiAgICAgICAgJ0xFRlQnOiAxNCxcbiAgICAgICAgJ1JJR0hUJzogMTUsXG5cbiAgICAgICAgJ1NQRUNJQUwnOiAxNixcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgdmFyIEFSUk9XX0JJVF9UT19BTkdMRV9UQUJMRSA9IHtcbiAgICAweDAwOiBudWxsLFxuXG4gICAgLyogQHByb3BlcnR5IOS4iyAqL1xuICAgIDB4MDE6IDI3MCxcbiAgICAvKiBAcHJvcGVydHkg5Y+zICovXG4gICAgMHgwMjogMCxcbiAgICAvKiBAcHJvcGVydHkg5LiKICovXG4gICAgMHgwNDogOTAsXG4gICAgLyogQHByb3BlcnR5IOW3piAqL1xuICAgIDB4MDg6IDE4MCxcblxuICAgIC8qIEBwcm9wZXJ0eSDlj7PkuIogKi9cbiAgICAweDA2OiA0NSxcbiAgICAvKiBAcHJvcGVydHkg5Y+z5LiLICovXG4gICAgMHgwMzogMzE1LFxuICAgIC8qIEBwcm9wZXJ0eSDlt6bkuIogKi9cbiAgICAweDBjOiAxMzUsXG4gICAgLyogQHByb3BlcnR5IOW3puS4iyAqL1xuICAgIDB4MDk6IDIyNSxcblxuICAgIC8vIOS4ieaWueWQkeWQjOaZguaKvOOBl+WvvuW/nFxuICAgIC8vIOaDs+WumuWkluOBruaTjeS9nOOBoOOBjOWvvuW/nOOBl+OBqOOBhOOBn+OBu+OBhuOBjOeEoembo1xuICAgIC8qIEBwcm9wZXJ0eSDlj7PkuIrlt6YgKi9cbiAgICAweDBlOiA5MCxcbiAgICAvKiBAcHJvcGVydHkg5LiK5bem5LiLICovXG4gICAgMHgwZDogMTgwLFxuICAgIC8qIEBwcm9wZXJ0eSDlt6bkuIvlj7MgKi9cbiAgICAweDBiOiAyNzAsXG4gICAgLyogQHByb3BlcnR5IOS4i+WPs+S4iiAqL1xuICAgIDB4MDc6IDAsXG4gIH07XG5cbn0pO1xuXG4vKlxuICpcbiAqL1xuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmlucHV0LkFjY2VsZXJvbWV0ZXJcbiAgICog44K544Oe44O844OI44OV44Kp44Oz44Gu44K744Oz44K144O85oOF5aCxXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmlucHV0LkFjY2VsZXJvbWV0ZXInLCB7XG5cbiAgICAvKiogQHByb3BlcnR5ICBncmF2aXR5IOmHjeWKm+OCu+ODs+OCteODvCAqL1xuICAgIC8qKiBAcHJvcGVydHkgIGFjY2VsZXJhdGlvbiDliqDpgJ/luqbjgrvjg7PjgrXjg7wgKi9cbiAgICAvKiogQHByb3BlcnR5ICByb3RhdGlvbiDlm57ou6LliqDpgJ/luqbjgrvjg7PjgrXjg7wgKi9cbiAgICAvKiogQHByb3BlcnR5ICBvcmllbnRhdGlvbiDjgrnjg57jg7zjg4jjg5Xjgqnjg7Pjga7lgr7jgY0gKi9cblxuICAgIC8qKlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuXG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICBcbiAgICAgIHRoaXMuZ3Jhdml0eSAgICAgICAgPSBwaGluYS5nZW9tLlZlY3RvcjMoMCwgMCwgMCk7XG4gICAgICB0aGlzLmFjY2VsZXJhdGlvbiAgID0gcGhpbmEuZ2VvbS5WZWN0b3IzKDAsIDAsIDApO1xuICAgICAgdGhpcy5yb3RhdGlvbiAgICAgICA9IHBoaW5hLmdlb20uVmVjdG9yMygwLCAwLCAwKTtcbiAgICAgIHRoaXMub3JpZW50YXRpb24gICAgPSBwaGluYS5nZW9tLlZlY3RvcjMoMCwgMCwgMCk7XG5cbiAgICAgIGlmIChwaGluYS5pc01vYmlsZSgpKSB7XG4gICAgICAgIHBoaW5hLmdsb2JhbC5hZGRFdmVudExpc3RlbmVyKFwiZGV2aWNlbW90aW9uXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICB2YXIgYWNjZWxlcmF0aW9uID0gc2VsZi5hY2NlbGVyYXRpb247XG4gICAgICAgICAgdmFyIGdyYXZpdHkgPSBzZWxmLmdyYXZpdHk7XG4gICAgICAgICAgdmFyIHJvdGF0aW9uID0gc2VsZi5yb3RhdGlvbjtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoZS5hY2NlbGVyYXRpb24pIHtcbiAgICAgICAgICAgIGFjY2VsZXJhdGlvbi54ID0gZS5hY2NlbGVyYXRpb24ueDtcbiAgICAgICAgICAgIGFjY2VsZXJhdGlvbi55ID0gZS5hY2NlbGVyYXRpb24ueTtcbiAgICAgICAgICAgIGFjY2VsZXJhdGlvbi56ID0gZS5hY2NlbGVyYXRpb24uejtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGUuYWNjZWxlcmF0aW9uSW5jbHVkaW5nR3Jhdml0eSkge1xuICAgICAgICAgICAgZ3Jhdml0eS54ID0gZS5hY2NlbGVyYXRpb25JbmNsdWRpbmdHcmF2aXR5Lng7XG4gICAgICAgICAgICBncmF2aXR5LnkgPSBlLmFjY2VsZXJhdGlvbkluY2x1ZGluZ0dyYXZpdHkueTtcbiAgICAgICAgICAgIGdyYXZpdHkueiA9IGUuYWNjZWxlcmF0aW9uSW5jbHVkaW5nR3Jhdml0eS56O1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZS5yb3RhdGlvblJhdGUpIHtcbiAgICAgICAgICAgIHJvdGF0aW9uLnggPSByb3RhdGlvbi5iZXRhICA9IGUucm90YXRpb25SYXRlLmJldGE7XG4gICAgICAgICAgICByb3RhdGlvbi55ID0gcm90YXRpb24uZ2FtbWEgPSBlLnJvdGF0aW9uUmF0ZS5nYW1tYTtcbiAgICAgICAgICAgIHJvdGF0aW9uLnogPSByb3RhdGlvbi5hbHBoYSA9IGUucm90YXRpb25SYXRlLmFscGhhO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBwaGluYS5nbG9iYWwuYWRkRXZlbnRMaXN0ZW5lcihcImRldmljZW9yaWVudGF0aW9uXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICB2YXIgb3JpZW50YXRpb24gPSBzZWxmLm9yaWVudGF0aW9uO1xuICAgICAgICAgIG9yaWVudGF0aW9uLmFscGhhICAgPSBlLmFscGhhOyAgLy8geigwfjM2MClcbiAgICAgICAgICBvcmllbnRhdGlvbi5iZXRhICAgID0gZS5iZXRhOyAgIC8vIHgoLTE4MH4xODApXG4gICAgICAgICAgb3JpZW50YXRpb24uZ2FtbWEgICA9IGUuZ2FtbWE7ICAvLyB5KC05MH45MClcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcblxuICB9KTtcblxufSk7XG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmFwcC5VcGRhdGVyXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmFwcC5VcGRhdGVyJywge1xuXG4gICAgaW5pdDogZnVuY3Rpb24oYXBwKSB7XG4gICAgICB0aGlzLmFwcCA9IGFwcDtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbihyb290KSB7XG4gICAgICB0aGlzLl91cGRhdGVFbGVtZW50KHJvb3QpO1xuICAgIH0sXG5cbiAgICBfdXBkYXRlRWxlbWVudDogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgdmFyIGFwcCA9IHRoaXMuYXBwO1xuXG4gICAgICAvLyDmm7TmlrDjgZnjgovjgYvjgpLliKTlrppcbiAgICAgIGlmIChlbGVtZW50LmF3YWtlID09PSBmYWxzZSkgcmV0dXJuIDtcblxuICAgICAgLy8g44Ko44Oz44K/44O844OV44Os44O844Og44Kk44OZ44Oz44OIXG4gICAgICBpZiAoZWxlbWVudC5oYXMoJ2VudGVyZnJhbWUnKSkge1xuICAgICAgICBlbGVtZW50LmZsYXJlKCdlbnRlcmZyYW1lJywge1xuICAgICAgICAgIGFwcDogdGhpcy5hcHAsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyDmm7TmlrBcbiAgICAgIGlmIChlbGVtZW50LnVwZGF0ZSkgZWxlbWVudC51cGRhdGUoYXBwKTtcblxuICAgICAgLy8g44K/44OD44OB5Yik5a6aXG4gICAgICAvLyB0aGlzLl9jaGVja1BvaW50KGVsZW1lbnQpO1xuXG4gICAgICAvLyDlrZDkvpvjgpLmm7TmlrBcbiAgICAgIHZhciBsZW4gPSBlbGVtZW50LmNoaWxkcmVuLmxlbmd0aDtcbiAgICAgIGlmIChlbGVtZW50LmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdmFyIHRlbXBDaGlsZHJlbiA9IGVsZW1lbnQuY2hpbGRyZW4uc2xpY2UoKTtcbiAgICAgICAgZm9yICh2YXIgaT0wOyBpPGxlbjsgKytpKSB7XG4gICAgICAgICAgdGhpcy5fdXBkYXRlRWxlbWVudCh0ZW1wQ2hpbGRyZW5baV0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIF9jaGVja1BvaW50OiBmdW5jdGlvbihvYmopIHtcblxuICAgICAgdGhpcy5hcHAucG9pbnRlcnMuZm9yRWFjaChmdW5jdGlvbihwKSB7XG4gICAgICAgIGlmIChwLmlkICE9PSBudWxsKSB7XG4gICAgICAgICAgdGhpcy5fX2NoZWNrUG9pbnQob2JqLCBwKTtcbiAgICAgICAgfVxuICAgICAgfSwgdGhpcyk7XG4gICAgfSxcblxuICAgIF9fY2hlY2tQb2ludDogZnVuY3Rpb24ob2JqLCBwKSB7XG4gICAgICBpZiAoIW9iai5pbnRlcmFjdGl2ZSkgcmV0dXJuIDtcblxuICAgICAgdmFyIHByZXZPdmVyRmxhZyA9IG9iai5fb3ZlckZsYWdzW3AuaWRdO1xuICAgICAgdmFyIG92ZXJGbGFnID0gb2JqLmhpdFRlc3QyKHAueCwgcC55KTtcbiAgICAgIG9iai5fb3ZlckZsYWdzW3AuaWRdID0gb3ZlckZsYWc7XG5cbiAgICAgIGlmICghcHJldk92ZXJGbGFnICYmIG92ZXJGbGFnKSB7XG4gICAgICAgIG9iai5mbGFyZSgncG9pbnRvdmVyJywge1xuICAgICAgICAgIHBvaW50ZXI6IHAsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKHByZXZPdmVyRmxhZyAmJiAhb3ZlckZsYWcpIHtcbiAgICAgICAgb2JqLmZsYXJlKCdwb2ludG91dCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAob3ZlckZsYWcpIHtcbiAgICAgICAgaWYgKHAuZ2V0UG9pbnRpbmdTdGFydCgpKSB7XG4gICAgICAgICAgb2JqLl90b3VjaEZsYWdzW3AuaWRdID0gdHJ1ZTtcbiAgICAgICAgICBvYmouZmxhcmUoJ3BvaW50c3RhcnQnKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAob2JqLl90b3VjaEZsYWdzW3AuaWRdKSB7XG4gICAgICAgIG9iai5mbGFyZSgncG9pbnRzdGF5Jyk7XG4gICAgICAgIGlmIChwLl9tb3ZlRmxhZykge1xuICAgICAgICAgIG9iai5mbGFyZSgncG9pbnRtb3ZlJyk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKG9iai5fdG91Y2hGbGFnc1twLmlkXT09PXRydWUgJiYgcC5nZXRQb2ludGluZ0VuZCgpKSB7XG4gICAgICAgIG9iai5fdG91Y2hGbGFnc1twLmlkXSA9IGZhbHNlO1xuICAgICAgICBvYmouZmxhcmUoJ3BvaW50ZW5kJyk7XG5cbiAgICAgICAgaWYgKG9iai5fb3ZlckZsYWdzW3AuaWRdKSB7XG4gICAgICAgICAgb2JqLl9vdmVyRmxhZ3NbcC5pZF0gPSBmYWxzZTtcbiAgICAgICAgICBvYmouZmxhcmUoJ3BvaW50b3V0Jyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gIH0pO1xuXG4gIFxufSk7XG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmFwcC5JbnRlcmFjdGl2ZVxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5hcHAuSW50ZXJhY3RpdmUnLCB7XG5cbiAgICBpbml0OiBmdW5jdGlvbihhcHApIHtcbiAgICAgIHRoaXMuYXBwID0gYXBwO1xuICAgICAgdGhpcy5fZW5hYmxlID0gdHJ1ZTtcbiAgICAgIHRoaXMubXVsdGlUb3VjaCA9IHRydWU7XG4gICAgICB0aGlzLmV2ZW50cyA9IHt9O1xuICAgICAgdGhpcy5jdXJzb3IgPSB7XG4gICAgICAgIG5vcm1hbDogJycsXG4gICAgICAgIGhvdmVyOiAncG9pbnRlcicsXG4gICAgICB9O1xuICAgICAgdGhpcy5ob3ZlciA9IGZhbHNlO1xuICAgIH0sXG5cbiAgICBlbmFibGU6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5fZW5hYmxlID0gdHJ1ZTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgZGlzYWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLl9lbmFibGUgPSBmYWxzZTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBjaGVjazogZnVuY3Rpb24ocm9vdCkge1xuICAgICAgLy8g44Kr44O844K944Or44Gu44K544K/44Kk44Or44KS5Y+N5pigXG4gICAgICBpZiAodGhpcy5hcHAuZG9tRWxlbWVudCkge1xuICAgICAgICBpZiAodGhpcy5ob3Zlcikge1xuICAgICAgICAgIHRoaXMuYXBwLmRvbUVsZW1lbnQuc3R5bGUuY3Vyc29yID0gdGhpcy5jdXJzb3IuaG92ZXI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdGhpcy5hcHAuZG9tRWxlbWVudC5zdHlsZS5jdXJzb3IgPSB0aGlzLmN1cnNvci5ub3JtYWw7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMuaG92ZXIgPSBmYWxzZTtcbiAgICAgIGlmICghdGhpcy5fZW5hYmxlIHx8ICF0aGlzLmFwcC5wb2ludGVycykgcmV0dXJuIDtcblxuICAgICAgaWYgKHRoaXMubXVsdGlUb3VjaCkge1xuICAgICAgICB0aGlzLmFwcC5wb2ludGVycy5mb3JFYWNoKGZ1bmN0aW9uKHApIHtcbiAgICAgICAgICBpZiAocC5pZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5faW5pdEV2ZW50cyhwKTtcbiAgICAgICAgICAgIHRoaXMuX2NoZWNrRWxlbWVudChyb290LCBwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIHRoaXMpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuX2luaXRFdmVudHModGhpcy5hcHAucG9pbnRlcik7XG4gICAgICAgIHRoaXMuX2NoZWNrRWxlbWVudChyb290LCB0aGlzLmFwcC5wb2ludGVyKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX2luaXRFdmVudHM6IGZ1bmN0aW9uKHBvaW50ZXIpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIFtcbiAgICAgICAgJ3BvaW50c3RhcnQnLFxuICAgICAgICAncG9pbnRtb3ZlJyxcbiAgICAgICAgJ3BvaW50ZW5kJyxcbiAgICAgICAgJ3BvaW50b3ZlcicsXG4gICAgICAgICdwb2ludG91dCcsXG4gICAgICAgICdwb2ludHN0YXknLFxuICAgICAgXS5mb3JFYWNoKGZ1bmN0aW9uKGV2ZW50TmFtZSkge1xuICAgICAgICBzZWxmLl9pbml0RXZlbnQoZXZlbnROYW1lLCBwb2ludGVyLCBbXSk7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgX2luaXRFdmVudDogZnVuY3Rpb24oZXZlbnROYW1lLCBwb2ludGVyLCBwYXRoKSB7XG4gICAgICB0aGlzLmV2ZW50c1tldmVudE5hbWVdID0ge1xuICAgICAgICB0eXBlOiBldmVudE5hbWUsXG4gICAgICAgIHRhcmdldDogbnVsbCxcbiAgICAgICAgcGF0aDogcGF0aCxcbiAgICAgICAgcG9pbnRlcjogcG9pbnRlcixcbiAgICAgICAgaW50ZXJhY3RpdmU6IHRoaXMsXG4gICAgICAgIC8vIOimquimgee0oOOBuOOCpOODmeODs+ODiOOCkuS8neaSreOBmeOCi+OBi1xuICAgICAgICBzdG9wOiBmYWxzZSxcbiAgICAgICAgLy8g5LiA5bqm44Kk44OZ44Oz44OI44GM55m654Gr44GX44Gm44KC44CB57aa6KGM44GX44Gm6IOM6Z2i44Gu6KaB57Sg44G+44Gn44Kk44OZ44Oz44OI44KS55m654Gr44GV44Gb44KL44GLXG4gICAgICAgIHBhc3M6IGZhbHNlLFxuICAgICAgICBfZW5kOiBmYWxzZSxcbiAgICAgIH07XG4gICAgfSxcblxuICAgIF9jaGVja0VsZW1lbnQ6IGZ1bmN0aW9uKGVsZW1lbnQsIHApIHtcbiAgICAgIHZhciBhcHAgPSB0aGlzLmFwcDtcblxuICAgICAgLy8g5pu05paw44GZ44KL44GL44KS5Yik5a6aXG4gICAgICBpZiAoZWxlbWVudC5hd2FrZSA9PT0gZmFsc2UpIHJldHVybiA7XG5cbiAgICAgIHZhciBldmVudHMgPSB0aGlzLmV2ZW50cztcbiAgICAgIHZhciBhbGxFbmRlZCA9IHRydWU7XG5cbiAgICAgIGZvciAodmFyIGsgaW4gZXZlbnRzKSB7XG4gICAgICAgIHZhciBlID0gZXZlbnRzW2tdO1xuICAgICAgICBpZiAoIWUuX2VuZCkge1xuICAgICAgICAgIGFsbEVuZGVkID0gZmFsc2U7XG4gICAgICAgICAgZS5wYXRoLnVuc2hpZnQoZWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChhbGxFbmRlZCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICAvLyDlrZDkvpvjgpLmm7TmlrBcbiAgICAgIHZhciBsZW4gPSBlbGVtZW50LmNoaWxkcmVuLmxlbmd0aDtcbiAgICAgIGlmIChsZW4gPiAwKSB7XG4gICAgICAgIHZhciB0ZW1wQ2hpbGRyZW4gPSBlbGVtZW50LmNoaWxkcmVuLnNsaWNlKCk7XG4gICAgICAgIGZvciAodmFyIGkgPSBsZW4gLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICAgIHRoaXMuX2NoZWNrRWxlbWVudCh0ZW1wQ2hpbGRyZW5baV0sIHApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIOOCv+ODg+ODgeWIpOWumlxuICAgICAgaWYgKGVsZW1lbnQuaW50ZXJhY3RpdmUpIHtcbiAgICAgICAgLy8g44Kk44OZ44Oz44OI55m654Gr5a++6LGh44Gu44Kk44OZ44Oz44OI44Gu6YWN5YiX44KS5Y+W5b6XXG4gICAgICAgIHZhciB0YXJnZXRFdmVudHMgPSB0aGlzLl9jaGVja1BvaW50KGVsZW1lbnQsIHApO1xuICAgICAgICBcbiAgICAgICAgaWYgKGVsZW1lbnQuX292ZXJGbGFnc1twLmlkXSkge1xuICAgICAgICAgIC8vIOW+jOOCjeOBq+imgee0oOOBjOmHjeOBquOBo+OBpuOCi+WgtOWQiOOBqyBwb2ludG92ZXIsIHBvaW50b3V0IOOBjOeZuueBq+OBl+OBquOBhOOCiOOBhuOBq+OBmeOCi1xuICAgICAgICAgIGV2ZW50cy5wb2ludG92ZXIuX2VuZCA9IHRydWU7XG4gICAgICAgICAgZXZlbnRzLnBvaW50b3V0Ll9lbmQgPSB0cnVlO1xuXG4gICAgICAgICAgLy8g5LiA44Gk44Gn44KCIG92ZXJGbGFnIOOBjOeri+OBo+OBpuOBhOOCi+acieWKueOBquimgee0oOOBjOOBguOCjOOBsOOAgWhvdmVy44Gr44GZ44KLXG4gICAgICAgICAgaWYgKGVsZW1lbnQuYm91bmRpbmdUeXBlICYmIGVsZW1lbnQuYm91bmRpbmdUeXBlICE9PSAnbm9uZScpIHtcbiAgICAgICAgICAgIHRoaXMuaG92ZXIgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRhcmdldEV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgLy8gdGFyZ2V044KS55m654Gr5YWD44Gu6KaB57Sg44Gr6Kit5a6aXG4gICAgICAgICAgZXZlbnQudGFyZ2V0ID0gZWxlbWVudDtcbiAgICAgICAgICAvLyDnmbrngavlhYPjgYvjgokgcm9vdCDopoHntKDjgb7jgafnmbrngatcbiAgICAgICAgICBldmVudC5wYXRoLnNvbWUoZnVuY3Rpb24oY2FwdHVyZWRFbGVtZW50KSB7XG4gICAgICAgICAgICBjYXB0dXJlZEVsZW1lbnQuZmlyZShldmVudCk7XG4gICAgICAgICAgICAvLyDjgqTjg5njg7Pjg4jlhoXjgacgc3RvcCDjgYwgdHJ1ZSDjgavjgarjgaPjgZ/loLTlkIjjga/jgIHopqropoHntKDjgbjkvJ3mkq3jgZnjgovjga7jgpLmraLjgoHjgotcbiAgICAgICAgICAgIHJldHVybiBldmVudC5zdG9wO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8g44Kk44OZ44Oz44OI57WC5LqG44OV44Op44Kw44KS56uL44Gm44Gm44CB44GT44KM5Lul5LiK44Kk44OZ44Oz44OI44KS55m654Gr44GX44Gq44GE44KI44GG44Gr44GZ44KLXG4gICAgICAgICAgZXZlbnQuX2VuZCA9IHRydWU7XG5cbiAgICAgICAgICAvLyDjgqTjg5njg7Pjg4jpgJrpgY7oqK3lrprjgYwgdHJ1ZSDjgarjgonjgIHjgqTjg5njg7Pjg4jjgYzntYLkuobjgZvjgZrjgavlvozjgo3jga7opoHntKDjgbjooYzjgY9cbiAgICAgICAgICBpZiAoZXZlbnQucGFzcykge1xuICAgICAgICAgICAgdGhpcy5faW5pdEV2ZW50KGV2ZW50LnR5cGUsIHAsIGV2ZW50LnBhdGguc2xpY2UoMCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcyk7XG4gICAgICB9XG5cbiAgICAgIGZvciAodmFyIGsgaW4gZXZlbnRzKSB7XG4gICAgICAgIHZhciBlID0gZXZlbnRzW2tdO1xuICAgICAgICBpZiAoIWUuX2VuZCkge1xuICAgICAgICAgIGUucGF0aC5zaGlmdCgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIF9jaGVja1BvaW50OiBmdW5jdGlvbihvYmosIHApIHtcbiAgICAgIHZhciBldmVudHMgPSB0aGlzLmV2ZW50cztcbiAgICAgIHZhciBwcmV2T3ZlckZsYWcgPSBvYmouX292ZXJGbGFnc1twLmlkXTtcbiAgICAgIHZhciBvdmVyRmxhZyA9IG9iai5oaXRUZXN0KHAueCwgcC55KTtcbiAgICAgIG9iai5fb3ZlckZsYWdzW3AuaWRdID0gb3ZlckZsYWc7XG4gICAgICB2YXIgdGFyZ2V0RXZlbnRzID0gW107XG5cbiAgICAgIGlmICghcHJldk92ZXJGbGFnICYmIG92ZXJGbGFnICYmICFldmVudHMucG9pbnRvdmVyLl9lbmQpIHtcbiAgICAgICAgdGFyZ2V0RXZlbnRzLnB1c2goZXZlbnRzLnBvaW50b3Zlcik7XG4gICAgICB9XG4gICAgICBpZiAocHJldk92ZXJGbGFnICYmICFvdmVyRmxhZyAmJiAhZXZlbnRzLnBvaW50b3V0Ll9lbmQpIHtcbiAgICAgICAgdGFyZ2V0RXZlbnRzLnB1c2goZXZlbnRzLnBvaW50b3V0KTtcbiAgICAgIH1cblxuICAgICAgaWYgKG92ZXJGbGFnICYmICFldmVudHMucG9pbnRzdGFydC5fZW5kICYmIHAuZ2V0UG9pbnRpbmdTdGFydCgpKSB7XG4gICAgICAgIG9iai5fdG91Y2hGbGFnc1twLmlkXSA9IHRydWU7XG4gICAgICAgIHRhcmdldEV2ZW50cy5wdXNoKGV2ZW50cy5wb2ludHN0YXJ0KTtcbiAgICAgICAgLy8g44Kv44Oq44OD44Kv44OV44Op44Kw44KS56uL44Gm44KLXG4gICAgICAgIG9iai5fY2xpY2tlZCA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIGlmIChvYmouX3RvdWNoRmxhZ3NbcC5pZF0pIHtcbiAgICAgICAgaWYgKCFldmVudHMucG9pbnRzdGF5Ll9lbmQpIHtcbiAgICAgICAgICB0YXJnZXRFdmVudHMucHVzaChldmVudHMucG9pbnRzdGF5KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWV2ZW50cy5wb2ludG1vdmUuX2VuZCAmJiBwLl9tb3ZlRmxhZykge1xuICAgICAgICAgIHRhcmdldEV2ZW50cy5wdXNoKGV2ZW50cy5wb2ludG1vdmUpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZXZlbnRzLnBvaW50ZW5kLl9lbmQgJiYgcC5nZXRQb2ludGluZ0VuZCgpKSB7XG4gICAgICAgICAgb2JqLl90b3VjaEZsYWdzW3AuaWRdID0gZmFsc2U7XG4gICAgICAgICAgdGFyZ2V0RXZlbnRzLnB1c2goZXZlbnRzLnBvaW50ZW5kKTtcblxuICAgICAgICAgIGlmICghZXZlbnRzLnBvaW50b3V0Ll9lbmQgJiYgb3ZlckZsYWcgJiYgcGhpbmEuaXNNb2JpbGUoKSkge1xuICAgICAgICAgICAgb2JqLl9vdmVyRmxhZ3NbcC5pZF0gPSBmYWxzZTtcbiAgICAgICAgICAgIHRhcmdldEV2ZW50cy5wdXNoKGV2ZW50cy5wb2ludG91dCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0YXJnZXRFdmVudHM7XG4gICAgfSxcbiAgfSk7XG5cblxufSk7XG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmFwcC5CYXNlQXBwXG4gICAqIOODmeODvOOCueOBqOOBquOCi+OCouODl+ODquOCseODvOOCt+ODp+ODs+OCr+ODqeOCuVxuICAgKiBAZXh0ZW5kcyBwaGluYS51dGlsLkV2ZW50RGlzcGF0Y2hlclxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5hcHAuQmFzZUFwcCcsIHtcbiAgICBzdXBlckNsYXNzOiAncGhpbmEudXRpbC5FdmVudERpc3BhdGNoZXInLFxuXG4gICAgLyoqIGF3YWtlICovXG4gICAgYXdha2U6IG51bGwsXG4gICAgLyoqIGZwcyAqL1xuICAgIGZwczogbnVsbCxcbiAgICAvKiogZnJhbWUgKi9cbiAgICBmcmFtZTogbnVsbCxcblxuICAgIC8qKlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5zdXBlckluaXQoKTtcbiAgICAgIHRoaXMuX3NjZW5lcyA9IFtwaGluYS5hcHAuU2NlbmUoKV07XG4gICAgICB0aGlzLl9zY2VuZUluZGV4ID0gMDtcblxuICAgICAgdGhpcy51cGRhdGVyID0gcGhpbmEuYXBwLlVwZGF0ZXIodGhpcyk7XG4gICAgICB0aGlzLmludGVyYWN0aXZlID0gcGhpbmEuYXBwLkludGVyYWN0aXZlKHRoaXMpO1xuXG4gICAgICB0aGlzLmF3YWtlID0gdHJ1ZTtcbiAgICAgIHRoaXMudGlja2VyID0gcGhpbmEudXRpbC5UaWNrZXIoKTtcbiAgICB9LFxuXG4gICAgcnVuOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIHRoaXMuX2xvb3BDYWxsZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgc2VsZi5fbG9vcCgpO1xuICAgICAgfTtcbiAgICAgIHRoaXMudGlja2VyLnRpY2sodGhpcy5fbG9vcENhbGxlcik7XG5cbiAgICAgIHRoaXMudGlja2VyLnN0YXJ0KCk7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBraWxsOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMudGlja2VyLnN0b3AoKTtcbiAgICAgIHRoaXMudGlja2VyLnVudGljayh0aGlzLl9sb29wQ2FsbGVyKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICByZXBsYWNlU2NlbmU6IGZ1bmN0aW9uKHNjZW5lKSB7XG4gICAgICB0aGlzLmZsYXJlKCdyZXBsYWNlJyk7XG4gICAgICB0aGlzLmZsYXJlKCdjaGFuZ2VzY2VuZScpO1xuXG4gICAgICB2YXIgZSA9IG51bGw7XG4gICAgICBpZiAodGhpcy5jdXJyZW50U2NlbmUpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50U2NlbmUuYXBwID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIHRoaXMuY3VycmVudFNjZW5lID0gc2NlbmU7XG4gICAgICB0aGlzLmN1cnJlbnRTY2VuZS5hcHAgPSB0aGlzO1xuICAgICAgdGhpcy5jdXJyZW50U2NlbmUuZmxhcmUoJ2VudGVyJywge1xuICAgICAgICBhcHA6IHRoaXMsXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIHB1c2hTY2VuZTogZnVuY3Rpb24oc2NlbmUpIHtcbiAgICAgIHRoaXMuZmxhcmUoJ3B1c2gnKTtcbiAgICAgIHRoaXMuZmxhcmUoJ2NoYW5nZXNjZW5lJyk7XG5cbiAgICAgIHRoaXMuY3VycmVudFNjZW5lLmZsYXJlKCdwYXVzZScsIHtcbiAgICAgICAgYXBwOiB0aGlzLFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHRoaXMuX3NjZW5lcy5wdXNoKHNjZW5lKTtcbiAgICAgICsrdGhpcy5fc2NlbmVJbmRleDtcblxuICAgICAgdGhpcy5mbGFyZSgncHVzaGVkJyk7XG4gICAgICBcbiAgICAgIHNjZW5lLmFwcCA9IHRoaXM7XG4gICAgICBzY2VuZS5mbGFyZSgnZW50ZXInLCB7XG4gICAgICAgIGFwcDogdGhpcyxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog44K344O844Oz44KS44Od44OD44OX44GZ44KLKOODneODvOOCuuOChOOCquODluOCt+ODp+ODs+eUu+mdouOBquOBqeOBp+S9v+eUqClcbiAgICAgKi9cbiAgICBwb3BTY2VuZTogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmZsYXJlKCdwb3AnKTtcbiAgICAgIHRoaXMuZmxhcmUoJ2NoYW5nZXNjZW5lJyk7XG5cbiAgICAgIHZhciBzY2VuZSA9IHRoaXMuX3NjZW5lcy5wb3AoKTtcbiAgICAgIC0tdGhpcy5fc2NlbmVJbmRleDtcblxuICAgICAgc2NlbmUuZmxhcmUoJ2V4aXQnLCB7XG4gICAgICAgIGFwcDogdGhpcyxcbiAgICAgIH0pO1xuICAgICAgc2NlbmUuYXBwID0gbnVsbDtcblxuICAgICAgdGhpcy5mbGFyZSgncG9wZWQnKTtcbiAgICAgIFxuICAgICAgLy8gXG4gICAgICB0aGlzLmN1cnJlbnRTY2VuZS5mbGFyZSgncmVzdW1lJywge1xuICAgICAgICBhcHA6IHRoaXMsXG4gICAgICAgIHByZXZTY2VuZTogc2NlbmUsXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHNjZW5lO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDjgrfjg7zjg7Pjga51cGRhdGXjgpLlrp/ooYzjgZnjgovjgojjgYbjgavjgZnjgotcbiAgICAgKi9cbiAgICBzdGFydDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmF3YWtlID0gdHJ1ZTtcblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiDjgrfjg7zjg7Pjga51cGRhdGXjgpLlrp/ooYzjgZfjgarjgYTjgojjgYbjgavjgZnjgotcbiAgICAgKi9cbiAgICBzdG9wOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuYXdha2UgPSBmYWxzZTtcblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIGVuYWJsZVN0YXRzOiBmdW5jdGlvbigpIHtcbiAgICAgIGlmIChwaGluYS5nbG9iYWwuU3RhdHMpIHtcbiAgICAgICAgdGhpcy5zdGF0cyA9IG5ldyBTdGF0cygpO1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuc3RhdHMuZG9tRWxlbWVudCk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgLy8gY29uc29sZS53YXJuKFwibm90IGRlZmluZWQgc3RhdHMuXCIpO1xuICAgICAgICB2YXIgU1RBVFNfVVJMID0gJ2h0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL3N0YXRzLmpzL3IxNC9TdGF0cy5qcyc7XG4gICAgICAgIHZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICAgICAgc2NyaXB0LnNyYyA9IFNUQVRTX1VSTDtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzY3JpcHQpO1xuICAgICAgICBzY3JpcHQub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdGhpcy5lbmFibGVTdGF0cygpO1xuICAgICAgICB9LmJpbmQodGhpcyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgZW5hYmxlRGF0R1VJOiBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgaWYgKHBoaW5hLmdsb2JhbC5kYXQpIHtcbiAgICAgICAgdmFyIGd1aSA9IG5ldyBwaGluYS5nbG9iYWwuZGF0LkdVSSgpO1xuICAgICAgICBjYWxsYmFjayhndWkpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIC8vIGNvbnNvbGUud2FybihcIm5vdCBkZWZpbmVkIGRhdC5HVUkuXCIpO1xuICAgICAgICB2YXIgVVJMID0gJ2h0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL2RhdC1ndWkvMC41LjEvZGF0Lmd1aS5qcyc7XG4gICAgICAgIHZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICAgICAgc2NyaXB0LnNyYyA9IFVSTDtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzY3JpcHQpO1xuICAgICAgICBzY3JpcHQub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIGd1aSA9IG5ldyBwaGluYS5nbG9iYWwuZGF0LkdVSSgpO1xuICAgICAgICAgIGNhbGxiYWNrKGd1aSk7XG4gICAgICAgIH0uYmluZCh0aGlzKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBfbG9vcDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLl91cGRhdGUoKTtcbiAgICAgIHRoaXMuaW50ZXJhY3RpdmUuY2hlY2sodGhpcy5jdXJyZW50U2NlbmUpO1xuICAgICAgdGhpcy5fZHJhdygpO1xuXG4gICAgICAvLyBzdGF0cyB1cGRhdGVcbiAgICAgIGlmICh0aGlzLnN0YXRzKSB0aGlzLnN0YXRzLnVwZGF0ZSgpO1xuICAgIH0sXG5cbiAgICBfdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLmF3YWtlKSB7XG4gICAgICAgIC8vIOOCqOODs+OCv+ODvOODleODrOODvOODoOOCpOODmeODs+ODiFxuICAgICAgICBpZiAodGhpcy5oYXMoJ2VudGVyZnJhbWUnKSkge1xuICAgICAgICAgIHRoaXMuZmxhcmUoJ2VudGVyZnJhbWUnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudXBkYXRlICYmIHRoaXMudXBkYXRlKCk7XG4gICAgICAgIHRoaXMudXBkYXRlci51cGRhdGUodGhpcy5jdXJyZW50U2NlbmUpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDmj4/nlLvnlKjku67mg7PplqLmlbBcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9kcmF3OiBmdW5jdGlvbigpIHt9LFxuXG4gICAgX2FjY2Vzc29yOiB7XG4gICAgICBjdXJyZW50U2NlbmU6IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSAgIHsgcmV0dXJuIHRoaXMuX3NjZW5lc1t0aGlzLl9zY2VuZUluZGV4XTsgfSxcbiAgICAgICAgXCJzZXRcIjogZnVuY3Rpb24odikgIHsgdGhpcy5fc2NlbmVzW3RoaXMuX3NjZW5lSW5kZXhdID0gdjsgfSxcbiAgICAgIH0sXG5cbiAgICAgIHJvb3RTY2VuZToge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpcy5fc2NlbmVzWzBdOyB9LFxuICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2KSAgeyB0aGlzLl9zY2VuZXNbMF0gPSB2OyB9LFxuICAgICAgfSxcblxuICAgICAgZnJhbWU6IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy50aWNrZXIuZnJhbWU7IH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uICh2KSB7IHRoaXMudGlja2VyLmZyYW1lID0gdjsgfSxcbiAgICAgIH0sXG5cbiAgICAgIGZwczoge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLnRpY2tlci5mcHM7IH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uICh2KSB7IHRoaXMudGlja2VyLmZwcyA9IHY7IH0sXG4gICAgICB9LFxuXG4gICAgICBkZWx0YVRpbWU6IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy50aWNrZXIuZGVsdGFUaW1lOyB9LFxuICAgICAgfSxcblxuICAgICAgZWxhcHNlZFRpbWU6IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy50aWNrZXIuZWxhcHNlZFRpbWU7IH0sXG4gICAgICB9LFxuXG4gICAgICBjdXJyZW50VGltZToge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLnRpY2tlci5jdXJyZW50VGltZTsgfSxcbiAgICAgIH0sXG5cbiAgICAgIHN0YXJ0VGltZToge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLnRpY2tlci5zdGFydFRpbWU7IH0sXG4gICAgICB9LFxuICAgIH0sXG5cbiAgfSk7XG5cbiAgXG59KTtcblxuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5hcHAuRWxlbWVudFxuICAgKiBAZXh0ZW5kcyBwaGluYS51dGlsLkV2ZW50RGlzcGF0Y2hlclxuICAgKiAjIOS4u+OBq+imgee0oOOBruimquWtkOmWouS/guOCkuaJseOBhuOCr+ODqeOCuVxuICAgKiDkuLvjgavopqrlrZDplqLkv4LnrYnjgpLlrprnvqnjgZnjgovjgq/jg6njgrnjgafjgZnjgIJcbiAgICovXG4gIHBoaW5hLmRlZmluZSgncGhpbmEuYXBwLkVsZW1lbnQnLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLnV0aWwuRXZlbnREaXNwYXRjaGVyJyxcblxuICAgIC8qKlxuICAgICAqIEBwcm9wZXJ0eSBwYXJlbnRcbiAgICAgKiDopqropoHntKBcbiAgICAgKi9cbiAgICBwYXJlbnQ6IG51bGwsXG5cbiAgICAvKipcbiAgICAgKiBAcHJvcGVydHkgY2hpbGRyZW5cbiAgICAgKiDlrZDopoHntKBcbiAgICAgKi9cbiAgICBjaGlsZHJlbjogbnVsbCxcblxuICAgIC8qKlxuICAgICAqIEBwcm9wZXJ0eSBhd2FrZVxuICAgICAqIOacieWKueOBi+OBqeOBhuOBi1xuICAgICAqL1xuICAgIGF3YWtlOiB0cnVlLFxuXG4gICAgLyoqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnN1cGVySW5pdCgpO1xuICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGFkZENoaWxkXG4gICAgICog6Ieq6Lqr44Gr5a2Q6KaB57Sg44KS6L+95Yqg44GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiDoh6rouqvjgpLlrZDopoHntKDjgajjgZfjgablvJXmlbDjgafmjIflrprjgZfjgZ/opoHntKDjgavov73liqDjgZnjgovjgavjga8ge0BsaW5rICNhZGRDaGlsZFRvfSDjgpLkvb/nlKjjgZfjgabjgY/jgaDjgZXjgYTjgIJcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjaGlsZCDov73liqDjgZnjgovlrZDopoHntKBcbiAgICAgKi9cbiAgICBhZGRDaGlsZDogZnVuY3Rpb24oY2hpbGQpIHtcbiAgICAgIGlmIChjaGlsZC5wYXJlbnQpIGNoaWxkLnJlbW92ZSgpO1xuXG4gICAgICBjaGlsZC5wYXJlbnQgPSB0aGlzO1xuICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKGNoaWxkKTtcblxuICAgICAgY2hpbGQuaGFzKCdhZGRlZCcpICYmIGNoaWxkLmZsYXJlKCdhZGRlZCcpO1xuXG4gICAgICByZXR1cm4gY2hpbGQ7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGFkZENoaWxkVG9cbiAgICAgKiDoh6rouqvjgpLlrZDopoHntKDjgajjgZfjgablvJXmlbDjgafmjIflrprjgZfjgZ/opoHntKDjgavov73liqDjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqIOiHqui6q+OBq+WtkOimgee0oOOCkui/veWKoOOBmeOCi+OBq+OBryB7QGxpbmsgI2FkZENoaWxkfSDjgpLkvb/nlKjjgZfjgabjgY/jgaDjgZXjgYTjgIJcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwYXJlbnQg6Ieq6Lqr44KS5a2Q6KaB57Sg44Go44GX44Gm6L+95Yqg44GZ44KL6KaB57SgXG4gICAgICovXG4gICAgYWRkQ2hpbGRUbzogZnVuY3Rpb24ocGFyZW50KSB7XG4gICAgICBwYXJlbnQuYWRkQ2hpbGQodGhpcyk7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBhZGRDaGlsZEF0XG4gICAgICog6Ieq6Lqr44KS44CB5oyH5a6a44GX44Gf6KaB57Sg44Gu5a2Q6KaB57Sg44Gu5Lu75oSP44Gu6YWN5YiX44Kk44Oz44OH44OD44Kv44K544Gr6L+95Yqg44GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gY2hpbGQg6L+95Yqg44GZ44KL5a2Q6KaB57SgXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4IOOCpOODs+ODh+ODg+OCr+OCueeVquWPt1xuICAgICAqL1xuICAgIGFkZENoaWxkQXQ6IGZ1bmN0aW9uKGNoaWxkLCBpbmRleCkge1xuICAgICAgaWYgKGNoaWxkLnBhcmVudCkgY2hpbGQucmVtb3ZlKCk7XG5cbiAgICAgIGNoaWxkLnBhcmVudCA9IHRoaXM7XG4gICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpbmRleCwgMCwgY2hpbGQpO1xuXG4gICAgICBjaGlsZC5oYXMoJ2FkZGVkJykgJiYgY2hpbGQuZmxhcmUoJ2FkZGVkJyk7XG5cbiAgICAgIHJldHVybiBjaGlsZDtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZ2V0Q2hpbGRBdFxuICAgICAqIOaMh+WumuOBl+OBn+OCpOODs+ODh+ODg+OCr+OCueOBruWtkOimgee0oOOCkui/lOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4IOOCpOODs+ODh+ODg+OCr+OCueeVquWPt1xuICAgICAqIEByZXR1cm4ge09iamVjdH0g5oyH5a6a44GX44Gf44Kk44Oz44OH44OD44Kv44K544Gu5a2Q6KaB57SgXG4gICAgICovXG4gICAgZ2V0Q2hpbGRBdDogZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuLmF0KGluZGV4KTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZ2V0Q2hpbGRCeU5hbWVcbiAgICAgKiDmjIflrprjgZfjgZ/lkI3liY3jga7lrZDopoHntKDjgpLov5TjgZfjgb7jgZnjgILvvIjmnKrlrp/oo4XvvIlcbiAgICAgKi9cbiAgICBnZXRDaGlsZEJ5TmFtZTogZnVuY3Rpb24obmFtZSkge1xuICAgICAgLy8gVE9ETzpcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZ2V0Q2hpbGRJbmRleFxuICAgICAqIOaMh+WumuOBl+OBn+WtkOimgee0oOOBruOCpOODs+ODh+ODg+OCr+OCueeVquWPt+OCkui/lOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGNoaWxkIOWtkOimgee0oFxuICAgICAqIEByZXR1cm4ge051bWJlcn0g5oyH5a6a44GX44Gf5a2Q6KaB57Sg44Gu44Kk44Oz44OH44OD44Kv44K555Wq5Y+3XG4gICAgICovXG4gICAgZ2V0Q2hpbGRJbmRleDogZnVuY3Rpb24oY2hpbGQpIHtcbiAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuLmluZGV4T2YoY2hpbGQpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBnZXRQYXJlbnRcbiAgICAgKiDmjIflrprjgZfjgZ/opoHntKDjga7opqropoHntKDjgpLov5TjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqIEByZXR1cm4ge09iamVjdH0g5oyH5a6a44GX44Gf6KaB57Sg44Gu6Kaq6KaB57SgXG4gICAgICovXG4gICAgZ2V0UGFyZW50OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLnBhcmVudDtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZ2V0Um9vdFxuICAgICAqIOaMh+WumuOBl+OBn+imgee0oOOBrumajuWxpOODhOODquODvOOBruODq+ODvOODiOOCkui/lOOBl+OBvuOBmeOAglxuICAgICAqXG4gICAgICogQHJldHVybiB7T2JqZWN0fSDmjIflrprjgZfjgZ/opoHntKDjga7pmo7lsaTjg4Tjg6rjg7zjga7jg6vjg7zjg4hcbiAgICAgKi9cbiAgICBnZXRSb290OiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBlbG0gPSB0aGlzO1xuICAgICAgZm9yIChlbG09dGhpcy5wYXJlbnQ7IGVsbS5wYXJlbnQgIT0gbnVsbDsgZWxtID0gZWxtLnBhcmVudCkge1xuXG4gICAgICB9XG4gICAgICByZXR1cm4gZWxtO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCByZW1vdmVDaGlsZFxuICAgICAqIEBjaGFpbmFibGVcbiAgICAgKiDmjIflrprjgZfjgZ/opoHntKDjgpLoh6rouqvjga7lrZDopoHntKDjgYvjgonliYrpmaTjgZfjgb7jgZnjgIJcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjaGlsZCDopoHntKBcbiAgICAgKi9cbiAgICByZW1vdmVDaGlsZDogZnVuY3Rpb24oY2hpbGQpIHtcbiAgICAgIHZhciBpbmRleCA9IHRoaXMuY2hpbGRyZW4uaW5kZXhPZihjaGlsZCk7XG4gICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4uc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgY2hpbGQuaGFzKCdyZW1vdmVkJykgJiYgY2hpbGQuZmxhcmUoJ3JlbW92ZWQnKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCByZW1vdmVcbiAgICAgKiDoh6rouqvjgpLopqropoHntKDjga7lrZDopoHntKDjgYvjgonliYrpmaTjgZfjgb7jgZnjgIJcbiAgICAgKi9cbiAgICByZW1vdmU6IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKCF0aGlzLnBhcmVudCkgcmV0dXJuIDtcblxuICAgICAgdGhpcy5wYXJlbnQucmVtb3ZlQ2hpbGQodGhpcyk7XG4gICAgICB0aGlzLnBhcmVudCA9IG51bGw7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBpc0F3YWtlXG4gICAgICog6Ieq6Lqr44GM5pyJ5Yq544GL44Gp44GG44GL44KS6L+U44GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtCb29sZWFufSDmnInlirnjgYvjganjgYbjgYtcbiAgICAgKi9cbiAgICBpc0F3YWtlOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLmF3YWtlO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCB3YWtlVXBcbiAgICAgKiDoh6rouqvjgpLmnInlirnjgavjgZfjgb7jgZnjgIJcbiAgICAgKi9cbiAgICB3YWtlVXA6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5hd2FrZSA9IHRydWU7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEBtZXRob2Qgc2xlZXBcbiAgICAgKiDoh6rouqvjgpLnhKHlirnjgavjgZfjgb7jgZnjgIJcbiAgICAgKi9cbiAgICBzbGVlcDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmF3YWtlID0gZmFsc2U7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgZnJvbUpTT05cbiAgICAgKiBKU09OIOW9ouW8j+OCkuS9v+OBo+OBpuiHqui6q+OBq+WtkOimgee0oOOCkui/veWKoOOBmeOCi+OBk+OBqOOBjOOBp+OBjeOBvuOBmeOAglxuICAgICAqXG4gICAgICogIyMjIEV4YW1wbGVcbiAgICAgKiAgICAgIHRoaXMuZnJvbUpTT04oe1xuICAgICAqICAgICAgICBcImNoaWxkcmVuXCI6IHtcbiAgICAgKiAgICAgICAgICBcImxhYmVsXCI6IHsgICAgICAgICAgICAgICAgICAvL+OCreODvOWQjeOBjOi/veWKoOOBmeOCi+WtkOimgee0oOOBruWQjeWJjeOBq+OBquOCi1xuICAgICAqICAgICAgICAgICAgXCJjbGFzc05hbWVcIjogXCJMYWJlbFwiLCAgICAgLy/jgq/jg6njgrlcbiAgICAgKiAgICAgICAgICAgIFwiYXJndW1lbnRzXCI6IFsnaGVsbG8hJ10sICAvL+WIneacn+WMluaZguOBruW8leaVsFxuICAgICAqICAgICAgICAgICAgXCJ4XCI6MzIwLCAgICAgICAgICAgICAgICAgIC8v44Gd44Gu5LuW44OX44Ot44OR44OG44KjXG4gICAgICogICAgICAgICAgICBcInlcIjo0ODAsXG4gICAgICogICAgICAgICAgfSxcbiAgICAgKiAgICAgICAgfSxcbiAgICAgKiAgICAgIH0pO1xuICAgICAqXG4gICAgICogQHBhcmFtIHtKU09OfSBqc29uIEpTT04g5b2i5byPXG4gICAgICovXG4gICAgZnJvbUpTT046IGZ1bmN0aW9uKGpzb24pIHtcblxuICAgICAgdmFyIGNyZWF0ZUNoaWxkcmVuID0gZnVuY3Rpb24obmFtZSwgZGF0YSkge1xuICAgICAgICAvL1xuICAgICAgICB2YXIgYXJncyA9IGRhdGEuYXJndW1lbnRzO1xuICAgICAgICBhcmdzID0gKGFyZ3MgaW5zdGFuY2VvZiBBcnJheSkgPyBhcmdzIDogW2FyZ3NdO1xuICAgICAgICAvL1xuICAgICAgICB2YXIgX2NsYXNzID0gcGhpbmEudXNpbmcoZGF0YS5jbGFzc05hbWUpO1xuICAgICAgICAvL1xuICAgICAgICB2YXIgZWxlbWVudCA9IF9jbGFzcy5hcHBseShudWxsLCBhcmdzKTtcblxuICAgICAgICBlbGVtZW50Lm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzW25hbWVdID0gZWxlbWVudDtcblxuICAgICAgICBlbGVtZW50LmZyb21KU09OKGRhdGEpO1xuICAgICAgICBlbGVtZW50LmFkZENoaWxkVG8odGhpcyk7XG4gICAgICB9LmJpbmQodGhpcyk7XG5cbiAgICAgIHZhciBjcmVhdGVBY2Nlc3NvcmllcyA9IGZ1bmN0aW9uKG5hbWUsIGRhdGEpIHtcbiAgICAgICAgLy9cbiAgICAgICAgdmFyIGFyZ3MgPSBkYXRhLmFyZ3VtZW50cztcbiAgICAgICAgYXJncyA9IChhcmdzIGluc3RhbmNlb2YgQXJyYXkpID8gYXJncyA6IFthcmdzXTtcbiAgICAgICAgLy9cbiAgICAgICAgdmFyIF9jbGFzcyA9IHBoaW5hLnVzaW5nKGRhdGEuY2xhc3NOYW1lKTtcbiAgICAgICAgLy9cbiAgICAgICAgdmFyIGFjY2Vzc29yeSA9IF9jbGFzcy5hcHBseShudWxsLCBhcmdzKTtcblxuICAgICAgICBhY2Nlc3NvcnkubmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXNbbmFtZV0gPSBhY2Nlc3Nvcnk7XG5cbiAgICAgICAgYWNjZXNzb3J5LmF0dGFjaFRvKHRoaXMpO1xuICAgICAgfS5iaW5kKHRoaXMpO1xuXG4gICAgICBqc29uLmZvckluKGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbiAgICAgICAgaWYgKGtleSA9PT0gJ2NoaWxkcmVuJykge1xuICAgICAgICAgIHZhbHVlLmZvckluKGZ1bmN0aW9uKG5hbWUsIGRhdGEpIHtcbiAgICAgICAgICAgIGNyZWF0ZUNoaWxkcmVuKG5hbWUsIGRhdGEpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGtleSA9PT0gJ2FjY2Vzc29yaWVzJykge1xuICAgICAgICAgIHZhbHVlLmZvckluKGZ1bmN0aW9uKG5hbWUsIGRhdGEpIHtcbiAgICAgICAgICAgIGNyZWF0ZUFjY2Vzc29yaWVzKG5hbWUsIGRhdGEpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIGlmIChrZXkgIT09ICd0eXBlJyAmJiBrZXkgIT09ICdjbGFzc05hbWUnKSB7XG4gICAgICAgICAgICB0aGlzW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sIHRoaXMpO1xuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgdG9KU09OXG4gICAgICog6Ieq6Lqr44Gu5a2Q6KaB57Sg44KSIEpTT04g5b2i5byP44Gn6L+U44GX44G+44GZ44CCXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtKU09OfSBKU09O5b2i5byPXG4gICAgICovXG4gICAgdG9KU09OOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMocGhpbmEudXNpbmcodGhpcy5jbGFzc05hbWUpLmRlZmF1bHRzIHx8IHt9KTtcblxuICAgICAgdGhpcy5faGllcmFyY2hpZXMuZm9yRWFjaChmdW5jdGlvbihlKSB7XG4gICAgICAgIHZhciBkID0gZS5kZWZhdWx0cztcbiAgICAgICAgaWYgKGQpIHtcbiAgICAgICAgICBPYmplY3Qua2V5cyhkKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcbiAgICAgICAgICAgIGlmIChrZXlzLmluZGV4T2YoaykgPT09IC0xKSB7XG4gICAgICAgICAgICAgIGtleXMucHVzaChrKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGtleXMucHVzaCgnbmFtZScsICdjbGFzc05hbWUnKTtcblxuICAgICAgdmFyIGpzb24gPSB7fTtcbiAgICAgIGtleXMuZWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICAgICAganNvbltrZXldID0gdGhpc1trZXldO1xuICAgICAgfSwgdGhpcyk7XG5cbiAgICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW4ubWFwKGZ1bmN0aW9uKGNoaWxkKSB7XG4gICAgICAgIHJldHVybiBjaGlsZC50b0pTT04oKTtcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICAgIGpzb24uY2hpbGRyZW4gPSB7fTtcbiAgICAgICAgY2hpbGRyZW4uZWFjaChmdW5jdGlvbihjaGlsZCwgaSkge1xuICAgICAgICAgIGpzb24uY2hpbGRyZW5bY2hpbGQubmFtZSB8fCAoY2hpbGQuY2xhc3NOYW1lICsgJ18nICsgaSldID0gY2hpbGQ7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ganNvbjtcbiAgICB9LFxuICB9KTtcblxufSk7XG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmFwcC5PYmplY3QyRFxuICAgKiBPYmplY3QyRFxuICAgKiBAZXh0ZW5kcyBwaGluYS5hcHAuRWxlbWVudFxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5hcHAuT2JqZWN0MkQnLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmFwcC5FbGVtZW50JyxcblxuICAgIC8qKiDkvY3nva4gKi9cbiAgICBwb3NpdGlvbjogbnVsbCxcbiAgICAvKiog5Zue6LuiICovXG4gICAgcm90YXRpb246IDAsXG4gICAgLyoqIOOCueOCseODvOODqyAqL1xuICAgIHNjYWxlOiBudWxsLFxuICAgIC8qKiDln7rmupbkvY3nva4gKi9cbiAgICBvcmlnaW46IG51bGwsXG5cbiAgICAvKipcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICB0aGlzLnN1cGVySW5pdCgpO1xuXG4gICAgICBvcHRpb25zID0gKHt9KS4kc2FmZShvcHRpb25zLCBwaGluYS5hcHAuT2JqZWN0MkQuZGVmYXVsdHMpO1xuXG4gICAgICB0aGlzLnBvc2l0aW9uID0gcGhpbmEuZ2VvbS5WZWN0b3IyKG9wdGlvbnMueCwgb3B0aW9ucy55KTtcbiAgICAgIHRoaXMuc2NhbGUgICAgPSBwaGluYS5nZW9tLlZlY3RvcjIob3B0aW9ucy5zY2FsZVgsIG9wdGlvbnMuc2NhbGVZKTtcbiAgICAgIHRoaXMucm90YXRpb24gPSBvcHRpb25zLnJvdGF0aW9uO1xuICAgICAgdGhpcy5vcmlnaW4gICA9IHBoaW5hLmdlb20uVmVjdG9yMihvcHRpb25zLm9yaWdpblgsIG9wdGlvbnMub3JpZ2luWSk7XG5cbiAgICAgIHRoaXMuX21hdHJpeCA9IHBoaW5hLmdlb20uTWF0cml4MzMoKS5pZGVudGl0eSgpO1xuICAgICAgdGhpcy5fd29ybGRNYXRyaXggPSBwaGluYS5nZW9tLk1hdHJpeDMzKCkuaWRlbnRpdHkoKTtcblxuICAgICAgdGhpcy5pbnRlcmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgdGhpcy5fb3ZlckZsYWdzID0ge307XG4gICAgICB0aGlzLl90b3VjaEZsYWdzID0ge307XG5cbiAgICAgIHRoaXMud2lkdGggPSBvcHRpb25zLndpZHRoO1xuICAgICAgdGhpcy5oZWlnaHQgPSBvcHRpb25zLmhlaWdodDtcbiAgICAgIHRoaXMucmFkaXVzID0gb3B0aW9ucy5yYWRpdXM7XG4gICAgICB0aGlzLmJvdW5kaW5nVHlwZSA9IG9wdGlvbnMuYm91bmRpbmdUeXBlO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDngrnjgajooZ3nqoHjgZfjgabjgYTjgovjgYvjgpLliKTlrppcbiAgICAgKiBAcGFyYW0ge051bWJlcn0geFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB5XG4gICAgICovXG4gICAgaGl0VGVzdDogZnVuY3Rpb24oeCwgeSkge1xuICAgICAgaWYgKHRoaXMuYm91bmRpbmdUeXBlID09PSAncmVjdCcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGl0VGVzdFJlY3QoeCwgeSk7XG4gICAgICB9XG4gICAgICBlbHNlIGlmICh0aGlzLmJvdW5kaW5nVHlwZSA9PT0gJ2NpcmNsZScpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGl0VGVzdENpcmNsZSh4LCB5KTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAvLyBub25lIOOBruWgtOWQiFxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgaGl0VGVzdFJlY3Q6IGZ1bmN0aW9uKHgsIHkpIHtcbiAgICAgIHZhciBwID0gdGhpcy5nbG9iYWxUb0xvY2FsKHBoaW5hLmdlb20uVmVjdG9yMih4LCB5KSk7XG5cbiAgICAgIHZhciBsZWZ0ICAgPSAtdGhpcy53aWR0aCp0aGlzLm9yaWdpblg7XG4gICAgICB2YXIgcmlnaHQgID0gK3RoaXMud2lkdGgqKDEtdGhpcy5vcmlnaW5YKTtcbiAgICAgIHZhciB0b3AgICAgPSAtdGhpcy5oZWlnaHQqdGhpcy5vcmlnaW5ZO1xuICAgICAgdmFyIGJvdHRvbSA9ICt0aGlzLmhlaWdodCooMS10aGlzLm9yaWdpblkpO1xuXG4gICAgICByZXR1cm4gKCBsZWZ0IDwgcC54ICYmIHAueCA8IHJpZ2h0ICkgJiYgKCB0b3AgIDwgcC55ICYmIHAueSA8IGJvdHRvbSApO1xuICAgIH0sXG5cbiAgICBoaXRUZXN0Q2lyY2xlOiBmdW5jdGlvbih4LCB5KSB7XG4gICAgICAvLyDlhobliKTlrppcbiAgICAgIHZhciBwID0gdGhpcy5nbG9iYWxUb0xvY2FsKHBoaW5hLmdlb20uVmVjdG9yMih4LCB5KSk7XG4gICAgICBpZiAoKChwLngpKihwLngpKyhwLnkpKihwLnkpKSA8ICh0aGlzLnJhZGl1cyp0aGlzLnJhZGl1cykpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog6KaB57Sg44Go6KGd56qB44GX44Gm44GE44KL44GL44KS5Yik5a6aXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGVsbVxuICAgICAqL1xuICAgIGhpdFRlc3RFbGVtZW50OiBmdW5jdGlvbihlbG0pIHtcbiAgICAgIHZhciByZWN0MCA9IHRoaXM7XG4gICAgICB2YXIgcmVjdDEgPSBlbG07XG4gICAgICByZXR1cm4gKHJlY3QwLmxlZnQgPCByZWN0MS5yaWdodCkgJiYgKHJlY3QwLnJpZ2h0ID4gcmVjdDEubGVmdCkgJiZcbiAgICAgICAgICAgICAocmVjdDAudG9wIDwgcmVjdDEuYm90dG9tKSAmJiAocmVjdDAuYm90dG9tID4gcmVjdDEudG9wKTtcbiAgICB9LFxuXG5cbiAgICBnbG9iYWxUb0xvY2FsOiBmdW5jdGlvbihwKSB7XG4gICAgICB2YXIgbWF0cml4ID0gdGhpcy5fd29ybGRNYXRyaXguY2xvbmUoKTtcbiAgICAgIG1hdHJpeC5pbnZlcnQoKTtcbiAgICAgIC8vIG1hdHJpeC50cmFuc3Bvc2UoKTtcblxuICAgICAgdmFyIHRlbXAgPSBtYXRyaXgubXVsdGlwbHlWZWN0b3IyKHApO1xuXG4gICAgICByZXR1cm4gdGVtcDtcbiAgICB9LFxuXG4gICAgc2V0SW50ZXJhY3RpdmU6IGZ1bmN0aW9uKGZsYWcsIHR5cGUpIHtcbiAgICAgIHRoaXMuaW50ZXJhY3RpdmUgPSBmbGFnO1xuICAgICAgaWYgKHR5cGUpIHtcbiAgICAgICAgdGhpcy5ib3VuZGluZ1R5cGUgPSB0eXBlO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogWCDluqfmqJnlgKTjgpLjgrvjg4Pjg4hcbiAgICAgKiBAcGFyYW0ge051bWJlcn0geFxuICAgICAqL1xuICAgIHNldFg6IGZ1bmN0aW9uKHgpIHtcbiAgICAgIHRoaXMucG9zaXRpb24ueCA9IHg7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIFkg5bqn5qiZ5YCk44KS44K744OD44OIXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHlcbiAgICAgKi9cbiAgICBzZXRZOiBmdW5jdGlvbih5KSB7XG4gICAgICB0aGlzLnBvc2l0aW9uLnkgPSB5O1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBYWSDluqfmqJnjgpLjgrvjg4Pjg4hcbiAgICAgKiBAcGFyYW0ge051bWJlcn0geFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB5XG4gICAgICovXG4gICAgc2V0UG9zaXRpb246IGZ1bmN0aW9uKHgsIHkpIHtcbiAgICAgIHRoaXMucG9zaXRpb24ueCA9IHg7XG4gICAgICB0aGlzLnBvc2l0aW9uLnkgPSB5O1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOWbnui7ouOCkuOCu+ODg+ODiFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSByb3RhdGlvblxuICAgICAqL1xuICAgIHNldFJvdGF0aW9uOiBmdW5jdGlvbihyb3RhdGlvbikge1xuICAgICAgdGhpcy5yb3RhdGlvbiA9IHJvdGF0aW9uO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOOCueOCseODvOODq+OCkuOCu+ODg+ODiFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB4XG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHlcbiAgICAgKi9cbiAgICBzZXRTY2FsZTogZnVuY3Rpb24oeCwgeSkge1xuICAgICAgdGhpcy5zY2FsZS54ID0geDtcbiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDw9IDEpIHtcbiAgICAgICAgICB0aGlzLnNjYWxlLnkgPSB4O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnNjYWxlLnkgPSB5O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiDln7rmupbngrnjgpLjgrvjg4Pjg4hcbiAgICAgKiBAcGFyYW0ge051bWJlcn0geFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB5XG4gICAgICovXG4gICAgc2V0T3JpZ2luOiBmdW5jdGlvbih4LCB5KSB7XG4gICAgICB0aGlzLm9yaWdpbi54ID0geDtcbiAgICAgIHRoaXMub3JpZ2luLnkgPSB5O1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiDluYXjgpLjgrvjg4Pjg4hcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gd2lkdGhcbiAgICAgKi9cbiAgICBzZXRXaWR0aDogZnVuY3Rpb24od2lkdGgpIHtcbiAgICAgIHRoaXMud2lkdGggPSB3aWR0aDtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICog6auY44GV44KS44K744OD44OIXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGhlaWdodFxuICAgICAqL1xuICAgIHNldEhlaWdodDogZnVuY3Rpb24oaGVpZ2h0KSB7XG4gICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICog44K144Kk44K6KOW5hSwg6auY44GVKeOCkuOCu+ODg+ODiFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB3aWR0aFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBoZWlnaHRcbiAgICAgKi9cbiAgICBzZXRTaXplOiBmdW5jdGlvbih3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICB0aGlzLndpZHRoICA9IHdpZHRoO1xuICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgc2V0Qm91bmRpbmdUeXBlOiBmdW5jdGlvbih0eXBlKSB7XG4gICAgICB0aGlzLmJvdW5kaW5nVHlwZSA9IHR5cGU7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgbW92ZVRvOiBmdW5jdGlvbih4LCB5KSB7XG4gICAgICB0aGlzLnBvc2l0aW9uLnggPSB4O1xuICAgICAgdGhpcy5wb3NpdGlvbi55ID0geTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBtb3ZlQnk6IGZ1bmN0aW9uKHgsIHkpIHtcbiAgICAgIHRoaXMucG9zaXRpb24ueCArPSB4O1xuICAgICAgdGhpcy5wb3NpdGlvbi55ICs9IHk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgX2NhbGNXb3JsZE1hdHJpeDogZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoIXRoaXMucGFyZW50KSByZXR1cm4gO1xuXG4gICAgICAvLyBjYWNoZSBjaGVja1xuICAgICAgaWYgKHRoaXMucm90YXRpb24gIT0gdGhpcy5fY2FjaGVkUm90YXRpb24pIHtcbiAgICAgICAgdGhpcy5fY2FjaGVkUm90YXRpb24gPSB0aGlzLnJvdGF0aW9uO1xuXG4gICAgICAgIHZhciByID0gdGhpcy5yb3RhdGlvbiooTWF0aC5QSS8xODApO1xuICAgICAgICB0aGlzLl9zciA9IE1hdGguc2luKHIpO1xuICAgICAgICB0aGlzLl9jciA9IE1hdGguY29zKHIpO1xuICAgICAgfVxuXG4gICAgICB2YXIgbG9jYWwgPSB0aGlzLl9tYXRyaXg7XG4gICAgICB2YXIgcGFyZW50ID0gdGhpcy5wYXJlbnQuX3dvcmxkTWF0cml4IHx8IHBoaW5hLmdlb20uTWF0cml4MzMuSURFTlRJVFk7XG4gICAgICB2YXIgd29ybGQgPSB0aGlzLl93b3JsZE1hdHJpeDtcblxuICAgICAgLy8g44Ot44O844Kr44Or44Gu6KGM5YiX44KS6KiI566XXG4gICAgICBsb2NhbC5tMDAgPSB0aGlzLl9jciAqIHRoaXMuc2NhbGUueDtcbiAgICAgIGxvY2FsLm0wMSA9LXRoaXMuX3NyICogdGhpcy5zY2FsZS55O1xuICAgICAgbG9jYWwubTEwID0gdGhpcy5fc3IgKiB0aGlzLnNjYWxlLng7XG4gICAgICBsb2NhbC5tMTEgPSB0aGlzLl9jciAqIHRoaXMuc2NhbGUueTtcbiAgICAgIGxvY2FsLm0wMiA9IHRoaXMucG9zaXRpb24ueDtcbiAgICAgIGxvY2FsLm0xMiA9IHRoaXMucG9zaXRpb24ueTtcblxuICAgICAgLy8gY2FjaGVcbiAgICAgIHZhciBhMDAgPSBsb2NhbC5tMDA7IHZhciBhMDEgPSBsb2NhbC5tMDE7IHZhciBhMDIgPSBsb2NhbC5tMDI7XG4gICAgICB2YXIgYTEwID0gbG9jYWwubTEwOyB2YXIgYTExID0gbG9jYWwubTExOyB2YXIgYTEyID0gbG9jYWwubTEyO1xuICAgICAgdmFyIGIwMCA9IHBhcmVudC5tMDA7IHZhciBiMDEgPSBwYXJlbnQubTAxOyB2YXIgYjAyID0gcGFyZW50Lm0wMjtcbiAgICAgIHZhciBiMTAgPSBwYXJlbnQubTEwOyB2YXIgYjExID0gcGFyZW50Lm0xMTsgdmFyIGIxMiA9IHBhcmVudC5tMTI7XG5cbiAgICAgIC8vIOimquOBruihjOWIl+OBqOaOm+OBkeWQiOOCj+OBm+OCi1xuICAgICAgd29ybGQubTAwID0gYjAwICogYTAwICsgYjAxICogYTEwO1xuICAgICAgd29ybGQubTAxID0gYjAwICogYTAxICsgYjAxICogYTExO1xuICAgICAgd29ybGQubTAyID0gYjAwICogYTAyICsgYjAxICogYTEyICsgYjAyO1xuXG4gICAgICB3b3JsZC5tMTAgPSBiMTAgKiBhMDAgKyBiMTEgKiBhMTA7XG4gICAgICB3b3JsZC5tMTEgPSBiMTAgKiBhMDEgKyBiMTEgKiBhMTE7XG4gICAgICB3b3JsZC5tMTIgPSBiMTAgKiBhMDIgKyBiMTEgKiBhMTIgKyBiMTI7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBfYWNjZXNzb3I6IHtcbiAgICAgIC8qKlxuICAgICAgICogQHByb3BlcnR5ICAgIHhcbiAgICAgICAqIHjluqfmqJnlgKRcbiAgICAgICAqL1xuICAgICAgeDoge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpcy5wb3NpdGlvbi54OyB9LFxuICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2KSAgeyB0aGlzLnBvc2l0aW9uLnggPSB2OyB9XG4gICAgICB9LFxuICAgICAgLyoqXG4gICAgICAgKiBAcHJvcGVydHkgICAgeVxuICAgICAgICogeeW6p+aomeWApFxuICAgICAgICovXG4gICAgICB5OiB7XG4gICAgICAgIFwiZ2V0XCI6IGZ1bmN0aW9uKCkgICB7IHJldHVybiB0aGlzLnBvc2l0aW9uLnk7IH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKHYpICB7IHRoaXMucG9zaXRpb24ueSA9IHY7IH1cbiAgICAgIH0sXG5cbiAgICAgIC8qKlxuICAgICAgICogQHByb3BlcnR5ICAgIG9yaWdpblhcbiAgICAgICAqIHjluqfmqJnlgKRcbiAgICAgICAqL1xuICAgICAgb3JpZ2luWDoge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpcy5vcmlnaW4ueDsgfSxcbiAgICAgICAgXCJzZXRcIjogZnVuY3Rpb24odikgIHsgdGhpcy5vcmlnaW4ueCA9IHY7IH1cbiAgICAgIH0sXG4gICAgICBcbiAgICAgIC8qKlxuICAgICAgICogQHByb3BlcnR5ICAgIG9yaWdpbllcbiAgICAgICAqIHnluqfmqJnlgKRcbiAgICAgICAqL1xuICAgICAgb3JpZ2luWToge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpcy5vcmlnaW4ueTsgfSxcbiAgICAgICAgXCJzZXRcIjogZnVuY3Rpb24odikgIHsgdGhpcy5vcmlnaW4ueSA9IHY7IH1cbiAgICAgIH0sXG4gICAgICBcbiAgICAgIC8qKlxuICAgICAgICogQHByb3BlcnR5ICAgIHNjYWxlWFxuICAgICAgICog44K544Kx44O844OrWOWApFxuICAgICAgICovXG4gICAgICBzY2FsZVg6IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSAgIHsgcmV0dXJuIHRoaXMuc2NhbGUueDsgfSxcbiAgICAgICAgXCJzZXRcIjogZnVuY3Rpb24odikgIHsgdGhpcy5zY2FsZS54ID0gdjsgfVxuICAgICAgfSxcbiAgICAgIFxuICAgICAgLyoqXG4gICAgICAgKiBAcHJvcGVydHkgICAgc2NhbGVZXG4gICAgICAgKiDjgrnjgrHjg7zjg6tZ5YCkXG4gICAgICAgKi9cbiAgICAgIHNjYWxlWToge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpcy5zY2FsZS55OyB9LFxuICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2KSAgeyB0aGlzLnNjYWxlLnkgPSB2OyB9XG4gICAgICB9LFxuICAgICAgXG4gICAgICAvKipcbiAgICAgICAqIEBwcm9wZXJ0eSAgICB3aWR0aFxuICAgICAgICogd2lkdGhcbiAgICAgICAqL1xuICAgICAgd2lkdGg6IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSAgIHtcbiAgICAgICAgICByZXR1cm4gKHRoaXMuYm91bmRpbmdUeXBlID09PSAncmVjdCcpID9cbiAgICAgICAgICAgIHRoaXMuX3dpZHRoIDogdGhpcy5fZGlhbWV0ZXI7XG4gICAgICAgIH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKHYpICB7IHRoaXMuX3dpZHRoID0gdjsgfVxuICAgICAgfSxcbiAgICAgIC8qKlxuICAgICAgICogQHByb3BlcnR5ICAgIGhlaWdodFxuICAgICAgICogaGVpZ2h0XG4gICAgICAgKi9cbiAgICAgIGhlaWdodDoge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAge1xuICAgICAgICAgIHJldHVybiAodGhpcy5ib3VuZGluZ1R5cGUgPT09ICdyZWN0JykgP1xuICAgICAgICAgICAgdGhpcy5faGVpZ2h0IDogdGhpcy5fZGlhbWV0ZXI7XG4gICAgICAgIH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKHYpICB7IHRoaXMuX2hlaWdodCA9IHY7IH1cbiAgICAgIH0sXG5cbiAgICAgIC8qKlxuICAgICAgICogQHByb3BlcnR5ICAgIHJhZGl1c1xuICAgICAgICog5Y2K5b6EXG4gICAgICAgKi9cbiAgICAgIHJhZGl1czoge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAge1xuICAgICAgICAgIHJldHVybiAodGhpcy5ib3VuZGluZ1R5cGUgPT09ICdyZWN0JykgP1xuICAgICAgICAgICAgKHRoaXMud2lkdGgrdGhpcy5oZWlnaHQpLzQgOiB0aGlzLl9yYWRpdXM7XG4gICAgICAgIH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKHYpICB7XG4gICAgICAgICAgdGhpcy5fcmFkaXVzID0gdjtcbiAgICAgICAgICB0aGlzLl9kaWFtZXRlciA9IHYqMjtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBcbiAgICAgIC8qKlxuICAgICAgICogQHByb3BlcnR5ICAgIHRvcFxuICAgICAgICog5bemXG4gICAgICAgKi9cbiAgICAgIHRvcDoge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpcy55IC0gdGhpcy5oZWlnaHQqdGhpcy5vcmlnaW5ZOyB9LFxuICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2KSAgeyB0aGlzLnkgPSB2ICsgdGhpcy5oZWlnaHQqdGhpcy5vcmlnaW5ZOyB9LFxuICAgICAgfSxcbiAgIFxuICAgICAgLyoqXG4gICAgICAgKiBAcHJvcGVydHkgICAgcmlnaHRcbiAgICAgICAqIOW3plxuICAgICAgICovXG4gICAgICByaWdodDoge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpcy54ICsgdGhpcy53aWR0aCooMS10aGlzLm9yaWdpblgpOyB9LFxuICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2KSAgeyB0aGlzLnggPSB2IC0gdGhpcy53aWR0aCooMS10aGlzLm9yaWdpblgpOyB9LFxuICAgICAgfSxcbiAgIFxuICAgICAgLyoqXG4gICAgICAgKiBAcHJvcGVydHkgICAgYm90dG9tXG4gICAgICAgKiDlt6ZcbiAgICAgICAqL1xuICAgICAgYm90dG9tOiB7XG4gICAgICAgIFwiZ2V0XCI6IGZ1bmN0aW9uKCkgICB7IHJldHVybiB0aGlzLnkgKyB0aGlzLmhlaWdodCooMS10aGlzLm9yaWdpblkpOyB9LFxuICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2KSAgeyB0aGlzLnkgPSB2IC0gdGhpcy5oZWlnaHQqKDEtdGhpcy5vcmlnaW5ZKTsgfSxcbiAgICAgIH0sXG4gICBcbiAgICAgIC8qKlxuICAgICAgICogQHByb3BlcnR5ICAgIGxlZnRcbiAgICAgICAqIOW3plxuICAgICAgICovXG4gICAgICBsZWZ0OiB7XG4gICAgICAgIFwiZ2V0XCI6IGZ1bmN0aW9uKCkgICB7IHJldHVybiB0aGlzLnggLSB0aGlzLndpZHRoKnRoaXMub3JpZ2luWDsgfSxcbiAgICAgICAgXCJzZXRcIjogZnVuY3Rpb24odikgIHsgdGhpcy54ID0gdiArIHRoaXMud2lkdGgqdGhpcy5vcmlnaW5YOyB9LFxuICAgICAgfSxcblxuICAgICAgLyoqXG4gICAgICAgKiBAcHJvcGVydHkgICAgY2VudGVyWFxuICAgICAgICogY2VudGVyWFxuICAgICAgICovXG4gICAgICBjZW50ZXJYOiB7XG4gICAgICAgIFwiZ2V0XCI6IGZ1bmN0aW9uKCkgICB7IHJldHVybiB0aGlzLnggKyB0aGlzLndpZHRoLzIgLSB0aGlzLndpZHRoKnRoaXMub3JpZ2luWDsgfSxcbiAgICAgICAgXCJzZXRcIjogZnVuY3Rpb24odikgIHtcbiAgICAgICAgICAvLyBUT0RPOiDjganjgYbjgZfjgojjgYbjgYvjgao/P1xuICAgICAgICB9XG4gICAgICB9LFxuICAgXG4gICAgICAvKipcbiAgICAgICAqIEBwcm9wZXJ0eSAgICBjZW50ZXJZXG4gICAgICAgKiBjZW50ZXJZXG4gICAgICAgKi9cbiAgICAgIGNlbnRlclk6IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSAgIHsgcmV0dXJuIHRoaXMueSArIHRoaXMuaGVpZ2h0LzIgLSB0aGlzLmhlaWdodCp0aGlzLm9yaWdpblk7IH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKHYpICB7XG4gICAgICAgICAgLy8gVE9ETzog44Gp44GG44GX44KI44GG44GL44GqPz9cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9LFxuICAgIF9zdGF0aWM6IHtcbiAgICAgIGRlZmF1bHRzOiB7XG4gICAgICAgIHg6IDAsXG4gICAgICAgIHk6IDAsXG4gICAgICAgIHNjYWxlWDogMSxcbiAgICAgICAgc2NhbGVZOiAxLFxuICAgICAgICByb3RhdGlvbjogMCxcbiAgICAgICAgb3JpZ2luWDogMC41LFxuICAgICAgICBvcmlnaW5ZOiAwLjUsXG4gICAgICAgIFxuICAgICAgICB3aWR0aDogNjQsXG4gICAgICAgIGhlaWdodDogNjQsXG4gICAgICAgIHJhZGl1czogMzIsXG4gICAgICAgIGJvdW5kaW5nVHlwZTogJ3JlY3QnLFxuICAgICAgfSxcbiAgICB9LFxuXG4gIH0pO1xuXG4gIFxufSk7XG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmFwcC5TY2VuZVxuICAgKiBAZXh0ZW5kcyBwaGluYS5hcHAuRWxlbWVudFxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5hcHAuU2NlbmUnLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmFwcC5FbGVtZW50JyxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5zdXBlckluaXQoKTtcbiAgICB9LFxuXG4gICAgZXhpdDogZnVuY3Rpb24obmV4dExhYmVsLCBuZXh0QXJndW1lbnRzKSB7XG4gICAgICBpZiAoIXRoaXMuYXBwKSByZXR1cm4gO1xuXG4gICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgaWYgKHR5cGVvZiBhcmd1bWVudHNbMF0gPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgbmV4dExhYmVsID0gYXJndW1lbnRzWzBdLm5leHRMYWJlbCB8fCB0aGlzLm5leHRMYWJlbDtcbiAgICAgICAgICBuZXh0QXJndW1lbnRzID0gYXJndW1lbnRzWzBdO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5uZXh0TGFiZWwgPSBuZXh0TGFiZWw7XG4gICAgICAgIHRoaXMubmV4dEFyZ3VtZW50cyA9IG5leHRBcmd1bWVudHM7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuYXBwLnBvcFNjZW5lKCk7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gIH0pO1xuICBcbn0pO1xuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmFjY2Vzc29yeS5BY2Nlc3NvcnlcbiAgICogQGV4dGVuZHMgcGhpbmEudXRpbC5FdmVudERpc3BhdGNoZXJcbiAgICovXG4gIHBoaW5hLmRlZmluZSgncGhpbmEuYWNjZXNzb3J5LkFjY2Vzc29yeScsIHtcbiAgICBzdXBlckNsYXNzOiAncGhpbmEudXRpbC5FdmVudERpc3BhdGNoZXInLFxuXG4gICAgLyoqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgaW5pdDogZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICB0aGlzLnN1cGVySW5pdCgpO1xuXG4gICAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcbiAgICB9LFxuICAgIHNldFRhcmdldDogZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICBpZiAodGhpcy50YXJnZXQgPT09IHRhcmdldCkgcmV0dXJuIDtcblxuICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIGdldFRhcmdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy50YXJnZXQ7XG4gICAgfSxcbiAgICBpc0F0dGFjaGVkOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiAhIXRoaXMudGFyZ2V0O1xuICAgIH0sXG4gICAgYXR0YWNoVG86IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgIGVsZW1lbnQuYXR0YWNoKHRoaXMpO1xuICAgICAgdGhpcy5zZXRUYXJnZXQoZWxlbWVudCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIHJlbW92ZTogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnRhcmdldC5kZXRhY2godGhpcyk7XG4gICAgICB0aGlzLnRhcmdldCA9IG51bGw7XG4gICAgfSxcbiAgfSk7XG5cbiAgcGhpbmEuYXBwLkVsZW1lbnQucHJvdG90eXBlLiRtZXRob2QoJ2F0dGFjaCcsIGZ1bmN0aW9uKGFjY2Vzc29yeSkge1xuICAgIGlmICghdGhpcy5hY2Nlc3Nvcmllcykge1xuICAgICAgdGhpcy5hY2Nlc3NvcmllcyA9IFtdO1xuICAgICAgdGhpcy5vbignZW50ZXJmcmFtZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgdGhpcy5hY2Nlc3Nvcmllcy5lYWNoKGZ1bmN0aW9uKGFjY2Vzc29yeSkge1xuICAgICAgICAgIGFjY2Vzc29yeS51cGRhdGUgJiYgYWNjZXNzb3J5LnVwZGF0ZShlLmFwcCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdGhpcy5hY2Nlc3Nvcmllcy5wdXNoKGFjY2Vzc29yeSk7XG4gICAgYWNjZXNzb3J5LnNldFRhcmdldCh0aGlzKTtcbiAgICBhY2Nlc3NvcnkuZmxhcmUoJ2F0dGFjaGVkJyk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSk7XG5cbiAgcGhpbmEuYXBwLkVsZW1lbnQucHJvdG90eXBlLiRtZXRob2QoJ2RldGFjaCcsIGZ1bmN0aW9uKGFjY2Vzc29yeSkge1xuICAgIGlmICh0aGlzLmFjY2Vzc29yaWVzKSB7XG4gICAgICB0aGlzLmFjY2Vzc29yaWVzLmVyYXNlKGFjY2Vzc29yeSk7XG4gICAgICBhY2Nlc3Nvcnkuc2V0VGFyZ2V0KG51bGwpO1xuICAgICAgYWNjZXNzb3J5LmZsYXJlKCdkZXRhY2hlZCcpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9KTtcblxufSk7XG5cblxuXG5cblxuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5hY2Nlc3NvcnkuVHdlZW5lclxuICAgKiAjIFR3ZWVuZXJcbiAgICogVHdlZW5lcuOBr+OCquODluOCuOOCp+OCr+ODiOOBruODl+ODreODkeODhuOCo+OBq+WvvuOBl+OBpuOAgVxuICAgKiBUd2VlbuOCouODi+ODoeODvOOCt+ODp+ODs+OBruWKueaenOOCkuS4juOBiOOCi+OCr+ODqeOCueOBp+OBmeOAgiAgXG4gICAqIOS4u+OBqyB7QGxpbmsgcGhpbmEuYXBwLkVsZW1lbnR9IOOBqOOBneOBruOCteODluOCr+ODqeOCueOBp+S9v+eUqOOBleOCjOOBvuOBmeOAglxuICAgKiBAZXh0ZW5kcyBwaGluYS5hY2Nlc3NvcnkuQWNjZXNzb3J5XG4gICAqL1xuICB2YXIgVHdlZW5lciA9IHBoaW5hLmRlZmluZSgncGhpbmEuYWNjZXNzb3J5LlR3ZWVuZXInLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmFjY2Vzc29yeS5BY2Nlc3NvcnknLFxuICAgIFxuICAgIC8qKlxuICAgICAqIOOCouODi+ODoeODvOOCt+ODp+ODs+OCkuabtOaWsOOBmeOCi+aWueazleOCkuaMh+WumuOBl+OBvuOBmeOAgiAgXG4gICAgICog5aSJ5pu044GZ44KL44GoZHVyYXRpb27jgavjgojjgovmmYLplpPjga7pgLLjgb/mlrnjgYzlpInjgo/jgorjgb7jgZnjgIIgIFxuICAgICAqIOips+OBl+OBj+OBr3tAbGluayAjVVBEQVRFX01BUH3jgpLlj4LnhafjgZfjgabjgY/jgaDjgZXjgYTjgIJcbiAgICAgKi9cbiAgICB1cGRhdGVUeXBlOiAnZGVsdGEnLFxuXG4gICAgdGltZVNjYWxlOiAxLjAsXG5cbiAgICAvKipcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBpbml0OiBmdW5jdGlvbih0YXJnZXQpIHtcbiAgICAgIHRoaXMuc3VwZXJJbml0KHRhcmdldCk7XG5cbiAgICAgIHRoaXMuX2luaXQoKTtcbiAgICB9LFxuXG4gICAgX2luaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5fbG9vcCA9IGZhbHNlO1xuICAgICAgdGhpcy5fdGFza3MgPSBbXTtcbiAgICAgIHRoaXMuX2luZGV4ID0gMDtcbiAgICAgIHRoaXMucGxheWluZyA9IHRydWU7XG4gICAgICB0aGlzLl91cGRhdGUgPSB0aGlzLl91cGRhdGVUYXNrO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge3BoaW5hLmFwcC5CYXNlQXBwfSBhcHBcbiAgICAgKi9cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKGFwcCkge1xuICAgICAgdGhpcy5fdXBkYXRlKGFwcCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIHtAbGluayAjdXBkYXRlVHlwZX3jgpLlpInmm7TjgZfjgb7jgZnjgIJcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSDmm7TmlrDmlrnms5XjgpLooajjgZnmloflrZfliJdcbiAgICAgKiBAY2hhaW5hYmxlXG4gICAgICovXG4gICAgc2V0VXBkYXRlVHlwZTogZnVuY3Rpb24odHlwZSkge1xuICAgICAgdGhpcy51cGRhdGVUeXBlID0gdHlwZTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBwcm9wc+OBp+aMh+WumuOBl+OBn+WApOOBq+OBquOCi+OBvuOBp+OAgWR1cmF0aW9u44Gn5oyH5a6a44GX44Gf5pmC6ZaT44KS44GL44GR44Gm44CB44Ki44OL44Oh44O844K344On44Oz44GV44Gb44G+44GZ44CCXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHByb3BzIOWkieabtOOBl+OBn+OBhOODl+ODreODkeODhuOCo+OCkmtleeOBqOOBl+OBn+OCquODluOCuOOCp+OCr+ODiFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBkdXJhdGlvbiAob3B0aW9uYWwpIOOCouODi+ODoeODvOOCt+ODp+ODs+OBq+OBi+OBkeOCi+aZgumWk1xuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBlYXNpbmcgKG9wdGlvbmFsKSBlYXNpbmcge0BsaW5rIHBoaW5hLnV0aWwuVHdlZW4jRUFTSU5HfeOCkuWPgueFp+OBl+OBpuOBj+OBoOOBleOBhOOAglxuICAgICAqIEBjaGFpbmFibGVcbiAgICAgKiBcbiAgICAgKi9cbiAgICB0bzogZnVuY3Rpb24ocHJvcHMsIGR1cmF0aW9uLCBlYXNpbmcpIHtcbiAgICAgIHRoaXMuX2FkZCh7XG4gICAgICAgIHR5cGU6ICd0d2VlbicsXG4gICAgICAgIG1vZGU6ICd0bycsXG4gICAgICAgIHByb3BzOiBwcm9wcyxcbiAgICAgICAgZHVyYXRpb246IGR1cmF0aW9uLFxuICAgICAgICBlYXNpbmc6IGVhc2luZyxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOOCouODi+ODoeODvOOCt+ODp+ODs+mWi+Wni+aZguOBruWApOOBqHByb3Bz44Gn5oyH5a6a44GX44Gf5YCk44KS5Yqg566X44GX44Gf5YCk44Gr44Gq44KL44G+44Gn44CBZHVyYXRpb27jgafmjIflrprjgZfjgZ/mmYLplpPjgpLjgYvjgZHjgabjgIHjgqLjg4vjg6Hjg7zjgrfjg6fjg7PjgZXjgZvjgb7jgZnjgIJcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcHJvcHMg5aSJ5pu044GX44Gf44GE44OX44Ot44OR44OG44Kj44KSa2V544Go44GX44Gf44Kq44OW44K444Kn44Kv44OIXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGR1cmF0aW9uIChvcHRpb25hbCkg44Ki44OL44Oh44O844K344On44Oz44Gr44GL44GR44KL5pmC6ZaTXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGVhc2luZyAob3B0aW9uYWwpIGVhc2luZyB7QGxpbmsgcGhpbmEudXRpbC5Ud2VlbiNFQVNJTkd944KS5Y+C54Wn44GX44Gm44GP44Gg44GV44GE44CCXG4gICAgICogQGNoYWluYWJsZVxuICAgICAqL1xuICAgIGJ5OiBmdW5jdGlvbihwcm9wcywgZHVyYXRpb24sIGVhc2luZykge1xuICAgICAgdGhpcy5fYWRkKHtcbiAgICAgICAgdHlwZTogJ3R3ZWVuJyxcbiAgICAgICAgbW9kZTogJ2J5JyxcbiAgICAgICAgcHJvcHM6IHByb3BzLFxuICAgICAgICBkdXJhdGlvbjogZHVyYXRpb24sXG4gICAgICAgIGVhc2luZzogZWFzaW5nLFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBwcm9wc+OBp+aMh+WumuOBl+OBn+WApOOBi+OCieOCouODi+ODoeODvOOCt+ODp+ODs+mWi+Wni+aZguOBruWApOOBq+OBquOCi+OBvuOBp+OAgWR1cmF0aW9u44Gn5oyH5a6a44GX44Gf5pmC6ZaT44KS44GL44GR44Gm44CB44Ki44OL44Oh44O844K344On44Oz44GV44Gb44G+44GZ44CCXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHByb3BzIOWkieabtOOBl+OBn+OBhOODl+ODreODkeODhuOCo+OCkmtleeOBqOOBl+OBn+OCquODluOCuOOCp+OCr+ODiFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBkdXJhdGlvbiAob3B0aW9uYWwpIOOCouODi+ODoeODvOOCt+ODp+ODs+OBq+OBi+OBkeOCi+aZgumWk1xuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBlYXNpbmcgKG9wdGlvbmFsKSBlYXNpbmcge0BsaW5rIHBoaW5hLnV0aWwuVHdlZW4jRUFTSU5HfeOCkuWPgueFp+OBl+OBpuOBj+OBoOOBleOBhOOAglxuICAgICAqIEBjaGFpbmFibGVcbiAgICAgKi9cbiAgICBmcm9tOiBmdW5jdGlvbihwcm9wcywgZHVyYXRpb24sIGVhc2luZykge1xuICAgICAgdGhpcy5fYWRkKHtcbiAgICAgICAgdHlwZTogJ3R3ZWVuJyxcbiAgICAgICAgbW9kZTogJ2Zyb20nLFxuICAgICAgICBwcm9wczogcHJvcHMsXG4gICAgICAgIGR1cmF0aW9uOiBkdXJhdGlvbixcbiAgICAgICAgZWFzaW5nOiBlYXNpbmcsXG4gICAgICB9KTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDmjIflrprjgZfjgZ/mmYLplpPjgYzntYzpgY7jgZnjgovjgb7jgaflvoXmqZ/jgZfjgb7jgZnjgIJcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gdGltZSB3YWl044GZ44KL5pmC6ZaTXG4gICAgICogQGNoYWluYWJsZVxuICAgICAqL1xuICAgIHdhaXQ6IGZ1bmN0aW9uKHRpbWUpIHtcbiAgICAgIHRoaXMuX2FkZCh7XG4gICAgICAgIHR5cGU6ICd3YWl0JyxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGxpbWl0OiB0aW1lLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog54++5Zyo6Kit5a6a44GV44KM44Gm44GE44KL44Ki44OL44Oh44O844K344On44Oz44GM57WC5LqG44GX44Gf5pmC44Gr5ZG844Gz5Ye644GV44KM44KL6Zai5pWw44KS44K744OD44OI44GX44G+44GZ44CCXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZnVuYyDlkbzjgbPlh7rjgZXjgozjgovplqLmlbBcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gc2VsZiAob3B0aW9uYWwpIGZ1bmPlhoXjgad0aGlz44Gr44GX44Gf44GE44Kq44OW44K444Kn44Kv44OI44CCXG4gICAgICogQHBhcmFtIHtPYmplY3RbXX0gYXJncyAob3B0aW9uYWwpIGZ1bmPjga7lvJXmlbDjgavjgZfjgZ/jgYTlgKRcbiAgICAgKiBAY2hhaW5hYmxlXG4gICAgICovXG4gICAgY2FsbDogZnVuY3Rpb24oZnVuYywgc2VsZiwgYXJncykge1xuICAgICAgdGhpcy5fYWRkKHtcbiAgICAgICAgdHlwZTogJ2NhbGwnLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgZnVuYzogZnVuYyxcbiAgICAgICAgICBzZWxmOiBzZWxmIHx8IHRoaXMsXG4gICAgICAgICAgYXJnczogYXJncyxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOePvuWcqOioreWumuOBleOCjOOBpuOBhOOCi+OCouODi+ODoeODvOOCt+ODp+ODs+OBjOe1guS6huOBl+OBn+aZguOBq+ODl+ODreODkeODhuOCo+OCkuOCu+ODg+ODiOOBl+OBvuOBmeOAgiAgXG4gICAgICog56ys5LiA5byV5pWw44Gr44Kq44OW44K444Kn44Kv44OI44KS44K744OD44OI44GZ44KL44GT44Go44KC44Gn44GN44G+44GZ44CCXG4gICAgICogQHBhcmFtIHtTdHJpbmcgfCBPYmplY3R9IGtleSB2YWx1ZeOCkuOCu+ODg+ODiOOBmeOCi+ODl+ODreODkeODhuOCo+WQjeOBi+OAgeWkieabtOOBl+OBn+OBhOODl+ODreODkeODhuOCo+OCkmtleeOBqOOBl+OBn+OCquODluOCuOOCp+OCr+ODiOOAglxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSB2YWx1ZSAob3B0aW9uYWwpIOOCu+ODg+ODiOOBmeOCi+WApFxuICAgICAqIEBjaGFpbmFibGVcbiAgICAgKi9cbiAgICBzZXQ6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbiAgICAgIHZhciB2YWx1ZXMgPSBudWxsO1xuICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMikge1xuICAgICAgICB2YWx1ZXMgPSB7fTtcbiAgICAgICAgdmFsdWVzW2tleV0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB2YWx1ZXMgPSBrZXk7XG4gICAgICB9XG4gICAgICB0aGlzLl90YXNrcy5wdXNoKHtcbiAgICAgICAgdHlwZTogXCJzZXRcIixcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHZhbHVlczogdmFsdWVzXG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogeCwgeeOBq+WvvuOBl+OBpuOAgSB7QGxpbmsgI3RvfSDjga7lh6bnkIbjgpLooYzjgYTjgb7jgZnjgIJcbiAgICAgKiBAcGFyYW0ge051bWJlcn0geFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB5XG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGR1cmF0aW9uIChvcHRpb25hbCkg44Ki44OL44Oh44O844K344On44Oz44Gr44GL44GR44KL5pmC6ZaTXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGVhc2luZyAob3B0aW9uYWwpIGVhc2luZyB7QGxpbmsgcGhpbmEudXRpbC5Ud2VlbiNFQVNJTkd944KS5Y+C54Wn44GX44Gm44GP44Gg44GV44GE44CCXG4gICAgICogQGNoYWluYWJsZVxuICAgICAqL1xuICAgIG1vdmVUbzogZnVuY3Rpb24oeCwgeSwgZHVyYXRpb24sIGVhc2luZykge1xuICAgICAgcmV0dXJuIHRoaXMudG8oeyB4OiB4LCB5OiB5IH0sIGR1cmF0aW9uLCBlYXNpbmcpO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICogeCwgeeOBq+WvvuOBl+OBpuOAgSB7QGxpbmsgI2J5fSDjga7lh6bnkIbjgpLooYzjgYTjgb7jgZnjgIJcbiAgICAgKiBAcGFyYW0ge051bWJlcn0geFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB5XG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGR1cmF0aW9uIChvcHRpb25hbCkg44Ki44OL44Oh44O844K344On44Oz44Gr44GL44GR44KL5pmC6ZaTXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGVhc2luZyAob3B0aW9uYWwpIGVhc2luZyB7QGxpbmsgcGhpbmEudXRpbC5Ud2VlbiNFQVNJTkd944KS5Y+C54Wn44GX44Gm44GP44Gg44GV44GE44CCXG4gICAgICogQGNoYWluYWJsZVxuICAgICAqL1xuICAgIG1vdmVCeTogZnVuY3Rpb24oeCwgeSwgZHVyYXRpb24sIGVhc2luZykge1xuICAgICAgcmV0dXJuIHRoaXMuYnkoeyB4OiB4LCB5OiB5IH0sIGR1cmF0aW9uLCBlYXNpbmcpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiByb3RhdGlvbuOBq+WvvuOBl+OBpuOAgSB7QGxpbmsgI3RvfSDjga7lh6bnkIbjgpLooYzjgYTjgb7jgZnjgIJcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gcm90YXRpb25cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gZHVyYXRpb24gKG9wdGlvbmFsKSDjgqLjg4vjg6Hjg7zjgrfjg6fjg7PjgavjgYvjgZHjgovmmYLplpNcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZWFzaW5nIChvcHRpb25hbCkgZWFzaW5nIHtAbGluayBwaGluYS51dGlsLlR3ZWVuI0VBU0lOR33jgpLlj4LnhafjgZfjgabjgY/jgaDjgZXjgYTjgIJcbiAgICAgKiBAY2hhaW5hYmxlXG4gICAgICovXG4gICAgcm90YXRlVG86IGZ1bmN0aW9uKHJvdGF0aW9uLCBkdXJhdGlvbiwgZWFzaW5nKSB7XG4gICAgICByZXR1cm4gdGhpcy50byh7IHJvdGF0aW9uOiByb3RhdGlvbiB9LCBkdXJhdGlvbiwgZWFzaW5nKTtcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIHJvdGF0aW9u44Gr5a++44GX44Gm44CBIHtAbGluayAjYnl9IOOBruWHpueQhuOCkuihjOOBhOOBvuOBmeOAglxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSByb3RhdGlvblxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBkdXJhdGlvbiAob3B0aW9uYWwpIOOCouODi+ODoeODvOOCt+ODp+ODs+OBq+OBi+OBkeOCi+aZgumWk1xuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBlYXNpbmcgKG9wdGlvbmFsKSBlYXNpbmcge0BsaW5rIHBoaW5hLnV0aWwuVHdlZW4jRUFTSU5HfeOCkuWPgueFp+OBl+OBpuOBj+OBoOOBleOBhOOAglxuICAgICAqIEBjaGFpbmFibGVcbiAgICAgKi9cbiAgICByb3RhdGVCeTogZnVuY3Rpb24ocm90YXRpb24sIGR1cmF0aW9uLCBlYXNpbmcpIHtcbiAgICAgIHJldHVybiB0aGlzLmJ5KHsgcm90YXRpb246IHJvdGF0aW9uIH0sIGR1cmF0aW9uLCBlYXNpbmcpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBzY2FsZVgsIHNjYWxlWeOBq+WvvuOBl+OBpiB7QGxpbmsgI3RvfSDjga7lh6bnkIbjgpLooYzjgYTjgb7jgZnjgIJcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gc2NhbGUgc2NhbGVY44Goc2NhbGVZ44Gr6Kit5a6a44GZ44KL5YCkXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGR1cmF0aW9uIChvcHRpb25hbCkg44Ki44OL44Oh44O844K344On44Oz44Gr44GL44GR44KL5pmC6ZaTXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGVhc2luZyAob3B0aW9uYWwpIGVhc2luZyB7QGxpbmsgcGhpbmEudXRpbC5Ud2VlbiNFQVNJTkd944KS5Y+C54Wn44GX44Gm44GP44Gg44GV44GE44CCXG4gICAgICogQGNoYWluYWJsZVxuICAgICAqL1xuICAgIHNjYWxlVG86IGZ1bmN0aW9uKHNjYWxlLCBkdXJhdGlvbiwgZWFzaW5nKSB7XG4gICAgICByZXR1cm4gdGhpcy50byh7IHNjYWxlWDogc2NhbGUsIHNjYWxlWTogc2NhbGUgfSwgZHVyYXRpb24sIGVhc2luZyk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBzY2FsZVgsIHNjYWxlWeOBq+WvvuOBl+OBpiB7QGxpbmsgI2J5fSDjga7lh6bnkIbjgpLooYzjgYTjgb7jgZnjgIJcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gc2NhbGUgc2NhbGVY44Goc2NhbGVZ44Gr6Kit5a6a44GZ44KL5YCkXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGR1cmF0aW9uIChvcHRpb25hbCkg44Ki44OL44Oh44O844K344On44Oz44Gr44GL44GR44KL5pmC6ZaTXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGVhc2luZyAob3B0aW9uYWwpIGVhc2luZyB7QGxpbmsgcGhpbmEudXRpbC5Ud2VlbiNFQVNJTkd944KS5Y+C54Wn44GX44Gm44GP44Gg44GV44GE44CCXG4gICAgICogQGNoYWluYWJsZVxuICAgICAqL1xuICAgIHNjYWxlQnk6IGZ1bmN0aW9uKHNjYWxlLCBkdXJhdGlvbiwgZWFzaW5nKSB7XG4gICAgICByZXR1cm4gdGhpcy5ieSh7IHNjYWxlWDogc2NhbGUsIHNjYWxlWTogc2NhbGUgfSwgZHVyYXRpb24sIGVhc2luZyk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIGFscGhh44Gr5a++44GX44GmIHtAbGluayAjdG99IOOBruWHpueQhuOCkuihjOOBhOOBvuOBmeOAglxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB2YWx1ZSBhbHBoYeOBq+ioreWumuOBmeOCi+WApFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBkdXJhdGlvbiAob3B0aW9uYWwpIOOCouODi+ODoeODvOOCt+ODp+ODs+OBq+OBi+OBkeOCi+aZgumWk1xuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBlYXNpbmcgKG9wdGlvbmFsKSBlYXNpbmcge0BsaW5rIHBoaW5hLnV0aWwuVHdlZW4jRUFTSU5HfeOCkuWPgueFp+OBl+OBpuOBj+OBoOOBleOBhOOAglxuICAgICAqIEBjaGFpbmFibGVcbiAgICAgKi9cbiAgICBmYWRlOiBmdW5jdGlvbih2YWx1ZSwgZHVyYXRpb24sIGVhc2luZykge1xuICAgICAgcmV0dXJuIHRoaXMudG8oeyBhbHBoYTogdmFsdWUgfSwgZHVyYXRpb24sIGVhc2luZyk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIGFscGhh44KSMOOBq+OBmeOCi+OCouODi+ODoeODvOOCt+ODp+ODs+OCkuioreWumuOBl+OBvuOBmeOAglxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBkdXJhdGlvbiAob3B0aW9uYWwpIOOCouODi+ODoeODvOOCt+ODp+ODs+OBq+OBi+OBkeOCi+aZgumWk1xuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBlYXNpbmcgKG9wdGlvbmFsKSBlYXNpbmcge0BsaW5rIHBoaW5hLnV0aWwuVHdlZW4jRUFTSU5HfeOCkuWPgueFp+OBl+OBpuOBj+OBoOOBleOBhOOAglxuICAgICAqIEBjaGFpbmFibGVcbiAgICAgKi9cbiAgICBmYWRlT3V0OiBmdW5jdGlvbihkdXJhdGlvbiwgZWFzaW5nKSB7XG4gICAgICByZXR1cm4gdGhpcy5mYWRlKDAuMCwgZHVyYXRpb24sIGVhc2luZyk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIGFscGhh44KSMeOBq+OBmeOCi+OCouODi+ODoeODvOOCt+ODp+ODs+OCkuioreWumuOBl+OBvuOBmeOAglxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBkdXJhdGlvbiAob3B0aW9uYWwpIOOCouODi+ODoeODvOOCt+ODp+ODs+OBq+OBi+OBkeOCi+aZgumWk1xuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBlYXNpbmcgKG9wdGlvbmFsKSBlYXNpbmcge0BsaW5rIHBoaW5hLnV0aWwuVHdlZW4jRUFTSU5HfeOCkuWPgueFp+OBl+OBpuOBj+OBoOOBleOBhOOAglxuICAgICAqIEBjaGFpbmFibGVcbiAgICAgKi9cbiAgICBmYWRlSW46IGZ1bmN0aW9uKGR1cmF0aW9uLCBlYXNpbmcpIHtcbiAgICAgIHJldHVybiB0aGlzLmZhZGUoMS4wLCBkdXJhdGlvbiwgZWFzaW5nKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog44Ki44OL44Oh44O844K344On44Oz6ZaL5aeLXG4gICAgICogQGNoYWluYWJsZVxuICAgICAqL1xuICAgIHBsYXk6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5wbGF5aW5nID0gdHJ1ZTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDjgqLjg4vjg6Hjg7zjgrfjg6fjg7PjgpLkuIDmmYLlgZzmraJcbiAgICAgKiBAY2hhaW5hYmxlXG4gICAgICovXG4gICAgcGF1c2U6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5wbGF5aW5nID0gZmFsc2U7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog44Ki44OL44Oh44O844K344On44Oz44KS5YGc5q2i44GX44CB5pyA5Yid44G+44Gn5be744GN5oi744GX44G+44GZ44CCXG4gICAgICogQGNoYWluYWJsZVxuICAgICAqL1xuICAgIHN0b3A6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5wbGF5aW5nID0gZmFsc2U7XG4gICAgICB0aGlzLnJld2luZCgpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOOCouODi+ODoeODvOOCt+ODp+ODs+OCkuW3u+OBjeaIu+OBmVxuICAgICAqIEBjaGFpbmFibGVcbiAgICAgKi9cbiAgICByZXdpbmQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5fdXBkYXRlID0gdGhpcy5fdXBkYXRlVGFzaztcbiAgICAgIHRoaXMuX2luZGV4ID0gMDtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICB5b3lvOiBmdW5jdGlvbigpIHtcbiAgICAgIC8vIFRPRE86IOacgOWIneOBruWApOOBjOWIhuOBi+OCieOBquOBhOOBruOBp+WPjei7ouOBp+OBjeOBquOBhC4uLlxuICAgICAgdGhpcy5fdXBkYXRlID0gdGhpcy5fdXBkYXRlVGFzaztcbiAgICAgIHRoaXMuX2luZGV4ID0gMDtcbiAgICAgIHRoaXMuX3Rhc2tzLmVhY2goZnVuY3Rpb24odGFzaykge1xuICAgICAgICBpZiAodGFzay50eXBlID09PSAndHdlZW4nKSB7XG5cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLnBsYXkoKTtcblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOOCouODi+ODoeODvOOCt+ODp+ODs+ODq+ODvOODl+ioreWumlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gZmxhZ1xuICAgICAqIEBjaGFpbmFibGVcbiAgICAgKi9cbiAgICBzZXRMb29wOiBmdW5jdGlvbihmbGFnKSB7XG4gICAgICB0aGlzLl9sb29wID0gZmxhZztcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDjgqLjg4vjg6Hjg7zjgrfjg6fjg7PjgpLjgq/jg6rjgqJcbiAgICAgKiBAY2hhaW5hYmxlXG4gICAgICovXG4gICAgY2xlYXI6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5faW5pdCgpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOeZu+mMsuOBleOCjOOBn+OCv+OCueOCr+OCkuOBmeOBueOBpuWujOS6huOBmeOCi1xuICAgICAqIOODq+ODvOODl+ioreWumuOBleOCjOOBpuOBhOOCi+WgtOWQiOOBr+WFiOmgreOBi+OCieWGjemWi1xuICAgICAqL1xuICAgIGZpbmlzaDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgX2xvb3AgPSB0aGlzLl9sb29wO1xuICAgICAgdmFyIF91cGRhdGVUeXBlID0gdGhpcy51cGRhdGVUeXBlO1xuICAgICAgdmFyIF9wbGF5aW5nID0gdGhpcy5wbGF5aW5nO1xuXG4gICAgICB0aGlzLl9sb29wID0gZmFsc2U7XG4gICAgICB0aGlzLnVwZGF0ZVR5cGUgPSBcImZpbmlzaFwiO1xuXG4gICAgICB0aGlzLnBsYXlpbmcgPSB0cnVlO1xuICAgICAgd2hpbGUgKHRoaXMucGxheWluZykge1xuICAgICAgICB0aGlzLl91cGRhdGUobnVsbCk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX2xvb3AgPSBfbG9vcDtcbiAgICAgIHRoaXMudXBkYXRlVHlwZSA9IF91cGRhdGVUeXBlO1xuICAgICAgdGhpcy5wbGF5aW5nID0gX3BsYXlpbmc7XG5cbiAgICAgIGlmICh0aGlzLl9sb29wKSB7XG4gICAgICAgIHRoaXMucmV3aW5kKCk7XG4gICAgICAgIGlmICh0aGlzLnBsYXlpbmcpIHtcbiAgICAgICAgICB0aGlzLnBsYXkoKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSlNPTuW9ouW8j+OBp+OCouODi+ODoeODvOOCt+ODp+ODs+OCkuioreWumuOBl+OBvuOBmeOAglxuICAgICAqIEBjaGFpbmFibGVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0ganNvblxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0ganNvbi5sb29wIChvcHRpb25hbCkg44Or44O844OX44GZ44KL5aC05ZCIdHJ1ZVxuICAgICAqIEBwYXJhbSB7QXJyYXlbXX0ganNvbi50d2VlbnMg6Kit5a6a44GZ44KL44Ki44OL44Oh44O844K344On44OzXG4gICAgICogXG4gICAgICogYGBgXG4gICAgICogW1xuICAgICAqICAgW21ldGhvZCwgYXJnMSwgYXJnMiwsLF0sXG4gICAgICogICBbJ3RvJywge3ZhbHVlOiAxMDB9LCAxMDAwLCAnc3dpbmcnXSxcbiAgICAgKiAgIFsnd2FpdCcsIDEwMDBdLFxuICAgICAqICAgWydzZXQnLCAndGV4dCcsICdFTkQnXVxuICAgICAqIF1cbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICBmcm9tSlNPTjogZnVuY3Rpb24oanNvbikge1xuICAgICAgaWYgKGpzb24ubG9vcCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMuc2V0TG9vcChqc29uLmxvb3ApO1xuICAgICAgfVxuXG4gICAgICBqc29uLnR3ZWVucy5lYWNoKGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgdCA9IHQuY2xvbmUoKTtcbiAgICAgICAgdmFyIG1ldGhvZCA9IHQuc2hpZnQoKTtcbiAgICAgICAgdGhpc1ttZXRob2RdLmFwcGx5KHRoaXMsIHQpO1xuICAgICAgfSwgdGhpcyk7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBfYWRkOiBmdW5jdGlvbihwYXJhbXMpIHtcbiAgICAgIHRoaXMuX3Rhc2tzLnB1c2gocGFyYW1zKTtcbiAgICB9LFxuXG4gICAgX3VwZGF0ZVRhc2s6IGZ1bmN0aW9uKGFwcCkge1xuICAgICAgaWYgKCF0aGlzLnBsYXlpbmcpIHJldHVybiA7XG5cbiAgICAgIHZhciB0YXNrID0gdGhpcy5fdGFza3NbdGhpcy5faW5kZXhdO1xuICAgICAgaWYgKCF0YXNrKSB7XG4gICAgICAgIGlmICh0aGlzLl9sb29wKSB7XG4gICAgICAgICAgdGhpcy5yZXdpbmQoKTtcbiAgICAgICAgICB0aGlzLl91cGRhdGUoYXBwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICB0aGlzLnBsYXlpbmcgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgICsrdGhpcy5faW5kZXg7XG4gICAgICB9XG5cbiAgICAgIGlmICh0YXNrLnR5cGUgPT09ICd0d2VlbicpIHtcbiAgICAgICAgdGhpcy5fdHdlZW4gPSBwaGluYS51dGlsLlR3ZWVuKCk7XG5cbiAgICAgICAgdmFyIGR1cmF0aW9uID0gdGFzay5kdXJhdGlvbiB8fCB0aGlzLl9nZXREZWZhdWx0RHVyYXRpb24oKTtcbiAgICAgICAgaWYgKHRhc2subW9kZSA9PT0gJ3RvJykge1xuICAgICAgICAgIHRoaXMuX3R3ZWVuLnRvKHRoaXMudGFyZ2V0LCB0YXNrLnByb3BzLCBkdXJhdGlvbiwgdGFzay5lYXNpbmcpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRhc2subW9kZSA9PT0gJ2J5Jykge1xuICAgICAgICAgIHRoaXMuX3R3ZWVuLmJ5KHRoaXMudGFyZ2V0LCB0YXNrLnByb3BzLCBkdXJhdGlvbiwgdGFzay5lYXNpbmcpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHRoaXMuX3R3ZWVuLmZyb20odGhpcy50YXJnZXQsIHRhc2sucHJvcHMsIGR1cmF0aW9uLCB0YXNrLmVhc2luZyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdXBkYXRlID0gdGhpcy5fdXBkYXRlVHdlZW47XG4gICAgICAgIHRoaXMuX3VwZGF0ZShhcHApO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAodGFzay50eXBlID09PSAnd2FpdCcpIHtcbiAgICAgICAgdGhpcy5fd2FpdCA9IHtcbiAgICAgICAgICB0aW1lOiAwLFxuICAgICAgICAgIGxpbWl0OiB0YXNrLmRhdGEubGltaXQsXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5fdXBkYXRlID0gdGhpcy5fdXBkYXRlV2FpdDtcbiAgICAgICAgdGhpcy5fdXBkYXRlKGFwcCk7XG4gICAgICB9XG4gICAgICBlbHNlIGlmICh0YXNrLnR5cGUgPT09ICdjYWxsJykge1xuICAgICAgICB0YXNrLmRhdGEuZnVuYy5hcHBseSh0YXNrLmRhdGEuc2VsZiwgdGFzay5kYXRhLmFyZ3MpO1xuICAgICAgICAvLyAx44OV44Os44O844Og5raI6LK744GX44Gq44GE44KI44GG5YaN5biwXG4gICAgICAgIHRoaXMuX3VwZGF0ZShhcHApO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAodGFzay50eXBlID09PSAnc2V0Jykge1xuICAgICAgICB0aGlzLnRhcmdldC4kZXh0ZW5kKHRhc2suZGF0YS52YWx1ZXMpO1xuICAgICAgICAvLyAx44OV44Os44O844Og5raI6LK744GX44Gq44GE44KI44GG5YaN5biwXG4gICAgICAgIHRoaXMuX3VwZGF0ZShhcHApO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBfdXBkYXRlVHdlZW46IGZ1bmN0aW9uKGFwcCkge1xuICAgICAgdmFyIHR3ZWVuID0gdGhpcy5fdHdlZW47XG4gICAgICB2YXIgdGltZSA9IHRoaXMuX2dldFVuaXRUaW1lKGFwcCk7XG5cbiAgICAgIHR3ZWVuLmZvcndhcmQodGltZSk7XG4gICAgICB0aGlzLmZsYXJlKCd0d2VlbicpO1xuXG4gICAgICBpZiAodHdlZW4udGltZSA+PSB0d2Vlbi5kdXJhdGlvbikge1xuICAgICAgICBkZWxldGUgdGhpcy5fdHdlZW47XG4gICAgICAgIHRoaXMuX3R3ZWVuID0gbnVsbDtcbiAgICAgICAgdGhpcy5fdXBkYXRlID0gdGhpcy5fdXBkYXRlVGFzaztcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX3VwZGF0ZVdhaXQ6IGZ1bmN0aW9uKGFwcCkge1xuICAgICAgdmFyIHdhaXQgPSB0aGlzLl93YWl0O1xuICAgICAgdmFyIHRpbWUgPSB0aGlzLl9nZXRVbml0VGltZShhcHApO1xuICAgICAgd2FpdC50aW1lICs9IHRpbWU7XG5cbiAgICAgIGlmICh3YWl0LnRpbWUgPj0gd2FpdC5saW1pdCkge1xuICAgICAgICBkZWxldGUgdGhpcy5fd2FpdDtcbiAgICAgICAgdGhpcy5fd2FpdCA9IG51bGw7XG4gICAgICAgIHRoaXMuX3VwZGF0ZSA9IHRoaXMuX3VwZGF0ZVRhc2s7XG4gICAgICB9XG4gICAgfSxcblxuICAgIF9nZXRVbml0VGltZTogZnVuY3Rpb24oYXBwKSB7XG4gICAgICB2YXIgb2JqID0gVVBEQVRFX01BUFt0aGlzLnVwZGF0ZVR5cGVdO1xuICAgICAgaWYgKG9iaikge1xuICAgICAgICByZXR1cm4gb2JqLmZ1bmMoYXBwKSAqIHRoaXMudGltZVNjYWxlO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHJldHVybiAxMDAwIC8gYXBwLmZwcyAqIHRoaXMudGltZVNjYWxlO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBfZ2V0RGVmYXVsdER1cmF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBvYmogPSBVUERBVEVfTUFQW3RoaXMudXBkYXRlVHlwZV07XG4gICAgICByZXR1cm4gb2JqICYmIG9iai5kdXJhdGlvbjtcbiAgICB9LFxuXG4gICAgX3N0YXRpYzoge1xuICAgICAgLyoqXG4gICAgICAgKiBAc3RhdGljXG4gICAgICAgKiB7QGxpbmsgI3VwZGF0ZVR5cGV944Gr6Kit5a6a44GZ44KL5pu05paw5pa55rOV44Gu5a6a576p44Gn44GZ44CCXG4gICAgICAgKiDkuIvoqJjjga7ooajjgavlrprnvqnmuIjjgb/jga7mm7TmlrDmlrnms5XjgpJ7QGxpbmsgI3VwZGF0ZVR5cGV944Gr6Kit5a6a44GZ44KL44GT44Go44Gn44CBXG4gICAgICAgKiDjgqLjg4vjg6Hjg7zjgrfjg6fjg7Pjga7mm7TmlrDmlrnms5XjgpLlpInmm7TjgZnjgovjgZPjgajjgYzjgafjgY3jgb7jgZnjgIJcbiAgICAgICAqIFxuICAgICAgICogfCDmm7TmlrDmlrnms5UgfCDljZjkvY0o44OH44OV44Kp44Or44OI5YCkKSB8IDHjg5Xjg6zjg7zjg6DjgYLjgZ/jgorjga7jgqLjg4vjg6Hjg7zjgrfjg6fjg7PpgJ/luqYgfFxuICAgICAgICogfC18LXwtfFxuICAgICAgICogfCBub3JtYWwgfCDjg5/jg6rnp5IoMTAwMCkgfCBhcHAuZnBz44Gr44KI44Gj44Gm5aSJ5YyWIHxcbiAgICAgICAqIHwgZGVsdGEgfCDjg5/jg6rnp5IoMTAwMCkgfCDntYzpgY7mmYLplpPjgavjgojjgaPjgablpInljJYgfFxuICAgICAgICogfCBmcHMgfCDjg5Xjg6zjg7zjg6AoMzApIHwg5b+F44Ga5ZCM44GY6YCf5bqm44Gn5aSJ5YyWIHxcbiAgICAgICAqL1xuICAgICAgVVBEQVRFX01BUDoge1xuICAgICAgICBub3JtYWw6IHtcbiAgICAgICAgICBmdW5jOiBmdW5jdGlvbihhcHApIHtcbiAgICAgICAgICAgIHJldHVybiAxMDAwIC8gYXBwLmZwcztcbiAgICAgICAgICB9LFxuICAgICAgICAgIGR1cmF0aW9uOiAxMDAwLFxuICAgICAgICB9LFxuXG4gICAgICAgIGRlbHRhOiB7XG4gICAgICAgICAgZnVuYzogZnVuY3Rpb24oYXBwKSB7XG4gICAgICAgICAgICByZXR1cm4gYXBwLnRpY2tlci5kZWx0YVRpbWU7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkdXJhdGlvbjogMTAwMCxcbiAgICAgICAgfSxcblxuICAgICAgICBmcHM6IHtcbiAgICAgICAgICBmdW5jOiBmdW5jdGlvbihhcHApIHtcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZHVyYXRpb246IDMwLFxuICAgICAgICB9LFxuXG4gICAgICAgIGZpbmlzaDoge1xuICAgICAgICAgIGZ1bmM6IGZ1bmN0aW9uKGFwcCkge1xuICAgICAgICAgICAgcmV0dXJuIEluZmluaXR5O1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZHVyYXRpb246IDEsXG4gICAgICAgIH0sXG5cbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIHZhciBVUERBVEVfTUFQID0gVHdlZW5lci5VUERBVEVfTUFQO1xuXG4gIC8qKlxuICAgKiBAbWVtYmVyIHBoaW5hLmFwcC5FbGVtZW50XG4gICAqIEBwcm9wZXJ0eSB0d2VlbmVyXG4gICAqIOiHqui6q+OBq+OCouOCv+ODg+ODgea4iOOBv+OBrntAbGluayBwaGluYS5hY2Nlc3NvcnkuVHdlZW5lcn3jgqrjg5bjgrjjgqfjgq/jg4jjgIJcbiAgICovXG4gIHBoaW5hLmFwcC5FbGVtZW50LnByb3RvdHlwZS5nZXR0ZXIoJ3R3ZWVuZXInLCBmdW5jdGlvbigpIHtcbiAgICBpZiAoIXRoaXMuX3R3ZWVuZXIpIHtcbiAgICAgIHRoaXMuX3R3ZWVuZXIgPSBwaGluYS5hY2Nlc3NvcnkuVHdlZW5lcigpLmF0dGFjaFRvKHRoaXMpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fdHdlZW5lcjtcbiAgfSk7XG4gIFxufSk7XG5cblxuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5hY2Nlc3NvcnkuRHJhZ2dhYmxlXG4gICAqIERyYWdnYWJsZVxuICAgKiBAZXh0ZW5kcyBwaGluYS5hY2Nlc3NvcnkuQWNjZXNzb3J5XG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmFjY2Vzc29yeS5EcmFnZ2FibGUnLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmFjY2Vzc29yeS5BY2Nlc3NvcnknLFxuXG4gICAgLyoqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgaW5pdDogZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICB0aGlzLnN1cGVySW5pdCh0YXJnZXQpO1xuXG4gICAgICB0aGlzLmluaXRpYWxQb3NpdGlvbiA9IHBoaW5hLmdlb20uVmVjdG9yMigwLCAwKTtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgdGhpcy5vbignYXR0YWNoZWQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy50YXJnZXQuc2V0SW50ZXJhY3RpdmUodHJ1ZSk7XG5cbiAgICAgICAgdGhpcy5fZHJhZ2dpbmcgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLnRhcmdldC5vbigncG9pbnRzdGFydCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICBpZiAocGhpbmEuYWNjZXNzb3J5LkRyYWdnYWJsZS5fbG9jaykgcmV0dXJuIDtcblxuICAgICAgICAgIHRoaXMuX2RyYWdnaW5nID0gdHJ1ZTtcbiAgICAgICAgICBzZWxmLmluaXRpYWxQb3NpdGlvbi54ID0gdGhpcy54O1xuICAgICAgICAgIHNlbGYuaW5pdGlhbFBvc2l0aW9uLnkgPSB0aGlzLnk7XG4gICAgICAgICAgc2VsZi5mbGFyZSgnZHJhZ3N0YXJ0Jyk7XG4gICAgICAgICAgdGhpcy5mbGFyZSgnZHJhZ3N0YXJ0Jyk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnRhcmdldC5vbigncG9pbnRtb3ZlJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgIGlmICghdGhpcy5fZHJhZ2dpbmcpIHJldHVybiA7XG5cbiAgICAgICAgICB0aGlzLnggKz0gZS5wb2ludGVyLmR4O1xuICAgICAgICAgIHRoaXMueSArPSBlLnBvaW50ZXIuZHk7XG4gICAgICAgICAgc2VsZi5mbGFyZSgnZHJhZycpO1xuICAgICAgICAgIHRoaXMuZmxhcmUoJ2RyYWcnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy50YXJnZXQub24oJ3BvaW50ZW5kJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgIGlmICghdGhpcy5fZHJhZ2dpbmcpIHJldHVybiA7XG5cbiAgICAgICAgICB0aGlzLl9kcmFnZ2luZyA9IGZhbHNlO1xuICAgICAgICAgIHNlbGYuZmxhcmUoJ2RyYWdlbmQnKTtcbiAgICAgICAgICB0aGlzLmZsYXJlKCdkcmFnZW5kJyk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSxcblxuICAgIGJhY2s6IGZ1bmN0aW9uKHRpbWUsIGVhc2luZykge1xuICAgICAgaWYgKHRpbWUpIHtcbiAgICAgICAgdmFyIHQgPSB0aGlzLnRhcmdldDtcbiAgICAgICAgdC5zZXRJbnRlcmFjdGl2ZShmYWxzZSk7XG4gICAgICAgIHZhciB0d2VlbmVyID0gcGhpbmEuYWNjZXNzb3J5LlR3ZWVuZXIoKS5hdHRhY2hUbyh0KTtcbiAgICAgICAgdHdlZW5lclxuICAgICAgICAgIC50byh7XG4gICAgICAgICAgICB4OiB0aGlzLmluaXRpYWxQb3NpdGlvbi54LFxuICAgICAgICAgICAgeTogdGhpcy5pbml0aWFsUG9zaXRpb24ueSxcbiAgICAgICAgICB9LCB0aW1lLCBlYXNpbmcgfHwgJ2Vhc2VPdXRFbGFzdGljJylcbiAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHR3ZWVuZXIucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIHQuc2V0SW50ZXJhY3RpdmUodHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdiYWNrZW5kJyk7XG4gICAgICAgICAgfSwgdGhpcyk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy50YXJnZXQueCA9IHRoaXMuaW5pdGlhbFBvc2l0aW9uLng7XG4gICAgICAgIHRoaXMudGFyZ2V0LnkgPSB0aGlzLmluaXRpYWxQb3NpdGlvbi55O1xuICAgICAgICB0aGlzLmZsYXJlKCdiYWNrZW5kJyk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIGVuYWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLl9lbmFibGUgPSB0cnVlO1xuICAgIH0sXG5cbiAgICBfc3RhdGljOiB7XG4gICAgICBfbG9jazogZmFsc2UsXG4gICAgICBsb2NrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5fbG9jayA9IHRydWU7XG4gICAgICB9LFxuICAgICAgdW5sb2NrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5fbG9jayA9IGZhbHNlO1xuICAgICAgfSxcbiAgICB9XG5cbiAgfSk7XG5cbiAgcGhpbmEuYXBwLkVsZW1lbnQucHJvdG90eXBlLmdldHRlcignZHJhZ2dhYmxlJywgZnVuY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLl9kcmFnZ2FibGUpIHtcbiAgICAgIHRoaXMuX2RyYWdnYWJsZSA9IHBoaW5hLmFjY2Vzc29yeS5EcmFnZ2FibGUoKS5hdHRhY2hUbyh0aGlzKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX2RyYWdnYWJsZTtcbiAgfSk7XG4gIFxufSk7XG5cblxuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5hY2Nlc3NvcnkuRmxpY2thYmxlXG4gICAqIEZsaWNrYWJsZVxuICAgKiBAZXh0ZW5kcyBwaGluYS5hY2Nlc3NvcnkuQWNjZXNzb3J5XG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmFjY2Vzc29yeS5GbGlja2FibGUnLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmFjY2Vzc29yeS5BY2Nlc3NvcnknLFxuXG4gICAgLyoqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgaW5pdDogZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICB0aGlzLnN1cGVySW5pdCh0YXJnZXQpO1xuXG4gICAgICB0aGlzLmluaXRpYWxQb3NpdGlvbiA9IHBoaW5hLmdlb20uVmVjdG9yMigwLCAwKTtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgdGhpcy5mcmljdGlvbiA9IDAuOTtcbiAgICAgIHRoaXMudmVsb2NpdHkgPSBwaGluYS5nZW9tLlZlY3RvcjIoMCwgMCk7XG4gICAgICB0aGlzLnZlcnRpY2FsID0gdHJ1ZTtcbiAgICAgIHRoaXMuaG9yaXpvbnRhbCA9IHRydWU7XG5cbiAgICAgIHRoaXMuY2FjaGVMaXN0ID0gW107XG5cbiAgICAgIHRoaXMub24oJ2F0dGFjaGVkJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMudGFyZ2V0LnNldEludGVyYWN0aXZlKHRydWUpO1xuXG4gICAgICAgIHRoaXMudGFyZ2V0Lm9uKCdwb2ludHN0YXJ0JywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgIHNlbGYuaW5pdGlhbFBvc2l0aW9uLnNldCh0aGlzLngsIHRoaXMueSk7XG4gICAgICAgICAgc2VsZi52ZWxvY2l0eS5zZXQoMCwgMCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnRhcmdldC5vbigncG9pbnRzdGF5JywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgIGlmIChzZWxmLmhvcml6b250YWwpIHtcbiAgICAgICAgICAgIHRoaXMueCArPSBlLnBvaW50ZXIuZHg7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChzZWxmLnZlcnRpY2FsKSB7XG4gICAgICAgICAgICB0aGlzLnkgKz0gZS5wb2ludGVyLmR5O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChzZWxmLmNhY2hlTGlzdC5sZW5ndGggPiAzKSBzZWxmLmNhY2hlTGlzdC5zaGlmdCgpO1xuICAgICAgICAgIHNlbGYuY2FjaGVMaXN0LnB1c2goZS5wb2ludGVyLmRlbHRhUG9zaXRpb24uY2xvbmUoKSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMudGFyZ2V0Lm9uKCdwb2ludGVuZCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAvLyDli5XjgY3jga7jgYLjgosgZGVsdGEgcG9zaXRpb24g44KS5b6M44KN44GL44KJ5qSc57Si44CAXG4gICAgICAgICAgdmFyIGRlbHRhID0gc2VsZi5jYWNoZUxpc3QucmV2ZXJzZSgpLmZpbmQoZnVuY3Rpb24odikge1xuICAgICAgICAgICAgcmV0dXJuIHYubGVuZ3RoU3F1YXJlZCgpID4gMTA7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgc2VsZi5jYWNoZUxpc3QuY2xlYXIoKTtcblxuICAgICAgICAgIGlmIChkZWx0YSkge1xuICAgICAgICAgICAgc2VsZi52ZWxvY2l0eS54ID0gZGVsdGEueDtcbiAgICAgICAgICAgIHNlbGYudmVsb2NpdHkueSA9IGRlbHRhLnk7XG5cbiAgICAgICAgICAgIHNlbGYuZmxhcmUoJ2ZsaWNrc3RhcnQnLCB7XG4gICAgICAgICAgICAgIGRpcmVjdGlvbjogZGVsdGEubm9ybWFsaXplKCksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzZWxmLmZsYXJlKCdmbGlja2NhbmNlbCcpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIHNlbGYuZmxhcmUoJ2ZsaWNrJyk7XG4gICAgICAgICAgLy8gc2VsZi5mbGFyZSgnZmxpY2tlbmQnKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgIGlmICghdGhpcy50YXJnZXQpIHJldHVybiA7XG5cbiAgICAgIHRoaXMudmVsb2NpdHkueCAqPSB0aGlzLmZyaWN0aW9uO1xuICAgICAgdGhpcy52ZWxvY2l0eS55ICo9IHRoaXMuZnJpY3Rpb247XG5cbiAgICAgIGlmICh0aGlzLmhvcml6b250YWwpIHtcbiAgICAgICAgdGhpcy50YXJnZXQucG9zaXRpb24ueCArPSB0aGlzLnZlbG9jaXR5Lng7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy52ZXJ0aWNhbCkge1xuICAgICAgICB0aGlzLnRhcmdldC5wb3NpdGlvbi55ICs9IHRoaXMudmVsb2NpdHkueTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgY2FuY2VsOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMudGFyZ2V0LnggPSB0aGlzLmluaXRpYWxQb3NpdGlvbi54O1xuICAgICAgdGhpcy50YXJnZXQueSA9IHRoaXMuaW5pdGlhbFBvc2l0aW9uLnk7XG4gICAgICB0aGlzLnZlbG9jaXR5LnNldCgwLCAwKTtcblxuICAgICAgLy8gVE9ETzogXG4gICAgICAvLyB0aGlzLnNldEludGVyYWN0aXZlKGZhbHNlKTtcbiAgICAgIC8vIHRoaXMudHdlZW5lci5jbGVhcigpXG4gICAgICAvLyAgICAgLm1vdmUodGhpcy5pbml0aWFsWCwgdGhpcy5pbml0aWFsWSwgNTAwLCBcImVhc2VPdXRFbGFzdGljXCIpXG4gICAgICAvLyAgICAgLmNhbGwoZnVuY3Rpb24gKCkge1xuICAgICAgLy8gICAgICAgICB0aGlzLnNldEludGVyYWN0aXZlKHRydWUpO1xuICAgICAgLy8gICAgICAgICB0aGlzLmZpcmUodG0uZXZlbnQuRXZlbnQoXCJiYWNrZW5kXCIpKTtcbiAgICAgIC8vICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG5cbiAgICBlbmFibGU6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5fZW5hYmxlID0gdHJ1ZTtcbiAgICB9LFxuXG4gIH0pO1xuXG4gIHBoaW5hLmFwcC5FbGVtZW50LnByb3RvdHlwZS5nZXR0ZXIoJ2ZsaWNrYWJsZScsIGZ1bmN0aW9uKCkge1xuICAgIGlmICghdGhpcy5fZmxpY2thYmxlKSB7XG4gICAgICB0aGlzLl9mbGlja2FibGUgPSBwaGluYS5hY2Nlc3NvcnkuRmxpY2thYmxlKCkuYXR0YWNoVG8odGhpcyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9mbGlja2FibGU7XG4gIH0pO1xuICBcbn0pO1xuLypcbiAqIGZyYW1lYW5pbWF0aW9uLmpzXG4gKi9cblxuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5hY2Nlc3NvcnkuRnJhbWVBbmltYXRpb25cbiAgICogRnJhbWVBbmltYXRpb25cbiAgICogQGV4dGVuZHMgcGhpbmEuYWNjZXNzb3J5LkFjY2Vzc29yeVxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5hY2Nlc3NvcnkuRnJhbWVBbmltYXRpb24nLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmFjY2Vzc29yeS5BY2Nlc3NvcnknLFxuXG4gICAgLyoqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgaW5pdDogZnVuY3Rpb24oc3MpIHtcbiAgICAgIHRoaXMuc3VwZXJJbml0KCk7XG5cbiAgICAgIHRoaXMuc3MgPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCdzcHJpdGVzaGVldCcsIHNzKTtcbiAgICAgIHRoaXMucGF1c2VkID0gdHJ1ZTtcbiAgICAgIHRoaXMuZmluaXNoZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMuZml0ID0gdHJ1ZTtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLnBhdXNlZCkgcmV0dXJuIDtcbiAgICAgIGlmICghdGhpcy5jdXJyZW50QW5pbWF0aW9uKSByZXR1cm4gO1xuXG4gICAgICBpZiAodGhpcy5maW5pc2hlZCkge1xuICAgICAgICB0aGlzLmZpbmlzaGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY3VycmVudEZyYW1lSW5kZXggPSAwO1xuICAgICAgICByZXR1cm4gO1xuICAgICAgfVxuXG4gICAgICArK3RoaXMuZnJhbWU7XG4gICAgICBpZiAodGhpcy5mcmFtZSV0aGlzLmN1cnJlbnRBbmltYXRpb24uZnJlcXVlbmN5ID09PSAwKSB7XG4gICAgICAgICsrdGhpcy5jdXJyZW50RnJhbWVJbmRleDtcbiAgICAgICAgdGhpcy5fdXBkYXRlRnJhbWUoKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgZ290b0FuZFBsYXk6IGZ1bmN0aW9uKG5hbWUsIGtlZXApIHtcbiAgICAgIGtlZXAgPSAoa2VlcCAhPT0gdW5kZWZpbmVkKSA/IGtlZXAgOiB0cnVlO1xuICAgICAgaWYgKGtlZXAgJiYgbmFtZSA9PT0gdGhpcy5jdXJyZW50QW5pbWF0aW9uTmFtZVxuICAgICAgICAgICAgICAgJiYgdGhpcy5jdXJyZW50RnJhbWVJbmRleCA8IHRoaXMuY3VycmVudEFuaW1hdGlvbi5mcmFtZXMubGVuZ3RoXG4gICAgICAgICAgICAgICAmJiAhdGhpcy5wYXVzZWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9XG4gICAgICB0aGlzLmN1cnJlbnRBbmltYXRpb25OYW1lID0gbmFtZTtcbiAgICAgIHRoaXMuZnJhbWUgPSAwO1xuICAgICAgdGhpcy5jdXJyZW50RnJhbWVJbmRleCA9IDA7XG4gICAgICB0aGlzLmN1cnJlbnRBbmltYXRpb24gPSB0aGlzLnNzLmdldEFuaW1hdGlvbihuYW1lKTtcbiAgICAgIHRoaXMuX3VwZGF0ZUZyYW1lKCk7XG5cbiAgICAgIHRoaXMucGF1c2VkID0gZmFsc2U7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBnb3RvQW5kU3RvcDogZnVuY3Rpb24obmFtZSkge1xuICAgICAgdGhpcy5jdXJyZW50QW5pbWF0aW9uTmFtZSA9IG5hbWU7XG4gICAgICB0aGlzLmZyYW1lID0gMDtcbiAgICAgIHRoaXMuY3VycmVudEZyYW1lSW5kZXggPSAwO1xuICAgICAgdGhpcy5jdXJyZW50QW5pbWF0aW9uID0gdGhpcy5zcy5nZXRBbmltYXRpb24obmFtZSk7XG4gICAgICB0aGlzLl91cGRhdGVGcmFtZSgpO1xuXG4gICAgICB0aGlzLnBhdXNlZCA9IHRydWU7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBfdXBkYXRlRnJhbWU6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGFuaW0gPSB0aGlzLmN1cnJlbnRBbmltYXRpb247XG4gICAgICBpZiAoYW5pbSkge1xuICAgICAgICBpZiAodGhpcy5jdXJyZW50RnJhbWVJbmRleCA+PSBhbmltLmZyYW1lcy5sZW5ndGgpIHtcbiAgICAgICAgICBpZiAoYW5pbS5uZXh0KSB7XG4gICAgICAgICAgICB0aGlzLmdvdG9BbmRQbGF5KGFuaW0ubmV4dCk7XG4gICAgICAgICAgICByZXR1cm4gO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucGF1c2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuZmluaXNoZWQgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdmFyIGluZGV4ID0gYW5pbS5mcmFtZXNbdGhpcy5jdXJyZW50RnJhbWVJbmRleF07XG4gICAgICB2YXIgZnJhbWUgPSB0aGlzLnNzLmdldEZyYW1lKGluZGV4KTtcbiAgICAgIHRoaXMudGFyZ2V0LnNyY1JlY3Quc2V0KGZyYW1lLngsIGZyYW1lLnksIGZyYW1lLndpZHRoLCBmcmFtZS5oZWlnaHQpO1xuXG4gICAgICBpZiAodGhpcy5maXQpIHtcbiAgICAgICAgdGhpcy50YXJnZXQud2lkdGggPSBmcmFtZS53aWR0aDtcbiAgICAgICAgdGhpcy50YXJnZXQuaGVpZ2h0ID0gZnJhbWUuaGVpZ2h0O1xuICAgICAgfVxuICAgIH0sXG4gIH0pO1xufSk7XG4vKlxuICpcbiAqL1xuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmFjY2Vzc29yeS5QaHlzaWNhbFxuICAgKiDmnKznianjgafjga/jgarjgYTjga7jgaflkI3liY3lpInjgYjjgovjgYvjgoJcbiAgICogRmFrZVBoeXNpY2FsIG9yIE1hcmlvUGh5c2ljYWwgb3IgTGllUGh5c2ljYWxcbiAgICogUmV0cm9QeXNpY2FsIG9yIFB5c2ljYUxpa2VcbiAgICogQGV4dGVuZHMgcGhpbmEuYWNjZXNzb3J5LkFjY2Vzc29yeVxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5hY2Nlc3NvcnkuUGh5c2ljYWwnLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmFjY2Vzc29yeS5BY2Nlc3NvcnknLFxuXG4gICAgLyoqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgaW5pdDogZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICB0aGlzLnN1cGVySW5pdCh0YXJnZXQpO1xuXG4gICAgICB0aGlzLnZlbG9jaXR5ID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDAsIDApO1xuICAgICAgdGhpcy5ncmF2aXR5ID0gcGhpbmEuZ2VvbS5WZWN0b3IyKDAsIDApO1xuXG4gICAgICB0aGlzLmZyaWN0aW9uID0gMS4wO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHQgPSB0aGlzLnRhcmdldDtcblxuICAgICAgdGhpcy52ZWxvY2l0eS54ICo9IHRoaXMuZnJpY3Rpb247XG4gICAgICB0aGlzLnZlbG9jaXR5LnkgKj0gdGhpcy5mcmljdGlvbjtcblxuICAgICAgdGhpcy52ZWxvY2l0eS54ICs9IHRoaXMuZ3Jhdml0eS54O1xuICAgICAgdGhpcy52ZWxvY2l0eS55ICs9IHRoaXMuZ3Jhdml0eS55O1xuXG4gICAgICB0LnBvc2l0aW9uLnggKz0gdGhpcy52ZWxvY2l0eS54O1xuICAgICAgdC5wb3NpdGlvbi55ICs9IHRoaXMudmVsb2NpdHkueTtcbiAgICB9LFxuXG4gICAgZm9yY2U6IGZ1bmN0aW9uKHgsIHkpIHtcbiAgICAgIHRoaXMudmVsb2NpdHkuc2V0KHgsIHkpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIGFkZEZvcmNlOiBmdW5jdGlvbih4LCB5KSB7XG4gICAgICB0aGlzLnZlbG9jaXR5LnggKz0geDtcbiAgICAgIHRoaXMudmVsb2NpdHkueSArPSB5O1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIHNldEdyYXZpdHk6IGZ1bmN0aW9uKHgsIHkpIHtcbiAgICAgIHRoaXMuZ3Jhdml0eS5zZXQoeCwgeSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgc2V0RnJpY3Rpb246IGZ1bmN0aW9uKGZyKSB7XG4gICAgICB0aGlzLmZyaWN0aW9uID0gZnI7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICB9KTtcblxuICBwaGluYS5hcHAuRWxlbWVudC5wcm90b3R5cGUuZ2V0dGVyKCdwaHlzaWNhbCcsIGZ1bmN0aW9uKCkge1xuICAgIGlmICghdGhpcy5fcGh5c2ljYWwpIHtcbiAgICAgIHRoaXMuX3BoeXNpY2FsID0gcGhpbmEuYWNjZXNzb3J5LlBoeXNpY2FsKCkuYXR0YWNoVG8odGhpcyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9waHlzaWNhbDtcbiAgfSk7XG5cblxufSk7XG5cblxuXG5cblxuKGZ1bmN0aW9uKCkge1xuXG4gIGlmICghcGhpbmEuZ2xvYmFsLkV2ZW50KSByZXR1cm4gO1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgZ2xvYmFsLkV2ZW50XG4gICAqIOaXouWtmOOBrkV2ZW5044Kq44OW44K444Kn44Kv44OI5ouh5by1XG4gICAqL1xuICAgIFxuICAvKipcbiAgICogQG1ldGhvZCBzdG9wXG4gICAqIOOCpOODmeODs+ODiOOBruODh+ODleOCqeODq+ODiOWHpueQhiAmIOS8nemBlOOCkuatouOCgeOCi1xuICAgKi9cbiAgRXZlbnQucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbigpIHtcbiAgICAvLyDjgqTjg5njg7Pjg4jjgq3jg6Pjg7Pjgrvjg6tcbiAgICB0aGlzLnByZXZlbnREZWZhdWx0KCk7XG4gICAgLy8g44Kk44OZ44Oz44OI5Lyd6YGU44KS5q2i44KB44KLXG4gICAgdGhpcy5zdG9wUHJvcGFnYXRpb24oKTtcbiAgfTtcblxufSkoKTtcblxuKGZ1bmN0aW9uKCkge1xuXG4gIGlmICghcGhpbmEuZ2xvYmFsLk1vdXNlRXZlbnQpIHJldHVybiA7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBnbG9iYWwuTW91c2VFdmVudFxuICAgKiBNb3VzZUV2ZW50IOOCr+ODqeOCuVxuICAgKi9cbiAgXG4gIC8qKlxuICAgKiBAbWV0aG9kICAgIHBvaW50WFxuICAgKiDjg57jgqbjgrnjga5Y5bqn5qiZLlxuICAgKi9cbiAgTW91c2VFdmVudC5wcm90b3R5cGUuZ2V0dGVyKFwicG9pbnRYXCIsIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmNsaWVudFggLSB0aGlzLnRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0O1xuICAgIC8vIHJldHVybiB0aGlzLnBhZ2VYIC0gdGhpcy50YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCAtIHdpbmRvdy5zY3JvbGxYO1xuICB9KTtcbiAgXG4gIC8qKlxuICAgKiBAbWV0aG9kICAgIHBvaW50WVxuICAgKiDjg57jgqbjgrnjga5Z5bqn5qiZLlxuICAgKi9cbiAgTW91c2VFdmVudC5wcm90b3R5cGUuZ2V0dGVyKFwicG9pbnRZXCIsIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmNsaWVudFkgLSB0aGlzLnRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3A7XG4gICAgLy8gcmV0dXJuIHRoaXMucGFnZVkgLSB0aGlzLnRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3AgLSB3aW5kb3cuc2Nyb2xsWTtcbiAgfSk7XG4gICAgXG59KSgpO1xuXG5cbihmdW5jdGlvbigpIHtcbiAgICBcbiAgaWYgKCFwaGluYS5nbG9iYWwuVG91Y2hFdmVudCkgcmV0dXJuIDtcbiAgXG4gIFxuICAvKipcbiAgICogQGNsYXNzIGdsb2JhbC5Ub3VjaEV2ZW50XG4gICAqIFRvdWNoRXZlbnQg44Kv44Op44K5XG4gICAqL1xuICBcbiAgLyoqXG4gICAqIEBtZXRob2QgICAgcG9pbnRYXG4gICAqIOOCv+ODg+ODgeOCpOODmeODs+ODiC5cbiAgICovXG4gIFRvdWNoRXZlbnQucHJvdG90eXBlLmdldHRlcihcInBvaW50WFwiLCBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLnRvdWNoZXNbMF0uY2xpZW50WCAtIHRoaXMudGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQ7XG4gICAgICAvLyByZXR1cm4gdGhpcy50b3VjaGVzWzBdLnBhZ2VYIC0gdGhpcy50YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCAtIHRtLmdsb2JhbC5zY3JvbGxYO1xuICB9KTtcbiAgXG4gIC8qKlxuICAgKiBAbWV0aG9kICAgIHBvaW50WVxuICAgKiDjgr/jg4Pjg4HjgqTjg5njg7Pjg4guXG4gICAqL1xuICBUb3VjaEV2ZW50LnByb3RvdHlwZS5nZXR0ZXIoXCJwb2ludFlcIiwgZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy50b3VjaGVzWzBdLmNsaWVudFkgLSB0aGlzLnRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3A7XG4gICAgICAvLyByZXR1cm4gdGhpcy50b3VjaGVzWzBdLnBhZ2VZIC0gdGhpcy50YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wIC0gdG0uZ2xvYmFsLnNjcm9sbFk7XG4gIH0pOyAgXG4gICAgXG59KSgpO1xuXG5cbihmdW5jdGlvbigpIHtcbiAgICBcbiAgaWYgKCFwaGluYS5nbG9iYWwuVG91Y2gpIHJldHVybiA7XG4gIFxuICAvKipcbiAgICogQGNsYXNzIGdsb2JhbC5Ub3VjaFxuICAgKiBUb3VjaEV2ZW50IOOCr+ODqeOCuVxuICAgKi9cbiAgXG4gIC8qKlxuICAgKiBAbWV0aG9kICAgIHBvaW50WFxuICAgKiDjgr/jg4Pjg4HjgqTjg5njg7Pjg4guXG4gICAqL1xuICBUb3VjaC5wcm90b3R5cGUuZ2V0dGVyKFwicG9pbnRYXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuY2xpZW50WCAtIHRoaXMudGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQ7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kICAgIHBvaW50WVxuICAgKiDjgr/jg4Pjg4HjgqTjg5njg7Pjg4guXG4gICAqL1xuICBUb3VjaC5wcm90b3R5cGUuZ2V0dGVyKFwicG9pbnRZXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuY2xpZW50WSAtIHRoaXMudGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcbiAgfSk7XG4gICAgXG59KSgpO1xuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmdyYXBoaWNzLkNhbnZhc1xuICAgKiDjgq3jg6Pjg7Pjg5Djgrnmi6HlvLXjgq/jg6njgrlcbiAgICovXG4gIHBoaW5hLmRlZmluZSgncGhpbmEuZ3JhcGhpY3MuQ2FudmFzJywge1xuICAgIGRvbUVsZW1lbnQ6IG51bGwsXG4gICAgY2FudmFzOiBudWxsLFxuICAgIGNvbnRleHQ6IG51bGwsXG5cbiAgICAvKipcbiAgICAgKiDliJ3mnJ/ljJZcbiAgICAgKi9cbiAgICBpbml0OiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICAgIGlmICh0eXBlb2YgY2FudmFzID09PSAnc3RyaW5nJykge1xuICAgICAgICB0aGlzLmNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY2FudmFzKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLmNhbnZhcyA9IGNhbnZhcyB8fCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5kb21FbGVtZW50ID0gdGhpcy5jYW52YXM7XG4gICAgICB0aGlzLmNvbnRleHQgPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgdGhpcy5jb250ZXh0LmxpbmVDYXAgPSAncm91bmQnO1xuICAgICAgdGhpcy5jb250ZXh0LmxpbmVKb2luID0gJ3JvdW5kJztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog44K144Kk44K644KS44K744OD44OIXG4gICAgICovXG4gICAgc2V0U2l6ZTogZnVuY3Rpb24od2lkdGgsIGhlaWdodCkge1xuICAgICAgdGhpcy5jYW52YXMud2lkdGggICA9IHdpZHRoO1xuICAgICAgdGhpcy5jYW52YXMuaGVpZ2h0ICA9IGhlaWdodDtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBzZXRTaXplVG9TY3JlZW46IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5jYW52YXMuc3R5bGUucG9zaXRpb24gID0gXCJmaXhlZFwiO1xuICAgICAgdGhpcy5jYW52YXMuc3R5bGUubWFyZ2luICAgID0gXCIwcHhcIjtcbiAgICAgIHRoaXMuY2FudmFzLnN0eWxlLnBhZGRpbmcgICA9IFwiMHB4XCI7XG4gICAgICB0aGlzLmNhbnZhcy5zdHlsZS5sZWZ0ICAgICAgPSBcIjBweFwiO1xuICAgICAgdGhpcy5jYW52YXMuc3R5bGUudG9wICAgICAgID0gXCIwcHhcIjtcbiAgICAgIHJldHVybiB0aGlzLnNldFNpemUod2luZG93LmlubmVyV2lkdGgsIHdpbmRvdy5pbm5lckhlaWdodCk7XG4gICAgfSxcblxuICAgIGZpdFNjcmVlbjogZnVuY3Rpb24oaXNFdmVyKSB7XG4gICAgICBpc0V2ZXIgPSBpc0V2ZXIgPT09IHVuZGVmaW5lZCA/IHRydWUgOiBpc0V2ZXI7XG5cbiAgICAgIHZhciBfZml0RnVuYyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgZSA9IHRoaXMuZG9tRWxlbWVudDtcbiAgICAgICAgdmFyIHMgPSBlLnN0eWxlO1xuICAgICAgICBcbiAgICAgICAgcy5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICAgICAgcy5tYXJnaW4gPSBcImF1dG9cIjtcbiAgICAgICAgcy5sZWZ0ID0gXCIwcHhcIjtcbiAgICAgICAgcy50b3AgID0gXCIwcHhcIjtcbiAgICAgICAgcy5ib3R0b20gPSBcIjBweFwiO1xuICAgICAgICBzLnJpZ2h0ID0gXCIwcHhcIjtcblxuICAgICAgICB2YXIgcmF0ZVdpZHRoID0gZS53aWR0aC93aW5kb3cuaW5uZXJXaWR0aDtcbiAgICAgICAgdmFyIHJhdGVIZWlnaHQ9IGUuaGVpZ2h0L3dpbmRvdy5pbm5lckhlaWdodDtcbiAgICAgICAgdmFyIHJhdGUgPSBlLmhlaWdodC9lLndpZHRoO1xuICAgICAgICBcbiAgICAgICAgaWYgKHJhdGVXaWR0aCA+IHJhdGVIZWlnaHQpIHtcbiAgICAgICAgICBzLndpZHRoICA9IE1hdGguZmxvb3IoaW5uZXJXaWR0aCkrXCJweFwiO1xuICAgICAgICAgIHMuaGVpZ2h0ID0gTWF0aC5mbG9vcihpbm5lcldpZHRoKnJhdGUpK1wicHhcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBzLndpZHRoICA9IE1hdGguZmxvb3IoaW5uZXJIZWlnaHQvcmF0ZSkrXCJweFwiO1xuICAgICAgICAgIHMuaGVpZ2h0ID0gTWF0aC5mbG9vcihpbm5lckhlaWdodCkrXCJweFwiO1xuICAgICAgICB9XG4gICAgICB9LmJpbmQodGhpcyk7XG4gICAgICBcbiAgICAgIC8vIOS4gOW6puWun+ihjOOBl+OBpuOBiuOBj1xuICAgICAgX2ZpdEZ1bmMoKTtcblxuICAgICAgLy8g44Oq44K144Kk44K65pmC44Gu44Oq44K544OK44Go44GX44Gm55m76Yyy44GX44Gm44GK44GPXG4gICAgICBpZiAoaXNFdmVyKSB7XG4gICAgICAgIHBoaW5hLmdsb2JhbC5hZGRFdmVudExpc3RlbmVyKFwicmVzaXplXCIsIF9maXRGdW5jLCBmYWxzZSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOOCr+ODquOColxuICAgICAqL1xuICAgIGNsZWFyOiBmdW5jdGlvbih4LCB5LCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICB4ID0geCB8fCAwO1xuICAgICAgeSA9IHkgfHwgMDtcbiAgICAgIHdpZHRoID0gd2lkdGggfHwgdGhpcy53aWR0aDtcbiAgICAgIGhlaWdodD0gaGVpZ2h0fHwgdGhpcy5oZWlnaHQ7XG4gICAgICB0aGlzLmNvbnRleHQuY2xlYXJSZWN0KHgsIHksIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIGNsZWFyQ29sb3I6IGZ1bmN0aW9uKGZpbGxTdHlsZSwgeCwgeSwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgeCA9IHggfHwgMDtcbiAgICAgIHkgPSB5IHx8IDA7XG4gICAgICB3aWR0aCA9IHdpZHRoIHx8IHRoaXMud2lkdGg7XG4gICAgICBoZWlnaHQ9IGhlaWdodHx8IHRoaXMuaGVpZ2h0O1xuXG4gICAgICB2YXIgY29udGV4dCA9IHRoaXMuY29udGV4dDtcblxuICAgICAgY29udGV4dC5zYXZlKCk7XG4gICAgICBjb250ZXh0LnNldFRyYW5zZm9ybSgxLjAsIDAuMCwgMC4wLCAxLjAsIDAuMCwgMC4wKTsgLy8g6KGM5YiX5Yid5pyf5YyWXG4gICAgICBjb250ZXh0LmZpbGxTdHlsZSA9IGZpbGxTdHlsZTsgICAgIC8vIOWhl+OCiuOBpOOBtuOBl+OCueOCv+OCpOODq+OCu+ODg+ODiFxuICAgICAgY29udGV4dC5maWxsUmVjdCh4LCB5LCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgIGNvbnRleHQucmVzdG9yZSgpO1xuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG5cbiAgICAvKipcbiAgICAgKiDjg5HjgrnjgpLplovlp4so44Oq44K744OD44OIKVxuICAgICAqL1xuICAgIGJlZ2luUGF0aDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmNvbnRleHQuYmVnaW5QYXRoKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogIOODkeOCueOCkumWieOBmOOCi1xuICAgICAqL1xuICAgIGNsb3NlUGF0aDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmNvbnRleHQuY2xvc2VQYXRoKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG5cbiAgICAvKipcbiAgICAgKiAg5paw6KaP44OR44K555Sf5oiQXG4gICAgICovXG4gICAgbW92ZVRvOiBmdW5jdGlvbih4LCB5KSB7XG4gICAgICB0aGlzLmNvbnRleHQubW92ZVRvKHgsIHkpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOODkeOCueOBq+i/veWKoFxuICAgICAqL1xuICAgIGxpbmVUbzogZnVuY3Rpb24oeCwgeSkge1xuICAgICAgdGhpcy5jb250ZXh0LmxpbmVUbyh4LCB5KTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBxdWFkcmF0aWNDdXJ2ZVRvOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuY29udGV4dC5xdWFkcmF0aWNDdXJ2ZVRvLmFwcGx5KHRoaXMuY29udGV4dCwgYXJndW1lbnRzKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBiZXppZXJDdXJ2ZVRvOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuY29udGV4dC5iZXppZXJDdXJ2ZVRvLmFwcGx5KHRoaXMuY29udGV4dCwgYXJndW1lbnRzKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDjg5HjgrnlhoXjgpLloZfjgorjgaTjgbbjgZlcbiAgICAgKi9cbiAgICBmaWxsOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuY29udGV4dC5maWxsKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog44OR44K55LiK44Gr44Op44Kk44Oz44KS5byV44GPXG4gICAgICovXG4gICAgc3Ryb2tlOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuY29udGV4dC5zdHJva2UoKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDjgq/jg6rjg4Pjg5dcbiAgICAgKi9cbiAgICBjbGlwOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuY29udGV4dC5jbGlwKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgICAgIFxuICAgIC8qKlxuICAgICAqIOeCueaPj+eUu1xuICAgICAqL1xuICAgIGRyYXdQb2ludDogZnVuY3Rpb24oeCwgeSkge1xuICAgICAgcmV0dXJuIHRoaXMuc3Ryb2tlUmVjdCh4LCB5LCAxLCAxKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog44Op44Kk44Oz44OR44K544KS5L2c5oiQXG4gICAgICovXG4gICAgbGluZTogZnVuY3Rpb24oeDAsIHkwLCB4MSwgeTEpIHtcbiAgICAgIHJldHVybiB0aGlzLm1vdmVUbyh4MCwgeTApLmxpbmVUbyh4MSwgeTEpO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICog44Op44Kk44Oz44KS5o+P55S7XG4gICAgICovXG4gICAgZHJhd0xpbmU6IGZ1bmN0aW9uKHgwLCB5MCwgeDEsIHkxKSB7XG4gICAgICByZXR1cm4gdGhpcy5iZWdpblBhdGgoKS5saW5lKHgwLCB5MCwgeDEsIHkxKS5zdHJva2UoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog44OA44OD44K344Ol44Op44Kk44Oz44KS5o+P55S7XG4gICAgICovXG4gICAgZHJhd0Rhc2hMaW5lOiBmdW5jdGlvbih4MCwgeTAsIHgxLCB5MSwgcGF0dGVybikge1xuICAgICAgdmFyIHBhdHRlcm5UYWJsZSA9IG51bGw7XG4gICAgICBpZiAodHlwZW9mKHBhdHRlcm4pID09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgcGF0dGVyblRhYmxlID0gcGF0dGVybjtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBwYXR0ZXJuID0gcGF0dGVybiB8fCAweGYwZjA7XG4gICAgICAgIHBhdHRlcm5UYWJsZSA9IHBhdHRlcm4udG9TdHJpbmcoMik7XG4gICAgICB9XG4gICAgICBwYXR0ZXJuVGFibGUgPSBwYXR0ZXJuVGFibGUucGFkZGluZygxNiwgJzEnKTtcbiAgICAgIFxuICAgICAgdmFyIHZ4ID0geDEteDA7XG4gICAgICB2YXIgdnkgPSB5MS15MDtcbiAgICAgIHZhciBsZW4gPSBNYXRoLnNxcnQodngqdnggKyB2eSp2eSk7XG4gICAgICB2eC89bGVuOyB2eS89bGVuO1xuICAgICAgXG4gICAgICB2YXIgeCA9IHgwO1xuICAgICAgdmFyIHkgPSB5MDtcbiAgICAgIGZvciAodmFyIGk9MDsgaTxsZW47ICsraSkge1xuICAgICAgICBpZiAocGF0dGVyblRhYmxlW2klMTZdID09ICcxJykge1xuICAgICAgICAgIHRoaXMuZHJhd1BvaW50KHgsIHkpO1xuICAgICAgICAgIC8vIHRoaXMuZmlsbFJlY3QoeCwgeSwgdGhpcy5jb250ZXh0LmxpbmVXaWR0aCwgdGhpcy5jb250ZXh0LmxpbmVXaWR0aCk7XG4gICAgICAgIH1cbiAgICAgICAgeCArPSB2eDtcbiAgICAgICAgeSArPSB2eTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIHYwKHgwLCB5MCksIHYxKHgxLCB5MSkg44GL44KJ6KeS5bqm44KS5rGC44KB44Gm55+i5Y2w44KS5o+P55S7XG4gICAgICogaHR0cDovL2hha3VoaW4uanAvYXMvcm90YXRpb24uaHRtbFxuICAgICAqL1xuICAgIGRyYXdBcnJvdzogZnVuY3Rpb24oeDAsIHkwLCB4MSwgeTEsIGFycm93UmFkaXVzKSB7XG4gICAgICB2YXIgdnggPSB4MS14MDtcbiAgICAgIHZhciB2eSA9IHkxLXkwO1xuICAgICAgdmFyIGFuZ2xlID0gTWF0aC5hdGFuMih2eSwgdngpKjE4MC9NYXRoLlBJO1xuICAgICAgXG4gICAgICB0aGlzLmRyYXdMaW5lKHgwLCB5MCwgeDEsIHkxKTtcbiAgICAgIHRoaXMuZmlsbFBvbHlnb24oeDEsIHkxLCBhcnJvd1JhZGl1cyB8fCA1LCAzLCBhbmdsZSk7XG4gICAgICBcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cblxuICAgIC8qKlxuICAgICAqIGxpbmVzXG4gICAgICovXG4gICAgbGluZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5tb3ZlVG8oYXJndW1lbnRzWzBdLCBhcmd1bWVudHNbMV0pO1xuICAgICAgZm9yICh2YXIgaT0xLGxlbj1hcmd1bWVudHMubGVuZ3RoLzI7IGk8bGVuOyArK2kpIHtcbiAgICAgICAgdGhpcy5saW5lVG8oYXJndW1lbnRzW2kqMl0sIGFyZ3VtZW50c1tpKjIrMV0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOODqeOCpOODs+OCueODiOODreODvOOCr+aPj+eUu1xuICAgICAqL1xuICAgIHN0cm9rZUxpbmVzOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuYmVnaW5QYXRoKCk7XG4gICAgICB0aGlzLmxpbmVzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB0aGlzLnN0cm9rZSgpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOODqeOCpOODs+Whl+OCiuOBpOOBtuOBl+aPj+eUu1xuICAgICAqL1xuICAgIGZpbGxMaW5lczogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmJlZ2luUGF0aCgpO1xuICAgICAgdGhpcy5saW5lcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgdGhpcy5maWxsKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIOWbm+inkuW9ouODkeOCueOCkuS9nOaIkOOBmeOCi1xuICAgICAqL1xuICAgIHJlY3Q6IGZ1bmN0aW9uKHgsIHksIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgIHRoaXMuY29udGV4dC5yZWN0LmFwcGx5KHRoaXMuY29udGV4dCwgYXJndW1lbnRzKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICog5Zub6KeS5b2i5aGX44KK44Gk44G244GX5o+P55S7XG4gICAgICovXG4gICAgZmlsbFJlY3Q6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5jb250ZXh0LmZpbGxSZWN0LmFwcGx5KHRoaXMuY29udGV4dCwgYXJndW1lbnRzKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICog5Zub6KeS5b2i44Op44Kk44Oz5o+P55S7XG4gICAgICovXG4gICAgc3Ryb2tlUmVjdDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmNvbnRleHQuc3Ryb2tlUmVjdC5hcHBseSh0aGlzLmNvbnRleHQsIGFyZ3VtZW50cyk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIOinkuS4uOWbm+inkuW9ouODkeOCuVxuICAgICAqL1xuICAgIHJvdW5kUmVjdDogZnVuY3Rpb24oeCwgeSwgd2lkdGgsIGhlaWdodCwgcmFkaXVzKSB7XG4gICAgICB2YXIgbCA9IHggKyByYWRpdXM7XG4gICAgICB2YXIgciA9IHggKyB3aWR0aCAtIHJhZGl1cztcbiAgICAgIHZhciB0ID0geSArIHJhZGl1cztcbiAgICAgIHZhciBiID0geSArIGhlaWdodCAtIHJhZGl1cztcbiAgICAgIFxuICAgICAgLypcbiAgICAgIHZhciBjdHggPSB0aGlzLmNvbnRleHQ7XG4gICAgICBjdHgubW92ZVRvKGwsIHkpO1xuICAgICAgY3R4LmxpbmVUbyhyLCB5KTtcbiAgICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKHgrd2lkdGgsIHksIHgrd2lkdGgsIHQpO1xuICAgICAgY3R4LmxpbmVUbyh4K3dpZHRoLCBiKTtcbiAgICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKHgrd2lkdGgsIHkraGVpZ2h0LCByLCB5K2hlaWdodCk7XG4gICAgICBjdHgubGluZVRvKGwsIHkraGVpZ2h0KTtcbiAgICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKHgsIHkraGVpZ2h0LCB4LCBiKTtcbiAgICAgIGN0eC5saW5lVG8oeCwgdCk7XG4gICAgICBjdHgucXVhZHJhdGljQ3VydmVUbyh4LCB5LCBsLCB5KTtcbiAgICAgIC8qKi9cbiAgICAgIFxuICAgICAgdGhpcy5jb250ZXh0LmFyYyhsLCB0LCByYWRpdXMsICAgICAtTWF0aC5QSSwgLU1hdGguUEkqMC41LCBmYWxzZSk7ICAvLyDlt6bkuIpcbiAgICAgIHRoaXMuY29udGV4dC5hcmMociwgdCwgcmFkaXVzLCAtTWF0aC5QSSowLjUsICAgICAgICAgICAgMCwgZmFsc2UpOyAgLy8g5Y+z5LiKXG4gICAgICB0aGlzLmNvbnRleHQuYXJjKHIsIGIsIHJhZGl1cywgICAgICAgICAgICAwLCAgTWF0aC5QSSowLjUsIGZhbHNlKTsgIC8vIOWPs+S4i1xuICAgICAgdGhpcy5jb250ZXh0LmFyYyhsLCBiLCByYWRpdXMsICBNYXRoLlBJKjAuNSwgICAgICBNYXRoLlBJLCBmYWxzZSk7ICAvLyDlt6bkuItcbiAgICAgIHRoaXMuY2xvc2VQYXRoKCk7XG4gICAgICBcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDop5LkuLjlm5vop5LlvaLloZfjgorjgaTjgbbjgZdcbiAgICAgKi9cbiAgICBmaWxsUm91bmRSZWN0OiBmdW5jdGlvbih4LCB5LCB3aWR0aCwgaGVpZ2h0LCByYWRpdXMpIHtcbiAgICAgIHJldHVybiB0aGlzLmJlZ2luUGF0aCgpLnJvdW5kUmVjdCh4LCB5LCB3aWR0aCwgaGVpZ2h0LCByYWRpdXMpLmZpbGwoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog6KeS5Li45Zub6KeS5b2i44K544OI44Ot44O844Kv5o+P55S7XG4gICAgICovXG4gICAgc3Ryb2tlUm91bmRSZWN0OiBmdW5jdGlvbih4LCB5LCB3aWR0aCwgaGVpZ2h0LCByYWRpdXMpIHtcbiAgICAgIHJldHVybiB0aGlzLmJlZ2luUGF0aCgpLnJvdW5kUmVjdCh4LCB5LCB3aWR0aCwgaGVpZ2h0LCByYWRpdXMpLnN0cm9rZSgpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDlhobjga7jg5HjgrnjgpLoqK3lrppcbiAgICAgKi9cbiAgICBjaXJjbGU6IGZ1bmN0aW9uKHgsIHksIHJhZGl1cykge1xuICAgICAgdGhpcy5jb250ZXh0LmFyYyh4LCB5LCByYWRpdXMsIDAsIE1hdGguUEkqMiwgZmFsc2UpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiDloZfjgorjgaTjgbbjgZflhobjgpLmj4/nlLtcbiAgICAgKi9cbiAgICBmaWxsQ2lyY2xlOiBmdW5jdGlvbih4LCB5LCByYWRpdXMpIHtcbiAgICAgIHZhciBjID0gdGhpcy5jb250ZXh0O1xuICAgICAgYy5iZWdpblBhdGgoKTtcbiAgICAgIGMuYXJjKHgsIHksIHJhZGl1cywgMCwgTWF0aC5QSSoyLCBmYWxzZSk7XG4gICAgICBjLmNsb3NlUGF0aCgpO1xuICAgICAgYy5maWxsKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIOOCueODiOODreODvOOCr+WGhuOCkuaPj+eUu1xuICAgICAqL1xuICAgIHN0cm9rZUNpcmNsZTogZnVuY3Rpb24oeCwgeSwgcmFkaXVzKSB7XG4gICAgICB2YXIgYyA9IHRoaXMuY29udGV4dDtcbiAgICAgIGMuYmVnaW5QYXRoKCk7XG4gICAgICBjLmFyYyh4LCB5LCByYWRpdXMsIDAsIE1hdGguUEkqMiwgZmFsc2UpO1xuICAgICAgYy5jbG9zZVBhdGgoKTtcbiAgICAgIGMuc3Ryb2tlKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog5YaG5byn44Gu44OR44K544KS6Kit5a6aXG4gICAgICovXG4gICAgYXJjOiBmdW5jdGlvbih4LCB5LCByYWRpdXMsIHN0YXJ0QW5nbGUsIGVuZEFuZ2xlLCBhbnRpY2xvY2t3aXNlKSB7XG4gICAgICB0aGlzLmNvbnRleHQuYXJjKHgsIHksIHJhZGl1cywgc3RhcnRBbmdsZSwgZW5kQW5nbGUsIGFudGljbG9ja3dpc2UpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiDloZfjgorjgaTjgbbjgZflhoblvKfjgpLmj4/nlLtcbiAgICAgKi9cbiAgICBmaWxsQXJjOiBmdW5jdGlvbih4LCB5LCByYWRpdXMsIHN0YXJ0QW5nbGUsIGVuZEFuZ2xlLCBhbnRpY2xvY2t3aXNlKSB7XG4gICAgICByZXR1cm4gdGhpcy5iZWdpblBhdGgoKS5hcmMoeCwgeSwgcmFkaXVzLCBzdGFydEFuZ2xlLCBlbmRBbmdsZSwgYW50aWNsb2Nrd2lzZSkuZmlsbCgpO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICog44K544OI44Ot44O844Kv5YaG5byn44KS5o+P55S7XG4gICAgICovXG4gICAgc3Ryb2tlQXJjOiBmdW5jdGlvbih4LCB5LCByYWRpdXMsIHN0YXJ0QW5nbGUsIGVuZEFuZ2xlLCBhbnRpY2xvY2t3aXNlKSB7XG4gICAgICByZXR1cm4gdGhpcy5iZWdpblBhdGgoKS5hcmMoeCwgeSwgcmFkaXVzLCBzdGFydEFuZ2xlLCBlbmRBbmdsZSwgYW50aWNsb2Nrd2lzZSkuc3Ryb2tlKCk7XG4gICAgfSxcblxuXG4gICAgcGllOiBmdW5jdGlvbih4LCB5LCByYWRpdXMsIHN0YXJ0QW5nbGUsIGVuZEFuZ2xlLCBhbnRpY2xvY2t3aXNlKSB7XG4gICAgICB2YXIgY29udGV4dCA9IHRoaXMuY29udGV4dDtcbiAgICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7XG4gICAgICBjb250ZXh0Lm1vdmVUbygwLCAwKTtcbiAgICAgIGNvbnRleHQuYXJjKHgsIHksIHJhZGl1cywgc3RhcnRBbmdsZSwgZW5kQW5nbGUsIGFudGljbG9ja3dpc2UpO1xuICAgICAgY29udGV4dC5jbG9zZVBhdGgoKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgZmlsbFBpZTogZnVuY3Rpb24oeCwgeSwgcmFkaXVzLCBzdGFydEFuZ2xlLCBlbmRBbmdsZSwgYW50aWNsb2Nrd2lzZSkge1xuICAgICAgcmV0dXJuIHRoaXMuYmVnaW5QYXRoKCkucGllKHgsIHksIHJhZGl1cywgc3RhcnRBbmdsZSwgZW5kQW5nbGUsIGFudGljbG9ja3dpc2UpLmZpbGwoKTtcbiAgICB9LFxuICAgIHN0cm9rZVBpZTogZnVuY3Rpb24oeCwgeSwgcmFkaXVzLCBzdGFydEFuZ2xlLCBlbmRBbmdsZSwgYW50aWNsb2Nrd2lzZSkge1xuICAgICAgcmV0dXJuIHRoaXMuYmVnaW5QYXRoKCkucGllKHgsIHksIHJhZGl1cywgc3RhcnRBbmdsZSwgZW5kQW5nbGUsIGFudGljbG9ja3dpc2UpLnN0cm9rZSgpO1xuICAgIH0sXG5cbiAgICBcbiAgICAvKipcbiAgICAgKiDjg53jg6rjgrTjg7Pjg5HjgrlcbiAgICAgKi9cbiAgICBwb2x5Z29uOiBmdW5jdGlvbih4LCB5LCBzaXplLCBzaWRlcywgb2Zmc2V0QW5nbGUpIHtcbiAgICAgIHZhciByYWREaXYgPSAoTWF0aC5QSSoyKS9zaWRlcztcbiAgICAgIHZhciByYWRPZmZzZXQgPSAob2Zmc2V0QW5nbGUhPT11bmRlZmluZWQpID8gb2Zmc2V0QW5nbGUqTWF0aC5QSS8xODAgOiAtTWF0aC5QSS8yO1xuICAgICAgXG4gICAgICB0aGlzLm1vdmVUbyh4ICsgTWF0aC5jb3MocmFkT2Zmc2V0KSpzaXplLCB5ICsgTWF0aC5zaW4ocmFkT2Zmc2V0KSpzaXplKTtcbiAgICAgIGZvciAodmFyIGk9MTsgaTxzaWRlczsgKytpKSB7XG4gICAgICAgIHZhciByYWQgPSByYWREaXYqaStyYWRPZmZzZXQ7XG4gICAgICAgIHRoaXMubGluZVRvKFxuICAgICAgICAgIHggKyBNYXRoLmNvcyhyYWQpKnNpemUsXG4gICAgICAgICAgeSArIE1hdGguc2luKHJhZCkqc2l6ZVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgdGhpcy5jbG9zZVBhdGgoKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICog44Od44Oq44K044Oz5aGX44KK44Gk44G244GXXG4gICAgICovXG4gICAgZmlsbFBvbHlnb246IGZ1bmN0aW9uKHgsIHksIHJhZGl1cywgc2lkZXMsIG9mZnNldEFuZ2xlKSB7XG4gICAgICByZXR1cm4gdGhpcy5iZWdpblBhdGgoKS5wb2x5Z29uKHgsIHksIHJhZGl1cywgc2lkZXMsIG9mZnNldEFuZ2xlKS5maWxsKCk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiDjg53jg6rjgrTjg7Pjgrnjg4jjg63jg7zjgq/mj4/nlLtcbiAgICAgKi9cbiAgICBzdHJva2VQb2x5Z29uOiBmdW5jdGlvbih4LCB5LCByYWRpdXMsIHNpZGVzLCBvZmZzZXRBbmdsZSkge1xuICAgICAgcmV0dXJuIHRoaXMuYmVnaW5QYXRoKCkucG9seWdvbih4LCB5LCByYWRpdXMsIHNpZGVzLCBvZmZzZXRBbmdsZSkuc3Ryb2tlKCk7XG4gICAgfSxcbiAgICBcbiAgICAvKipcbiAgICAgKiBzdGFyXG4gICAgICovXG4gICAgc3RhcjogZnVuY3Rpb24oeCwgeSwgcmFkaXVzLCBzaWRlcywgc2lkZUluZGVudCwgb2Zmc2V0QW5nbGUpIHtcbiAgICAgIHZhciB4ID0geCB8fCAwO1xuICAgICAgdmFyIHkgPSB5IHx8IDA7XG4gICAgICB2YXIgcmFkaXVzID0gcmFkaXVzIHx8IDY0O1xuICAgICAgdmFyIHNpZGVzID0gc2lkZXMgfHwgNTtcbiAgICAgIHZhciBzaWRlSW5kZW50UmFkaXVzID0gcmFkaXVzICogKHNpZGVJbmRlbnQgfHwgMC4zOCk7XG4gICAgICB2YXIgcmFkT2Zmc2V0ID0gKG9mZnNldEFuZ2xlKSA/IG9mZnNldEFuZ2xlKk1hdGguUEkvMTgwIDogLU1hdGguUEkvMjtcbiAgICAgIHZhciByYWREaXYgPSAoTWF0aC5QSSoyKS9zaWRlcy8yO1xuXG4gICAgICB0aGlzLm1vdmVUbyhcbiAgICAgICAgeCArIE1hdGguY29zKHJhZE9mZnNldCkqcmFkaXVzLFxuICAgICAgICB5ICsgTWF0aC5zaW4ocmFkT2Zmc2V0KSpyYWRpdXNcbiAgICAgICk7XG4gICAgICBmb3IgKHZhciBpPTE7IGk8c2lkZXMqMjsgKytpKSB7XG4gICAgICAgIHZhciByYWQgPSByYWREaXYqaSArIHJhZE9mZnNldDtcbiAgICAgICAgdmFyIGxlbiA9IChpJTIpID8gc2lkZUluZGVudFJhZGl1cyA6IHJhZGl1cztcbiAgICAgICAgdGhpcy5saW5lVG8oXG4gICAgICAgICAgeCArIE1hdGguY29zKHJhZCkqbGVuLFxuICAgICAgICAgIHkgKyBNYXRoLnNpbihyYWQpKmxlblxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgdGhpcy5jbG9zZVBhdGgoKTtcblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOaYn+OCkuWhl+OCiuOBpOOBtuOBl+aPj+eUu1xuICAgICAqL1xuICAgIGZpbGxTdGFyOiBmdW5jdGlvbih4LCB5LCByYWRpdXMsIHNpZGVzLCBzaWRlSW5kZW50LCBvZmZzZXRBbmdsZSkge1xuICAgICAgdGhpcy5iZWdpblBhdGgoKS5zdGFyKHgsIHksIHJhZGl1cywgc2lkZXMsIHNpZGVJbmRlbnQsIG9mZnNldEFuZ2xlKS5maWxsKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog5pif44KS44K544OI44Ot44O844Kv5o+P55S7XG4gICAgICovXG4gICAgc3Ryb2tlU3RhcjogZnVuY3Rpb24oeCwgeSwgcmFkaXVzLCBzaWRlcywgc2lkZUluZGVudCwgb2Zmc2V0QW5nbGUpIHtcbiAgICAgIHRoaXMuYmVnaW5QYXRoKCkuc3Rhcih4LCB5LCByYWRpdXMsIHNpZGVzLCBzaWRlSW5kZW50LCBvZmZzZXRBbmdsZSkuc3Ryb2tlKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLypcbiAgICAgKiBoZWFydFxuICAgICAqL1xuICAgIGhlYXJ0OiBmdW5jdGlvbih4LCB5LCByYWRpdXMsIGFuZ2xlKSB7XG4gICAgICB2YXIgaGFsZl9yYWRpdXMgPSByYWRpdXMqMC41O1xuICAgICAgdmFyIHJhZCA9IChhbmdsZSA9PT0gdW5kZWZpbmVkKSA/IE1hdGguUEkvNCA6IE1hdGguZGVnVG9SYWQoYW5nbGUpO1xuXG4gICAgICAvLyDljYrlvoQgaGFsZl9yYWRpdXMg44Gu6KeS5bqmIGFuZ2xlIOS4iuOBrueCueOBqOOBruaOpee3muOCkuaxguOCgeOCi1xuICAgICAgdmFyIHAgPSBNYXRoLmNvcyhyYWQpKmhhbGZfcmFkaXVzO1xuICAgICAgdmFyIHEgPSBNYXRoLnNpbihyYWQpKmhhbGZfcmFkaXVzO1xuXG4gICAgICAvLyDlhobjga7mjqXnt5rjga7mlrnnqIvlvI8gcHggKyBxeSA9IHJeMiDjgojjgoogeSA9IChyXjItcHgpL3FcbiAgICAgIHZhciB4MiA9IC1oYWxmX3JhZGl1cztcbiAgICAgIHZhciB5MiA9IChoYWxmX3JhZGl1cypoYWxmX3JhZGl1cy1wKngyKS9xO1xuXG4gICAgICAvLyDkuK3lv4PkvY3nva7oqr/mlbRcbiAgICAgIHZhciBoZWlnaHQgPSB5MiArIGhhbGZfcmFkaXVzO1xuICAgICAgdmFyIG9mZnNldFkgPSBoYWxmX3JhZGl1cy1oZWlnaHQvMjtcblxuICAgICAgLy8g44OR44K544KS44K744OD44OIXG4gICAgICB0aGlzLm1vdmVUbygwK3gsIHkyK3krb2Zmc2V0WSk7XG5cbiAgICAgIHRoaXMuYXJjKC1oYWxmX3JhZGl1cyt4LCAwK3krb2Zmc2V0WSwgaGFsZl9yYWRpdXMsIE1hdGguUEktcmFkLCBNYXRoLlBJKjIpO1xuICAgICAgdGhpcy5hcmMoaGFsZl9yYWRpdXMreCwgMCt5K29mZnNldFksIGhhbGZfcmFkaXVzLCBNYXRoLlBJLCByYWQpO1xuICAgICAgdGhpcy5jbG9zZVBhdGgoKTtcblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qXG4gICAgICogZmlsbCBoZWFydFxuICAgICAqL1xuICAgIGZpbGxIZWFydDogZnVuY3Rpb24oeCwgeSwgcmFkaXVzLCBhbmdsZSkge1xuICAgICAgcmV0dXJuIHRoaXMuYmVnaW5QYXRoKCkuaGVhcnQoeCwgeSwgcmFkaXVzLCBhbmdsZSkuZmlsbCgpO1xuICAgIH0sXG5cbiAgICAvKlxuICAgICAqIHN0cm9rZSBoZWFydFxuICAgICAqL1xuICAgIHN0cm9rZUhlYXJ0OiBmdW5jdGlvbih4LCB5LCByYWRpdXMsIGFuZ2xlKSB7XG4gICAgICByZXR1cm4gdGhpcy5iZWdpblBhdGgoKS5oZWFydCh4LCB5LCByYWRpdXMsIGFuZ2xlKS5zdHJva2UoKTtcbiAgICB9LFxuXG4gICAgLypcbiAgICAgKiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE0MTY5MjM0L3RoZS1yZWxhdGlvbi1vZi10aGUtYmV6aWVyLWN1cnZlLWFuZC1lbGxpcHNlXG4gICAgICovXG4gICAgZWxsaXBzZTogZnVuY3Rpb24oeCwgeSwgdywgaCkge1xuICAgICAgdmFyIGN0eCA9IHRoaXMuY29udGV4dDtcbiAgICAgIHZhciBrYXBwYSA9IDAuNTUyMjg0ODtcblxuICAgICAgdmFyIG94ID0gKHcgLyAyKSAqIGthcHBhOyAvLyBjb250cm9sIHBvaW50IG9mZnNldCBob3Jpem9udGFsXG4gICAgICB2YXIgb3kgPSAoaCAvIDIpICoga2FwcGE7IC8vIGNvbnRyb2wgcG9pbnQgb2Zmc2V0IHZlcnRpY2FsXG4gICAgICB2YXIgeGUgPSB4ICsgdzsgICAgICAgICAgIC8vIHgtZW5kXG4gICAgICB2YXIgeWUgPSB5ICsgaDsgICAgICAgICAgIC8vIHktZW5kXG4gICAgICB2YXIgeG0gPSB4ICsgdyAvIDI7ICAgICAgIC8vIHgtbWlkZGxlXG4gICAgICB2YXIgeW0gPSB5ICsgaCAvIDI7ICAgICAgIC8vIHktbWlkZGxlXG5cbiAgICAgIGN0eC5tb3ZlVG8oeCwgeW0pO1xuICAgICAgY3R4LmJlemllckN1cnZlVG8oeCwgeW0gLSBveSwgeG0gLSBveCwgeSwgeG0sIHkpO1xuICAgICAgY3R4LmJlemllckN1cnZlVG8oeG0gKyBveCwgeSwgeGUsIHltIC0gb3ksIHhlLCB5bSk7XG4gICAgICBjdHguYmV6aWVyQ3VydmVUbyh4ZSwgeW0gKyBveSwgeG0gKyBveCwgeWUsIHhtLCB5ZSk7XG4gICAgICBjdHguYmV6aWVyQ3VydmVUbyh4bSAtIG94LCB5ZSwgeCwgeW0gKyBveSwgeCwgeW0pO1xuICAgICAgLy8gY3R4LmNsb3NlUGF0aCgpO1xuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgZmlsbEVsbGlwc2U6IGZ1bmN0aW9uKHgsIHksIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgIHJldHVybiB0aGlzLmJlZ2luUGF0aCgpLmVsbGlwc2UoeCwgeSwgd2lkdGgsIGhlaWdodCkuZmlsbCgpO1xuICAgIH0sXG4gICAgc3Ryb2tlRWxsaXBzZTogZnVuY3Rpb24oeCwgeSwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgcmV0dXJuIHRoaXMuYmVnaW5QYXRoKCkuZWxsaXBzZSh4LCB5LCB3aWR0aCwgaGVpZ2h0KS5zdHJva2UoKTtcbiAgICB9LFxuXG4gICAgZmlsbFRleHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5fY29udGV4dC5maWxsVGV4dC5hcHBseSh0aGlzLl9jb250ZXh0LCBhcmd1bWVudHMpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIHN0cm9rZVRleHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5fY29udGV4dC5zdHJva2VUZXh0LmFwcGx5KHRoaXMuX2NvbnRleHQsIGFyZ3VtZW50cyk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLypcbiAgICAgKiDnlLvlg4/jgpLmj4/nlLtcbiAgICAgKi9cbiAgICBkcmF3SW1hZ2U6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5jb250ZXh0LmRyYXdJbWFnZS5hcHBseSh0aGlzLmNvbnRleHQsIGFyZ3VtZW50cyk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOihjOWIl+OCkuOCu+ODg+ODiFxuICAgICAqL1xuICAgIHNldFRyYW5zZm9ybTogZnVuY3Rpb24obTExLCBtMTIsIG0yMSwgbTIyLCBkeCwgZHkpIHtcbiAgICAgIHRoaXMuY29udGV4dC5zZXRUcmFuc2Zvcm0obTExLCBtMTIsIG0yMSwgbTIyLCBkeCwgZHkpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOihjOWIl+OCkuODquOCu+ODg+ODiFxuICAgICAqL1xuICAgIHJlc2V0VHJhbnNmb3JtOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuc2V0VHJhbnNmb3JtKDEuMCwgMC4wLCAwLjAsIDEuMCwgMC4wLCAwLjApO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiDkuK3lv4Pjgavnp7vli5VcbiAgICAgKi9cbiAgICB0cmFuc2Zvcm1DZW50ZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5jb250ZXh0LnNldFRyYW5zZm9ybSgxLCAwLCAwLCAxLCB0aGlzLndpZHRoLzIsIHRoaXMuaGVpZ2h0LzIpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOenu+WLlVxuICAgICAqL1xuICAgIHRyYW5zbGF0ZTogZnVuY3Rpb24oeCwgeSkge1xuICAgICAgdGhpcy5jb250ZXh0LnRyYW5zbGF0ZSh4LCB5KTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgXG4gICAgLyoqXG4gICAgICog5Zue6LuiXG4gICAgICovXG4gICAgcm90YXRlOiBmdW5jdGlvbihyb3RhdGlvbikge1xuICAgICAgdGhpcy5jb250ZXh0LnJvdGF0ZShyb3RhdGlvbik7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIFxuICAgIC8qKlxuICAgICAqIOOCueOCseODvOODq1xuICAgICAqL1xuICAgIHNjYWxlOiBmdW5jdGlvbihzY2FsZVgsIHNjYWxlWSkge1xuICAgICAgdGhpcy5jb250ZXh0LnNjYWxlKHNjYWxlWCwgc2NhbGVZKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDnirbmhYvjgpLkv53lrZhcbiAgICAgKi9cbiAgICBzYXZlOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuY29udGV4dC5zYXZlKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog54q25oWL44KS5b6p5YWDXG4gICAgICovXG4gICAgcmVzdG9yZTogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmNvbnRleHQucmVzdG9yZSgpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOeUu+WDj+OBqOOBl+OBpuS/neWtmFxuICAgICAqL1xuICAgIHNhdmVBc0ltYWdlOiBmdW5jdGlvbihtaW1lX3R5cGUpIHtcbiAgICAgIG1pbWVfdHlwZSA9IG1pbWVfdHlwZSB8fCBcImltYWdlL3BuZ1wiO1xuICAgICAgdmFyIGRhdGFfdXJsID0gdGhpcy5jYW52YXMudG9EYXRhVVJMKG1pbWVfdHlwZSk7XG4gICAgICAvLyBkYXRhX3VybCA9IGRhdGFfdXJsLnJlcGxhY2UobWltZV90eXBlLCBcImltYWdlL29jdGV0LXN0cmVhbVwiKTtcbiAgICAgIHdpbmRvdy5vcGVuKGRhdGFfdXJsLCBcInNhdmVcIik7XG4gICAgICBcbiAgICAgIC8vIHRvRGF0YVVSTCDjgpLkvb/jgYjjgbDkuIvoqJjjga7jgojjgYbjgarjg4Tjg7zjg6vjgYzkvZzjgozjgovjgYvjgoIhIVxuICAgICAgLy8gVE9ETzog44OX44Ot44Kw44Op44Og44Gn57W144KS44GL44GE44Gm5L+d5a2Y44Gn44GN44KL44OE44O844OrXG4gICAgfSxcblxuXG4gICAgX2FjY2Vzc29yOiB7XG4gICAgICAvKipcbiAgICAgICAqIOW5hVxuICAgICAgICovXG4gICAgICB3aWR0aDoge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpcy5jYW52YXMud2lkdGg7IH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKHYpICB7IHRoaXMuY2FudmFzLndpZHRoID0gdjsgfVxuICAgICAgfSxcblxuICAgICAgLyoqXG4gICAgICAgKiDpq5jjgZVcbiAgICAgICAqL1xuICAgICAgaGVpZ2h0OiB7XG4gICAgICAgIFwiZ2V0XCI6IGZ1bmN0aW9uKCkgICB7IHJldHVybiB0aGlzLmNhbnZhcy5oZWlnaHQ7IH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKHYpICB7IHRoaXMuY2FudmFzLmhlaWdodCA9IHY7IH1cbiAgICAgIH0sXG5cbiAgICAgIGZpbGxTdHlsZToge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpcy5jb250ZXh0LmZpbGxTdHlsZTsgfSxcbiAgICAgICAgXCJzZXRcIjogZnVuY3Rpb24odikgIHsgdGhpcy5jb250ZXh0LmZpbGxTdHlsZSA9IHY7IH1cbiAgICAgIH0sXG5cbiAgICAgIHN0cm9rZVN0eWxlOiB7XG4gICAgICAgIFwiZ2V0XCI6IGZ1bmN0aW9uKCkgICB7IHJldHVybiB0aGlzLmNvbnRleHQuc3Ryb2tlU3R5bGU7IH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKHYpICB7IHRoaXMuY29udGV4dC5zdHJva2VTdHlsZSA9IHY7IH1cbiAgICAgIH0sXG5cbiAgICAgIGdsb2JhbEFscGhhOiB7XG4gICAgICAgIFwiZ2V0XCI6IGZ1bmN0aW9uKCkgICB7IHJldHVybiB0aGlzLmNvbnRleHQuZ2xvYmFsQWxwaGE7IH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKHYpICB7IHRoaXMuY29udGV4dC5nbG9iYWxBbHBoYSA9IHY7IH1cbiAgICAgIH0sXG5cbiAgICAgIGdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbjoge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpcy5jb250ZXh0Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbjsgfSxcbiAgICAgICAgXCJzZXRcIjogZnVuY3Rpb24odikgIHsgdGhpcy5jb250ZXh0Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IHY7IH1cbiAgICAgIH0sXG5cbiAgICAgIHNoYWRvd0JsdXI6IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSAgIHsgcmV0dXJuIHRoaXMuY29udGV4dC5zaGFkb3dCbHVyOyB9LFxuICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2KSAgeyB0aGlzLmNvbnRleHQuc2hhZG93Qmx1ciA9IHY7IH1cbiAgICAgIH0sXG5cbiAgICAgIHNoYWRvd0NvbG9yOiB7XG4gICAgICAgIFwiZ2V0XCI6IGZ1bmN0aW9uKCkgICB7IHJldHVybiB0aGlzLmNvbnRleHQuc2hhZG93Q29sb3I7IH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKHYpICB7IHRoaXMuY29udGV4dC5zaGFkb3dDb2xvciA9IHY7IH1cbiAgICAgIH0sXG5cbiAgICAgIHNoYWRvd09mZnNldFg6IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSAgIHsgcmV0dXJuIHRoaXMuY29udGV4dC5zaGFkb3dPZmZzZXRYOyB9LFxuICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2KSAgeyB0aGlzLmNvbnRleHQuc2hhZG93T2Zmc2V0WCA9IHY7IH1cbiAgICAgIH0sXG5cbiAgICAgIHNoYWRvd09mZnNldFk6IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSAgIHsgcmV0dXJuIHRoaXMuY29udGV4dC5zaGFkb3dPZmZzZXRZOyB9LFxuICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2KSAgeyB0aGlzLmNvbnRleHQuc2hhZG93T2Zmc2V0WSA9IHY7IH1cbiAgICAgIH0sXG5cbiAgICAgIGxpbmVDYXA6IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSAgIHsgcmV0dXJuIHRoaXMuY29udGV4dC5saW5lQ2FwOyB9LFxuICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2KSAgeyB0aGlzLmNvbnRleHQubGluZUNhcCA9IHY7IH1cbiAgICAgIH0sXG5cbiAgICAgIGxpbmVKb2luOiB7XG4gICAgICAgIFwiZ2V0XCI6IGZ1bmN0aW9uKCkgICB7IHJldHVybiB0aGlzLmNvbnRleHQubGluZUpvaW47IH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKHYpICB7IHRoaXMuY29udGV4dC5saW5lSm9pbiA9IHY7IH1cbiAgICAgIH0sXG5cbiAgICAgIG1pdGVyTGltaXQ6IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSAgIHsgcmV0dXJuIHRoaXMuY29udGV4dC5taXRlckxpbWl0OyB9LFxuICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2KSAgeyB0aGlzLmNvbnRleHQubWl0ZXJMaW1pdCA9IHY7IH1cbiAgICAgIH0sXG5cbiAgICAgIGxpbmVXaWR0aDoge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpcy5jb250ZXh0LmxpbmVXaWR0aDsgfSxcbiAgICAgICAgXCJzZXRcIjogZnVuY3Rpb24odikgIHsgdGhpcy5jb250ZXh0LmxpbmVXaWR0aCA9IHY7IH1cbiAgICAgIH0sXG5cbiAgICAgIGZvbnQ6IHtcbiAgICAgICAgXCJnZXRcIjogZnVuY3Rpb24oKSAgIHsgcmV0dXJuIHRoaXMuY29udGV4dC5mb250OyB9LFxuICAgICAgICBcInNldFwiOiBmdW5jdGlvbih2KSAgeyB0aGlzLmNvbnRleHQuZm9udCA9IHY7IH1cbiAgICAgIH0sXG5cbiAgICAgIHRleHRBbGlnbjoge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpcy5jb250ZXh0LnRleHRBbGlnbjsgfSxcbiAgICAgICAgXCJzZXRcIjogZnVuY3Rpb24odikgIHsgdGhpcy5jb250ZXh0LnRleHRBbGlnbiA9IHY7IH1cbiAgICAgIH0sXG5cbiAgICAgIHRleHRCYXNlbGluZToge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpcy5jb250ZXh0LnRleHRCYXNlbGluZTsgfSxcbiAgICAgICAgXCJzZXRcIjogZnVuY3Rpb24odikgIHsgdGhpcy5jb250ZXh0LnRleHRCYXNlbGluZSA9IHY7IH1cbiAgICAgIH0sXG5cbiAgICAgIGltYWdlU21vb3RoaW5nRW5hYmxlZDoge1xuICAgICAgICBcImdldFwiOiBmdW5jdGlvbigpICAgeyByZXR1cm4gdGhpcy5jb250ZXh0LmltYWdlU21vb3RoaW5nRW5hYmxlZDsgfSxcbiAgICAgICAgXCJzZXRcIjogZnVuY3Rpb24odikgIHtcbiAgICAgICAgICB0aGlzLmNvbnRleHQuaW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gdjtcbiAgICAgICAgICB0aGlzLmNvbnRleHQud2Via2l0SW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gdjtcbiAgICAgICAgICB0aGlzLmNvbnRleHQubW96SW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gdjtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9LFxuXG4gICAgX3N0YXRpYzoge1xuICAgICAgX2NvbnRleHQ6IChmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHBoaW5hLnV0aWwuU3VwcG9ydC5jYW52YXMpIHtcbiAgICAgICAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJykuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfSkoKSxcblxuICAgICAgbWVhc3VyZVRleHQ6IGZ1bmN0aW9uKGZvbnQsIHRleHQpIHtcbiAgICAgICAgdGhpcy5fY29udGV4dC5mb250ID0gZm9udDtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnRleHQubWVhc3VyZVRleHQodGV4dCk7XG4gICAgICB9LFxuXG4gICAgICBjcmVhdGVMaW5lYXJHcmFkaWVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jb250ZXh0LmNyZWF0ZUxpbmVhckdyYWRpZW50LmFwcGx5KHRoaXMuX2NvbnRleHQsIGFyZ3VtZW50cyk7XG4gICAgICB9LFxuXG4gICAgICBjcmVhdGVSYWRpYWxHcmFkaWVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jb250ZXh0LmNyZWF0ZVJhZGlhbEdyYWRpZW50LmFwcGx5KHRoaXMuX2NvbnRleHQsIGFyZ3VtZW50cyk7XG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xufSk7XG5cbi8qXG4gKlxuICovXG5cblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEuZ3JhcGhpY3MuQ2FudmFzUmVjb3JkZXJcbiAgICogUmVmZXJlbmNlIDxodHRwczovL2dpdGh1Yi5jb20vam5vcmRiZXJnL2dpZi5qcy8+XG4gICAqIEBleHRlbmRzIHBoaW5hLnV0aWwuRXZlbnREaXNwYXRjaGVyXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmdyYXBoaWNzLkNhbnZhc1JlY29yZGVyJywge1xuXG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLnV0aWwuRXZlbnREaXNwYXRjaGVyJyxcblxuICAgIF9pZDogbnVsbCxcbiAgICBvYmplY3RVUkw6IG51bGwsXG5cbiAgICBpbml0OiBmdW5jdGlvbihjYW52YXMsIG9wdGlvbnMpIHtcbiAgICAgIHRoaXMuc3VwZXJJbml0KCk7XG5cbiAgICAgIHRoaXMuY2FudmFzID0gY2FudmFzO1xuXG4gICAgICB0aGlzLmdpZiA9IG5ldyBHSUYoKG9wdGlvbnMgfHwge30pLiRzYWZlKHtcbiAgICAgICAgd29ya2VyczogNCxcbiAgICAgICAgcXVhbGl0eTogMTAsXG4gICAgICAgIHdpZHRoOiBjYW52YXMud2lkdGgsXG4gICAgICAgIGhlaWdodDogY2FudmFzLmhlaWdodCxcbiAgICAgIH0pKTtcblxuICAgICAgdGhpcy5naWYub24oJ2ZpbmlzaGVkJywgZnVuY3Rpb24oYmxvYikge1xuICAgICAgICB0aGlzLm9iamVjdFVSTCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgICAgIHRoaXMuZmxhcmUoJ2ZpbmlzaGVkJyk7XG4gICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBrZXkg44GoIHZhbHVlIOOBr+OCouOCr+OCu+OCteOCkuWPgueFp1xuICAgICAqL1xuICAgIHNldE9wdGlvbjogZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuICAgICAgdGhpcy5naWYuc2V0T3B0aW9uKGtleSwgdmFsdWUpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIGtleSDjgaggdmFsdWUg44Gv44Ki44Kv44K744K144KS5Y+C54WnXG4gICAgICovXG4gICAgc2V0T3B0aW9uczogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgdGhpcy5naWYuc2V0T3B0aW9ucyhvcHRpb25zKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBzdGFydDogZnVuY3Rpb24oZnBzLCByZWNvcmRpbmdUaW1lKSB7XG4gICAgICBmcHMgPSBmcHMgfHwgMzA7XG4gICAgICByZWNvcmRpbmdUaW1lID0gcmVjb3JkaW5nVGltZSB8fCAyMDAwO1xuICAgICAgdmFyIGZyYW1lVGltZSA9IDEwMDAgLyBmcHM7XG4gICAgICB2YXIgdGltZSA9IDA7XG4gICAgICB0aGlzLl9pZCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgY3R4ID0gdGhpcy5jYW52YXMuY29udGV4dDtcbiAgICAgICAgdGhpcy5naWYuYWRkRnJhbWUoY3R4LCB7XG4gICAgICAgICAgY29weTogdHJ1ZSxcbiAgICAgICAgICBkZWxheTogZnJhbWVUaW1lLFxuICAgICAgICB9KTtcblxuICAgICAgICB0aW1lICs9IGZyYW1lVGltZTtcblxuICAgICAgICBpZiAodGltZSA+IHJlY29yZGluZ1RpbWUpIHtcbiAgICAgICAgICB0aGlzLnN0b3AoKTtcbiAgICAgICAgfVxuICAgICAgfS5iaW5kKHRoaXMpLCBmcmFtZVRpbWUpO1xuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgc3RvcDogZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodGhpcy5faWQgPT09IG51bGwpIHJldHVybiB0aGlzO1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLl9pZCk7XG5cbiAgICAgIC8vIOODrOODs+ODgOODquODs+OCsFxuICAgICAgdGhpcy5naWYucmVuZGVyKCk7XG4gICAgICB0aGlzLl9pZCA9IG51bGw7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgb3BlbjogZnVuY3Rpb24oKSB7XG4gICAgICB3aW5kb3cub3Blbih0aGlzLm9iamVjdFVSTCk7XG4gICAgfSxcblxuICAgIF9hY2Nlc3Nvcjoge1xuXG4gICAgICB3aWR0aDoge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLmdpZi5vcHRpb25zLndpZHRoIHx8IHRoaXMuY2FudmFzLndpZHRoO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHdpZHRoKSB7XG4gICAgICAgICAgdGhpcy5zZXRPcHRpb24oJ3dpZHRoJywgd2lkdGgpO1xuICAgICAgICB9LFxuICAgICAgfSxcblxuICAgICAgaGVpZ2h0OiB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZ2lmLm9wdGlvbnMuaGVpZ2h0IHx8IHRoaXMuY2FudmFzLmhlaWdodDtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbihoZWlnaHQpIHtcbiAgICAgICAgICB0aGlzLnNldE9wdGlvbignaGVpZ2h0JywgaGVpZ2h0KTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG5cbiAgICAgIC8vIEdJRiDjga7jgq/jgqrjg6rjg4bjgqPjgILkvY7jgYTjgbvjganjg4/jgqTjgq/jgqrjg6rjg4bjgqNcbiAgICAgIHF1YWxpdHk6IHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5naWYub3B0aW9ucy5xdWFsaXR5O1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHF1YWxpdHkpIHtcbiAgICAgICAgICB0aGlzLnNldE9wdGlvbigncXVhbGl0eScsIHF1YWxpdHkpO1xuICAgICAgICB9LFxuICAgICAgfSxcblxuICAgICAgLy8gV29ya2VyIOOBriBVUkwg44OH44OV44Kp44Or44OI44GnIGdpZi53b3JrZXIuanNcbiAgICAgIHdvcmtlclNjcmlwdDoge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLmdpZi5vcHRpb25zLndvcmtlclNjcmlwdDtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbih3b3JrZXJTY3JpcHQpIHtcbiAgICAgICAgICB0aGlzLnNldE9wdGlvbignd29ya2VyU2NyaXB0Jywgd29ya2VyU2NyaXB0KTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG5cbiAgICAgIC8vIOi1t+WLleOBmeOCiyBXb3JrZXIg44Gu5pWwXG4gICAgICB3b3JrZXJzOiB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZ2lmLm9wdGlvbnMud29ya2VycztcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbih3b3JrZXJzKSB7XG4gICAgICAgICAgdGhpcy5zZXRPcHRpb24oJ3dvcmtlcnMnLCB3b3JrZXJzKTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG5cbiAgICAgIC8vIOODq+ODvOODl+OBmeOCi+OBiyAwIOOBp+ODq+ODvOODlyAtMSDjgafjg6vjg7zjg5fjgZfjgarjgYRcbiAgICAgIHJlcGVhdDoge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLmdpZi5vcHRpb25zLnJlcGVhdDtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbihyZXBlYXQpIHtcbiAgICAgICAgICB0aGlzLnNldE9wdGlvbigncmVwZWF0JywgcmVwZWF0KTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG5cbiAgICAgIC8vIHRydWUg44GnIOODq+ODvOODlyBmYWxzZSDjgafjg6vjg7zjg5fjgZfjgarjgYRcbiAgICAgIGxvb3A6IHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5naWYub3B0aW9ucy5yZXBlYXQgPT09IDA7XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24obG9vcCkge1xuICAgICAgICAgIHRoaXMuc2V0T3B0aW9uKCdyZXBlYXQnLCBsb29wID8gMCA6IC0xKTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG5cbiAgICAgIC8vIOmAj+mBjuOBmeOCi+iJsiA/IHRyYW5zcGFyZW50IGhleCBjb2xvciwgMHgwMEZGMDAgPSBncmVlblxuICAgICAgdHJhbnNwYXJlbnQ6IHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5naWYub3B0aW9ucy50cmFuc3BhcmVudDtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbih0cmFuc3BhcmVudCkge1xuICAgICAgICAgIHRoaXMuc2V0T3B0aW9uKCd0cmFuc3BhcmVudCcsIHRyYW5zcGFyZW50KTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG5cbiAgICAgIC8vIGJhY2tncm91bmQgY29sb3Igd2hlcmUgc291cmNlIGltYWdlIGlzIHRyYW5zcGFyZW50XG4gICAgICBiYWNrZ3JvdW5kOiB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZ2lmLm9wdGlvbnMuYmFja2dyb3VuZDtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbihiYWNrZ3JvdW5kKSB7XG4gICAgICAgICAgdGhpcy5zZXRPcHRpb24oJ2JhY2tncm91bmQnLCBiYWNrZ3JvdW5kKTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfVxuICB9KTtcblxuXG59KTtcblxuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50XG4gICAqIEBleHRlbmRzIHBoaW5hLmFwcC5PYmplY3QyRFxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50Jywge1xuICAgIHN1cGVyQ2xhc3M6ICdwaGluYS5hcHAuT2JqZWN0MkQnLFxuXG4gICAgLyoqIOihqOekuuODleODqeOCsCAqL1xuICAgIHZpc2libGU6IHRydWUsXG4gICAgLyoqIOOCouODq+ODleOCoSAqL1xuICAgIGFscGhhOiAxLjAsXG4gICAgLyoqIOODluODrOODs+ODieODouODvOODiSAqL1xuICAgIGJsZW5kTW9kZTogXCJzb3VyY2Utb3ZlclwiLFxuXG4gICAgLyoqIOWtkOS+m+OCkiDoh6rliIbjga5DYW52YXNSZW5kZXJlciDjgafmj4/nlLvjgZnjgovjgYsgKi9cbiAgICByZW5kZXJDaGlsZEJ5U2VsZjogZmFsc2UsXG5cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pO1xuICAgICAgXG4gICAgICB0aGlzLnN1cGVySW5pdChvcHRpb25zKTtcblxuICAgICAgdGhpcy52aXNpYmxlID0gdHJ1ZTtcbiAgICAgIHRoaXMuYWxwaGEgPSAxLjA7XG4gICAgICB0aGlzLl93b3JsZEFscGhhID0gMS4wO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDooajnpLov6Z2e6KGo56S644KS44K744OD44OIXG4gICAgICovXG4gICAgc2V0VmlzaWJsZTogZnVuY3Rpb24oZmxhZykge1xuICAgICAgdGhpcy52aXNpYmxlID0gZmxhZztcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDooajnpLpcbiAgICAgKi9cbiAgICBzaG93OiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMudmlzaWJsZSA9IHRydWU7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog6Z2e6KGo56S6XG4gICAgICovXG4gICAgaGlkZTogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnZpc2libGUgPSBmYWxzZTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9jYWxjV29ybGRBbHBoYTogZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodGhpcy5hbHBoYSA8IDApIHtcbiAgICAgICAgdGhpcy5fd29ybGRBbHBoYSA9IDA7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmICghdGhpcy5wYXJlbnQpIHtcbiAgICAgICAgdGhpcy5fd29ybGRBbHBoYSA9IHRoaXMuYWxwaGE7XG4gICAgICAgIHJldHVybiA7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdmFyIHdvcmxkQWxwaGEgPSAodGhpcy5wYXJlbnQuX3dvcmxkQWxwaGEgIT09IHVuZGVmaW5lZCkgPyB0aGlzLnBhcmVudC5fd29ybGRBbHBoYSA6IDEuMDsgXG4gICAgICAgIC8vIGFscGhhXG4gICAgICAgIHRoaXMuX3dvcmxkQWxwaGEgPSB3b3JsZEFscGhhICogdGhpcy5hbHBoYTtcbiAgICAgIH1cbiAgICB9LFxuICB9KTtcblxufSk7XG5cblxuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5kaXNwbGF5LlBsYWluRWxlbWVudFxuICAgKiBAZXh0ZW5kcyBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50XG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmRpc3BsYXkuUGxhaW5FbGVtZW50Jywge1xuICAgIHN1cGVyQ2xhc3M6ICdwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50JyxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuICAgICAgdGhpcy5jYW52YXMgPSBwaGluYS5ncmFwaGljcy5DYW52YXMoKTtcbiAgICAgIHRoaXMuY2FudmFzLnNldFNpemUodGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgIH0sXG5cbiAgICBkcmF3OiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICAgIHZhciBpbWFnZSA9IHRoaXMuY2FudmFzLmRvbUVsZW1lbnQ7XG4gICAgICB2YXIgdyA9IGltYWdlLndpZHRoO1xuICAgICAgdmFyIGggPSBpbWFnZS5oZWlnaHQ7XG5cbiAgICAgIHZhciB4ID0gLXcqdGhpcy5vcmlnaW4ueDtcbiAgICAgIHZhciB5ID0gLWgqdGhpcy5vcmlnaW4ueTtcblxuICAgICAgY2FudmFzLmNvbnRleHQuZHJhd0ltYWdlKGltYWdlLFxuICAgICAgICAwLCAwLCB3LCBoLFxuICAgICAgICB4LCB5LCB3LCBoXG4gICAgICAgICk7XG4gICAgfSxcbiAgfSk7XG5cbn0pO1xuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmRpc3BsYXkuU2hhcGVcbiAgICogQGV4dGVuZHMgcGhpbmEuZGlzcGxheS5QbGFpbkVsZW1lbnRcbiAgICovXG4gIHZhciBTaGFwZSA9IHBoaW5hLmRlZmluZSgncGhpbmEuZGlzcGxheS5TaGFwZScsIHtcbiAgICBzdXBlckNsYXNzOiAncGhpbmEuZGlzcGxheS5QbGFpbkVsZW1lbnQnLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgb3B0aW9ucyA9ICh7fSkuJHNhZmUob3B0aW9ucywge1xuICAgICAgICB3aWR0aDogNjQsXG4gICAgICAgIGhlaWdodDogNjQsXG4gICAgICAgIHBhZGRpbmc6IDgsXG5cbiAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnI2FhYScsXG4gICAgICAgIGZpbGw6ICcjMDBhJyxcbiAgICAgICAgc3Ryb2tlOiAnI2FhYScsXG4gICAgICAgIHN0cm9rZVdpZHRoOiA0LFxuXG4gICAgICAgIHNoYWRvdzogZmFsc2UsXG4gICAgICAgIHNoYWRvd0JsdXI6IDQsXG4gICAgICB9KTtcbiAgICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuXG4gICAgICB0aGlzLnBhZGRpbmcgPSBvcHRpb25zLnBhZGRpbmc7XG5cbiAgICAgIHRoaXMuYmFja2dyb3VuZENvbG9yID0gb3B0aW9ucy5iYWNrZ3JvdW5kQ29sb3I7XG4gICAgICB0aGlzLmZpbGwgPSBvcHRpb25zLmZpbGw7XG4gICAgICB0aGlzLnN0cm9rZSA9IG9wdGlvbnMuc3Ryb2tlO1xuICAgICAgdGhpcy5zdHJva2VXaWR0aCA9IG9wdGlvbnMuc3Ryb2tlV2lkdGg7XG5cbiAgICAgIHRoaXMuc2hhZG93ID0gb3B0aW9ucy5zaGFkb3c7XG4gICAgICB0aGlzLnNoYWRvd0JsdXIgPSBvcHRpb25zLnNoYWRvd0JsdXI7XG5cbiAgICAgIHRoaXMud2F0Y2hEcmF3ID0gdHJ1ZTtcbiAgICAgIHRoaXMuX2RpcnR5RHJhdyA9IHRydWU7XG5cbiAgICAgIHZhciBjaGVja1JlbmRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyByZW5kZXJcbiAgICAgICAgaWYgKHRoaXMud2F0Y2hEcmF3ICYmIHRoaXMuX2RpcnR5RHJhdyA9PT0gdHJ1ZSkge1xuICAgICAgICAgIHRoaXMucmVuZGVyKHRoaXMuY2FudmFzKTtcbiAgICAgICAgICB0aGlzLl9kaXJ0eURyYXcgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgdGhpcy5vbignZW50ZXJmcmFtZScsIGNoZWNrUmVuZGVyKTtcbiAgICAgIHRoaXMub24oJ2FkZGVkJywgY2hlY2tSZW5kZXIpO1xuICAgIH0sXG5cbiAgICBjYWxjQ2FudmFzV2lkdGg6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMud2lkdGggKyB0aGlzLnBhZGRpbmcqMjtcbiAgICB9LFxuXG4gICAgY2FsY0NhbnZhc0hlaWdodDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5oZWlnaHQgKyB0aGlzLnBhZGRpbmcqMjtcbiAgICB9LFxuXG4gICAgY2FsY0NhbnZhc1NpemU6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHdpZHRoOiB0aGlzLmNhbGNDYW52YXNXaWR0aCgpLFxuICAgICAgICBoZWlnaHQ6IHRoaXMuY2FsY0NhbnZhc0hlaWdodCgpLFxuICAgICAgfTtcbiAgICB9LFxuXG4gICAgaXNTdHJva2FibGU6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuc3Ryb2tlICYmIDAgPCB0aGlzLnN0cm9rZVdpZHRoO1xuICAgIH0sXG5cbiAgICBwcmVyZW5kZXI6IGZ1bmN0aW9uKGNhbnZhcykge1xuXG4gICAgfSxcbiAgICBwb3N0cmVuZGVyOiBmdW5jdGlvbihjYW52YXMpIHtcblxuICAgIH0sXG4gICAgcmVuZGVyRmlsbDogZnVuY3Rpb24oY2FudmFzKSB7XG4gICAgICBjYW52YXMuZmlsbCgpO1xuICAgIH0sXG4gICAgcmVuZGVyU3Ryb2tlOiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICAgIGNhbnZhcy5zdHJva2UoKTtcbiAgICB9LFxuXG4gICAgcmVuZGVyOiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICAgIHZhciBjb250ZXh0ID0gY2FudmFzLmNvbnRleHQ7XG4gICAgICAvLyDjg6rjgrXjgqTjgrpcbiAgICAgIHZhciBzaXplID0gdGhpcy5jYWxjQ2FudmFzU2l6ZSgpO1xuICAgICAgY2FudmFzLnNldFNpemUoc2l6ZS53aWR0aCwgc2l6ZS5oZWlnaHQpO1xuICAgICAgLy8g44Kv44Oq44Ki44Kr44Op44O8XG4gICAgICBjYW52YXMuY2xlYXJDb2xvcih0aGlzLmJhY2tncm91bmRDb2xvcik7XG4gICAgICAvLyDkuK3lv4PjgavluqfmqJnjgpLnp7vli5VcbiAgICAgIGNhbnZhcy50cmFuc2Zvcm1DZW50ZXIoKTtcblxuICAgICAgLy8g5o+P55S75YmN5Yem55CGXG4gICAgICB0aGlzLnByZXJlbmRlcih0aGlzLmNhbnZhcyk7XG5cbiAgICAgIC8vIOOCueODiOODreODvOOCr+aPj+eUu1xuICAgICAgaWYgKHRoaXMuaXNTdHJva2FibGUoKSkge1xuICAgICAgICBjb250ZXh0LnN0cm9rZVN0eWxlID0gdGhpcy5zdHJva2U7XG4gICAgICAgIGNvbnRleHQubGluZVdpZHRoID0gdGhpcy5zdHJva2VXaWR0aDtcbiAgICAgICAgY29udGV4dC5saW5lSm9pbiA9IFwicm91bmRcIjtcbiAgICAgICAgY29udGV4dC5zaGFkb3dCbHVyID0gMDtcbiAgICAgICAgdGhpcy5yZW5kZXJTdHJva2UoY2FudmFzKTtcbiAgICAgIH1cblxuICAgICAgLy8g5aGX44KK44Gk44G244GX5o+P55S7XG4gICAgICBpZiAodGhpcy5maWxsKSB7XG4gICAgICAgIGNvbnRleHQuZmlsbFN0eWxlID0gdGhpcy5maWxsO1xuXG4gICAgICAgIC8vIHNoYWRvdyDjga4gb24vb2ZmXG4gICAgICAgIGlmICh0aGlzLnNoYWRvdykge1xuICAgICAgICAgIGNvbnRleHQuc2hhZG93Q29sb3IgPSB0aGlzLnNoYWRvdztcbiAgICAgICAgICBjb250ZXh0LnNoYWRvd0JsdXIgPSB0aGlzLnNoYWRvd0JsdXI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgY29udGV4dC5zaGFkb3dCbHVyID0gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucmVuZGVyRmlsbChjYW52YXMpO1xuICAgICAgfVxuXG4gICAgICAvLyDmj4/nlLvlvozlh6bnkIZcbiAgICAgIHRoaXMucG9zdHJlbmRlcih0aGlzLmNhbnZhcyk7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBfc3RhdGljOiB7XG4gICAgICB3YXRjaFJlbmRlclByb3BlcnR5OiBmdW5jdGlvbihrZXkpIHtcbiAgICAgICAgdGhpcy5wcm90b3R5cGUuJHdhdGNoKGtleSwgZnVuY3Rpb24obmV3VmFsLCBvbGRWYWwpIHtcbiAgICAgICAgICBpZiAobmV3VmFsICE9PSBvbGRWYWwpIHtcbiAgICAgICAgICAgIHRoaXMuX2RpcnR5RHJhdyA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICB3YXRjaFJlbmRlclByb3BlcnRpZXM6IGZ1bmN0aW9uKGtleXMpIHtcbiAgICAgICAgdmFyIHdhdGNoUmVuZGVyUHJvcGVydHkgPSB0aGlzLndhdGNoUmVuZGVyUHJvcGVydHkgfHwgU2hhcGUud2F0Y2hSZW5kZXJQcm9wZXJ0eTtcbiAgICAgICAga2V5cy5lYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgICAgICAgIHdhdGNoUmVuZGVyUHJvcGVydHkuY2FsbCh0aGlzLCBrZXkpO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICAgIH0sXG4gICAgfSxcblxuICAgIF9kZWZpbmVkOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMud2F0Y2hSZW5kZXJQcm9wZXJ0aWVzKFtcbiAgICAgICAgJ3dpZHRoJyxcbiAgICAgICAgJ2hlaWdodCcsXG4gICAgICAgICdyYWRpdXMnLFxuICAgICAgICAncGFkZGluZycsXG4gICAgICAgICdiYWNrZ3JvdW5kQ29sb3InLFxuICAgICAgICAnZmlsbCcsXG4gICAgICAgICdzdHJva2UnLFxuICAgICAgICAnc3Ryb2tlV2lkdGgnLFxuICAgICAgICAnc2hhZG93JyxcbiAgICAgICAgJ3NoYWRvd0JsdXInLFxuICAgICAgXSk7XG4gICAgfSxcbiAgfSk7XG5cbn0pO1xuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEuZGlzcGxheS5SZWN0YW5nbGVTaGFwZVxuICAgKiBAZXh0ZW5kcyBwaGluYS5kaXNwbGF5LlNoYXBlXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmRpc3BsYXkuUmVjdGFuZ2xlU2hhcGUnLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmRpc3BsYXkuU2hhcGUnLFxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIG9wdGlvbnMgPSAoe30pLiRzYWZlKG9wdGlvbnMsIHtcbiAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICBmaWxsOiAnYmx1ZScsXG4gICAgICAgIHN0cm9rZTogJyNhYWEnLFxuICAgICAgICBzdHJva2VXaWR0aDogNCxcblxuICAgICAgICBjb3JuZXJSYWRpdXM6IDAsXG4gICAgICB9KTtcbiAgICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuXG4gICAgICB0aGlzLmNvcm5lclJhZGl1cyA9IG9wdGlvbnMuY29ybmVyUmFkaXVzO1xuICAgIH0sXG5cbiAgICBwcmVyZW5kZXI6IGZ1bmN0aW9uKGNhbnZhcykge1xuICAgICAgY2FudmFzLnJvdW5kUmVjdCgtdGhpcy53aWR0aC8yLCAtdGhpcy5oZWlnaHQvMiwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQsIHRoaXMuY29ybmVyUmFkaXVzKTtcbiAgICB9LFxuXG4gICAgX2RlZmluZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcGhpbmEuZGlzcGxheS5TaGFwZS53YXRjaFJlbmRlclByb3BlcnR5LmNhbGwodGhpcywgJ2Nvcm5lclJhZGl1cycpO1xuICAgIH0sXG4gIH0pO1xufSk7XG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmRpc3BsYXkuQ2lyY2xlU2hhcGVcbiAgICogQGV4dGVuZHMgcGhpbmEuZGlzcGxheS5TaGFwZVxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5kaXNwbGF5LkNpcmNsZVNoYXBlJywge1xuICAgIHN1cGVyQ2xhc3M6ICdwaGluYS5kaXNwbGF5LlNoYXBlJyxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIG9wdGlvbnMgPSAoe30pLiRzYWZlKG9wdGlvbnMsIHtcbiAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICBmaWxsOiAncmVkJyxcbiAgICAgICAgc3Ryb2tlOiAnI2FhYScsXG4gICAgICAgIHN0cm9rZVdpZHRoOiA0LFxuICAgICAgICByYWRpdXM6IDMyLFxuICAgICAgfSk7XG4gICAgICB0aGlzLnN1cGVySW5pdChvcHRpb25zKTtcblxuICAgICAgdGhpcy5zZXRCb3VuZGluZ1R5cGUoJ2NpcmNsZScpO1xuICAgIH0sXG5cbiAgICBwcmVyZW5kZXI6IGZ1bmN0aW9uKGNhbnZhcykge1xuICAgICAgY2FudmFzLmNpcmNsZSgwLCAwLCB0aGlzLnJhZGl1cyk7XG4gICAgfSxcbiAgfSk7XG59KTtcblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmRpc3BsYXkuVHJpYW5nbGVTaGFwZVxuICAgKiBAZXh0ZW5kcyBwaGluYS5kaXNwbGF5LlNoYXBlXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmRpc3BsYXkuVHJpYW5nbGVTaGFwZScsIHtcbiAgICBzdXBlckNsYXNzOiAncGhpbmEuZGlzcGxheS5TaGFwZScsXG5cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBvcHRpb25zID0gKHt9KS4kc2FmZShvcHRpb25zLCB7XG4gICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgZmlsbDogJ2dyZWVuJyxcbiAgICAgICAgc3Ryb2tlOiAnI2FhYScsXG4gICAgICAgIHN0cm9rZVdpZHRoOiA0LFxuXG4gICAgICAgIHJhZGl1czogMzIsXG4gICAgICB9KTtcbiAgICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuXG4gICAgICB0aGlzLnNldEJvdW5kaW5nVHlwZSgnY2lyY2xlJyk7XG4gICAgfSxcblxuICAgIHByZXJlbmRlcjogZnVuY3Rpb24oY2FudmFzKSB7XG4gICAgICBjYW52YXMucG9seWdvbigwLCAwLCB0aGlzLnJhZGl1cywgMyk7XG4gICAgfSxcblxuICB9KTtcblxufSk7XG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5kaXNwbGF5LlN0YXJTaGFwZVxuICAgKiBAZXh0ZW5kcyBwaGluYS5kaXNwbGF5LlNoYXBlXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmRpc3BsYXkuU3RhclNoYXBlJywge1xuICAgIHN1cGVyQ2xhc3M6ICdwaGluYS5kaXNwbGF5LlNoYXBlJyxcbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBvcHRpb25zID0gKHt9KS4kc2FmZShvcHRpb25zLCB7XG4gICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgZmlsbDogJ3llbGxvdycsXG4gICAgICAgIHN0cm9rZTogJyNhYWEnLFxuICAgICAgICBzdHJva2VXaWR0aDogNCxcblxuICAgICAgICByYWRpdXM6IDMyLFxuICAgICAgICBzaWRlczogNSxcbiAgICAgICAgc2lkZUluZGVudDogMC4zOCxcbiAgICAgIH0pO1xuICAgICAgdGhpcy5zdXBlckluaXQob3B0aW9ucyk7XG5cbiAgICAgIHRoaXMuc2V0Qm91bmRpbmdUeXBlKCdjaXJjbGUnKTtcbiAgICAgIHRoaXMuc2lkZXMgPSBvcHRpb25zLnNpZGVzO1xuICAgICAgdGhpcy5zaWRlSW5kZW50ID0gb3B0aW9ucy5zaWRlSW5kZW50O1xuICAgIH0sXG5cbiAgICBwcmVyZW5kZXI6IGZ1bmN0aW9uKGNhbnZhcykge1xuICAgICAgY2FudmFzLnN0YXIoMCwgMCwgdGhpcy5yYWRpdXMsIHRoaXMuc2lkZXMsIHRoaXMuc2lkZUluZGVudCk7XG4gICAgfSxcblxuICAgIF9kZWZpbmVkOiBmdW5jdGlvbigpIHtcbiAgICAgIHBoaW5hLmRpc3BsYXkuU2hhcGUud2F0Y2hSZW5kZXJQcm9wZXJ0eS5jYWxsKHRoaXMsICdzaWRlcycpO1xuICAgICAgcGhpbmEuZGlzcGxheS5TaGFwZS53YXRjaFJlbmRlclByb3BlcnR5LmNhbGwodGhpcywgJ3NpZGVJbmRlbnQnKTtcbiAgICB9LFxuICB9KTtcblxufSk7XG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5kaXNwbGF5LlBvbHlnb25TaGFwZVxuICAgKiBAZXh0ZW5kcyBwaGluYS5kaXNwbGF5LlNoYXBlXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmRpc3BsYXkuUG9seWdvblNoYXBlJywge1xuICAgIHN1cGVyQ2xhc3M6ICdwaGluYS5kaXNwbGF5LlNoYXBlJyxcbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBvcHRpb25zID0gKHt9KS4kc2FmZShvcHRpb25zLCB7XG4gICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgZmlsbDogJ2N5YW4nLFxuICAgICAgICBzdHJva2U6ICcjYWFhJyxcbiAgICAgICAgc3Ryb2tlV2lkdGg6IDQsXG5cbiAgICAgICAgcmFkaXVzOiAzMixcbiAgICAgICAgc2lkZXM6IDUsXG4gICAgICB9KTtcbiAgICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuXG4gICAgICB0aGlzLnNldEJvdW5kaW5nVHlwZSgnY2lyY2xlJyk7XG4gICAgICB0aGlzLnNpZGVzID0gb3B0aW9ucy5zaWRlcztcbiAgICB9LFxuXG4gICAgcHJlcmVuZGVyOiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICAgIGNhbnZhcy5wb2x5Z29uKDAsIDAsIHRoaXMucmFkaXVzLCB0aGlzLnNpZGVzKTtcbiAgICB9LFxuXG4gICAgX2RlZmluZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcGhpbmEuZGlzcGxheS5TaGFwZS53YXRjaFJlbmRlclByb3BlcnR5LmNhbGwodGhpcywgJ3NpZGVzJyk7XG4gICAgfSxcbiAgfSk7XG5cbn0pO1xuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5kaXNwbGF5LkhlYXJ0U2hhcGVcbiAgICogQGV4dGVuZHMgcGhpbmEuZGlzcGxheS5TaGFwZVxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5kaXNwbGF5LkhlYXJ0U2hhcGUnLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmRpc3BsYXkuU2hhcGUnLFxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIG9wdGlvbnMgPSAoe30pLiRzYWZlKG9wdGlvbnMsIHtcbiAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICBmaWxsOiAncGluaycsXG4gICAgICAgIHN0cm9rZTogJyNhYWEnLFxuICAgICAgICBzdHJva2VXaWR0aDogNCxcblxuICAgICAgICByYWRpdXM6IDMyLFxuICAgICAgICBjb3JuZXJBbmdsZTogNDUsXG4gICAgICB9KTtcbiAgICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuXG4gICAgICB0aGlzLnNldEJvdW5kaW5nVHlwZSgnY2lyY2xlJyk7XG4gICAgICB0aGlzLmNvcm5lckFuZ2xlID0gb3B0aW9ucy5jb3JuZXJBbmdsZTtcbiAgICB9LFxuXG4gICAgcHJlcmVuZGVyOiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICAgIGNhbnZhcy5oZWFydCgwLCAwLCB0aGlzLnJhZGl1cywgdGhpcy5jb3JuZXJBbmdsZSk7XG4gICAgfSxcblxuICAgIF9kZWZpbmVkOiBmdW5jdGlvbigpIHtcbiAgICAgIHBoaW5hLmRpc3BsYXkuU2hhcGUud2F0Y2hSZW5kZXJQcm9wZXJ0eS5jYWxsKHRoaXMsICdjb3JuZXJBbmdsZScpO1xuICAgIH0sXG4gIH0pO1xuXG59KTtcblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uICgpIHtcbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5kaXNwbGF5LlBhdGhTaGFwZVxuICAgKiBAZXh0ZW5kcyBwaGluYS5kaXNwbGF5LlNoYXBlXG4gICAqL1xuICB2YXIgUGF0aFNoYXBlID0gcGhpbmEuZGVmaW5lKCdwaGluYS5kaXNwbGF5LlBhdGhTaGFwZScsIHtcbiAgICBzdXBlckNsYXNzOiAncGhpbmEuZGlzcGxheS5TaGFwZScsXG4gICAgcGF0aHM6IG51bGwsXG5cbiAgICBpbml0OiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgb3B0aW9ucyA9ICh7fSkuJHNhZmUob3B0aW9ucyB8fCB7fSwgUGF0aFNoYXBlLmRlZmF1bHRzKTtcblxuICAgICAgdGhpcy5zdXBlckluaXQob3B0aW9ucyk7XG4gICAgICB0aGlzLnBhdGhzID0gb3B0aW9ucy5wYXRocyB8fCBbXTtcbiAgICAgIHRoaXMubGluZUpvaW4gPSBvcHRpb25zLmxpbmVKb2luO1xuICAgICAgdGhpcy5saW5lQ2FwID0gb3B0aW9ucy5saW5lQ2FwO1xuICAgIH0sXG5cbiAgICBzZXRQYXRoczogZnVuY3Rpb24gKHBhdGhzKSB7XG4gICAgICB0aGlzLnBhdGhzID0gcGF0aHM7XG4gICAgICB0aGlzLl9kaXJ0eURyYXcgPSB0cnVlO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIGNsZWFyOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnBhdGhzLmxlbmd0aCA9IDA7XG4gICAgICB0aGlzLl9kaXJ0eURyYXcgPSB0cnVlO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIGFkZFBhdGhzOiBmdW5jdGlvbiAocGF0aHMpIHtcbiAgICAgIFtdLnB1c2guYXBwbHkodGhpcy5wYXRocywgcGF0aHMpO1xuICAgICAgdGhpcy5fZGlydHlEcmF3ID0gdHJ1ZTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBhZGRQYXRoOiBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgdGhpcy5wYXRocy5wdXNoKHBoaW5hLmdlb20uVmVjdG9yMih4LCB5KSk7XG4gICAgICB0aGlzLl9kaXJ0eURyYXcgPSB0cnVlO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIGdldFBhdGg6IGZ1bmN0aW9uIChpKSB7XG4gICAgICByZXR1cm4gdGhpcy5wYXRoc1tpXTtcbiAgICB9LFxuXG4gICAgZ2V0UGF0aHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLnBhdGhzO1xuICAgIH0sXG5cbiAgICBjaGFuZ2VQYXRoOiBmdW5jdGlvbiAoaSwgeCwgeSkge1xuICAgICAgdGhpcy5wYXRoc1tpXS5zZXQoeCwgeSk7XG4gICAgICB0aGlzLl9kaXJ0eURyYXcgPSB0cnVlO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIGNhbGNDYW52YXNTaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgcGF0aHMgPSB0aGlzLnBhdGhzO1xuICAgICAgaWYgKHBhdGhzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHdpZHRoOiB0aGlzLnBhZGRpbmcgKiAyLFxuICAgICAgICAgIGhlaWdodDp0aGlzLnBhZGRpbmcgKiAyLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgdmFyIG1heFggPSAtSW5maW5pdHk7XG4gICAgICB2YXIgbWF4WSA9IC1JbmZpbml0eTtcbiAgICAgIHZhciBtaW5YID0gSW5maW5pdHk7XG4gICAgICB2YXIgbWluWSA9IEluZmluaXR5O1xuXG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcGF0aHMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHtcbiAgICAgICAgdmFyIHBhdGggPSBwYXRoc1tpXTtcbiAgICAgICAgaWYgKG1heFggPCBwYXRoLngpIHsgbWF4WCA9IHBhdGgueDsgfVxuICAgICAgICBpZiAobWluWCA+IHBhdGgueCkgeyBtaW5YID0gcGF0aC54OyB9XG4gICAgICAgIGlmIChtYXhZIDwgcGF0aC55KSB7IG1heFkgPSBwYXRoLnk7IH1cbiAgICAgICAgaWYgKG1pblkgPiBwYXRoLnkpIHsgbWluWSA9IHBhdGgueTsgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgd2lkdGg6IE1hdGgubWF4KE1hdGguYWJzKG1heFgpLCBNYXRoLmFicyhtaW5YKSkgKiAyICsgdGhpcy5wYWRkaW5nICogMixcbiAgICAgICAgaGVpZ2h0OiBNYXRoLm1heChNYXRoLmFicyhtYXhZKSwgTWF0aC5hYnMobWluWSkpICogMiArIHRoaXMucGFkZGluZyAqIDIsXG4gICAgICB9O1xuICAgIH0sXG5cbiAgICBjYWxjQ2FudmFzV2lkdGg6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmNhbGNDYW52YXNTaXplKCkud2lkdGg7XG4gICAgfSxcblxuICAgIGNhbGNDYW52YXNIZWlnaHQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmNhbGNDYW52YXNTaXplKCkuaGVpZ2h0O1xuICAgIH0sXG5cbiAgICBwcmVyZW5kZXI6IGZ1bmN0aW9uIChjYW52YXMpIHtcbiAgICAgIGNhbnZhcy5saW5lQ2FwID0gdGhpcy5saW5lQ2FwO1xuICAgICAgY2FudmFzLmxpbmVKb2luID0gdGhpcy5saW5lSm9pbjtcbiAgICAgIHZhciBwYXRocyA9IHRoaXMucGF0aHM7XG4gICAgICBpZiAocGF0aHMubGVuZ3RoID4gMSkge1xuICAgICAgICB2YXIgYyA9IGNhbnZhcy5jb250ZXh0O1xuICAgICAgICB2YXIgcCA9IHBhdGhzWzBdO1xuICAgICAgICBjLmJlZ2luUGF0aCgpO1xuICAgICAgICBjLm1vdmVUbyhwLngsIHAueSk7XG4gICAgICAgIGZvciAodmFyIGkgPSAxLCBsZW4gPSBwYXRocy5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuICAgICAgICAgIHAgPSBwYXRoc1tpXTtcbiAgICAgICAgICBjLmxpbmVUbyhwLngsIHAueSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX2RlZmluZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHBoaW5hLmRpc3BsYXkuU2hhcGUud2F0Y2hSZW5kZXJQcm9wZXJ0aWVzLmNhbGwodGhpcywgW1xuICAgICAgICAnbGluZUNhcCcsXG4gICAgICAgICdsaW5lSm9pbidcbiAgICAgIF0pO1xuICAgIH0sXG5cbiAgICBfc3RhdGljOiB7XG4gICAgICBkZWZhdWx0czoge1xuICAgICAgICBmaWxsOiBmYWxzZSxcbiAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICBsaW5lQ2FwOiAncm91bmQnLFxuICAgICAgICBsaW5lSm9pbjoncm91bmQnLFxuICAgICAgfSxcbiAgICB9XG5cbiAgfSk7XG5cbn0pO1xuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmRpc3BsYXkuU3ByaXRlXG4gICAqIEBleHRlbmRzIHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnRcbiAgICovXG4gIHBoaW5hLmRlZmluZSgncGhpbmEuZGlzcGxheS5TcHJpdGUnLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnQnLFxuXG4gICAgaW5pdDogZnVuY3Rpb24oaW1hZ2UsIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgIHRoaXMuc3VwZXJJbml0KCk7XG5cbiAgICAgIHRoaXMuc3JjUmVjdCA9IHBoaW5hLmdlb20uUmVjdCgpO1xuICAgICAgdGhpcy5zZXRJbWFnZShpbWFnZSwgd2lkdGgsIGhlaWdodCk7XG4gICAgfSxcblxuICAgIGRyYXc6IGZ1bmN0aW9uKGNhbnZhcykge1xuICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZS5kb21FbGVtZW50O1xuXG4gICAgICAvLyBjYW52YXMuY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsXG4gICAgICAvLyAgIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsXG4gICAgICAvLyAgIC10aGlzLndpZHRoKnRoaXMub3JpZ2luLngsIC10aGlzLmhlaWdodCp0aGlzLm9yaWdpbi55LCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodFxuICAgICAgLy8gICApO1xuXG4gICAgICB2YXIgc3JjUmVjdCA9IHRoaXMuc3JjUmVjdDtcbiAgICAgIGNhbnZhcy5jb250ZXh0LmRyYXdJbWFnZShpbWFnZSxcbiAgICAgICAgc3JjUmVjdC54LCBzcmNSZWN0LnksIHNyY1JlY3Qud2lkdGgsIHNyY1JlY3QuaGVpZ2h0LFxuICAgICAgICAtdGhpcy5fd2lkdGgqdGhpcy5vcmlnaW5YLCAtdGhpcy5faGVpZ2h0KnRoaXMub3JpZ2luWSwgdGhpcy5fd2lkdGgsIHRoaXMuX2hlaWdodFxuICAgICAgICApO1xuICAgIH0sXG5cbiAgICBzZXRJbWFnZTogZnVuY3Rpb24oaW1hZ2UsIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgIGlmICh0eXBlb2YgaW1hZ2UgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGltYWdlID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgnaW1hZ2UnLCBpbWFnZSk7XG4gICAgICB9XG4gICAgICB0aGlzLl9pbWFnZSA9IGltYWdlO1xuICAgICAgdGhpcy53aWR0aCA9IHRoaXMuX2ltYWdlLmRvbUVsZW1lbnQud2lkdGg7XG4gICAgICB0aGlzLmhlaWdodCA9IHRoaXMuX2ltYWdlLmRvbUVsZW1lbnQuaGVpZ2h0O1xuXG4gICAgICBpZiAod2lkdGgpIHsgdGhpcy53aWR0aCA9IHdpZHRoOyB9XG4gICAgICBpZiAoaGVpZ2h0KSB7IHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OyB9XG5cbiAgICAgIHRoaXMuZnJhbWVJbmRleCA9IDA7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBzZXRGcmFtZUluZGV4OiBmdW5jdGlvbihpbmRleCwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgdmFyIHR3ICA9IHdpZHRoIHx8IHRoaXMuX3dpZHRoOyAgICAgIC8vIHR3XG4gICAgICB2YXIgdGggID0gaGVpZ2h0IHx8IHRoaXMuX2hlaWdodDsgICAgLy8gdGhcbiAgICAgIHZhciByb3cgPSB+fih0aGlzLmltYWdlLmRvbUVsZW1lbnQud2lkdGggLyB0dyk7XG4gICAgICB2YXIgY29sID0gfn4odGhpcy5pbWFnZS5kb21FbGVtZW50LmhlaWdodCAvIHRoKTtcbiAgICAgIHZhciBtYXhJbmRleCA9IHJvdypjb2w7XG4gICAgICBpbmRleCA9IGluZGV4JW1heEluZGV4O1xuICAgICAgXG4gICAgICB2YXIgeCA9IGluZGV4JXJvdztcbiAgICAgIHZhciB5ID0gfn4oaW5kZXgvcm93KTtcbiAgICAgIHRoaXMuc3JjUmVjdC54ID0geCp0dztcbiAgICAgIHRoaXMuc3JjUmVjdC55ID0geSp0aDtcbiAgICAgIHRoaXMuc3JjUmVjdC53aWR0aCAgPSB0dztcbiAgICAgIHRoaXMuc3JjUmVjdC5oZWlnaHQgPSB0aDtcblxuICAgICAgdGhpcy5fZnJhbWVJbmRleCA9IGluZGV4O1xuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgX2FjY2Vzc29yOiB7XG4gICAgICBpbWFnZToge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge3JldHVybiB0aGlzLl9pbWFnZTt9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgICB0aGlzLnNldEltYWdlKHYpO1xuICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZnJhbWVJbmRleDoge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge3JldHVybiB0aGlzLl9mcmFtZUluZGV4O30sXG4gICAgICAgIHNldDogZnVuY3Rpb24oaWR4KSB7XG4gICAgICAgICAgdGhpcy5zZXRGcmFtZUluZGV4KGlkeCk7XG4gICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbn0pO1xuXG5cblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEuZGlzcGxheS5MYWJlbFxuICAgKiBAZXh0ZW5kcyBwaGluYS5kaXNwbGF5LlNoYXBlXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmRpc3BsYXkuTGFiZWwnLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmRpc3BsYXkuU2hhcGUnLFxuXG4gICAgLyoqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgaWYgKHR5cGVvZiBhcmd1bWVudHNbMF0gIT09ICdvYmplY3QnKSB7XG4gICAgICAgIG9wdGlvbnMgPSB7IHRleHQ6IGFyZ3VtZW50c1swXSwgfTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBvcHRpb25zID0gYXJndW1lbnRzWzBdO1xuICAgICAgfVxuXG4gICAgICBvcHRpb25zID0gKHt9KS4kc2FmZShvcHRpb25zLCBwaGluYS5kaXNwbGF5LkxhYmVsLmRlZmF1bHRzKTtcblxuICAgICAgdGhpcy5zdXBlckluaXQob3B0aW9ucyk7XG5cbiAgICAgIHRoaXMudGV4dCA9IG9wdGlvbnMudGV4dDtcbiAgICAgIHRoaXMuZm9udFNpemUgPSBvcHRpb25zLmZvbnRTaXplO1xuICAgICAgdGhpcy5mb250V2VpZ2h0ID0gb3B0aW9ucy5mb250V2VpZ2h0O1xuICAgICAgdGhpcy5mb250RmFtaWx5ID0gb3B0aW9ucy5mb250RmFtaWx5O1xuICAgICAgdGhpcy5hbGlnbiA9IG9wdGlvbnMuYWxpZ247XG4gICAgICB0aGlzLmJhc2VsaW5lID0gb3B0aW9ucy5iYXNlbGluZTtcbiAgICAgIHRoaXMubGluZUhlaWdodCA9IG9wdGlvbnMubGluZUhlaWdodDtcbiAgICB9LFxuXG4gICAgY2FsY0NhbnZhc1dpZHRoOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciB3aWR0aCA9IDA7XG4gICAgICB2YXIgY2FudmFzID0gdGhpcy5jYW52YXM7XG4gICAgICBjYW52YXMuY29udGV4dC5mb250ID0gdGhpcy5mb250O1xuICAgICAgdGhpcy5fbGluZXMuZm9yRWFjaChmdW5jdGlvbihsaW5lKSB7XG4gICAgICAgIHZhciB3ID0gY2FudmFzLmNvbnRleHQubWVhc3VyZVRleHQobGluZSkud2lkdGg7XG4gICAgICAgIGlmICh3aWR0aCA8IHcpIHtcbiAgICAgICAgICB3aWR0aCA9IHc7XG4gICAgICAgIH1cbiAgICAgIH0sIHRoaXMpO1xuICAgICAgaWYgKHRoaXMuYWxpZ24gIT09ICdjZW50ZXInKSB3aWR0aCo9MjtcblxuICAgICAgcmV0dXJuIHdpZHRoICsgdGhpcy5wYWRkaW5nKjI7XG4gICAgfSxcblxuICAgIGNhbGNDYW52YXNIZWlnaHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGhlaWdodCA9IHRoaXMuZm9udFNpemUgKiB0aGlzLl9saW5lcy5sZW5ndGg7XG4gICAgICBpZiAodGhpcy5iYXNlbGluZSAhPT0gJ21pZGRsZScpIGhlaWdodCo9MjtcbiAgICAgIHJldHVybiBoZWlnaHQqdGhpcy5saW5lSGVpZ2h0ICsgdGhpcy5wYWRkaW5nKjI7XG4gICAgfSxcblxuICAgIHByZXJlbmRlcjogZnVuY3Rpb24oY2FudmFzKSB7XG4gICAgICB2YXIgY29udGV4dCA9IGNhbnZhcy5jb250ZXh0O1xuICAgICAgY29udGV4dC5mb250ID0gdGhpcy5mb250O1xuICAgICAgY29udGV4dC50ZXh0QWxpZ24gPSB0aGlzLmFsaWduO1xuICAgICAgY29udGV4dC50ZXh0QmFzZWxpbmUgPSB0aGlzLmJhc2VsaW5lO1xuXG4gICAgICB2YXIgbGluZXMgPSB0aGlzLl9saW5lcztcbiAgICAgIHRoaXMubGluZVNpemUgPSB0aGlzLmZvbnRTaXplKnRoaXMubGluZUhlaWdodDtcbiAgICAgIHRoaXMuX29mZnNldCA9IC1NYXRoLmZsb29yKGxpbmVzLmxlbmd0aC8yKSp0aGlzLmxpbmVTaXplO1xuICAgICAgdGhpcy5fb2Zmc2V0ICs9ICgobGluZXMubGVuZ3RoKzEpJTIpICogKHRoaXMubGluZVNpemUvMik7XG4gICAgfSxcblxuICAgIHJlbmRlckZpbGw6IGZ1bmN0aW9uKGNhbnZhcykge1xuICAgICAgdmFyIGNvbnRleHQgPSBjYW52YXMuY29udGV4dDtcbiAgICAgIHRoaXMuX2xpbmVzLmZvckVhY2goZnVuY3Rpb24obGluZSwgaSkge1xuICAgICAgICBjb250ZXh0LmZpbGxUZXh0KGxpbmUsIDAsIGkqdGhpcy5saW5lU2l6ZSt0aGlzLl9vZmZzZXQpO1xuICAgICAgfSwgdGhpcyk7XG4gICAgfSxcblxuICAgIHJlbmRlclN0cm9rZTogZnVuY3Rpb24oY2FudmFzKSB7XG4gICAgICB2YXIgY29udGV4dCA9IGNhbnZhcy5jb250ZXh0O1xuICAgICAgdGhpcy5fbGluZXMuZm9yRWFjaChmdW5jdGlvbihsaW5lLCBpKSB7XG4gICAgICAgIGNvbnRleHQuc3Ryb2tlVGV4dChsaW5lLCAwLCBpKnRoaXMubGluZVNpemUrdGhpcy5fb2Zmc2V0KTtcbiAgICAgIH0sIHRoaXMpO1xuICAgIH0sXG5cbiAgICBfYWNjZXNzb3I6IHtcbiAgICAgIC8qKlxuICAgICAgICogdGV4dFxuICAgICAgICovXG4gICAgICB0ZXh0OiB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLl90ZXh0OyB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgICB0aGlzLl90ZXh0ID0gdjtcbiAgICAgICAgICB0aGlzLl9saW5lcyA9ICh0aGlzLnRleHQgKyAnJykuc3BsaXQoJ1xcbicpO1xuICAgICAgICB9LFxuICAgICAgfSxcblxuICAgICAgZm9udDoge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiBcIntmb250V2VpZ2h0fSB7Zm9udFNpemV9cHgge2ZvbnRGYW1pbHl9XCIuZm9ybWF0KHRoaXMpO1xuICAgICAgICB9LFxuICAgICAgfVxuICAgIH0sXG5cbiAgICBfc3RhdGljOiB7XG4gICAgICBkZWZhdWx0czoge1xuICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG5cbiAgICAgICAgZmlsbDogJ2JsYWNrJyxcbiAgICAgICAgc3Ryb2tlOiBudWxsLFxuICAgICAgICBzdHJva2VXaWR0aDogMixcblxuICAgICAgICAvLyBcbiAgICAgICAgdGV4dDogJ0hlbGxvLCB3b3JsZCEnLFxuICAgICAgICAvLyBcbiAgICAgICAgZm9udFNpemU6IDMyLFxuICAgICAgICBmb250V2VpZ2h0OiAnJyxcbiAgICAgICAgZm9udEZhbWlseTogXCInSGlyYUtha3VQcm9OLVczJ1wiLCAvLyBIaXJhZ2lubyBvciBIZWx2ZXRpY2EsXG4gICAgICAgIC8vIFxuICAgICAgICBhbGlnbjogJ2NlbnRlcicsXG4gICAgICAgIGJhc2VsaW5lOiAnbWlkZGxlJyxcbiAgICAgICAgbGluZUhlaWdodDogMS4yLFxuICAgICAgfSxcbiAgICB9LFxuXG4gICAgX2RlZmluZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIFNoYXBlID0gcGhpbmEuZGlzcGxheS5TaGFwZTtcbiAgICAgIFNoYXBlLndhdGNoUmVuZGVyUHJvcGVydHkuY2FsbCh0aGlzLCAndGV4dCcpO1xuICAgICAgU2hhcGUud2F0Y2hSZW5kZXJQcm9wZXJ0eS5jYWxsKHRoaXMsICdmb250U2l6ZScpO1xuICAgICAgU2hhcGUud2F0Y2hSZW5kZXJQcm9wZXJ0eS5jYWxsKHRoaXMsICdmb250V2VpZ2h0Jyk7XG4gICAgICBTaGFwZS53YXRjaFJlbmRlclByb3BlcnR5LmNhbGwodGhpcywgJ2ZvbnRGYW1pbHknKTtcbiAgICAgIFNoYXBlLndhdGNoUmVuZGVyUHJvcGVydHkuY2FsbCh0aGlzLCAnYWxpZ24nKTtcbiAgICAgIFNoYXBlLndhdGNoUmVuZGVyUHJvcGVydHkuY2FsbCh0aGlzLCAnYmFzZWxpbmUnKTtcbiAgICAgIFNoYXBlLndhdGNoUmVuZGVyUHJvcGVydHkuY2FsbCh0aGlzLCAnbGluZUhlaWdodCcpO1xuICAgIH0sXG4gIH0pO1xuXG59KTtcblxuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lXG4gICAqIEBleHRlbmRzIHBoaW5hLmFwcC5TY2VuZVxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZScsIHtcbiAgICBzdXBlckNsYXNzOiAncGhpbmEuYXBwLlNjZW5lJyxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmFtcykge1xuICAgICAgdGhpcy5zdXBlckluaXQoKTtcblxuICAgICAgcGFyYW1zID0gKHt9KS4kc2FmZShwYXJhbXMsIHBoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lLmRlZmF1bHRzKTtcblxuICAgICAgdGhpcy5jYW52YXMgPSBwaGluYS5ncmFwaGljcy5DYW52YXMoKTtcbiAgICAgIHRoaXMuY2FudmFzLnNldFNpemUocGFyYW1zLndpZHRoLCBwYXJhbXMuaGVpZ2h0KTtcbiAgICAgIHRoaXMucmVuZGVyZXIgPSBwaGluYS5kaXNwbGF5LkNhbnZhc1JlbmRlcmVyKHRoaXMuY2FudmFzKTtcbiAgICAgIHRoaXMuYmFja2dyb3VuZENvbG9yID0gKHBhcmFtcy5iYWNrZ3JvdW5kQ29sb3IpID8gcGFyYW1zLmJhY2tncm91bmRDb2xvciA6IG51bGw7XG4gICAgICBcbiAgICAgIHRoaXMud2lkdGggPSBwYXJhbXMud2lkdGg7XG4gICAgICB0aGlzLmhlaWdodCA9IHBhcmFtcy5oZWlnaHQ7XG4gICAgICB0aGlzLmdyaWRYID0gcGhpbmEudXRpbC5HcmlkKHBhcmFtcy53aWR0aCwgMTYpO1xuICAgICAgdGhpcy5ncmlkWSA9IHBoaW5hLnV0aWwuR3JpZChwYXJhbXMuaGVpZ2h0LCAxNik7XG5cbiAgICAgIC8vIFRPRE86IOS4gOaXpuOCgOOCiuOChOOCiuWvvuW/nFxuICAgICAgdGhpcy5pbnRlcmFjdGl2ZSA9IHRydWU7XG4gICAgICB0aGlzLnNldEludGVyYWN0aXZlID0gZnVuY3Rpb24oZmxhZykge1xuICAgICAgICB0aGlzLmludGVyYWN0aXZlID0gZmxhZztcbiAgICAgIH07XG4gICAgICB0aGlzLl9vdmVyRmxhZ3MgPSB7fTtcbiAgICAgIHRoaXMuX3RvdWNoRmxhZ3MgPSB7fTtcbiAgICB9LFxuXG4gICAgaGl0VGVzdDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgX3VwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodGhpcy51cGRhdGUpIHtcbiAgICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX3JlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbmRlcih0aGlzKTtcbiAgICB9LFxuXG4gICAgX3N0YXRpYzoge1xuICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgd2lkdGg6IDY0MCxcbiAgICAgICAgaGVpZ2h0OiA5NjAsXG4gICAgICB9LFxuICAgIH1cblxuICB9KTtcblxuXG59KTtcblxuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5kaXNwbGF5LkxheWVyXG4gICAqIEBleHRlbmRzIHBoaW5hLmRpc3BsYXkuRGlzcGxheUVsZW1lbnRcbiAgICovXG4gIHBoaW5hLmRlZmluZSgncGhpbmEuZGlzcGxheS5MYXllcicsIHtcbiAgICBzdXBlckNsYXNzOiAncGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCcsXG5cbiAgICAvKiog5a2Q5L6b44KSIOiHquWIhuOBriBDYW52YXNSZW5kZXJlciDjgafmj4/nlLvjgZnjgovjgYsgKi9cbiAgICByZW5kZXJDaGlsZEJ5U2VsZjogdHJ1ZSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIG9wdGlvbnMgPSAoe30pLiRzYWZlKG9wdGlvbnMsIHtcbiAgICAgICAgd2lkdGg6IDY0MCxcbiAgICAgICAgaGVpZ2h0OiA5NjAsXG4gICAgICB9KTtcbiAgICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuICAgICAgdGhpcy53aWR0aCA9IG9wdGlvbnMud2lkdGg7XG4gICAgICB0aGlzLmhlaWdodCA9IG9wdGlvbnMuaGVpZ2h0O1xuICAgICAgdGhpcy5ncmlkWCA9IHBoaW5hLnV0aWwuR3JpZChvcHRpb25zLndpZHRoLCAxNik7XG4gICAgICB0aGlzLmdyaWRZID0gcGhpbmEudXRpbC5HcmlkKG9wdGlvbnMuaGVpZ2h0LCAxNik7XG4gICAgfSxcblxuICAgIGRyYXc6IGZ1bmN0aW9uKGNhbnZhcykge1xuICAgICAgaWYgKCF0aGlzLmRvbUVsZW1lbnQpIHJldHVybiA7XG5cbiAgICAgIHZhciBpbWFnZSA9IHRoaXMuZG9tRWxlbWVudDtcbiAgICAgIGNhbnZhcy5jb250ZXh0LmRyYXdJbWFnZShpbWFnZSxcbiAgICAgICAgMCwgMCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCxcbiAgICAgICAgLXRoaXMud2lkdGgqdGhpcy5vcmlnaW5YLCAtdGhpcy5oZWlnaHQqdGhpcy5vcmlnaW5ZLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodFxuICAgICAgICApO1xuICAgIH0sXG4gIH0pO1xufSk7XG5cblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEuZGlzcGxheS5DYW52YXNMYXllclxuICAgKiBAZXh0ZW5kcyBwaGluYS5kaXNwbGF5LkxheWVyXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmRpc3BsYXkuQ2FudmFzTGF5ZXInLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmRpc3BsYXkuTGF5ZXInLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgdGhpcy5zdXBlckluaXQob3B0aW9ucyk7XG4gICAgICB0aGlzLmNhbnZhcyA9IHBoaW5hLmdyYXBoaWNzLkNhbnZhcygpO1xuICAgICAgdGhpcy5jYW52YXMud2lkdGggID0gdGhpcy53aWR0aDtcbiAgICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IHRoaXMuaGVpZ2h0O1xuXG4gICAgICB0aGlzLnJlbmRlcmVyID0gcGhpbmEuZGlzcGxheS5DYW52YXNSZW5kZXJlcih0aGlzLmNhbnZhcyk7XG4gICAgICB0aGlzLmRvbUVsZW1lbnQgPSB0aGlzLmNhbnZhcy5kb21FbGVtZW50O1xuXG4gICAgICB0aGlzLm9uKCdlbnRlcmZyYW1lJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0ZW1wID0gdGhpcy5fd29ybGRNYXRyaXg7XG4gICAgICAgIHRoaXMuX3dvcmxkTWF0cml4ID0gbnVsbDtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5yZW5kZXIodGhpcyk7XG4gICAgICAgIHRoaXMuX3dvcmxkTWF0cml4ID0gdGVtcDtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBkcmF3OiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICAgIHZhciBpbWFnZSA9IHRoaXMuZG9tRWxlbWVudDtcbiAgICAgIGNhbnZhcy5jb250ZXh0LmRyYXdJbWFnZShpbWFnZSxcbiAgICAgICAgMCwgMCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCxcbiAgICAgICAgLXRoaXMud2lkdGgqdGhpcy5vcmlnaW5YLCAtdGhpcy5oZWlnaHQqdGhpcy5vcmlnaW5ZLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodFxuICAgICAgICApO1xuICAgIH0sXG4gIH0pO1xufSk7XG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmRpc3BsYXkuVGhyZWVMYXllclxuICAgKiBAZXh0ZW5kcyBwaGluYS5kaXNwbGF5LkxheWVyXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmRpc3BsYXkuVGhyZWVMYXllcicsIHtcbiAgICBzdXBlckNsYXNzOiAncGhpbmEuZGlzcGxheS5MYXllcicsXG5cbiAgICBzY2VuZTogbnVsbCxcbiAgICBjYW1lcmE6IG51bGwsXG4gICAgbGlnaHQ6IG51bGwsXG4gICAgcmVuZGVyZXI6IG51bGwsXG5cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICB0aGlzLnN1cGVySW5pdChvcHRpb25zKTtcblxuICAgICAgdGhpcy5zY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpO1xuXG4gICAgICB0aGlzLmNhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYSggNzUsIG9wdGlvbnMud2lkdGggLyBvcHRpb25zLmhlaWdodCwgMSwgMTAwMDAgKTtcbiAgICAgIHRoaXMuY2FtZXJhLnBvc2l0aW9uLnogPSAxMDAwO1xuXG4gICAgICB0aGlzLmxpZ2h0ID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoIDB4ZmZmZmZmLCAxICk7XG4gICAgICB0aGlzLmxpZ2h0LnBvc2l0aW9uLnNldCggMSwgMSwgMSApLm5vcm1hbGl6ZSgpO1xuICAgICAgdGhpcy5zY2VuZS5hZGQoIHRoaXMubGlnaHQgKTtcblxuICAgICAgdGhpcy5yZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKCk7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldENsZWFyQ29sb3IoIDB4ZjBmMGYwICk7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldFNpemUoIG9wdGlvbnMud2lkdGgsIG9wdGlvbnMuaGVpZ2h0ICk7XG5cbiAgICAgIHRoaXMub24oJ2VudGVyZnJhbWUnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5yZW5kZXIoIHRoaXMuc2NlbmUsIHRoaXMuY2FtZXJhICk7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5kb21FbGVtZW50ID0gdGhpcy5yZW5kZXJlci5kb21FbGVtZW50O1xuICAgIH0sXG4gIH0pO1xufSk7XG5cblxuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5kaXNwbGF5LkNhbnZhc1JlbmRlcmVyXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmRpc3BsYXkuQ2FudmFzUmVuZGVyZXInLCB7XG5cbiAgICBpbml0OiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICAgIHRoaXMuY2FudmFzID0gY2FudmFzO1xuICAgICAgdGhpcy5fY29udGV4dCA9IHRoaXMuY2FudmFzLmNvbnRleHQ7XG4gICAgfSxcbiAgICByZW5kZXI6IGZ1bmN0aW9uKHNjZW5lKSB7XG4gICAgICB0aGlzLmNhbnZhcy5jbGVhcigpO1xuICAgICAgaWYgKHNjZW5lLmJhY2tncm91bmRDb2xvcikge1xuICAgICAgICB0aGlzLmNhbnZhcy5jbGVhckNvbG9yKHNjZW5lLmJhY2tncm91bmRDb2xvcik7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX2NvbnRleHQuc2F2ZSgpO1xuICAgICAgdGhpcy5yZW5kZXJDaGlsZHJlbihzY2VuZSk7XG4gICAgICB0aGlzLl9jb250ZXh0LnJlc3RvcmUoKTtcbiAgICB9LFxuXG4gICAgcmVuZGVyQ2hpbGRyZW46IGZ1bmN0aW9uKG9iaikge1xuICAgICAgLy8g5a2Q5L6b44Gf44Gh44KC5a6f6KGMXG4gICAgICBpZiAob2JqLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdmFyIHRlbXBDaGlsZHJlbiA9IG9iai5jaGlsZHJlbi5zbGljZSgpO1xuICAgICAgICBmb3IgKHZhciBpPTAsbGVuPXRlbXBDaGlsZHJlbi5sZW5ndGg7IGk8bGVuOyArK2kpIHtcbiAgICAgICAgICB0aGlzLnJlbmRlck9iamVjdCh0ZW1wQ2hpbGRyZW5baV0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIHJlbmRlck9iamVjdDogZnVuY3Rpb24ob2JqKSB7XG4gICAgICBpZiAob2JqLnZpc2libGUgPT09IGZhbHNlICYmICFvYmouaW50ZXJhY3RpdmUpIHJldHVybjtcblxuICAgICAgb2JqLl9jYWxjV29ybGRNYXRyaXggJiYgb2JqLl9jYWxjV29ybGRNYXRyaXgoKTtcblxuICAgICAgaWYgKG9iai52aXNpYmxlID09PSBmYWxzZSkgcmV0dXJuO1xuXG4gICAgICBvYmouX2NhbGNXb3JsZEFscGhhICYmIG9iai5fY2FsY1dvcmxkQWxwaGEoKTtcblxuICAgICAgdmFyIGNvbnRleHQgPSB0aGlzLmNhbnZhcy5jb250ZXh0O1xuXG4gICAgICBjb250ZXh0Lmdsb2JhbEFscGhhID0gb2JqLl93b3JsZEFscGhhO1xuICAgICAgY29udGV4dC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBvYmouYmxlbmRNb2RlO1xuXG4gICAgICBpZiAob2JqLl93b3JsZE1hdHJpeCkge1xuICAgICAgICAvLyDooYzliJfjgpLjgrvjg4Pjg4hcbiAgICAgICAgdmFyIG0gPSBvYmouX3dvcmxkTWF0cml4O1xuICAgICAgICBjb250ZXh0LnNldFRyYW5zZm9ybSggbS5tMDAsIG0ubTEwLCBtLm0wMSwgbS5tMTEsIG0ubTAyLCBtLm0xMiApO1xuICAgICAgfVxuXG4gICAgICBpZiAob2JqLmNsaXApIHtcblxuICAgICAgICBjb250ZXh0LnNhdmUoKTtcblxuICAgICAgICBvYmouY2xpcCh0aGlzLmNhbnZhcyk7XG4gICAgICAgIGNvbnRleHQuY2xpcCgpO1xuXG4gICAgICAgIGlmIChvYmouZHJhdykgb2JqLmRyYXcodGhpcy5jYW52YXMpO1xuXG4gICAgICAgIC8vIOWtkOS+m+OBn+OBoeOCguWun+ihjFxuICAgICAgICBpZiAob2JqLnJlbmRlckNoaWxkQnlTZWxmID09PSBmYWxzZSAmJiBvYmouY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdmFyIHRlbXBDaGlsZHJlbiA9IG9iai5jaGlsZHJlbi5zbGljZSgpO1xuICAgICAgICAgICAgZm9yICh2YXIgaT0wLGxlbj10ZW1wQ2hpbGRyZW4ubGVuZ3RoOyBpPGxlbjsgKytpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJPYmplY3QodGVtcENoaWxkcmVuW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnRleHQucmVzdG9yZSgpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGlmIChvYmouZHJhdykgb2JqLmRyYXcodGhpcy5jYW52YXMpO1xuXG4gICAgICAgIC8vIOWtkOS+m+OBn+OBoeOCguWun+ihjFxuICAgICAgICBpZiAob2JqLnJlbmRlckNoaWxkQnlTZWxmID09PSBmYWxzZSAmJiBvYmouY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHZhciB0ZW1wQ2hpbGRyZW4gPSBvYmouY2hpbGRyZW4uc2xpY2UoKTtcbiAgICAgICAgICBmb3IgKHZhciBpPTAsbGVuPXRlbXBDaGlsZHJlbi5sZW5ndGg7IGk8bGVuOyArK2kpIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyT2JqZWN0KHRlbXBDaGlsZHJlbltpXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgIH1cbiAgICB9LFxuXG4gIH0pO1xuXG59KTtcblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEuZGlzcGxheS5Eb21BcHBcbiAgICogQGV4dGVuZHMgcGhpbmEuYXBwLkJhc2VBcHBcbiAgICovXG4gIHBoaW5hLmRlZmluZSgncGhpbmEuZGlzcGxheS5Eb21BcHAnLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmFwcC5CYXNlQXBwJyxcblxuICAgIGRvbUVsZW1lbnQ6IG51bGwsXG5cbiAgICAvKipcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICB0aGlzLnN1cGVySW5pdChvcHRpb25zKTtcblxuICAgICAgaWYgKG9wdGlvbnMuZG9tRWxlbWVudCkge1xuICAgICAgICB0aGlzLmRvbUVsZW1lbnQgPSBvcHRpb25zLmRvbUVsZW1lbnQ7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgaWYgKG9wdGlvbnMucXVlcnkpIHtcbiAgICAgICAgICB0aGlzLmRvbUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMucXVlcnkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUuYXNzZXJ0KCdlcnJvcicpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChvcHRpb25zLmZwcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMuZnBzID0gb3B0aW9ucy5mcHM7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmKHR5cGVvZiBvcHRpb25zLnJ1bm5lciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aGlzLnRpY2tlci5ydW5uZXIgPSBvcHRpb25zLnJ1bm5lcjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5tb3VzZSA9IHBoaW5hLmlucHV0Lk1vdXNlKHRoaXMuZG9tRWxlbWVudCk7XG4gICAgICB0aGlzLnRvdWNoID0gcGhpbmEuaW5wdXQuVG91Y2godGhpcy5kb21FbGVtZW50KTtcbiAgICAgIHRoaXMudG91Y2hMaXN0ID0gcGhpbmEuaW5wdXQuVG91Y2hMaXN0KHRoaXMuZG9tRWxlbWVudCwgNSk7XG4gICAgICB0aGlzLmtleWJvYXJkID0gcGhpbmEuaW5wdXQuS2V5Ym9hcmQoZG9jdW1lbnQpO1xuICAgICAgLy8g5Yqg6YCf5bqm44K744Oz44K144O844KS55Sf5oiQXG4gICAgICB0aGlzLmFjY2VsZXJvbWV0ZXIgPSBwaGluYS5pbnB1dC5BY2NlbGVyb21ldGVyKCk7XG5cbiAgICAgIC8vIOODneOCpOODs+OCv+OCkuOCu+ODg+ODiChQQyDjgafjga8gTW91c2UsIE1vYmlsZSDjgafjga8gVG91Y2gpXG4gICAgICB0aGlzLnBvaW50ZXIgPSB0aGlzLnRvdWNoO1xuICAgICAgdGhpcy5wb2ludGVycyA9IHRoaXMudG91Y2hMaXN0LnRvdWNoZXM7XG5cbiAgICAgIHRoaXMuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucG9pbnRlciA9IHRoaXMudG91Y2g7XG4gICAgICAgIHRoaXMucG9pbnRlcnMgPSB0aGlzLnRvdWNoTGlzdC50b3VjaGVzO1xuICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgIHRoaXMuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5wb2ludGVyID0gdGhpcy5tb3VzZTtcbiAgICAgICAgdGhpcy5wb2ludGVycyA9IFt0aGlzLm1vdXNlXTtcbiAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgIC8vIGtleWJvYXJkIGV2ZW50XG4gICAgICB0aGlzLmtleWJvYXJkLm9uKCdrZXlkb3duJywgZnVuY3Rpb24oZSkge1xuICAgICAgICB0aGlzLmN1cnJlbnRTY2VuZSAmJiB0aGlzLmN1cnJlbnRTY2VuZS5mbGFyZSgna2V5ZG93bicsIHtcbiAgICAgICAgICBrZXlDb2RlOiBlLmtleUNvZGUsXG4gICAgICAgIH0pO1xuICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgIHRoaXMua2V5Ym9hcmQub24oJ2tleXVwJywgZnVuY3Rpb24oZSkge1xuICAgICAgICB0aGlzLmN1cnJlbnRTY2VuZSAmJiB0aGlzLmN1cnJlbnRTY2VuZS5mbGFyZSgna2V5dXAnLCB7XG4gICAgICAgICAga2V5Q29kZTogZS5rZXlDb2RlLFxuICAgICAgICB9KTtcbiAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICB0aGlzLmtleWJvYXJkLm9uKCdrZXlwcmVzcycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50U2NlbmUgJiYgdGhpcy5jdXJyZW50U2NlbmUuZmxhcmUoJ2tleXByZXNzJywge1xuICAgICAgICAgIGtleUNvZGU6IGUua2V5Q29kZSxcbiAgICAgICAgfSk7XG4gICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICAvLyBjbGljayDlr77lv5xcbiAgICAgIHZhciBldmVudE5hbWUgPSBwaGluYS5pc01vYmlsZSgpID8gJ3RvdWNoZW5kJyA6ICdtb3VzZXVwJztcbiAgICAgIHRoaXMuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgdGhpcy5fY2hlY2tDbGljay5iaW5kKHRoaXMpKTtcblxuICAgICAgLy8g5rG65a6a5pmC44Gu5Yem55CG44KS44Kq44OV44Gr44GZ44KLKGlQaG9uZSDmmYLjga7jgaHjgonjgaTjgY3lr77nrZYpXG4gICAgICB0aGlzLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNoc3RhcnRcIiwgZnVuY3Rpb24oZSkgeyBlLnN0b3AoKTsgfSk7XG4gICAgICB0aGlzLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNobW92ZVwiLCBmdW5jdGlvbihlKSB7IGUuc3RvcCgpOyB9KTtcblxuICAgICAgLy8g44Km44Kj44Oz44OJ44Km44OV44Kp44O844Kr44K55pmC44Kk44OZ44Oz44OI44Oq44K544OK44KS55m76YyyXG4gICAgICBwaGluYS5nbG9iYWwuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5mbGFyZSgnZm9jdXMnKTtcbiAgICAgICAgdGhpcy5jdXJyZW50U2NlbmUuZmxhcmUoJ2ZvY3VzJyk7XG4gICAgICB9LmJpbmQodGhpcyksIGZhbHNlKTtcbiAgICAgIC8vIOOCpuOCo+ODs+ODieOCpuODluODqeODvOaZguOCpOODmeODs+ODiOODquOCueODiuOCkueZu+mMslxuICAgICAgcGhpbmEuZ2xvYmFsLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5mbGFyZSgnYmx1cicpO1xuICAgICAgICB0aGlzLmN1cnJlbnRTY2VuZS5mbGFyZSgnYmx1cicpO1xuICAgICAgfS5iaW5kKHRoaXMpLCBmYWxzZSk7XG5cbiAgICAgIC8vIOabtOaWsOmWouaVsOOCkueZu+mMslxuICAgICAgdGhpcy5vbignZW50ZXJmcmFtZScsIGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLm1vdXNlLnVwZGF0ZSgpO1xuICAgICAgICB0aGlzLnRvdWNoLnVwZGF0ZSgpO1xuICAgICAgICB0aGlzLnRvdWNoTGlzdC51cGRhdGUoKTtcbiAgICAgICAgdGhpcy5rZXlib2FyZC51cGRhdGUoKTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBfY2hlY2tDbGljazogZnVuY3Rpb24oZSkge1xuICAgICAgdmFyIF9jaGVjayA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKGVsZW1lbnQuY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGVsZW1lbnQuY2hpbGRyZW4uZWFjaChmdW5jdGlvbihjaGlsZCkge1xuICAgICAgICAgICAgX2NoZWNrKGNoaWxkKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZWxlbWVudC5fY2xpY2tlZCAmJiBlbGVtZW50LmhhcygnY2xpY2snKSkge1xuICAgICAgICAgIGVsZW1lbnQuZmxhcmUoJ2NsaWNrJyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxlbWVudC5fY2xpY2tlZCA9IGZhbHNlO1xuICAgICAgfTtcblxuICAgICAgX2NoZWNrKHRoaXMuY3VycmVudFNjZW5lKTtcbiAgICB9LFxuXG4gIH0pO1xuXG4gIFxufSk7XG5cblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEuZGlzcGxheS5DYW52YXNBcHBcbiAgICogQGV4dGVuZHMgcGhpbmEuZGlzcGxheS5Eb21BcHBcbiAgICovXG4gIHBoaW5hLmRlZmluZSgncGhpbmEuZGlzcGxheS5DYW52YXNBcHAnLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmRpc3BsYXkuRG9tQXBwJyxcblxuICAgIC8qKlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIG9wdGlvbnMgPSAob3B0aW9ucyB8fCB7fSkuJHNhZmUocGhpbmEuZGlzcGxheS5DYW52YXNBcHAuZGVmYXVsdHMpO1xuICAgICAgXG4gICAgICBpZiAoIW9wdGlvbnMucXVlcnkgJiYgIW9wdGlvbnMuZG9tRWxlbWVudCkge1xuICAgICAgICBvcHRpb25zLmRvbUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICAgICAgaWYgKG9wdGlvbnMuYXBwZW5kKSB7XG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvcHRpb25zLmRvbUVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLnN1cGVySW5pdChvcHRpb25zKTtcblxuICAgICAgdGhpcy5ncmlkWCA9IHBoaW5hLnV0aWwuR3JpZCh7XG4gICAgICAgIHdpZHRoOiBvcHRpb25zLndpZHRoLFxuICAgICAgICBjb2x1bW5zOiBvcHRpb25zLmNvbHVtbnMsXG4gICAgICB9KTtcbiAgICAgIHRoaXMuZ3JpZFkgPSBwaGluYS51dGlsLkdyaWQoe1xuICAgICAgICB3aWR0aDogb3B0aW9ucy5oZWlnaHQsXG4gICAgICAgIGNvbHVtbnM6IG9wdGlvbnMuY29sdW1ucyxcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmNhbnZhcyA9IHBoaW5hLmdyYXBoaWNzLkNhbnZhcyh0aGlzLmRvbUVsZW1lbnQpO1xuICAgICAgdGhpcy5jYW52YXMuc2V0U2l6ZShvcHRpb25zLndpZHRoLCBvcHRpb25zLmhlaWdodCk7XG5cbiAgICAgIHRoaXMuYmFja2dyb3VuZENvbG9yID0gKG9wdGlvbnMuYmFja2dyb3VuZENvbG9yICE9PSB1bmRlZmluZWQpID8gb3B0aW9ucy5iYWNrZ3JvdW5kQ29sb3IgOiAnd2hpdGUnO1xuXG4gICAgICB0aGlzLnJlcGxhY2VTY2VuZShwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZSh7XG4gICAgICAgIHdpZHRoOiBvcHRpb25zLndpZHRoLFxuICAgICAgICBoZWlnaHQ6IG9wdGlvbnMuaGVpZ2h0LFxuICAgICAgfSkpO1xuXG4gICAgICBpZiAob3B0aW9ucy5maXQpIHtcbiAgICAgICAgdGhpcy5maXRTY3JlZW4oKTtcbiAgICAgIH1cblxuICAgICAgaWYgKG9wdGlvbnMucGl4ZWxhdGVkKSB7XG4gICAgICAgIC8vIOODgeODqeOBpOOBjemYsuatolxuICAgICAgICAvLyBodHRwczovL2RyYWZ0cy5jc3N3Zy5vcmcvY3NzLWltYWdlcy8jdGhlLWltYWdlLXJlbmRlcmluZ1xuICAgICAgICB0aGlzLmRvbUVsZW1lbnQuc3R5bGUuaW1hZ2VSZW5kZXJpbmcgPSAncGl4ZWxhdGVkJztcbiAgICAgIH1cblxuICAgICAgLy8gcHVzaFNjZW5lLCBwb3BTY2VuZSDlr77nrZZcbiAgICAgIHRoaXMub24oJ3B1c2gnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gb25lbnRlciDlr77nrZbjgafmj4/nlLvjgZfjgabjgYrjgY9cbiAgICAgICAgaWYgKHRoaXMuY3VycmVudFNjZW5lLmNhbnZhcykge1xuICAgICAgICAgIHRoaXMuX2RyYXcoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSxcblxuICAgIF9kcmF3OiBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLmJhY2tncm91bmRDb2xvcikge1xuICAgICAgICB0aGlzLmNhbnZhcy5jbGVhckNvbG9yKHRoaXMuYmFja2dyb3VuZENvbG9yKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuY2FudmFzLmNsZWFyKCk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmN1cnJlbnRTY2VuZS5jYW52YXMpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50U2NlbmUuX3JlbmRlcigpO1xuXG4gICAgICAgIHRoaXMuX3NjZW5lcy5lYWNoKGZ1bmN0aW9uKHNjZW5lKSB7XG4gICAgICAgICAgdmFyIGMgPSBzY2VuZS5jYW52YXM7XG4gICAgICAgICAgaWYgKGMpIHtcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLmNvbnRleHQuZHJhd0ltYWdlKGMuZG9tRWxlbWVudCwgMCwgMCwgYy53aWR0aCwgYy5oZWlnaHQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcyk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIGZpdFNjcmVlbjogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmNhbnZhcy5maXRTY3JlZW4oKTtcbiAgICB9LFxuXG4gICAgX3N0YXRpYzoge1xuICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgd2lkdGg6IDY0MCxcbiAgICAgICAgaGVpZ2h0OiA5NjAsXG4gICAgICAgIGNvbHVtbnM6IDEyLFxuICAgICAgICBmaXQ6IHRydWUsXG4gICAgICAgIGFwcGVuZDogdHJ1ZSxcbiAgICAgIH0sXG4gICAgfSxcblxuICB9KTtcbn0pO1xuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmVmZmVjdC5XYXZlXG4gICAqIEJ1dHRvblxuICAgKiBAZXh0ZW5kcyBwaGluYS5kaXNwbGF5LkNpcmNsZVNoYXBlXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmVmZmVjdC5XYXZlJywge1xuICAgIHN1cGVyQ2xhc3M6ICdwaGluYS5kaXNwbGF5LkNpcmNsZVNoYXBlJyxcbiAgICAvKipcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRzYWZlKHtcbiAgICAgICAgZmlsbDogJ3doaXRlJyxcbiAgICAgICAgc3Ryb2tlOiBmYWxzZSxcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnN1cGVySW5pdChvcHRpb25zKTtcblxuICAgICAgdmFyIHR3ZWVuZXIgPSBwaGluYS5hY2Nlc3NvcnkuVHdlZW5lcigpLmF0dGFjaFRvKHRoaXMpO1xuICAgICAgdHdlZW5lclxuICAgICAgICAudG8oe3NjYWxlWDoyLCBzY2FsZVk6MiwgYWxwaGE6MH0sIDUwMClcbiAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgfSwgdGhpcyk7XG4gICAgfSxcbiAgfSk7XG5cbn0pO1xuXG5cblxuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS51aS5CdXR0b25cbiAgICogQnV0dG9uXG4gICAqIEBleHRlbmRzIHBoaW5hLmRpc3BsYXkuU2hhcGVcbiAgICovXG4gIHBoaW5hLmRlZmluZSgncGhpbmEudWkuQnV0dG9uJywge1xuICAgIHN1cGVyQ2xhc3M6ICdwaGluYS5kaXNwbGF5LlNoYXBlJyxcbiAgICAvKipcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRzYWZlKHBoaW5hLnVpLkJ1dHRvbi5kZWZhdWx0cyk7XG4gICAgICB0aGlzLnN1cGVySW5pdChvcHRpb25zKTtcblxuICAgICAgdGhpcy5jb3JuZXJSYWRpdXMgPSBvcHRpb25zLmNvcm5lclJhZGl1cztcbiAgICAgIHRoaXMudGV4dCAgICAgICAgID0gb3B0aW9ucy50ZXh0O1xuICAgICAgdGhpcy5mb250Q29sb3IgICAgPSBvcHRpb25zLmZvbnRDb2xvcjtcbiAgICAgIHRoaXMuZm9udFNpemUgICAgID0gb3B0aW9ucy5mb250U2l6ZTtcbiAgICAgIHRoaXMuZm9udFdlaWdodCAgICAgPSBvcHRpb25zLmZvbnRXZWlnaHQ7XG4gICAgICB0aGlzLmZvbnRGYW1pbHkgICA9IG9wdGlvbnMuZm9udEZhbWlseTtcblxuICAgICAgdGhpcy5zZXRJbnRlcmFjdGl2ZSh0cnVlKTtcbiAgICAgIHRoaXMub24oJ3BvaW50ZW5kJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuZmxhcmUoJ3B1c2gnKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgcHJlcmVuZGVyOiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICAgIGNhbnZhcy5yb3VuZFJlY3QoLXRoaXMud2lkdGgvMiwgLXRoaXMuaGVpZ2h0LzIsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LCB0aGlzLmNvcm5lclJhZGl1cyk7XG4gICAgfSxcblxuICAgIHBvc3RyZW5kZXI6IGZ1bmN0aW9uKGNhbnZhcykge1xuICAgICAgdmFyIGNvbnRleHQgPSBjYW52YXMuY29udGV4dDtcbiAgICAgIC8vIHRleHRcbiAgICAgIHZhciBmb250ID0gXCJ7Zm9udFdlaWdodH0ge2ZvbnRTaXplfXB4IHtmb250RmFtaWx5fVwiLmZvcm1hdCh0aGlzKTtcbiAgICAgIGNvbnRleHQuZm9udCA9IGZvbnQ7XG4gICAgICBjb250ZXh0LnRleHRBbGlnbiA9ICdjZW50ZXInO1xuICAgICAgY29udGV4dC50ZXh0QmFzZWxpbmUgPSAnbWlkZGxlJztcbiAgICAgIGNvbnRleHQuZmlsbFN0eWxlID0gdGhpcy5mb250Q29sb3I7XG4gICAgICBjb250ZXh0LmZpbGxUZXh0KHRoaXMudGV4dCwgMCwgMCk7XG4gICAgfSxcblxuICAgIF9zdGF0aWM6IHtcbiAgICAgIGRlZmF1bHRzOiB7XG4gICAgICAgIHdpZHRoOiAyMDAsXG4gICAgICAgIGhlaWdodDogODAsXG4gICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgZmlsbDogJ2hzbCgyMDAsIDgwJSwgNjAlKScsXG4gICAgICAgIHN0cm9rZTogbnVsbCxcblxuICAgICAgICBjb3JuZXJSYWRpdXM6IDgsXG4gICAgICAgIHRleHQ6ICdIZWxsbycsXG4gICAgICAgIGZvbnRDb2xvcjogJ3doaXRlJyxcbiAgICAgICAgZm9udFNpemU6IDMyLFxuICAgICAgICBmb250V2VpZ2h0OiAnJyxcbiAgICAgICAgZm9udEZhbWlseTogXCInSGlyYUtha3VQcm9OLVczJ1wiLCAvLyBIaXJhZ2lubyBvciBIZWx2ZXRpY2EsXG4gICAgICB9LFxuICAgIH0sXG5cbiAgICBfZGVmaW5lZDogZnVuY3Rpb24oKSB7XG4gICAgICBwaGluYS5kaXNwbGF5LlNoYXBlLndhdGNoUmVuZGVyUHJvcGVydHkuY2FsbCh0aGlzLCAnY29ybmVyUmFkaXVzJyk7XG4gICAgICBwaGluYS5kaXNwbGF5LlNoYXBlLndhdGNoUmVuZGVyUHJvcGVydHkuY2FsbCh0aGlzLCAndGV4dCcpO1xuICAgICAgcGhpbmEuZGlzcGxheS5TaGFwZS53YXRjaFJlbmRlclByb3BlcnR5LmNhbGwodGhpcywgJ2ZvbnRDb2xvcicpO1xuICAgICAgcGhpbmEuZGlzcGxheS5TaGFwZS53YXRjaFJlbmRlclByb3BlcnR5LmNhbGwodGhpcywgJ2ZvbnRTaXplJyk7XG4gICAgICBwaGluYS5kaXNwbGF5LlNoYXBlLndhdGNoUmVuZGVyUHJvcGVydHkuY2FsbCh0aGlzLCAnZm9udEZhbWlseScpO1xuICAgIH0sXG5cbiAgfSk7XG5cbn0pO1xuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS51aS5HYXVnZVxuICAgKiBAZXh0ZW5kcyBwaGluYS5kaXNwbGF5LlNoYXBlXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLnVpLkdhdWdlJywge1xuICAgIHN1cGVyQ2xhc3M6ICdwaGluYS5kaXNwbGF5LlNoYXBlJyxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIG9wdGlvbnMgPSAoe30pLiRzYWZlKG9wdGlvbnMgfHwge30sIEdhdWdlLmRlZmF1bHRzKTtcbiAgICAgIFxuICAgICAgdGhpcy5zdXBlckluaXQob3B0aW9ucyk7XG5cbiAgICAgIHRoaXMuX3ZhbHVlID0gKG9wdGlvbnMudmFsdWUgIT09IHVuZGVmaW5lZCkgPyBvcHRpb25zLnZhbHVlIDogb3B0aW9ucy5tYXhWYWx1ZTtcbiAgICAgIHRoaXMubWF4VmFsdWUgPSBvcHRpb25zLm1heFZhbHVlO1xuICAgICAgdGhpcy5nYXVnZUNvbG9yID0gb3B0aW9ucy5nYXVnZUNvbG9yO1xuICAgICAgdGhpcy5jb3JuZXJSYWRpdXMgPSBvcHRpb25zLmNvcm5lclJhZGl1cztcblxuICAgICAgdGhpcy52aXN1YWxWYWx1ZSA9IChvcHRpb25zLnZhbHVlICE9PSB1bmRlZmluZWQpID8gb3B0aW9ucy52YWx1ZSA6IG9wdGlvbnMubWF4VmFsdWU7XG4gICAgICB0aGlzLmFuaW1hdGlvbiA9IHRydWU7XG4gICAgICB0aGlzLmFuaW1hdGlvblRpbWUgPSAxKjEwMDA7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOa6gOOCv+ODs+OBi+OCkuODgeOCp+ODg+OCr1xuICAgICAqL1xuICAgIGlzRnVsbDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy52YWx1ZSA9PT0gdGhpcy5tYXhWYWx1ZTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog56m644Gj44G944GL44KS44OB44Kn44OD44KvXG4gICAgICovXG4gICAgaXNFbXB0eTogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy52YWx1ZSA9PT0gMDtcbiAgICB9LFxuXG4gICAgc2V0VmFsdWU6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICB2YWx1ZSA9IE1hdGguY2xhbXAodmFsdWUsIDAsIHRoaXMubWF4VmFsdWUpO1xuXG4gICAgICAvLyBlbmQgd2hlbiBub3cgdmFsdWUgZXF1YWwgdmFsdWUgb2YgYXJndW1lbnRcbiAgICAgIGlmICh0aGlzLnZhbHVlID09PSB2YWx1ZSkgcmV0dXJuIDtcblxuICAgICAgLy8gZmlyZSB2YWx1ZSBjaGFuZ2UgZXZlbnRcbiAgICAgIHRoaXMuZmxhcmUoJ2NoYW5nZScpO1xuXG4gICAgICB0aGlzLl92YWx1ZSA9IHZhbHVlO1xuXG4gICAgICBpZiAodGhpcy5hbmltYXRpb24pIHtcbiAgICAgICAgdmFyIHJhbmdlID0gTWF0aC5hYnModGhpcy52aXN1YWxWYWx1ZS12YWx1ZSk7XG4gICAgICAgIHZhciB0aW1lID0gKHJhbmdlL3RoaXMubWF4VmFsdWUpKnRoaXMuYW5pbWF0aW9uVGltZTtcblxuICAgICAgICB0aGlzLnR3ZWVuZXIub250d2VlbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHRoaXMuX2RpcnR5RHJhdyA9IHRydWU7XG4gICAgICAgIH0uYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy50d2VlbmVyXG4gICAgICAgICAgLmNsZWFyKClcbiAgICAgICAgICAudG8oeyd2aXN1YWxWYWx1ZSc6IHZhbHVlfSwgdGltZSlcbiAgICAgICAgICAuY2FsbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuZmxhcmUoJ2NoYW5nZWQnKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdlbXB0eScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5pc0Z1bGwoKSkge1xuICAgICAgICAgICAgICB0aGlzLmZsYXJlKCdmdWxsJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSwgdGhpcyk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy52aXN1YWxWYWx1ZSA9IHZhbHVlO1xuICAgICAgICB0aGlzLmZsYXJlKCdjaGFuZ2VkJyk7XG4gICAgICAgIGlmICh0aGlzLmlzRW1wdHkoKSkge1xuICAgICAgICAgIHRoaXMuZmxhcmUoJ2VtcHR5Jyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5pc0Z1bGwoKSkge1xuICAgICAgICAgIHRoaXMuZmxhcmUoJ2Z1bGwnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRSYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciByYXRlID0gdGhpcy52aXN1YWxWYWx1ZS90aGlzLm1heFZhbHVlO1xuICAgICAgcmV0dXJuIHJhdGU7XG4gICAgfSxcblxuICAgIHByZXJlbmRlcjogZnVuY3Rpb24oY2FudmFzKSB7XG4gICAgICBjYW52YXMucm91bmRSZWN0KC10aGlzLndpZHRoLzIsIC10aGlzLmhlaWdodC8yLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCwgdGhpcy5jb3JuZXJSYWRpdXMpO1xuICAgIH0sXG5cbiAgICBwb3N0cmVuZGVyOiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICAgIHZhciByYXRlID0gdGhpcy5nZXRSYXRlKCk7XG4gICAgICBjYW52YXMuY29udGV4dC5maWxsU3R5bGUgPSB0aGlzLmdhdWdlQ29sb3I7XG4gICAgICBjYW52YXMuY29udGV4dC5zYXZlKCk7XG4gICAgICBjYW52YXMuY29udGV4dC5jbGlwKCk7XG4gICAgICBjYW52YXMuZmlsbFJlY3QoLXRoaXMud2lkdGgvMiwgLXRoaXMuaGVpZ2h0LzIsIHRoaXMud2lkdGgqcmF0ZSwgdGhpcy5oZWlnaHQpO1xuICAgICAgY2FudmFzLmNvbnRleHQucmVzdG9yZSgpO1xuICAgIH0sXG5cbiAgICBfYWNjZXNzb3I6IHtcbiAgICAgIHZhbHVlOiB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgICB0aGlzLnNldFZhbHVlKHYpO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuXG4gICAgX2RlZmluZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcGhpbmEuZGlzcGxheS5TaGFwZS53YXRjaFJlbmRlclByb3BlcnR5LmNhbGwodGhpcywgJ3ZhbHVlJyk7XG4gICAgICBwaGluYS5kaXNwbGF5LlNoYXBlLndhdGNoUmVuZGVyUHJvcGVydHkuY2FsbCh0aGlzLCAnbWF4VmFsdWUnKTtcbiAgICAgIHBoaW5hLmRpc3BsYXkuU2hhcGUud2F0Y2hSZW5kZXJQcm9wZXJ0eS5jYWxsKHRoaXMsICdnYXVnZUNvbG9yJyk7XG4gICAgICBwaGluYS5kaXNwbGF5LlNoYXBlLndhdGNoUmVuZGVyUHJvcGVydHkuY2FsbCh0aGlzLCAnY29ybmVyUmFkaXVzJyk7XG4gICAgfSxcbiAgICBcbiAgICBfc3RhdGljOiB7XG4gICAgICBkZWZhdWx0czoge1xuICAgICAgICB3aWR0aDogMjU2LFxuICAgICAgICBoZWlnaHQ6IDMyLFxuICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIGZpbGw6ICd3aGl0ZScsXG4gICAgICAgIHN0cm9rZTogJyNhYWEnLFxuICAgICAgICBzdHJva2VXaWR0aDogNCxcbiAgICAgICAgbWF4VmFsdWU6IDEwMCxcbiAgICAgICAgZ2F1Z2VDb2xvcjogJyM0NGYnLFxuICAgICAgICBjb3JuZXJSYWRpdXM6IDAsXG4gICAgICB9LFxuICAgIH1cbiAgfSk7XG5cbn0pO1xuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLnVpLkNpcmNsZUdhdWdlXG4gICAqIEBleHRlbmRzIHBoaW5hLnVpLkdhdWdlXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLnVpLkNpcmNsZUdhdWdlJywge1xuICAgIHN1cGVyQ2xhc3M6ICdwaGluYS51aS5HYXVnZScsXG5cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRzYWZlKHtcbiAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICBmaWxsOiAnI2FhYScsXG4gICAgICAgIHN0cm9rZTogJyMyMjInLFxuXG4gICAgICAgIHJhZGl1czogNjQsXG4gICAgICAgIGFudGljbG9ja3dpc2U6IHRydWUsXG4gICAgICAgIHNob3dQZXJjZW50YWdlOiBmYWxzZSwgLy8gVE9ET1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuXG4gICAgICB0aGlzLnNldEJvdW5kaW5nVHlwZSgnY2lyY2xlJyk7XG5cbiAgICAgIHRoaXMucmFkaXVzID0gb3B0aW9ucy5yYWRpdXM7XG4gICAgICB0aGlzLmFudGljbG9ja3dpc2UgPSBvcHRpb25zLmFudGljbG9ja3dpc2U7XG4gICAgICB0aGlzLnNob3dQZXJjZW50YWdlID0gb3B0aW9ucy5zaG93UGVyY2VudGFnZTtcbiAgICB9LFxuXG4gICAgcHJlcmVuZGVyOiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICAgIHZhciByYXRlID0gdGhpcy5nZXRSYXRlKCk7XG4gICAgICB2YXIgZW5kID0gKE1hdGguUEkqMikqcmF0ZTtcbiAgICAgIHRoaXMuc3RhcnRBbmdsZSA9IDA7XG4gICAgICB0aGlzLmVuZEFuZ2xlID0gZW5kO1xuXG4gICAgICB0aGlzLmNhbnZhcy5yb3RhdGUoLU1hdGguUEkqMC41KTtcbiAgICAgIHRoaXMuY2FudmFzLnNjYWxlKDEsIC0xKTtcbiAgICB9LFxuXG4gICAgcmVuZGVyRmlsbDogZnVuY3Rpb24oY2FudmFzKSB7XG4gICAgICBjYW52YXMuZmlsbFBpZSgwLCAwLCB0aGlzLnJhZGl1cywgdGhpcy5zdGFydEFuZ2xlLCB0aGlzLmVuZEFuZ2xlKTtcbiAgICB9LFxuXG4gICAgcmVuZGVyU3Ryb2tlOiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICAgIGNhbnZhcy5zdHJva2VBcmMoMCwgMCwgdGhpcy5yYWRpdXMsIHRoaXMuc3RhcnRBbmdsZSwgdGhpcy5lbmRBbmdsZSk7XG4gICAgfSxcblxuICAgIHBvc3RyZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgLy8gaWYgKHRoaXMuc2hvd1BlcmNlbnRhZ2UpIHtcbiAgICAgIC8vICAgLy8gVE9ETzpcbiAgICAgIC8vICAgdmFyIGxlZnQgPSBNYXRoLm1heCgwLCB0aGlzLmxpbWl0LXRoaXMudGltZSk7XG4gICAgICAvLyAgIHRoaXMubGFiZWwudGV4dCA9IE1hdGguY2VpbChsZWZ0LzEwMDApKycnO1xuICAgICAgLy8gfVxuICAgIH0sXG5cbiAgfSk7XG5cblxuXG59KTtcblxuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICB2YXIgdGV4dFdpZHRoQ2FjaGUgPSB7fTtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLnVpLkxhYmVsQXJlYVxuICAgKiBAZXh0ZW5kcyBwaGluYS5kaXNwbGF5LkxhYmVsXG4gICAqL1xuICB2YXIgTGFiZWxBcmVhID0gcGhpbmEuZGVmaW5lKCdwaGluYS51aS5MYWJlbEFyZWEnLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmRpc3BsYXkuTGFiZWwnLFxuXG4gICAgX2xpbmVVcGRhdGU6IHRydWUsXG5cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBvcHRpb25zID0ge30uJHNhZmUob3B0aW9ucywgTGFiZWxBcmVhLmRlZmF1bHRzKTtcbiAgICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuXG4gICAgICB0aGlzLnZlcnRpY2FsQWxpZ24gPSBvcHRpb25zLnZlcnRpY2FsQWxpZ247XG4gICAgICB0aGlzLnNjcm9sbCA9IG9wdGlvbnMuc2Nyb2xsIHx8IHBoaW5hLmdlb20uVmVjdG9yMigpO1xuICAgICAgdGhpcy5zY3JvbGxYID0gb3B0aW9ucy5zY3JvbGxYO1xuICAgICAgdGhpcy5zY3JvbGxZID0gb3B0aW9ucy5zY3JvbGxZO1xuICAgIH0sXG5cbiAgICBjYWxjQ2FudmFzV2lkdGg6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMud2lkdGggKyB0aGlzLnBhZGRpbmcgKiAyO1xuICAgIH0sXG5cbiAgICBjYWxjQ2FudmFzSGVpZ2h0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLmhlaWdodCArIHRoaXMucGFkZGluZyAqIDI7XG4gICAgfSxcbiAgICBnZXRPZmZzZXRZOiBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0eXBlb2YgdGhpcy52ZXJ0aWNhbEFsaWduID09PSAnbnVtYmVyJykge1xuICAgICAgICByZXR1cm4gdGhpcy52ZXJ0aWNhbEFsaWduO1xuICAgICAgfVxuICAgICAgcmV0dXJuIExhYmVsQXJlYS52ZXJ0aWNhbEFsaWduVG9PZmZzZXRNYXBbdGhpcy52ZXJ0aWNhbEFsaWduXSB8fCAwO1xuICAgIH0sXG5cbiAgICBnZXRPZmZzZXRYOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBMYWJlbEFyZWEuYWxpZ25Ub09mZnNldE1hcFt0aGlzLmFsaWduXSB8fCAwO1xuICAgIH0sXG5cbiAgICBnZXRUZXh0V2lkdGhDYWNoZTogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgY2FjaGUgPSB0ZXh0V2lkdGhDYWNoZVt0aGlzLmZvbnRdO1xuICAgICAgcmV0dXJuIGNhY2hlIHx8ICh0ZXh0V2lkdGhDYWNoZVt0aGlzLmZvbnRdID0ge30pO1xuICAgIH0sXG4gICAgXG4gICAgc3BsaWNlTGluZXM6IGZ1bmN0aW9uKGxpbmVzKSB7XG4gICAgICB2YXIgcm93V2lkdGggPSB0aGlzLndpZHRoO1xuICAgICAgdmFyIGNvbnRleHQgPSB0aGlzLmNhbnZhcy5jb250ZXh0O1xuICAgICAgY29udGV4dC5mb250ID0gdGhpcy5mb250O1xuXG4gICAgICB2YXIgY2FjaGUgPSB0aGlzLmdldFRleHRXaWR0aENhY2hlKCk7XG5cbiAgICAgIC8vIHVwZGF0ZSBjYWNoZVxuICAgICAgdGhpcy5fdGV4dC5lYWNoKGZ1bmN0aW9uKGNoKSB7XG4gICAgICAgIGlmICghY2FjaGVbY2hdKSB7XG4gICAgICAgICAgY2FjaGVbY2hdID0gY29udGV4dC5tZWFzdXJlVGV4dChjaCkud2lkdGg7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICB2YXIgbG9jYWxMaW5lcyA9IFtdO1xuICAgICAgbGluZXMuZm9yRWFjaChmdW5jdGlvbihsaW5lKSB7XG4gICAgICAgIFxuICAgICAgICB2YXIgc3RyID0gJyc7XG4gICAgICAgIHZhciB0b3RhbFdpZHRoID0gMDtcblxuICAgICAgICAvLyDjga/jgb/lh7rjgabjgYTjgZ/jgonlvLfliLbnmoTjgavmlLnooYzjgZnjgotcbiAgICAgICAgbGluZS5lYWNoKGZ1bmN0aW9uKGNoKSB7XG4gICAgICAgICAgdmFyIHcgPSBjYWNoZVtjaF07XG5cbiAgICAgICAgICBpZiAoKHRvdGFsV2lkdGgrdykgPiByb3dXaWR0aCkge1xuICAgICAgICAgICAgbG9jYWxMaW5lcy5wdXNoKHN0cik7XG4gICAgICAgICAgICBzdHIgPSAnJztcbiAgICAgICAgICAgIHRvdGFsV2lkdGggPSAwO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHN0ciArPSBjaDtcbiAgICAgICAgICB0b3RhbFdpZHRoICs9IHc7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIOaui+OCiuOCkiBwdXNoIOOBmeOCi1xuICAgICAgICBsb2NhbExpbmVzLnB1c2goc3RyKTtcblxuICAgICAgfSk7XG4gICAgICBcblxuICAgICAgcmV0dXJuIGxvY2FsTGluZXM7XG4gICAgfSxcbiAgICBcbiAgICBnZXRMaW5lczogZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodGhpcy5fbGluZVVwZGF0ZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xpbmVzO1xuICAgICAgfVxuICAgICAgdGhpcy5fbGluZVVwZGF0ZSA9IGZhbHNlO1xuXG4gICAgICB2YXIgbGluZXMgPSAodGhpcy50ZXh0ICsgJycpLnNwbGl0KCdcXG4nKTtcbiAgICAgIGlmICh0aGlzLndpZHRoIDwgMSkge1xuICAgICAgICB0aGlzLl9saW5lcyA9IGxpbmVzO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuX2xpbmVzID0gdGhpcy5zcGxpY2VMaW5lcyhsaW5lcyk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLl9saW5lcztcbiAgICB9LFxuXG4gICAgcHJlcmVuZGVyOiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICAgIHZhciBjb250ZXh0ID0gY2FudmFzLmNvbnRleHQ7XG4gICAgICBjb250ZXh0LmZvbnQgPSB0aGlzLmZvbnQ7XG4gICAgICBjb250ZXh0LnRleHRBbGlnbiA9IHRoaXMuYWxpZ247XG4gICAgICBjb250ZXh0LnRleHRCYXNlbGluZSA9IHRoaXMuYmFzZWxpbmU7XG5cbiAgICAgIHZhciB0ZXh0ID0gdGhpcy50ZXh0ICsgJyc7XG4gICAgICB2YXIgbGluZXMgPSB0aGlzLmdldExpbmVzKCk7XG4gICAgICB2YXIgbGVuZ3RoID0gbGluZXMubGVuZ3RoO1xuICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aDtcbiAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmhlaWdodDtcblxuICAgICAgdmFyIGZvbnRTaXplID0gdGhpcy5mb250U2l6ZTtcbiAgICAgIHZhciBsaW5lU2l6ZSA9IGZvbnRTaXplICogdGhpcy5saW5lSGVpZ2h0O1xuICAgICAgdmFyIG9mZnNldFggPSB0aGlzLmdldE9mZnNldFgoKSAqIHdpZHRoO1xuICAgICAgdmFyIG9mZnNldFkgPSB0aGlzLmdldE9mZnNldFkoKTtcbiAgICAgIGlmIChvZmZzZXRZID09PSAwKSB7XG4gICAgICAgIG9mZnNldFkgPSAtTWF0aC5mbG9vcihsZW5ndGggLyAyKSAqIGxpbmVTaXplO1xuICAgICAgICBvZmZzZXRZICs9ICgobGVuZ3RoICsgMSkgJSAyKSAqIChsaW5lU2l6ZSAvIDIpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAob2Zmc2V0WSA8IDApIHtcbiAgICAgICAgb2Zmc2V0WSAqPSBoZWlnaHQ7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgb2Zmc2V0WSA9IG9mZnNldFkgKiBoZWlnaHQgLSBsZW5ndGggKiBsaW5lU2l6ZSArIGxpbmVTaXplO1xuICAgICAgfVxuXG4gICAgICBvZmZzZXRZIC09IHRoaXMuc2Nyb2xsWTtcbiAgICAgIG9mZnNldFggLT0gdGhpcy5zY3JvbGxYO1xuICAgICAgdmFyIHN0YXJ0ID0gKG9mZnNldFkgKyBoZWlnaHQgLyAyKSAvIC1saW5lU2l6ZSB8IDA7XG4gICAgICBpZiAoc3RhcnQgPCAwKSB7IHN0YXJ0ID0gMDsgfVxuXG4gICAgICB2YXIgZW5kID0gKGhlaWdodCAvIDIgLSBvZmZzZXRZICsgbGluZVNpemUgKiAyKSAvIGxpbmVTaXplIHwgMDtcbiAgICAgIGxpbmVzID0gbGluZXMuZmlsdGVyKGZ1bmN0aW9uKGxpbmUsIGkpIHtcbiAgICAgICAgcmV0dXJuIHN0YXJ0IDw9IGkgJiYgZW5kID4gaTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmxpbmVzID0gbGluZXM7XG4gICAgICB0aGlzLm9mZnNldFggPSBvZmZzZXRYO1xuICAgICAgdGhpcy5vZmZzZXRZID0gb2Zmc2V0WTtcbiAgICAgIHRoaXMubGluZVNpemUgPSBsaW5lU2l6ZTtcbiAgICAgIHRoaXMuc3RhcnQgPSBzdGFydDtcbiAgICB9LFxuXG4gICAgcmVuZGVyRmlsbDogZnVuY3Rpb24oY2FudmFzKSB7XG4gICAgICB2YXIgY29udGV4dCA9IGNhbnZhcy5jb250ZXh0O1xuICAgICAgdmFyIG9mZnNldFggPSB0aGlzLm9mZnNldFg7XG4gICAgICB2YXIgb2Zmc2V0WSA9IHRoaXMub2Zmc2V0WTtcbiAgICAgIHZhciBsaW5lU2l6ZSA9IHRoaXMubGluZVNpemU7XG4gICAgICB2YXIgc3RhcnQgPSB0aGlzLnN0YXJ0O1xuICAgICAgdGhpcy5saW5lcy5mb3JFYWNoKGZ1bmN0aW9uKGxpbmUsIGkpIHtcbiAgICAgICAgY29udGV4dC5maWxsVGV4dChsaW5lLCBvZmZzZXRYLCAoc3RhcnQgKyBpKSAqIGxpbmVTaXplICsgb2Zmc2V0WSk7XG4gICAgICB9LCB0aGlzKTtcbiAgICB9LFxuXG4gICAgcmVuZGVyU3Ryb2tlOiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICAgIHZhciBjb250ZXh0ID0gY2FudmFzLmNvbnRleHQ7XG4gICAgICB2YXIgb2Zmc2V0WCA9IHRoaXMub2Zmc2V0WDtcbiAgICAgIHZhciBvZmZzZXRZID0gdGhpcy5vZmZzZXRZO1xuICAgICAgdmFyIGxpbmVTaXplID0gdGhpcy5saW5lU2l6ZTtcbiAgICAgIHZhciBzdGFydCA9IHRoaXMuc3RhcnQ7XG4gICAgICB0aGlzLmxpbmVzLmZvckVhY2goZnVuY3Rpb24obGluZSwgaSkge1xuICAgICAgICBjb250ZXh0LnN0cm9rZVRleHQobGluZSwgb2Zmc2V0WCwgKHN0YXJ0ICsgaSkgKiBsaW5lU2l6ZSArIG9mZnNldFkpO1xuICAgICAgfSwgdGhpcyk7XG4gICAgfSxcblxuICAgIF9hY2Nlc3Nvcjoge1xuICAgICAgdGV4dDoge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLl90ZXh0O1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgICB0aGlzLl90ZXh0ID0gdjtcbiAgICAgICAgfVxuICAgICAgfSxcblxuICAgICAgc2Nyb2xsWDoge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLnNjcm9sbC54O1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgICB0aGlzLnNjcm9sbC54ID0gdjtcbiAgICAgICAgfSxcbiAgICAgIH0sXG5cbiAgICAgIHNjcm9sbFk6IHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5zY3JvbGwueTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbih2KSB7XG4gICAgICAgICAgdGhpcy5zY3JvbGwueSA9IHY7XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gICAgX3N0YXRpYzoge1xuICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgdmVydGljYWxBbGlnbjogJ3RvcCcsXG4gICAgICAgIGFsaWduOiAnbGVmdCcsXG4gICAgICAgIGJhc2VsaW5lOiAndG9wJyxcbiAgICAgICAgd2lkdGg6IDMyMCxcbiAgICAgICAgaGVpZ2h0OiAzMjAsXG4gICAgICAgIHNjcm9sbFg6IDAsXG4gICAgICAgIHNjcm9sbFk6IDAsXG4gICAgICB9LFxuICAgICAgYWxpZ25Ub09mZnNldE1hcDoge1xuICAgICAgICBzdGFydDogLTAuNSxcbiAgICAgICAgbGVmdDogLTAuNSxcbiAgICAgICAgY2VudGVyOiAwLFxuICAgICAgICBlbmQ6IDAuNSxcbiAgICAgICAgcmlnaHQ6IDAuNSxcbiAgICAgIH0sXG5cbiAgICAgIHZlcnRpY2FsQWxpZ25Ub09mZnNldE1hcDoge1xuICAgICAgICB0b3A6IC0wLjUsXG4gICAgICAgIGNlbnRlcjogMCxcbiAgICAgICAgbWlkZGxlOiAwLFxuICAgICAgICBib3R0b206IDAuNSxcbiAgICAgIH0sXG4gICAgfSxcblxuICAgIF9kZWZpbmVkOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBmdW5jID0gZnVuY3Rpb24obmV3VmFsLCBvbGRWYWwpIHtcbiAgICAgICAgaWYoKHRoaXMuX2xpbmVVcGRhdGUgPT09IGZhbHNlKSAmJiAobmV3VmFsICE9PSBvbGRWYWwpKXtcbiAgICAgICAgICB0aGlzLl9saW5lVXBkYXRlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgW1xuICAgICAgICAndGV4dCcsXG4gICAgICAgICd3aWR0aCcsXG4gICAgICAgICdmb250U2l6ZScsXG4gICAgICAgICdmb250V2VpZ2h0JyxcbiAgICAgICAgJ2ZvbnRGYW1pbHknXG4gICAgICBdLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgIHRoaXMuJHdhdGNoKGtleSwgZnVuYyk7XG4gICAgICB9LCB0aGlzLnByb3RvdHlwZSk7XG5cbiAgICAgIHBoaW5hLmRpc3BsYXkuU2hhcGUud2F0Y2hSZW5kZXJQcm9wZXJ0aWVzLmNhbGwodGhpcyAsW1xuICAgICAgICAndmVydGljYWxBbGlnbicsXG4gICAgICAgICd0ZXh0JyxcbiAgICAgICAgJ3Njcm9sbCcsXG4gICAgICAgICdzY3JvbGxYJyxcbiAgICAgICAgJ3Njcm9sbFknXG4gICAgICBdKTtcbiAgICB9LFxuXG5cbiAgICBlbmFibGVTY3JvbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgLy8gICB0aGlzLnNldEludGVyYWN0aXZlKHRydWUpO1xuICAgICAgLy8gICB2YXIgcGh5c2ljYWwgPSBwaGluYS5hY2Nlc3NvcnkuUGh5c2ljYWwoKTtcbiAgICAgIC8vICAgcGh5c2ljYWwuYXR0YWNoVG8odGhpcyk7XG4gICAgICAvLyAgIHBoeXNpY2FsLmZyaWN0aW9uID0gMC44O1xuICAgICAgLy8gICB2YXIgbGFzdEZvcmNlID0gMDtcbiAgICAgIC8vICAgdmFyIGxhc3RNb3ZlID0gMDtcbiAgICAgIC8vICAgdGhpcy5vbigncG9pbnRzdGFydCcsIGZ1bmN0aW9uKGUpe1xuICAgICAgLy8gICAgIGxhc3RGb3JjZSA9IHBoeXNpY2FsLnZlbG9jaXR5Lnk7XG4gICAgICAvLyAgICAgbGFzdE1vdmUgPSAwO1xuICAgICAgLy8gICAgIHBoeXNpY2FsLmZvcmNlKDAsIDApO1xuICAgICAgLy8gICB9KTtcbiAgICAgIC8vICAgdGhpcy5vbigncG9pbnRtb3ZlJywgZnVuY3Rpb24oZSl7XG4gICAgICAvLyAgICAgdmFyIHAgPSBlLnBvaW50ZXIuZGVsdGFQb3NpdGlvbjtcbiAgICAgIC8vICAgICBsYXN0TW92ZSA9IHAueTtcbiAgICAgIC8vICAgICB0aGlzLnNjcm9sbFkgKz0gbGFzdE1vdmU7XG4gICAgICAvLyAgIH0pO1xuXG4gICAgICAvLyAgIHRoaXMub24oJ3BvaW50ZW5kJywgZnVuY3Rpb24oZSl7XG4gICAgICAvLyAgICAgcGh5c2ljYWwuZm9yY2UoMCwgbGFzdEZvcmNlICsgbGFzdE1vdmUpO1xuICAgICAgLy8gICB9KTtcblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICB9KTtcblxufSk7XG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmdhbWUuTWFuYWdlclNjZW5lXG4gICAqIEBleHRlbmRzIHBoaW5hLmFwcC5TY2VuZVxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5nYW1lLk1hbmFnZXJTY2VuZScsIHtcbiAgICBzdXBlckNsYXNzOiAncGhpbmEuYXBwLlNjZW5lJyxcbiAgICAvKipcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBpbml0OiBmdW5jdGlvbihwYXJhbXMpIHtcbiAgICAgIHRoaXMuc3VwZXJJbml0KCk7XG5cbiAgICAgIHRoaXMuc2V0U2NlbmVzKHBhcmFtcy5zY2VuZXMpO1xuXG4gICAgICB0aGlzLm9uKFwiZW50ZXJcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuZ290b1NjZW5lKHBhcmFtcy5zdGFydExhYmVsIHx8IDApO1xuICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgdGhpcy5vbihcInJlc3VtZVwiLCB0aGlzLm9ubmV4dC5iaW5kKHRoaXMpKTtcblxuICAgICAgdGhpcy5jb21tb25Bcmd1bWVudHMgPSB7fTtcbiAgICB9LFxuXG5cbiAgICAvKipcbiAgICAgKiBzY2VuZXMg44KS44K744OD44OIXG4gICAgICovXG4gICAgc2V0U2NlbmVzOiBmdW5jdGlvbihzY2VuZXMpIHtcbiAgICAgIHRoaXMuc2NlbmVzID0gc2NlbmVzO1xuICAgICAgdGhpcy5zY2VuZUluZGV4ID0gMDtcblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuXG4gICAgcmVwbGFjZVNjZW5lOiBmdW5jdGlvbihsYWJlbCwgYXJncykge1xuICAgICAgdmFyIGluZGV4ID0gKHR5cGVvZiBsYWJlbCA9PSAnc3RyaW5nJykgPyB0aGlzLmxhYmVsVG9JbmRleChsYWJlbCkgOiBsYWJlbHx8MDtcblxuICAgICAgdmFyIGRhdGEgPSB0aGlzLnNjZW5lc1tpbmRleF07XG5cbiAgICAgIGlmICghZGF0YSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdwaGluYS5qcyBlcnJvcjogYHswfWAg44Gr5a++5b+c44GZ44KL44K344O844Oz44GM44GC44KK44G+44Gb44KTLicuZm9ybWF0KGxhYmVsKSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBrbGFzcyA9IHBoaW5hLnVzaW5nKGRhdGEuY2xhc3NOYW1lKTtcbiAgICAgIGlmICh0eXBlb2Yga2xhc3MgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAga2xhc3MgPSBwaGluYS51c2luZygncGhpbmEuZ2FtZS4nICsgZGF0YS5jbGFzc05hbWUpO1xuICAgICAgfVxuXG4gICAgICB2YXIgaW5pdEFyZ3VtZW50cyA9IHt9LiRleHRlbmQoZGF0YS5hcmd1bWVudHMsIGFyZ3MpO1xuICAgICAgdmFyIHNjZW5lID0ga2xhc3MuY2FsbChudWxsLCBpbml0QXJndW1lbnRzKTtcbiAgICAgIGlmICghc2NlbmUubmV4dExhYmVsKSB7XG4gICAgICAgICAgc2NlbmUubmV4dExhYmVsID0gZGF0YS5uZXh0TGFiZWw7XG4gICAgICB9XG4gICAgICBpZiAoIXNjZW5lLm5leHRBcmd1bWVudHMpIHtcbiAgICAgICAgICBzY2VuZS5uZXh0QXJndW1lbnRzID0gZGF0YS5uZXh0QXJndW1lbnRzO1xuICAgICAgfVxuICAgICAgdGhpcy5hcHAucmVwbGFjZVNjZW5lKHNjZW5lKTtcblxuICAgICAgdGhpcy5zY2VuZUluZGV4ID0gaW5kZXg7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cblxuICAgIC8qKlxuICAgICAqIGluZGV4KG9yIGxhYmVsKSDjga7jgrfjg7zjg7Pjgbjpo5vjgbZcbiAgICAgKi9cbiAgICBnb3RvU2NlbmU6IGZ1bmN0aW9uKGxhYmVsLCBhcmdzKSB7XG4gICAgICB2YXIgaW5kZXggPSAodHlwZW9mIGxhYmVsID09ICdzdHJpbmcnKSA/IHRoaXMubGFiZWxUb0luZGV4KGxhYmVsKSA6IGxhYmVsfHwwO1xuXG4gICAgICB2YXIgZGF0YSA9IHRoaXMuc2NlbmVzW2luZGV4XTtcblxuICAgICAgaWYgKCFkYXRhKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ3BoaW5hLmpzIGVycm9yOiBgezB9YCDjgavlr77lv5zjgZnjgovjgrfjg7zjg7PjgYzjgYLjgorjgb7jgZvjgpMuJy5mb3JtYXQobGFiZWwpKTtcbiAgICAgIH1cblxuICAgICAgdmFyIGtsYXNzID0gcGhpbmEudXNpbmcoZGF0YS5jbGFzc05hbWUpO1xuICAgICAgaWYgKHR5cGVvZiBrbGFzcyAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBrbGFzcyA9IHBoaW5hLnVzaW5nKCdwaGluYS5nYW1lLicgKyBkYXRhLmNsYXNzTmFtZSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBpbml0QXJndW1lbnRzID0ge30uJGV4dGVuZChkYXRhLmFyZ3VtZW50cywgYXJncyk7XG4gICAgICB2YXIgc2NlbmUgPSBrbGFzcy5jYWxsKG51bGwsIGluaXRBcmd1bWVudHMpO1xuICAgICAgaWYgKCFzY2VuZS5uZXh0TGFiZWwpIHtcbiAgICAgICAgICBzY2VuZS5uZXh0TGFiZWwgPSBkYXRhLm5leHRMYWJlbDtcbiAgICAgIH1cbiAgICAgIGlmICghc2NlbmUubmV4dEFyZ3VtZW50cykge1xuICAgICAgICAgIHNjZW5lLm5leHRBcmd1bWVudHMgPSBkYXRhLm5leHRBcmd1bWVudHM7XG4gICAgICB9XG4gICAgICB0aGlzLmFwcC5wdXNoU2NlbmUoc2NlbmUpO1xuXG4gICAgICB0aGlzLnNjZW5lSW5kZXggPSBpbmRleDtcblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOasoeOBruOCt+ODvOODs+OBuOmjm+OBtlxuICAgICAqL1xuICAgIGdvdG9OZXh0OiBmdW5jdGlvbihhcmdzKSB7XG4gICAgICB2YXIgZGF0YSA9IHRoaXMuc2NlbmVzW3RoaXMuc2NlbmVJbmRleF07XG4gICAgICB2YXIgbmV4dEluZGV4ID0gbnVsbDtcblxuICAgICAgLy8g5qyh44Gu44Op44OZ44Or44GM6Kit5a6a44GV44KM44Gm44GE44Gf5aC05ZCIXG4gICAgICBpZiAoZGF0YS5uZXh0TGFiZWwpIHtcbiAgICAgICAgICBuZXh0SW5kZXggPSB0aGlzLmxhYmVsVG9JbmRleChkYXRhLm5leHRMYWJlbCk7XG4gICAgICB9XG4gICAgICAvLyDmrKHjga7jgrfjg7zjg7Pjgavpgbfnp7tcbiAgICAgIGVsc2UgaWYgKHRoaXMuc2NlbmVJbmRleCsxIDwgdGhpcy5zY2VuZXMubGVuZ3RoKSB7XG4gICAgICAgICAgbmV4dEluZGV4ID0gdGhpcy5zY2VuZUluZGV4KzE7XG4gICAgICB9XG5cbiAgICAgIGlmIChuZXh0SW5kZXggIT09IG51bGwpIHtcbiAgICAgICAgICB0aGlzLmdvdG9TY2VuZShuZXh0SW5kZXgsIGFyZ3MpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgICAgdGhpcy5mbGFyZShcImZpbmlzaFwiKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOOCt+ODvOODs+OCpOODs+ODh+ODg+OCr+OCueOCkuWPluW+l1xuICAgICAqL1xuICAgIGdldEN1cnJlbnRJbmRleDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5zY2VuZUluZGV4O1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDjgrfjg7zjg7Pjg6njg5njg6vjgpLlj5blvpdcbiAgICAgKi9cbiAgICBnZXRDdXJyZW50TGFiZWw6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuc2NlbmVzW3RoaXMuc2NlbmVJbmRleF0ubGFiZWw7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOODqeODmeODq+OBi+OCieOCpOODs+ODh+ODg+OCr+OCueOBq+WkieaPm1xuICAgICAqL1xuICAgIGxhYmVsVG9JbmRleDogZnVuY3Rpb24obGFiZWwpIHtcbiAgICAgIHZhciBkYXRhID0gdGhpcy5zY2VuZXMuZmlsdGVyKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgcmV0dXJuIGRhdGEubGFiZWwgPT0gbGFiZWw7XG4gICAgICB9KVswXTtcblxuICAgICAgcmV0dXJuIHRoaXMuc2NlbmVzLmluZGV4T2YoZGF0YSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOOCpOODs+ODh+ODg+OCr+OCueOBi+OCieODqeODmeODq+OBq+WkieaPm1xuICAgICAqL1xuICAgIGluZGV4VG9MYWJlbDogZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgIHJldHVybiB0aGlzLnNjZW5lc1tpbmRleF0ubGFiZWw7XG4gICAgfSxcblxuICAgIG9ubmV4dDogZnVuY3Rpb24oZSkge1xuICAgICAgdmFyIG5leHRMYWJlbCA9IGUucHJldlNjZW5lLm5leHRMYWJlbDtcbiAgICAgIHZhciBuZXh0QXJndW1lbnRzID0gZS5wcmV2U2NlbmUubmV4dEFyZ3VtZW50cztcbiAgICAgIGlmIChuZXh0TGFiZWwpIHtcbiAgICAgICAgdGhpcy5nb3RvU2NlbmUobmV4dExhYmVsLCBuZXh0QXJndW1lbnRzKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLmdvdG9OZXh0KG5leHRBcmd1bWVudHMpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgfSk7XG5cbn0pO1xuXG4vKlxuICpcbiAqL1xuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmdhbWUuU3BsYXNoU2NlbmVcbiAgICogQGV4dGVuZHMgcGhpbmEuZGlzcGxheS5EaXNwbGF5U2NlbmVcbiAgICovXG4gIHBoaW5hLmRlZmluZSgncGhpbmEuZ2FtZS5TcGxhc2hTY2VuZScsIHtcbiAgICBzdXBlckNsYXNzOiAncGhpbmEuZGlzcGxheS5EaXNwbGF5U2NlbmUnLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgdmFyIGRlZmF1bHRzID0gcGhpbmEuZ2FtZS5TcGxhc2hTY2VuZS5kZWZhdWx0cztcbiAgICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuXG4gICAgICB2YXIgdGV4dHVyZSA9IHBoaW5hLmFzc2V0LlRleHR1cmUoKTtcbiAgICAgIHRleHR1cmUubG9hZChkZWZhdWx0cy5pbWFnZVVSTCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5faW5pdCgpO1xuICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgIHRoaXMudGV4dHVyZSA9IHRleHR1cmU7XG4gICAgfSxcblxuICAgIF9pbml0OiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuc3ByaXRlID0gcGhpbmEuZGlzcGxheS5TcHJpdGUodGhpcy50ZXh0dXJlKS5hZGRDaGlsZFRvKHRoaXMpO1xuXG4gICAgICB0aGlzLnNwcml0ZS5zZXRQb3NpdGlvbih0aGlzLmdyaWRYLmNlbnRlcigpLCB0aGlzLmdyaWRZLmNlbnRlcigpKTtcbiAgICAgIHRoaXMuc3ByaXRlLmFscGhhID0gMDtcblxuICAgICAgdGhpcy5zcHJpdGUudHdlZW5lclxuICAgICAgICAuY2xlYXIoKVxuICAgICAgICAudG8oe2FscGhhOjF9LCA1MDAsICdlYXNlT3V0Q3ViaWMnKVxuICAgICAgICAud2FpdCgxMDAwKVxuICAgICAgICAudG8oe2FscGhhOjB9LCA1MDAsICdlYXNlT3V0Q3ViaWMnKVxuICAgICAgICAud2FpdCgyNTApXG4gICAgICAgIC5jYWxsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHRoaXMuZXhpdCgpO1xuICAgICAgICB9LCB0aGlzKVxuICAgICAgICA7XG4gICAgfSxcblxuICAgIF9zdGF0aWM6IHtcbiAgICAgIGRlZmF1bHRzOiB7XG4gICAgICAgIGltYWdlVVJMOiAnaHR0cDovL2Nkbi5yYXdnaXQuY29tL3BoaS1qcC9waGluYS5qcy9kZXZlbG9wL2xvZ28ucG5nJyxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbn0pO1xuXG4vKlxuICogVGl0bGVTY2VuZVxuICovXG5cblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEuZ2FtZS5UaXRsZVNjZW5lXG4gICAqIEBleHRlbmRzIHBoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmdhbWUuVGl0bGVTY2VuZScsIHtcbiAgICBzdXBlckNsYXNzOiAncGhpbmEuZGlzcGxheS5EaXNwbGF5U2NlbmUnLFxuICAgIC8qKlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGluaXQ6IGZ1bmN0aW9uKHBhcmFtcykge1xuICAgICAgcGFyYW1zID0gKHt9KS4kc2FmZShwYXJhbXMsIHBoaW5hLmdhbWUuVGl0bGVTY2VuZS5kZWZhdWx0cyk7XG4gICAgICB0aGlzLnN1cGVySW5pdChwYXJhbXMpO1xuXG4gICAgICB0aGlzLmJhY2tncm91bmRDb2xvciA9IHBhcmFtcy5iYWNrZ3JvdW5kQ29sb3I7XG5cbiAgICAgIHRoaXMuZnJvbUpTT04oe1xuICAgICAgICBjaGlsZHJlbjoge1xuICAgICAgICAgIHRpdGxlTGFiZWw6IHtcbiAgICAgICAgICAgIGNsYXNzTmFtZTogJ3BoaW5hLmRpc3BsYXkuTGFiZWwnLFxuICAgICAgICAgICAgYXJndW1lbnRzOiB7XG4gICAgICAgICAgICAgIHRleHQ6IHBhcmFtcy50aXRsZSxcbiAgICAgICAgICAgICAgZmlsbDogcGFyYW1zLmZvbnRDb2xvcixcbiAgICAgICAgICAgICAgc3Ryb2tlOiBmYWxzZSxcbiAgICAgICAgICAgICAgZm9udFNpemU6IDY0LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHg6IHRoaXMuZ3JpZFguY2VudGVyKCksXG4gICAgICAgICAgICB5OiB0aGlzLmdyaWRZLnNwYW4oNCksXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgaWYgKHBhcmFtcy5leGl0VHlwZSA9PT0gJ3RvdWNoJykge1xuICAgICAgICB0aGlzLmZyb21KU09OKHtcbiAgICAgICAgICBjaGlsZHJlbjoge1xuICAgICAgICAgICAgdG91Y2hMYWJlbDoge1xuICAgICAgICAgICAgICBjbGFzc05hbWU6ICdwaGluYS5kaXNwbGF5LkxhYmVsJyxcbiAgICAgICAgICAgICAgYXJndW1lbnRzOiB7XG4gICAgICAgICAgICAgICAgdGV4dDogXCJUT1VDSCBTVEFSVFwiLFxuICAgICAgICAgICAgICAgIGZpbGw6IHBhcmFtcy5mb250Q29sb3IsXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBmb250U2l6ZTogMzIsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHg6IHRoaXMuZ3JpZFguY2VudGVyKCksXG4gICAgICAgICAgICAgIHk6IHRoaXMuZ3JpZFkuc3BhbigxMiksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMub24oJ3BvaW50ZW5kJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdGhpcy5leGl0KCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBfc3RhdGljOiB7XG4gICAgICBkZWZhdWx0czoge1xuICAgICAgICB0aXRsZTogJ3BoaW5hLmpzIGdhbWVzJyxcbiAgICAgICAgbWVzc2FnZTogJycsXG5cbiAgICAgICAgZm9udENvbG9yOiAnd2hpdGUnLFxuICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICdoc2woMjAwLCA4MCUsIDY0JSknLFxuICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6ICcnLFxuXG4gICAgICAgIGV4aXRUeXBlOiAndG91Y2gnLFxuICAgICAgfSxcbiAgICB9LFxuXG4gIH0pO1xuXG59KTtcblxuLypcbiAqIFJlc3VsdFNjZW5lXG4gKi9cblxuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5nYW1lLlJlc3VsdFNjZW5lXG4gICAqIEBleHRlbmRzIHBoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmdhbWUuUmVzdWx0U2NlbmUnLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lJyxcbiAgICAvKipcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBpbml0OiBmdW5jdGlvbihwYXJhbXMpIHtcbiAgICAgIHBhcmFtcyA9ICh7fSkuJHNhZmUocGFyYW1zLCBwaGluYS5nYW1lLlJlc3VsdFNjZW5lLmRlZmF1bHRzKTtcbiAgICAgIHRoaXMuc3VwZXJJbml0KHBhcmFtcyk7XG5cbiAgICAgIHZhciBtZXNzYWdlID0gcGFyYW1zLm1lc3NhZ2UuZm9ybWF0KHBhcmFtcyk7XG5cbiAgICAgIHRoaXMuYmFja2dyb3VuZENvbG9yID0gcGFyYW1zLmJhY2tncm91bmRDb2xvcjtcblxuICAgICAgdGhpcy5mcm9tSlNPTih7XG4gICAgICAgIGNoaWxkcmVuOiB7XG4gICAgICAgICAgc2NvcmVUZXh0OiB7XG4gICAgICAgICAgICBjbGFzc05hbWU6ICdwaGluYS5kaXNwbGF5LkxhYmVsJyxcbiAgICAgICAgICAgIGFyZ3VtZW50czoge1xuICAgICAgICAgICAgICB0ZXh0OiAnc2NvcmUnLFxuICAgICAgICAgICAgICBmaWxsOiBwYXJhbXMuZm9udENvbG9yLFxuICAgICAgICAgICAgICBzdHJva2U6IG51bGwsXG4gICAgICAgICAgICAgIGZvbnRTaXplOiA0OCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB4OiB0aGlzLmdyaWRYLnNwYW4oOCksXG4gICAgICAgICAgICB5OiB0aGlzLmdyaWRZLnNwYW4oNCksXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzY29yZUxhYmVsOiB7XG4gICAgICAgICAgICBjbGFzc05hbWU6ICdwaGluYS5kaXNwbGF5LkxhYmVsJyxcbiAgICAgICAgICAgIGFyZ3VtZW50czoge1xuICAgICAgICAgICAgICB0ZXh0OiBwYXJhbXMuc2NvcmUrJycsXG4gICAgICAgICAgICAgIGZpbGw6IHBhcmFtcy5mb250Q29sb3IsXG4gICAgICAgICAgICAgIHN0cm9rZTogbnVsbCxcbiAgICAgICAgICAgICAgZm9udFNpemU6IDcyLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHg6IHRoaXMuZ3JpZFguc3Bhbig4KSxcbiAgICAgICAgICAgIHk6IHRoaXMuZ3JpZFkuc3Bhbig2KSxcbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgbWVzc2FnZUxhYmVsOiB7XG4gICAgICAgICAgICBjbGFzc05hbWU6ICdwaGluYS5kaXNwbGF5LkxhYmVsJyxcbiAgICAgICAgICAgIGFyZ3VtZW50czoge1xuICAgICAgICAgICAgICB0ZXh0OiBtZXNzYWdlLFxuICAgICAgICAgICAgICBmaWxsOiBwYXJhbXMuZm9udENvbG9yLFxuICAgICAgICAgICAgICBzdHJva2U6IG51bGwsXG4gICAgICAgICAgICAgIGZvbnRTaXplOiAzMixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB4OiB0aGlzLmdyaWRYLmNlbnRlcigpLFxuICAgICAgICAgICAgeTogdGhpcy5ncmlkWS5zcGFuKDkpLFxuICAgICAgICAgIH0sXG5cbiAgICAgICAgICBzaGFyZUJ1dHRvbjoge1xuICAgICAgICAgICAgY2xhc3NOYW1lOiAncGhpbmEudWkuQnV0dG9uJyxcbiAgICAgICAgICAgIGFyZ3VtZW50czogW3tcbiAgICAgICAgICAgICAgdGV4dDogJ+KYhScsXG4gICAgICAgICAgICAgIHdpZHRoOiAxMjgsXG4gICAgICAgICAgICAgIGhlaWdodDogMTI4LFxuICAgICAgICAgICAgICBmb250Q29sb3I6IHBhcmFtcy5mb250Q29sb3IsXG4gICAgICAgICAgICAgIGZvbnRTaXplOiA1MCxcbiAgICAgICAgICAgICAgY29ybmVyUmFkaXVzOiA2NCxcbiAgICAgICAgICAgICAgZmlsbDogJ3JnYmEoMjQwLCAyNDAsIDI0MCwgMC41KScsXG4gICAgICAgICAgICAgIC8vIHN0cm9rZTogJyNhYWEnLFxuICAgICAgICAgICAgICAvLyBzdHJva2VXaWR0aDogMixcbiAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgeDogdGhpcy5ncmlkWC5jZW50ZXIoLTMpLFxuICAgICAgICAgICAgeTogdGhpcy5ncmlkWS5zcGFuKDEyKSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBsYXlCdXR0b246IHtcbiAgICAgICAgICAgIGNsYXNzTmFtZTogJ3BoaW5hLnVpLkJ1dHRvbicsXG4gICAgICAgICAgICBhcmd1bWVudHM6IFt7XG4gICAgICAgICAgICAgIHRleHQ6ICfilrYnLFxuICAgICAgICAgICAgICB3aWR0aDogMTI4LFxuICAgICAgICAgICAgICBoZWlnaHQ6IDEyOCxcbiAgICAgICAgICAgICAgZm9udENvbG9yOiBwYXJhbXMuZm9udENvbG9yLFxuICAgICAgICAgICAgICBmb250U2l6ZTogNTAsXG4gICAgICAgICAgICAgIGNvcm5lclJhZGl1czogNjQsXG4gICAgICAgICAgICAgIGZpbGw6ICdyZ2JhKDI0MCwgMjQwLCAyNDAsIDAuNSknLFxuICAgICAgICAgICAgICAvLyBzdHJva2U6ICcjYWFhJyxcbiAgICAgICAgICAgICAgLy8gc3Ryb2tlV2lkdGg6IDIsXG4gICAgICAgICAgICB9XSxcbiAgICAgICAgICAgIHg6IHRoaXMuZ3JpZFguY2VudGVyKDMpLFxuICAgICAgICAgICAgeTogdGhpcy5ncmlkWS5zcGFuKDEyKSxcblxuICAgICAgICAgICAgaW50ZXJhY3RpdmU6IHRydWUsXG4gICAgICAgICAgICBvbnB1c2g6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICB0aGlzLmV4aXQoKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgaWYgKHBhcmFtcy5leGl0VHlwZSA9PT0gJ3RvdWNoJykge1xuICAgICAgICB0aGlzLm9uKCdwb2ludGVuZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHRoaXMuZXhpdCgpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5zaGFyZUJ1dHRvbi5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0ZXh0ID0gJ1Njb3JlOiB7MH1cXG57MX0nLmZvcm1hdChwYXJhbXMuc2NvcmUsIG1lc3NhZ2UpO1xuICAgICAgICB2YXIgdXJsID0gcGhpbmEuc29jaWFsLlR3aXR0ZXIuY3JlYXRlVVJMKHtcbiAgICAgICAgICB0ZXh0OiB0ZXh0LFxuICAgICAgICAgIGhhc2h0YWdzOiBwYXJhbXMuaGFzaHRhZ3MsXG4gICAgICAgICAgdXJsOiBwYXJhbXMudXJsLFxuICAgICAgICB9KTtcbiAgICAgICAgd2luZG93Lm9wZW4odXJsLCAnc2hhcmUgd2luZG93JywgJ3dpZHRoPTQ4MCwgaGVpZ2h0PTMyMCcpO1xuICAgICAgfTtcbiAgICB9LFxuXG4gICAgX3N0YXRpYzoge1xuICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgc2NvcmU6IDE2LFxuXG4gICAgICAgIG1lc3NhZ2U6ICd0aGlzIGlzIHBoaW5hLmpzIHByb2plY3QuJyxcbiAgICAgICAgaGFzaHRhZ3M6ICdwaGluYV9qcyxnYW1lLGphdmFzY3JpcHQnLFxuICAgICAgICB1cmw6IHBoaW5hLmdsb2JhbC5sb2NhdGlvbiAmJiBwaGluYS5nbG9iYWwubG9jYXRpb24uaHJlZixcblxuICAgICAgICBmb250Q29sb3I6ICd3aGl0ZScsXG4gICAgICAgIGJhY2tncm91bmRDb2xvcjogJ2hzbCgyMDAsIDgwJSwgNjQlKScsXG4gICAgICAgIGJhY2tncm91bmRJbWFnZTogJycsXG4gICAgICB9LFxuICAgIH0sXG5cbiAgfSk7XG5cbn0pO1xuXG4vKlxuICogTG9hZGluZ1NjZW5lXG4gKi9cblxuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5nYW1lLkxvYWRpbmdTY2VuZVxuICAgKiBAZXh0ZW5kcyBwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZVxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5nYW1lLkxvYWRpbmdTY2VuZScsIHtcbiAgICBzdXBlckNsYXNzOiAncGhpbmEuZGlzcGxheS5EaXNwbGF5U2NlbmUnLFxuXG4gICAgLyoqXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgb3B0aW9ucyA9ICh7fSkuJHNhZmUob3B0aW9ucywgcGhpbmEuZ2FtZS5Mb2FkaW5nU2NlbmUuZGVmYXVsdHMpO1xuICAgICAgdGhpcy5zdXBlckluaXQob3B0aW9ucyk7XG5cbiAgICAgIHRoaXMuZnJvbUpTT04oe1xuICAgICAgICBjaGlsZHJlbjoge1xuICAgICAgICAgIGdhdWdlOiB7XG4gICAgICAgICAgICBjbGFzc05hbWU6ICdwaGluYS51aS5HYXVnZScsXG4gICAgICAgICAgICBhcmd1bWVudHM6IHtcbiAgICAgICAgICAgICAgdmFsdWU6IDAsXG4gICAgICAgICAgICAgIHdpZHRoOiB0aGlzLndpZHRoLFxuICAgICAgICAgICAgICBoZWlnaHQ6IDEyLFxuICAgICAgICAgICAgICBmaWxsOiAnI2FhYScsXG4gICAgICAgICAgICAgIHN0cm9rZTogZmFsc2UsXG4gICAgICAgICAgICAgIGdhdWdlQ29sb3I6ICdoc2xhKDIwMCwgMTAwJSwgODAlLCAwLjgpJyxcbiAgICAgICAgICAgICAgcGFkZGluZzogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB4OiB0aGlzLmdyaWRYLmNlbnRlcigpLFxuICAgICAgICAgICAgeTogMCxcbiAgICAgICAgICAgIG9yaWdpblk6IDAsXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgdmFyIGxvYWRlciA9IHBoaW5hLmFzc2V0LkFzc2V0TG9hZGVyKCk7XG5cbiAgICAgIGlmIChvcHRpb25zLmxpZSkge1xuICAgICAgICB0aGlzLmdhdWdlLmFuaW1hdGlvblRpbWUgPSAxMCoxMDAwO1xuICAgICAgICB0aGlzLmdhdWdlLnZhbHVlID0gOTA7XG5cbiAgICAgICAgbG9hZGVyLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHRoaXMuZ2F1Z2UuYW5pbWF0aW9uVGltZSA9IDA7XG4gICAgICAgICAgdGhpcy5nYXVnZS52YWx1ZSA9IDEwMDtcbiAgICAgICAgfS5iaW5kKHRoaXMpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuZ2F1Z2UuYW5pbWF0aW9uVGltZSA9IDEwMDtcbiAgICAgICAgbG9hZGVyLm9ucHJvZ3Jlc3MgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgdGhpcy5nYXVnZS52YWx1ZSA9IGUucHJvZ3Jlc3MgKiAxMDA7XG4gICAgICAgIH0uYmluZCh0aGlzKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5nYXVnZS5vbmZ1bGwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMuZXhpdFR5cGUgPT09ICdhdXRvJykge1xuICAgICAgICAgIHRoaXMuYXBwLnBvcFNjZW5lKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5mbGFyZSgnbG9hZGVkJyk7XG4gICAgICB9LmJpbmQodGhpcyk7XG5cbiAgICAgIGxvYWRlci5sb2FkKG9wdGlvbnMuYXNzZXRzKTtcbiAgICB9LFxuXG4gICAgX3N0YXRpYzoge1xuICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgZXhpdFR5cGU6ICdhdXRvJyxcblxuICAgICAgICBsaWU6IGZhbHNlLFxuICAgICAgfSxcbiAgICB9LFxuXG4gIH0pO1xuXG59KTtcblxuLypcbiAqIENvdW50U2NlbmVcbiAqL1xuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmdhbWUuQ291bnRTY2VuZVxuICAgKiBAZXh0ZW5kcyBwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZVxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5nYW1lLkNvdW50U2NlbmUnLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lJyxcbiAgICAvKipcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICB0aGlzLnN1cGVySW5pdChvcHRpb25zKTtcblxuICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kc2FmZShwaGluYS5nYW1lLkNvdW50U2NlbmUuZGVmYXVsdHMpO1xuXG4gICAgICB0aGlzLmJhY2tncm91bmRDb2xvciA9IG9wdGlvbnMuYmFja2dyb3VuZENvbG9yO1xuXG4gICAgICB0aGlzLmZyb21KU09OKHtcbiAgICAgICAgY2hpbGRyZW46IHtcbiAgICAgICAgICBsYWJlbDoge1xuICAgICAgICAgICAgY2xhc3NOYW1lOiAncGhpbmEuZGlzcGxheS5MYWJlbCcsXG4gICAgICAgICAgICBhcmd1bWVudHM6IHtcbiAgICAgICAgICAgICAgZmlsbDogb3B0aW9ucy5mb250Q29sb3IsXG4gICAgICAgICAgICAgIGZvbnRTaXplOiBvcHRpb25zLmZvbnRTaXplLFxuICAgICAgICAgICAgICBzdHJva2U6IGZhbHNlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHg6IHRoaXMuZ3JpZFguY2VudGVyKCksXG4gICAgICAgICAgICB5OiB0aGlzLmdyaWRZLmNlbnRlcigpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBpZiAob3B0aW9ucy5jb3VudCBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgIHRoaXMuY291bnRMaXN0ID0gb3B0aW9ucy5jb3VudC5yZXZlcnNlKCk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy5jb3VudExpc3QgPSBBcnJheS5yYW5nZSgxLCBvcHRpb25zLmNvdW50KzEpO1xuICAgICAgfVxuICAgICAgdGhpcy5jb3VudGVyID0gdGhpcy5jb3VudExpc3QubGVuZ3RoO1xuICAgICAgdGhpcy5leGl0VHlwZSA9IG9wdGlvbnMuZXhpdFR5cGU7XG5cbiAgICAgIHRoaXMuX3VwZGF0ZUNvdW50KCk7XG4gICAgfSxcblxuICAgIF91cGRhdGVDb3VudDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZW5kRmxhZyA9IHRoaXMuY291bnRlciA8PSAwO1xuICAgICAgdmFyIGluZGV4ID0gLS10aGlzLmNvdW50ZXI7XG5cbiAgICAgIHRoaXMubGFiZWwudGV4dCA9IHRoaXMuY291bnRMaXN0W2luZGV4XTtcblxuICAgICAgdGhpcy5sYWJlbC5zY2FsZS5zZXQoMSwgMSk7XG4gICAgICB0aGlzLmxhYmVsLnR3ZWVuZXJcbiAgICAgICAgLmNsZWFyKClcbiAgICAgICAgLnRvKHtcbiAgICAgICAgICBzY2FsZVg6IDEsXG4gICAgICAgICAgc2NhbGVZOiAxLFxuICAgICAgICAgIGFscGhhOiAxLFxuICAgICAgICB9LCAyNTApXG4gICAgICAgIC53YWl0KDUwMClcbiAgICAgICAgLnRvKHtcbiAgICAgICAgICBzY2FsZVg6IDEuNSxcbiAgICAgICAgICBzY2FsZVk6IDEuNSxcbiAgICAgICAgICBhbHBoYTogMC4wXG4gICAgICAgIH0sIDI1MClcbiAgICAgICAgLmNhbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYgKHRoaXMuY291bnRlciA8PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmZsYXJlKCdmaW5pc2gnKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmV4aXRUeXBlID09PSAnYXV0bycpIHtcbiAgICAgICAgICAgICAgdGhpcy5hcHAucG9wU2NlbmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl91cGRhdGVDb3VudCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgdGhpcyk7XG4gICAgfSxcblxuXG4gICAgX3N0YXRpYzoge1xuICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgY291bnQ6IDMsXG5cbiAgICAgICAgd2lkdGg6IDY0MCxcbiAgICAgICAgaGVpZ2h0OiA5NjAsXG5cbiAgICAgICAgZm9udENvbG9yOiAnd2hpdGUnLFxuICAgICAgICBmb250U2l6ZTogMTY0LFxuICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICdyZ2JhKDUwLCA1MCwgNTAsIDEpJyxcblxuICAgICAgICBleGl0VHlwZTogJ2F1dG8nLFxuICAgICAgfSxcbiAgICB9LFxuXG4gIH0pO1xuXG59KTtcblxuLypcbiAqIFBhdXNlU2NlbmVcbiAqL1xuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmdhbWUuUGF1c2VTY2VuZVxuICAgKiBAZXh0ZW5kcyBwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZVxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5nYW1lLlBhdXNlU2NlbmUnLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lJyxcbiAgICAvKipcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBpbml0OiBmdW5jdGlvbihwYXJhbXMpIHtcbiAgICAgIHBhcmFtcyA9ICh7fSkuJHNhZmUocGFyYW1zLCBwaGluYS5nYW1lLlBhdXNlU2NlbmUuZGVmYXVsdHMpO1xuICAgICAgdGhpcy5zdXBlckluaXQocGFyYW1zKTtcblxuICAgICAgdGhpcy5iYWNrZ3JvdW5kQ29sb3IgPSBwYXJhbXMuYmFja2dyb3VuZENvbG9yO1xuXG4gICAgICB0aGlzLmZyb21KU09OKHtcbiAgICAgICAgY2hpbGRyZW46IHtcbiAgICAgICAgICB0ZXh0OiB7XG4gICAgICAgICAgICBjbGFzc05hbWU6ICdwaGluYS5kaXNwbGF5LkxhYmVsJyxcbiAgICAgICAgICAgIGFyZ3VtZW50czoge1xuICAgICAgICAgICAgICB0ZXh0OiAnUGF1c2UnLFxuICAgICAgICAgICAgICBmaWxsOiBwYXJhbXMuZm9udENvbG9yLFxuICAgICAgICAgICAgICBzdHJva2U6IG51bGwsXG4gICAgICAgICAgICAgIGZvbnRTaXplOiA0OCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB4OiB0aGlzLmdyaWRYLmNlbnRlcigpLFxuICAgICAgICAgICAgeTogdGhpcy5ncmlkWS5jZW50ZXIoKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgaWYgKHBhcmFtcy5leGl0VHlwZSA9PT0gJ3RvdWNoJykge1xuICAgICAgICB0aGlzLm9uKCdwb2ludGVuZCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHRoaXMuZXhpdCgpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX3N0YXRpYzoge1xuICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgZm9udENvbG9yOiAnd2hpdGUnLFxuICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICdoc2xhKDAsIDAlLCAwJSwgMC44NSknLFxuXG4gICAgICAgIGV4aXRUeXBlOiAndG91Y2gnLFxuICAgICAgfSxcbiAgICB9LFxuXG4gIH0pO1xuXG59KTtcblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEuZ2FtZS5HYW1lQXBwXG4gICAqIEBleHRlbmRzIHBoaW5hLmRpc3BsYXkuQ2FudmFzQXBwXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmdhbWUuR2FtZUFwcCcsIHtcbiAgICBzdXBlckNsYXNzOiAncGhpbmEuZGlzcGxheS5DYW52YXNBcHAnLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuXG4gICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRzYWZlKHtcbiAgICAgICAgc3RhcnRMYWJlbDogJ3RpdGxlJyxcbiAgICAgIH0pO1xuICAgICAgdGhpcy5zdXBlckluaXQob3B0aW9ucyk7XG5cbiAgICAgIHZhciBzdGFydExhYmVsID0gb3B0aW9ucy5zdGFydExhYmVsIHx8ICd0aXRsZSc7XG5cbiAgICAgIHZhciBzY2VuZXMgPSBvcHRpb25zLnNjZW5lcyB8fCBbXG4gICAgICAgIHtcbiAgICAgICAgICBjbGFzc05hbWU6ICdTcGxhc2hTY2VuZScsXG4gICAgICAgICAgbGFiZWw6ICdzcGxhc2gnLFxuICAgICAgICAgIG5leHRMYWJlbDogJ3RpdGxlJyxcbiAgICAgICAgfSxcblxuICAgICAgICB7XG4gICAgICAgICAgY2xhc3NOYW1lOiAnVGl0bGVTY2VuZScsXG4gICAgICAgICAgbGFiZWw6ICd0aXRsZScsXG4gICAgICAgICAgbmV4dExhYmVsOiAnbWFpbicsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBjbGFzc05hbWU6ICdNYWluU2NlbmUnLFxuICAgICAgICAgIGxhYmVsOiAnbWFpbicsXG4gICAgICAgICAgbmV4dExhYmVsOiAncmVzdWx0JyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGNsYXNzTmFtZTogJ1Jlc3VsdFNjZW5lJyxcbiAgICAgICAgICBsYWJlbDogJ3Jlc3VsdCcsXG4gICAgICAgICAgbmV4dExhYmVsOiAndGl0bGUnLFxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgc2NlbmVzID0gc2NlbmVzLmVhY2goZnVuY3Rpb24ocykge1xuICAgICAgICBzLmFyZ3VtZW50cyA9IHMuYXJndW1lbnRzIHx8IG9wdGlvbnM7XG4gICAgICB9KTtcblxuICAgICAgdmFyIHNjZW5lID0gcGhpbmEuZ2FtZS5NYW5hZ2VyU2NlbmUoe1xuICAgICAgICBzdGFydExhYmVsOiBzdGFydExhYmVsLFxuICAgICAgICBzY2VuZXM6IHNjZW5lcyxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAob3B0aW9ucy5hc3NldHMpIHtcbiAgICAgICAgdmFyIGxvYWRpbmdPcHRpb25zID0gKHt9KS4kZXh0ZW5kKG9wdGlvbnMsIHtcbiAgICAgICAgICBleGl0VHlwZTogJycsXG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgbG9hZGluZ0NsYXNzID0gcGhpbmEuZ2xvYmFsLkxvYWRpbmdTY2VuZSB8fCBwaGluYS5nYW1lLkxvYWRpbmdTY2VuZTtcbiAgICAgICAgdmFyIGxvYWRpbmcgPSBsb2FkaW5nQ2xhc3MobG9hZGluZ09wdGlvbnMpO1xuICAgICAgICB0aGlzLnJlcGxhY2VTY2VuZShsb2FkaW5nKTtcblxuICAgICAgICBsb2FkaW5nLm9ubG9hZGVkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdGhpcy5yZXBsYWNlU2NlbmUoc2NlbmUpO1xuICAgICAgICAgIGlmIChvcHRpb25zLmRlYnVnKSB7XG4gICAgICAgICAgICB0aGlzLl9lbmFibGVEZWJ1Z2dlcigpO1xuICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpO1xuXG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy5yZXBsYWNlU2NlbmUoc2NlbmUpO1xuICAgICAgICBpZiAob3B0aW9ucy5kZWJ1Zykge1xuICAgICAgICAgIHRoaXMuX2VuYWJsZURlYnVnZ2VyKCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8g6Ieq5YuV44Gn44Od44O844K644GZ44KLXG4gICAgICBpZiAob3B0aW9ucy5hdXRvUGF1c2UpIHtcbiAgICAgICAgdGhpcy5vbignYmx1cicsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZhciBwYXVzZVNjZW5lID0gcGhpbmEuZ2FtZS5QYXVzZVNjZW5lKCk7XG4gICAgICAgICAgdGhpcy5wdXNoU2NlbmUocGF1c2VTY2VuZSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBfZW5hYmxlRGVidWdnZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKHRoaXMuZ3VpKSByZXR1cm4gO1xuXG4gICAgICB0aGlzLmVuYWJsZURhdEdVSShmdW5jdGlvbihndWkpIHtcbiAgICAgICAgdmFyIGYgPSBndWkuYWRkRm9sZGVyKCdzY2VuZXMnKTtcbiAgICAgICAgdmFyIGZ1bmNzID0ge307XG4gICAgICAgIHRoaXMucm9vdFNjZW5lLnNjZW5lcy5lYWNoKGZ1bmN0aW9uKHNjZW5lKSB7XG4gICAgICAgICAgZnVuY3Nbc2NlbmUubGFiZWxdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLnJvb3RTY2VuZS5yZXBsYWNlU2NlbmUoc2NlbmUubGFiZWwpO1xuICAgICAgICAgICAgY29uc29sZS5sb2codGhpcy5fc2NlbmVzLmxlbmd0aCk7XG4gICAgICAgICAgfS5iaW5kKHRoaXMpO1xuICAgICAgICAgIHJldHVybiBzY2VuZTtcbiAgICAgICAgfSwgdGhpcyk7XG5cbiAgICAgICAgZnVuY3MuZm9ySW4oZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuICAgICAgICAgIGYuYWRkKGZ1bmNzLCBrZXkpO1xuICAgICAgICB9KTtcbiAgICAgICAgZi5vcGVuKCk7XG5cbiAgICAgICAgdGhpcy5ndWkgPSBndWk7XG4gICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0sXG4gIH0pO1xuXG59KTtcblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgcGhpbmEuc29jaWFsLlR3aXR0ZXJcbiAgICogIyBUd2l0dGVyIOOBruWFseacieODquODs+OCr+OCkueUn+aIkOOBmeOCi+OCr+ODqeOCuVxuICAgKiBUd2l0dGVyIOOBruWFseacieODquODs+OCr+OBriBVUkwg44KS55Sf5oiQ44GX44Gm44GP44KM44KL44Kv44Op44K544Gn44GZ44CCXG4gICAqL1xuICBwaGluYS5kZWZpbmUoJ3BoaW5hLnNvY2lhbC5Ud2l0dGVyJywge1xuICAgIC8qKlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIFxuICAgICAqIOOCs+ODs+OCueODiOODqeOCr+OCv+OBr+WtmOWcqOOBl+OBvuOBmeOBjOOCpOODs+OCueOCv+ODs+OCueODoeODs+ODkOOBr+OBguOCiuOBvuOBm+OCk+OAglxuICAgICAqL1xuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgIH0sXG5cbiAgICBfc3RhdGljOiB7XG4gICAgICAvKipcbiAgICAgICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBbcGhpbmEuc29jaWFsLlR3aXR0ZXIuYmFzZVVSTCA9ICdodHRwczovL3R3aXR0ZXIuY29tL2ludGVudCddXG4gICAgICAgKiBUd2l0dGVyIOOBruWFseacieODquODs+OCr+OBruODmeODvOOCueOBqOOBquOCiyBVUkwg44Gn44GZ44CCXG4gICAgICAgKiBcbiAgICAgICAqIEBzdGF0aWNcbiAgICAgICAqL1xuICAgICAgYmFzZVVSTDogJ2h0dHBzOi8vdHdpdHRlci5jb20vaW50ZW50JyxcblxuICAgICAgLyoqXG4gICAgICAgKiBAcHJvcGVydHkge09iamVjdH0gcGhpbmEuc29jaWFsLlR3aXR0ZXIuZGVmYXVsdHNcbiAgICAgICAqIOODh+ODleOCqeODq+ODiOWApOOCkuagvOe0jeOBl+OBpuOBhOOCi+OCquODluOCuOOCp+OCr+ODiOOBp+OBmeOAgntAbGluayAjcGhpbmEuc29jaWFsLlR3aXR0ZXIuZGVmYXVsdHMudGV4dH0sIHtAbGluayAjcGhpbmEuc29jaWFsLlR3aXR0ZXIuZGVmYXVsdHMuaGFzaHRhZ3N9LCB7QGxpbmsgI3BoaW5hLnNvY2lhbC5Ud2l0dGVyLmRlZmF1bHRzLnVybH0g44KS5YaF5YyF44GX44Gm44GE44G+44GZ44CCXG4gICAgICAgKiBcbiAgICAgICAqIEBzdGF0aWNcbiAgICAgICAqL1xuICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgLy8gdHlwZTogJ3R3ZWV0JyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBbcGhpbmEuc29jaWFsLlR3aXR0ZXIuZGVmYXVsdHMudGV4dCA9ICdIZWxsbywgV29ybGQnXVxuICAgICAgICAgKiDjg4fjg5Xjgqnjg6vjg4jjgafjg4TjgqTjg7zjg4jjgavlkKvjgb7jgozjgovmloflrZfliJfjgafjgZnjgIJcbiAgICAgICAgICogXG4gICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICovXG4gICAgICAgIHRleHQ6ICdIZWxsbywgd29ybGQhJyxcblxuICAgICAgICAvLyBzY3JlZW5fbmFtZTogJ3BoaV9qcCcsXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBbcGhpbmEuc29jaWFsLlR3aXR0ZXIuZGVmYXVsdHMuaGFzaHRhZ3MgPSAnamF2YXNjcmlwdCwgcGhpbmFfanMnXVxuICAgICAgICAgKiDjg4fjg5Xjgqnjg6vjg4jjgafjg4TjgqTjg7zjg4jjgavlkKvjgb7jgozjgovjg4/jg4Pjgrfjg6Xjgr/jgrDjgafjgZnjgIJcbiAgICAgICAgICogXG4gICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICovXG4gICAgICAgIGhhc2h0YWdzOiAnamF2YXNjcmlwdCxwaGluYV9qcycsXG5cbiAgICAgICAgLy8gdXJsOiAnaHR0cDovL2dpdGh1Yi5jb20vcGhpLWpwL3BoaW5hLmpzJyxcblxuICAgICAgICAvKipcbiAgICAgICAgICogQHByb3BlcnR5IHtTdHJpbmd9IFtwaGluYS5zb2NpYWwuVHdpdHRlci5kZWZhdWx0cy51cmwgPSBwaGluYS5nbG9iYWwubG9jYXRpb24gJiYgcGhpbmEuZ2xvYmFsLmxvY2F0aW9uLmhyZWZdXG4gICAgICAgICAqIOODh+ODleOCqeODq+ODiOOBp+ODhOOCpOODvOODiOOBq+WQq+OBvuOCjOOCiyBVUkwg44Gn44GZ44CCXG4gICAgICAgICAqIFxuICAgICAgICAgKiBAc3RhdGljXG4gICAgICAgICAqL1xuICAgICAgICB1cmw6IHBoaW5hLmdsb2JhbC5sb2NhdGlvbiAmJiBwaGluYS5nbG9iYWwubG9jYXRpb24uaHJlZlxuXG4gICAgICAgIC8vIHZpYTogJ3BoaV9qcCcsXG4gICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAqIEBtZXRob2QgcGhpbmEuc29jaWFsLlR3aXR0ZXIuY3JlYXRlVVJMXG4gICAgICAgKiBUd2l0dGVy44Gu5YWx5pyJ44Oq44Oz44Kv44KS55Sf5oiQ44GX44G+44GZ44CC5byV5pWw44Gr44Kq44OW44K444Kn44Kv44OI44KS5rih44GZ44GT44Go44Gn5qeY44CF44Gq44OR44Op44Oh44O844K/44O844KS6Kit5a6a5Ye65p2l44G+44GZ44CC5byV5pWw44Gu44Kq44OW44K444Kn44Kv44OI44GvIHtAbGluayAjcGhpbmEuc29jaWFsLlR3aXR0ZXIuZGVmYXVsdHN9IOOBp+WuieWFqOaLoeW8teOBleOCjOOBvuOBmeOAglxuICAgICAgICogXG4gICAgICAgKiAjIyMgRXhhbXBsZVxuICAgICAgICogICAgIHBoaW5hLnNvY2lhbC5Ud2l0dGVyLmNyZWF0ZVVSTCgpOyAvLyA9PiBodHRwOi8vdHdpdHRlci5jb20vaW50ZW50L3R3ZWV0P3RleHQ9SGVsbG8lMkMlMjB3b3JsZCEmaGFzaHRhZ3M9amF2YXNjcmlwdCUyQ3BoaW5hJnVybD1754++5Zyo44GuVVJMfVxuICAgICAgICogXG4gICAgICAgKiAgICAgcGhpbmEuc29jaWFsLlR3aXR0ZXIuY3JlYXRlVVJMKHtcbiAgICAgICAqICAgICAgIHRleHQ6ICdUaGlzIGlzIHRleHQnLFxuICAgICAgICogICAgICAgaGFzaHRhZ3M6ICdoYXNodGFnMSxoYXNodGFnMicsXG4gICAgICAgKiAgICAgICB1cmw6ICdodHRwOi8vcGhpbmFqcy5jb20nXG4gICAgICAgKiAgICAgfSk7IC8vID0+IGh0dHA6Ly90d2l0dGVyLmNvbS9pbnRlbnQvdHdlZXQ/dGV4dD1UaGlzJTIwaXMlMjB0ZXh0Jmhhc2h0YWdzPWhhc2h0YWcxJTJDaGFzaHRhZzImdXJsPWh0dHAlM0ElMkYlMkZwaGluYWpzLmNvbVxuICAgICAgICogXG4gICAgICAgKiAgICAgcGhpbmEuc29jaWFsLlR3aXR0ZXIuY3JlYXRlVVJMKHtcbiAgICAgICAqICAgICAgIHRleHQ6ICdUaGlzIGlzIHRleHQnLFxuICAgICAgICogICAgICAgaGFzaHRhZ3M6ICdoYXNodGFnMSxoYXNodGFnMicsXG4gICAgICAgKiAgICAgICB1cmw6ICdodHRwOi8vcGhpbmFqcy5jb20nLFxuICAgICAgICogICAgICAgb3RoZXI6ICdUaGlzIGlzIG90aGVyJy8v6Kit5a6a6aCF55uu44Gv6YGp5b2T44Gr5aKX44KE44Gb44KLXG4gICAgICAgKiAgICAgfSk7IC8vID0+IGh0dHA6Ly90d2l0dGVyLmNvbS9pbnRlbnQvdHdlZXQ/dGV4dD1UaGlzJTIwaXMlMjB0ZXh0Jmhhc2h0YWdzPWhhc2h0YWcxJTJDaGFzaHRhZzImdXJsPWh0dHAlM0ElMkYlMkZwaGluYWpzLmNvbSZvdGhlcj1UaGlzJTIwaXMlMjBvdGhlclxuICAgICAgICogXG4gICAgICAgKiAgICAgcGhpbmEuc29jaWFsLlR3aXR0ZXIuY3JlYXRlVVJMKHtcbiAgICAgICAqICAgICAgIHVybDogJ2h0dHA6Ly9waGluYWpzLmNvbSdcbiAgICAgICAqICAgICB9KTsgLy8gPT4gaHR0cDovL3R3aXR0ZXIuY29tL2ludGVudC90d2VldD91cmw9aHR0cCUzQSUyRiUyRnBoaW5hanMuY29tJnRleHQ9SGVsbG8lMkMlMjB3b3JsZCEmaGFzaHRhZ3M9amF2YXNjcmlwdCUyQ3BoaW5hXG4gICAgICAgKiBcbiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fVxuICAgICAgICogQHJldHVybiB7U3RyaW5nfSBUd2l0dGVyIOOBruWFseacieODquODs+OCr1xuICAgICAgICogQHN0YXRpY1xuICAgICAgICovXG4gICAgICBjcmVhdGVVUkw6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kc2FmZSh0aGlzLmRlZmF1bHRzKTtcblxuICAgICAgICB2YXIgcXVlcmllcyA9IFtdO1xuICAgICAgICB2YXIgZXVjID0gZW5jb2RlVVJJQ29tcG9uZW50O1xuICAgICAgICBvcHRpb25zLmZvckluKGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbiAgICAgICAgICB2YXIgc3RyID0ga2V5ICsgJz0nICsgZXVjKHZhbHVlKTtcbiAgICAgICAgICBxdWVyaWVzLnB1c2goc3RyKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIHVybCA9ICd7YmFzZVVSTH0ve3R5cGV9P3txdWVyeX0nLmZvcm1hdCh7XG4gICAgICAgICAgYmFzZVVSTDogdGhpcy5iYXNlVVJMLFxuICAgICAgICAgIC8vIHR5cGU6IG9wdGlvbnMudHlwZSxcbiAgICAgICAgICB0eXBlOiAndHdlZXQnLFxuICAgICAgICAgIHF1ZXJ5OiBxdWVyaWVzLmpvaW4oJyYnKSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHVybDtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufSk7XG5cblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIGlmICghcGhpbmEuZ2xvYmFsLkJveDJEKSB7XG4gICAgcmV0dXJuIDtcbiAgfVxuXG4gIC8vIGh0dHA6Ly9ib3gyZHdlYi1kb2MucmVhZHRoZWRvY3Mub3JnL2phL2xhdGVzdC8wMF9yZWFkeS5odG1sI2lkMlxuICBwaGluYS5ib3gyZCA9IHtcbiAgICBiMjoge1xuICAgICAgVmVjMiAgICAgICAgICA6IEJveDJELkNvbW1vbi5NYXRoLmIyVmVjMixcbiAgICAgIEFBQkIgICAgICAgICAgOiBCb3gyRC5Db2xsaXNpb24uYjJBQUJCLFxuICAgICAgQm9keURlZiAgICAgICA6IEJveDJELkR5bmFtaWNzLmIyQm9keURlZixcbiAgICAgIEJvZHkgICAgICAgICAgOiBCb3gyRC5EeW5hbWljcy5iMkJvZHksXG4gICAgICBGaXh0dXJlRGVmICAgIDogQm94MkQuRHluYW1pY3MuYjJGaXh0dXJlRGVmLFxuICAgICAgRml4dHVyZSAgICAgICA6IEJveDJELkR5bmFtaWNzLmIyRml4dHVyZSxcbiAgICAgIFdvcmxkICAgICAgICAgOiBCb3gyRC5EeW5hbWljcy5iMldvcmxkLFxuICAgICAgTWFzc0RhdGEgICAgICA6IEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJNYXNzRGF0YSxcbiAgICAgIFBvbHlnb25TaGFwZSAgOiBCb3gyRC5Db2xsaXNpb24uU2hhcGVzLmIyUG9seWdvblNoYXBlLFxuICAgICAgQ2lyY2xlU2hhcGUgICA6IEJveDJELkNvbGxpc2lvbi5TaGFwZXMuYjJDaXJjbGVTaGFwZSxcbiAgICAgIERlYnVnRHJhdyAgICAgOiBCb3gyRC5EeW5hbWljcy5iMkRlYnVnRHJhdyxcbiAgICAgIE1vdXNlSm9pbnREZWYgOiBCb3gyRC5EeW5hbWljcy5Kb2ludHMuYjJNb3VzZUpvaW50RGVmXG4gICAgfSxcbiAgfTtcblxuICB2YXIgYjIgPSBwaGluYS5ib3gyZC5iMjtcblxuICAvKipcbiAgICogQGNsYXNzIHBoaW5hLmJveDJkLkJveDJkTGF5ZXJcbiAgICogQGV4dGVuZHMgcGhpbmEuZGlzcGxheS5MYXllclxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5ib3gyZC5Cb3gyZExheWVyJywge1xuICAgIHN1cGVyQ2xhc3M6ICdwaGluYS5kaXNwbGF5LkNhbnZhc0xheWVyJyxcblxuXG4gICAgaW5pdDogZnVuY3Rpb24ocGFyYW1zKSB7XG4gICAgICB0aGlzLnN1cGVySW5pdChwYXJhbXMpO1xuXG4gICAgICBwYXJhbXMgPSAocGFyYW1zIHx8IHt9KS4kc2FmZSh7XG4gICAgICAgIHdvcmxkU2NhbGU6IDUwLCAvLyBvciA1MFxuICAgICAgfSk7XG5cbiAgICAgIC8vIOmHjeWKm+OBqOeJqeeQhuS4lueVjOOBruioreWumlxuICAgICAgdmFyIGdyYXZpdHkgPSBuZXcgYjIuVmVjMigwLCA5LjgpO1xuICAgICAgdmFyIHdvcmxkID0gbmV3IGIyLldvcmxkKGdyYXZpdHksIHRydWUpO1xuICAgICAgXG4gICAgICB0aGlzLndvcmxkID0gd29ybGQ7XG4gICAgICB0aGlzLndvcmxkLl9zY2FsZSA9IHBhcmFtcy53b3JsZFNjYWxlO1xuXG4gICAgICB0aGlzLl9zZXR1cERlYnVnRHJhdygpO1xuICAgIH0sXG5cbiAgICBfc2V0dXBEZWJ1Z0RyYXc6IGZ1bmN0aW9uKCkge1xuICAgICAgLy8g44OH44OQ44OD44Kw55So44K544OX44Op44Kk44OIXG4gICAgICB2YXIgZGVidWdEcmF3ID0gbmV3IGIyLkRlYnVnRHJhdygpO1xuICAgICAgZGVidWdEcmF3LlNldFNwcml0ZSh0aGlzLmNhbnZhcy5jb250ZXh0KTtcbiAgICAgIGRlYnVnRHJhdy5TZXREcmF3U2NhbGUodGhpcy53b3JsZC5fc2NhbGUpO1xuICAgICAgZGVidWdEcmF3LlNldExpbmVUaGlja25lc3MoMS4wKTtcbiAgICAgIGRlYnVnRHJhdy5TZXRBbHBoYSgxKTtcbiAgICAgIGRlYnVnRHJhdy5TZXRGaWxsQWxwaGEoMC40KTtcbiAgICAgIGRlYnVnRHJhdy5TZXRGbGFncyhiMi5EZWJ1Z0RyYXcuZV9zaGFwZUJpdCk7XG4gICAgICB0aGlzLndvcmxkLlNldERlYnVnRHJhdyhkZWJ1Z0RyYXcpO1xuICAgIH0sXG5cbiAgICBjcmVhdGVCb2R5OiBmdW5jdGlvbihwYXJhbXMpIHtcbiAgICAgIHBhcmFtcy53b3JsZCA9IHRoaXMud29ybGQ7XG4gICAgICB2YXIgYm9keSA9IHBoaW5hLmJveDJkLkJveDJkQm9keShwYXJhbXMpO1xuICAgICAgcmV0dXJuIGJvZHk7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oYXBwKSB7XG4gICAgICAvLyB2YXIgdGltZVN0ZXAgPSBhcHAudGlja2VyLmZyYW1lVGltZS8xMDAwO1xuICAgICAgdmFyIHRpbWVTdGVwID0gYXBwLnRpY2tlci5kZWx0YVRpbWUvMTAwMDtcbiAgICAgIHZhciB2ZWxvY2l0eUl0ZXJhdGlvbnMgPSAxMDtcbiAgICAgIHZhciBwb3NpdGlvbkl0ZXJhdGlvbnMgPSAxMDtcbiAgICAgIC8vIOeJqeeQhuepuumWk+OBruabtOaWsFxuICAgICAgdGhpcy53b3JsZC5TdGVwKHRpbWVTdGVwLHZlbG9jaXR5SXRlcmF0aW9ucyxwb3NpdGlvbkl0ZXJhdGlvbnMpO1xuICAgIH0sXG5cbiAgICBkcmF3OiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICAgIC8vIGRlYnVn55S76Z2i44Gu5pu05pawXG4gICAgICB0aGlzLndvcmxkLkNsZWFyRm9yY2VzKCk7XG4gICAgICB0aGlzLndvcmxkLkRyYXdEZWJ1Z0RhdGEoKTtcbiAgICAgIHZhciBkb21FbGVtZW50ID0gdGhpcy5jYW52YXMuZG9tRWxlbWVudDtcbiAgICAgIGNhbnZhcy5jb250ZXh0LmRyYXdJbWFnZShkb21FbGVtZW50LCAwLCAwLCBkb21FbGVtZW50LndpZHRoLCBkb21FbGVtZW50LmhlaWdodCk7XG4gICAgfSxcbiAgfSk7XG59KTtcblxuXG5cblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuICBcbiAgaWYgKCFwaGluYS5nbG9iYWwuQm94MkQpIHtcbiAgICByZXR1cm4gO1xuICB9XG5cbiAgdmFyIGIyID0gcGhpbmEuYm94MmQuYjI7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBwaGluYS5ib3gyZC5Cb3gyZEJvZHlcbiAgICogQGV4dGVuZHMgcGhpbmEuYWNjZXNzb3J5LkFjY2Vzc29yeVxuICAgKi9cbiAgcGhpbmEuZGVmaW5lKCdwaGluYS5ib3gyZC5Cb3gyZEJvZHknLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmFjY2Vzc29yeS5BY2Nlc3NvcnknLFxuXG5cbiAgICBpbml0OiBmdW5jdGlvbihwYXJhbXMpIHtcbiAgICAgIHRoaXMuc3VwZXJJbml0KCk7XG5cbiAgICAgIHRoaXMud29ybGQgPSBwYXJhbXMud29ybGQ7XG4gICAgICB0aGlzLnR5cGUgPSBwYXJhbXMudHlwZTtcbiAgICAgIHRoaXMuc2hhcGUgPSBwYXJhbXMuc2hhcGU7XG5cbiAgICAgIHRoaXMuX2luaXQoKTtcblxuICAgICAgdGhpcy5vbignYXR0YWNoZWQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRhcmdldCA9IHRoaXMudGFyZ2V0O1xuXG4gICAgICAgIHZhciBwID0gbmV3IGIyLlZlYzIodGFyZ2V0LngvdGhpcy53b3JsZC5fc2NhbGUsIHRhcmdldC55L3RoaXMud29ybGQuX3NjYWxlKTtcbiAgICAgICAgdGhpcy5ib2R5LlNldFBvc2l0aW9uKHApO1xuICAgICAgICB0aGlzLmJvZHkuU2V0QW5nbGUodGFyZ2V0LnJvdGF0aW9uICogTWF0aC5QSS8xODApO1xuXG4gICAgICAgIHRoaXMuX2JpbmRGaXh0dXJlKHRoaXMudGFyZ2V0KTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uKGFwcCkge1xuICAgICAgdmFyIHRhcmdldCA9IHRoaXMudGFyZ2V0O1xuXG4gICAgICB0YXJnZXQueCA9IHRoaXMuYm9keS5HZXRQb3NpdGlvbigpLnggKiB0aGlzLndvcmxkLl9zY2FsZTtcbiAgICAgIHRhcmdldC55ID0gdGhpcy5ib2R5LkdldFBvc2l0aW9uKCkueSAqIHRoaXMud29ybGQuX3NjYWxlO1xuICAgICAgdGFyZ2V0LnJvdGF0aW9uID0gdGhpcy5ib2R5LkdldEFuZ2xlKCkgKiAxODAvTWF0aC5QSTtcbiAgICB9LFxuXG4gICAgX2luaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5fc2V0dXBCb2R5KCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgX3NldHVwQm9keTogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICB2YXIgd29ybGQgPSB0aGlzLndvcmxkO1xuICAgICAgdmFyIHNjYWxlID0gd29ybGQuX3NjYWxlO1xuICAgICAgdmFyIGJvZHlEZWYgPSBuZXcgYjIuQm9keURlZigpO1xuICAgICAgYm9keURlZi50eXBlID0gKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICdkeW5hbWljJzogYjIuQm9keS5iMl9keW5hbWljQm9keSwgXG4gICAgICAgICAgJ2tpbmVtYXRpYyc6IGIyLkJvZHkuYjJfa2luZW1hdGljQm9keSwgXG4gICAgICAgICAgJ3N0YXRpYyc6IGIyLkJvZHkuYjJfc3RhdGljQm9keSwgXG4gICAgICAgIH1bc2VsZi50eXBlIHx8ICdkeW5hbWljJ107XG4gICAgICB9KSgpO1xuICAgICAgYm9keURlZi5wb3NpdGlvbi5TZXQoMCwgMCk7XG4gICAgICB2YXIgYm9keSA9IHdvcmxkLkNyZWF0ZUJvZHkoYm9keURlZik7XG4gICAgICB0aGlzLmJvZHkgPSBib2R5O1xuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgX2JpbmRGaXh0dXJlOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIHZhciB0YXJnZXQgPSB0aGlzLnRhcmdldDtcbiAgICAgIHZhciBmaXh0dXJlID0gdGhpcy5ib2R5LkdldEZpeHR1cmVMaXN0KCk7XG4gICAgICBpZiAoZml4dHVyZSkge1xuICAgICAgICB0aGlzLmJvZHkuRGVzdHJveUZpeHR1cmUoZml4dHVyZSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFxuICAgICAgdmFyIHdvcmxkID0gdGhpcy53b3JsZDtcbiAgICAgIHZhciBzY2FsZSA9IHdvcmxkLl9zY2FsZTtcbiAgICAgIC8vIHNoYXBlIOOCkuWPluW+l1xuICAgICAgdmFyIHNoYXBlID0gKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc2hhcGUgPSBudWxsO1xuICAgICAgICBpZiAoc2VsZi5zaGFwZSA9PT0gJ2NpcmNsZScpIHtcbiAgICAgICAgICBzaGFwZSA9IG5ldyBiMi5DaXJjbGVTaGFwZSh0YXJnZXQucmFkaXVzIC8gc2NhbGUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHNlbGYuc2hhcGUgPT09ICdib3gnKXtcbiAgICAgICAgICBzaGFwZSA9IG5ldyBiMi5Qb2x5Z29uU2hhcGUoKTtcbiAgICAgICAgICBzaGFwZS5TZXRBc0JveCh0YXJnZXQud2lkdGggLyBzY2FsZSAvIDIsIHRhcmdldC5oZWlnaHQgLyBzY2FsZSAvIDIgKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBzaGFwZSA9IG5ldyBiMi5DaXJjbGVTaGFwZSgzMiAvIHNjYWxlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2hhcGU7XG4gICAgICB9KSgpO1xuXG4gICAgICB2YXIgZml4dHVyZSA9IG5ldyBiMi5GaXh0dXJlRGVmKCk7XG4gICAgICBmaXh0dXJlLnNoYXBlID0gc2hhcGU7XG4gICAgICAvLyBUT0RPOiDjgZPjga7jgbjjgpPjga/lvJXmlbDjgafmjIflrprjgafjgY3jgovjgojjgYbjgavjgZnjgotcbiAgICAgIGZpeHR1cmUuZGVuc2l0eSA9IDE7XG4gICAgICBmaXh0dXJlLmZyaWN0aW9uID0gMC4zO1xuICAgICAgZml4dHVyZS5yZXN0aXR1dGlvbiA9IDAuNTtcbiAgICAgIHRoaXMuYm9keS5DcmVhdGVGaXh0dXJlKGZpeHR1cmUpO1xuICAgIH0sXG4gIH0pO1xufSk7XG5cblxuXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuXG4gIHBoaW5hLmRlZmluZSgncGhpbmEuZGlzcGxheS5DYW52YXNFbGVtZW50Jywge1xuICAgIHN1cGVyQ2xhc3M6ICdwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50JyxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuXG4gICAgICBjb25zb2xlLndhcm4oJ1twaGluYSB3YXJuXSBDYW52YXNFbGVtZW50IOOBr+mdnuaOqOWlqOOBq+OBquOCiuOBvuOBl+OBny4gRGlzcGxheUVsZW1lbnQg44KS44GK5L2/44GE44GP44Gg44GV44GELicpO1xuICAgIH1cbiAgfSk7XG5cblxuICBwaGluYS5kZWZpbmUoJ3BoaW5hLmRpc3BsYXkuQ2FudmFzU2NlbmUnLCB7XG4gICAgc3VwZXJDbGFzczogJ3BoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lJyxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuXG4gICAgICBjb25zb2xlLndhcm4oJ1twaGluYSB3YXJuXSBDYW52YXNTY2VuZSDjga/pnZ7mjqjlpajjgavjgarjgorjgb7jgZfjgZ8uIERpc3BsYXlTY2VuZSDjgpLjgYrkvb/jgYTjgY/jgaDjgZXjgYQuJyk7XG4gICAgfVxuICB9KTtcblxuXG59KTtcblxuIiwiLypcbiAqICBUaXRsZVNjZW5lLmpzXG4gKi9cblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIHBoaW5hLmRlZmluZSgnQ2FtZXJhUGx1Z2luJywge1xuXG4gICAgX3N0YXRpYzoge1xuICAgICAgb3BlbjogZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgaWYgKHR5cGUgIT09IENhbWVyYS5QaWN0dXJlU291cmNlVHlwZS5DQU1FUkEgJiYgdHlwZSAhPT0gQ2FtZXJhLlBpY3R1cmVTb3VyY2VUeXBlLlBIT1RPTElCUkFSWSkge1xuICAgICAgICAgIHR5cGUgPSBDYW1lcmEuUGljdHVyZVNvdXJjZVR5cGUuQ0FNRVJBO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICAgIG5hdmlnYXRvci5jYW1lcmEuZ2V0UGljdHVyZShcbiAgICAgICAgICAgIGltYWdlRGF0YVVSSSA9PiB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY2FtZXJhIHN1Y2Nlc3M6IFwiICsgaW1hZ2VEYXRhVVJJKTtcbiAgICAgICAgICAgICAgcmVzb2x2ZSh7XG4gICAgICAgICAgICAgICAgaXNTdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGltYWdlRGF0YVVSSSxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtZXNzYWdlID0+IHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJjYW1lcmEgZXJyb3I6IFwiICsgbWVzc2FnZSk7XG4gICAgICAgICAgICAgIHJlc29sdmUoe1xuICAgICAgICAgICAgICAgIGlzU3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHF1YWxpdHk6IDEwMCxcbiAgICAgICAgICAgICAgZGVzdGluYXRpb25UeXBlOiBDYW1lcmEuRGVzdGluYXRpb25UeXBlLkZJTEVfVVJJLFxuICAgICAgICAgICAgICBzYXZlVG9QaG90b0FsYnVtOiBmYWxzZSxcbiAgICAgICAgICAgICAgY2FtZXJhRGlyZWN0aW9uOiBDYW1lcmEuRGlyZWN0aW9uLkZST05ULFxuICAgICAgICAgICAgICBzb3VyY2VUeXBlOiB0eXBlLFxuICAgICAgICAgICAgICBjb3JyZWN0T3JpZW50YXRpb246IHRydWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG59KTtcbiIsInBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICBjb25zdCBBUElfVVJJID0gXCJodHRwczovL2N3Y3dkZXYwMi5wZXQtY29vLmpwL2FwaS92MS9cIjsgLy/mmK/mnp3jgZXjgpPjgrXjg7zjg5Djg7xcbiAgLy8gY29uc3QgQVBJX1VSSSA9IFwiaHR0cHM6Ly9jd2N3ZGV2MDEucGV0LWNvby5qcC9hcGkvdjEvXCI7IC8v6KW/5bKh44GV44KT44K144O844OQ44O8XG5cbiAgY29uc3QgTU9DS19VUkkgPSBcImh0dHA6Ly91ZS5wZWFzZS5qcC9mdWppbW90b2RldjAxL2FwaS92MS9cIjsgLy/jg4bjgrnjg4jnlKjjg6Ljg4Pjgq/jgrXjg7zjg5Djg7xcblxuICAvLyBjb25zdCBBUElfVVJJID0gXCJodHRwOi8vNTIuMTAuMjQ3LjE1OC9hcGkvXCI7IC8vQnJpZ2h05qGI5Lu244K144O844OQ44O877yI5aSW6YOo5o6l57aa56K66KqN55So77yJXG4gIFxuICBwaGluYS5kZWZpbmUoXCJXZWJBcGlcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwiRXZlbnREaXNwYXRjaGVyXCIsXG4gICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnN1cGVySW5pdCgpO1xuICAgIH0sXG5cbiAgICByZXF1ZXN0OiBmdW5jdGlvbihyZXF1ZXN0VHlwZSwgYXBpTmFtZSwgcGFyYW1zLCBvcHRpb25zKSB7XG4gICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRzYWZlKHtcbiAgICAgICAgaWdub3JlRXJyb3JDb2RlOiBbXSxcbiAgICAgICAgYXV0aDogdHJ1ZSwgLy/oqo3oqLzlv4XopoHjgYvjg5Xjg6njgrBcbiAgICAgICAgaXNGb3JtRGF0YTogZmFsc2UsICAvL3ByYW1hc+OBjEZvcm1EYXRh44GL44OV44Op44KwXG4gICAgICAgIGlzQmFja2dyb3VuZDogZmFsc2UsIC8vXGLpgJrkv6HkuK3jgavlhaXlipvjgpLlj5fjgZHku5jjgZHjgovjgYsodHJ1ZeOBp+WPl+OBkeS7mOOBkeOCiylcbiAgICAgIH0pO1xuXG4gICAgICAvL+ODh+ODkOODg+OCsOeUqOW8t+WItkFQSeODouODg+OCr+S9v+eUqFxuICAgICAgaWYgKEFQSV9NT0NLX0ZPUlNFKSBvcHRpb25zLmlzTW9jayA9IHRydWU7XG5cbiAgICAgIGlmIChvcHRpb25zLmlzTW9jaykge1xuICAgICAgICAvL1RPRE8gc3dhZ2dlcuOBuOOBruODquODkOODvOOCueODl+ODreOCreOCt+aOpee2muOBjOWHuuadpeOBn+OCieabuOOBjeaPm+OBiOOCi1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICAgICAgY29uc3QgcGFyYW0gPSB0aGlzLmVuY29kZUhUTUxGb3JtKHBhcmFtcyk7XG4gICAgICAgICAgY29uc29sZS5sb2coYEFQSSBDQUxMIDogJHtyZXF1ZXN0VHlwZX0gJHthcGlOYW1lfSAke3BhcmFtfWApO1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IFdlYkFwaU1vY2tbYXBpTmFtZV0gfHwgeyBzdGFzdXM6IFwibW9jayBlcnJvci5cIiwgcmVzdWx0OiB7fSB9O1xuICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGNvdmVyID0gSW5wdXRJbnRlcmNlcHQoKS5hZGRDaGlsZFRvKHBoaW5hX2FwcC5jdXJyZW50U2NlbmUpO1xuICAgICAgaWYgKG9wdGlvbnMuaXNCYWNrZ3JvdW5kKSB7XG4gICAgICAgIGNvdmVyLmRpc2FibGUoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8v6YCa5L+h44GM57WC44KP44KL44G+44Gn5pON5L2c44KS44GV44Gb44Gq44GE5qeY44Gr44GZ44KLXG4gICAgICAgIGNvdmVyLmVuYWJsZSgpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBjb25zdCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCkge1xuICAgICAgICAgICAgaWYgKCFvcHRpb25zLmlzQmFja2dyb3VuZCkgY292ZXIuZGlzYWJsZSgpO1xuICAgICAgICAgICAgaWYgKFsyMDAsIDIwMSwgMF0uaW5kZXhPZih4aHIuc3RhdHVzKSAhPT0gLTEgfHwgb3B0aW9ucy5pZ25vcmVFcnJvckNvZGUuaW5kZXhPZih4aHIuc3RhdHVzKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZSk7XG4gICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gXCJzdWNjZXNzXCIpIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6IFwiZXJyb3JcIixcbiAgICAgICAgICAgICAgICBjb2RlOiB4aHIuc3RhdHVzLFxuICAgICAgICAgICAgICAgIHJlc3VsdDogeGhyLnJlc3BvbnNlLFxuICAgICAgICAgICAgICAgIGFwaTogYXBpTmFtZSxcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgcmVqZWN0KG9wdGlvbnMpO1xuICAgICAgICAgICAgICAvL+OCqOODqeODvOODoeODg+OCu+ODvOOCuOOCt+ODvOODs+OBuOW8t+WItumBt+enu1xuICAgICAgICAgICAgICBwaGluYV9hcHAuY3VycmVudFNjZW5lLmZsYXJlKFwiYXBpZXJyb3JcIiwgeyBvcHRpb25zIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvL0dFVOOBruWgtOWQiOOAgeOCr+OCqOODquODkeODqeODoeODvOOCv+OCknVybOOBq+S7mOOBkeOCi1xuICAgICAgICBsZXQgdXJsID0gQVBJX1VSSSArIGFwaU5hbWU7XG4gICAgICAgIGlmIChyZXF1ZXN0VHlwZSA9PSBcIkdFVFwiKSB7XG4gICAgICAgICAgY29uc3QgcGFyYW0gPSB0aGlzLmVuY29kZUhUTUxGb3JtKHBhcmFtcyk7XG4gICAgICAgICAgaWYgKHBhcmFtICYmIHBhcmFtICE9IFwiXCIpIHVybCArPSBcIj9cIiArIHBhcmFtO1xuICAgICAgICB9XG4gICAgICAgIHhoci5vcGVuKHJlcXVlc3RUeXBlLCB1cmwpO1xuXG4gICAgICAgIC8vUE9TVOOBruWgtOWQiOOAgeODmOODg+ODgOOCkuS7mOWKoOOBmeOCi1xuICAgICAgICBpZiAocmVxdWVzdFR5cGUgPT0gXCJQT1NUXCIpIHtcbiAgICAgICAgICBpZiAob3B0aW9ucy5pc0Zvcm1EYXRhKSB7XG4gICAgICAgICAgICAvL+ODleOCqeODvOODoOmAgeS/oeOBruWgtOWQiOOBr+ODmOODg+ODgOOCkuOBpOOBkeOBquOBhFxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8v6KqN6Ki844OH44O844K/44KS44OY44OD44OA44Gr5LuY5YqgXG4gICAgICAgIGlmIChvcHRpb25zLmF1dGgpIHtcbiAgICAgICAgICBjb25zdCB0b2tlbiA9IFVzZXJEYXRhLnRva2VuO1xuICAgICAgICAgIGNvbnN0IGF1dGhTdHJpbmcgPSBgJHt0b2tlbi50b2tlbl90eXBlfSAke3Rva2VuLmFjY2Vzc190b2tlbn1gO1xuICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdBdXRob3JpemF0aW9uJywgYXV0aFN0cmluZyk7XG4gICAgICAgICAgLy8geGhyLndpdGhDcmVkZW50aWFscyA9IHRydWU7ICAvL+S4jeimgeOBruWPr+iDveaAp+OBjOOBguOCi1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMuaXNGb3JtRGF0YSkge1xuICAgICAgICAgIHhoci5zZW5kKHBhcmFtcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKHJlcXVlc3RUeXBlID09IFwiUE9TVFwiKSB7XG4gICAgICAgICAgICBjb25zdCBwYXJhbV9zdHJpbmcgPSB0aGlzLmVuY29kZUhUTUxGb3JtKHBhcmFtcylcbiAgICAgICAgICAgIHhoci5zZW5kKHBhcmFtX3N0cmluZyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHhoci5zZW5kKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgZ2V0OiBmdW5jdGlvbihhcGlOYW1lLCBwYXJhbXMsIG9wdGlvbnMpIHtcbiAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QoXCJHRVRcIiwgYXBpTmFtZSwgcGFyYW1zLCBvcHRpb25zKTtcbiAgICB9LFxuXG4gICAgcG9zdDogZnVuY3Rpb24oYXBpTmFtZSwgcGFyYW1zLCBvcHRpb25zKSB7XG4gICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KFwiUE9TVFwiLCBhcGlOYW1lLCBwYXJhbXMsIG9wdGlvbnMpO1xuICAgIH0sXG5cbiAgICAvLyBIVE1M44OV44Kp44O844Og44Gu5b2i5byP44Gr44OH44O844K/44KS5aSJ5o+b44GZ44KLXG4gICAgZW5jb2RlSFRNTEZvcm06IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgIGNvbnN0IHBhcmFtcyA9IFtdO1xuICAgICAgaWYgKCFkYXRhKSByZXR1cm4gbnVsbDtcbiAgICAgIGZvciAobGV0IG5hbWUgaW4gZGF0YSkge1xuICAgICAgICBsZXQgcGFyYW0gPSBlbmNvZGVVUklDb21wb25lbnQobmFtZSkgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQoZGF0YVtuYW1lXSk7XG4gICAgICAgIHBhcmFtcy5wdXNoKHBhcmFtKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwYXJhbXMuam9pbignJicpLnJlcGxhY2UoLyUyMC9nLCAnKycpO1xuICAgIH0sXG5cbiAgfSk7XG5cbn0pO1xuIiwicGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIHBoaW5hLmdyYXBoaWNzLkNhbnZhcy5wcm90b3R5cGUuJG1ldGhvZChcImluaXRcIiwgZnVuY3Rpb24oY2FudmFzKSB7XG4gICAgdGhpcy5pc0NyZWF0ZUNhbnZhcyA9IGZhbHNlO1xuICAgIGlmICh0eXBlb2YgY2FudmFzID09PSAnc3RyaW5nJykge1xuICAgICAgdGhpcy5jYW52YXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNhbnZhcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChjYW52YXMpIHtcbiAgICAgICAgdGhpcy5jYW52YXMgPSBjYW52YXM7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgICAgICB0aGlzLmlzQ3JlYXRlQ2FudmFzID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmRvbUVsZW1lbnQgPSB0aGlzLmNhbnZhcztcbiAgICB0aGlzLmNvbnRleHQgPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgIHRoaXMuY29udGV4dC5saW5lQ2FwID0gJ3JvdW5kJztcbiAgICB0aGlzLmNvbnRleHQubGluZUpvaW4gPSAncm91bmQnO1xuICB9KTtcblxuICBwaGluYS5ncmFwaGljcy5DYW52YXMucHJvdG90eXBlLiRtZXRob2QoJ2Rlc3Ryb3knLCBmdW5jdGlvbihjYW52YXMpIHtcbiAgICBpZiAoIXRoaXMuaXNDcmVhdGVDYW52YXMpIHJldHVybjtcbiAgICBjb25zb2xlLmxvZyhgIyMjIyBkZWxldGUgY2FudmFzICR7dGhpcy5jYW52YXMud2lkdGh9IHggJHt0aGlzLmNhbnZhcy5oZWlnaHR9ICMjIyNgKTtcbiAgICB0aGlzLnNldFNpemUoMCwgMCk7XG4gICAgZGVsZXRlIHRoaXMuY2FudmFzO1xuICAgIGRlbGV0ZSB0aGlzLmRvbUVsZW1lbnQ7XG4gIH0pO1xuXG59KTtcbiIsInBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICBwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50LnByb3RvdHlwZS4kbWV0aG9kKFwic2V0QWxwaGFcIiwgZnVuY3Rpb24oYSkge1xuICAgIHRoaXMuYWxwaGEgPSBhO1xuICAgIHJldHVybiB0aGlzO1xuICB9KTtcblxufSk7XG4iLCJwaGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgcGhpbmEuZGlzcGxheS5QbGFpbkVsZW1lbnQucHJvdG90eXBlLiRtZXRob2QoXCJkZXN0cm95Q2FudmFzXCIsIGZ1bmN0aW9uKCkge1xuICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgaWYgKCF0aGlzLmNhbnZhcykgcmV0dXJuO1xuICAgIHRoaXMuY2FudmFzLmRlc3Ryb3koKTtcbiAgICBkZWxldGUgdGhpcy5jYW52YXM7XG4gIH0pO1xuXG59KTtcbiIsInBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICBwaGluYS5hc3NldC5UZXh0dXJlLnByb3RvdHlwZS4kbWV0aG9kKFwiX2xvYWRcIiwgZnVuY3Rpb24ocmVzb2x2ZSkge1xuICAgIHRoaXMuZG9tRWxlbWVudCA9IG5ldyBJbWFnZSgpO1xuXG4gICAgdmFyIGlzTG9jYWwgPSAobG9jYXRpb24ucHJvdG9jb2wgPT0gJ2ZpbGU6Jyk7XG4gICAgaWYgKCEoL15kYXRhOi8udGVzdCh0aGlzLnNyYykpKSB7XG4gICAgICB0aGlzLmRvbUVsZW1lbnQuY3Jvc3NPcmlnaW4gPSAnYW5vbnltb3VzJzsgLy8g44Kv44Ot44K544Kq44Oq44K444Oz6Kej6ZmkXG4gICAgfVxuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHRoaXMuZG9tRWxlbWVudC5vbmxvYWQgPSBmdW5jdGlvbihlKSB7XG4gICAgICBzZWxmLmxvYWRlZCA9IHRydWU7XG4gICAgICBlLnRhcmdldC5vbmxvYWQgPSBudWxsO1xuICAgICAgZS50YXJnZXQub25lcnJvciA9IG51bGw7XG4gICAgICByZXNvbHZlKHNlbGYpO1xuICAgIH07XG5cbiAgICB0aGlzLmRvbUVsZW1lbnQub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgIGUudGFyZ2V0Lm9ubG9hZCA9IG51bGw7XG4gICAgICBlLnRhcmdldC5vbmVycm9yID0gbnVsbDtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJwaGluYS5hc3NldC5UZXh0dXJlIF9sb2FkIG9uRXJyb3IgXCIsIHRoaXMuc3JjKTtcbiAgICB9O1xuXG4gICAgdGhpcy5kb21FbGVtZW50LnNyYyA9IHRoaXMuc3JjO1xuICB9KTtcblxuICBwaGluYS5hc3NldC5UZXh0dXJlLnByb3RvdHlwZS4kbWV0aG9kKCdkZXN0cm95JywgZnVuY3Rpb24oY2FudmFzKSB7XG4gICAgY29uc29sZS5sb2coYCMjIyMgZGVsZXRlIGNhbnZhcyAke3RoaXMuZG9tRWxlbWVudC53aWR0aH0geCAke3RoaXMuZG9tRWxlbWVudC5oZWlnaHR9ICMjIyNgKTtcbiAgICB0aGlzLmRvbUVsZW1lbnQud2lkdGggPSAwO1xuICAgIHRoaXMuZG9tRWxlbWVudC5oZWlnaHQgPSAwO1xuICAgIGRlbGV0ZSB0aGlzLmRvbUVsZW1lbnQ7XG4gIH0pO1xuXG59KTtcbiIsIi8v5paH5a2X5YiX44KS5oyH5a6a44GX44Gf6ZW344GV44GU44Go44Gr5pS56KGM44KS5YWl44KM44KLXG5mdW5jdGlvbiBDdXRUZXh0KHNyY1RleHQsIGJldHdlZW4pIHtcbiAgYmV0d2VlbiA9IGJldHdlZW4gfHwgMjA7XG5cbiAgZnVuY3Rpb24gc3BsaXRCeUxlbmd0aChzdHIsIGxlbmd0aCkge1xuICAgIGlmICghc3RyIHx8ICFsZW5ndGggfHwgbGVuZ3RoIDwgMSkgcmV0dXJuIFtdO1xuICAgIHZhciByZWdleFBhdHRlcm4gPSBuZXcgUmVnRXhwKCcoPzpbXFx1RDgwMC1cXHVEQkZGXVtcXHVEQzAwLVxcdURGRkZdfFteXFx1RDgwMC1cXHVERkZGXSl7MSwnICsgbGVuZ3RoICsgJ30nLCdnJyk7XG4gICAgcmV0dXJuIHN0ci5tYXRjaChyZWdleFBhdHRlcm4pIHx8IFtdO1xuICB9XG5cbiAgbGV0IGRlc3RUZXh0ID0gXCJcIjtcbiAgY29uc3QgbGlzdCA9IHNyY1RleHQuc3BsaXQoJ1xcbicpO1xuICBsaXN0LmZvckVhY2godGV4dCA9PiB7XG4gICAgY29uc3QgbGluZSA9IHNwbGl0QnlMZW5ndGgodGV4dCwgYmV0d2Vlbik7XG4gICAgbGluZS5mb3JFYWNoKHQgPT4gZGVzdFRleHQgKz0gdCArIFwiXFxuXCIpO1xuICB9KTtcbiAgcmV0dXJuIGRlc3RUZXh0O1xufVxuIiwiLypcbiAqICBwaGluYS5TZXJpYWxBc3NldExvYWRlci5qc1xuICogIDIwMTkvMDIvMjFcbiAqICBAYXV0aGVyIG1pbmltbyAgXG4gKiAgVGhpcyBQcm9ncmFtIGlzIE1JVCBsaWNlbnNlLlxuICpcbiAqL1xuXG5waGluYS5leHRlbnNpb24gPSBwaGluYS5leHRlbnNpb24gfHwge307XG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICAvL+ODkOODg+OCr+OCsOODqeOCpuODs+ODieOBp+OCouOCu+ODg+ODiOOCkuebtOWIl+OBq+iqreOBv+i+vOOBv1xuICBwaGluYS5kZWZpbmUoXCJwaGluYS5leHRlbnNpb24uU2VyaWFsQXNzZXRMb2FkZXJcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEudXRpbC5FdmVudERpc3BhdGNoZXJcIixcblxuICAgIC8v44Ot44O844OJ44GZ44KL44Ki44K744OD44OI44Gu44Oq44K544OIXG4gICAgbG9hZExpc3Q6IG51bGwsXG5cbiAgICAvL+ODreODvOODieS4reOCouOCu+ODg+ODiFxuICAgIGxvYWRpbmdBc3NldDogbnVsbCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5zdXBlckluaXQoKTtcblxuICAgICAgdGhpcy5sb2FkTGlzdCA9IFtdO1xuICAgICAgdGhpcy5fc3VydmVpbGxhbmNlKCk7XG4gICAgfSxcblxuICAgIC8v6Kqt44G/6L6844G/5b6F5qmf44Oq44K544OI55uj6KaWXG4gICAgX3N1cnZlaWxsYW5jZTogZnVuY3Rpb24oKSB7XG4gICAgICBzZXRUaW1lb3V0KHRoaXMuX3N1cnZlaWxsYW5jZS5iaW5kKHRoaXMpLCAxMDApO1xuICAgICAgaWYgKHRoaXMubG9hZGluZ0Fzc2V0IHx8IHRoaXMubG9hZExpc3QubGVuZ3RoID09IDApIHJldHVybjtcblxuICAgICAgdGhpcy5sb2FkaW5nQXNzZXQgPSB0aGlzLmxvYWRMaXN0LnNoaWZ0KCk7XG4gICAgICBjb25zdCBhc3NldHMgPSB0aGlzLmxvYWRpbmdBc3NldC5hc3NldHM7XG4gICAgICBjb25zdCBjYWxsYmFjayA9IHRoaXMubG9hZGluZ0Fzc2V0LmNhbGxiYWNrO1xuXG4gICAgICB2YXIgbG9hZGVyID0gcGhpbmEuYXNzZXQuQXNzZXRMb2FkZXIoKTtcbiAgICAgIGxvYWRlci5sb2FkKGFzc2V0cyk7XG4gICAgICBsb2FkZXIub24oJ2xvYWQnLCAoZSkgPT4ge1xuICAgICAgICB0aGlzLmxvYWRpbmdBc3NldCA9IG51bGw7XG4gICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgIGNhbGxiYWNrKGFzc2V0cyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coXCIqKioqIFNlcmlhbCBsb2FkIGZpbmlzaDogXCIuIGFzc2V0cyk7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgbG9hZDogZnVuY3Rpb24oYXNzZXRzLCBjYWxsYmFjaykge1xuICAgICAgY2FsbGJhY2sgPSBjYWxsYmFjayB8fCBmdW5jdGlvbigpIHt9O1xuXG4gICAgICAvL+ODreODvOODiea4iOOBv+OBruOCouOCu+ODg+ODiOOCkumZpOWkluOBmeOCi1xuICAgICAgY29uc3QgbG9hZEFzc2V0cyA9IHRoaXMueWV0TG9hZGVkQXNzZXRzKGFzc2V0cyk7XG4gICAgICBpZiAoIWxvYWRBc3NldHMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGVsZW1lbnQgPSB7XG4gICAgICAgIGFzc2V0czogbG9hZEFzc2V0cyxcbiAgICAgICAgY2FsbGJhY2ssXG4gICAgICB9O1xuICAgICAgdGhpcy5sb2FkTGlzdC5wdXNoKGVsZW1lbnQpO1xuICAgICAgY29uc29sZS5sb2coXCIqKioqIFNlcmlhbCBsb2FkOiBcIi4gbG9hZEFzc2V0cyk7XG4gICAgfSxcblxuICAgIC8v44OR44Op44Oh44O844K/44Gu5Lit44Gn6Kqt44G/6L6844G/44KS44GX44Gm44GE44Gq44GE44Ki44K744OD44OI44KS6L+U44GZXG4gICAgeWV0TG9hZGVkQXNzZXRzOiBmdW5jdGlvbihwYXJhbXMpIHtcbiAgICAgIGlmICghcGFyYW1zKSByZXR1cm4gbnVsbDtcblxuICAgICAgY29uc3QgeWV0ID0ge307XG4gICAgICBwYXJhbXMuZm9ySW4oKHR5cGUsIGFzc2V0cykgPT4ge1xuICAgICAgICBhc3NldHMuZm9ySW4oKGtleSwgdmFsdWUpID0+IHtcbiAgICAgICAgICBpZiAoIXBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQodHlwZSwga2V5KSkge1xuICAgICAgICAgICAgeWV0W3R5cGVdID0geWV0W3R5cGVdIHx8IHt9O1xuICAgICAgICAgICAgeWV0W3R5cGVdW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gKE9iamVjdC5rZXlzKHlldCkubGVuZ3RoID4gMCkgPyB5ZXQgOiBudWxsO1xuICAgIH1cbiAgfSk7XG5cbn0pO1xuIiwiLypcbiAqICBwaGluYS5hc3NldGxvYWRlcmV4LmpzXG4gKiAgMjAxNi8xMS8yNVxuICogIEBhdXRoZXIgbWluaW1vICBcbiAqICBUaGlzIFByb2dyYW0gaXMgTUlUIGxpY2Vuc2UuXG4gKlxuICovXG5cbnBoaW5hLmV4dGVuc2lvbiA9IHBoaW5hLmV4dGVuc2lvbiB8fCB7fTtcblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIC8v44OQ44OD44Kv44Kw44Op44Km44Oz44OJ44Gn44Ki44K744OD44OI6Kqt44G/6L6844G/XG4gIHBoaW5hLmRlZmluZShcInBoaW5hLmV4dGVuc2lvbi5Bc3NldExvYWRlckV4XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLnV0aWwuRXZlbnREaXNwYXRjaGVyXCIsXG5cbiAgICAvL+mAsuaNl1xuICAgIGxvYWRwcm9ncmVzczogMCxcblxuICAgIC8v6Kqt44G/6L6844G/57WC5LqG44OV44Op44KwXG4gICAgaXNMb2FkY29tcGxldGU6IGZhbHNlLFxuXG4gICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnN1cGVySW5pdCgpO1xuICAgIH0sXG5cbiAgICBsb2FkOiBmdW5jdGlvbihhc3NldHMsIGNhbGxiYWNrKSB7XG4gICAgICB0aGlzLl9vbkxvYWRBc3NldHMgPSBjYWxsYmFjayB8fCBmdW5jdGlvbigpIHt9O1xuICAgICAgXG4gICAgICBjb25zdCBsb2FkQXNzZXRzID0gdGhpcy55ZXRMb2FkZWRBc3NldHMoYXNzZXRzKTtcbiAgICAgIGlmICghbG9hZEFzc2V0cykge1xuICAgICAgICB0aGlzLmlzTG9hZGNvbXBsZXRlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5sb2FkcHJvZ3Jlc3MgPSAxO1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgICAgdmFyIGxvYWRlciA9IHBoaW5hLmFzc2V0LkFzc2V0TG9hZGVyKCk7XG4gICAgICAgIGxvYWRlci5sb2FkKGxvYWRBc3NldHMpO1xuICAgICAgICBsb2FkZXIub24oJ2xvYWQnLCAoZSkgPT4ge1xuICAgICAgICAgIHRoaXMuZmxhcmUoJ2xvYWRjb21wbGV0ZScpO1xuICAgICAgICAgIHRoaXMuaXNMb2FkY29tcGxldGUgPSB0cnVlO1xuICAgICAgICAgIHRoaXMuX29uTG9hZEFzc2V0cyhhc3NldHMpO1xuICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGxvYWRlci5vbigncHJvZ3Jlc3MnLCBlID0+IHtcbiAgICAgICAgICB0aGlzLmxvYWRwcm9ncmVzcyA9IGUucHJvZ3Jlc3M7XG4gICAgICAgICAgdGhpcy5mbGFyZSgncHJvZ3Jlc3MnLCB7IHByb2dyZXNzOiBlLnByb2dyZXNzIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+ODkeODqeODoeODvOOCv+OBruS4reOBp+iqreOBv+i+vOOBv+OCkuOBl+OBpuOBhOOBquOBhOOCouOCu+ODg+ODiOOCkui/lOOBmVxuICAgIHlldExvYWRlZEFzc2V0czogZnVuY3Rpb24ocGFyYW1zKSB7XG4gICAgICBpZiAoIXBhcmFtcykgcmV0dXJuIG51bGw7XG5cbiAgICAgIGNvbnN0IHlldCA9IHt9O1xuICAgICAgcGFyYW1zLmZvckluKCh0eXBlLCBhc3NldHMpID0+IHtcbiAgICAgICAgYXNzZXRzLmZvckluKChrZXksIHZhbHVlKSA9PiB7XG4gICAgICAgICAgaWYgKCFwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KHR5cGUsIGtleSkpIHtcbiAgICAgICAgICAgIHlldFt0eXBlXSA9IHlldFt0eXBlXSB8fCB7fTtcbiAgICAgICAgICAgIHlldFt0eXBlXVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIChPYmplY3Qua2V5cyh5ZXQpLmxlbmd0aCA+IDApID8geWV0IDogbnVsbDtcbiAgICB9XG4gIH0pO1xuXG59KTsiLCJwaGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgcGhpbmEuZGVmaW5lKFwiQXBwbGljYXRpb25cIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5DYW52YXNBcHBcIixcbiAgXG4gICAgdmVyc2lvbjogXCIwLjcuMDAyXCIsXG4gICAgcXVhbGl0eTogMS4wLFxuICBcbiAgICB3ZWJBcGk6IG51bGwsXG4gICAgbW9kZTogXCJkZWZhdWx0XCIsXG5cbiAgICBpc0J1c3k6IGZhbHNlLFxuXG4gICAgZG93bmxvYWRJbWFnZTogbnVsbCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5zdXBlckluaXQoe1xuICAgICAgICBmcHM6IDMwLFxuICAgICAgICB3aWR0aDogU0NSRUVOX1dJRFRIICogdGhpcy5xdWFsaXR5LFxuICAgICAgICBoZWlnaHQ6IFNDUkVFTl9IRUlHSFQgKiB0aGlzLnF1YWxpdHksXG4gICAgICAgIGZpdDogdHJ1ZSxcbiAgICAgIH0pO1xuICBcbiAgICAgIHRoaXMuc2V0dXBNb3VzZVdoZWVsKCk7XG5cbiAgICAgIC8v44K344O844Oz44Gu5bmF44CB6auY44GV44Gu5Z+65pys44KS6Kit5a6aXG4gICAgICBwaGluYS5kaXNwbGF5LkRpc3BsYXlTY2VuZS5kZWZhdWx0cy4kZXh0ZW5kKHtcbiAgICAgICAgd2lkdGg6IFNDUkVFTl9XSURUSCxcbiAgICAgICAgaGVpZ2h0OiBTQ1JFRU5fSEVJR0hULFxuICAgICAgfSk7XG4gIFxuICAgICAgcGhpbmEuaW5wdXQuSW5wdXQucXVhbGl0eSA9IHRoaXMucXVhbGl0eTtcbiAgICAgIHBoaW5hLmRpc3BsYXkuRGlzcGxheVNjZW5lLnF1YWxpdHkgPSB0aGlzLnF1YWxpdHk7XG5cbiAgICAgIHRoaXMuYXNzZXRMb2FkZXIgPSBwaGluYS5leHRlbnNpb24uU2VyaWFsQXNzZXRMb2FkZXIoKTtcbiAgICAgIHRoaXMud2ViQXBpID0gV2ViQXBpKHsgYXBwOiBwaGluYV9hcHAgfSk7XG4gIFxuICAgICAgdGhpcy5yZXBsYWNlU2NlbmUoRmlyc3RTY2VuZUZsb3coe30pKTtcbiAgXG4gICAgICB0aGlzLnNldHVwRXZlbnRzKCk7XG4gICAgICB0aGlzLnNldHVwU291bmQoKTtcbiAgICAgIHRoaXMuc2V0dXBGb250QXR0cmlidXRlKCk7XG5cbiAgICAgIC8v44OA44Km44Oz44Ot44O844OJ44GX44Gf55S75YOP44Kt44O86YWN5YiXXG4gICAgICB0aGlzLmRvd25sb2FkSW1hZ2UgPSBbXTtcbiAgXG4gICAgICB0aGlzLm9uKFwiY2hhbmdlc2NlbmVcIiwgKCkgPT4ge1xuICAgICAgICAvL+OCt+ODvOODs+OCkumbouOCjOOCi+mam+OAgeODnOOCv+ODs+WQjOaZguaKvOOBl+ODleODqeOCsOOCkuino+mZpOOBmeOCi1xuICAgICAgICBCdXR0b24uYWN0aW9uVGFyZ2V0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5kb3dubG9hZEltYWdlLmZvckVhY2gobmFtZSA9PiB7XG4gICAgICAgICAgY29uc3QgaW1nID0gQXNzZXRNYW5hZ2VyLmdldChcImltYWdlXCIsIG5hbWUpO1xuICAgICAgICAgIGlmIChpbWcpIHtcbiAgICAgICAgICAgIGltZ1tcImRvbUVsZW1lbnRcIl0ud2lkdGggPSAwO1xuICAgICAgICAgICAgaW1nW1wiZG9tRWxlbWVudFwiXS5oZWlnaHQgPSAwO1xuICAgICAgICAgICAgZGVsZXRlIGltZ1tcImRvbUVsZW1lbnRcIl07XG4gICAgICAgICAgICBkZWxldGUgQXNzZXRNYW5hZ2VyLmFzc2V0c1tcImltYWdlXCJdW25hbWVdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZG93bmxvYWRJbWFnZSA9IFtdO1xuICAgICAgfSk7XG4gIFxuICAgICAgY29uc29sZS5sb2cod2luZG93LmRlYnVnQXBwID0gdGhpcyk7XG4gICAgfSxcbiAgXG4gICAgLy/jg57jgqbjgrnjga7jg5vjg7zjg6vjgqTjg5njg7Pjg4jplqLpgKNcbiAgICBzZXR1cE1vdXNlV2hlZWw6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy53aGVlbERlbHRhWSA9IDA7XG4gICAgICB0aGlzLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNld2hlZWxcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRoaXMud2hlZWxEZWx0YVkgPSBlLmRlbHRhWTtcbiAgICAgIH0uYmluZCh0aGlzKSwgZmFsc2UpO1xuICBcbiAgICAgIHRoaXMub24oXCJlbnRlcmZyYW1lXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnBvaW50ZXIud2hlZWxEZWx0YVkgPSB0aGlzLndoZWVsRGVsdGFZO1xuICAgICAgICB0aGlzLndoZWVsRGVsdGFZID0gMDtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+OCouODl+ODquOCseODvOOCt+ODp+ODs+WFqOS9k+OBruOCpOODmeODs+ODiOODleODg+OCr1xuICAgIHNldHVwRXZlbnRzOiBmdW5jdGlvbigpIHt9LFxuICBcbiAgICBzZXR1cFNvdW5kOiBmdW5jdGlvbigpIHt9LFxuICAgIFxuICAgIHNldHVwRm9udEF0dHJpYnV0ZTogZnVuY3Rpb24oKSB7XG4gICAgICBwaGluYS5kaXNwbGF5LkxhYmVsLmRlZmF1bHRzLiRleHRlbmQoe1xuICAgICAgICBmb250RmFtaWx5OiBcIk1haW4tUmVndWxhclwiXG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/oqo3oqLzjg6bjg7zjgrbjg7zjg4fjg7zjgr/mnIDmlrDlj5blvpdcbiAgICB1cGRhdGVVc2VyRGF0YTogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICAgIGxldCB1c2VyID0gbnVsbDtcbiAgICAgICAgcGhpbmFfYXBwLndlYkFwaS5nZXQoXCJ1c2VyXCIsIHt9LCB7IGlzTW9jazogZmFsc2UgfSlcbiAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICB1c2VyID0gcmVzcG9uc2UucmVzdWx0O1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRoZW4oKCkgPT4gcGhpbmFfYXBwLndlYkFwaS5nZXQoYHVzZXIvJHt1c2VyLnN0YWZmX2NvZGV9L3NhbGVzL3Jlc3VsdGAsIHt9LCB7IGlzTW9jazogZmFsc2UgfSkpXG4gICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gcmVzb2x2ZSh7IHVzZXIsIHNhbGVzOiByZXNwb25zZS5yZXN1bHQgfSkpXG4gICAgICB9KVxuICAgICAgLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgIFVzZXJEYXRhLnJlc3VsdCA9IGRhdGEudXNlcjtcbiAgICAgICAgdGhpcy51c2VyRGF0YSA9IGRhdGEudXNlcjtcbiAgICAgICAgdGhpcy51c2VyU2FsZXMgPSBkYXRhLnNhbGVzO1xuICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v44K144O844OQ44O844GL44KJ55u05YiX44Gn44Ki44K744OD44OI44KS6Kqt44G/6L6844G/XG4gICAgZG93bmxvYWRGcm9tU2VydmVyOiBmdW5jdGlvbiAocmVxdWVzdFVybCkge1xuICAgICAgaWYgKCFyZXF1ZXN0VXJsKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiZG93bmxvYWQgcmVxdWVzdCBlcnJvcjogXCIgKyByZXF1ZXN0VXJsKTtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICAgIGNvbnN0IHVybCA9IGVuY29kZVVSSShyZXF1ZXN0VXJsKTtcbiAgICAgICAgY29uc3QgdG1wID0gdXJsLnNwbGl0KFwiL1wiKTtcbiAgICAgICAgY29uc3QgZmlsZW5hbWUgPSB0bXBbdG1wLmxlbmd0aCAtIDFdO1xuICAgICAgICBjb25zdCBmaWxlUGF0aCA9IGAke2FwcC5yb290RGlyfXNlcnZlcl9pbWFnZXMvJHtmaWxlbmFtZX1gO1xuXG4gICAgICAgIGNvbnN0IGZpbGVUcmFuc2ZlciA9IG5ldyBGaWxlVHJhbnNmZXIoKTtcbiAgICAgICAgZmlsZVRyYW5zZmVyLmRvd25sb2FkKHVybCwgZmlsZVBhdGgsXG4gICAgICAgICAgZW50cnkgPT4ge1xuICAgICAgICAgICAgLy8gYWxlcnQoJ3N1Y2Nlc3M6ICcgKyBmaWxlUGF0aCk7XG4gICAgICAgICAgICBjb25zdCBhc3NldHMgPSB7XG4gICAgICAgICAgICAgIGltYWdlOiB7fSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBhc3NldHMuaW1hZ2VbcmVxdWVzdFVybF0gPSBmaWxlUGF0aDtcbiAgICAgICAgICAgIHRoaXMuYXNzZXRMb2FkZXIubG9hZChhc3NldHMsICgpID0+IHtcbiAgICAgICAgICAgICAgLy/jg4Djgqbjg7Pjg63jg7zjg4njgZfjgZ/jgqTjg6Hjg7zjgrjjg6rjgrnjg4jjgavov73liqBcbiAgICAgICAgICAgICAgdGhpcy5kb3dubG9hZEltYWdlLnB1c2gocmVxdWVzdFVybCk7XG4gICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgICAgLy8gYWxlcnQoJ2Vycm9yOiAnICsgZXJyb3IuY29kZSk7XG4gICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9LFxuICB9KTtcbiAgXG59KTsiLCIvKlxuICogIEFzc2V0TGlzdC5qc1xuICovXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICBwaGluYS5kZWZpbmUoXCJBc3NldExpc3RcIiwge1xuICAgIF9zdGF0aWM6IHtcbiAgICAgIGxvYWRlZDogW10sXG4gICAgICBpc0xvYWRlZDogZnVuY3Rpb24oYXNzZXRUeXBlKSB7XG4gICAgICAgIHJldHVybiBBc3NldExpc3QubG9hZGVkW2Fzc2V0VHlwZV0/IHRydWU6IGZhbHNlO1xuICAgICAgfSxcbiAgICAgIGdldDogZnVuY3Rpb24oYXNzZXRUeXBlKSB7XG4gICAgICAgIEFzc2V0TGlzdC5sb2FkZWRbYXNzZXRUeXBlXSA9IHRydWU7XG4gICAgICAgIHN3aXRjaCAoYXNzZXRUeXBlKSB7XG4gICAgICAgICAgY2FzZSBcInByZWxvYWRcIjpcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIGltYWdlOiB7XG4gICAgICAgICAgICAgICAgXCJibGFja1wiOiBcImFzc2V0cy90ZXh0dXJlcy9jb21tb24vYmxhY2sucG5nXCIsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGxheW91dDoge1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAvLyBmb250OiB7XG4gICAgICAgICAgICAgIC8vICAgXCJNYWluLUJvbGRcIjogXCJhc3NldHMvZm9udHMvU291cmNlSGFuU2Fuc0pQLUJvbGQub3RmXCIsXG4gICAgICAgICAgICAgIC8vICAgXCJNYWluLVJlZ3VsYXJcIjogXCJhc3NldHMvZm9udHMvU291cmNlSGFuU2Fuc0pQLVJlZ3VsYXIub3RmXCIsXG4gICAgICAgICAgICAgIC8vIH0sXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY2FzZSBcImNvbW1vblwiOlxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgaW1hZ2U6IHtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdGhyb3cgXCJpbnZhbGlkIGFzc2V0VHlwZTogXCIgKyBvcHRpb25zLmFzc2V0VHlwZTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxufSk7XG4iLCIvKlxuICogIE1haW5TY2VuZS5qc1xuICogIDIwMTgvMTAvMjZcbiAqL1xuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgcGhpbmEuZGVmaW5lKFwiQmFzZVNjZW5lXCIsIHtcbiAgICBzdXBlckNsYXNzOiAnRGlzcGxheVNjZW5lJyxcblxuICAgIC8v5buD5qOE44Ko44Os44Oh44Oz44OIXG4gICAgZGlzcG9zZUVsZW1lbnRzOiBudWxsLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kc2FmZSh7XG4gICAgICAgIHdpZHRoOiBTQ1JFRU5fV0lEVEgsXG4gICAgICAgIGhlaWdodDogU0NSRUVOX0hFSUdIVCxcbiAgICAgICAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICAgICAgfSk7XG4gICAgICB0aGlzLnN1cGVySW5pdChvcHRpb25zKTtcblxuICAgICAgLy/jgrfjg7zjg7Ppm6LohLHmmYJjYW52YXPjg6Hjg6Ljg6rop6PmlL5cbiAgICAgIHRoaXMuZGlzcG9zZUVsZW1lbnRzID0gW107XG4gICAgICB0aGlzLm9uZSgnZGVzdHJveScsICgpID0+IHtcbiAgICAgICAgdGhpcy5kaXNwb3NlRWxlbWVudHMuZm9yRWFjaChlID0+IGUuZGVzdHJveUNhbnZhcygpKTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmFwcCA9IHBoaW5hX2FwcDtcblxuICAgICAgdGhpcy5vbmUoJ2VudGVyZnJhbWUnLCBlID0+IHtcbiAgICAgICAgdGhpcy5hcHAgPSBlLmFwcDtcbiAgICAgICAgLy/liKXjgrfjg7zjg7Pjgbjjga7np7vooYzmmYLjgavjgq3jg6Pjg7Pjg5DjgrnjgpLnoLTmo4RcbiAgICAgICAgdGhpcy5vbmUoJ2V4aXQnLCAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5kZXN0cm95KCk7XG4gICAgICAgICAgdGhpcy5jYW52YXMuZGVzdHJveSgpO1xuICAgICAgICAgIHRoaXMuZmxhcmUoJ2Rlc3Ryb3knKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIkV4aXQgc2NlbmUuXCIpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBkZXN0cm95OiBmdW5jdGlvbigpIHt9LFxuXG4gICAgZmFkZUluOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRzYWZlKHtcbiAgICAgICAgY29sb3I6IFwid2hpdGVcIixcbiAgICAgICAgbWlsbGlzZWNvbmQ6IDUwMCxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICBjb25zdCBtYXNrID0gUmVjdGFuZ2xlU2hhcGUoe1xuICAgICAgICAgIHdpZHRoOiBTQ1JFRU5fV0lEVEgsXG4gICAgICAgICAgaGVpZ2h0OiBTQ1JFRU5fSEVJR0hULFxuICAgICAgICAgIGZpbGw6IG9wdGlvbnMuY29sb3IsXG4gICAgICAgICAgc3Ryb2tlV2lkdGg6IDAsXG4gICAgICAgIH0pLnNldFBvc2l0aW9uKFNDUkVFTl9XSURUSCAqIDAuNSwgU0NSRUVOX0hFSUdIVCAqIDAuNSkuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgbWFzay50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAuZmFkZU91dChvcHRpb25zLm1pbGxpc2Vjb25kKVxuICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIHRoaXMuYXBwLm9uZSgnZW50ZXJmcmFtZScsICgpID0+IG1hc2suZGVzdHJveUNhbnZhcygpKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBmYWRlT3V0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBvcHRpb25zID0gKG9wdGlvbnMgfHwge30pLiRzYWZlKHtcbiAgICAgICAgY29sb3I6IFwid2hpdGVcIixcbiAgICAgICAgbWlsbGlzZWNvbmQ6IDUwMCxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICBjb25zdCBtYXNrID0gUmVjdGFuZ2xlU2hhcGUoe1xuICAgICAgICAgIHdpZHRoOiBTQ1JFRU5fV0lEVEgsXG4gICAgICAgICAgaGVpZ2h0OiBTQ1JFRU5fSEVJR0hULFxuICAgICAgICAgIGZpbGw6IG9wdGlvbnMuY29sb3IsXG4gICAgICAgICAgc3Ryb2tlV2lkdGg6IDAsXG4gICAgICAgIH0pLnNldFBvc2l0aW9uKFNDUkVFTl9XSURUSCAqIDAuNSwgU0NSRUVOX0hFSUdIVCAqIDAuNSkuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgICAgbWFzay5hbHBoYSA9IDA7XG4gICAgICAgIG1hc2sudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgLmZhZGVJbihvcHRpb25zLm1pbGxpc2Vjb25kKVxuICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIHRoaXMuYXBwLm9uZSgnZW50ZXJmcmFtZScsICgpID0+IG1hc2suZGVzdHJveUNhbnZhcygpKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+OCouOCu+ODg+ODiOOCkuODkOODg+OCr+OCsOODqeOCpuODs+ODieOBp+iqreOBv+i+vOOBv1xuICAgIGRvd25sb2FkQXNzZXQ6IGZ1bmN0aW9uKGFzc2V0cykge1xuICAgICAgaWYgKCFhc3NldHMpIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcblxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICBjb25zdCBsb2FkZXIgPSBwaGluYS5leHRlbnNpb24uQXNzZXRMb2FkZXJFeCgpO1xuICAgICAgICBsb2FkZXIubG9hZChhc3NldHMsIHRoaXMuX29uTG9hZEFzc2V0KVxuICAgICAgICAgIC50aGVuKCgpID0+IHJlc29sdmUoKSk7XG5cbiAgICAgICAgY29uc3QgbG9hZExhYmVsID0gTGFiZWwoeyB0ZXh0OiBcIlwiLCBhbGlnbjogXCJyaWdodFwiLCBmb250U2l6ZTogMTIsIGZpbGw6IFwid2hpdGVcIiwgc3Ryb2tlOiBcImJsYWNrXCIsIHN0cm9rZVdpZHRoOiAzIH0pXG4gICAgICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKFNDUkVFTl9XSURUSCAqIDAuOTksIFNDUkVFTl9IRUlHSFQgKiAwLjk5KTtcbiAgICAgICAgbG9hZExhYmVsLnRpbWUgPSAxO1xuICAgICAgICBsb2FkTGFiZWwuaXNGaW5pc2ggPSBmYWxzZTtcbiAgICAgICAgbG9hZExhYmVsLm9uKCdlbnRlcmZyYW1lJywgKCkgPT4ge1xuICAgICAgICAgIGxvYWRMYWJlbC50ZXh0ID0gXCJMb2FkaW5nLi4uIFwiICsgTWF0aC5mbG9vcihsb2FkZXIubG9hZHByb2dyZXNzICogMTAwKSArIFwiJVwiO1xuICAgICAgICAgIGlmIChsb2FkZXIuaXNMb2FkY29tcGxldGUpIHtcbiAgICAgICAgICAgIGxvYWRMYWJlbC52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChsb2FkTGFiZWwudGltZSAlIDIwID09IDApIGxvYWRMYWJlbC52aXNpYmxlID0gIWxvYWRMYWJlbC52aXNpYmxlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBsb2FkTGFiZWwudGltZSsrO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBfb25Mb2FkQXNzZXQ6IGZ1bmN0aW9uKGFzc2V0cykge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH0sXG5cbiAgICAvL+OCt+ODvOODs+mbouiEseaZguOBq+egtOajhOOBmeOCi1NoYXBl44KS55m76YyyXG4gICAgZGlzcG9zZTogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgdGhpcy5kaXNwb3NlRWxlbWVudHMucHVzaChlbGVtZW50KTtcbiAgICB9LFxuICB9KTtcblxufSk7IiwiLypcbiAqICBGaXJzdFNjZW5lRmxvdy5qc1xuICovXG5cbnBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICBwaGluYS5kZWZpbmUoXCJGaXJzdFNjZW5lRmxvd1wiLCB7XG4gICAgc3VwZXJDbGFzczogXCJNYW5hZ2VyU2NlbmVcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgICAgc3RhcnRMYWJlbCA9IG9wdGlvbnMuc3RhcnRMYWJlbCB8fCBcInRpdGxlXCI7XG4gICAgICB0aGlzLnN1cGVySW5pdCh7XG4gICAgICAgIHN0YXJ0TGFiZWw6IHN0YXJ0TGFiZWwsXG4gICAgICAgIHNjZW5lczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiBcInRpdGxlXCIsXG4gICAgICAgICAgICBjbGFzc05hbWU6IFwiVGl0bGVTY2VuZVwiLFxuICAgICAgICAgICAgbmV4dExhYmVsOiBcImhvbWVcIixcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiBcImhvbWVcIixcbiAgICAgICAgICAgIGNsYXNzTmFtZTogXCJIb21lU2NlbmVcIixcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiBcImVkaXRwaWN0dXJlXCIsXG4gICAgICAgICAgICBjbGFzc05hbWU6IFwiRWRpdFBpY3R1cmVTY2VuZVwiLFxuICAgICAgICAgICAgbmV4dExhYmVsOiBcImhvbWVcIixcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiBcInJlYWx0aW1lc2FsZXNcIixcbiAgICAgICAgICAgIGNsYXNzTmFtZTogXCJSZWFsdGltZVNhbGVzU2NlbmVcIixcbiAgICAgICAgICAgIG5leHRMYWJlbDogXCJob21lXCIsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogXCJzdGFmZmluZm9ybWF0aW9uXCIsXG4gICAgICAgICAgICBjbGFzc05hbWU6IFwiU3RhZmZJbmZvcm1hdGlvblNjZW5lXCIsXG4gICAgICAgICAgICBuZXh0TGFiZWw6IFwiaG9tZVwiLFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgbGFiZWw6IFwicmFua2luZ1wiLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiBcIlJhbmtpbmdTY2VuZVwiLFxuICAgICAgICAgICAgbmV4dExhYmVsOiBcImhvbWVcIixcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiBcImRldGFpbGRhdGFcIixcbiAgICAgICAgICAgIGNsYXNzTmFtZTogXCJEZXRhaWxEYXRhU2NlbmVcIixcbiAgICAgICAgICAgIG5leHRMYWJlbDogXCJob21lXCIsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbDogXCJlcnJvclwiLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiBcIkVycm9yTWVzc2FnZVNjZW5lXCIsXG4gICAgICAgICAgICBuZXh0TGFiZWw6IFwiaG9tZVwiLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG59KTsiLCJwaGluYS5kZWZpbmUoXCJCdXR0b25cIiwge1xuICBzdXBlckNsYXNzOiBcIkFjY2Vzc29yeVwiLFxuXG4gIGxvZ25wcmVzc1RpbWU6IDUwMCxcbiAgZG9Mb25ncHJlc3M6IGZhbHNlLFxuXG4gIC8v6ZW35oq844GX44Gn6YCj5omT44Oi44O844OJXG4gIGxvbmdwcmVzc0JhcnJhZ2U6IGZhbHNlLFxuXG4gIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc3VwZXJJbml0KCk7XG5cbiAgICB0aGlzLm9uKFwiYXR0YWNoZWRcIiwgKCkgPT4ge1xuICAgICAgdGhpcy50YXJnZXQuaW50ZXJhY3RpdmUgPSB0cnVlO1xuICAgICAgdGhpcy50YXJnZXQuY2xpY2tTb3VuZCA9IEJ1dHRvbi5kZWZhdWx0cy5jbGlja1NvdW5kO1xuXG4gICAgICAvL+ODnOOCv+ODs+aKvOOBl+aZgueUqFxuICAgICAgdGhpcy50YXJnZXQuc2NhbGVUd2VlbmVyID0gVHdlZW5lcigpLmF0dGFjaFRvKHRoaXMudGFyZ2V0KTtcblxuICAgICAgLy/plbfmirzjgZfnlKhcbiAgICAgIHRoaXMudGFyZ2V0LnR3TG9uZ3ByZXNzID0gVHdlZW5lcigpLmF0dGFjaFRvKHRoaXMudGFyZ2V0KTtcblxuICAgICAgLy/plbfmirzjgZfkuK3nibnmrorlr77lv5znlKhcbiAgICAgIHRoaXMudGFyZ2V0LnR3TG9uZ3ByZXNzaW5nID0gVHdlZW5lcigpLmF0dGFjaFRvKHRoaXMudGFyZ2V0KTtcblxuICAgICAgdGhpcy50YXJnZXQub24oXCJwb2ludHN0YXJ0XCIsIChlKSA9PiB7XG5cbiAgICAgICAgLy/jgqTjg5njg7Pjg4josqvpgJrjgavjgZfjgabjgYrjgY9cbiAgICAgICAgZS5wYXNzID0gdHJ1ZTtcblxuICAgICAgICAvL+ODnOOCv+ODs+OBruWQjOaZguaKvOOBl+OCkuWItumZkFxuICAgICAgICBpZiAoQnV0dG9uLmFjdGlvblRhcmdldCAhPT0gbnVsbCkgcmV0dXJuO1xuXG4gICAgICAgIC8v44Oq44K544OI44OT44Ol44O844Gu5a2Q5L6b44Gg44Gj44Gf5aC05ZCI44Gvdmlld3BvcnTjgajjga7jgYLjgZ/jgorliKTlrprjgpLjgZnjgotcbiAgICAgICAgY29uc3QgbGlzdFZpZXcgPSBCdXR0b24uZmluZExpc3RWaWV3KGUudGFyZ2V0KTtcbiAgICAgICAgaWYgKGxpc3RWaWV3ICYmICFsaXN0Vmlldy52aWV3cG9ydC5oaXRUZXN0KGUucG9pbnRlci54LCBlLnBvaW50ZXIueSkpIHJldHVybjtcblxuICAgICAgICBpZiAobGlzdFZpZXcpIHtcbiAgICAgICAgICAvL+ODneOCpOODs+OCv+OBjOenu+WLleOBl+OBn+WgtOWQiOOBr+mVt+aKvOOBl+OCreODo+ODs+OCu+ODq++8iGxpc3RWaWV35YaF54mI77yJXG4gICAgICAgICAgbGlzdFZpZXcuaW5uZXIuJHdhdGNoKCd5JywgKHYxLCB2MikgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMudGFyZ2V0ICE9PSBCdXR0b24uYWN0aW9uVGFyZ2V0KSByZXR1cm47XG4gICAgICAgICAgICBpZiAoTWF0aC5hYnModjEgLSB2MikgPCAxMCkgcmV0dXJuO1xuXG4gICAgICAgICAgICBCdXR0b24uYWN0aW9uVGFyZ2V0ID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0LnR3TG9uZ3ByZXNzLmNsZWFyKCk7XG4gICAgICAgICAgICB0aGlzLnRhcmdldC5zY2FsZVR3ZWVuZXIuY2xlYXIoKS50byh7IHNjYWxlWDogMS4wICogdGhpcy5zeCwgc2NhbGVZOiAxLjAgKiB0aGlzLnN5IH0sIDUwKTtcbiAgICAgICAgICAgIC8vIGlmICh0aGlzLnRhcmdldC50d0xvbmdwcmVzcy5wbGF5aW5nICYmIHYxICE9IHYyKSB7XG4gICAgICAgICAgICAvLyAgIEJ1dHRvbi5hY3Rpb25UYXJnZXQgPSBudWxsO1xuICAgICAgICAgICAgLy8gICB0aGlzLnRhcmdldC50d0xvbmdwcmVzcy5jbGVhcigpO1xuICAgICAgICAgICAgLy8gfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy/jg5zjgr/jg7Pjga7lh6bnkIbjgpLlrp/ooYzjgZfjgabjgoLllY/poYzjgarjgYTloLTlkIjjga7jgb/osqvpgJrjgpLlgZzmraLjgZnjgotcbiAgICAgICAgZS5wYXNzID0gZmFsc2U7XG4gICAgICAgIEJ1dHRvbi5hY3Rpb25UYXJnZXQgPSB0aGlzLnRhcmdldDtcblxuICAgICAgICAvL+WPjei7ouOBl+OBpuOBhOOCi+ODnOOCv+ODs+eUqOOBq+S/neaMgeOBmeOCi1xuICAgICAgICB0aGlzLnN4ID0gKHRoaXMudGFyZ2V0LnNjYWxlWCA+IDApID8gMSA6IC0xO1xuICAgICAgICB0aGlzLnN5ID0gKHRoaXMudGFyZ2V0LnNjYWxlWSA+IDApID8gMSA6IC0xO1xuXG4gICAgICAgIHRoaXMudGFyZ2V0LnNjYWxlVHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgLnRvKHsgc2NhbGVYOiAwLjggKiB0aGlzLnN4LCBzY2FsZVk6IDAuOCAqIHRoaXMuc3kgfSwgNTApO1xuXG4gICAgICAgIHRoaXMuZG9Mb25ncHJlc3MgPSBmYWxzZTtcbiAgICAgICAgdGhpcy50YXJnZXQudHdMb25ncHJlc3MuY2xlYXIoKVxuICAgICAgICAgIC53YWl0KHRoaXMubG9nbnByZXNzVGltZSlcbiAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIXRoaXMubG9uZ3ByZXNzQmFycmFnZSkge1xuICAgICAgICAgICAgICBCdXR0b24uYWN0aW9uVGFyZ2V0ID0gbnVsbDtcbiAgICAgICAgICAgICAgdGhpcy50YXJnZXQuc2NhbGVUd2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgICAgICAudG8oeyBzY2FsZVg6IDEuMCAqIHRoaXMuc3gsIHNjYWxlWTogMS4wICogdGhpcy5zeSB9LCA1MClcbiAgICAgICAgICAgICAgdGhpcy50YXJnZXQuZmxhcmUoXCJsb25ncHJlc3NcIilcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMudGFyZ2V0LmZsYXJlKFwiY2xpY2tTb3VuZFwiKTtcbiAgICAgICAgICAgICAgdGhpcy50YXJnZXQudHdMb25ncHJlc3NpbmcuY2xlYXIoKVxuICAgICAgICAgICAgICAgIC53YWl0KDUpXG4gICAgICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgdGhpcy50YXJnZXQuZmxhcmUoXCJjbGlja2VkXCIsIHsgbG9uZ3ByZXNzOiB0cnVlIH0pO1xuICAgICAgICAgICAgICAgICAgdGhpcy50YXJnZXQuZmxhcmUoXCJsb25ncHJlc3NpbmdcIik7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc2V0TG9vcCh0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnRhcmdldC5vbihcInBvaW50ZW5kXCIsIChlKSA9PiB7XG4gICAgICAgIC8v44Kk44OZ44Oz44OI6LKr6YCa44Gr44GX44Gm44GK44GPXG4gICAgICAgIGUucGFzcyA9IHRydWU7XG5cbiAgICAgICAgLy9cbiAgICAgICAgdGhpcy50YXJnZXQudHdMb25ncHJlc3MuY2xlYXIoKTtcbiAgICAgICAgdGhpcy50YXJnZXQudHdMb25ncHJlc3NpbmcuY2xlYXIoKTtcblxuICAgICAgICAvL+OCv+ODvOOCsuODg+ODiOOBjG51bGzjgYtwb2ludHN0YXJ044Gn5L+d5oyB44GX44Gf44K/44O844Ky44OD44OI44Go6YGV44GG5aC05ZCI44Gv44K544Or44O844GZ44KLXG4gICAgICAgIGlmIChCdXR0b24uYWN0aW9uVGFyZ2V0ID09PSBudWxsKSByZXR1cm47XG4gICAgICAgIGlmIChCdXR0b24uYWN0aW9uVGFyZ2V0ICE9PSB0aGlzLnRhcmdldCkgcmV0dXJuO1xuXG4gICAgICAgIC8v44Oc44K/44Oz44Gu5Yem55CG44KS5a6f6KGM44GX44Gm44KC5ZWP6aGM44Gq44GE5aC05ZCI44Gu44G/6LKr6YCa44KS5YGc5q2i44GZ44KLXG4gICAgICAgIGUucGFzcyA9IGZhbHNlO1xuXG4gICAgICAgIC8v5oq844GX44Gf5L2N572u44GL44KJ44GC44KL56iL5bqm56e75YuV44GX44Gm44GE44KL5aC05ZCI44Gv44Kv44Oq44OD44Kv44Kk44OZ44Oz44OI44KS55m655Sf44GV44Gb44Gq44GEXG4gICAgICAgIGNvbnN0IGlzTW92ZSA9IGUucG9pbnRlci5zdGFydFBvc2l0aW9uLnN1YihlLnBvaW50ZXIucG9zaXRpb24pLmxlbmd0aCgpID4gNTA7XG4gICAgICAgIGNvbnN0IGhpdFRlc3QgPSB0aGlzLnRhcmdldC5oaXRUZXN0KGUucG9pbnRlci54LCBlLnBvaW50ZXIueSk7XG4gICAgICAgIGlmIChoaXRUZXN0ICYmICFpc01vdmUpIHRoaXMudGFyZ2V0LmZsYXJlKFwiY2xpY2tTb3VuZFwiKTtcblxuICAgICAgICB0aGlzLnRhcmdldC5zY2FsZVR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgIC50byh7IHNjYWxlWDogMS4wICogdGhpcy5zeCwgc2NhbGVZOiAxLjAgKiB0aGlzLnN5IH0sIDUwKVxuICAgICAgICAgIC5jYWxsKCgpID0+IHtcbiAgICAgICAgICAgIEJ1dHRvbi5hY3Rpb25UYXJnZXQgPSBudWxsO1xuICAgICAgICAgICAgaWYgKCFoaXRUZXN0IHx8IGlzTW92ZSB8fCB0aGlzLmRvTG9uZ3ByZXNzKSByZXR1cm47XG4gICAgICAgICAgICB0aGlzLnRhcmdldC5mbGFyZShcImNsaWNrZWRcIiwgeyBwb2ludGVyOiBlLnBvaW50ZXIgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgLy/jgqLjg4vjg6Hjg7zjgrfjg6fjg7Pjga7mnIDkuK3jgavliYrpmaTjgZXjgozjgZ/loLTlkIjjgavlgpnjgYjjgaZyZW1vdmVk44Kk44OZ44Oz44OI5pmC44Gr44OV44Op44Kw44KS5YWD44Gr5oi744GX44Gm44GK44GPXG4gICAgICB0aGlzLnRhcmdldC5vbmUoXCJyZW1vdmVkXCIsICgpID0+IHtcbiAgICAgICAgaWYgKEJ1dHRvbi5hY3Rpb25UYXJnZXQgPT09IHRoaXMudGFyZ2V0KSB7XG4gICAgICAgICAgQnV0dG9uLmFjdGlvblRhcmdldCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnRhcmdldC5vbihcImNsaWNrU291bmRcIiwgKCkgPT4ge1xuICAgICAgICAvLyBpZiAoIXRoaXMudGFyZ2V0LmNsaWNrU291bmQgfHwgdGhpcy50YXJnZXQuY2xpY2tTb3VuZCA9PSBcIlwiKSByZXR1cm47XG4gICAgICAgIC8vIHBoaW5hLmFzc2V0LlNvdW5kTWFuYWdlci5wbGF5KHRoaXMudGFyZ2V0LmNsaWNrU291bmQpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0sXG5cbiAgLy/plbfmirzjgZfjga7lvLfliLbjgq3jg6Pjg7Pjgrvjg6tcbiAgbG9uZ3ByZXNzQ2FuY2VsOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnRhcmdldC50d0xvbmdwcmVzcy5jbGVhcigpO1xuICAgIHRoaXMudGFyZ2V0LnR3TG9uZ3ByZXNzaW5nLmNsZWFyKCk7XG4gIH0sXG5cbiAgX3N0YXRpYzoge1xuICAgIC8v44Oc44K/44Oz5ZCM5pmC5oq844GX44KS5Yi25b6h44GZ44KL44Gf44KB44Grc3RhdHVz44Gvc3RhdGlj44Gr44GZ44KLXG4gICAgc3RhdHVzOiAwLFxuICAgIGFjdGlvblRhcmdldDogbnVsbCxcbiAgICAvL+WfuuacrOioreWumlxuICAgIGRlZmF1bHRzOiB7XG4gICAgICBjbGlja1NvdW5kOiBcInNlX2NsaWNrXCIsIC8vVE9ETzrjgajjgorjgYLjgYjjgZrnhKHpn7NcbiAgICB9LFxuXG4gICAgLy9MaXN0Vmlld+OCkuimquOCkuOBn+OBqeOBo+OBpuaOouOBmVxuICAgIGZpbmRMaXN0VmlldzogZnVuY3Rpb24oZWxlbWVudCwgcCkge1xuICAgICAgLy/jg6rjgrnjg4jjg5Pjg6Xjg7zjgpLmjIHjgaPjgabjgYTjgovloLTlkIhcbiAgICAgIGlmIChlbGVtZW50Lkxpc3RWaWV3ICE9IG51bGwpIHJldHVybiBlbGVtZW50Lkxpc3RWaWV3O1xuICAgICAgLy/opqrjgYzjgarjgZHjgozjgbDntYLkuoZcbiAgICAgIGlmIChlbGVtZW50LnBhcmVudCA9PSBudWxsKSByZXR1cm4gbnVsbDtcbiAgICAgIC8v6Kaq44KS44Gf44Gp44KLXG4gICAgICByZXR1cm4gdGhpcy5maW5kTGlzdFZpZXcoZWxlbWVudC5wYXJlbnQpO1xuICAgIH1cblxuICB9XG5cbn0pO1xuIiwicGhpbmEuZGVmaW5lKFwiR2F1Z2VcIiwge1xuICBzdXBlckNsYXNzOiBcIlJlY3RhbmdsZUNsaXBcIixcblxuICBfbWluOiAwLFxuICBfbWF4OiAxLjAsXG4gIF92YWx1ZTogMS4wLCAvL21pbiB+IG1heFxuXG4gIGRpcmVjdGlvbjogXCJob3Jpem9udGFsXCIsIC8vIGhvcml6b250YWwgb3IgdmVydGljYWxcblxuICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnN1cGVySW5pdCgpO1xuICAgIHRoaXMub24oXCJhdHRhY2hlZFwiLCAoKSA9PiB7XG4gICAgICB0aGlzLl93aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgICB0aGlzLl9oZWlnaHQgPSB0aGlzLndpZHRoO1xuXG4gICAgICB0aGlzLnRhcmdldC5hY2Nlc3NvcihcIkdhdWdlLm1pblwiLCB7XG4gICAgICAgIFwiZ2V0XCI6ICgpID0+IHRoaXMubWluLFxuICAgICAgICBcInNldFwiOiAodikgPT4gdGhpcy5taW4gPSB2LFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMudGFyZ2V0LmFjY2Vzc29yKFwiR2F1Z2UubWF4XCIsIHtcbiAgICAgICAgXCJnZXRcIjogKCkgPT4gdGhpcy5tYXgsXG4gICAgICAgIFwic2V0XCI6ICh2KSA9PiB0aGlzLm1heCA9IHYsXG4gICAgICB9KTtcblxuICAgICAgdGhpcy50YXJnZXQuYWNjZXNzb3IoXCJHYXVnZS52YWx1ZVwiLCB7XG4gICAgICAgIFwiZ2V0XCI6ICgpID0+IHRoaXMudmFsdWUsXG4gICAgICAgIFwic2V0XCI6ICh2KSA9PiB0aGlzLnZhbHVlID0gdixcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnRhcmdldC5hY2Nlc3NvcihcIkdhdWdlLnByb2dyZXNzXCIsIHtcbiAgICAgICAgXCJnZXRcIjogKCkgPT4gdGhpcy5wcm9ncmVzcyxcbiAgICAgICAgXCJzZXRcIjogKHYpID0+IHRoaXMucHJvZ3Jlc3MgPSB2LFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0sXG5cbiAgX3JlZnJlc2g6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLmRpcmVjdGlvbiAhPT0gXCJ2ZXJ0aWNhbFwiKSB7XG4gICAgICB0aGlzLndpZHRoID0gdGhpcy50YXJnZXQud2lkdGggKiB0aGlzLnByb2dyZXNzO1xuICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLnRhcmdldC5oZWlnaHQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMud2lkdGggPSB0aGlzLnRhcmdldC53aWR0aDtcbiAgICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy50YXJnZXQuaGVpZ2h0ICogdGhpcy5wcm9ncmVzcztcbiAgICB9XG4gIH0sXG5cbiAgX2FjY2Vzc29yOiB7XG4gICAgcHJvZ3Jlc3M6IHtcbiAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGNvbnN0IHAgPSAodGhpcy52YWx1ZSAtIHRoaXMubWluKSAvICh0aGlzLm1heCAtIHRoaXMubWluKTtcbiAgICAgICAgcmV0dXJuIChpc05hTihwKSkgPyAwLjAgOiBwO1xuICAgICAgfSxcbiAgICAgIHNldDogZnVuY3Rpb24odikgeyB0aGlzLnZhbHVlID0gdGhpcy5tYXggKiB2OyB9XG4gICAgfSxcblxuICAgIG1heDoge1xuICAgICAgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMuX21heDsgfSxcbiAgICAgIHNldDogZnVuY3Rpb24odikge1xuICAgICAgICB0aGlzLl9tYXggPSB2O1xuICAgICAgICB0aGlzLl9yZWZyZXNoKCk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIG1pbjoge1xuICAgICAgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMuX21pbjsgfSxcbiAgICAgIHNldDogZnVuY3Rpb24odikge1xuICAgICAgICB0aGlzLl9taW4gPSB2O1xuICAgICAgICB0aGlzLl9yZWZyZXNoKCk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIHZhbHVlOiB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5fdmFsdWU7IH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgdGhpcy5fdmFsdWUgPSB2O1xuICAgICAgICB0aGlzLl9yZWZyZXNoKCk7XG4gICAgICB9XG4gICAgfSxcbiAgfVxuXG59KTtcbiIsInBoaW5hLmRlZmluZShcIkdyYXlzY2FsZVwiLCB7XG4gIHN1cGVyQ2xhc3M6IFwiQWNjZXNzb3J5XCIsXG5cbiAgZ3JheVRleHR1cmVOYW1lOiBudWxsLFxuXG4gIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICB0aGlzLnN1cGVySW5pdCgpO1xuICAgIHRoaXMub24oXCJhdHRhY2hlZFwiLCAoKSA9PiB7XG4gICAgICB0aGlzLmdyYXlUZXh0dXJlTmFtZSA9IG9wdGlvbnMuZ3JheVRleHR1cmVOYW1lO1xuICAgICAgdGhpcy5ub3JtYWwgPSB0aGlzLnRhcmdldC5pbWFnZTtcbiAgICB9KTtcbiAgfSxcblxuICB0b0dyYXlzY2FsZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy50YXJnZXQuaW1hZ2UgPSB0aGlzLmdyYXlUZXh0dXJlTmFtZTtcbiAgfSxcblxuICB0b05vcm1hbDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy50YXJnZXQuaW1hZ2UgPSB0aGlzLm5vcm1hbDtcbiAgfSxcblxufSk7XG4iLCJwaGluYS5uYW1lc3BhY2UoKCkgPT4ge1xuXG4gIHBoaW5hLmRlZmluZShcIkxpc3RWaWV3XCIsIHtcbiAgICBzdXBlckNsYXNzOiBcIkFjY2Vzc29yeVwiLFxuXG4gICAgc2Nyb2xsVHlwZTogbnVsbCxcblxuICAgIGl0ZW1zOiBudWxsLFxuXG4gICAgZ2V0Vmlld0lkOiBudWxsLCAvLyBpdGVt44GL44KJ5a++5b+c44GZ44KLdmlld+OBrkpTT07jgpLpgbjliKUgKGl0ZW0pID0+IGpzb25cbiAgICBiaW5kOiBudWxsLCAvLyBpdGVt44Gu5oOF5aCx44KSdmlld+OBq+WPjeaYoCAodmlldywgaXRlbSwgbGlzdFZpZXcpID0+IHZvaWQsXG5cbiAgICB2aWV3SlNPTnM6IG51bGwsXG5cbiAgICBzY3JvbGxCYXI6IG51bGwsXG4gICAgc2Nyb2xsQmFySGFuZGxlOiBudWxsLFxuICAgIHZpZXdwb3J0OiBudWxsLFxuICAgIGlubmVyOiBudWxsLFxuXG4gICAgc2Nyb2xsOiAwLFxuICAgIHNjcm9sbExvY2s6IGZhbHNlLFxuXG4gICAgdmlld0hlaWdodDogMSxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuXG4gICAgICBvcHRpb25zID0gKHt9KS4kc2FmZShvcHRpb25zLCBMaXN0Vmlldy5kZWZhdWx0cyk7XG5cbiAgICAgIHRoaXMuaXRlbXMgPSBbXTtcblxuICAgICAgdGhpcy5nZXRWaWV3SWQgPSAoaXRlbSkgPT4gbnVsbDtcbiAgICAgIHRoaXMuYmluZCA9ICh2aWV3LCBpdGVtLCBsaXN0VmlldykgPT4ge307XG5cbiAgICAgIHRoaXMuaXRlbU1hcmdpbkxlZnQgPSBvcHRpb25zLml0ZW1NYXJnaW5MZWZ0O1xuICAgICAgdGhpcy5pdGVtTWFyZ2luVG9wID0gb3B0aW9ucy5pdGVtTWFyZ2luVG9wO1xuXG4gICAgICB0aGlzLm9uKFwiYXR0YWNoZWRcIiwgKCkgPT4ge1xuICAgICAgICB0aGlzLnRhcmdldC5vbmUoXCJyZWFkeVwiLCAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5zZXR1cChvcHRpb25zKVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gaWYgKHRoaXMudGFyZ2V0LnBhcmVudCkge1xuICAgICAgICAvLyAgIHRoaXMuc2V0dXAob3B0aW9ucyk7XG4gICAgICAgIC8vIH0gZWxzZSB7XG4gICAgICAgIC8vICAgdGhpcy50YXJnZXQub25lKFwiYWRkZWRcIiwgKCkgPT4ge1xuICAgICAgICAvLyAgICAgdGhpcy5zZXR1cChvcHRpb25zKTtcbiAgICAgICAgLy8gICB9KTtcbiAgICAgICAgLy8gfVxuICAgICAgfSk7XG4gICAgfSxcblxuICAgIHNldHVwOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBjb25zdCBmaW5kTGF5b3V0Um9vdCA9IChlbGVtZW50KSA9PiB7XG4gICAgICAgIGlmIChlbGVtZW50LmxheW91dEFzc2V0KSB7XG4gICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5wYXJlbnQpIHtcbiAgICAgICAgICByZXR1cm4gZmluZExheW91dFJvb3QoZWxlbWVudC5wYXJlbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBjb25zdCBsYXlvdXRSb290ID0gZmluZExheW91dFJvb3QodGhpcy50YXJnZXQpO1xuICAgICAgY29uc3QgYXNzZXQgPSBsYXlvdXRSb290LmxheW91dEFzc2V0O1xuXG4gICAgICB0aGlzLnNjcm9sbFR5cGUgPSBvcHRpb25zLnNjcm9sbFR5cGU7XG5cbiAgICAgIHRoaXMudmlld3BvcnQgPSB0aGlzLl9jcmVhdGVWaWV3cG9ydChvcHRpb25zKS5hZGRDaGlsZFRvKHRoaXMudGFyZ2V0KTtcbiAgICAgIHRoaXMuaW5uZXIgPSB0aGlzLl9jcmVhdGVJbm5lcihvcHRpb25zLCB0aGlzLnZpZXdwb3J0KS5hZGRDaGlsZFRvKHRoaXMudmlld3BvcnQpO1xuICAgICAgdGhpcy5mcm9udCA9IHRoaXMuX2NyZWF0ZUZyb250KG9wdGlvbnMsIHRoaXMudmlld3BvcnQsIHRoaXMuaW5uZXIpLmFkZENoaWxkVG8odGhpcy50YXJnZXQpO1xuICAgICAgdGhpcy5fc2V0dXBTY3JvbGxCYXIob3B0aW9ucywgdGhpcy52aWV3cG9ydCwgdGhpcy5pbm5lcik7XG5cbiAgICAgIHRoaXMuX3NldHVwV2hlZWxDb250cm9sKG9wdGlvbnMsIHRoaXMudmlld3BvcnQsIHRoaXMuaW5uZXIsIHRoaXMuZnJvbnQpO1xuICAgICAgdGhpcy5fc2V0dXBUb3VjaENvbnRyb2wob3B0aW9ucywgdGhpcy52aWV3cG9ydCwgdGhpcy5pbm5lciwgdGhpcy5mcm9udCk7XG5cbiAgICAgIGNvbnN0IGZpbmRCeUlkID0gKGlkLCBlbGVtZW50KSA9PiB7XG4gICAgICAgIGlmIChlbGVtZW50LmlkID09PSBpZCkge1xuICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IGNoaWxkcmVuID0gT2JqZWN0LmtleXMoZWxlbWVudC5jaGlsZHJlbiB8fCB7fSkubWFwKGtleSA9PiBlbGVtZW50LmNoaWxkcmVuW2tleV0pO1xuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGhpdCA9IGZpbmRCeUlkKGlkLCBjaGlsZHJlbltpXSk7XG4gICAgICAgICAgICBpZiAoaGl0KSByZXR1cm4gaGl0O1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGNvbnN0IHZpZXdJZHMgPSBvcHRpb25zLml0ZW0uc3BsaXQoXCIsXCIpLm1hcChfID0+IF8udHJpbSgpKTtcbiAgICAgIHRoaXMudmlld0pTT05zID0gdmlld0lkc1xuICAgICAgICAubWFwKGlkID0+IGZpbmRCeUlkKGlkLCBhc3NldC5kYXRhLnJvb3QpKVxuICAgICAgICAucmVkdWNlKChvYmosIHZpZXcpID0+IHtcbiAgICAgICAgICBvYmpbdmlldy5pZF0gPSB2aWV3O1xuICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgIH0sIHt9KTtcbiAgICAgIHRoaXMuZ2V0Vmlld0lkID0gKGl0ZW0pID0+IHZpZXdJZHNbMF07XG5cbiAgICAgIC8vIOWun+S9k+WMluOBleOCjOOBn+ODk+ODpeODvOOCkuS4gOaXpuWJiumZpOOBmeOCi1xuICAgICAgdmlld0lkcy5mb3JFYWNoKGlkID0+IGxheW91dFJvb3QucmVmW2lkXS5yZW1vdmUoKSk7XG5cbiAgICAgIHRoaXMuc2Nyb2xsQmFyID0gbGF5b3V0Um9vdC5yZWZbb3B0aW9ucy5zY3JvbGxCYXJdO1xuICAgICAgdGhpcy5zY3JvbGxCYXJIYW5kbGUgPSBsYXlvdXRSb290LnJlZltvcHRpb25zLnNjcm9sbEJhckhhbmRsZV07XG5cbiAgICB9LFxuXG4gICAgX2NyZWF0ZVZpZXdwb3J0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBjb25zdCB2aWV3cG9ydCA9IERpc3BsYXlFbGVtZW50KCk7XG5cbiAgICAgIHZpZXdwb3J0LnggPSBvcHRpb25zLnNjcm9sbFJlY3QueDtcbiAgICAgIHZpZXdwb3J0LnkgPSBvcHRpb25zLnNjcm9sbFJlY3QueTtcbiAgICAgIHZpZXdwb3J0LndpZHRoID0gb3B0aW9ucy5zY3JvbGxSZWN0LndpZHRoO1xuICAgICAgdmlld3BvcnQuaGVpZ2h0ID0gb3B0aW9ucy5zY3JvbGxSZWN0LmhlaWdodDtcbiAgICAgIHZpZXdwb3J0LmNsaXAgPSAoY2FudmFzKSA9PiB7XG4gICAgICAgIGNvbnN0IHcgPSB2aWV3cG9ydC53aWR0aDtcbiAgICAgICAgY29uc3QgaCA9IHZpZXdwb3J0LmhlaWdodDtcblxuICAgICAgICBjb25zdCBjdHggPSBjYW52YXMuY29udGV4dDtcbiAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICBjdHgubW92ZVRvKHcgKiAtMC41LCBoICogLTAuNSk7XG4gICAgICAgIGN0eC5saW5lVG8odyAqICswLjUsIGggKiAtMC41KTtcbiAgICAgICAgY3R4LmxpbmVUbyh3ICogKzAuNSwgaCAqICswLjUpO1xuICAgICAgICBjdHgubGluZVRvKHcgKiAtMC41LCBoICogKzAuNSk7XG4gICAgICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiB2aWV3cG9ydDtcbiAgICB9LFxuXG4gICAgX2NyZWF0ZUlubmVyOiBmdW5jdGlvbihvcHRpb25zLCB2aWV3cG9ydCkge1xuICAgICAgaWYgKG9wdGlvbnMuaW5uZXIpIHtcbiAgICAgICAgLy8gVE9ET1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgaW5uZXIgPSBEaXNwbGF5RWxlbWVudCgpO1xuXG4gICAgICAgIGlubmVyLnggPSAtdmlld3BvcnQud2lkdGggKiB2aWV3cG9ydC5vcmlnaW5YO1xuICAgICAgICBpbm5lci55ID0gLXZpZXdwb3J0LmhlaWdodCAqIHZpZXdwb3J0Lm9yaWdpblk7XG4gICAgICAgIGlubmVyLm9yaWdpblggPSAwO1xuICAgICAgICBpbm5lci5vcmlnaW5ZID0gMDtcblxuICAgICAgICByZXR1cm4gaW5uZXI7XG4gICAgICB9XG4gICAgfSxcblxuICAgIF9jcmVhdGVGcm9udDogZnVuY3Rpb24ob3B0aW9ucywgdmlld3BvcnQsIGlubmVyKSB7XG4gICAgICBjb25zdCBmcm9udCA9IERpc3BsYXlFbGVtZW50KCk7XG5cbiAgICAgIGZyb250LnggPSBvcHRpb25zLnNjcm9sbFJlY3QueDtcbiAgICAgIGZyb250LnkgPSBvcHRpb25zLnNjcm9sbFJlY3QueTtcbiAgICAgIGZyb250LndpZHRoID0gb3B0aW9ucy5zY3JvbGxSZWN0LndpZHRoO1xuICAgICAgZnJvbnQuaGVpZ2h0ID0gb3B0aW9ucy5zY3JvbGxSZWN0LmhlaWdodDtcbiAgICAgIGZyb250LmludGVyYWN0aXZlID0gdHJ1ZTtcblxuICAgICAgcmV0dXJuIGZyb250O1xuICAgIH0sXG5cbiAgICBfc2V0dXBTY3JvbGxCYXI6IGZ1bmN0aW9uKG9wdGlvbnMsIHZpZXdwb3J0LCBpbm5lcikge1xuICAgICAgdGhpcy50YXJnZXQub24oXCJlbnRlcmZyYW1lXCIsICgpID0+IHtcbiAgICAgICAgaWYgKCF0aGlzLnNjcm9sbEJhciAmJiAhdGhpcy5zY3JvbGxCYXJIYW5kbGUpIHJldHVybjtcblxuICAgICAgICBpZiAodGhpcy5zY3JvbGxUeXBlICE9PSBcImhvcml6b250YWxcIikge1xuICAgICAgICAgIGNvbnN0IHRvcCA9IHZpZXdwb3J0LmhlaWdodCAqIC12aWV3cG9ydC5vcmlnaW5ZO1xuICAgICAgICAgIGNvbnN0IGJvdHRvbSA9IHZpZXdwb3J0LmhlaWdodCAqICgxIC0gdmlld3BvcnQub3JpZ2luWSk7XG4gICAgICAgICAgY29uc3Qgc2Nyb2xsTWluID0gdG9wO1xuICAgICAgICAgIGNvbnN0IHNjcm9sbE1heCA9IGJvdHRvbSAtIGlubmVyLmhlaWdodDtcbiAgICAgICAgICBjb25zdCBzY3JvbGxWYWx1ZSA9IE1hdGguY2xhbXAoKGlubmVyLnRvcCAtIHNjcm9sbE1pbikgLyAoc2Nyb2xsTWF4IC0gc2Nyb2xsTWluKSwgMCwgMSk7XG5cbiAgICAgICAgICBjb25zdCB5TWluID0gdGhpcy5zY3JvbGxCYXIuaGVpZ2h0ICogLXRoaXMuc2Nyb2xsQmFyLm9yaWdpblkgKyB0aGlzLnNjcm9sbEJhckhhbmRsZS5oZWlnaHQgKiB0aGlzLnNjcm9sbEJhckhhbmRsZS5vcmlnaW5ZICsgdGhpcy5zY3JvbGxCYXIueTtcbiAgICAgICAgICBjb25zdCB5TWF4ID0gdGhpcy5zY3JvbGxCYXIuaGVpZ2h0ICogKDEgLSB0aGlzLnNjcm9sbEJhci5vcmlnaW5ZKSAtIHRoaXMuc2Nyb2xsQmFySGFuZGxlLmhlaWdodCAqICgxIC0gdGhpcy5zY3JvbGxCYXJIYW5kbGUub3JpZ2luWSkgKyB0aGlzLnNjcm9sbEJhci55O1xuICAgICAgICAgIGlmIChpbm5lci5oZWlnaHQgPD0gdmlld3BvcnQuaGVpZ2h0KSB7XG4gICAgICAgICAgICB0aGlzLnNjcm9sbEJhckhhbmRsZS55ID0geU1pbjtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zY3JvbGxCYXJIYW5kbGUueSA9IHlNaW4gKyAoeU1heCAtIHlNaW4pICogc2Nyb2xsVmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IGxlZnQgPSB2aWV3cG9ydC53aWR0aCAqIC12aWV3cG9ydC5vcmlnaW5ZO1xuICAgICAgICAgIGNvbnN0IHJpZ2h0ID0gdmlld3BvcnQuaGVpZ2h0ICogKDEgLSB2aWV3cG9ydC5vcmlnaW5ZKTtcbiAgICAgICAgICBjb25zdCBzY3JvbGxNaW4gPSBsZWZ0O1xuICAgICAgICAgIGNvbnN0IHNjcm9sbE1heCA9IHJpZ2h0IC0gaW5uZXIuaGVpZ2h0O1xuICAgICAgICAgIGNvbnN0IHNjcm9sbFZhbHVlID0gTWF0aC5jbGFtcCgoaW5uZXIubGVmdCAtIHNjcm9sbE1pbikgLyAoc2Nyb2xsTWF4IC0gc2Nyb2xsTWluKSwgMCwgMSk7XG5cbiAgICAgICAgICBjb25zdCB5TWluID0gdGhpcy5zY3JvbGxCYXIuaGVpZ2h0ICogLXRoaXMuc2Nyb2xsQmFyLm9yaWdpblkgKyB0aGlzLnNjcm9sbEJhckhhbmRsZS5oZWlnaHQgKiB0aGlzLnNjcm9sbEJhckhhbmRsZS5vcmlnaW5ZICsgdGhpcy5zY3JvbGxCYXIueTtcbiAgICAgICAgICBjb25zdCB5TWF4ID0gdGhpcy5zY3JvbGxCYXIuaGVpZ2h0ICogKDEgLSB0aGlzLnNjcm9sbEJhci5vcmlnaW5ZKSAtIHRoaXMuc2Nyb2xsQmFySGFuZGxlLmhlaWdodCAqICgxIC0gdGhpcy5zY3JvbGxCYXJIYW5kbGUub3JpZ2luWSkgKyB0aGlzLnNjcm9sbEJhci55O1xuICAgICAgICAgIGlmIChpbm5lci5oZWlnaHQgPD0gdmlld3BvcnQuaGVpZ2h0KSB7XG4gICAgICAgICAgICB0aGlzLnNjcm9sbEJhckhhbmRsZS55ID0geU1pbjtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zY3JvbGxCYXJIYW5kbGUueSA9IHlNaW4gKyAoeU1heCAtIHlNaW4pICogc2Nyb2xsVmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgX3NldHVwV2hlZWxDb250cm9sOiBmdW5jdGlvbihvcHRpb25zLCB2aWV3cG9ydCwgaW5uZXIsIGZyb250KSB7XG4gICAgICBpZiAodGhpcy5zY3JvbGxUeXBlICE9PSBcImhvcml6b250YWxcIikge1xuICAgICAgICB0aGlzLnRhcmdldC5vbihcImVudGVyZnJhbWVcIiwgKGUpID0+IHtcbiAgICAgICAgICBpZiAoaW5uZXIuaGVpZ2h0IDw9IHZpZXdwb3J0LmhlaWdodCkgcmV0dXJuO1xuICAgICAgICAgIGlmICh0aGlzLnNjcm9sbExvY2spIHJldHVybjtcblxuICAgICAgICAgIGNvbnN0IHAgPSBlLmFwcC5wb2ludGVyO1xuICAgICAgICAgIGNvbnN0IGRlbHRhID0gcC53aGVlbERlbHRhWTtcbiAgICAgICAgICBpZiAoZGVsdGEgJiYgZnJvbnQuaGl0VGVzdChwLngsIHAueSkpIHtcbiAgICAgICAgICAgIHRoaXMuc2Nyb2xsICs9IGRlbHRhIC8gaW5uZXIuaGVpZ2h0ICogMC44O1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnRhcmdldC5vbihcImVudGVyZnJhbWVcIiwgKGUpID0+IHtcbiAgICAgICAgICBpZiAoaW5uZXIud2lkdGggPD0gdmlld3BvcnQud2lkdGgpIHJldHVybjtcbiAgICAgICAgICBpZiAodGhpcy5zY3JvbGxMb2NrKSByZXR1cm47XG5cbiAgICAgICAgICBjb25zdCBwID0gZS5hcHAucG9pbnRlcjtcbiAgICAgICAgICBjb25zdCBkZWx0YSA9IHAud2hlZWxEZWx0YVk7XG4gICAgICAgICAgaWYgKGRlbHRhICYmIGZyb250LmhpdFRlc3QocC54LCBwLnkpKSB7XG4gICAgICAgICAgICB0aGlzLnNjcm9sbCArPSBkZWx0YSAvIGlubmVyLndpZHRoICogMC44O1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIF9zZXR1cFRvdWNoQ29udHJvbDogZnVuY3Rpb24ob3B0aW9ucywgdmlld3BvcnQsIGlubmVyLCBmcm9udCkge1xuICAgICAgY29uc3QgdHdlZW5lciA9IFR3ZWVuZXIoKS5hdHRhY2hUbyhpbm5lcik7XG4gICAgICBjb25zdCB2ZWxvY2l0eSA9IFZlY3RvcjIoMCwgMCk7XG5cbiAgICAgIGxldCBkcmFnZ2luZyA9IGZhbHNlO1xuICAgICAgZnJvbnQub24oJ3BvaW50c3RhcnQnLCAoZSkgPT4ge1xuICAgICAgICBlLnBhc3MgPSB0cnVlO1xuXG4gICAgICAgIGlmIChpbm5lci5oZWlnaHQgPD0gdmlld3BvcnQuaGVpZ2h0KSByZXR1cm47XG5cbiAgICAgICAgZHJhZ2dpbmcgPSB0cnVlO1xuICAgICAgICB2ZWxvY2l0eS5zZXQoMCwgMCk7XG4gICAgICAgIHR3ZWVuZXIuc3RvcCgpO1xuICAgICAgfSk7XG4gICAgICBmcm9udC5vbigncG9pbnRzdGF5JywgKGUpID0+IHtcbiAgICAgICAgaWYgKCFkcmFnZ2luZykgcmV0dXJuO1xuICAgICAgICB2ZWxvY2l0eS5zZXQoZS5wb2ludGVyLmR4LCBlLnBvaW50ZXIuZHkpO1xuXG4gICAgICAgIGlmICh0aGlzLnNjcm9sbFR5cGUgIT09IFwiaG9yaXpvbnRhbFwiKSB7XG4gICAgICAgICAgY29uc3QgdG9wID0gLXZpZXdwb3J0LmhlaWdodCAqIHZpZXdwb3J0Lm9yaWdpblk7XG4gICAgICAgICAgY29uc3QgYm90dG9tID0gdmlld3BvcnQuaGVpZ2h0ICogKDEgLSB2aWV3cG9ydC5vcmlnaW5ZKTtcbiAgICAgICAgICBsZXQgb3ZlcmRpc3RhbmNlID0gMDtcbiAgICAgICAgICBpZiAodG9wIDwgaW5uZXIudG9wKSB7XG4gICAgICAgICAgICBvdmVyZGlzdGFuY2UgPSB0b3AgLSBpbm5lci50b3A7XG4gICAgICAgICAgfSBlbHNlIGlmIChpbm5lci50b3AgPCBib3R0b20gLSBpbm5lci5oZWlnaHQpIHtcbiAgICAgICAgICAgIG92ZXJkaXN0YW5jZSA9IGlubmVyLnRvcCAtIChib3R0b20gLSBpbm5lci5oZWlnaHQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB2ZWxvY2l0eS5tdWwoMS4wIC0gTWF0aC5hYnMob3ZlcmRpc3RhbmNlKSAvIDIwMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgbGVmdCA9IC12aWV3cG9ydC53aWR0aCAqIHZpZXdwb3J0Lm9yaWdpblk7XG4gICAgICAgICAgY29uc3QgcmlnaHQgPSB2aWV3cG9ydC53aWR0aCAqICgxIC0gdmlld3BvcnQub3JpZ2luWSk7XG4gICAgICAgICAgbGV0IG92ZXJkaXN0YW5jZSA9IDA7XG4gICAgICAgICAgaWYgKGxlZnQgPCBpbm5lci5sZWZ0KSB7XG4gICAgICAgICAgICBvdmVyZGlzdGFuY2UgPSBsZWZ0IC0gaW5uZXIubGVmdDtcbiAgICAgICAgICB9IGVsc2UgaWYgKGlubmVyLmxlZnQgPCByaWdodCAtIGlubmVyLndpZHRoKSB7XG4gICAgICAgICAgICBvdmVyZGlzdGFuY2UgPSBpbm5lci5sZWZ0IC0gKHJpZ2h0IC0gaW5uZXIud2lkdGgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB2ZWxvY2l0eS5tdWwoMS4wIC0gTWF0aC5hYnMob3ZlcmRpc3RhbmNlKSAvIDIwMCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgZnJvbnQub24oJ3BvaW50ZW5kJywgKGUpID0+IHtcbiAgICAgICAgZS5wYXNzID0gdHJ1ZTtcbiAgICAgICAgZS52ZWxvY2l0eSA9IHZlbG9jaXR5O1xuICAgICAgICBkcmFnZ2luZyA9IGZhbHNlO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMub24oXCJ2aWV3c3RvcFwiLCAoZSkgPT4ge1xuICAgICAgICB2ZWxvY2l0eS5zZXQoMCwgMCk7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy50YXJnZXQub24oXCJlbnRlcmZyYW1lXCIsIChlKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLnNjcm9sbFR5cGUgIT09IFwiaG9yaXpvbnRhbFwiKSB7XG4gICAgICAgICAgaWYgKGlubmVyLmhlaWdodCA8PSB2aWV3cG9ydC5oZWlnaHQpIHJldHVybjtcbiAgICAgICAgICBpbm5lci50b3AgKz0gdmVsb2NpdHkueTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoaW5uZXIud2lkdGggPD0gdmlld3BvcnQud2lkdGgpIHJldHVybjtcbiAgICAgICAgICBpbm5lci5sZWZ0ICs9IHZlbG9jaXR5Lng7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZHJhZ2dpbmcpIHJldHVybjtcblxuICAgICAgICBpZiAoIXR3ZWVuZXIucGxheWluZykge1xuICAgICAgICAgIHZlbG9jaXR5Lm11bCgwLjkpO1xuICAgICAgICAgIGlmIChNYXRoLmFicyh2ZWxvY2l0eS54KSA8IDAuMSAmJiBNYXRoLmFicyh2ZWxvY2l0eS55KSA8IDAuMSkge1xuICAgICAgICAgICAgdmVsb2NpdHkuc2V0KDAsIDApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICh0aGlzLnNjcm9sbFR5cGUgIT09IFwiaG9yaXpvbnRhbFwiKSB7XG4gICAgICAgICAgICBjb25zdCB0b3AgPSAtdmlld3BvcnQuaGVpZ2h0ICogdmlld3BvcnQub3JpZ2luWTtcbiAgICAgICAgICAgIGNvbnN0IGJvdHRvbSA9IHZpZXdwb3J0LmhlaWdodCAqICgxIC0gdmlld3BvcnQub3JpZ2luWSk7XG4gICAgICAgICAgICBpZiAodG9wIDwgaW5uZXIudG9wKSB7XG4gICAgICAgICAgICAgIHZlbG9jaXR5LnNldCgwLCAwKTtcbiAgICAgICAgICAgICAgdHdlZW5lci5jbGVhcigpLnRvKHsgeTogdG9wIH0sIDEwMCwgXCJlYXNlSW5RdWFkXCIpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChpbm5lci50b3AgPCBib3R0b20gLSBpbm5lci5oZWlnaHQpIHtcbiAgICAgICAgICAgICAgdmVsb2NpdHkuc2V0KDAsIDApO1xuICAgICAgICAgICAgICB0d2VlbmVyLmNsZWFyKCkudG8oeyB5OiBib3R0b20gLSBpbm5lci5oZWlnaHQgfSwgMTAwLCBcImVhc2VJblF1YWRcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0d2VlbmVyLnN0b3AoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgbGVmdCA9IC12aWV3cG9ydC5oZWlnaHQgKiB2aWV3cG9ydC5vcmlnaW5ZO1xuICAgICAgICAgICAgY29uc3QgcmlnaHQgPSB2aWV3cG9ydC5oZWlnaHQgKiAoMSAtIHZpZXdwb3J0Lm9yaWdpblkpO1xuICAgICAgICAgICAgaWYgKGxlZnQgPCBpbm5lci5sZWZ0KSB7XG4gICAgICAgICAgICAgIHZlbG9jaXR5LnNldCgwLCAwKTtcbiAgICAgICAgICAgICAgdHdlZW5lci5jbGVhcigpLnRvKHsgeTogbGVmdCB9LCAxMDAsIFwiZWFzZUluUXVhZFwiKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5uZXIubGVmdCA8IHJpZ2h0IC0gaW5uZXIuaGVpZ2h0KSB7XG4gICAgICAgICAgICAgIHZlbG9jaXR5LnNldCgwLCAwKTtcbiAgICAgICAgICAgICAgdHdlZW5lci5jbGVhcigpLnRvKHsgeTogcmlnaHQgLSBpbm5lci5oZWlnaHQgfSwgMTAwLCBcImVhc2VJblF1YWRcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0d2VlbmVyLnN0b3AoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBjcmVhdGVWaWV3OiBmdW5jdGlvbihpdGVtKSB7XG4gICAgICBjb25zdCB2aWV3SlNPTiA9IHRoaXMudmlld0pTT05zW3RoaXMuZ2V0Vmlld0lkKGl0ZW0pXTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKHZpZXdKU09OKTtcbiAgICAgIHRoaXMuaW5uZXIuZnJvbUpTT04oe1xuICAgICAgICBjaGlsZHJlbjogW3ZpZXdKU09OXSxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgdmlldyA9IHRoaXMuaW5uZXIuY2hpbGRyZW4ubGFzdDtcbiAgICAgIHJldHVybiB2aWV3O1xuICAgIH0sXG5cbiAgICBhZGRJdGVtOiBmdW5jdGlvbihpdGVtKSB7XG4gICAgICB0aGlzLml0ZW1zLnB1c2goaXRlbSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgYWRkSXRlbXM6IGZ1bmN0aW9uKGl0ZW1zKSB7XG4gICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseSh0aGlzLml0ZW1zLCBpdGVtcyk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgcmVtb3ZlSXRlbTogZnVuY3Rpb24oaXRlbSkge1xuICAgICAgdGhpcy5pdGVtcy5lcmFzZShpdGVtKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBjbGVhckl0ZW06IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5pdGVtcy5jbGVhcigpO1xuICAgICAgdGhpcy5zY3JvbGwgPSAwO1xuICAgICAgdGhpcy5mbGFyZSgndmlld3N0b3AnKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBpbnZhbGlkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuaW5uZXIuY2hpbGRyZW4uY2xvbmUoKS5mb3JFYWNoKChjaGlsZCkgPT4gY2hpbGQucmVtb3ZlKCkpO1xuXG4gICAgICBsZXQgeSA9IDA7XG4gICAgICBsZXQgeCA9IDA7XG5cbiAgICAgIHRoaXMuaW5uZXIuaGVpZ2h0ID0gMTtcblxuICAgICAgdGhpcy5pdGVtcy5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4ge1xuICAgICAgICBjb25zdCB2aWV3ID0gdGhpcy5jcmVhdGVWaWV3KGl0ZW0pO1xuICAgICAgICB2aWV3Ll9saXN0VmlldyA9IHRoaXM7XG4gICAgICAgIHZpZXcuX2luZGV4ID0gaW5kZXg7XG4gICAgICAgIHRoaXMuYmluZCh2aWV3LCBpdGVtLCB0aGlzKTtcbiAgICAgICAgdGhpcy52aXdlSGVpZ2h0ID0gdmlldy5oZWlnaHQ7XG5cbiAgICAgICAgaWYgKHRoaXMuc2Nyb2xsVHlwZSAhPT0gXCJob3Jpem9udGFsXCIpIHtcbiAgICAgICAgICB2aWV3LmxlZnQgPSB4ICsgdGhpcy5pdGVtTWFyZ2luTGVmdDtcbiAgICAgICAgICB2aWV3LnRvcCA9IHkgKyB0aGlzLml0ZW1NYXJnaW5Ub3A7XG5cbiAgICAgICAgICBpZiAoKHZpZXcucmlnaHQgKyB2aWV3LndpZHRoICsgdGhpcy5pdGVtTWFyZ2luTGVmdCkgPCB0aGlzLnZpZXdwb3J0LndpZHRoKSB7XG4gICAgICAgICAgICB4ID0gdmlldy5yaWdodDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgeCA9IDA7XG4gICAgICAgICAgICB5ID0gdmlldy5ib3R0b207XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5pbm5lci5oZWlnaHQgPSBNYXRoLm1heCh0aGlzLnZpZXdwb3J0LmhlaWdodCwgdmlldy50b3AgKyB2aWV3LmhlaWdodCArIHRoaXMuaXRlbU1hcmdpblRvcCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gVE9ET1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgLy/jgYroqabjgZflrp/oo4VcbiAgICAgIGlmICh0aGlzLnVwZGF0ZUZ1bmMpIHRoaXMudGFyZ2V0Lm9mZihcImVudGVyZnJhbWVcIiwgdGhpcy51cGRhdGVGdW5jKTtcblxuICAgICAgaWYgKCF0aGlzLnVwZGF0ZUZ1bmMpIHtcbiAgICAgICAgdGhpcy51cGRhdGVGdW5jID0gKCkgPT4ge1xuICAgICAgICAgIGxldCB5ID0gMDtcbiAgICAgICAgICBsZXQgeCA9IDA7XG4gICAgICAgICAgdGhpcy5pbm5lci5jaGlsZHJlbi5mb3JFYWNoKChjaGlsZCwgaSkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuc2Nyb2xsVHlwZSAhPT0gXCJob3Jpem9udGFsXCIpIHtcbiAgICAgICAgICAgICAgY2hpbGQubGVmdCA9IHggKyB0aGlzLml0ZW1NYXJnaW5MZWZ0O1xuICAgICAgICAgICAgICBjaGlsZC50b3AgPSB5ICsgdGhpcy5pdGVtTWFyZ2luVG9wO1xuXG4gICAgICAgICAgICAgIGlmICgoY2hpbGQucmlnaHQgKyBjaGlsZC53aWR0aCArIHRoaXMuaXRlbU1hcmdpbkxlZnQpIDwgdGhpcy52aWV3cG9ydC53aWR0aCkge1xuICAgICAgICAgICAgICAgIHggPSBjaGlsZC5yaWdodDtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB4ID0gMDtcbiAgICAgICAgICAgICAgICB5ID0gY2hpbGQuYm90dG9tO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgdGhpcy5pbm5lci5oZWlnaHQgPSBNYXRoLm1heCh0aGlzLnZpZXdwb3J0LmhlaWdodCwgY2hpbGQudG9wICsgY2hpbGQuaGVpZ2h0ICsgdGhpcy5pdGVtTWFyZ2luVG9wKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIFRPRE9cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy9lbnRlcmZyYW1l44Gn44Gv44Gq44GP44Gmd2F0Y2jjgadoZWlnaHTjgb/jgabjgoLjgYTjgYTjgYvjgapcbiAgICAgIHRoaXMudGFyZ2V0Lm9uKFwiZW50ZXJmcmFtZVwiLCB0aGlzLnVwZGF0ZUZ1bmMpO1xuICAgIH0sXG5cbiAgICAvLyByZXR1cm4gMC4w772eMS4wXG4gICAgZ2V0U2Nyb2xsOiBmdW5jdGlvbigpIHtcbiAgICAgIGNvbnN0IHZpZXdwb3J0ID0gdGhpcy52aWV3cG9ydDtcbiAgICAgIGNvbnN0IGlubmVyID0gdGhpcy5pbm5lcjtcblxuICAgICAgaWYgKHRoaXMuc2Nyb2xsVHlwZSAhPT0gXCJob3Jpem9udGFsXCIpIHtcbiAgICAgICAgY29uc3QgdG9wID0gdmlld3BvcnQuaGVpZ2h0ICogLXZpZXdwb3J0Lm9yaWdpblk7XG4gICAgICAgIGNvbnN0IGJvdHRvbSA9IHZpZXdwb3J0LmhlaWdodCAqICgxIC0gdmlld3BvcnQub3JpZ2luWSk7XG4gICAgICAgIGNvbnN0IG1pbiA9IHRvcDtcbiAgICAgICAgY29uc3QgbWF4ID0gYm90dG9tIC0gaW5uZXIuaGVpZ2h0O1xuXG4gICAgICAgIHJldHVybiAoaW5uZXIudG9wIC0gbWluKSAvIChtYXggLSBtaW4pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gVE9PRFxuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLy8gdjogMC4w772eMS4wXG4gICAgc2V0U2Nyb2xsOiBmdW5jdGlvbih2KSB7XG4gICAgICB2ID0gTWF0aC5jbGFtcCh2LCAwLCAxKTtcblxuICAgICAgY29uc3Qgdmlld3BvcnQgPSB0aGlzLnZpZXdwb3J0O1xuICAgICAgY29uc3QgaW5uZXIgPSB0aGlzLmlubmVyO1xuXG4gICAgICBpZiAodGhpcy5zY3JvbGxUeXBlICE9PSBcImhvcml6b250YWxcIikge1xuICAgICAgICBpZiAoaW5uZXIuaGVpZ2h0IDw9IHZpZXdwb3J0LmhlaWdodCkgcmV0dXJuO1xuXG4gICAgICAgIGNvbnN0IHRvcCA9IHZpZXdwb3J0LmhlaWdodCAqIC12aWV3cG9ydC5vcmlnaW5ZO1xuICAgICAgICBjb25zdCBib3R0b20gPSB2aWV3cG9ydC5oZWlnaHQgKiAoMSAtIHZpZXdwb3J0Lm9yaWdpblkpO1xuICAgICAgICBjb25zdCBtaW4gPSB0b3A7XG4gICAgICAgIGNvbnN0IG1heCA9IGJvdHRvbSAtIGlubmVyLmhlaWdodDtcblxuICAgICAgICBpbm5lci50b3AgPSBtaW4gKyAobWF4IC0gbWluKSAqIHY7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBUT09EXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+aMh+WumuOBl+OBn+OCq+ODqeODoOOBruOCouOCpOODhuODoOOBruWFiOmgreOBq+OCueOCr+ODreODvOODq+OCkuenu+WLlVxuICAgIHNldFNjcm9sbEJ5Q29sdW1uOiBmdW5jdGlvbihjb2x1bW4pIHtcbiAgICAgIGNvbHVtbiA9IE1hdGguY2xhbXAoY29sdW1uLCAwLCB0aGlzLml0ZW1zLmxlbmd0aCk7XG4gICAgICBjb25zdCBzY3JvbGxWYWx1ZSA9IE1hdGguY2xhbXAoY29sdW1uIC8gdGhpcy5pdGVtcy5sZW5ndGgsIDAsIDEpO1xuICAgICAgdGhpcy5zZXRTY3JvbGwoc2Nyb2xsVmFsdWUpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIF9hY2Nlc3Nvcjoge1xuICAgICAgZWxlbWVudHM6IHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5pbm5lci5jaGlsZHJlbjtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBzY3JvbGw6IHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5nZXRTY3JvbGwoKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbih2KSB7XG4gICAgICAgICAgdGhpcy5zZXRTY3JvbGwodik7XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG5cbiAgICBfc3RhdGljOiB7XG4gICAgICBkZWZhdWx0czoge1xuICAgICAgICBzY3JvbGxUeXBlOiBcInZlcnRpY2FsXCIsXG4gICAgICAgIGl0ZW1NYXJnaW5MZWZ0OiAwLFxuICAgICAgICBpdGVtTWFyZ2luVG9wOiAwLFxuICAgICAgfSxcbiAgICB9LFxuXG4gIH0pO1xuXG59KTtcbiIsInBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICBwaGluYS5kZWZpbmUoXCJQaWVDbGlwXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcIkFjY2Vzc29yeVwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgb3B0aW9ucyA9ICh7fSkuJHNhZmUob3B0aW9ucywgUGllQ2xpcC5kZWZhdWx0cylcbiAgICAgIHRoaXMuc3VwZXJJbml0KG9wdGlvbnMpO1xuXG4gICAgICB0aGlzLnBpdm90WCA9IG9wdGlvbnMucGl2b3RYO1xuICAgICAgdGhpcy5waXZvdFkgPSBvcHRpb25zLnBpdm90WTtcbiAgICAgIHRoaXMuYW5nbGVNaW4gPSBvcHRpb25zLmFuZ2xlTWluO1xuICAgICAgdGhpcy5hbmdsZU1heCA9IG9wdGlvbnMuYW5nbGVNYXg7XG4gICAgICB0aGlzLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzO1xuICAgICAgdGhpcy5hbnRpY2xvY2t3aXNlID0gb3B0aW9ucy5hbnRpY2xvY2t3aXNlO1xuICAgIH0sXG5cbiAgICBvbmF0dGFjaGVkOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMudGFyZ2V0LmNsaXAgPSAoY2FudmFzKSA9PiB7XG4gICAgICAgIGNvbnN0IGFuZ2xlTWluID0gdGhpcy5hbmdsZU1pbiAqIE1hdGguREVHX1RPX1JBRDtcbiAgICAgICAgY29uc3QgYW5nbGVNYXggPSB0aGlzLmFuZ2xlTWF4ICogTWF0aC5ERUdfVE9fUkFEO1xuICAgICAgICBjb25zdCBjdHggPSBjYW52YXMuY29udGV4dDtcbiAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICBjdHgubW92ZVRvKHRoaXMucGl2b3RYLCB0aGlzLnBpdm90WSk7XG4gICAgICAgIGN0eC5saW5lVG8odGhpcy5waXZvdFggKyBNYXRoLmNvcyhhbmdsZU1pbikgKiB0aGlzLnJhZGl1cywgdGhpcy5waXZvdFkgKyBNYXRoLnNpbihhbmdsZU1pbikgKiB0aGlzLnJhZGl1cyk7XG4gICAgICAgIGN0eC5hcmModGhpcy5waXZvdFgsIHRoaXMucGl2b3RZLCB0aGlzLnJhZGl1cywgYW5nbGVNaW4sIGFuZ2xlTWF4LCB0aGlzLmFudGljbG9ja3dpc2UpO1xuICAgICAgICBjdHguY2xvc2VQYXRoKCk7XG4gICAgICB9O1xuICAgIH0sXG5cbiAgICBfc3RhdGljOiB7XG4gICAgICBkZWZhdWx0czoge1xuICAgICAgICBwaXZvdFg6IDMyLFxuICAgICAgICBwaXZvdFk6IDMyLFxuICAgICAgICBhbmdsZU1pbjogMCxcbiAgICAgICAgYW5nbGVNYXg6IDM2MCxcbiAgICAgICAgcmFkaXVzOiA2NCxcbiAgICAgICAgYW50aWNsb2Nrd2lzZTogZmFsc2UsXG4gICAgICB9LFxuICAgIH0sXG5cbiAgfSk7XG59KTtcbiIsInBoaW5hLmRlZmluZShcIlJlY3RhbmdsZUNsaXBcIiwge1xuICBzdXBlckNsYXNzOiBcIkFjY2Vzc29yeVwiLFxuXG4gIHg6IDAsXG4gIHk6IDAsXG4gIHdpZHRoOiAwLFxuICBoZWlnaHQ6IDAsXG5cbiAgX2VuYWJsZTogdHJ1ZSxcblxuICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnN1cGVySW5pdCgpO1xuICAgIHRoaXMuX2luaXQoKTtcbiAgfSxcblxuICBfaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5vbihcImF0dGFjaGVkXCIsICgpID0+IHtcblxuICAgICAgdGhpcy50YXJnZXQuYWNjZXNzb3IoXCJSZWN0YW5nbGVDbGlwLndpZHRoXCIsIHtcbiAgICAgICAgXCJnZXRcIjogKCkgPT4gdGhpcy53aWR0aCxcbiAgICAgICAgXCJzZXRcIjogKHYpID0+IHRoaXMud2lkdGggPSB2LFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMudGFyZ2V0LmFjY2Vzc29yKFwiUmVjdGFuZ2xlQ2xpcC5oZWlnaHRcIiwge1xuICAgICAgICBcImdldFwiOiAoKSA9PiB0aGlzLmhlaWdodCxcbiAgICAgICAgXCJzZXRcIjogKHYpID0+IHRoaXMuaGVpZ2h0ID0gdixcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnRhcmdldC5hY2Nlc3NvcihcIlJlY3RhbmdsZUNsaXAueFwiLCB7XG4gICAgICAgIFwiZ2V0XCI6ICgpID0+IHRoaXMueCxcbiAgICAgICAgXCJzZXRcIjogKHYpID0+IHRoaXMueCA9IHYsXG4gICAgICB9KTtcblxuICAgICAgdGhpcy50YXJnZXQuYWNjZXNzb3IoXCJSZWN0YW5nbGVDbGlwLnlcIiwge1xuICAgICAgICBcImdldFwiOiAoKSA9PiB0aGlzLnksXG4gICAgICAgIFwic2V0XCI6ICh2KSA9PiB0aGlzLnkgPSB2LFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMueCA9IDA7XG4gICAgICB0aGlzLnkgPSAwO1xuICAgICAgdGhpcy53aWR0aCA9IHRoaXMudGFyZ2V0LndpZHRoO1xuICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLnRhcmdldC5oZWlnaHQ7XG5cbiAgICAgIHRoaXMudGFyZ2V0LmNsaXAgPSAoYykgPT4gdGhpcy5fY2xpcChjKTtcbiAgICB9KTtcbiAgfSxcblxuICBfY2xpcDogZnVuY3Rpb24oY2FudmFzKSB7XG4gICAgY29uc3QgeCA9IHRoaXMueCAtICh0aGlzLndpZHRoICogdGhpcy50YXJnZXQub3JpZ2luWCk7XG4gICAgY29uc3QgeSA9IHRoaXMueSAtICh0aGlzLmhlaWdodCAqIHRoaXMudGFyZ2V0Lm9yaWdpblkpO1xuXG4gICAgY2FudmFzLmJlZ2luUGF0aCgpO1xuICAgIGNhbnZhcy5yZWN0KHgsIHksIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgICBjYW52YXMuY2xvc2VQYXRoKCk7XG4gIH0sXG5cbiAgc2V0RW5hYmxlOiBmdW5jdGlvbihlbmFibGUpIHtcbiAgICB0aGlzLl9lbmFibGUgPSBlbmFibGU7XG4gICAgaWYgKHRoaXMuX2VuYWJsZSkge1xuICAgICAgdGhpcy50YXJnZXQuY2xpcCA9IChjKSA9PiB0aGlzLl9jbGlwKGMpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnRhcmdldC5jbGlwID0gbnVsbDtcbiAgICB9XG4gIH0sXG5cbiAgX2FjY2Vzc29yOiB7XG4gICAgZW5hYmxlOiB7XG4gICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgdGhpcy5zZXRFbmFibGUodik7XG4gICAgICB9LFxuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VuYWJsZTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbn0pO1xuIiwicGhpbmEuZGVmaW5lKFwiVG9nZ2xlXCIsIHtcbiAgc3VwZXJDbGFzczogXCJBY2Nlc3NvcnlcIixcblxuICBpbml0OiBmdW5jdGlvbihpc09uKSB7XG4gICAgdGhpcy5zdXBlckluaXQoKTtcbiAgICB0aGlzLl9pbml0KGlzT24pO1xuICB9LFxuXG4gIF9pbml0OiBmdW5jdGlvbihpc09uKSB7XG4gICAgdGhpcy5pc09uID0gaXNPbiB8fCBmYWxzZTtcbiAgfSxcblxuICBzZXRTdGF0dXM6IGZ1bmN0aW9uKHN0YXR1cykge1xuICAgIHRoaXMuaXNPbiA9IHN0YXR1cztcbiAgICB0aGlzLnRhcmdldC5mbGFyZSgodGhpcy5pc09uKSA/IFwic3dpdGNoT25cIiA6IFwic3dpdGNoT2ZmXCIpO1xuICB9LFxuXG4gIHN3aXRjaE9uOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5pc09uKSByZXR1cm47XG4gICAgdGhpcy5zZXRTdGF0dXModHJ1ZSk7XG4gIH0sXG5cbiAgc3dpdGNoT2ZmOiBmdW5jdGlvbigpIHtcbiAgICBpZiAoIXRoaXMuaXNPbikgcmV0dXJuO1xuICAgIHRoaXMuc2V0U3RhdHVzKGZhbHNlKTtcbiAgfSxcblxuICBzd2l0Y2g6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuaXNPbiA9ICF0aGlzLmlzT247XG4gICAgdGhpcy5zZXRTdGF0dXModGhpcy5pc09uKTtcbiAgfSxcblxuICBfYWNjZXNzb3I6IHtcbiAgICBzdGF0dXM6IHtcbiAgICAgIFwiZ2V0XCI6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5pc09uOyB9LFxuICAgICAgXCJzZXRcIjogZnVuY3Rpb24odikgeyByZXR1cm4gc2V0U3RhdHVzKHYpOyB9LFxuICAgIH0sXG4gIH0sXG5cbn0pO1xuIiwicGhpbmEubmFtZXNwYWNlKCgpID0+IHtcblxuICBwaGluYS5kZWZpbmUoXCJEeW5hbWljU3ByaXRlXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcInBoaW5hLmRpc3BsYXkuU3ByaXRlXCIsXG5cbiAgICBpc0xvYWRlZDogZmFsc2UsXG4gICAgX2R1bW15OiBudWxsLFxuXG4gICAgaW5pdDogZnVuY3Rpb24oaW1hZ2UsIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgIC8v5oyH5a6a44GV44KM44Gf44Kk44Oh44O844K444GM5pei44Gr6Kqt44G/6L6844G+44KM44Gm44GE44KL44GL44OB44Kn44OD44KvXG4gICAgICBpZiAodHlwZW9mIGltYWdlID09PSAnc3RyaW5nJykge1xuICAgICAgICBjb25zdCBpbWcgPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCdpbWFnZScsIGltYWdlKTtcbiAgICAgICAgaWYgKGltZykge1xuICAgICAgICAgIC8v44Kk44Oh44O844K46Kqt44G/6L6844G/5riIXG4gICAgICAgICAgdGhpcy5pc0xvYWRlZCA9IHRydWU7XG4gICAgICAgICAgdGhpcy5zdXBlckluaXQoaW1nLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvL+iruOOAheWbsOOCi+OBruOBp+S4gOaXpuWIneacn+WMluOBoOOBkeOBl+OBpuOBiuOBj1xuICAgICAgICAgIHRoaXMuc3VwZXJJbml0KG51bGwsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICAgIHRoaXMub25lKFwiZW50ZXJmcmFtZVwiLCAoZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5hcHAgPSBlLmFwcDtcbiAgICAgICAgICAgIHRoaXMuZHluYW1pY0xvYWQoaW1hZ2UsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvL+OCpOODoeODvOOCuOebtOa4oeOBl1xuICAgICAgICB0aGlzLmlzTG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zdXBlckluaXQoaW1hZ2UsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+WLleeahOOBq+iqreOBv+i+vOOBv+OCkuihjOOBhlxuICAgIGR5bmFtaWNMb2FkOiBmdW5jdGlvbihpbWFnZSwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgdGhpcy5pc0xvYWRlZCA9IGZhbHNlO1xuICAgICAgLy/jg63jg7zjgqvjg6vniYhcbiAgICAgIGNvbnN0IGFzc2V0cyA9IHsgaW1hZ2U6IHt9IH07XG4gICAgICBhc3NldHMuaW1hZ2VbaW1hZ2VdID0gaW1hZ2U7XG4gICAgICB0aGlzLmFwcC5hc3NldExvYWRlci5sb2FkKGFzc2V0cywgKCkgPT4ge1xuICAgICAgICB0aGlzLmlzTG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgY29uc3QgdGV4dHVyZSA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoXCJpbWFnZVwiLCBpbWFnZSk7XG4gICAgICAgIHRoaXMuc2V0SW1hZ2UodGV4dHVyZSwgd2lkdGgsIGhlaWdodCk7XG4gICAgICAgIGlmICh0aGlzLl9kdW1teSkge1xuICAgICAgICAgIHRoaXMuX2R1bW15LnJlbW92ZSgpO1xuICAgICAgICAgIHRoaXMuX2R1bW15ID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vY29yZG92YS1maWxlLXRyYW5zZnJl54mIXG4gICAgICAvLyB0aGlzLmFwcC5kb3dubG9hZEZyb21TZXJ2ZXIoaW1hZ2UpXG4gICAgICAvLyAgIC50aGVuKCgpID0+IHtcbiAgICAgIC8vICAgICB0aGlzLmlzTG9hZGVkID0gdHJ1ZTtcbiAgICAgIC8vICAgICBjb25zdCB0ZXh0dXJlID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldChcImltYWdlXCIsIGltYWdlKTtcbiAgICAgIC8vICAgICB0aGlzLnNldEltYWdlKHRleHR1cmUsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgLy8gICAgIGlmICh0aGlzLl9kdW1teSkge1xuICAgICAgLy8gICAgICAgdGhpcy5fZHVtbXkucmVtb3ZlKCk7XG4gICAgICAvLyAgICAgICB0aGlzLl9kdW1teSA9IG51bGw7XG4gICAgICAvLyAgICAgfVxuICAgICAgLy8gICB9KTtcbiAgICB9LFxuXG4gICAgZHJhdzogZnVuY3Rpb24oY2FudmFzKSB7XG4gICAgICBpZiAoIXRoaXMuaXNMb2FkZWQgfHwgIXRoaXMuaW1hZ2UpIHJldHVybjtcblxuICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZS5kb21FbGVtZW50O1xuICAgICAgdmFyIHNyY1JlY3QgPSB0aGlzLnNyY1JlY3Q7XG4gICAgICBjYW52YXMuY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsXG4gICAgICAgIHNyY1JlY3QueCwgc3JjUmVjdC55LCBzcmNSZWN0LndpZHRoLCBzcmNSZWN0LmhlaWdodCxcbiAgICAgICAgLXRoaXMuX3dpZHRoICogdGhpcy5vcmlnaW5YLCAtdGhpcy5faGVpZ2h0ICogdGhpcy5vcmlnaW5ZLCB0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0XG4gICAgICAgICk7XG4gICAgfSxcblxuICAgIHNldEltYWdlOiBmdW5jdGlvbihpbWFnZSwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgaWYgKCF0aGlzLmlzTG9hZGVkIHx8ICFpbWFnZSkgcmV0dXJuIHRoaXM7XG5cbiAgICAgIGlmICh0eXBlb2YgaW1hZ2UgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGltYWdlID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgnaW1hZ2UnLCBpbWFnZSk7XG4gICAgICB9XG4gICAgICB0aGlzLl9pbWFnZSA9IGltYWdlO1xuICAgICAgdGhpcy53aWR0aCA9IHRoaXMuX2ltYWdlLmRvbUVsZW1lbnQud2lkdGg7XG4gICAgICB0aGlzLmhlaWdodCA9IHRoaXMuX2ltYWdlLmRvbUVsZW1lbnQuaGVpZ2h0O1xuXG4gICAgICBpZiAod2lkdGgpIHsgdGhpcy53aWR0aCA9IHdpZHRoOyB9XG4gICAgICBpZiAoaGVpZ2h0KSB7IHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OyB9XG5cbiAgICAgIHRoaXMuZnJhbWVJbmRleCA9IDA7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBzZXREdW1teUltYWdlOiBmdW5jdGlvbihpbWFnZSwgd2lkdGgsIGhlaWdodCwgdXBkYXRlRnVuY3Rpb24pIHtcbiAgICAgIGlmICh0aGlzLmlzTG9hZGVkKSByZXR1cm47XG4gICAgICB0aGlzLl9kdW1teSA9IFNwcml0ZShpbWFnZSwgd2lkdGgsIGhlaWdodCkuYWRkQ2hpbGRUbyh0aGlzKTtcbiAgICAgIGlmICh1cGRhdGVGdW5jdGlvbikge1xuICAgICAgICB0aGlzLl9kdW1teS51cGRhdGUgPSB1cGRhdGVGdW5jdGlvbjtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gIH0pO1xuXG59KTtcbiIsInBoaW5hLmRlZmluZShcIkdhdWdlXCIsIHtcbiAgc3VwZXJDbGFzczogXCJSZWN0YW5nbGVDbGlwXCIsXG5cbiAgX21pbjogMCxcbiAgX21heDogMS4wLFxuICBfdmFsdWU6IDEuMCwgLy9taW4gfiBtYXhcblxuICBkaXJlY3Rpb246IFwiaG9yaXpvbnRhbFwiLCAvLyBob3Jpem9udGFsIG9yIHZlcnRpY2FsXG5cbiAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zdXBlckluaXQoKTtcbiAgICB0aGlzLm9uKFwiYXR0YWNoZWRcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5fd2lkdGggPSB0aGlzLndpZHRoO1xuICAgICAgdGhpcy5faGVpZ2h0ID0gdGhpcy53aWR0aDtcblxuICAgICAgdGhpcy50YXJnZXQuYWNjZXNzb3IoXCJHYXVnZS5taW5cIiwge1xuICAgICAgICBcImdldFwiOiAoKSA9PiB0aGlzLm1pbixcbiAgICAgICAgXCJzZXRcIjogKHYpID0+IHRoaXMubWluID0gdixcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnRhcmdldC5hY2Nlc3NvcihcIkdhdWdlLm1heFwiLCB7XG4gICAgICAgIFwiZ2V0XCI6ICgpID0+IHRoaXMubWF4LFxuICAgICAgICBcInNldFwiOiAodikgPT4gdGhpcy5tYXggPSB2LFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMudGFyZ2V0LmFjY2Vzc29yKFwiR2F1Z2UudmFsdWVcIiwge1xuICAgICAgICBcImdldFwiOiAoKSA9PiB0aGlzLnZhbHVlLFxuICAgICAgICBcInNldFwiOiAodikgPT4gdGhpcy52YWx1ZSA9IHYsXG4gICAgICB9KTtcblxuICAgICAgdGhpcy50YXJnZXQuYWNjZXNzb3IoXCJHYXVnZS5wcm9ncmVzc1wiLCB7XG4gICAgICAgIFwiZ2V0XCI6ICgpID0+IHRoaXMucHJvZ3Jlc3MsXG4gICAgICAgIFwic2V0XCI6ICh2KSA9PiB0aGlzLnByb2dyZXNzID0gdixcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9LFxuXG4gIF9yZWZyZXNoOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5kaXJlY3Rpb24gIT09IFwidmVydGljYWxcIikge1xuICAgICAgdGhpcy53aWR0aCA9IHRoaXMudGFyZ2V0LndpZHRoICogdGhpcy5wcm9ncmVzcztcbiAgICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy50YXJnZXQuaGVpZ2h0O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLndpZHRoID0gdGhpcy50YXJnZXQud2lkdGg7XG4gICAgICB0aGlzLmhlaWdodCA9IHRoaXMudGFyZ2V0LmhlaWdodCAqIHRoaXMucHJvZ3Jlc3M7XG4gICAgfVxuICB9LFxuXG4gIF9hY2Nlc3Nvcjoge1xuICAgIHByb2dyZXNzOiB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICBjb25zdCBwID0gKHRoaXMudmFsdWUgLSB0aGlzLm1pbikgLyAodGhpcy5tYXggLSB0aGlzLm1pbik7XG4gICAgICAgIHJldHVybiAoaXNOYU4ocCkpID8gMC4wIDogcDtcbiAgICAgIH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHsgdGhpcy52YWx1ZSA9IHRoaXMubWF4ICogdjsgfVxuICAgIH0sXG5cbiAgICBtYXg6IHtcbiAgICAgIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLl9tYXg7IH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgdGhpcy5fbWF4ID0gdjtcbiAgICAgICAgdGhpcy5fcmVmcmVzaCgpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBtaW46IHtcbiAgICAgIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLl9taW47IH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgdGhpcy5fbWluID0gdjtcbiAgICAgICAgdGhpcy5fcmVmcmVzaCgpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICB2YWx1ZToge1xuICAgICAgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMuX3ZhbHVlOyB9LFxuICAgICAgc2V0OiBmdW5jdGlvbih2KSB7XG4gICAgICAgIHRoaXMuX3ZhbHVlID0gdjtcbiAgICAgICAgdGhpcy5fcmVmcmVzaCgpO1xuICAgICAgfVxuICAgIH0sXG4gIH1cblxufSk7XG4iLCJwaGluYS5kZWZpbmUoXCJQYXRoQ2xpcFwiLCB7XG4gIHN1cGVyQ2xhc3M6IFwiQWNjZXNzb3J5XCIsXG5cbiAgaXNFbmFibGU6IHRydWUsXG5cbiAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zdXBlckluaXQoKTtcbiAgICB0aGlzLl9pbml0KCk7XG4gIH0sXG5cbiAgX2luaXQ6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMub24oXCJhdHRhY2hlZFwiLCAoKSA9PiB7XG4gICAgICBjb25zdCB4MSA9IC0odGhpcy50YXJnZXQud2lkdGggKiB0aGlzLnRhcmdldC5vcmlnaW5YKTtcbiAgICAgIGNvbnN0IHkxID0gLSh0aGlzLnRhcmdldC5oZWlnaHQgKiB0aGlzLnRhcmdldC5vcmlnaW5ZKTtcbiAgICAgIGNvbnN0IHgyID0gICh0aGlzLnRhcmdldC53aWR0aCAqICgxIC0gdGhpcy50YXJnZXQub3JpZ2luWCkpO1xuICAgICAgY29uc3QgeTIgPSAgKHRoaXMudGFyZ2V0LmhlaWdodCAqICgxIC0gdGhpcy50YXJnZXQub3JpZ2luWSkpO1xuXG4gICAgICB0aGlzLmNsZWFyUGF0aCgpO1xuICAgICAgdGhpcy5wYXRoLnB1c2goe3g6IHgxLCB5OiB5MSB9KTtcbiAgICAgIHRoaXMucGF0aC5wdXNoKHt4OiB4MiwgeTogeTEgfSk7XG4gICAgICB0aGlzLnBhdGgucHVzaCh7eDogeDIsIHk6IHkyIH0pO1xuICAgICAgdGhpcy5wYXRoLnB1c2goe3g6IHgxLCB5OiB5MiB9KTtcbiAgICAgIHRoaXMudGFyZ2V0LmNsaXAgPSAoYykgPT4gdGhpcy5fY2xpcChjKTtcbiAgICB9KTtcbiAgfSxcblxuICBzZXRFbmFibGU6IGZ1bmN0aW9uKGVuYWJsZSkge1xuICAgIHRoaXMuaW5FbmFibGUgPSBlbmFibGU7XG4gICAgaWYgKHRoaXMuaXNFbmFibGUpIHtcbiAgICAgIHRoaXMudGFyZ2V0LmNsaXAgPSAoYykgPT4gdGhpcy5fY2xpcChjKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy50YXJnZXQuY2xpcCA9IG51bGw7XG4gICAgfVxuICB9LFxuXG4gIGNsZWFyUGF0aDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5wYXRoID0gW107XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgYWRkUGF0aDogZnVuY3Rpb24ocGF0aCkge1xuICAgIGlmIChwYXRoIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIHRoaXMucGF0aCA9IHRoaXMucGF0aC5jb25jYXQocGF0aCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucGF0aC5wdXNoKHBhdGgpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICBvZmZzZXRQYXRoOiBmdW5jdGlvbihvZmZzZXRYLCBvZmZzZXRZKSB7XG4gICAgdGhpcy5wYXRoLmZvckVhY2gocHQgPT4ge1xuICAgICAgcHQueCArPSBvZmZzZXRYO1xuICAgICAgcHQueSArPSBvZmZzZXRZO1xuICAgIH0pO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9jbGlwOiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICBpZiAodGhpcy5wYXRoLmxlbmd0aCA8IDMpIHJldHVybjtcbiAgICBjYW52YXMuYmVnaW5QYXRoKCk7XG4gICAgY2FudmFzLm1vdmVUbyh0aGlzLnBhdGhbMF0ueCwgdGhpcy5wYXRoWzBdLnkpO1xuICAgIHRoaXMucGF0aC5mb3JFYWNoKHB0ID0+IGNhbnZhcy5saW5lVG8ocHQueCwgcHQueSkpO1xuICAgIGNhbnZhcy5jbG9zZVBhdGgoKTtcbiAgfSxcblxuICBfYWNjZXNzb3I6IHtcbiAgICBlbmFibGU6IHtcbiAgICAgIHNldDogZnVuY3Rpb24odikge1xuICAgICAgICB0aGlzLnNldEVuYWJsZSh2KTtcbiAgICAgIH0sXG4gICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pc0VuYWJsZTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbn0pO1xuIiwicGhpbmEuZGVmaW5lKFwiUmVjdGFuZ2xlQ2xpcFwiLCB7XG4gIHN1cGVyQ2xhc3M6IFwiQWNjZXNzb3J5XCIsXG5cbiAgeDogMCxcbiAgeTogMCxcbiAgd2lkdGg6IDAsXG4gIGhlaWdodDogMCxcblxuICBfZW5hYmxlOiB0cnVlLFxuXG4gIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc3VwZXJJbml0KCk7XG4gICAgdGhpcy5faW5pdCgpO1xuICB9LFxuXG4gIF9pbml0OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm9uKFwiYXR0YWNoZWRcIiwgKCkgPT4ge1xuXG4gICAgICB0aGlzLnRhcmdldC5hY2Nlc3NvcihcIlJlY3RhbmdsZUNsaXAud2lkdGhcIiwge1xuICAgICAgICBcImdldFwiOiAoKSA9PiB0aGlzLndpZHRoLFxuICAgICAgICBcInNldFwiOiAodikgPT4gdGhpcy53aWR0aCA9IHYsXG4gICAgICB9KTtcblxuICAgICAgdGhpcy50YXJnZXQuYWNjZXNzb3IoXCJSZWN0YW5nbGVDbGlwLmhlaWdodFwiLCB7XG4gICAgICAgIFwiZ2V0XCI6ICgpID0+IHRoaXMuaGVpZ2h0LFxuICAgICAgICBcInNldFwiOiAodikgPT4gdGhpcy5oZWlnaHQgPSB2LFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMudGFyZ2V0LmFjY2Vzc29yKFwiUmVjdGFuZ2xlQ2xpcC54XCIsIHtcbiAgICAgICAgXCJnZXRcIjogKCkgPT4gdGhpcy54LFxuICAgICAgICBcInNldFwiOiAodikgPT4gdGhpcy54ID0gdixcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnRhcmdldC5hY2Nlc3NvcihcIlJlY3RhbmdsZUNsaXAueVwiLCB7XG4gICAgICAgIFwiZ2V0XCI6ICgpID0+IHRoaXMueSxcbiAgICAgICAgXCJzZXRcIjogKHYpID0+IHRoaXMueSA9IHYsXG4gICAgICB9KTtcblxuICAgICAgdGhpcy54ID0gMDtcbiAgICAgIHRoaXMueSA9IDA7XG4gICAgICB0aGlzLndpZHRoID0gdGhpcy50YXJnZXQud2lkdGg7XG4gICAgICB0aGlzLmhlaWdodCA9IHRoaXMudGFyZ2V0LmhlaWdodDtcblxuICAgICAgdGhpcy50YXJnZXQuY2xpcCA9IChjKSA9PiB0aGlzLl9jbGlwKGMpO1xuICAgIH0pO1xuICB9LFxuXG4gIF9jbGlwOiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICBjb25zdCB4ID0gdGhpcy54IC0gKHRoaXMudGFyZ2V0LndpZHRoICogdGhpcy50YXJnZXQub3JpZ2luWCk7XG4gICAgY29uc3QgeSA9IHRoaXMueSAtICh0aGlzLnRhcmdldC5oZWlnaHQgKiB0aGlzLnRhcmdldC5vcmlnaW5ZKTtcblxuICAgIGNhbnZhcy5iZWdpblBhdGgoKTtcbiAgICBjYW52YXMucmVjdCh4LCB5LCB0aGlzLnRhcmdldC53aWR0aCwgdGhpcy50YXJnZXQuaGVpZ2h0KTtcbiAgICBjYW52YXMuY2xvc2VQYXRoKCk7XG4gIH0sXG5cbiAgc2V0RW5hYmxlOiBmdW5jdGlvbihlbmFibGUpIHtcbiAgICB0aGlzLl9lbmFibGUgPSBlbmFibGU7XG4gICAgaWYgKHRoaXMuX2VuYWJsZSkge1xuICAgICAgdGhpcy50YXJnZXQuY2xpcCA9IChjKSA9PiB0aGlzLl9jbGlwKGMpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnRhcmdldC5jbGlwID0gbnVsbDtcbiAgICB9XG4gIH0sXG5cbiAgX2FjY2Vzc29yOiB7XG4gICAgZW5hYmxlOiB7XG4gICAgICBzZXQ6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgdGhpcy5zZXRFbmFibGUodik7XG4gICAgICB9LFxuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VuYWJsZTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbn0pO1xuIiwicGhpbmEuZGVmaW5lKFwiUm91bmRSZWN0YW5nbGVDbGlwXCIsIHtcbiAgc3VwZXJDbGFzczogXCJBY2Nlc3NvcnlcIixcblxuICB4OiAwLFxuICB5OiAwLFxuICB3aWR0aDogMCxcbiAgaGVpZ2h0OiAwLFxuXG4gIHJhZGl1czogNSxcblxuICBfZW5hYmxlOiB0cnVlLFxuXG4gIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc3VwZXJJbml0KCk7XG4gICAgdGhpcy5faW5pdCgpO1xuICB9LFxuXG4gIF9pbml0OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm9uKFwiYXR0YWNoZWRcIiwgKCkgPT4ge1xuXG4gICAgICB0aGlzLnRhcmdldC5hY2Nlc3NvcihcIlJvdW5kUmVjdGFuZ2xlQ2xpcC53aWR0aFwiLCB7XG4gICAgICAgIFwiZ2V0XCI6ICgpID0+IHRoaXMud2lkdGgsXG4gICAgICAgIFwic2V0XCI6ICh2KSA9PiB0aGlzLndpZHRoID0gdixcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnRhcmdldC5hY2Nlc3NvcihcIlJvdW5kUmVjdGFuZ2xlQ2xpcC5oZWlnaHRcIiwge1xuICAgICAgICBcImdldFwiOiAoKSA9PiB0aGlzLmhlaWdodCxcbiAgICAgICAgXCJzZXRcIjogKHYpID0+IHRoaXMuaGVpZ2h0ID0gdixcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnRhcmdldC5hY2Nlc3NvcihcIlJvdW5kUmVjdGFuZ2xlQ2xpcC54XCIsIHtcbiAgICAgICAgXCJnZXRcIjogKCkgPT4gdGhpcy54LFxuICAgICAgICBcInNldFwiOiAodikgPT4gdGhpcy54ID0gdixcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnRhcmdldC5hY2Nlc3NvcihcIlJvdW5kUmVjdGFuZ2xlQ2xpcC55XCIsIHtcbiAgICAgICAgXCJnZXRcIjogKCkgPT4gdGhpcy55LFxuICAgICAgICBcInNldFwiOiAodikgPT4gdGhpcy55ID0gdixcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnRhcmdldC5hY2Nlc3NvcihcIlJvdW5kUmVjdGFuZ2xlQ2xpcC5yYWRpdXNcIiwge1xuICAgICAgICBcImdldFwiOiAoKSA9PiB0aGlzLnJhZGl1cyxcbiAgICAgICAgXCJzZXRcIjogKHYpID0+IHRoaXMucmFkaXVzID0gdixcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnggPSAwO1xuICAgICAgdGhpcy55ID0gMDtcbiAgICAgIHRoaXMud2lkdGggPSB0aGlzLnRhcmdldC53aWR0aDtcbiAgICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy50YXJnZXQuaGVpZ2h0O1xuXG4gICAgICB0aGlzLnRhcmdldC5jbGlwID0gKGMpID0+IHRoaXMuX2NsaXAoYyk7XG4gICAgfSk7XG4gIH0sXG5cbiAgX2NsaXA6IGZ1bmN0aW9uKGNhbnZhcykge1xuICAgIGNvbnN0IHdpZHRoID0gdGhpcy50YXJnZXQud2lkdGg7XG4gICAgY29uc3QgaGVpZ2h0ID0gdGhpcy50YXJnZXQuaGVpZ2h0O1xuICAgIGNvbnN0IHggPSB0aGlzLnggLSAod2lkdGggKiB0aGlzLnRhcmdldC5vcmlnaW5YKTtcbiAgICBjb25zdCB5ID0gdGhpcy55IC0gKGhlaWdodCAqIHRoaXMudGFyZ2V0Lm9yaWdpblkpO1xuICAgIGNvbnN0IHJhZGl1cyA9IHRoaXMucmFkaXVzO1xuXG4gICAgY29uc3QgbCA9IHggKyByYWRpdXM7XG4gICAgY29uc3QgciA9IHggKyB3aWR0aCAtIHJhZGl1cztcbiAgICBjb25zdCB0ID0geSArIHJhZGl1cztcbiAgICBjb25zdCBiID0geSArIGhlaWdodCAtIHJhZGl1cztcblxuICAgIGNhbnZhcy5iZWdpblBhdGgoKTtcbiAgICBjYW52YXMuYXJjKGwsIHQsIHJhZGl1cywgLU1hdGguUEksICAgICAgIC1NYXRoLlBJICogMC41LCBmYWxzZSk7ICAvLyDlt6bkuIpcbiAgICBjYW52YXMuYXJjKHIsIHQsIHJhZGl1cywgLU1hdGguUEkgKiAwLjUsICAgICAgICAgICAgICAwLCBmYWxzZSk7ICAvLyDlj7PkuIpcbiAgICBjYW52YXMuYXJjKHIsIGIsIHJhZGl1cywgICAgICAgICAgICAgIDAsICBNYXRoLlBJICogMC41LCBmYWxzZSk7ICAvLyDlj7PkuItcbiAgICBjYW52YXMuYXJjKGwsIGIsIHJhZGl1cywgIE1hdGguUEkgKiAwLjUsICAgICAgICBNYXRoLlBJLCBmYWxzZSk7ICAvLyDlt6bkuItcbiAgICBjYW52YXMuY2xvc2VQYXRoKCk7XG4gIH0sXG5cbiAgc2V0UmFkaXVzOiBmdW5jdGlvbih2KSB7XG4gICAgdGhpcy5yYWRpdXMgPSB2O1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIHNldEVuYWJsZTogZnVuY3Rpb24oZW5hYmxlKSB7XG4gICAgdGhpcy5fZW5hYmxlID0gZW5hYmxlO1xuICAgIGlmICh0aGlzLl9lbmFibGUpIHtcbiAgICAgIHRoaXMudGFyZ2V0LmNsaXAgPSAoYykgPT4gdGhpcy5fY2xpcChjKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy50YXJnZXQuY2xpcCA9IG51bGw7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIF9hY2Nlc3Nvcjoge1xuICAgIGVuYWJsZToge1xuICAgICAgc2V0OiBmdW5jdGlvbih2KSB7XG4gICAgICAgIHRoaXMuc2V0RW5hYmxlKHYpO1xuICAgICAgfSxcbiAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9lbmFibGU7XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG59KTtcbiIsInBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICBwaGluYS5kZWZpbmUoXCJwaGluYS5hc3NldC5BdGxhc1wiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5hc3NldC5Bc3NldFwiLFxuXG4gICAgZGF0YTogbnVsbCxcbiAgICBpbWFnZXM6IG51bGwsXG5cbiAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuc3VwZXJJbml0KCk7XG4gICAgICB0aGlzLmltYWdlcyA9IHt9O1xuICAgICAgdGhpcy5mcmFtZUNhY2hlID0ge307XG4gICAgfSxcblxuICAgIGxvYWQ6IGZ1bmN0aW9uKGtleSwgc3JjKSB7XG4gICAgICB0aGlzLmtleSA9IGtleTtcbiAgICAgIGlmICh0eXBlb2Yoc3JjKSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICB0aGlzLnNyYyA9IFtzcmNdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zcmMgPSBzcmM7XG4gICAgICB9XG4gICAgICByZXR1cm4gcGhpbmEudXRpbC5GbG93KHRoaXMuX2xvYWQuYmluZCh0aGlzKSk7XG4gICAgfSxcblxuICAgIF9sb2FkOiBmdW5jdGlvbihyZXNvbHZlKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgIHZhciBmbG93cyA9IHNlbGYuc3JjLm1hcChmdW5jdGlvbihzcmMpIHtcbiAgICAgICAgdmFyIGJhc2VQYXRoID0gbnVsbDtcbiAgICAgICAgaWYgKHNyYy5pbmRleE9mKCcvJykgPCAwKSB7XG4gICAgICAgICAgYmFzZVBhdGggPSAnLi8nO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGJhc2VQYXRoID0gc3JjLnN1YnN0cmluZygwLCBzcmMubGFzdEluZGV4T2YoJy8nKSArIDEpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHNlbGYuX2xvYWRKc29uKHNyYylcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5fbG9hZEltYWdlKGRhdGEsIGJhc2VQYXRoKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBwaGluYS51dGlsLkZsb3cuYWxsKGZsb3dzKVxuICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhTGlzdCkge1xuICAgICAgICAgIHJldHVybiBzZWxmLl9tZXJnZURhdGEoZGF0YUxpc3QpO1xuICAgICAgICB9KVxuICAgICAgICAudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXNvbHZlKHNlbGYpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgX2xvYWRKc29uOiBmdW5jdGlvbihzcmMpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIHJldHVybiBwaGluYS51dGlsLkZsb3coZnVuY3Rpb24ocmVzb2x2ZSkge1xuICAgICAgICB2YXIgeG1sID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgIHhtbC5vcGVuKCdHRVQnLCBzcmMpO1xuICAgICAgICB4bWwub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYgKHhtbC5yZWFkeVN0YXRlID09PSA0KSB7XG4gICAgICAgICAgICBpZiAoWzIwMCwgMjAxLCAwXS5pbmRleE9mKHhtbC5zdGF0dXMpICE9PSAtMSkge1xuICAgICAgICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UoeG1sLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB4bWwuc2VuZChudWxsKTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBfbG9hZEltYWdlOiBmdW5jdGlvbihkYXRhLCBiYXNlUGF0aCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgcmV0dXJuIHBoaW5hLnV0aWwuRmxvdyhmdW5jdGlvbihyZXNvbHZlKSB7XG4gICAgICAgIHZhciBpbWFnZSA9IHBoaW5hLmFzc2V0LlRleHR1cmUoKTtcbiAgICAgICAgc2VsZi5pbWFnZXNbZGF0YS5tZXRhLmltYWdlXSA9IGltYWdlO1xuICAgICAgICBpbWFnZS5sb2FkKGJhc2VQYXRoICsgZGF0YS5tZXRhLmltYWdlKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJlc29sdmUoZGF0YSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSxcblxuICAgIF9tZXJnZURhdGE6IGZ1bmN0aW9uKGRhdGFMaXN0KSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICB0aGlzLmRhdGEgPSB7XG4gICAgICAgIGZyYW1lczogW10sXG4gICAgICAgIG1ldGE6IHtcbiAgICAgICAgICBhcHA6IGRhdGFMaXN0WzBdLm1ldGEuYXBwYXBwLFxuICAgICAgICAgIHZlcnNpb246IGRhdGFMaXN0WzBdLm1ldGEudmVyc2lvbixcbiAgICAgICAgICBmb3JtYXQ6IGRhdGFMaXN0WzBdLm1ldGEuZm9ybWF0LFxuICAgICAgICAgIHNjYWxlOiBkYXRhTGlzdFswXS5tZXRhLnNjYWxlLFxuICAgICAgICAgIHNtYXJ0dXBkYXRlOiBkYXRhTGlzdFswXS5tZXRhLnNtYXJ0dXBkYXRlLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICAgIGRhdGFMaXN0LmZvckVhY2goZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICB2YXIgZnJhbWVzID0gZGF0YS5mcmFtZXM7XG4gICAgICAgIGlmIChmcmFtZXMgaW5zdGFuY2VvZiBBcnJheSA9PSBmYWxzZSkge1xuICAgICAgICAgIGZyYW1lcyA9IE9iamVjdC5rZXlzKGZyYW1lcykubWFwKGZ1bmN0aW9uKGtleSkge1xuICAgICAgICAgICAgdmFyIGZyYW1lID0gZnJhbWVzW2tleV07XG4gICAgICAgICAgICBmcmFtZS5maWxlbmFtZSA9IGtleTtcbiAgICAgICAgICAgIHJldHVybiBmcmFtZTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZyYW1lcy5mb3JFYWNoKGZ1bmN0aW9uKGZyYW1lKSB7XG4gICAgICAgICAgZnJhbWUuaW1hZ2UgPSBkYXRhLm1ldGEuaW1hZ2U7XG4gICAgICAgICAgZnJhbWUuc2l6ZSA9IGRhdGEubWV0YS5zaXplO1xuICAgICAgICB9KTtcblxuICAgICAgICBzZWxmLmRhdGEuZnJhbWVzID0gc2VsZi5kYXRhLmZyYW1lcy5jb25jYXQoZnJhbWVzKTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmRhdGEuZnJhbWVzLnNvcnQoZnVuY3Rpb24obGhzLCByaHMpIHtcbiAgICAgICAgcmV0dXJuIChsaHMuZmlsZW5hbWUgPD0gcmhzLmZpbGVuYW1lKSA/IC0xIDogMTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBnZXRGcmFtZUJ5TmFtZTogZnVuY3Rpb24obmFtZSkge1xuICAgICAgdmFyIGZyYW1lID0gdGhpcy5mcmFtZUNhY2hlW25hbWVdO1xuICAgICAgaWYgKCFmcmFtZSkge1xuICAgICAgICBmcmFtZSA9IHRoaXMuZnJhbWVDYWNoZVtuYW1lXSA9IHRoaXMuZGF0YS5mcmFtZXMuZmluZChmdW5jdGlvbihmKSB7XG4gICAgICAgICAgcmV0dXJuIGYuZmlsZW5hbWUgPT09IG5hbWU7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZyYW1lO1xuICAgIH0sXG5cbiAgICB1bnBhY2tBbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgdmFyIGRhdGEgPSBzZWxmLmRhdGE7XG4gICAgICB2YXIgZnJhbWVzID0gZGF0YS5mcmFtZXM7XG4gICAgICBpZiAoZnJhbWVzIGluc3RhbmNlb2YgQXJyYXkgPT0gZmFsc2UpIHtcbiAgICAgICAgZnJhbWVzID0gT2JqZWN0LmtleXMoZnJhbWVzKS5tYXAoZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgICAgdmFyIGZyYW1lID0gZnJhbWVzW2tleV07XG4gICAgICAgICAgZnJhbWUuZmlsZW5hbWUgPSBrZXk7XG4gICAgICAgICAgcmV0dXJuIGZyYW1lO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZyYW1lcy5yZWR1Y2UoZnVuY3Rpb24ocmV0LCBmcmFtZSkge1xuICAgICAgICB2YXIgY2FudmFzID0gcGhpbmEuZ3JhcGhpY3MuQ2FudmFzKCk7XG5cbiAgICAgICAgdmFyIGYgPSBmcmFtZS5mcmFtZTtcbiAgICAgICAgdmFyIHMgPSBmcmFtZS5zcHJpdGVTb3VyY2VTaXplO1xuICAgICAgICB2YXIgc3JjID0gZnJhbWUuc291cmNlU2l6ZTtcbiAgICAgICAgdmFyIHAgPSBmcmFtZS5waXZvdDtcblxuICAgICAgICB2YXIgaW1hZ2UgPSBzZWxmLmltYWdlc1tmcmFtZS5pbWFnZV0uZG9tRWxlbWVudDtcblxuICAgICAgICBjYW52YXMuc2V0U2l6ZShzcmMudywgc3JjLmgpO1xuICAgICAgICBpZiAoIWZyYW1lLnJvdGF0ZWQpIHtcbiAgICAgICAgICBjYW52YXMuY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsXG4gICAgICAgICAgICBmLngsIGYueSwgZi53LCBmLmgsXG4gICAgICAgICAgICBzLngsIHMueSwgcy53LCBzLmhcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNhbnZhcy5jb250ZXh0LnNhdmUoKTtcbiAgICAgICAgICBjYW52YXMuY29udGV4dC50cmFuc2xhdGUoc3JjLncgKiBwLngsIHNyYy5oICogcC55KTtcbiAgICAgICAgICBjYW52YXMuY29udGV4dC5yb3RhdGUoTWF0aC5QSSAqIC0wLjUpO1xuICAgICAgICAgIGNhbnZhcy5jb250ZXh0LnRyYW5zbGF0ZSgtc3JjLmggKiBwLnksIC1zcmMudyAqIHAueCk7XG4gICAgICAgICAgY2FudmFzLmNvbnRleHQuZHJhd0ltYWdlKGltYWdlLFxuICAgICAgICAgICAgZi54LCBmLnksIGYuaCwgZi53LFxuICAgICAgICAgICAgcy55LCBzLngsIHMuaCwgcy53XG4gICAgICAgICAgKTtcbiAgICAgICAgICBjYW52YXMuY29udGV4dC5yZXN0b3JlKCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXRbZnJhbWUuZmlsZW5hbWVdID0gY2FudmFzO1xuICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgfSwge30pO1xuICAgIH0sXG5cbiAgICB1bnBhY2s6IGZ1bmN0aW9uKGZyYW1lKSB7XG4gICAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YTtcbiAgICAgIHZhciBmcmFtZXMgPSBkYXRhLmZyYW1lcztcbiAgICAgIGlmIChmcmFtZXMgaW5zdGFuY2VvZiBBcnJheSA9PSBmYWxzZSkge1xuICAgICAgICBmcmFtZXMgPSBPYmplY3Qua2V5cyhmcmFtZXMpLm1hcChmdW5jdGlvbihrZXkpIHtcbiAgICAgICAgICB2YXIgZnJhbWUgPSBmcmFtZXNba2V5XTtcbiAgICAgICAgICBmcmFtZS5maWxlbmFtZSA9IGtleTtcbiAgICAgICAgICByZXR1cm4gZnJhbWU7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICB2YXIgY2FudmFzID0gcGhpbmEuZ3JhcGhpY3MuQ2FudmFzKCk7XG5cbiAgICAgIHZhciBmID0gZnJhbWUuZnJhbWU7XG4gICAgICB2YXIgcyA9IGZyYW1lLnNwcml0ZVNvdXJjZVNpemU7XG4gICAgICB2YXIgc3JjID0gZnJhbWUuc291cmNlU2l6ZTtcbiAgICAgIHZhciBwID0gZnJhbWUucGl2b3Q7XG5cbiAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2VzW2ZyYW1lLmltYWdlXS5kb21FbGVtZW50O1xuXG4gICAgICBjYW52YXMuc2V0U2l6ZShzcmMudywgc3JjLmgpO1xuICAgICAgaWYgKCFmcmFtZS5yb3RhdGVkKSB7XG4gICAgICAgIGNhbnZhcy5jb250ZXh0LmRyYXdJbWFnZShpbWFnZSxcbiAgICAgICAgICBmLngsIGYueSwgZi53LCBmLmgsXG4gICAgICAgICAgcy54LCBzLnksIHMudywgcy5oXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjYW52YXMuY29udGV4dC5zYXZlKCk7XG4gICAgICAgIGNhbnZhcy5jb250ZXh0LnRyYW5zbGF0ZShzcmMudyAqIHAueCwgc3JjLmggKiBwLnkpO1xuICAgICAgICBjYW52YXMuY29udGV4dC5yb3RhdGUoTWF0aC5QSSAqIC0wLjUpO1xuICAgICAgICBjYW52YXMuY29udGV4dC50cmFuc2xhdGUoLXNyYy5oICogcC55LCAtc3JjLncgKiBwLngpO1xuICAgICAgICBjYW52YXMuY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsXG4gICAgICAgICAgZi54LCBmLnksIGYuaCwgZi53LFxuICAgICAgICAgIHMueSwgcy54LCBzLmgsIHMud1xuICAgICAgICApO1xuICAgICAgICBjYW52YXMuY29udGV4dC5yZXN0b3JlKCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBjYW52YXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOODleODrOODvOODoOOCkuWIh+OCiuWIhuOBkeOBn+mFjeWIl+OCkmF0bGFzRnJhbWVz44Go44GX44GmQXNzZXRNYW5hZ2Vy44Gr44Gk44Gj44GT44KAXG4gICAgICog44GZ44Gn44Gr5a2Y5Zyo44GZ44KM44Gw44CBIEFzc2V0TWFuYWdlcuOBi+OCieWPluW+l+OBmeOCi1xuICAgICAqLyBcbiAgICBnZXRBdGxhc0ZyYW1lczogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICB2YXIgYXRsYXNGcmFtZXMgPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCdhdGxhc0ZyYW1lcycsIHNlbGYua2V5KTtcbiAgICAgIGlmIChhdGxhc0ZyYW1lcykge1xuICAgICAgICByZXR1cm4gYXRsYXNGcmFtZXM7XG4gICAgICB9XG4gICAgICB2YXIgZGF0YSA9IHNlbGYuZGF0YTtcbiAgICAgIHZhciBmcmFtZXMgPSBkYXRhLmZyYW1lcztcbiAgICAgIHZhciBtZXRhID0gZGF0YS5tZXRhO1xuICAgICAgaWYgKGZyYW1lcyBpbnN0YW5jZW9mIEFycmF5ID09IGZhbHNlKSB7XG4gICAgICAgIGZyYW1lcyA9IE9iamVjdC5rZXlzKGZyYW1lcykubWFwKGZ1bmN0aW9uKGtleSkge1xuICAgICAgICAgIHZhciBmcmFtZSA9IGZyYW1lc1trZXldO1xuICAgICAgICAgIGZyYW1lLmZpbGVuYW1lID0ga2V5O1xuICAgICAgICAgIHJldHVybiBmcmFtZTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGF0bGFzRnJhbWVzID0gZnJhbWVzLm1hcChmdW5jdGlvbihmcmFtZSkge1xuICAgICAgICB2YXIga2V5ID0gc2VsZi5rZXkgKyBcIi9cIiArIGZyYW1lLmZpbGVuYW1lO1xuICAgICAgICB2YXIgY2FudmFzID0gcGhpbmEuZ3JhcGhpY3MuQ2FudmFzKCk7XG5cbiAgICAgICAgdmFyIGYgPSBmcmFtZS5mcmFtZTtcbiAgICAgICAgdmFyIHMgPSBmcmFtZS5zcHJpdGVTb3VyY2VTaXplO1xuICAgICAgICB2YXIgc3JjID0gZnJhbWUuc291cmNlU2l6ZTtcbiAgICAgICAgdmFyIHAgPSBmcmFtZS5waXZvdDtcblxuICAgICAgICB2YXIgaW1hZ2UgPSBzZWxmLmltYWdlc1tmcmFtZS5pbWFnZV0uZG9tRWxlbWVudDtcblxuICAgICAgICBjYW52YXMuc2V0U2l6ZShzLncsIHMuaCk7XG4gICAgICAgIGlmICghZnJhbWUucm90YXRlZCkge1xuICAgICAgICAgIGNhbnZhcy5jb250ZXh0LmRyYXdJbWFnZShpbWFnZSxcbiAgICAgICAgICAgIGYueCwgZi55LCBmLncsIGYuaCxcbiAgICAgICAgICAgIDAsIDAsIHMudywgcy5oXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjYW52YXMuY29udGV4dC5zYXZlKCk7XG4gICAgICAgICAgY2FudmFzLmNvbnRleHQudHJhbnNsYXRlKHMudyAqIHAueCwgcy5oICogcC55KTtcbiAgICAgICAgICBjYW52YXMuY29udGV4dC5yb3RhdGUoTWF0aC5QSSAqIC0wLjUpO1xuICAgICAgICAgIGNhbnZhcy5jb250ZXh0LnRyYW5zbGF0ZSgtcy5oICogcC55LCAtcy53ICogcC54KTtcbiAgICAgICAgICBjYW52YXMuY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsXG4gICAgICAgICAgICBmLngsIGYueSwgZi5oLCBmLncsXG4gICAgICAgICAgICAwLCAwLCBzLmgsIHMud1xuICAgICAgICAgICk7XG4gICAgICAgICAgY2FudmFzLmNvbnRleHQucmVzdG9yZSgpO1xuICAgICAgICB9XG4gICAgICAgIGNhbnZhcy5mcmFtZSA9IGZyYW1lO1xuICAgICAgICBjYW52YXMubWV0YSA9IG1ldGE7XG4gICAgICAgIHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5zZXQoJ2ltYWdlJywga2V5LCBjYW52YXMpO1xuICAgICAgICByZXR1cm4gY2FudmFzO1xuICAgICAgfSk7XG5cbiAgICAgIHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5zZXQoJ2F0bGFzRnJhbWVzJywgc2VsZi5rZXksIGF0bGFzRnJhbWVzKTtcbiAgICAgIHJldHVybiBhdGxhc0ZyYW1lcztcbiAgICB9LFxuXG4gIH0pO1xuXG4gIHBoaW5hLmFzc2V0LkFzc2V0TG9hZGVyLnJlZ2lzdGVyKCdhdGxhcycsIGZ1bmN0aW9uKGtleSwgc3JjKSB7XG4gICAgdmFyIGFzc2V0ID0gcGhpbmEuYXNzZXQuQXRsYXMoKTtcbiAgICByZXR1cm4gYXNzZXQubG9hZChrZXksIHNyYyk7XG4gIH0pO1xuXG4gIHBoaW5hLmRlZmluZShcInBoaW5hLmRpc3BsYXkuQXRsYXNTcHJpdGVcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudFwiLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgb3B0aW9ucyA9ICh7fSkuJHNhZmUob3B0aW9ucywgcGhpbmEuZGlzcGxheS5BdGxhc1Nwcml0ZS5kZWZhdWx0cyk7XG4gICAgICB0aGlzLnN1cGVySW5pdChvcHRpb25zKTtcbiAgICAgIHRoaXMuc3JjUmVjdCA9IHBoaW5hLmdlb20uUmVjdCgpO1xuICAgICAgdGhpcy5kc3RSZWN0ID0gcGhpbmEuZ2VvbS5SZWN0KCk7XG4gICAgICB0aGlzLnNyY1Bpdm90ID0gcGhpbmEuZ2VvbS5WZWN0b3IyKCk7XG4gICAgICB0aGlzLnJvdGF0ZWQgPSBmYWxzZTtcblxuICAgICAgdGhpcy5hdGxhcyA9IHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5nZXQoXCJhdGxhc1wiLCBvcHRpb25zLmF0bGFzKTtcblxuICAgICAgdGhpcy5zZXRGcmFtZShvcHRpb25zLmZyYW1lKTtcblxuICAgICAgdGhpcy5hbHBoYSA9IG9wdGlvbnMuYWxwaGE7XG4gICAgfSxcblxuICAgIHNldEZyYW1lOiBmdW5jdGlvbihmcmFtZU5hbWUpIHtcbiAgICAgIHZhciBhdGxhcyA9IHRoaXMuYXRsYXM7XG4gICAgICBpZiAodHlwZW9mIChmcmFtZU5hbWUpID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHRoaXMuZnJhbWUgPSBhdGxhcy5nZXRGcmFtZUJ5TmFtZShmcmFtZU5hbWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5mcmFtZSA9IGF0bGFzLmRhdGEuZnJhbWVzLmF0KGZyYW1lTmFtZSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuaW1hZ2UgPSBhdGxhcy5pbWFnZXNbdGhpcy5mcmFtZS5pbWFnZV07XG5cbiAgICAgIHZhciBmID0gdGhpcy5mcmFtZS5mcmFtZTtcbiAgICAgIHZhciBzc3MgPSB0aGlzLmZyYW1lLnNwcml0ZVNvdXJjZVNpemU7XG4gICAgICB2YXIgcCA9IHRoaXMuZnJhbWUucGl2b3Q7XG4gICAgICB0aGlzLnNyY1JlY3Quc2V0KGYueCwgZi55LCBmLncsIGYuaCk7XG4gICAgICB0aGlzLmRzdFJlY3Quc2V0KHNzcy54LCBzc3MueSwgc3NzLncsIHNzcy5oKTtcbiAgICAgIHRoaXMud2lkdGggPSB0aGlzLmZyYW1lLnNvdXJjZVNpemUudztcbiAgICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy5mcmFtZS5zb3VyY2VTaXplLmg7XG4gICAgICBpZiAoYXRsYXMuZGF0YS5tZXRhLnNjYWxlICE9IFwiMVwiKSB7XG4gICAgICAgIHZhciBzID0gMSAvICgrYXRsYXMuZGF0YS5tZXRhLnNjYWxlKTtcbiAgICAgICAgdGhpcy5kc3RSZWN0LnggKj0gcztcbiAgICAgICAgdGhpcy5kc3RSZWN0LnkgKj0gcztcbiAgICAgICAgdGhpcy5kc3RSZWN0LndpZHRoICo9IHM7XG4gICAgICAgIHRoaXMuZHN0UmVjdC5oZWlnaHQgKj0gcztcbiAgICAgICAgdGhpcy53aWR0aCAqPSBzO1xuICAgICAgICB0aGlzLmhlaWdodCAqPSBzO1xuICAgICAgfVxuICAgICAgdGhpcy5zcmNQaXZvdC5zZXQocC54LCBwLnkpO1xuICAgICAgdGhpcy5yb3RhdGVkID0gdGhpcy5mcmFtZS5yb3RhdGVkO1xuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgZHJhdzogZnVuY3Rpb24oY2FudmFzKSB7XG4gICAgICB2YXIgc3IgPSB0aGlzLnNyY1JlY3Q7XG4gICAgICB2YXIgZHIgPSB0aGlzLmRzdFJlY3Q7XG4gICAgICB2YXIgcCA9IHRoaXMuc3JjUGl2b3Q7XG4gICAgICB2YXIgaW1hZ2UgPSB0aGlzLmltYWdlLmRvbUVsZW1lbnQ7XG5cbiAgICAgIGlmICghdGhpcy5yb3RhdGVkKSB7XG4gICAgICAgIGNhbnZhcy5jb250ZXh0LmRyYXdJbWFnZShpbWFnZSxcbiAgICAgICAgICBzci54LCBzci55LCBzci53aWR0aCwgc3IuaGVpZ2h0LCAtdGhpcy5fd2lkdGggKiB0aGlzLm9yaWdpblggKyBkci54LCAtdGhpcy5faGVpZ2h0ICogdGhpcy5vcmlnaW5ZICsgZHIueSwgZHIud2lkdGgsIGRyLmhlaWdodFxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGN0eCA9IGNhbnZhcy5jb250ZXh0O1xuICAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgICBjdHgucm90YXRlKE1hdGguUEkgKiAtMC41KTtcbiAgICAgICAgY3R4LmRyYXdJbWFnZShpbWFnZSxcbiAgICAgICAgICBzci54LCBzci55LCBzci5oZWlnaHQsIHNyLndpZHRoLFxuICAgICAgICAgIHRoaXMuX2hlaWdodCAqICgxIC0gdGhpcy5vcmlnaW5ZKSAtIGRyLmhlaWdodCAtIGRyLnksIC10aGlzLl93aWR0aCAqIHRoaXMub3JpZ2luWCArIGRyLngsIGRyLmhlaWdodCwgZHIud2lkdGhcbiAgICAgICAgKTtcbiAgICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX3N0YXRpYzoge1xuICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgZnJhbWU6IDAsXG4gICAgICAgIGFscGhhOiAxLFxuICAgICAgfSxcbiAgICB9LFxuXG4gIH0pO1xuXG4gIHBoaW5hLmRlZmluZShcInBoaW5hLmRpc3BsYXkuQXRsYXNGcmFtZVNwcml0ZVwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJwaGluYS5kaXNwbGF5LkRpc3BsYXlFbGVtZW50XCIsXG4gICAgX2F0bGFzSW5kZXg6IDAsXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnc3RyaW5nJykge1xuICAgICAgICBvcHRpb25zID0ge1xuICAgICAgICAgIGF0bGFzOiBvcHRpb25zLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgb3B0aW9ucyA9ICh7fSkuJHNhZmUob3B0aW9ucywgcGhpbmEuZGlzcGxheS5BdGxhc0ZyYW1lU3ByaXRlLmRlZmF1bHRzKTtcbiAgICAgIHRoaXMuYXRsYXNOYW1lID0gb3B0aW9ucy5hdGxhcztcbiAgICAgIHRoaXMuYXRsYXMgPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuZ2V0KCdhdGxhcycsIHRoaXMuYXRsYXNOYW1lKTtcbiAgICAgIHRoaXMuYXRsYXNGcmFtZXMgPSB0aGlzLmF0bGFzLmdldEF0bGFzRnJhbWVzKCk7XG4gICAgICB0aGlzLnN1cGVySW5pdCgpO1xuICAgICAgdGhpcy5kc3RSZWN0ID0gcGhpbmEuZ2VvbS5SZWN0KCk7XG4gICAgICB0aGlzLnNyY1Bpdm90ID0gcGhpbmEuZ2VvbS5WZWN0b3IyKCk7XG5cbiAgICAgIHRoaXMuc2V0SW1hZ2UodGhpcy5hdGxhc05hbWUpO1xuICAgICAgdGhpcy5hdGxhc0luZGV4ID0gb3B0aW9ucy5hdGxhc0luZGV4O1xuXG4gICAgICB0aGlzLmFscGhhID0gb3B0aW9ucy5hbHBoYTtcbiAgICB9LFxuXG4gICAgc2V0SW1hZ2U6IGZ1bmN0aW9uKGltYWdlLCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICBpZiAodHlwZW9mIGltYWdlID09PSAnc3RyaW5nJykge1xuICAgICAgICB0aGlzLmF0bGFzRnJhbWVzID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldCgnYXRsYXMnLCBpbWFnZSkuZ2V0QXRsYXNGcmFtZXMoKTtcbiAgICAgICAgaW1hZ2UgPSB0aGlzLmF0bGFzRnJhbWVzW3RoaXMuYXRsYXNJbmRleF07XG4gICAgICB9XG4gICAgICB0aGlzLl9pbWFnZSA9IGltYWdlO1xuICAgICAgdGhpcy53aWR0aCA9IHRoaXMuX2ltYWdlLmRvbUVsZW1lbnQud2lkdGg7XG4gICAgICB0aGlzLmhlaWdodCA9IHRoaXMuX2ltYWdlLmRvbUVsZW1lbnQuaGVpZ2h0O1xuXG4gICAgICBpZiAod2lkdGgpIHsgdGhpcy53aWR0aCA9IHdpZHRoOyB9XG4gICAgICBpZiAoaGVpZ2h0KSB7IHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OyB9XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBzZXRGcmFtZTogZnVuY3Rpb24oYXRsYXNJbmRleCkge1xuICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZSA9IHRoaXMuYXRsYXNGcmFtZXMuYXQoYXRsYXNJbmRleCk7XG4gICAgICB0aGlzLmZyYW1lID0gaW1hZ2UuZnJhbWU7XG4gICAgICB2YXIgZiA9IHRoaXMuZnJhbWUuZnJhbWU7XG4gICAgICB2YXIgc3MgPSB0aGlzLmZyYW1lLnNvdXJjZVNpemU7XG4gICAgICB2YXIgc3NzID0gdGhpcy5mcmFtZS5zcHJpdGVTb3VyY2VTaXplO1xuICAgICAgdmFyIHAgPSB0aGlzLmZyYW1lLnBpdm90O1xuICAgICAgdmFyIGRyID0gdGhpcy5kc3RSZWN0O1xuICAgICAgZHIuc2V0KHNzcy54LCBzc3MueSwgc3NzLncsIHNzcy5oKTtcblxuICAgICAgZHIueCAtPSBzcy53ICogdGhpcy5vcmlnaW5YO1xuICAgICAgZHIueSAtPSBzcy5oICogdGhpcy5vcmlnaW5ZO1xuICAgICAgaWYgKGltYWdlLm1ldGEuc2NhbGUgIT0gXCIxXCIpIHtcbiAgICAgICAgdmFyIHMgPSAxIC8gKCtpbWFnZS5tZXRhLnNjYWxlKTtcbiAgICAgICAgZHIueCAqPSBzO1xuICAgICAgICBkci55ICo9IHM7XG4gICAgICAgIGRyLndpZHRoICo9IHM7XG4gICAgICAgIGRyLmhlaWdodCAqPSBzO1xuICAgICAgICB0aGlzLndpZHRoICo9IHM7XG4gICAgICAgIHRoaXMuaGVpZ2h0ICo9IHM7XG4gICAgICB9XG4gICAgICB0aGlzLnNyY1Bpdm90LnNldChwLngsIHAueSk7XG5cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBkcmF3OiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICAgIHZhciBkciA9IHRoaXMuZHN0UmVjdDtcbiAgICAgIC8vIOS4gOaXpuS9v+OBo+OBpuOBquOBhFxuICAgICAgLy8gdmFyIHAgPSB0aGlzLnNyY1Bpdm90O1xuICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZS5kb21FbGVtZW50O1xuXG4gICAgICBjYW52YXMuY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIGRyLngsIGRyLnksIGRyLndpZHRoLCBkci5oZWlnaHQpO1xuICAgIH0sXG5cbiAgICBfYWNjZXNzb3I6IHtcbiAgICAgIGltYWdlOiB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLl9pbWFnZTsgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbih2KSB7XG4gICAgICAgICAgdGhpcy5zZXRJbWFnZSh2KTtcbiAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGF0bGFzSW5kZXg6IHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5fYXRsYXNJbmRleDtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbih2KSB7XG4gICAgICAgICAgdGhpcy5fYXRsYXNJbmRleCA9IHY7XG4gICAgICAgICAgdGhpcy5zZXRGcmFtZSh2KTtcbiAgICAgICAgfSxcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX3N0YXRpYzoge1xuICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgYXRsYXNJbmRleDogMCxcbiAgICAgICAgYWxwaGE6IDEsXG4gICAgICB9LFxuICAgIH0sXG5cbiAgfSk7XG5cbn0pOyIsInBoaW5hLm5hbWVzcGFjZSgoKSA9PiB7XG5cbiAgY29uc3QgZ2VuZXJhdGVVVUlEID0gKCkgPT4ge1xuICAgIGxldCBjaGFycyA9IFwieHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4XCIuc3BsaXQoXCJcIik7XG4gICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGNoYXJzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICBzd2l0Y2ggKGNoYXJzW2ldKSB7XG4gICAgICAgIGNhc2UgXCJ4XCI6XG4gICAgICAgICAgY2hhcnNbaV0gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxNikudG9TdHJpbmcoMTYpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwieVwiOlxuICAgICAgICAgIGNoYXJzW2ldID0gKE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDQpICsgOCkudG9TdHJpbmcoMTYpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gY2hhcnMuam9pbihcIlwiKTtcbiAgfTtcblxuICBwaGluYS5kZWZpbmUoXCJwaGluYS5sYXlvdXQuTGF5b3V0QXNzZXRcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwicGhpbmEuYXNzZXQuRmlsZVwiLFxuXG4gICAgaWQ6IG51bGwsXG4gICAgYXRsYXM6IG51bGwsXG4gICAgdGV4dHVyZUlkczogbnVsbCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5zdXBlckluaXQoKTtcbiAgICAgIHRoaXMuaWQgPSBnZW5lcmF0ZVVVSUQoKTtcbiAgICAgIHRoaXMudGV4dHVyZUlkcyA9IFtdO1xuICAgIH0sXG5cbiAgICBidWlsZDogZnVuY3Rpb24oKSB7XG4gICAgICBjb25zdCByb290ID0gcGhpbmEuZGlzcGxheS5EaXNwbGF5RWxlbWVudCgpO1xuICAgICAgcm9vdC5yZWYgPSB7fTtcbiAgICAgIHJvb3QubGF5b3V0QXNzZXQgPSB0aGlzO1xuXG4gICAgICByb290LmZyb21KU09OKHRoaXMuZGF0YS5yb290KTtcblxuICAgICAgY29uc3Qgc2NhbklkcyA9IChlbGVtZW50KSA9PiB7XG4gICAgICAgIGlmIChlbGVtZW50LmlkKSB7XG4gICAgICAgICAgcm9vdC5yZWZbZWxlbWVudC5pZF0gPSBlbGVtZW50O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGVsZW1lbnQuY2hpbGRyZW4pIHtcbiAgICAgICAgICBlbGVtZW50LmNoaWxkcmVuLmZvckluKChrZXksIGNoaWxkKSA9PiBzY2FuSWRzKGNoaWxkKSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBzY2FuSWRzKHJvb3QpO1xuXG4gICAgICBjb25zdCB0cmF2ZXJzZSA9IChlbGVtZW50KSA9PiB7XG4gICAgICAgIGVsZW1lbnQuZmxhcmUoXCJyZWFkeVwiKTtcbiAgICAgICAgaWYgKGVsZW1lbnQuY2hpbGRyZW4pIHtcbiAgICAgICAgICBlbGVtZW50LmNoaWxkcmVuLmZvckVhY2goKGNoaWxkKSA9PiB0cmF2ZXJzZShjaGlsZCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0cmF2ZXJzZShyb290KTtcblxuICAgICAgLy/nlJ/miJDjg6zjgqTjgqLjgqbjg4jjgYxyZW1vdmXjgZXjgozjgZ/mmYLjgavlhoXlrrnjga7noLTmo4TjgpLooYzjgYZcbiAgICAgIGNvbnN0IGRlc3Ryb3kgPSAoY2hpbGQpID0+IHtcbiAgICAgICAgaWYgKCFjaGlsZCkgY2hpbGQgPSByb290O1xuICAgICAgICBjaGlsZC5jaGlsZHJlbi5jbG9uZSgpLmZvckVhY2goYyA9PiB7XG4gICAgICAgICAgLy/jg6njg5njg6vjgafkv53mjIHjgZfjgabjgYTjgotjYW52YXPjgpLnoLTmo4RcbiAgICAgICAgICBpZiAoYyBpbnN0YW5jZW9mIExhYmVsKSB7XG4gICAgICAgICAgICBjLmRlc3Ryb3lDYW52YXMoKTtcbiAgICAgICAgICAgIGMucmVtb3ZlKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJvb3QuZGVzdHJveShjKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgcm9vdC5kZXN0cm95ID0gZGVzdHJveTtcblxuICAgICAgcmV0dXJuIHJvb3Q7XG4gICAgfSxcblxuICAgIHJlbGVhc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy50ZXh0dXJlSWRzLmZvckVhY2goaWQgPT4ge1xuICAgICAgICBjb25zdCBjYW52YXMgPSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuYXNzZXRzW1wiaW1hZ2VcIl1baWRdW1wiZG9tRWxlbWVudFwiXTtcbiAgICAgICAgY2FudmFzLndpZHRoID0gMDtcbiAgICAgICAgY2FudmFzLmhlaWdodCA9IDA7XG4gICAgICAgIGRlbGV0ZSBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuYXNzZXRzW1wiaW1hZ2VcIl1baWRdW1wiZG9tRWxlbWVudFwiXTtcbiAgICAgICAgZGVsZXRlIHBoaW5hLmFzc2V0LkFzc2V0TWFuYWdlci5hc3NldHNbXCJpbWFnZVwiXVtpZF07XG4gICAgICB9KTtcbiAgICAgIGRlbGV0ZSB0aGlzLnRleHR1cmVJZHM7XG4gICAgfSxcblxuICAgIF9sb2FkOiBmdW5jdGlvbihyZXNvbHZlKSB7XG4gICAgICBwaGluYS51dGlsLkZsb3coKHJlc29sdmUpID0+IHRoaXMuc3VwZXJNZXRob2QoXCJfbG9hZFwiLCByZXNvbHZlKSlcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGpzb24gPSBKU09OLnBhcnNlKHRoaXMuZGF0YSk7XG4gICAgICAgICAgcmV0dXJuIHBoaW5hLnV0aWwuRmxvdy5yZXNvbHZlKGpzb24pO1xuICAgICAgICB9KVxuICAgICAgICAudGhlbigoanNvbikgPT4gdGhpcy5fbG9hZEF0bGFzKGpzb24pKVxuICAgICAgICAudGhlbigoanNvbikgPT4ge1xuICAgICAgICAgIHRoaXMuZGF0YSA9IGpzb247XG4gICAgICAgICAgcmVzb2x2ZSh0aGlzKTtcbiAgICAgICAgICAvL+OCouODiOODqeOCueOBruWPgueFp+WJiumZpFxuICAgICAgICAgIGNvbnN0IGF0bGFzID0gcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmdldChcImF0bGFzXCIsIHRoaXMuaWQpO1xuICAgICAgICAgIGF0bGFzLmltYWdlcy5mb3JJbigobmFtZSkgPT4ge1xuICAgICAgICAgICAgYXRsYXMuaW1hZ2VzW25hbWVdLmRvbUVsZW1lbnQud2lkdGggPSAwO1xuICAgICAgICAgICAgYXRsYXMuaW1hZ2VzW25hbWVdLmRvbUVsZW1lbnQuaGVpZ2h0ID0gMDtcbiAgICAgICAgICAgIGRlbGV0ZSBhdGxhcy5pbWFnZXNbbmFtZV0uc3JjO1xuICAgICAgICAgICAgZGVsZXRlIGF0bGFzLmltYWdlc1tuYW1lXS5kb21FbGVtZW50O1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGRlbGV0ZSBqc29uLmF0bGFzZXM7XG4gICAgICAgICAgZGVsZXRlIGF0bGFzLmltYWdlcztcbiAgICAgICAgICBkZWxldGUgcGhpbmEuYXNzZXQuQXNzZXRNYW5hZ2VyLmFzc2V0c1tcImF0bGFzXCJdW3RoaXMuaWRdO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgX2xvYWRBdGxhczogZnVuY3Rpb24oanNvbikge1xuICAgICAgY29uc3QgYXRsYXMgPSBwaGluYS5hc3NldC5BdGxhcygpO1xuXG4gICAgICBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuc2V0KFwiYXRsYXNcIiwgdGhpcy5pZCwgYXRsYXMpO1xuXG4gICAgICByZXR1cm4gcGhpbmEudXRpbC5GbG93KChyZXNvbHZlKSA9PiB7XG4gICAgICAgIGNvbnN0IGZsb3dzID0ganNvbi5hdGxhc2VzLm1hcCgoYXRsYXNEYXRhKSA9PiB7XG4gICAgICAgICAgY29uc3QgbmFtZSA9IGF0bGFzRGF0YS5hdGxhcy5tZXRhLmltYWdlO1xuICAgICAgICAgIGF0bGFzLmRhdGEgPSBhdGxhc0RhdGEuYXRsYXM7XG4gICAgICAgICAgYXRsYXMuaW1hZ2VzW25hbWVdID0gcGhpbmEuYXNzZXQuVGV4dHVyZSgpO1xuICAgICAgICAgIHJldHVybiBhdGxhcy5pbWFnZXNbbmFtZV0ubG9hZChhdGxhc0RhdGEudGV4dHVyZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8v44Ki44OI44Op44K544GM5a2Y5Zyo44GX44Gq44GE5aC05ZCIXG4gICAgICAgIGlmKGZsb3dzLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgcmVzb2x2ZShqc29uKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBwaGluYS51dGlsLkZsb3cuYWxsKGZsb3dzKVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICBhdGxhcy5fbWVyZ2VEYXRhKGpzb24uYXRsYXNlcy5tYXAoXyA9PiBfLmF0bGFzKSk7XG5cbiAgICAgICAgICAgICAgY29uc3QgdW5wYWNrZWRUZXh0dXJlcyA9IGF0bGFzLnVucGFja0FsbCgpO1xuICAgICAgICAgICAgICB1bnBhY2tlZFRleHR1cmVzLmZvckluKChuYW1lLCB0ZXgpID0+IHtcbiAgICAgICAgICAgICAgICB0ZXguaWQgPSBnZW5lcmF0ZVVVSUQoKTtcbiAgICAgICAgICAgICAgICBwaGluYS5hc3NldC5Bc3NldE1hbmFnZXIuc2V0KFwiaW1hZ2VcIiwgdGV4LmlkLCB0ZXgpO1xuICAgICAgICAgICAgICAgIHRoaXMudGV4dHVyZUlkcy5wdXNoKHRleC5pZCk7XG4gICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgIGNvbnN0IHNjYW4gPSAoZWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmNsYXNzTmFtZSA9PT0gXCJwaGluYS5kaXNwbGF5LkF0bGFzU3ByaXRlXCIpIHtcbiAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYXJndW1lbnRzLmF0bGFzID0gdGhpcy5pZDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQuY2xhc3NOYW1lID09PSBcInBoaW5hLmRpc3BsYXkuU3ByaXRlXCIpIHtcbiAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYXJndW1lbnRzWzBdID0gdW5wYWNrZWRUZXh0dXJlc1tlbGVtZW50LmFyZ3VtZW50c1swXV0uaWQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYoZWxlbWVudC5hY2Nlc3Nvcmllcykge1xuICAgICAgICAgICAgICAgICAgLy/jgrDjg6zjg7zjgrnjgrHjg7zjg6vnlKjjga7nlLvlg4/jgYzogIPmha7jgZXjgozjgabjgYTjgarjgYvjgaPjgZ/jgZ/jgoHlj5bjgormgKXjgY7lr77lv5xcbiAgICAgICAgICAgICAgICAgIGNvbnN0IGdyYXlzY2FsZSA9IGVsZW1lbnQuYWNjZXNzb3JpZXMuR3JheXNjYWxlO1xuICAgICAgICAgICAgICAgICAgaWYoZ3JheXNjYWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGdyYXlzY2FsZS5hcmd1bWVudHMuZ3JheVRleHR1cmVOYW1lID0gdW5wYWNrZWRUZXh0dXJlc1tncmF5c2NhbGUuYXJndW1lbnRzLmdyYXlUZXh0dXJlTmFtZV0uaWQ7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuY2hpbGRyZW4pIHtcbiAgICAgICAgICAgICAgICAgIGVsZW1lbnQuY2hpbGRyZW4uZm9ySW4oKGtleSwgY2hpbGQpID0+IHNjYW4oY2hpbGQpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIHNjYW4oanNvbi5yb290KTtcblxuICAgICAgICAgICAgICByZXNvbHZlKGpzb24pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgfSk7XG5cbiAgcGhpbmEuYXNzZXQuQXNzZXRMb2FkZXIuYXNzZXRMb2FkRnVuY3Rpb25zW1wibGF5b3V0XCJdID0gKGtleSwgcGF0aCkgPT4ge1xuICAgIGNvbnN0IGFzc2V0ID0gcGhpbmEubGF5b3V0LkxheW91dEFzc2V0KCk7XG4gICAgY29uc3QgZmxvdyA9IGFzc2V0LmxvYWQocGF0aCk7XG4gICAgcmV0dXJuIGZsb3c7XG4gIH07XG5cbn0pOyIsInBoaW5hLm5hbWVzcGFjZShmdW5jdGlvbigpIHtcblxuICBwaGluYS5kZWZpbmUoXCJEaWFsb2dcIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwiTW9kYWxcIixcblxuICAgIF9zdGF0aWM6IHtcbiAgICAgIG9wZW5Db3VudDogMCxcbiAgICB9LFxuXG4gICAgLy/plovlp4vliY3jgavoqq3jgb/ovrzjgb/jgYzlv4XopoHjgarjgqLjgrvjg4Pjg4jjg6rjgrnjg4hcbiAgICBhc3NldExpc3Q6IG51bGwsXG5cbiAgICAvL+W7g+ajhOOCqOODrOODoeODs+ODiFxuICAgIGRpc3Bvc2VFbGVtZW50czogbnVsbCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5zdXBlckluaXQoKTtcblxuICAgICAgdGhpcy5hcHAgPSBwaGluYV9hcHA7XG5cbiAgICAgIHRoaXMuYmFja2dyb3VuZCA9IFNwcml0ZShcImJsYWNrXCIpXG4gICAgICAgIC5hZGRDaGlsZFRvKHRoaXMpXG4gICAgICAgIC5zZXRQb3NpdGlvbihTQ1JFRU5fV0lEVEggKiAwLjUsIFNDUkVFTl9IRUlHSFQgKiAwLjUpXG4gICAgICB0aGlzLmJhY2tncm91bmQuYWxwaGEgPSAwO1xuXG4gICAgICB0aGlzLmxheW91dEJhc2UgPSBEaXNwbGF5RWxlbWVudCh7IHdpZHRoOiBTQ1JFRU5fV0lEVEgsIGhlaWdodDogU0NSRUVOX0hFSUdIVCB9KVxuICAgICAgICAuYWRkQ2hpbGRUbyh0aGlzKVxuICAgICAgICAuc2V0UG9zaXRpb24oU0NSRUVOX1dJRFRIICogMC41LCBTQ1JFRU5fSEVJR0hUICogMC41KTtcblxuICAgICAgdGhpcy5kaXNwb3NlRWxlbWVudHMgPSBbXTtcbiAgICAgIHRoaXMub24oJ2Nsb3NlZCcsICgpID0+IHRoaXMuZGlzcG9zZUVsZW1lbnRzLmZvckVhY2goZSA9PiBlLnJlbW92ZSgpLmRlc3Ryb3lDYW52YXMoKSkpO1xuICAgIH0sXG5cbiAgICAvL+OCt+ODvOODs+mbouiEseaZguOBq+egtOajhOOBmeOCi1NoYXBl44KS55m76YyyXG4gICAgZGlzcG9zZTogZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgdGhpcy5kaXNwb3NlRWxlbWVudHMucHVzaChlbGVtZW50KTtcbiAgICB9LFxuXG4gICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8v6KGo56S6XG4gICAgb3BlbjogZnVuY3Rpb24oc2NlbmUsIG9wdGlvbnMpIHtcbiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG4gICAgICB0aGlzLnBhcmVudFNjZW5lID0gc2NlbmU7XG4gICAgICBEaWFsb2cub3BlbkNvdW50Kys7XG4gICAgICBpZiAob3B0aW9ucy5pc05vdGhpbmdCYWNrZ3JvdW5kKSB7XG4gICAgICAgIHRoaXMuYmFja2dyb3VuZC5oaWRlKCk7XG4gICAgICB9XG4gICAgICB0aGlzLmFkZENoaWxkVG8oc2NlbmUpO1xuICAgICAgdGhpcy5kb3dubG9hZEFzc2V0KHRoaXMuYXNzZXRMaXN0KVxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgdGhpcy5zZXR1cChvcHRpb25zKTtcbiAgICAgICAgICB0aGlzLm9wZW5BbmltYXRpb24oKTtcbiAgICAgICAgICBpZiAoU3RhdHVzQmFyKSB7XG4gICAgICAgICAgICBTdGF0dXNCYXIuc2hvdygpO1xuICAgICAgICAgICAgU3RhdHVzQmFyLm92ZXJsYXlzV2ViVmlldyh0cnVlKTtcbiAgICAgICAgICAgIFN0YXR1c0Jhci5zdHlsZUxpZ2h0Q29udGVudCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIC8v6Z2e6KGo56S6XG4gICAgY2xvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgRGlhbG9nLm9wZW5Db3VudC0tO1xuICAgICAgdGhpcy5jbG9zZUFuaW1hdGlvbigpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvL+ihqOekuuOCouODi+ODoeODvOOCt+ODp+ODs1xuICAgIG9wZW5BbmltYXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5mbGFyZShcIm9wZW5zdGFydFwiLCB7IGRpYWxvZzogdGhpcyB9KTtcbiAgICAgIHRoaXMucGFyZW50U2NlbmUuZmxhcmUoXCJkaWFsb2dvcGVuXCIsIHsgZGlhbG9nOiB0aGlzIH0pO1xuICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFtcbiAgICAgICAgbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICAgICAgdGhpcy5iYWNrZ3JvdW5kLmFscGhhID0gMDtcbiAgICAgICAgICB0aGlzLmJhY2tncm91bmQudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuZmFkZUluKDI1MClcbiAgICAgICAgICAgIC5jYWxsKCgpID0+IHJlc29sdmUoKSk7XG4gICAgICAgIH0pLFxuICAgICAgICBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgICAgICB0aGlzLmxheW91dEJhc2Uuc2NhbGVYID0gMC4wO1xuICAgICAgICAgIHRoaXMubGF5b3V0QmFzZS5zY2FsZVkgPSAwLjA7XG4gICAgICAgICAgdGhpcy5sYXlvdXRCYXNlLnR3ZWVuZXIuY2xlYXIoKVxuICAgICAgICAgICAgLnRvKHsgc2NhbGVYOiAxLjAsIHNjYWxlWTogMS4wIH0sIDI1MCwgXCJlYXNlSW5PdXRRdWFkXCIpXG4gICAgICAgICAgICAuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICAgIHRoaXMuZmxhcmUoXCJvcGVuZWRcIiwgeyBkaWFsb2c6IHRoaXMgfSk7XG4gICAgICAgICAgICAgIHRoaXMucGFyZW50U2NlbmUuZmxhcmUoXCJkaWFsb2dvcGVuZWRcIiwgeyBkaWFsb2c6IHRoaXMgfSk7XG4gICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgXSk7XG4gICAgfSxcblxuICAgIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvL+mdnuihqOekuuOCouODi+ODoeODvOOCt+ODp+ODs1xuICAgIGNsb3NlQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuZmxhcmUoXCJjbG9zZXN0YXJ0XCIsIHsgZGlhbG9nOiB0aGlzIH0pO1xuICAgICAgdGhpcy5wYXJlbnRTY2VuZS5mbGFyZShcImRpYWxvZ2Nsb3NlXCIsIHsgZGlhbG9nOiB0aGlzIH0pO1xuICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFtcbiAgICAgICAgbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICAgICAgdGhpcy5iYWNrZ3JvdW5kLmFscGhhID0gMTtcbiAgICAgICAgICB0aGlzLmJhY2tncm91bmQudHdlZW5lci5jbGVhcigpXG4gICAgICAgICAgICAuZmFkZU91dCgyNTApXG4gICAgICAgICAgICAuY2FsbCgoKSA9PiByZXNvbHZlKCkpO1xuICAgICAgICB9KSxcbiAgICAgICAgbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICAgICAgdGhpcy5sYXlvdXRCYXNlLnNjYWxlWCA9IDEuMDtcbiAgICAgICAgICB0aGlzLmxheW91dEJhc2Uuc2NhbGVZID0gMS4wO1xuICAgICAgICAgIHRoaXMubGF5b3V0QmFzZS50d2VlbmVyLmNsZWFyKClcbiAgICAgICAgICAgIC50byh7IHNjYWxlWDogMC4wLCBzY2FsZVk6IDAuMCB9LCAyNTAsIFwiZWFzZUluT3V0UXVhZFwiKVxuICAgICAgICAgICAgLmNhbGwoKCkgPT4ge1xuICAgICAgICAgICAgICB0aGlzLmZsYXJlKFwiY2xvc2VkXCIsIHsgZGlhbG9nOiB0aGlzIH0pO1xuICAgICAgICAgICAgICB0aGlzLnBhcmVudFNjZW5lLmZsYXJlKFwiZGlhbG9nY2xvc2VkXCIsIHsgZGlhbG9nOiB0aGlzIH0pO1xuICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSlcbiAgICAgIF0pLnRoZW4oKCkgPT4ge1xuICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgICBpZiAodGhpcy5sYXlvdXQpIHtcbiAgICAgICAgICB0aGlzLmxheW91dC5kZXN0cm95KCk7XG4gICAgICAgICAgZGVsZXRlIHRoaXMubGF5b3V0O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZmxhcmUoXCJkZXN0cm95XCIpO1xuICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v44Ki44K744OD44OI44KS44OQ44OD44Kv44Kw44Op44Km44Oz44OJ44Gn6Kqt44G/6L6844G/XG4gICAgZG93bmxvYWRBc3NldDogZnVuY3Rpb24oYXNzZXRzKSB7XG4gICAgICBpZiAoIWFzc2V0cykgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuXG4gICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICAgIGNvbnN0IGxvYWRlciA9IHBoaW5hLmV4dGVuc2lvbi5Bc3NldExvYWRlckV4KCk7XG4gICAgICAgIGxvYWRlci5sb2FkKGFzc2V0cywgdGhpcy5fb25Mb2FkQXNzZXQpXG4gICAgICAgICAgLnRoZW4oKCkgPT4gcmVzb2x2ZSgpKTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL0FQSeOBi+OCieODh+ODvOOCv+WPluW+l1xuICAgIGdldERhdGE6IGZ1bmN0aW9uKGFwaVBhcmFtKSB7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gIH0pO1xuXG59KTtcbiIsIi8qKlxuICogRG9tQnV0dG9uXG4gKiBlbGVtZW5044Gr44GL44G244Gb44KL5b2i44GnRE9N44Oc44K/44Oz44KS5L2c5oiQ44GX44G+44GZ44CCXG4gKiBcbiAqIFBhcmFtYXRlclxuICogYXBwICAgICAgQ2FudmFzQXBwXG4gKiBlbGVtZW50ICDjgYvjgbbjgZvjgovlr77osaFlbGVtZW50XG4gKiBmdW5jICAgICDjgq/jg6rjg4Pjgq/jgZXjgozjgZ/mmYLjgavlrp/ooYzjgZXjgozjgovplqLmlbBcbiAqL1xuXG5waGluYS5uYW1lc3BhY2UoKCkgPT4ge1xuICBwaGluYS5kZWZpbmUoXCJEb21CdXR0b25cIiwge1xuICAgIHN1cGVyQ2xhc3M6IFwiRGlzcGxheUVsZW1lbnRcIixcblxuICAgIGluaXQ6IGZ1bmN0aW9uKGFwcCwgZWxlbWVudCkge1xuICAgICAgdGhpcy5zdXBlckluaXQoKTtcblxuICAgICAgdGhpcy5hcHAgPSBhcHA7XG5cbiAgICAgIHRoaXMuYnRuID0gbnVsbDtcbiAgICAgIHRoaXMuc2V0dXAoZWxlbWVudCk7XG4gICAgfSxcblxuICAgIHNldHVwOiBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICBpZiAodGhpcy5idG4pIHRoaXMuYnRuLnJlbW92ZSgpO1xuXG4gICAgICB0aGlzLmJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgICB0aGlzLmJ0bi5pZCA9IFwiYnRuXCJcbiAgICAgIHRoaXMuYnRuLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgICAgdGhpcy5idG4uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgdGhpcy5idG4uc3R5bGUucGFkZGluZyA9IFwiMHB4XCI7XG4gICAgICB0aGlzLmJ0bi5zdHlsZS5ib3JkZXJXaWR0aCA9IFwiMHB4XCI7XG5cbiAgICAgIHRoaXMuYnRuLnN0eWxlLmZpbHRlciA9ICdhbHBoYShvcGFjaXR5PTApJztcbiAgICAgIHRoaXMuYnRuLnN0eWxlLk1vek9wYWNpdHkgPSAwLjA7XG4gICAgICB0aGlzLmJ0bi5zdHlsZS5vcGFjaXR5ID0gMC4wO1xuXG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuYnRuKTtcblxuICAgICAgdGhpcy5idG4ub25jbGljayA9ICgpID0+IHtcbiAgICAgICAgZWxlbWVudC5mbGFyZSgnY2xpY2tlZCcpO1xuICAgICAgICB0aGlzLmZsYXJlKCdjbGlja2VkJyk7XG4gICAgICB9O1xuXG4gICAgICB0aGlzLm9uKCdlbnRlcmZyYW1lJywgKCkgPT4ge1xuICAgICAgICBpZiAoIXRoaXMuYnRuKSByZXR1cm47XG4gICAgICAgIGNvbnN0IHNjYWxlID0gcGFyc2VJbnQodGhpcy5hcHAuZG9tRWxlbWVudC5zdHlsZS53aWR0aCkgLyB0aGlzLmFwcC5kb21FbGVtZW50LndpZHRoO1xuICAgICAgICBsZXQgd2lkdGggPSBlbGVtZW50LndpZHRoICogc2NhbGU7XG4gICAgICAgIGxldCBoZWlnaHQgPSBlbGVtZW50LmhlaWdodCAqIHNjYWxlO1xuICAgICAgICBsZXQgY2FudmFzTGVmdCA9IHBhcnNlSW50KHRoaXMuYXBwLmRvbUVsZW1lbnQuc3R5bGUubGVmdCk7XG4gICAgICAgIGxldCBjYW52YXNUb3AgPSBwYXJzZUludCh0aGlzLmFwcC5kb21FbGVtZW50LnN0eWxlLnRvcCk7XG5cbiAgICAgICAgLy/oh6rouqvjga7jgrDjg63jg7zjg5Djg6vluqfmqJnjgavlkIjjgo/jgZvjgotcbiAgICAgICAgY2FudmFzTGVmdCArPSBlbGVtZW50Ll93b3JsZE1hdHJpeC5tMDIgKiBzY2FsZTtcbiAgICAgICAgY2FudmFzVG9wICs9IGVsZW1lbnQuX3dvcmxkTWF0cml4Lm0xMiAqIHNjYWxlO1xuICAgICAgICBjYW52YXNMZWZ0ICs9IC1lbGVtZW50Lm9yaWdpblggKiB3aWR0aDtcbiAgICAgICAgY2FudmFzVG9wICs9IC1lbGVtZW50Lm9yaWdpblkgKiBoZWlnaHQ7XG5cbiAgICAgICAgdGhpcy5idG4uc3R5bGUuZGlzcGxheSA9IFwiXCI7XG4gICAgICAgIHRoaXMuYnRuLnN0eWxlLndpZHRoID0gYCR7d2lkdGh9cHhgO1xuICAgICAgICB0aGlzLmJ0bi5zdHlsZS5oZWlnaHQgPSBgJHtoZWlnaHR9cHhgO1xuICAgICAgICB0aGlzLmJ0bi5zdHlsZS5sZWZ0ID0gYCR7Y2FudmFzTGVmdH1weGA7XG4gICAgICAgIHRoaXMuYnRuLnN0eWxlLnRvcCA9IGAke2NhbnZhc1RvcH1weGA7XG4gICAgICB9KTtcblxuICAgIH0sXG5cbiAgICBvbnJlbW92ZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKCF0aGlzLmJ0bikgcmV0dXJuO1xuICAgICAgdGhpcy5idG4ucmVtb3ZlKCk7XG4gICAgICB0aGlzLmJ0biA9IG51bGw7XG4gICAgfSxcblxuICB9KTtcbn0pO1xuIiwicGhpbmEubmFtZXNwYWNlKCgpID0+IHtcbiAgcGhpbmEuZGVmaW5lKFwiSW5wdXRGaWVsZFwiLCB7XG4gICAgc3VwZXJDbGFzczogXCJEaXNwbGF5RWxlbWVudFwiLFxuXG4gICAgZG9tRWxlbWVudDogbnVsbCxcblxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIHRoaXMub3B0aW9ucyA9ICh7fSkuJHNhZmUob3B0aW9ucywgSW5wdXRGaWVsZC5kZWZhdWx0cyk7XG4gICAgICB0aGlzLnN1cGVySW5pdChvcHRpb25zKTtcblxuICAgICAgdGhpcy5kb21FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuICAgICAgdGhpcy5kb21FbGVtZW50LnR5cGUgPSB0aGlzLm9wdGlvbnMudHlwZTtcbiAgICAgIHRoaXMuZG9tRWxlbWVudC52YWx1ZSA9IHRoaXMub3B0aW9ucy50ZXh0O1xuXG4gICAgICB0aGlzLmRvbUVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG4gICAgICB0aGlzLmRvbUVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgdGhpcy5kb21FbGVtZW50LnN0eWxlLnBhZGRpbmcgPSBcIjBweFwiO1xuICAgICAgdGhpcy5kb21FbGVtZW50LnN0eWxlLmJvcmRlcldpZHRoID0gXCIwcHhcIjtcbiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5kb21FbGVtZW50KTtcblxuICAgICAgdGhpcy5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJmb2N1c1wiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuZmxhcmUoXCJmb2N1c1wiKTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImZvY3Vzb3V0XCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5mbGFyZShcImZvY3Vzb3V0XCIpO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgKCkgPT4ge1xuICAgICAgICB0aGlzLmZsYXJlKFwiY2hhbmdlXCIpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vVE9ETzphcHDjga7lj4Lnhafmlrnms5Xjgafku5bjgavoia/jgYTmlrnms5XjgYzjgYLjgozjgbDlpInmm7TjgZnjgotcbiAgICAgIHRoaXMub25lKFwiZW50ZXJmcmFtZVwiLCAoZSkgPT4ge1xuICAgICAgICB0aGlzLmFwcCA9IGUuYXBwO1xuICAgICAgICB0aGlzLnNldHVwKCk7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgc2V0dXA6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5vbihcImVudGVyZnJhbWVcIiwgKCkgPT4ge1xuICAgICAgICBjb25zdCBzY2FsZSA9IHBhcnNlSW50KHRoaXMuYXBwLmRvbUVsZW1lbnQuc3R5bGUud2lkdGgpIC8gdGhpcy5hcHAuZG9tRWxlbWVudC53aWR0aCAqIHRoaXMuYXBwLnF1YWxpdHk7XG5cbiAgICAgICAgbGV0IGZvbnRTaXplID0gKHRoaXMub3B0aW9ucy5mb250U2l6ZSAqIHNjYWxlKS5yb3VuZCgpO1xuICAgICAgICAvL+OCreODo+ODs+ODkOOCueOBruW3puS4iuOBq+WQiOOCj+OBm+OCi1xuICAgICAgICBsZXQgd2lkdGggPSB0aGlzLndpZHRoICogc2NhbGU7XG4gICAgICAgIGxldCBoZWlnaHQgPSB0aGlzLmhlaWdodCAqIHNjYWxlO1xuICAgICAgICBsZXQgY2FudmFzTGVmdCA9IHBhcnNlSW50KHRoaXMuYXBwLmRvbUVsZW1lbnQuc3R5bGUubGVmdCk7XG4gICAgICAgIGxldCBjYW52YXNUb3AgPSBwYXJzZUludCh0aGlzLmFwcC5kb21FbGVtZW50LnN0eWxlLnRvcCk7XG5cbiAgICAgICAgLy/oh6rouqvjga7jgrDjg63jg7zjg5Djg6vluqfmqJnjgavlkIjjgo/jgZvjgotcbiAgICAgICAgY2FudmFzTGVmdCArPSB0aGlzLl93b3JsZE1hdHJpeC5tMDIgKiBzY2FsZTtcbiAgICAgICAgY2FudmFzVG9wICs9IHRoaXMuX3dvcmxkTWF0cml4Lm0xMiAqIHNjYWxlO1xuICAgICAgICAvL29yaWdpbuOBruiqv+aVtFxuICAgICAgICBjYW52YXNMZWZ0ICs9IC10aGlzLm9yaWdpblggKiB3aWR0aDtcbiAgICAgICAgY2FudmFzVG9wICs9IC10aGlzLm9yaWdpblkgKiBoZWlnaHQ7XG5cbiAgICAgICAgdGhpcy5kb21FbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuICAgICAgICB0aGlzLmRvbUVsZW1lbnQuc3R5bGUud2lkdGggPSBgJHt3aWR0aH1weGA7XG4gICAgICAgIHRoaXMuZG9tRWxlbWVudC5zdHlsZS5oZWlnaHQgPSBgJHtoZWlnaHR9cHhgO1xuICAgICAgICB0aGlzLmRvbUVsZW1lbnQuc3R5bGUubGVmdCA9IGAke2NhbnZhc0xlZnR9cHhgO1xuICAgICAgICB0aGlzLmRvbUVsZW1lbnQuc3R5bGUudG9wID0gYCR7Y2FudmFzVG9wfXB4YDtcbiAgICAgICAgdGhpcy5kb21FbGVtZW50LnN0eWxlLmZvbnRTaXplID0gYCR7Zm9udFNpemV9cHhgO1xuICAgICAgICB0aGlzLmRvbUVsZW1lbnQuc3R5bGUuZm9udEZhbWlsaXkgPSBcIk1haW4tQm9sZFwiO1xuICAgICAgfSk7XG4gICAgfSxcblxuICAgIHNldFZpc2libGU6IGZ1bmN0aW9uKGZsYWcpIHtcbiAgICAgIHRoaXMudmlzaWJsZSA9IGZsYWc7XG4gICAgICBpZiAodGhpcy5kb21FbGVtZW50KSB7XG4gICAgICAgIHRoaXMuZG9tRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gKGZsYWcpID8gXCJcIiA6IFwibm9uZVwiO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIHNob3c6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5zZXRWaXNpYmxlKHRydWUpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcblxuICAgIGhpZGU6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAgIHRoaXMuZG9tRWxlbWVudC5ibHVyKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgLy/jgr3jg5Xjg4jjgqbjgqfjgqLjgq3jg7zjg5zjg7zjg4npnZ7ooajnpLpcbiAgICBibHVyOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuZG9tRWxlbWVudC5ibHVyKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgcmVhZE9ubHk6IGZ1bmN0aW9uKGZsYWcpIHtcbiAgICAgIGlmIChmbGFnID09IHVuZGVmaW5lZCkgZmxhZyA9IHRydWU7XG4gICAgICBpZiAoZmxhZykge1xuICAgICAgICB0aGlzLmRvbUVsZW1lbnQucmVhZE9ubHkgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5kb21FbGVtZW50LnJlYWRPbmx5ID0gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgYWRkQ1NTOiBmdW5jdGlvbihjc3MpIHtcbiAgICAgIGlmIChjc3MgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICBjc3MuZm9yRWFjaCgoYykgPT4ge1xuICAgICAgICAgIHRoaXMuZG9tRWxlbWVudC5jbGFzc0xpc3QuYWRkKGMpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh0aGlzLmRvbUVsZW1lbnQpIHtcbiAgICAgICAgICB0aGlzLmRvbUVsZW1lbnQuY2xhc3NMaXN0LmFkZChjc3MpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgcmVtb3ZlQ1NTOiBmdW5jdGlvbihjc3MpIHtcbiAgICAgIGlmIChjc3MgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICBjc3MuZm9yRWFjaCgoYykgPT4ge1xuICAgICAgICAgIHRoaXMuZG9tRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGMpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh0aGlzLmRvbUVsZW1lbnQpIHtcbiAgICAgICAgICB0aGlzLmRvbUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjc3MpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgb25yZW1vdmVkOiBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLmRvbUVsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5kb21FbGVtZW50LnJlbW92ZSgpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvL+e1teaWh+Wtl+OBrumZpOWOu1xuICAgIHJlbW92ZUVtb2ppOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciByYW5nZXMgPSBbXG4gICAgICAgICdcXHVkODNjW1xcdWRmMDAtXFx1ZGZmZl0nLFxuICAgICAgICAnXFx1ZDgzZFtcXHVkYzAwLVxcdWRlNGZdJyxcbiAgICAgICAgJ1xcdWQ4M2RbXFx1ZGU4MC1cXHVkZWZmXScsXG4gICAgICAgICdcXHVkN2M5W1xcdWRlMDAtXFx1ZGVmZl0nLFxuICAgICAgICAnW1xcdTI2MDAtXFx1MjdCRl0nLFxuICAgICAgXTtcbiAgICAgIHZhciByZWcgPSBuZXcgUmVnRXhwKHJhbmdlcy5qb2luKCd8JyksICdnJyk7XG4gICAgICB0aGlzLmRvbUVsZW1lbnQudmFsdWUgPSAodGhpcy5kb21FbGVtZW50LnZhbHVlKS5yZXBsYWNlKHJlZywgJycpO1xuICAgIH0sXG4gICAgXG4gICAgX2FjY2Vzc29yOiB7XG4gICAgICB0ZXh0OiB7XG4gICAgICAgIFwiZ2V0XCI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiAodGhpcy5kb21FbGVtZW50KSA/IHRoaXMuZG9tRWxlbWVudC52YWx1ZSA6IFwiXCI7XG4gICAgICAgIH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgICBpZiAoIXRoaXMuZG9tRWxlbWVudCkgcmV0dXJuO1xuICAgICAgICAgIHRoaXMuZG9tRWxlbWVudC52YWx1ZSA9IHY7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX3N0YXRpYzoge1xuICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgd2lkdGg6IDIwMCxcbiAgICAgICAgaGVpZ2h0OiA0MCxcbiAgICAgICAgZm9udFNpemU6IDIwLFxuICAgICAgICB0ZXh0OiBcIlwiLFxuICAgICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgIH1cbiAgICB9LFxuICB9KTtcbn0pO1xuIiwiLy9cbi8vIOOCr+ODquODg+OCr+OChOOCv+ODg+ODgeOCkuOCpOODs+OCv+ODvOOCu+ODl+ODiOOBmeOCi1xuLy9cbnBoaW5hLmRlZmluZShcIklucHV0SW50ZXJjZXB0XCIsIHtcbiAgc3VwZXJDbGFzczogXCJEaXNwbGF5RWxlbWVudFwiLFxuXG4gIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc3VwZXJJbml0KCk7XG5cbiAgICB0aGlzLm9uKFwiYWRkZWRcIiwgKCkgPT4ge1xuICAgICAgLy/opqrjgavlr77jgZfjgabopobjgYTjgYvjgbbjgZvjgotcbiAgICAgIHRoaXMud2lkdGggPSB0aGlzLnBhcmVudC53aWR0aDtcbiAgICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy5wYXJlbnQuaGVpZ2h0O1xuICAgICAgdGhpcy5vcmlnaW5YID0gdGhpcy5wYXJlbnQub3JpZ2luWCB8fCAwO1xuICAgICAgdGhpcy5vcmlnaW5ZID0gdGhpcy5wYXJlbnQub3JpZ2luWSB8fCAwO1xuICAgICAgdGhpcy54ID0gMDtcbiAgICAgIHRoaXMueSA9IDA7XG4gICAgfSk7XG4gICAgdGhpcy5kaXNhYmxlKCk7XG4gIH0sXG5cbiAgZW5hYmxlOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnNldEludGVyYWN0aXZlKHRydWUpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIGRpc2FibGU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc2V0SW50ZXJhY3RpdmUoZmFsc2UpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG59KTtcbiIsInBoaW5hLmRlZmluZShcIk1vZGFsXCIsIHtcbiAgc3VwZXJDbGFzczogXCJJbnB1dEludGVyY2VwdFwiLFxuXG4gIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc3VwZXJJbml0KCk7XG4gICAgdGhpcy5lbmFibGUoKTtcbiAgfSxcbiAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvL+ihqOekuuOCouODi+ODoeODvOOCt+ODp+ODs1xuICAvLyDjgqLjg4vjg6Hjg7zjgrfjg6fjg7PjgavjgaTjgYTjgabjga/ntpnmib/lhYPjgaflho3lrprnvqlcbiAgb3BlbkFuaW1hdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICB9LFxuXG4gIC8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy/pnZ7ooajnpLrjgqLjg4vjg6Hjg7zjgrfjg6fjg7NcbiAgLy8g44Ki44OL44Oh44O844K344On44Oz44Gr44Gk44GE44Gm44Gv57aZ5om/5YWD44Gn5YaN5a6a576pXG4gIGNsb3NlQW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gIH0sXG5cbiAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvL+ihqOekulxuICBvcGVuOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5vcGVuQW5pbWF0aW9uKCk7XG4gIH0sXG5cbiAgLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvL+mdnuihqOekulxuICBjbG9zZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuY2xvc2VBbmltYXRpb24oKTtcbiAgfVxuXG59KTtcbiIsInBoaW5hLm5hbWVzcGFjZSgoKSA9PiB7XG4gIHBoaW5hLmRlZmluZShcIlRleHRBcmVhXCIsIHtcbiAgICBzdXBlckNsYXNzOiBcIkRpc3BsYXlFbGVtZW50XCIsXG5cbiAgICBkb21FbGVtZW50OiBudWxsLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgdGhpcy5vcHRpb25zID0gKHt9KS4kc2FmZShvcHRpb25zLCBUZXh0QXJlYS5kZWZhdWx0cyk7XG4gICAgICB0aGlzLnN1cGVySW5pdChvcHRpb25zKTtcblxuICAgICAgdGhpcy5kb21FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRleHRhcmVhXCIpO1xuICAgICAgdGhpcy5kb21FbGVtZW50LnR5cGUgPSBcInRleHRcIjtcbiAgICAgIHRoaXMuZG9tRWxlbWVudC52YWx1ZSA9IHRoaXMub3B0aW9ucy50ZXh0O1xuICAgICAgdGhpcy5kb21FbGVtZW50LnJlc2l6ZSA9IFwibm9uZVwiO1xuICAgICAgaWYgKG9wdGlvbnMucm93cykgdGhpcy5kb21FbGVtZW50LnJvd3MgPSBvcHRpb25zLnJvd3M7XG5cbiAgICAgIHRoaXMuZG9tRWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICAgIHRoaXMuZG9tRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICB0aGlzLmRvbUVsZW1lbnQuc3R5bGUucGFkZGluZyA9IFwiMHB4XCI7XG4gICAgICB0aGlzLmRvbUVsZW1lbnQuc3R5bGUuYm9yZGVyV2lkdGggPSBcIjBweFwiO1xuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLmRvbUVsZW1lbnQpO1xuXG4gICAgICB0aGlzLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImZvY3VzXCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5mbGFyZShcImZvY3VzXCIpO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZm9jdXNvdXRcIiwgKCkgPT4ge1xuICAgICAgICB0aGlzLmZsYXJlKFwiZm9jdXNvdXRcIik7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuZmxhcmUoXCJjaGFuZ2VcIik7XG4gICAgICB9KTtcblxuICAgICAgLy9UT0RPOmFwcOOBruWPgueFp+aWueazleOBp+S7luOBq+iJr+OBhOaWueazleOBjOOBguOCjOOBsOWkieabtOOBmeOCi1xuICAgICAgdGhpcy5vbmUoXCJlbnRlcmZyYW1lXCIsIChlKSA9PiB7XG4gICAgICAgIHRoaXMuYXBwID0gZS5hcHA7XG4gICAgICAgIHRoaXMuc2V0dXAoKTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBzZXR1cDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLm9uKFwiZW50ZXJmcmFtZVwiLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHNjYWxlID0gcGFyc2VJbnQodGhpcy5hcHAuZG9tRWxlbWVudC5zdHlsZS53aWR0aCkgLyB0aGlzLmFwcC5kb21FbGVtZW50LndpZHRoICogdGhpcy5hcHAucXVhbGl0eTtcblxuICAgICAgICBsZXQgZm9udFNpemUgPSAodGhpcy5vcHRpb25zLmZvbnRTaXplICogc2NhbGUpLnJvdW5kKCk7XG4gICAgICAgIC8v44Kt44Oj44Oz44OQ44K544Gu5bem5LiK44Gr5ZCI44KP44Gb44KLXG4gICAgICAgIGxldCB3aWR0aCA9IHRoaXMud2lkdGggKiBzY2FsZTtcbiAgICAgICAgbGV0IGhlaWdodCA9IHRoaXMuaGVpZ2h0ICogc2NhbGU7XG4gICAgICAgIGxldCBjYW52YXNMZWZ0ID0gcGFyc2VJbnQodGhpcy5hcHAuZG9tRWxlbWVudC5zdHlsZS5sZWZ0KTtcbiAgICAgICAgbGV0IGNhbnZhc1RvcCA9IHBhcnNlSW50KHRoaXMuYXBwLmRvbUVsZW1lbnQuc3R5bGUudG9wKTtcblxuICAgICAgICAvL+iHqui6q+OBruOCsOODreODvOODkOODq+W6p+aomeOBq+WQiOOCj+OBm+OCi1xuICAgICAgICBjYW52YXNMZWZ0ICs9IHRoaXMuX3dvcmxkTWF0cml4Lm0wMiAqIHNjYWxlO1xuICAgICAgICBjYW52YXNUb3AgKz0gdGhpcy5fd29ybGRNYXRyaXgubTEyICogc2NhbGU7XG4gICAgICAgIC8vb3JpZ2lu44Gu6Kq/5pW0XG4gICAgICAgIGNhbnZhc0xlZnQgKz0gLXRoaXMub3JpZ2luWCAqIHdpZHRoO1xuICAgICAgICBjYW52YXNUb3AgKz0gLXRoaXMub3JpZ2luWSAqIGhlaWdodDtcblxuICAgICAgICB0aGlzLmRvbUVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwiXCI7XG4gICAgICAgIHRoaXMuZG9tRWxlbWVudC5zdHlsZS53aWR0aCA9IGAke3dpZHRofXB4YDtcbiAgICAgICAgdGhpcy5kb21FbGVtZW50LnN0eWxlLmhlaWdodCA9IGAke2hlaWdodH1weGA7XG4gICAgICAgIHRoaXMuZG9tRWxlbWVudC5zdHlsZS5sZWZ0ID0gYCR7Y2FudmFzTGVmdH1weGA7XG4gICAgICAgIHRoaXMuZG9tRWxlbWVudC5zdHlsZS50b3AgPSBgJHtjYW52YXNUb3B9cHhgO1xuICAgICAgICB0aGlzLmRvbUVsZW1lbnQuc3R5bGUuZm9udFNpemUgPSBgJHtmb250U2l6ZX1weGA7XG4gICAgICAgIHRoaXMuZG9tRWxlbWVudC5zdHlsZS5mb250RmFtaWxpeSA9IFwiTWFpbi1Cb2xkXCI7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgc2V0VmlzaWJsZTogZnVuY3Rpb24oZmxhZykge1xuICAgICAgdGhpcy52aXNpYmxlID0gZmxhZztcbiAgICAgIGlmICh0aGlzLmRvbUVsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5kb21FbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAoZmxhZykgPyBcIlwiIDogXCJub25lXCI7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgc2hvdzogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnNldFZpc2libGUodHJ1ZSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuXG4gICAgaGlkZTogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgdGhpcy5kb21FbGVtZW50LmJsdXIoKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICAvL+OCveODleODiOOCpuOCp+OCouOCreODvOODnOODvOODiemdnuihqOekulxuICAgIGJsdXI6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5kb21FbGVtZW50LmJsdXIoKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICByZWFkT25seTogZnVuY3Rpb24oZmxhZykge1xuICAgICAgaWYgKGZsYWcgPT0gdW5kZWZpbmVkKSBmbGFnID0gdHJ1ZTtcbiAgICAgIGlmIChmbGFnKSB7XG4gICAgICAgIHRoaXMuZG9tRWxlbWVudC5yZWFkT25seSA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmRvbUVsZW1lbnQucmVhZE9ubHkgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBhZGRDU1M6IGZ1bmN0aW9uKGNzcykge1xuICAgICAgaWYgKGNzcyBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgIGNzcy5mb3JFYWNoKChjKSA9PiB7XG4gICAgICAgICAgdGhpcy5kb21FbGVtZW50LmNsYXNzTGlzdC5hZGQoYyk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHRoaXMuZG9tRWxlbWVudCkge1xuICAgICAgICAgIHRoaXMuZG9tRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNzcyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICByZW1vdmVDU1M6IGZ1bmN0aW9uKGNzcykge1xuICAgICAgaWYgKGNzcyBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgIGNzcy5mb3JFYWNoKChjKSA9PiB7XG4gICAgICAgICAgdGhpcy5kb21FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoYyk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHRoaXMuZG9tRWxlbWVudCkge1xuICAgICAgICAgIHRoaXMuZG9tRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNzcyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG5cbiAgICBvbnJlbW92ZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKHRoaXMuZG9tRWxlbWVudCkge1xuICAgICAgICB0aGlzLmRvbUVsZW1lbnQucmVtb3ZlKCk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8v57W15paH5a2X44GM44GC44KL44GL44OB44Kn44OD44KvXG4gICAgY2hlY2tFbW9qaTogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcmFuZ2VzID0gW1xuICAgICAgICAnXFx1ZDgzY1tcXHVkZjAwLVxcdWRmZmZdJyxcbiAgICAgICAgJ1xcdWQ4M2RbXFx1ZGMwMC1cXHVkZTRmXScsXG4gICAgICAgICdcXHVkODNkW1xcdWRlODAtXFx1ZGVmZl0nLFxuICAgICAgICAnXFx1ZDdjOVtcXHVkZTAwLVxcdWRlZmZdJyxcbiAgICAgICAgJ1tcXHUyNjAwLVxcdTI3QkZdJyxcbiAgICAgIF07XG4gICAgICB2YXIgcmVnID0gbmV3IFJlZ0V4cChyYW5nZXMuam9pbignfCcpLCAnZycpO1xuICAgICAgcmV0dXJuIHRoaXMuZG9tRWxlbWVudC52YWx1ZS5tYXRjaChyZWcpO1xuICAgIH0sXG5cbiAgICAvL+e1teaWh+Wtl+OBrumZpOWOu1xuICAgIHJlbW92ZUVtb2ppOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciByYW5nZXMgPSBbXG4gICAgICAgICdcXHVkODNjW1xcdWRmMDAtXFx1ZGZmZl0nLFxuICAgICAgICAnXFx1ZDgzZFtcXHVkYzAwLVxcdWRlNGZdJyxcbiAgICAgICAgJ1xcdWQ4M2RbXFx1ZGU4MC1cXHVkZWZmXScsXG4gICAgICAgICdcXHVkN2M5W1xcdWRlMDAtXFx1ZGVmZl0nLFxuICAgICAgICAnW1xcdTI2MDAtXFx1MjdCRl0nLFxuICAgICAgXTtcbiAgICAgIHZhciByZWcgPSBuZXcgUmVnRXhwKHJhbmdlcy5qb2luKCd8JyksICdnJyk7XG4gICAgICB0aGlzLmRvbUVsZW1lbnQudmFsdWUgPSAodGhpcy5kb21FbGVtZW50LnZhbHVlKS5yZXBsYWNlKHJlZywgJycpO1xuICAgIH0sXG4gICAgXG4gICAgX2FjY2Vzc29yOiB7XG4gICAgICB0ZXh0OiB7XG4gICAgICAgIFwiZ2V0XCI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiAodGhpcy5kb21FbGVtZW50KSA/IHRoaXMuZG9tRWxlbWVudC52YWx1ZSA6IFwiXCI7XG4gICAgICAgIH0sXG4gICAgICAgIFwic2V0XCI6IGZ1bmN0aW9uKHYpIHtcbiAgICAgICAgICBpZiAoIXRoaXMuZG9tRWxlbWVudCkgcmV0dXJuO1xuICAgICAgICAgIHRoaXMuZG9tRWxlbWVudC52YWx1ZSA9IHY7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX3N0YXRpYzoge1xuICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgd2lkdGg6IDIwMCxcbiAgICAgICAgaGVpZ2h0OiA0MCxcbiAgICAgICAgZm9udFNpemU6IDIwLFxuICAgICAgICB0ZXh0OiBcIlwiLFxuICAgICAgfVxuICAgIH0sXG4gIH0pO1xufSk7XG4iLCIvKlxuICogIEFzc2V0TG9hZFNjZW5lLmpzXG4gKi9cblxucGhpbmEubmFtZXNwYWNlKGZ1bmN0aW9uKCkge1xuXG4gIHBoaW5hLmRlZmluZSgnQXNzZXRMb2FkU2NlbmUnLCB7XG4gICAgc3VwZXJDbGFzczogJ0Jhc2VTY2VuZScsXG5cbiAgICBpbml0OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICB0aGlzLnN1cGVySW5pdCgpO1xuICAgICAgb3B0aW9ucyA9IChvcHRpb25zIHx8IHt9KS4kc2FmZSh7XG4gICAgICAgIGFzc2V0VHlwZTogXCJwcmVsb2FkXCIsXG4gICAgICB9KTtcblxuICAgICAgLy8gbG9hZCBhc3NldFxuICAgICAgY29uc3QgYXNzZXRzID0gQXNzZXRMaXN0LmdldChvcHRpb25zLmFzc2V0VHlwZSk7XG4gICAgICBpZiAoIWFzc2V0cykge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlVuYWJsZSBhc3NldCBsb2FkOiBcIiArIG9wdGlvbnMuYXNzZXRUeXBlKTtcbiAgICAgICAgdGhpcy5leGl0KCk7XG4gICAgICB9XG4gICAgICB0aGlzLmxvYWRlciA9IHBoaW5hLmFzc2V0LkFzc2V0TG9hZGVyKCk7XG4gICAgICB0aGlzLmxvYWRlci5sb2FkKGFzc2V0cyk7XG4gICAgICB0aGlzLmxvYWRlci5vbignbG9hZCcsICgpID0+IHRoaXMuZXhpdCgpKTtcbiAgICB9LFxuICB9KTtcblxufSk7XG4iLCIvKlxuICogIFRpdGxlU2NlbmUuanNcbiAqL1xuXG5waGluYS5uYW1lc3BhY2UoZnVuY3Rpb24oKSB7XG5cbiAgcGhpbmEuZGVmaW5lKCdUaXRsZVNjZW5lJywge1xuICAgIHN1cGVyQ2xhc3M6ICdCYXNlU2NlbmUnLFxuXG4gICAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgdGhpcy5zdXBlckluaXQoKTtcbiAgICB9LFxuXG4gICAgc2V0dXA6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5iYXNlID0gRGlzcGxheUVsZW1lbnQoKS5hZGRDaGlsZFRvKHRoaXMpLnNldFBvc2l0aW9uKFNDUkVFTl9PRkZTRVRfWCwgU0NSRUVOX09GRlNFVF9ZKTtcblxuICAgICAgU3ByaXRlKFwiYmxhY2tcIilcbiAgICAgICAgLnNldFBvc2l0aW9uKHRoaXMuZ3JpZFguY2VudGVyKCksIHRoaXMuZ3JpZFkuY2VudGVyKCkpXG4gICAgICAgIC5hZGRDaGlsZFRvKHRoaXMuYmFzZSlcblxuICAgICAgTGFiZWwoe1xuICAgICAgICB0ZXh0OiBcIlZlcnN1c1wiLFxuICAgICAgfSlcbiAgICAgICAgLnNldFBvc2l0aW9uKHRoaXMuZ3JpZFguY2VudGVyKCksIHRoaXMuZ3JpZFkuY2VudGVyKCkpXG4gICAgICAgIC5hZGRDaGlsZFRvKHRoaXMuYmFzZSlcbiAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgfSxcbiAgfSk7XG5cbn0pO1xuIl19
